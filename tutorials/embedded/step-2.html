<!DOCTYPE html>
<html>

<head>
  <title>The Weather App</title>
  <!-- <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script> -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Infinispan is a distributed in-memory key/value data store with optional schema, available under the Apache License 2.0.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/github.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js"></script>
  <script charset="UTF-8"
          src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/languages/java.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<!--   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125236544-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
 
    gtag('config', 'UA-125236544-1');
  </script> -->


</head>

<body class="tutorial-extended">
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/infinispan-logo-white.png" class="project-logo" title="Infinispan Logo"></a>
    </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/learn/">Learn <i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/introduction" class="">Introduction</a></li>
          <li><a href="/features" class="">Features</a></li>
          <li><a href="/documentation" class="">Documentation</a></li>
          <li><a href="/tutorials" class="active">Tutorials</a></li>
          <li><a href="/videos" class="">Videos</a></li>
          <li><a href="/references" class="">References</a></li>
          <li><a href="/experiments" class="">Experiments</a></li>
          <li><a href="/roadmap" class="">Roadmap</a></li>
        </ul>
      </li>
      <li>
        <a href="/use-cases/" class="">Use Cases</a>
      </li>
      <li>
        <a href="/community/" class="">Community</a>
      </li>
      <li>
        <a href="/blog/" class="">Blog</a>
      </li>
      <li>
        <a href="/download/" class="">Download</a>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="component-slim full-width-bg dark-bg light-blue">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <a href="/tutorials">Tutorials</a>  <i class="fas fa-chevron-right"></i> The Weather App
    </div>
  </div>
</div>





<div class="grid-wrapper">
  <div class="width-3-12 width-12-12-m">
    





<h4>Tutorial Steps</h4>
<a href="index.html">Introduction</a>
<ol start="0">
  <li> <a href="step-0">The Weather Application</a> </li>
  <li> <a href="step-1">Initializing the CacheManager</a> </li>
  <li> <a href="step-2">Putting stuff in the cache</a> </li>
  <li> <a href="step-3">Making entries expire</a> </li>
  <li> <a href="step-4">Configuring the cache</a> </li>
  <li> <a href="step-5">Clustering the application</a> </li>
  <li> <a href="step-6">Listen to changes in the cluster</a> </li>
  <li> <a href="step-7">Listen to changes in the cache</a> </li>
  <li> <a href="step-8">Grouping entries together</a> </li>
  <li> <a href="step-9">Temperature averages with streams</a> </li>
  <li> <a href="step-10">Declarative configuration</a> </li> </ol>
</ol>

<!-- 
%ol{:start => "0" }
  - @tutorial_steps.each_with_index do |step, index|
    %li
      %a{:href => step_prefix + "step-" + (index).to_s } #{step} -->
  </div>
  <div class="width-9-12 width-12-12-m">
    <h4>The Weather App</h4>
    <p>
      With a CacheManager running we can start creating caches and storing data in them. Caches in Infinispan are <i>"named"</i> which means they are identified by a unique name. We are going to enhance the <i>WeatherService</i> implementations from our initial version so that they store the retrieved data in a cache. To do this we will create an intermediate abstract class between the <i>WeatherService</i> interface and the concrete implementations: the <i>CachingWeatherService.</i> This class wraps the expensive remote calls in a method which caches the result returned by the remote call and, before subsequent invocations, checks whether the data is already available locally instead of invoking the expensive remote API. First of all let's obtain our cache:
      <pre>
        <code class="java">
= preserve do
  :escaped
    cacheManager.defineConfiguration("weather", new ConfigurationBuilder().build());
    Cache<String, LocationWeather> cache = cacheManager.getCache("weather");
        </code>
      </pre>
      We are defining a named cache <i>"weather"</i> using a default configuration, which means a basic local cache. As you can see, the generic types of the keys and values are inferred from the assignment type. Next up, let's see the caching wrapper for the weather retrieval:
      <pre>
        <code class="java">
          = preserve do
            :escaped
              LocationWeather weather = cache.get(location);
              if (weather == null) {
                weather = fetchWeather(location);
                cache.put(location, weather);
              }
              return weather;
        </code>
      </pre>
      Since an Infinispan <i>Cache</i> is an implementation of the <i>java.util.Map</i> interface, the above code should be self explanatory. With the caching in place, let's run the application again, using the usual:
      <pre>
        <code class="nohighlight">
          = preserve do
            :escaped
              $ git checkout -f step-2
              $ mvn clean package exec:exec
        </code>
      </pre>
      <details>
        <summary>Output</summary>
        <div>
            <pre>
              <code class="nohighlight">
                = preserve do
                  :escaped
                    ---- Fetching weather information ----
                    Rome, Italy - Temperature: 12.9° C, Conditions: light rain
                    Como, Italy - Temperature: 6.3° C, Conditions: Sky is Clear
                    Basel, Switzerland - Temperature: 0.8° C, Conditions: overcast clouds
                    Bern, Switzerland - Temperature: -1.6° C, Conditions: broken clouds
                    London, UK - Temperature: 1.8° C, Conditions: light rain
                    Newcastle, UK - Temperature: 2.6° C, Conditions: scattered clouds
                    Bucharest, Romania - Temperature: 9.3° C, Conditions: scattered clouds
                    Cluj-Napoca, Romania - Temperature: 6.4° C, Conditions: scattered clouds
                    Ottawa, Canada - Temperature: -7.0° C, Conditions: overcast clouds
                    Toronto, Canada - Temperature: -7.0° C, Conditions: broken clouds
                    Lisbon, Portugal - Temperature: 14.6° C, Conditions: overcast clouds
                    Porto, Portugal - Temperature: 12.2° C, Conditions: moderate rain
                    Raleigh, USA - Temperature: 3.9° C, Conditions: Sky is Clear
                    Washington, USA - Temperature: 3.4° C, Conditions: light rain
                    ---- Fetched in 1634ms ----
                    ---- Fetching weather information ----
                    Rome, Italy - Temperature: 12.9° C, Conditions: light rain
                    Como, Italy - Temperature: 6.3° C, Conditions: Sky is Clear
                    Basel, Switzerland - Temperature: 0.8° C, Conditions: overcast clouds
                    Bern, Switzerland - Temperature: -1.6° C, Conditions: broken clouds
                    London, UK - Temperature: 1.8° C, Conditions: light rain
                    Newcastle, UK - Temperature: 2.6° C, Conditions: scattered clouds
                    Bucharest, Romania - Temperature: 9.3° C, Conditions: scattered clouds
                    Cluj-Napoca, Romania - Temperature: 6.4° C, Conditions: scattered clouds
                    Ottawa, Canada - Temperature: -7.0° C, Conditions: overcast clouds
                    Toronto, Canada - Temperature: -7.0° C, Conditions: broken clouds
                    Lisbon, Portugal - Temperature: 14.6° C, Conditions: overcast clouds
                    Porto, Portugal - Temperature: 12.2° C, Conditions: moderate rain
                    Raleigh, USA - Temperature: 3.9° C, Conditions: Sky is Clear
                    Washington, USA - Temperature: 3.4° C, Conditions: light rain
                    ---- Fetched in 2ms ----
              </code>
            </pre>
        </div>
      </details>
    </p>  
    <p>
      You should see the weather conditions displayed twice, but the second run should be several orders of magnitude faster. Good stuff! Entries created above are immortal, i.e. they will exist in the cache until removed. In the next step we will see how to add mortal entries.
    </p>
  </div>
</div>


  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/infinispan-logo.png" class="project-logo" title="Infinispan Logo"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Infinispan is released under the Apache 2.0 open source license. Learn more about the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>.<br/><br/>This website built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/infinispan/infinispan.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <b>Navigation</b>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/features">Features</a></li>
          
            <li><a href="/documentation">Docs</a></li>
          
            <li><a href="/tutorials">Tutorials</a></li>
          
            <li><a href="/videos">Videos</a></li>
          
            <li><a href="/use-cases">Use Cases</a></li>
          
            <li><a href="/community">Community</a></li>
          
            <li><a href="/download">Download</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <b>Contribute</b>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://issues.jboss.org/browse/ISPN">Submit a Bug</a></li>
          
            <li><a href="https://github.com/infinispan">Write Code</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <b>Follow Us</b>
        <ul class="footer-links width-1-12">
          
            <li><a href="/blog">Blog</a></li>
          
            <li><a href="https://twitter.com/infinispan">Twitter</a></li>
          
        </ul>
      </div>
    

    <div class="width-6-12 more-links">
      <div class="grid-wrapper">
        <div class="width-6-12">
          <b>A Member of</b><br/>
          <a href="http://www.cloudtm.eu/" target="_blank"><img src="/assets/images/footer/cloud-tm.png"></a>
          <img src="/assets/images/footer/leads.png">
          <br/>
          <a href="http://cloudbutton.eu/" target="_blank"><img src="/assets/images/footer/cloud-button.png"></a>

        </div>
        <div class="width-6-12">

          <b>Thanks to</b><br/>
          <a href="https://www.jetbrains.com/idea/" target="_blank">JetBrains Intellj IDEA</a><br/>
          <a href="https://www.jetbrains.com/idea/" target="_blank"><img src="/assets/images/footer/jetbrains.png">
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
  <div class="content-slim redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/truncate-list.js"></script>

<!--   <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script> -->
</body>

</html>
