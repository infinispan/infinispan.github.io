<!DOCTYPE html> <html lang="en"> <head> <title>Embedded Step-by-Step Tutorial - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <link href="http://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="http://static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="//static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="http://blog.infinispan.org">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <ul class="breadcrumb"> <li> <a href="/tutorials">Tutorials</a> </li> <li class="active">The Weather App</li> </ul> <div id="columns"> <div class="col-md-3 well" id="leftcol"> <h3>Steps</h3> <a href="../index.html">Introduction</a> <ol start="0"> <li> <a href="../step-0">The Weather Application</a> </li> <li> <a href="../step-1">Initializing the CacheManager</a> </li> <li> <a href="../step-2">Putting stuff in the cache</a> </li> <li> <a href="../step-3">Making entries expire</a> </li> <li> <a href="../step-4">Configuring the default cache</a> </li> <li> <a href="../step-5">Clustering the application</a> </li> <li> <a href="../step-6">Listen to changes in the cluster</a> </li> <li> <a href="../step-7">Listen to changes in the cache</a> </li> <li> <a href="../step-8">Grouping entries together</a> </li> <li> <a href="../step-9">A custom externalizer</a> </li> <li> <a href="../step-10">Temperature averages with streams</a> </li> <li> <a href="../step-11">Declarative configuration</a> </li> </ol> </div> <div class="col-md-9" id="maincol"> <div class="btn-toolbar"> <a class="btn btn-default" href="../step-8"> <i class="icon-chevron-sign-left">&nbsp;Grouping entries together</i> </a> <a class="btn btn-default" href="https://github.com/infinispan/infinispan-embedded-tutorial/compare/step-8...step-9" target="_blank"> <i class="icon-code"> Code Diff </i> </a> <a class="btn btn-default" href="../step-10"> Temperature averages with streams <i class="icon-chevron-sign-right"></i> </a> </div> <h3>Step 9: A custom externalizer</h3> <p> When we introduced clustering to our application, we pointed out the need for keys and values to be serializable. Infinispan, however, doesn't use standard Java serialization but a much higher performance library called JBoss Marshalling. Usually you don't need to do anything else to your entities, aside implementing <i>java.io.Serializable</i> since JBoss Marshalling takes care of everything for you. There are cases, however, where you might want to have full control over the serialization format, for example to support backwards and forwards compatibility of entities which might change during the lifetime of a project. In this case you need to provide a custom <i>Externalizer.</i> An Externalizer is simply a class which knows how to read and write your entities over a stream. Let's write a simple externalizer for our <i>LocationWeather</i> class: <pre><code class="java">public static class LWExternalizer implements Externalizer&lt;LocationWeather&gt; {&#x000A;  @Override&#x000A;  public void writeObject(ObjectOutput output, LocationWeather object) throws IOException {&#x000A;    output.writeFloat(object.temperature);&#x000A;    output.writeUTF(object.conditions);&#x000A;    output.writeUTF(object.country);&#x000A;  }&#x000A;  @Override&#x000A;  public LocationWeather readObject(ObjectInput input) throws IOException, ClassNotFoundException { &#x000A;    float temperature = input.readFloat();&#x000A;    String conditions = input.readUTF();&#x000A;    String country = input.readUTF();&#x000A;    return new LocationWeather(temperature, conditions, country);&#x000A;  }&#x000A;}</code></pre> We also need to add a special annotation to our entity, declaring the externalizer that should be used for it: <pre><code class="java">@SerializeWith(LocationWeather.LWExternalizer.class)&#x000A;public class LocationWeather implements Serializable {</code></pre> That's it. Since we didn't do anything special, running the application won't show any visible differences, but now you have a better idea about what's happening under the hood. <pre><code class="nohighlight">$ git checkout -f step-9&#x000A;$ mvn clean package exec:exec # on terminal 1&#x000A;$ mvn exec:exec # on terminal 2</code></pre> </p> <p> Now we are ready to tackle something a bit more interesting: we will use Infinispan to <i>do</i> something with the data, instead of just storing and retrieving it. </p> <div class="btn-toolbar"> <a class="btn btn-default" href="../step-8"> <i class="icon-chevron-sign-left">&nbsp;Grouping entries together</i> </a> <a class="btn btn-default" href="https://github.com/infinispan/infinispan-embedded-tutorial/compare/step-8...step-9" target="_blank"> <i class="icon-code"> Code Diff </i> </a> <a class="btn btn-default" href="../step-10"> Temperature averages with streams <i class="icon-chevron-sign-right"></i> </a> </div> </div> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="http://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="http://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="http://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="http://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> Â© Copyright 2009-2017 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="http://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="http://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="http://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="http://static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> </body> </html>