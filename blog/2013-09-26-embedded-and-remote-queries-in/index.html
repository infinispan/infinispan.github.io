<!DOCTYPE html> <html lang="en"> <head> <title>Embedded and remote queries in Infinispan 6.0.0.Beta1 - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="http://blog.infinispan.org">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <h3>Thursday 26 September 2013</h3> <h1>Embedded and remote queries in Infinispan 6.0.0.Beta1</h1> <p>&lt;p&gt;&lt;div dir="ltr" style="text-align: left;" trbidi="on"&gt;&lt;br/&gt;If you're following Infinispan's mailing lists you've probably caught a glimpse of the new developments in the Query land: a new DSL, remote querying via Hot Rod client, a new marshaller based on Google's Protobuf. Time to unveil these properly!&lt;br/&gt;&lt;br/&gt;&lt;h3/&gt;&lt;h3&gt;The new Query DSL&lt;/h3&gt;&lt;h3/&gt;&lt;br/&gt;Starting with version 6.0 Infinispan offers a new (experimental) way of running queries against your cached entities based on a simple filtering DSL. The aim of the new DSL is to simplify the way you write queries and to be agnostic of the underlying query mechanism(s) making it possible to provide alternative query engines in the future besides Lucene and still being able to use the same query language/API. The previous Hibernate Search &amp;amp; Lucene based &lt;a href="https://docs.jboss.org/author/display/ISPN/Querying+Infinispan"&gt;approach&lt;/a&gt; is still in place and will continue to be supported and in fact the new DSL is currently implemented right on top of it. The future will surely bring index-less searching based on map-reduce and possibly other new cool search technologies.&lt;br/&gt;&lt;br/&gt;Running DSL-based queries in embedded mode is almost identical to running the existing Lucene-based queries. All you need to do is have infinispan-query-dsl.jar and infinispan-query.jar in your classpath (besides Infinispan and its dependecies), enable indexing for your caches, annotate your POJO cache values and your're ready.&lt;br/&gt;&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #a08000;"&gt;ConfigurationBuilder&lt;/span&gt; cfg &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #2060a0;"&gt;new&lt;/span&gt; &lt;span style="color: #a08000;"&gt;ConfigurationBuilder&lt;/span&gt;();&lt;br/&gt;cfg&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;indexing()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;enable();&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;DefaultCacheManager&lt;/span&gt; cacheManager &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #2060a0;"&gt;new&lt;/span&gt; &lt;span style="color: #a08000;"&gt;DefaultCacheManager&lt;/span&gt;(cfg&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;build());&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;Cache&lt;/span&gt; cache &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; cacheManager&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getCache();&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;Alternatively, indexing (and everything else) can also be configured via XML configuration, as already described in the user guide, so we'll not delve into details here.&lt;br/&gt;&lt;br/&gt;Your Hibernate Search annotated entity might look like this.&lt;br/&gt;&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.hibernate.search.annotations.*&lt;/span&gt;;&lt;br/&gt;.&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;.&lt;br/&gt;&lt;br/&gt;@&lt;span style="color: #a08000;"&gt;Indexed&lt;/span&gt;&lt;br/&gt;&lt;span style="color: teal;"&gt;public&lt;/span&gt; &lt;span style="color: teal;"&gt;class&lt;/span&gt; User {&lt;br/&gt;&lt;br/&gt; &lt;span style="color: #a08000;"&gt;@Field&lt;/span&gt;(store &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Store&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;YES, analyze &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Analyze&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;NO)&lt;br/&gt; &lt;span style="color: teal;"&gt;private&lt;/span&gt; &lt;span style="color: #a08000;"&gt;String&lt;/span&gt; name;&lt;br/&gt;&lt;br/&gt; &lt;span style="color: #a08000;"&gt;@Field&lt;/span&gt;(store &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Store&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;YES, analyze &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Analyze&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;NO, indexNullAs &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Field&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;DEFAULT_NULL_TOKEN)&lt;br/&gt; &lt;span style="color: teal;"&gt;private&lt;/span&gt; &lt;span style="color: #a08000;"&gt;String&lt;/span&gt; surname;&lt;br/&gt;&lt;br/&gt; &lt;span style="color: #a08000;"&gt;@IndexedEmbedded&lt;/span&gt;(indexNullAs &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Field&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;DEFAULT_NULL_TOKEN)&lt;br/&gt; &lt;span style="color: teal;"&gt;private&lt;/span&gt; &lt;span style="color: #a08000;"&gt;List&lt;/span&gt; addresses;&lt;br/&gt;&lt;br/&gt; &lt;span style="color: #406040;"&gt;// .. the rest omitted for brevity&lt;/span&gt;&lt;br/&gt;}&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;Running a DSL based query involves obtaining a &lt;i&gt;&lt;a href="https://github.com/infinispan/infinispan/blob/6.0.0.Beta1/query-dsl/src/main/java/org/infinispan/query/dsl/QueryFactory.java"&gt;QueryFactory&lt;/a&gt;&lt;/i&gt; from the (cache scoped) &lt;i&gt;SearchManager&lt;/i&gt; and then constructing the query as follows:&lt;br/&gt;&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.query.Search&lt;/span&gt;;&lt;br/&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.query.dsl.QueryFactory&lt;/span&gt;;&lt;br/&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.query.dsl.Query&lt;/span&gt;;&lt;br/&gt;.&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;.&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;QueryFactory&lt;/span&gt; qf &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Search&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getSearchManager(cache)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getQueryFactory();&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;Query&lt;/span&gt; q &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; qf&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;from(&lt;span style="color: #a08000;"&gt;User&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;class)&lt;br/&gt; .having(&lt;span style="color: #c03030;"&gt;"name"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;eq(&lt;span style="color: #c03030;"&gt;"John"&lt;/span&gt;)&lt;br/&gt; .toBuilder()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;build();&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;List&lt;/span&gt; list &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; q&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;list();&lt;br/&gt;&lt;br/&gt;assertEquals(&lt;span style="color: #0080a0;"&gt;1&lt;/span&gt;, list&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;size());&lt;br/&gt;assertEquals(&lt;span style="color: #c03030;"&gt;"John"&lt;/span&gt;, list&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;get(&lt;span style="color: #0080a0;"&gt;0&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getName());&lt;br/&gt;assertEquals(&lt;span style="color: #c03030;"&gt;"Doe"&lt;/span&gt;, list&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;get(&lt;span style="color: #0080a0;"&gt;0&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getSurname());&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;That's it! I'm sure this raised your curiosity as to what the DSL is actually capable of so you might want to look at the list of supported filter operators in &lt;i&gt;&lt;a href="https://github.com/infinispan/infinispan/blob/6.0.0.Beta1/query-dsl/src/main/java/org/infinispan/query/dsl/FilterConditionEndContext.java"&gt;FilterConditionEndContext&lt;/a&gt;&lt;/i&gt;. Combining multiple conditions with boolean operators, including sub-conditions, is also possible: &lt;br/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;span style="color: #a08000;"&gt;Query&lt;/span&gt; q &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; qf&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;from(&lt;span style="color: #a08000;"&gt;User&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;class)&lt;br/&gt; .having(&lt;span style="color: #c03030;"&gt;"name"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;eq(&lt;span style="color: #c03030;"&gt;"John"&lt;/span&gt;)&lt;br/&gt; .and()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;having(&lt;span style="color: #c03030;"&gt;"surname"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;eq(&lt;span style="color: #c03030;"&gt;"Doe"&lt;/span&gt;)&lt;br/&gt; .and()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;not(qf&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;having(&lt;span style="color: #c03030;"&gt;"address.street"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;like(&lt;span style="color: #c03030;"&gt;"%Tanzania%"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;or()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;having(&lt;span style="color: #c03030;"&gt;"address.postCode"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;in(&lt;span style="color: #c03030;"&gt;"TZ13"&lt;/span&gt;, &lt;span style="color: #c03030;"&gt;"TZ22"&lt;/span&gt;))&lt;br/&gt; .toBuilder()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;build();&lt;/pre&gt;&lt;br/&gt;The DSL is pretty nifty right now and will surely be expanded in the future based on your feedback. It also provides support for result pagination, sorting, projections, embedded objects, all demonstrated in &lt;i&gt;&lt;a href="https://github.com/infinispan/infinispan/blob/6.0.0.Beta1/query/src/test/java/org/infinispan/query/dsl/embedded/QueryDslConditionsTest.java"&gt;QueryDslConditionsTest&lt;/a&gt;&lt;/i&gt; which I encourage you to look at until the proper user guide is published. Still, this is not a relational database, so keep in mind that all queries are written in the scope of the &lt;i&gt;single&lt;/i&gt; targeted entity (and its embedded entities). There are no joins (yet), no correlated subqueries, no grouping or aggregations.&lt;br/&gt;&lt;br/&gt;Moving further, probably the most exciting thing about the new DSL is using it remotely via the Hot Rod client. But to make this leap we first had to adopt a common format for storing our cache entries and marshalling them over the wire that would also be cross-language and robust enough to support evolving object schemas. But probably most of all, this format had to have a schema rather than just being an opaque blob otherwise indexing and searching are meaningless. Enter Protocol Buffers.&lt;br/&gt;&lt;br/&gt;&lt;h3&gt;The Protobuf marshaller&lt;/h3&gt;&lt;br/&gt;Configuring the &lt;i&gt;RemoteCacheManager&lt;/i&gt; of the Java Hot Rod client to use it is straight forward:&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.client.hotrod.configuration.ConfigurationBuilder&lt;/span&gt;;&lt;br/&gt;.&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;.&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;ConfigurationBuilder&lt;/span&gt; clientBuilder &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #2060a0;"&gt;new&lt;/span&gt; &lt;span style="color: #a08000;"&gt;ConfigurationBuilder&lt;/span&gt;();&lt;br/&gt;clientBuilder&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;addServer()&lt;br/&gt; .host(&lt;span style="color: #c03030;"&gt;"127.0.0.1"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;port(&lt;span style="color: #0080a0;"&gt;11234&lt;/span&gt;)&lt;br/&gt; .marshaller(&lt;span style="color: #2060a0;"&gt;new&lt;/span&gt; &lt;span style="color: #a08000;"&gt;ProtoStreamMarshaller&lt;/span&gt;());&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;Now you'll be able to store and get from the remote cache your &lt;i&gt;User&lt;/i&gt; instaces encoded in protobuf format provided that:&lt;br/&gt;&lt;br/&gt;1. a Protobuf type was declared for your entity in a &lt;i&gt;.proto&lt;/i&gt; &lt;a href="https://github.com/infinispan/protostream/blob/1.0.0.Alpha6/sample-domain-definition/src/main/resources/bank.proto"&gt;file&lt;/a&gt; which was then compiled into a &lt;i&gt;.protobin &lt;/i&gt;&lt;a href="https://developers.google.com/protocol-buffers/docs/techniques?hl=ro#self-description"&gt;binary descriptor&lt;/a&gt;&lt;br/&gt;&lt;br/&gt;2. the binary descriptor was registered with your &lt;i&gt;RemoteCacheManager&lt;/i&gt;'s &lt;i&gt;ProtoStreamMarshaller&lt;/i&gt; instance like this:&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #a08000;"&gt;ProtoStreamMarshaller&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getSerializationContext(remoteCacheManager)&lt;br/&gt; .registerProtofile(&lt;span style="color: #c03030;"&gt;"my-test-schema.protobin"&lt;/span&gt;);&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;3. a per-entity marshaller was registered:&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #a08000;"&gt;ProtoStreamMarshaller&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getSerializationContext(remoteCacheManager)&lt;br/&gt; .registerMarshaller(&lt;span style="color: #a08000;"&gt;User&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;class, &lt;span style="color: #2060a0;"&gt;new&lt;/span&gt; &lt;span style="color: #a08000;"&gt;UserMarshaller&lt;/span&gt;());&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;Steps 2 and 3 are closely tied to the way &lt;a href="https://github.com/infinispan/protostream"&gt;Protosteam&lt;/a&gt; library works, which is pretty straight forward but cannot be detailed here. Having a look at our &lt;a href="https://github.com/infinispan/protostream/blob/1.0.0.Alpha6/sample-domain-implementation/src/main/java/org/infinispan/protostream/sampledomain/marshallers/UserMarshaller.java"&gt;&lt;i&gt;UserMarshaller&lt;/i&gt;&lt;/a&gt; sample should clear this up.&lt;br/&gt;&lt;br/&gt;Keeping your objects stored in protobuf format has the benefit of being able to consume them with compatible clients written in other languages. But if this does not sound enticing enough probably the fact they can now be easily indexed should be more appealing.&lt;br/&gt;&lt;br/&gt;&lt;h3&gt;Remote querying via the Hot Rod client&lt;/h3&gt;&lt;br/&gt;Given a &lt;i&gt;RemoteCacheManager&lt;/i&gt; configured as previously described the next steps to enable remote query over its caches are:&lt;br/&gt;&lt;br/&gt;1. add the DSL jar to client's classpath, infinispan-remote-query-server.jar to server's classpath and infinispan-remote-query-client.jar to both&lt;br/&gt;2. enable indexing in your cache configuration - same as for embedded mode&lt;br/&gt;3. register your protobuf binary descriptor by invoking the '&lt;i&gt;registerProtofile&lt;/i&gt;' method of the server's &lt;i&gt;ProtobufMetadataManager&lt;/i&gt; MBean (one instance per &lt;i&gt;EmbeddedCacheManager&lt;/i&gt;)&lt;br/&gt;&lt;br/&gt;All data placed in cache now is being indexed without the need to annotate your entities for Hibernate Search. In fact these classes are only meaningful to the Java client and do not even exist on the server.&lt;br/&gt;&lt;br/&gt;Running the queries over the Hot Rod client is now very similar to embedded mode. The DSL is in fact the same. The only part that is slightly different is how you obtain the &lt;i&gt;QueryFactory&lt;/i&gt;:&lt;br/&gt;&lt;br/&gt;&lt;i/&gt;&lt;br/&gt;&lt;pre style="background: #f1f1f1; color: black;"&gt;&lt;i&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.client.hotrod.Search&lt;/span&gt;;&lt;br/&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.query.dsl.QueryFactory&lt;/span&gt;;&lt;br/&gt;&lt;span style="color: #2060a0;"&gt;import&lt;/span&gt; &lt;span style="color: teal;"&gt;org.infinispan.query.dsl.Query&lt;/span&gt;;&lt;br/&gt;.&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;.&lt;br/&gt;&lt;br/&gt;remoteCache&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;put(&lt;span style="color: #0080a0;"&gt;2&lt;/span&gt;, &lt;span style="color: #2060a0;"&gt;new&lt;/span&gt; &lt;span style="color: #a08000;"&gt;User&lt;/span&gt;(&lt;span style="color: #c03030;"&gt;"John"&lt;/span&gt;, &lt;span style="color: #c03030;"&gt;"Doe"&lt;/span&gt;, &lt;span style="color: #0080a0;"&gt;33&lt;/span&gt;));&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;QueryFactory&lt;/span&gt; qf &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; &lt;span style="color: #a08000;"&gt;Search&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getQueryFactory(remoteCache);&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;Query&lt;/span&gt; query &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; qf&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;from(&lt;span style="color: #a08000;"&gt;User&lt;/span&gt;&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;class)&lt;br/&gt; .having(&lt;span style="color: #c03030;"&gt;"name"&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;eq(&lt;span style="color: #c03030;"&gt;"John"&lt;/span&gt;)&lt;br/&gt; .toBuilder()&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;build();&lt;br/&gt;&lt;br/&gt;&lt;span style="color: #a08000;"&gt;List&lt;/span&gt; list &lt;span style="color: #2060a0;"&gt;=&lt;/span&gt; query&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;list();&lt;br/&gt;assertEquals(&lt;span style="color: #0080a0;"&gt;1&lt;/span&gt;, list&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;size());&lt;br/&gt;assertEquals(&lt;span style="color: #c03030;"&gt;"John"&lt;/span&gt;, list&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;get(&lt;span style="color: #0080a0;"&gt;0&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getName());&lt;br/&gt;assertEquals(&lt;span style="color: #c03030;"&gt;"Doe"&lt;/span&gt;, list&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;get(&lt;span style="color: #0080a0;"&gt;0&lt;/span&gt;)&lt;span style="color: #2060a0;"&gt;.&lt;/span&gt;getSurname());&lt;/i&gt;&lt;/pre&gt;&lt;i/&gt;&lt;/div&gt;&lt;/p&gt;</p> <em>Posted by Adrian N</em> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>