<!DOCTYPE html> <html lang="en"> <head> <title> Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script crossorigin="anonymous" src="https://kit.fontawesome.com/4167a38cfa.js"></script> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <link href="/feed.atom" rel="alternate" type="application/atom+xml"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Wednesday, 23 November 2011 </h3> <h1> <a href="/blog/2011/11/23/more-on-transaction-performance/">More on transaction performance: use1PcForAutoCommitTransactions</a> </h1> <div class="content"> <div class="sect1"> <h2 id="_whats_use1pcforautocommittransactions_all_about"><a class="anchor" href="#_whats_use1pcforautocommittransactions_all_about"></a>What&#8217;s <em>use1PcForAutoCommitTransactions</em> all about?</h2> <div class="sectionbody"> <div class="paragraph"> <p>Don&#8217;t be scared the name, <em>use1PcForAutoCommitTransactions</em> is a new feature (5.1.CR1) that does quite a cool thing: increases your transactions&#8217;s performance. Let me explain. Before Infinispan 5.1 you could access the cache both transactional and non-transactional. Naturally the non-transactional access is faster and offers less consistency guarantees.But we don&#8217;t support mixed access in Infinispan 5.1, so what what&#8217;s to be done when you need the speed of non-transactional access and you are ready to trade some consistency guarantees for it? Well here is where <em>use1PcForAutoCommitTransactions</em> helps you. What is does is forces an induced (<em>autoCommit=true</em>) transaction to commit in a single phase. So only 1 RPC instead of 2RPCs as in the case of a full 2 Phase Commit (2PC).</p> </div> </div> </div> <div class="sect1"> <h2 id="_at_what_cost"><a class="anchor" href="#_at_what_cost"></a>At what cost?</h2> <div class="sectionbody"> <div class="paragraph"> <p>You might end up with inconsistent data if multiple transactions modify the same key concurrently. But if you know that&#8217;s not the case, or you can live with it then <em>use1PcForAutoCommitTransactions</em> will help your performance considerably.</p> </div> </div> </div> <div class="sect1"> <h2 id="_an_example"><a class="anchor" href="#_an_example"></a>An example</h2> <div class="sectionbody"> <div class="paragraph"> <p>Let&#8217;s say you do a simple put operation outside the scope of a transaction:</p> </div> <div class="paragraph"> <p>Now let&#8217;s see how this would behave if the cache has several different transaction configurations:</p> </div> <div class="sect2"> <h3 id="_not_using_1pc"><a class="anchor" href="#_not_using_1pc"></a>Not using 1PC&#8230;&#8203;</h3> <div class="paragraph"> <p>The put will happen in two RPCs/steps: a prepare message is sent around and then a commit.</p> </div> </div> <div class="sect2"> <h3 id="_using_1pc"><a class="anchor" href="#_using_1pc"></a>Using 1PC&#8230;&#8203;</h3> <div class="paragraph"> <p>The put happens in one RPC as the prepare and the commit are merged. Better performance.</p> </div> </div> <div class="sect2"> <h3 id="_not_using_autocommit"><a class="anchor" href="#_not_using_autocommit"></a>Not using autoCommit</h3> <div class="paragraph"> <p>An exception is thrown, as this is a transactional cache and invocations must happen within the scope of a transaction.</p> </div> <div class="paragraph"> <p>Enjoy! Mircea</p> </div> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Tuesday, 22 November 2011 </h3> <h1> <a href="/blog/2011/11/22/infinispan-510beta5-is-out/">Infinispan 5.1.0.BETA5 is out!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan 5.1.0.BETA5 has just been the released with a few interesting additions and important fixes:</p> </div> <div class="ulist"> <ul> <li> <p>Locks acquired within a transaction are now reordered in order to avoid deadlocks. There&#8217;s no new configuration required to take advantage of this feature. More information on how lock reordering works can be found <a href="http://community.jboss.org/docs/DOC-16975">here</a>.</p> </li> <li> <p>One of the aims of Infinispan 5.1 'Brahma' series is to move away from JAXB and instead use Stax based XML parsing. Ahead of that, a new configuration API based on builders has been developed. Expect to hear more about it and examples on using the API in the next few days.</p> </li> </ul> </div> <div class="paragraph"> <p>Amongst the fixes included in this release, it&#8217;s worth mentioning:</p> </div> <div class="ulist"> <ul> <li> <p>The demo paths that were broken in 5.1.0.BETA4 have now been fixed.</p> </li> <li> <p>Some of the Infinispan jars in 5.1.0.BETA4 were showing duplicate classes. This was the result of an OSGI bundle generation bug, and so to avoid the issue 5.1.0.BETA5 OSGI bundle generation has been disabled. This functionality will be re-enabled once the issue has been fixed by the Maven Felix plugin.</p> </li> </ul> </div> <div class="paragraph"> <p>As always, please keep the <a href="http://community.jboss.org/en/infinispan?view=discussions">feedback</a> coming. You can <a href="http://www.jboss.org/infinispan/downloads">download</a> the release from here and you get further details on the issues addressed in the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12318502">changelog</a>.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Friday, 11 November 2011 </h3> <h1> <a href="/blog/2011/11/11/some-worth-mentioning-improvements-for/">Some worth mentioning improvements for pessimistic transactions</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Pessimistic transactions were added in 5.1 and are the "rebranding" of eager transactions from previous Infinispan releases. But besides the re-branding, the code also brought some worth mentioning performance optimisation:</p> </div> <div class="ulist"> <ul> <li> <p>a single RPC happens for acquiring lock on a key, disregarding the number of invocations. So if you call <em>cache.put(k,v)</em> in a loop, within the scope of the same transaction, there is only one remote call to the owner of <em>k</em>.</p> </li> <li> <p>if the key you want to lock/write maps to the local node then no remote locks are acquired. In other words there won&#8217;t be any RPCs for writing to a key that maps locally. This can be very powerful used in conjunction with the <a href="https://docs.jboss.org/author/x/IwY5">KeyAffinityService</a>, as it allows you to control the locality of you keys.</p> </li> <li> <p>during the two phase commit (2PC), the prepare phase doesn&#8217;t perform any RPCs: this optimisation is based on the fact locks are already acquired on each write. This means that then number of RPCs during transactions lifespan is reduced with 1.</p> </li> <li> <p>for some writes to the cache (e..g <em>cache.put(k,v)</em>) two RPCs were performed: one to acquire the remote lock and one to fetch the previous value. The obvious optimisation in this case was to make a single RPC for both operations - which we do starting with 5.1.</p> </li> </ul> </div> <div class="paragraph"> <p>Enjoy!</p> </div> <div class="paragraph"> <p>Mircea</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Thursday, 10 November 2011 </h3> <h1> <a href="/blog/2011/11/10/fewer-deadlocks-higher-throughput/">Fewer deadlocks, higher throughput</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Here&#8217;s the problem: first transaction (<em>T1</em>) writes to key a and b in this order. Second transaction (<em>T2</em>) writes to key b and a - again order is relevant. Now with some "right timing" <em>T1</em> manages to acquire lock on <em>a</em> and <em>T2</em> acquires lock on b. And then they wait one for the other to release locks so that they can progress. This is what is called a deadlock and is really bad for your system throughput - but I won&#8217;t insist on this aspect, as I&#8217;ve mentioned it a lot in my previous posts.</p> </div> <div class="paragraph"> <p>What I want to talk about though is a way to solve this problem. Quit a simple way - just force an order on your transaction writes and you&#8217;re guaranteed not to deadlock: if both <em>T1</em> and <em>T2</em> write to a then <em>b (</em>lexicographical order) there won&#8217;t be any deadlock. Ever.</p> </div> <div class="paragraph"> <p>But there&#8217;s a catch. It&#8217;s not always possible to define this order, simply because you can&#8217;t or because you don&#8217;t know all your keys at the very beginning of the transaction.</p> </div> <div class="paragraph"> <p>Now here&#8217;s the good news: Infinispan orders the keys touched in a transaction for you. And it even defines an order so that you won&#8217;t have to do that. Actually you don&#8217;t have to anything, not even enable this feature, as it is already enabled for you by default.</p> </div> <div class="paragraph"> <p>Does it sound too good to be true? That&#8217;s because it&#8217;s only partially true. That is lock reordering only works if you&#8217;re using optimistic locking. For pessimistic locking you still have to do it the old way - order your locks (that&#8217;s of course if you can).</p> </div> <div class="paragraph"> <p>Wanna know more about it? Read <a href="http://community.jboss.org/wiki/LockReorderingForAvoidingDeadlocks">this</a>.</p> </div> <div class="paragraph"> <p>Expect and enjoy this feature in our next release 5.1.0.BETA5.</p> </div> <div class="paragraph"> <p>Stay tunned!</p> </div> <div class="paragraph"> <p>Mircea</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 09 November 2011 </h3> <h1> <a href="/blog/2011/11/09/single-lock-owner-important-step/">Single lock owner: an important step forward</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The single lock owner is a highly requested Infinispan improvement. The basic idea behind it is that, when writing to a key, locks are no longer acquired on all the nodes that own that key, but only on a single designated node (named "main owner").</p> </div> </div> </div> <div class="sect1"> <h2 id="_how_does_it_help_me"><a class="anchor" href="#_how_does_it_help_me"></a>How does it help me?</h2> <div class="sectionbody"> <div class="paragraph"> <p>Short version: if you use transactions that concurrently write to the same keys, this improvement significantly increases your system' throughput.</p> </div> <div class="paragraph"> <p>Long version: If you&#8217;re using Infinispan with transactions that modify the same key(s) concurrently then you can easily end up in a deadlock. A deadlock can also occur if two transaction modify the same key at the same time - which is both inefficient and counter-intuitive. Such a deadlock means that at one transaction(or both) eventually rollback but also the lock on the key is held for the duration of a lockAquistionTimout config option (defaults to 10 seconds). These deadlocks reduces the throughput significantly as transactions threads are held inactive during deadlock time. On top of that, other transactions that want to operate on that key are also delayed, potentially resulting in a cascade effect.</p> </div> </div> </div> <div class="sect1"> <h2 id="_whats_the_added_performance_penalty"><a class="anchor" href="#_whats_the_added_performance_penalty"></a>What&#8217;s the added performance penalty?</h2> <div class="sectionbody"> <div class="paragraph"> <p>The only encountered performance penalty is during cluster topology changes. At that point the cluster needs to perform some additional computation (no RPC involved) to fail-over the acquired locks from previous to new owners. Another noticeable aspect is that locks are now being released asynchronously, after the transaction commits. This doesn&#8217;t add any burden to the transaction duration, but it means that locks are being held slightly longer. That&#8217;s not something to be concerned about if you&#8217;re not using transactions that compete for same locks though. We plan to benchmark this feature using <a href="http://radargun.sourceforge.net/">Radargun</a> benchmark tool - we&#8217;ll report back!</p> </div> </div> </div> <div class="sect1"> <h2 id="_want_to_know_more"><a class="anchor" href="#_want_to_know_more"></a>Want to know more?</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can read the <a href="http://community.jboss.org/wiki/SingleNodeLockingModel">single lock owner design wiki</a> or/and follow the JIRA <a href="https://issues.jboss.org/browse/ISPN-1137">JIRA</a> discussions.</p> </div> </div> </div> </div> <hr> <div class="pagination-links"><a href="/blog/page/84/" class="previous-link">Previous</a> <a href="/blog/" class="page-link">1</a> <a href="/blog/page/2/" class="page-link">2</a> <span class="skip">...</span><a href="/blog/page/84/" class="page-link">84</a> <span class="current-page">85</span> <a href="/blog/page/86/" class="page-link">86</a> <span class="skip">...</span><a href="/blog/page/112/" class="page-link">112</a> <a href="/blog/page/113/" class="page-link">113</a> <a href="/blog/page/86/" class="next-link">Next</a> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>