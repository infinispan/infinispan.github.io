<!DOCTYPE html> <html lang="en"> <head> <title> Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script crossorigin="anonymous" src="https://kit.fontawesome.com/4167a38cfa.js"></script> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <link href="/feed.atom" rel="alternate" type="application/atom+xml"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Wednesday, 19 November 2014 </h3> <h1> <a href="/blog/2014/11/19/infinispan-702final-released/">Infinispan 7.0.2.Final released!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear community,</p> </div> <div class="paragraph"> <p>Infinispan 7.0.2.Final is now available!</p> </div> <div class="paragraph"> <p>This release removes duplication from the service lookup metadata. Please consult the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12326259">release notes</a> for details.</p> </div> <div class="paragraph"> <p>Thanks to everyone involved in this release! </p> </div> <div class="paragraph"> <p>Visit our <a href="http://infinispan.org/hotrod-clients/">downloads</a> section to find the latest release. If you have any questions please check our <a href="http://infinispan.org/community/">forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or ping us directly on <a href="irc://irc.freenode.org/infinispan">IRC</a>.</p> </div> </div> </div> </div> <em>Posted by Ion Savin on 2014-11-19</em> <br> <em>Tags:</em> <a href="/blog/tags/ release/"> release </a> <a href="/blog/tags/final/"> final </a> <hr> <div class="post"></div> <h3> Monday, 17 November 2014 </h3> <h1> <a href="/blog/2014/11/17/infinispan-701final-released/">Infinispan 7.0.1.Final released!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear community,</p> </div> <div class="paragraph"> <p>Infinispan 7.0.1.Final is now available!</p> </div> <div class="paragraph"> <p>This is a bug-fix release and contains query performance improvements. For the complete list of changes please consult the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12326035">release notes.</a></p> </div> <div class="paragraph"> <p>Thanks to everyone involved in this release! </p> </div> <div class="paragraph"> <p>Visit our <a href="http://infinispan.org/hotrod-clients/">downloads</a> section to find the latest release. If you have any questions please check our <a href="http://infinispan.org/community/">forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or ping us directly on <a href="irc://irc.freenode.org/infinispan">IRC</a>.</p> </div> </div> </div> </div> <em>Posted by Ion Savin on 2014-11-17</em> <br> <em>Tags:</em> <a href="/blog/tags/release/"> release </a> <a href="/blog/tags/final/"> final </a> <hr> <div class="post"></div> <h3> Tuesday, 04 November 2014 </h3> <h1> <a href="/blog/2014/11/04/why-doesnt-mapsize-return-size-of/">Why doesn't Map.size return the size of the entire cluster?</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Many people may have been surprised the first time they used Map.size method on a distributed Infinispan cluster.  As was later deduced only the local node size is returned.</p> </div> <div class="paragraph"> <p>Infinispan had taken this approach to limit the chance that instead of getting the full cluster size you would receive an OutOfMemoryError.  This seems fair to return the local answer only but you secretly always wanted the entire cluster size.</p> </div> <div class="paragraph"> <p>For the <a href="http://blog.infinispan.org/2014/11/infinispan-700final-is-out.html">Infinispan 7.0.0.Final release</a> forget what you know when using the Map interface with Infinispan.</p> </div> <div class="paragraph"> <p>==</p> </div> </div> </div> <div class="sect1"> <h2 id="_enter_distributed_entry_iterator"><a class="anchor" href="#_enter_distributed_entry_iterator"></a>Enter Distributed Entry Iterator</h2> <div class="sectionbody"> <div class="paragraph"> <p>We already announced this feature a while back at <a href="http://blog.infinispan.org/2014/05/iterate-all-entries-in-cache.html. " class="bare">http://blog.infinispan.org/2014/05/iterate-all-entries-in-cache.html. </a> You can check it out for more details but it is essentially a memory efficient way of retrieving all the entries in the cache by iterating over them.</p> </div> <div class="paragraph"> <p>This has opened the way to implementing the various bulk methods on the Map interface that we could never do efficiently in the past (ie. Map.size, Map.keySet, Map.entrySet &amp; Map.values).</p> </div> </div> </div> <div class="sect1"> <h2 id="_map_size"><a class="anchor" href="#_map_size"></a>Map size</h2> <div class="sectionbody"> <div class="paragraph"> <p>Okay I admit, size could have been done more efficiently before, but the answer would have contained a very high margin of error.  Now size will give you a size value with consistency semantics just slightly less than ConcurrentHashMap does, but for the entire cluster.  Warning should be given that size may be slower for larger clusters or ones with a lot of data in a stored cache loader.</p> </div> <div class="paragraph"> <p>The size method behavior can be controlled by using a supplied <a href="https://docs.jboss.org/infinispan/7.0/apidocs/org/infinispan/AdvancedCache.html#withFlags%28org.infinispan.context.Flag&#8230;&#8203;%29">Flag</a> such as SKIP_CACHE_LOAD to not count any configured cache loaders or CACHE_MODE_LOCAL if you want the local count only.  These flags are not exclusive and can be both passed if desired as well.</p> </div> <div class="paragraph"> <p>==</p> </div> </div> </div> <div class="sect1"> <h2 id="_map_collection_views"><a class="anchor" href="#_map_collection_views"></a>Map Collection Views</h2> <div class="sectionbody"> <div class="paragraph"> <p>In the past the Map.values, Map.keySet &amp; Map.entrySet methods were only ever in memory copies of the local data at the time they were invoked, similar to Map.size.</p> </div> <div class="paragraph"> <p>Now these collection views will be cluster wide and an additionally will show updated contents when the cache is updated and your writes to the collection will be reflected in the Cache itself!  The only operations you can&#8217;t do on these collections are adding values to either the keySet or values collections as they aren&#8217;t key/value pairs.</p> </div> <div class="paragraph"> <p>If your cache was configured with a Flag such as SKIP_CACHE_LOAD or CACHE_MODE_LOCAL it will also be reflected in the collection view for both reads and writes.</p> </div> <div class="paragraph"> <p>Some caution is advised when using toArray, retainAll, or size methods as they will require full iteration to complete.</p> </div> <div class="paragraph"> <p><strong>KeySet Optimization</strong></p> </div> <div class="paragraph"> <p>The key set collection also has an optimization so it will never pull down the values so it has a lower network and serialization/deserialization overhead (unlike entrySet and values).</p> </div> </div> </div> <div class="sect1"> <h2 id="_transactionality"><a class="anchor" href="#_transactionality"></a>Transactionality</h2> <div class="sectionbody"> <div class="paragraph"> <p>All of the aforementioned methods still support transactions in a way that you would expect.  There is one guarantee we don&#8217;t provide and that is when using REPEATABLE_READ isolation.  We will not store entries read from an iterator in the transactional context as this could very easily run your local node out of memory with a large enough data set.</p> </div> <div class="paragraph"> <p>For reference methods that use an iterator internally are toArray, retainAll, isEmpty &amp; size on the various collections as well as contains and containsAll on the values collection.</p> </div> </div> </div> <div class="sect1"> <h2 id="_other_api_changes"><a class="anchor" href="#_other_api_changes"></a>Other API Changes</h2> <div class="sectionbody"> <div class="paragraph"> <p>These changes have also loosened some restrictions on other methods as well.</p> </div> <div class="sect2"> <h3 id="_map_isempty"><a class="anchor" href="#_map_isempty"></a>Map.isEmpty</h3> <div class="paragraph"> <p>This method before was only used locally as it used to calculate the size to determine if it was empty.  This method will now use the entry iterator and returns as soon as it finds that even a single value exists.  This is an important change as the old implementation would have to query any configured Cache Loader&#8217;s complete size before returning.</p> </div> </div> <div class="sect2"> <h3 id="_map_containsvalue"><a class="anchor" href="#_map_containsvalue"></a>Map.containsValue</h3> <div class="paragraph"> <p>We never supported this method before (not even locally).  This method will now use the iterator though and if it finds the value at any point point will return immediately so it doesn&#8217;t have to iterate over the entire contents unless they don&#8217;t exist.  However if you really want to do this operation often you should really use <a href="http://infinispan.org/docs/7.0.x/user_guide/user_guide.html#sid-68355061">Indexing</a> to make this faster.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_code_examples"><a class="anchor" href="#_code_examples"></a>Code Examples</h2> <div class="sectionbody"> <div class="paragraph"> <p>I could put an example here, but I think some could take it as insult.  You have already seen 100&#8217;s of examples as to how to use the Map interface and now in Infinispan you can use those in the exact same way and they will work just how you would expect them to.</p> </div> </div> </div> </div> <em>Posted by Unknown on 2014-11-04</em> <br> <em>Tags:</em> <hr> <div class="post"></div> <h3> Tuesday, 04 November 2014 </h3> <h1> <a href="/blog/2014/11/04/infinispan-700final-is-out/">Infinispan 7.0.0.Final is out!!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Hi all,</p> </div> <div class="paragraph"> <p>We are really proud to announce the release of <strong>Infinispan 7.0.0.Final</strong>!!</p> </div> <div class="paragraph"> <p>This is the culmination of several months of development which has focused on on Security, Cluster Partition handling, JSR-107 JCache 1.0.0 support, Clustered Listeners, Remote Events, Query improvements and brand new XML configuration.</p> </div> <div class="paragraph"> <p>To mark the occasion, the team has prepared a <a href="http://infinispan.org/infinispan-7.0/"><strong>thorough release notes page</strong></a> highlighting all the major features and enhancements implemented in Infinispan 7.0 series.</p> </div> <div class="paragraph"> <p>The Infinispan team would like to recognise all the community members that have contributed to this release, in no particular order:</p> </div> <div class="ulist"> <ul> <li> <p><strong>Radim Vansa</strong> for his <a href="http://blog.infinispan.org/2014/10/soft-index-file-store.html">Soft-Index File Store</a> and many more enhancements and fixes</p> </li> <li> <p><strong>Takayoshi Kimura</strong> for fixes such as <a href="http://issues.jboss.org/browse/ISPN-3752">ISPN-3752</a>, <a href="https://issues.jboss.org/browse/ISPN-4476">ISPN-4476</a> and <a href="https://issues.jboss.org/browse/ISPN-4477">ISPN-4477</a></p> </li> <li> <p><strong>Jiri Holusa</strong> for his tremendous work to improve our test coverage work and fixing issues like <a href="https://issues.jboss.org/browse/ISPN-3442">ISPN-3442</a> </p> </li> <li> <p><strong>Karl von Randow</strong> for his documentation fixes, init.d fixes in <a href="https://issues.jboss.org/browse/ISPN-4141">ISPN-4141</a> and enhancements to putForExternalRead method as part of <a href="https://issues.jboss.org/browse/ISPN-3792">ISPN-3792</a></p> </li> <li> <p><strong>Jakub Markos</strong> for his work to optimise the Infinispan Server testsuite in <a href="https://issues.jboss.org/browse/ISPN-4317">ISPN-4317</a> and many fixes and test suite enhancements</p> </li> <li> <p><strong>Michal Linhard</strong> fox his <a href="https://issues.jboss.org/browse/ISPN-3750">ISPN-3750</a> fix</p> </li> <li> <p><strong>Vitalii Chepeliuk</strong> for his work on extending test coverage and fixes such as <a href="https://issues.jboss.org/browse/ISPN-3880">ISPN-3880</a></p> </li> <li> <p><strong>Wolf Dieter-Fink</strong> for fixes such as <a href="https://issues.jboss.org/browse/ISPN-3916">ISPN-3916</a> and <a href="https://issues.jboss.org/browse/ISPN-3912">ISPN-3912</a></p> </li> <li> <p><strong>Vojtech Juranek</strong> for his continued work to improve Infinispan with fixes such as <a href="https://issues.jboss.org/browse/ISPN-4072">ISPN-4072</a> and his work to increase the test coverage</p> </li> <li> <p><strong>Martin Gencur</strong> for the many issues he fixed including <a href="https://issues.jboss.org/browse/ISPN-3771">ISPN-3771</a>, <a href="https://issues.jboss.org/browse/ISPN-4499">ISPN-4499</a> and others&#8230;&#8203;</p> </li> <li> <p><strong>Norman Maurer</strong> for porting Infinispan Servers to use <a href="http://netty.io/">Netty 4</a></p> </li> <li> <p><strong>Alan Field</strong> for fixes such as <a href="https://issues.jboss.org/browse/ISPN-4645">ISPN-4645</a> and <a href="https://issues.jboss.org/browse/ISPN-4376">ISPN-4376</a></p> </li> <li> <p><strong>Tomáš Sýkora</strong> for fixes such as <a href="https://issues.jboss.org/browse/ISPN-3136">ISPN-3136</a> and <a href="https://issues.jboss.org/browse/ISPN-4076">ISPN-4076</a>, and improved test coverage</p> </li> <li> <p><strong>Paul Ferraro</strong> for many fixes including fixes such as <a href="https://issues.jboss.org/browse/ISPN-4375">ISPN-4375</a> and <a href="https://issues.jboss.org/browse/ISPN-4374">ISPN-4374</a></p> </li> <li> <p><strong>Nicolas Filotto</strong> for his <a href="https://issues.jboss.org/browse/ISPN-3689">ISPN-3689</a> fix</p> </li> <li> <p><strong>Rajesh Jangam</strong> for his <a href="https://issues.jboss.org/browse/ISPN-3877">ISPN-3877</a> and <a href="https://issues.jboss.org/browse/ISPN-3894">ISPN-3894</a> fixes</p> </li> <li> <p><strong>Brett Meyer</strong> for his amazing work to get Infinispan working in OSGI environments as part of <a href="https://issues.jboss.org/browse/ISPN-800">ISPN-800</a> and many related fixes</p> </li> <li> <p><strong>Radoslav Husar</strong> for his several fixes</p> </li> <li> <p><strong>Sebastian Łaskawiec</strong> for his work to improve our CDI integration and moving to Jackson for JSON</p> </li> <li> <p><strong>Karsten Blees</strong> for his LIRS eviction fixes</p> </li> <li> <p><strong>Niels Bertramn</strong> for his <a href="https://issues.jboss.org/browse/ISPN-4679">ISPN-4679</a> fix</p> </li> <li> <p><strong>Duncan Doyle</strong> for his work on <a href="https://issues.jboss.org/browse/ISPN-4637">ISPN-4637</a></p> </li> <li> <p><strong>Emmanuel Bernard</strong> for his documentation improvements</p> </li> <li> <p><strong>Gabriel Francisco</strong> for his work to revamp the Mongo DB cache store</p> </li> <li> <p><strong>Bilgin Ibryam</strong> for his OSGI fixes</p> </li> <li> <p><strong>Erik Salter</strong> for his work on orphaned transactions and fixes such as <a href="https://issues.jboss.org/browse/ISPN-4872">ISPN-4872</a></p> </li> </ul> </div> <div class="paragraph"> <p>Thanks to all contributors for your amazing work and effort! We hope you carry on contributing in future releases.</p> </div> <div class="paragraph"> <p>Finally, during the Infinispan 7.0 series, Gustavo Fernandes has joined the team making outstanding contributions in our Query project, and Tristan Tarrant has joined the team full time taking on Infinispan&#8217;s Security layer. Thanks to both!!</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <em>Posted by Galder Zamarreño on 2014-11-04</em> <br> <em>Tags:</em> <a href="/blog/tags/release/"> release </a> <a href="/blog/tags/final/"> final </a> <hr> <div class="post"></div> <h3> Friday, 31 October 2014 </h3> <h1> <a href="/blog/2014/10/31/soft-index-file-store/">Soft-Index File Store</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Recently, Infinispan got a new local file-based cache store, called Soft-Index File Store. Why have we created just another cache store, what problems is it solving, what are its limitations and how is it designed?</p> </div> <div class="ulist"> <ul> <li> <p>Single File Store is a well performing cache store, but it stores all keys in-memory; that limits the number of keys you can store. File fragmentation could be even more of an issue: if you store larger and larger values (that happens quite a lot, as users e.g. add stuff into their shopping carts), the space is not reused and instead the entry is appended at the end of the file. The space (now empty) is reused only if you write entry that can fit there. Also, even if you remove all entries from the cache, the file won&#8217;t shrink, and neither won&#8217;t be de-fragmented.</p> </li> </ul> </div> <div class="paragraph"> <p>LevelDB uses quite well performing Google&#8217;s library written in native code. The major drawback is the native code - if LevelDB has a bug that ends in segfault, whole JVM crashes, bringing you application server down.</p> </div> <div class="paragraph"> <p>Our new Soft Index File Store is pure Java implementation that tries to get around Single File Store&#8217;s drawbacks by implementing a variant of <strong>B+ tree</strong> that is cached in-memory using Java&#8217;s <strong>soft references</strong> - here&#8217;s where the name Soft Index File Store comes from. This B+ tree (called Index) is offloaded on filesystem to single file: in fact, this has theoretically similar problems with fragmentation as Single File Store - but in practice it shouldn&#8217;t cause such problems. This index file does not need to be persisted - it is purged and rebuilt when the cache store restarts, its purpose is only offloading.</p> </div> <div class="paragraph"> <p>The data that should be persisted are stored in a set of files that are written in append-only way - that means that if you store this on conventional magnetic disk, it does not have to seek when writing a burst of entries. It is not stored in a single file but in a set of files. When any of these files drops below 50% of usage (the entries are marked as removed or overwritten), the file starts being collected, moving live entries into another file and in the end removing the old file from disk.</p> </div> <div class="paragraph"> <p>Most of the in-memory structures in Soft Index File Store are bounded, therefore you don&#8217;t have to be afraid of OOMEs. You can also configure the limits for concurrently open files as well (so that you don&#8217;t run out of file descriptors).</p> </div> </div> </div> <div class="sect1"> <h2 id="_how_to_configure_sifs"><a class="anchor" href="#_how_to_configure_sifs"></a>How to configure SIFS</h2> <div class="sectionbody"> <div class="paragraph"> <p>The configuration is no different from regular cache store:</p> </div> </div> </div> <div class="sect1"> <h2 id="_implementation_details"><a class="anchor" href="#_implementation_details"></a>Implementation details</h2> <div class="sectionbody"> <div class="paragraph"> <p>The Index does not use single file, in fact it can be split into multiple segments. That&#8217;s because the algorithm updating this B+ tree is designed as single writer - multiple readers, but that could make the writer thread (called 'Index Updater') the bottleneck. Therefore, you can set how many segments should the Index be split into (according to keys' hashCode()).</p> </div> <div class="paragraph"> <p>Each node in the Index stores 'prefix' of all keys (or rather the serialized forms) used in the node in order to reduce the space required for the node. This comes with the assumption that the prefixes are often similar (e.g. when you use key "user000001" and "user000002"). If you can change how the keys are serialized, it is encouraged to move the changing part of the key to the end of the serialized data.</p> </div> <div class="paragraph"> <p>The data are written by single thread as well, the 'Log Appender'. There&#8217;s no reason to let threads that access the cache store compete over file-system - Log Appender queues the write results, writes them into the file and wakes up the waiting thread. There are 2 possibly unnecessary context-switches, but in the original design we wanted to allow the write request to return only after the data have been fsynced. By batching the writes, Log Appender allows this as a configuration option - then you can be sure that the data are already on disk when the call returns.</p> </div> <div class="paragraph"> <p>When the entry is modified, the Index needs to be updated. The request is sent to Index Updater via bounded queue and the newest entry location is stored in Temporary Table until this is stored in the Index. The updated nodes are eventually offloaded onto disk in this way.</p> </div> </div> </div> <div class="sect1"> <h2 id="_known_limitations"><a class="anchor" href="#_known_limitations"></a>Known limitations</h2> <div class="sectionbody"> <div class="paragraph"> <p>Size of a node in the Index is limited, by default it is 4096 bytes, though it can be configured. This size also limits the key length (or rather the length of the serialized form): you can&#8217;t use keys longer than size of the node - 15 bytes. Moreover, the key length is stored as 'short', limiting it to 32767 bytes. There&#8217;s no way how you can use longer keys - SIFS throws an exception when the key is longer after serialization.</p> </div> <div class="paragraph"> <p>When entries are stored with expiration, SIFS does not discover the a file is full of expired entries and the compaction of old data files may not be started ever (method AdvancedStore.purgeExpired() is not implemented). This can lead to excessive file-system space usage.</p> </div> </div> </div> <div class="sect1"> <h2 id="_future_work"><a class="anchor" href="#_future_work"></a>Future work</h2> <div class="sectionbody"> <div class="paragraph"> <p>What we need to do know is to benchmark SIFS in many configurations and set the optimal values as defaults. However, we run mostly synthetic benchmarks - and that&#8217;s where you can help. Let&#8217;s play with Soft Index File Store a bit and tell us what configuration works best for you!</p> </div> <div class="paragraph"> <p>For storing large keys, building the B+ tree of hashCodes could perform better that storing the whole keys, though it would need additional handling for collisions. Tell us what keys do you use, please!</p> </div> <div class="paragraph"> <p>Currently, each index update needs to be eventually stored, and that means one or more writes into the file-system even when this is not necessary. In the future, we might try to use phantom references instead of soft references to write the Index only when it needs to release some memory. However, this requires a lot of further work, so test SIFS today and let us now how do you like it!</p> </div> </div> </div> </div> <em>Posted by Unknown on 2014-10-31</em> <br> <em>Tags:</em> <hr> <div class="pagination-links"><a href="/blog/page/54/" class="previous-link">Previous</a> <a href="/blog/" class="page-link">1</a> <a href="/blog/page/2/" class="page-link">2</a> <span class="skip">...</span><a href="/blog/page/54/" class="page-link">54</a> <span class="current-page">55</span> <a href="/blog/page/56/" class="page-link">56</a> <span class="skip">...</span><a href="/blog/page/113/" class="page-link">113</a> <a href="/blog/page/114/" class="page-link">114</a> <a href="/blog/page/56/" class="next-link">Next</a> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://infinispan.org/blog/" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>