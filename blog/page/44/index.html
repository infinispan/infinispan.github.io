<!DOCTYPE html> <html lang="en"> <head> <title>Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Monday, 14 September 2015 </h3> <h1> <a href="/blog/2015/09/14/new-redis-cache-store-introduced-in/">New Redis Cache Store Introduced in Infinispan 8</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>A new cache store for storage of cache data within the Redis key/value server has been introduced with Infinispan 8. This allows all storage of cache data to be stored in a centralised Redis deployment which all Infinispan clients access.</p> </div> <div class="paragraph"> <p>The cache store supports 3 Redis deployment topologies. They are, single server, Sentinel and cluster (Redis v3 required). Redis versions 2.8+ and 3.0+ are currently supported.</p> </div> <div class="paragraph"> <p>Data expiration and purging is handled via Redis itself, reducing workload from Infinispan servers to manually delete cache entries.</p> </div> </div> </div> <div class="sect1"> <h2 id="_topologies"><a class="anchor" href="#_topologies"></a><strong>Topologies</strong></h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_single_server"><a class="anchor" href="#_single_server"></a><strong>Single Server</strong></h3> <div class="paragraph"> <p>In a single server deployment, the cache store is given the location of a Redis master server with which it connects to directly to handle all data storage. Using this topology, Redis has no fault tolerance unless a custom solution is built on top of Redis. To declare a single server local cache store:</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="server" socket-timeout="10000" connection-timeout="10000"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> <div class="paragraph"> <p>Note the topology attribute is declared as <strong>server</strong>. This is needed to ensure a single server Redis topology is applied by the cache store. Only a single Redis server need be declared (only the first server will be used if multiple servers are declared) and the port will default to the Redis port 6379, but can be overridden using the port attribute. All connections are handled via a connection pool, which can optionally also test the validity of a connection on creation, lease, return from and when idling in the connection the pool.</p> </div> </div> <div class="sect2"> <h3 id="_sentinel"><a class="anchor" href="#_sentinel"></a><strong>Sentinel</strong></h3> <div class="paragraph"> <p>The Sentinel topology relies on Redis Sentinel servers to connect to a Redis master server. Here, Infinispan connects to Redis Sentinel servers, requesting a master server name, then gets forwarded on to the correct location of the Redis master server. This topology gives resilience via Redis Sentinel, providing failure detection and automatic failover of Redis servers.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="sentinel" master-name="mymaster" socket-timeout="10000" connection-timeout="10000"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server2" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server3" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> <div class="paragraph"> <p>For a Sentinel deployment, the topology attribute changes to <strong>sentinel</strong>. A master name must also be specified to select the correct Redis master required as Sentinel can monitor multiple Redis master servers. The Sentinel server is declared using a sentinel-server XML tag, which you’ll notice is different to the main Redis servers used in single server and cluster topologies. This is to allow defaulting of the Sentinel port to 26379 if not declared. At least one Sentinel server must be declared, though if you run more Sentinel servers, they should all be declared too for the benefit of failure detection of the Sentinel servers themselves.</p> </div> </div> <div class="sect2"> <h3 id="_cluster"><a class="anchor" href="#_cluster"></a><strong>Cluster</strong></h3> <div class="paragraph"> <p>A cluster topology gives Infinispan the ability to connect to a Redis cluster. One or more cluster nodes are declared to infinispan (the more the better) which are then used to store all data. Redis cluster supports failure detection so if a master node in the cluster fails, a slave takes over. Redis v3 is required to run a Redis cluster.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="cluster" socket-timeout="10000" connection-timeout="10000"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server1" port="6379" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server2" port="6379" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server3" port="6379" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> <div class="paragraph"> <p>For cluster deployments, the topology attribute must change to <strong>cluster.</strong> One or more Redis cluster nodes must be declared to access the cluster which uses the redis-server XML tag. Note that when operating a cluster, database IDs are not supported.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_multiple_cache_stores_single_redis_deployment"><a class="anchor" href="#_multiple_cache_stores_single_redis_deployment"></a><strong>Multiple Cache Stores, Single Redis Deployment</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>Redis single server and Sentinel deployments support the option of database IDs. A database ID allows a single Redis server to host multiple individual databases, referenced via an integer ID number. This allows Infinispan to support multiple cache stores on the same Redis deployment, isolating the data between the stores. Redis cluster does not support the database ID. A database ID is defined using the database attribute on the redis-store XML tag.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="sentinel" master-name="mymaster" socket-timeout="10000" connection-timeout="10000" database="5"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server2" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server3" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> </div> </div> <div class="sect1"> <h2 id="_redis_password_authentication"><a class="anchor" href="#_redis_password_authentication"></a><strong>Redis Password Authentication</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>In order to secure access to a Redis server, a password can optionally be used in Redis. This then requires the cache store to declare the password when connecting. The password is added via a password attribute on the redis-store XML tag.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="sentinel" master-name="mymaster" socket-timeout="10000" connection-timeout="10000" password="mysecret"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server2" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server3" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> </div> </div> <div class="sect1"> <h2 id="_what_about_ssl_support"><a class="anchor" href="#_what_about_ssl_support"></a><strong>What about SSL support?</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>Redis does not provide protocol encryption, instead leaving this to other specialist software. At this time, the Redis client used to integrate Infinispan with Redis servers (Jedis) does not yet support SSL connection negotiation natively.</p> </div> <div class="paragraph"> <p>**</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Thursday, 10 September 2015 </h3> <h1> <a href="/blog/2015/09/10/infinispan-801final-and-725final/">Infinispan 8.0.1.Final (and 7.2.5.Final)</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear all,</p> </div> <div class="paragraph"> <p>we&#8217;ve just cooked two new point releases of Infinispan to address a number of issues.</p> </div> <div class="paragraph"> <p>The highlights for 8.0.1.Final are:  </p> </div> <div class="ulist"> <ul> <li> <p>ISPN-5717 Notify continuous query also when entry expires</p> </li> <li> <p>ISPN-5591 Simple local cache without interceptor stack. This is an extremely fast cache with very few features (no transactions, no indexing, no persistence, etc). Its primary intendend usage is as a 2nd-level cache for Hibernate, but we&#8217;re sure you can find lot&#8217;s of other applications for it, provided you don&#8217;t require all the bells and whistles that come with our fully-fledged caches.</p> </li> <li> <p>Bump Hibernate Search to 5.5.0.CR1 and Lucene to 5.3.0</p> </li> <li> <p>A number of query fixes, including indexing and searching of null non-string properties, aggregation expressions in orderBy, filter with both 'where' and 'having' in the same query</p> </li> <li> <p>ISPN-5731 Cannot use aggregation expression in orderBy</p> </li> <li> <p>Read the complete <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12328068">release notes</a></p> </li> </ul> </div> <div class="paragraph"> <p>The highlights for 7.2.5.Final are:</p> </div> <div class="ulist"> <ul> <li> <p>ISPN-5607 Preemptively invalidate near cache after writes</p> </li> <li> <p>ISPN-5670 Hot Rod server sets -1 for lifespan or maxIdle as default</p> </li> <li> <p>ISPN-5677 RemoteCache async methods use flags</p> </li> <li> <p>ISPN-5684 Make getAll work with compatibility mode in DIST</p> </li> <li> <p>Read the complete <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12327781">release notes</a></p> </li> </ul> </div> <div class="paragraph"> <p><a href="http://infinispan.org/download/">Get</a> it, <a href="http://infinispan.org/tutorials/">learn</a> how to use it, <a href="http://infinispan.org/getinvolved/">help</a> us improve it.</p> </div> <div class="paragraph"> <p>Enjoy !</p> </div> <div class="paragraph"> <p>The Infinispan team</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Tuesday, 08 September 2015 </h3> <h1> <a href="/blog/2015/09/08/functional-map-api-working-with/">Functional Map API: Working with multiple entries</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>We continue with the blog series on the experimental Functional Map API which was released as part of Infinispan 8.0.0.Final. In this blog post we&#8217;ll be focusing on how to work with multiple entries at the same time. For reference, here are the previous entries in the series:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p><a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">Functional Map Introduction</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2015/09/functional-map-api-working-with-single.html">Working with single entries</a></p> </li> </ol> </div> <div class="paragraph"> <p>The approach taken by the Functional Map API when working with multiple keys is to provide a lazy, pull-style API. All multi-key operations take a collection parameter which indicates the keys to work with (and sometimes contain value information too), and a function to execute for each key/value pair. Each function&#8217;s ability depends on the entry view received as function parameter, which changes depending on the underlying map: <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html">ReadEntryView</a> for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a>, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.WriteEntryView.html">WriteEntryView</a> for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a>, or <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadWriteEntryView.html">ReadWriteView</a> for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a>. The return type for all multi-key operations, except the ones from <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a>, return an instance of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> which exposes methods for working with the returned data from each function execution. Let&#8217;s see an example:</p> </div> <div class="paragraph"> <p>This example demonstrates some of the key aspects of working with multiple entries using the Functional Map API:</p> </div> <div class="ulist"> <ul> <li> <p>As explained in the previous blog post, all data-handling methods (including multi-key methods) for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a> return <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;Void&gt;</a>, because there&#8217;s nothing the function can provide that could not be computed in advance or outside the function.</p> </li> <li> <p>Normally, the order of the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> matches the order of the input collection though this is not currently guaranteed.</p> </li> </ul> </div> <div class="paragraph"> <p>There is a special type of multi-key operations which work on all keys/entries stored in Infinispan. The behaviour is very similar to the multi-key operations shown above, with the exception that they do not take a collection of keys (and/or values) as parameters:</p> </div> <div class="paragraph"> <p>There&#8217;s a few interesting things to note about working with all entries using the Functional Map API:</p> </div> <div class="ulist"> <ul> <li> <p>When working with all entries, the order of the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> is not guaranteed.</p> </li> <li> <p>Read-only&#8217;s <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html#keys--">keys()</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html#entries--">entries()</a> offer the possibility to traverse all keys and entries present in the cache. When traversing entries, both keys and values including metadata are available. Contrary to Java&#8217;s <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a>, there&#8217;s no possibility to navigate only the values (and metadata) since there&#8217;s little to be gained from such method and once a key&#8217;s entry has been retrieved, there&#8217;s no extra cost to provide the key as well.</p> </li> </ul> </div> <div class="paragraph"> <p>It&#8217;s worth noting that when we sat down to think about how to work with multiple entries, we considered having a push-style API where the user would receive callbacks pushed as the entries to work with were located. This is the approach that reactive APIs such as <a href="http://reactivex.io/">Rx</a> follow, but we decided against using such APIs at this level for several reasons:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>We have huge interest in providing a Rx-style API for Infinispan, but we didn&#8217;t want the core API to have a dependency on <a href="http://reactivex.io/">Rx</a> or <a href="http://www.reactive-streams.org/">Reactive Streams</a>. </p> </li> <li> <p>We didn&#8217;t want to reimplement a push-style async API since this is not trivial to do and requires careful thinking, specially around back-pressure and flow control.</p> </li> <li> <p>Push-style APIs require more work on the user side compared to pull-style APIs.</p> </li> <li> <p>Pull-style APIs can still be lazy and partly asynchronous since the user can decide to work with the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> at a later stage, and the separation between intermediate and terminating operations provides a good abstraction to avoid unnecessary computation.</p> </li> </ol> </div> <div class="paragraph"> <p>In fact, it is this desire to keep a clear separation between intermediate and terminating operations at <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> that has resulted in having no manual way to iterate over the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a>. In other words, there is no iterator() nor spliterator() methods in <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> since these are often associated with manual, user-end iteration, and we want to avoid such thing since in the majority of cases, Infinispan knows best how to exactly iterate over the data.</p> </div> <div class="paragraph"> <p>In the next blog post, we&#8217;ll be looking at how to work with listeners using the Functional Map API.</p> </div> <div class="paragraph"> <p>Cheers, Galder</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Monday, 07 September 2015 </h3> <h1> <a href="/blog/2015/09/07/distributed-streams/">Distributed Streams</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Now that Infinispan supports Java 8, we can take full advantage of some of the new features.  One of the big features of Java 8 is the new <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a> classes.  This flips the head on processing data so that instead of having to iterate upon the data yourself the underlying Stream handles that and you just provide the operations to perform on it.  This lends itself great to distributed processing as the iteration is handled entirely by the implementation (in this case Infinispan).</p> </div> <div class="paragraph"> <p>I therefore am glad to introduce for Infinispan 8, the feature Distributed Streams!  This allows for any operation you can perform on a regular Stream to also be performed on a Distributed cache (assuming the operation and data is <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_marshalling">marshallable</a>).</p> </div> </div> </div> <div class="sect1"> <h2 id="_marshallability"><a class="anchor" href="#_marshallability"></a>Marshallability</h2> <div class="sectionbody"> <div class="paragraph"> <p>When using a distributed or replicated cache, the keys and values of the cache must be marshallable.  This is the same case for intermediate and terminal operations when using the distributed streams.  Normally you would have to provide an instance of some new class that is either Serializable or has an Externalizer registered for it as described in the marshallable section of the user guide.</p> </div> <div class="paragraph"> <p>However, Java 8 also introduced lambdas, which can be defined as serializable very easily (although it is a bit awkward).  An example of this serialization can be found <a href="http://infinispan.org/tutorials/simple/streams/">here</a>.</p> </div> <div class="paragraph"> <p>Some of you may also be aware of the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html">Collectors</a> class which is used with the collect method on a stream.  Unfortunately, all of the Collectors produced are not able to be marshalled.  As such, Infinispan has added a <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/stream/CacheCollectors.html">utility class</a> that can work in conjunction with the Collectors class.  This allows you to still use any combination of the Collectors classes and still work properly when everything is required to be marshalled.</p> </div> </div> </div> <div class="sect1"> <h2 id="_parallelism"><a class="anchor" href="#_parallelism"></a>Parallelism</h2> <div class="sectionbody"> <div class="paragraph"> <p>Java 8 streams naturally have a sense of parallelism.  That is that the stream can be marked as being parallel.  This in turn allows for the operations to be performed in parallel using multiple threads.  The best part is how simple it is to do.  The stream can be made parallel when first retrieving it by invoking <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#parallelStream--">parallelStream</a> or you can optionally enable it after the Stream is retrieved by just invoking <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/BaseStream.html#parallel--">parallel</a>.</p> </div> <div class="paragraph"> <p>The new Distributed streams from Infinispan take this one step further, which I am calling parallel distribution.  That is that since data is already partitioned across nodes we can also allow operations to be ran simultaneously on different nodes at the same time.  This option is enabled by default.  However this can be controlled by using the new CacheStream interface discussed just below.  Also, to be clear, the Java 8 parallel can be used in conjunction with parallel distribution.  This just means you will have concurrent operations running on multiple nodes across multiple threads on each node.</p> </div> </div> </div> <div class="sect1"> <h2 id="_cachestream_interface"><a class="anchor" href="#_cachestream_interface"></a>CacheStream interface</h2> <div class="sectionbody"> <div class="paragraph"> <p>There is a new interface <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/CacheStream.html">Cachestream</a> provided that allows for controlling additional options when using a Distributed Stream.  I am highlighting the added methods (note comments have been removed from gist)</p> </div> <div class="sect2"> <h3 id="_distributedbatchsize"><a class="anchor" href="#_distributedbatchsize"></a>distributedBatchSize</h3> <div class="paragraph"> <p>This method controls how many elements are brought back at one time for operations that are key aware.  These operations are (spl)iterator and forEach.  This is useful to tweak how many keys are held in memory from a remote node.  Thus it is a tradeoff of performance (more keys) versus memory.  This defaults to the chunk size as configured by state transfer.</p> </div> </div> <div class="sect2"> <h3 id="_paralleldistribution_sequentialdistribution"><a class="anchor" href="#_paralleldistribution_sequentialdistribution"></a>parallelDistribution / sequentialDistribution</h3> <div class="paragraph"> <p>This was discussed in the parallelism section above.  Note that all commands have this enabled by default except for spl(iterator) methods.</p> </div> </div> <div class="sect2"> <h3 id="_filterkeys"><a class="anchor" href="#_filterkeys"></a>filterKeys</h3> <div class="paragraph"> <p>This method can be used to have the distributed stream only operate on a given set of keys.  This is done in a very efficient way as it will only perform the operation on node(s) that own the given keys.  Using a given set of keys also allows for constant access time from the data container/store as the cache doesn&#8217;t have to look at every single entry in the cache.</p> </div> </div> <div class="sect2"> <h3 id="_filterkeysegments_advanced_users_only"><a class="anchor" href="#_filterkeysegments_advanced_users_only"></a>filterKeySegments (advanced users only)</h3> <div class="paragraph"> <p>This is useful to do filtering of instances in a more performant way.  Normally, you could use the filter intermediate operation, but this method is performed before any of the operations are performed to most efficiently limit the entries that are presented for stream processing.  For example, if only a subset of segments are required, it may not have to send a remote request.</p> </div> </div> <div class="sect2"> <h3 id="_segmentcompletionlistener_advanced_users_only"><a class="anchor" href="#_segmentcompletionlistener_advanced_users_only"></a>segmentCompletionListener (advanced users only)</h3> <div class="paragraph"> <p>Similar to the previous method, this is related to key segments.  This listener allows for the end user to be notified when a segment has been completed for processing.  This can be useful if you want to keep track of completion and if this node goes down, you can rerun the processing with only the unprocessed segments.  Currently, this listener is only supported for spl(iterator) methods.</p> </div> </div> <div class="sect2"> <h3 id="_disablerehashaware_advanced_users_only"><a class="anchor" href="#_disablerehashaware_advanced_users_only"></a>disableRehashAware (advanced users only)</h3> <div class="paragraph"> <p>By default, all stream operations are what is called rehash aware.  That is if a node joins or leaves the cluster while the operation is in progress the cluster will be aware of this and ensure that all data is processed properly with no loss (assuming no data was actually lost).</p> </div> <div class="paragraph"> <p>This can be disabled by calling disableRehashAware; however, if a rehash is to occur in the middle of the operation, it is possible that all data may not be processed.  It should be noted that data is not processed multiple times with this disabled, only a loss of data can occur.</p> </div> <div class="paragraph"> <p>This option is not normally recommended unless you have a situation where you can afford to only operate on a subset of data.  The tradeoff is that the operation can perform faster, especially (spl)iterator and forEach methods.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_mapreduce"><a class="anchor" href="#_mapreduce"></a>Map/Reduce</h2> <div class="sectionbody"> <div class="paragraph"> <p>The age old example of map/reduce is always word count.  Streams allow you to do that as well!  Here is an equivalent word count example assuming you have a Cache containing String keys and values and you want the count of all words in the values.  Some of you may be wondering how this  relates to our existing map/reduce framework.  The plan is to deprecate the existing Map/Reduce and replace it completely with the new distributed streams at a later point.</p> </div> <div class="paragraph"> <p>Remember though that distributed streams can do so much more than just map/reduce. And there are a lot of examples already out there for streams. To use the distributed streams, you just need to make sure your operations are marshallable, and you are good to go.</p> </div> <div class="paragraph"> <p>Here are a few pages with examples of how to use streams straight from Oracle:</p> </div> <div class="paragraph"> <p><a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html" class="bare">http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html</a> <a href="http://www.oracle.com/technetwork/articles/java/architect-streams-pt2-2227132.html" class="bare">http://www.oracle.com/technetwork/articles/java/architect-streams-pt2-2227132.html</a></p> </div> <div class="paragraph"> <p>I hope you enjoy Distributed Streams.  We hope they change how you interact with your data in the cluster!</p> </div> <div class="paragraph"> <p>Let us know what you think, any issues or usages you would love to share!</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Will</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 02 September 2015 </h3> <h1> <a href="/blog/2015/09/02/functional-map-api-working-with-single/">Functional Map API: Working with single entries</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>In this blog post we&#8217;ll continue with the introduction of the experimental Functional Map API, which was released as part of <a href="http://blog.infinispan.org/2015/08/infinispan-800final.html">Infinispan 8.0.0.Final</a>, focusing on how to manipulate data using single-key operations.</p> </div> <div class="paragraph"> <p>As mentioned in the <a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">Functional Map API introduction</a>, there are three types of operations that can be executed against a functional map: read-only operations (executed via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a>), write-only operations (executed via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a>), and read-write operations (executed via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a>) and .</p> </div> <div class="paragraph"> <p>Firstly, we need construct instances of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a>, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a> to be able to work with them:</p> </div> <div class="paragraph"> <p>Next, let&#8217;s see all three types of operations in action, chaining them to store a single key/value pair along with some metadata, then read it and finally delete a returning the previously stored data:</p> </div> <div class="paragraph"> <p>This example demonstrates some of the key aspects of working with single entries using the Functional Map API:</p> </div> <div class="ulist"> <ul> <li> <p>Single entry methods are asynchronous returning <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> instances which provide methods to compose and chain operations so that it can feel is they&#8217;re being executed sequentially. Unfortunately Java does not have <a href="https://en.wikibooks.org/wiki/Haskell/do_notation">Haskell&#8217;s do notation</a> or <a href="http://docs.scala-lang.org/tutorials/FAQ/yield.html">Scala&#8217;s for comprehensions</a> to make it more palatable, but it&#8217;s great news that Java finally offers mechanisms to work with CompletableFutures in a non-blocking way, even if they&#8217;re a bit more verbose than what&#8217;s proposed in other languages.</p> </li> <li> <p>All data-handling methods for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a> return <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;Void&gt;</a>, meaning that the user can find out when the operation has completed but nothing else, because there&#8217;s nothing the function can provide that could not be computed in advance or outside the function.</p> </li> <li> <p>The return type for most of the data handling methods in <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a> (and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a>) are quite flexible. So, a function can decide to return value information, or metadata, or for convenience, it can also return the ReadEntryView it receives as parameter. This can be useful for users wanting to return both value and metadata parameter information.</p> </li> <li> <p>The read-write operation demonstrated above showed how to remove an entry and return the previously associated value. In this particular case, we know there&#8217;s a value associated with the entry and hence we called <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html">ReadEntryView.get()</a> directly, but if we were not sure if the value is present or not, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#find--">ReadEntryView.find()</a> should be called and return the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> instance instead.</p> </li> <li> <p>In the example, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.MetaLifespan.html">Lifespan metadata parameter</a> is constructed using the new Java Time API available in Java 8, but it could have been done equally with <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeUnit.html">java.util.concurrent.TimeUnit</a> as long as the conversion was done to number of milliseconds during which the entry should be accessible.</p> </li> <li> <p>Lifespan-based expiration works just as it does with other Infinispan APIs, so you can easily modify the example to lower the lifespan, wait for duration to pass and then verify that the value is not present any more.</p> </li> </ul> </div> <div class="paragraph"> <p>If storing a constant value, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#eval-K-java.util.function.Consumer-">WriteOnlyMap.eval(K, Consumer)</a> could be used instead of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#eval-K-V-java.util.function.BiConsumer-">WriteOnlyMap.eval(K, V, Consumer)</a>, making the code clearer, but if the value is variable, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#eval-K-V-java.util.function.BiConsumer-">WriteOnlyMap.eval(K, V, Consumer)</a> should be used to avoid, as much as possible, functions capturing external variables. Clearly, operations exposed by functional map can&#8217;t cover all scenarios and there might be situations where external variables are captured by functions, but these should in general, should be a minority. Here is as example showing how to implement <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListMap.html#replace-K-V-V-">ConcurrentMap.replace(K, V, V)</a> where external variable capturing is required:</p> </div> <div class="paragraph"> <p>The reason we didn&#8217;t add a WriteOnly.eval(K, V, V, Consumer) to the API is because value-equality-based replace comparisons are just one type of replace operations that could be executed. In other cases, metadata parameter based comparison might be more suitable, e.g. Hot Rod replace operation where version (a type of metadata parameter) equality is the deciding factor to determine whether the replace should happen or not.</p> </div> <div class="paragraph"> <p>In the next blog post, we&#8217;ll be looking at how to work with multiple entries using the Functional Map API.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <hr> <div class="pagination-links"><a href="/blog/page/43/" class="previous-link">Previous</a> <a href="/blog/" class="page-link">1</a> <a href="/blog/page/2/" class="page-link">2</a> <span class="skip">...</span><a href="/blog/page/43/" class="page-link">43</a> <span class="current-page">44</span> <a href="/blog/page/45/" class="page-link">45</a> <span class="skip">...</span><a href="/blog/page/111/" class="page-link">111</a> <a href="/blog/page/112/" class="page-link">112</a> <a href="/blog/page/45/" class="next-link">Next</a> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>