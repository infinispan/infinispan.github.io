<!DOCTYPE html> <html lang="en"> <head> <title>Near caching with Spring-Boot and Infinispan - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <ul class="breadcrumb"> <li> <a href="/blog">Blog</a> <span class="divider"></span> </li> <li class="active"> Near caching with Spring-Boot and Infinispan</li> </ul> <h3></h3> <h1>Near caching with Spring-Boot and Infinispan</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>We have recently released <a href="https://github.com/infinispan/infinispan-spring-boot">infinispan-spring-boot-starter</a> <strong>2.0.0.Final</strong>. This version supports <a href="https://spring.io/projects/spring-boot">Spring Boot 2.1</a> and <a href="http://infinispan.org/">Infinispan 9.4.0.Final</a>.</p> </div> <div class="paragraph"> <p>Before this release, some important features - such as near caching - were only configurable by code. From now on, we can set all of the Hot Rod client configuration using the <strong>hotrod.properties</strong> file or the <a href="https://issues.jboss.org/browse/ISPN-9437">Spring application YAML</a>. The latter is an important community requirement we had.</p> </div> <div class="paragraph"> <p>Let&#8217;s see how to speed up our applications performance with <a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#near_caching">near caching</a>!</p> </div> <div class="paragraph"> <p>==</p> </div> <div class="paragraph"> <p>==</p> </div> </div> </div> <div class="sect1"> <h2 id="_hot_rod"><a class="anchor" href="#_hot_rod"></a>Hot Rod</h2> <div class="sectionbody"> <div class="sect2"> <h3 id=""><a class="anchor" href="#"></a> </h3> <div class="paragraph"> <p>Just as a quick reminder, Infinispan can be used embedded in your application or in <strong>client/server</strong> mode. To connect you application to a server you can use an <a href="http://infinispan.org/hotrod-clients/">Infinispan Client</a> and the Infinispan <a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#hot_rod_server_usage">“Hot Rod Protocol”</a>. Other protocols are available, such as REST, but Hot Rod is the most recommended way since it is the one that supports most of the Infinispan functionalities.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_near_cache"><a class="anchor" href="#_near_cache"></a>Near cache</h2> <div class="sectionbody"> <div class="paragraph"> <p>From the Infinispan <a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#near_caching">documentation</a>: Hot Rod client can keep a local cache that stores recently used data. Enabling near caching can significantly improve the performance of read operations <strong>get</strong> and <strong>getVersioned</strong> since data can potentially be located locally within the Hot Rod client instead of having to go remote.</p> </div> </div> </div> <div class="sect1"> <h2 id="_when_should_i_use_it"><a class="anchor" href="#_when_should_i_use_it"></a>When should I use it? </h2> <div class="sectionbody"> <div class="paragraph"> <p>Near caching can improve the performance of an application when most of the accesses to a given cache are read-only and the accessed dataset is relatively small. When an application is doing lots of writes to a cache, invalidations, evictions and updates to the near cache need to happen. In this scenario we won&#8217;t probably get much benefit.</p> </div> <div class="paragraph"> <p>As I said in the introduction, the good news is that <strong>this feature can be activated just by configuration</strong>. Code doesn&#8217;t change, so we can measure the benefits, if such exist, in a very straightforward way.</p> </div> </div> </div> <div class="sect1"> <h2 id="_spring_boot"><a class="anchor" href="#_spring_boot"></a>Spring-Boot</h2> <div class="sectionbody"> <div class="paragraph"> <p>I have created a very simple application, available <a href="https://github.com/infinispan-demos/infinispan-near-cache">here</a>. Maven, Java 8 and an Infinispan server are required to run it. You can <a href="http://downloads.jboss.org/infinispan/9.4.0.Final/infinispan-server-9.4.0.Final.zip">download the server</a> or use <a href="https://hub.docker.com/r/jboss/infinispan-server/">docker</a>.</p> </div> <div class="paragraph"> <p>Docker: docker run -it -p 11222:11222 jboss/infinispan-server:9.4.0.Final</p> </div> <div class="paragraph"> <p>Standalone: PATH/infinispan-server-9.4.0.Final/bin/standalone.sh</p> </div> <div class="paragraph"> <p>Once the server is up and running, build the application using maven </p> </div> <div class="paragraph"> <p>&gt;&gt; infinispan-near-cache: mvn clean install</p> </div> <div class="sect2"> <h3 id="_writer"><a class="anchor" href="#_writer"></a>Writer </h3> <div class="paragraph"> <p>This application loads the required data to a remote cache: a list of some of the Infinispan contributors over the last decade.</p> </div> <div class="paragraph"> <p>&gt;&gt; writer: mvn spring-boot:run</p> </div> </div> <div class="sect2"> <h3 id="_reader"><a class="anchor" href="#_reader"></a>Reader </h3> <div class="paragraph"> <p>The reader application does 10.000 accesses to the contributors cache. Using a random id, I call 10.000 times the get method. The job gets done in my laptop in ~4000 milliseconds.</p> </div> <div class="paragraph"> <p>&gt;&gt; reader-no-near-cache: mvn spring-boot:run</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_activating_the_near_cache"><a class="anchor" href="#_activating_the_near_cache"></a>Activating the near cache</h2> <div class="sectionbody"> <div class="paragraph"> <p>I need to configure two properties:</p> </div> <div class="ulist"> <ul> <li> <p><strong>Near Cache Mode:</strong> DISABLED or INVALIDATED. Default value is DISABLED, so I turn it on with <strong>INVALIDATED</strong>.</p> </li> <li> <p><strong>Max Entries:</strong> Integer value that sets the max size of the near caches. There is no default value, so I set up one.</p> </li> </ul> </div> <div class="paragraph"> <p>The hotrod client configuration is <span class="underline">for each client</span>, <span class="underline">not for each cache</span> (this might change in the future). With that in mind, note that configuring the previous properties will activate near caching <strong>for all the caches</strong>. If you need to activate it just for <strong>some of them</strong>, add the following property:</p> </div> <div class="ulist"> <ul> <li> <p><strong>Cache Name Pattern:</strong>  String pattern. For example "i8n-.*" will activate the near caching for all the caches whose name starts by "i8n-".</p> </li> </ul> </div> <div class="paragraph"> <p>Configuration can be placed in the <strong>hotrod-client.properties</strong>, <strong>Spring-boot configuration</strong> or <strong>code</strong>.</p> </div> <div class="sect2"> <h3 id="_hotrod_client_properties"><a class="anchor" href="#_hotrod_client_properties"></a>hotrod-client.properties</h3> <div class="paragraph"> <p><strong>infinispan.client.hotrod.near_cache.mode=</strong>INVALIDATED</p> </div> <div class="paragraph"> <p><strong>infinispan.client.hotrod.near_cache.max_entries=</strong>40</p> </div> <div class="paragraph"> <p><strong>infinispan.client.hotrod.near_cache.cache_name_pattern=*i8n-.</strong></p> </div> </div> <div class="sect2"> <h3 id="_application_yaml_or_properties"><a class="anchor" href="#_application_yaml_or_properties"></a>application.yaml (or properties)</h3> <div class="paragraph"> <p><strong>infinispan:</strong>    <strong>remote:</strong>      <strong>near-cache-mode:</strong> INVALIDATED      <strong>near-cache-max-entries:</strong> 10      <strong>near-cache-cache-name-pattern:</strong> i8n-.*</p> </div> <div class="sect4"> <h5 id="_code"><a class="anchor" href="#_code"></a>code </h5> <div class="paragraph"> <p>With the Infinispan Spring-Boot Starter, I can add custom configuration using the <strong>InfinispanRemoteCacheCustomizer</strong>.</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_results"><a class="anchor" href="#_results"></a>Results</h2> <div class="sectionbody"> <div class="paragraph"> <p>My dataset contains 25 contributors. If I activate the near cache with max 12 entries and I run my reader again, I get the job done in ~1900 milliseconds, which is already an improvement. If I configure it to hold the complete dataset, I get it done in ~220 milliseconds, which is a big one!</p> </div> <div class="sect2"> <h3 id="_conclusions"><a class="anchor" href="#_conclusions"></a>Conclusions</h3> <div class="paragraph"> <p>Near caching can help us speed up our client applications if configured properly. We can test our tuning easily because we only need to add some configuration to the client. Finally, the <a href="https://github.com/infinispan/infinispan-spring-boot">Spring-Boot Infinispan Starter</a> helps us build services with Spring-Boot and Infinispan. </p> </div> <div class="paragraph"> <p>Further work will be done to help Spring-Boot users work with Infinispan, so stay tuned! Any feedback on the starter or any requirement from the community is more that welcome. Find us in <a href="https://infinispan.zulipchat.com/">Zulip Chat</a> for direct contact or post your questions in <a href="https://stackoverflow.com/questions/tagged/?tagnames=infinispan&amp;sort=newest">StackOverflow</a>!</p> </div> </div> </div> </div> <em>Posted by Katia Aresti on 2018-11-02</em> <hr> <h5> Tags <a href="/blog/tags/spring-boot starters/"> spring-boot starters </a> <a href="/blog/tags/hotrod/"> hotrod </a> <a href="/blog/tags/near caching/"> near caching </a> <a href="/blog/tags/infinispan/"> infinispan </a> <a href="/blog/tags/spring/"> spring </a> <a href="/blog/tags/spring-boot/"> spring-boot </a> </h5> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>