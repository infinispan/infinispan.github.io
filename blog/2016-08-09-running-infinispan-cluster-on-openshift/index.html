<!DOCTYPE html> <html lang="en"> <head> <title>Running Infinispan cluster on OpenShift - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="http://blog.infinispan.org">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <h3>Tuesday 09 August 2016</h3> <h1>Running Infinispan cluster on OpenShift</h1> <p>&lt;p&gt;&lt;div dir="ltr" style="text-align: left;" trbidi="on"&gt;Did you know that it's extremely easy to run Infinispan in &lt;a href="https://www.openshift.com/"&gt;OpenShift&lt;/a&gt;? Infinispan 9.0.0.Alpha4 adds out of the box support for OpenShift (and Kubernetes) discovery!&lt;br/&gt;&lt;h4&gt;Our goal&lt;/h4&gt;&lt;div&gt;We'd like to build an Infinispan cluster on top of OpenShift and expose a&lt;i&gt;Service&lt;/i&gt;for it (you may think about &lt;i&gt;Services&lt;/i&gt; as Load Balancers). A&lt;i&gt;Service&lt;/i&gt; can be exposed to the outside world using &lt;i&gt;Routes&lt;/i&gt;. Finally, we will use REST interface to PUT and GET some data from the cluster.&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://4.bp.blogspot.com/-l9FMkQOGKDQ/V6Q5tFuHkSI/AAAAAAAAHFA/J7eiuzoh3ksnpZ7FGMcixeRVhpgn7-qVgCLcB/s1600/Infinispan%2B%252B%2BOpenShift.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" height="320" src="https://4.bp.blogspot.com/-l9FMkQOGKDQ/V6Q5tFuHkSI/AAAAAAAAHFA/J7eiuzoh3ksnpZ7FGMcixeRVhpgn7-qVgCLcB/s320/Infinispan%2B%252B%2BOpenShift.png" width="240"/&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;br/&gt;&lt;/div&gt;&lt;h4&gt;Accessing the OpenShift cloud&lt;/h4&gt;&lt;div&gt;Of course before playing with Infinispan, you will need an OpenShift cluster. There are &lt;a href="https://docs.openshift.org/latest/install_config/index.html"&gt;number of options&lt;/a&gt; you can investigate. I will use the simplest path - &lt;a href="https://github.com/openshift/origin/blob/master/docs/cluster_up_down.md"&gt;OpenShift local cluster&lt;/a&gt;.&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;The first step is to download OpenShift Client Tools for your platform. You can find them on &lt;a href="https://github.com/openshift/origin/releases"&gt;OpenShift releases Github page&lt;/a&gt;. Once you download and extract the 'oc' binary, make it accessible in your $PATH. I usually copy such things into my '/usr/bin' directory (I'm using Fedora F23).&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;Once everything is set and done - spin up the cluster:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/4f632640a053c21e764395e82c3499a3.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;Note that you have been automatically logged in as 'developer' and your project has been automatically set to 'myproject'.&lt;/div&gt;&lt;div&gt;&lt;h4&gt;Spinning an Infinispan cluster&lt;/h4&gt;&lt;/div&gt;&lt;div&gt;The first step is to create an Infinispan app:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/af64a89a6a4afa233fcc08dbef51fe7b.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;Now you need to modify the Deployment Configuration (use 'oc edit dc/infinispan-server' for this) and tell Infinispan to boot up with Kubernetes' discovery protocol stack by using the proper namespace to look up other nodes (unfortunately this step can not be automated, otherwise a newly created Infinispan node might try to join an existing cluster and this is something you might not want). Here's my modified Deployment Configuration:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/e0ca4b4634a2ab103345099fa3a34459.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;(lines 58-60) - Modified Infinispan startup parameters by adding &lt;a href="http://kubernetes.io/docs/user-guide/containers/"&gt;image startup arguments&lt;/a&gt;.&lt;/li&gt;&lt;li&gt;(lines 88-90) - &lt;a href="https://github.com/jgroups-extras/jgroups-kubernetes"&gt;JGroups Kubernetes Discovery protocol&lt;/a&gt; is instrumented by the&lt;a href="http://kubernetes.io/docs/user-guide/downward-api/"&gt;Downward API&lt;/a&gt;to use current project's namespace.&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;There is one final step - Kubernetes' PING protocol uses the API to look up other nodes in the Infinispan cluster. By default API access is disabled in OpenShift and needs to be enabled. This can be done by this simple command:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/bb0b901cf463197026f0006dad547c2e.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;Now we can redeploy the application (to ensure that all changes were applied) and scale it out (to 3 nodes):&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/5718ec129d54398ac39d89740c91e919.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;Now let's check if everything looks good - you can do it either through the OpenShift web console or by using 'oc get pods' and 'oc logs' commands:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/5aef5cf38a499e4babf204d1bb2c8bf5.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;&lt;br/&gt;Accessing the cluster&lt;/h4&gt;&lt;/div&gt;&lt;div&gt;In order to access the Infinispan cluster from the outside world we need a Route:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/07b6dc6273c4e82ac3be0f34ab8c4ffa.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;The newly created Route needs small changes - we need to change the target port to 8080 (this is the REST service). The 'oc edit route/infinispan-server' command is perfect for it. Below is my updated configuration:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/3f088eae8d41c9b2ae6a660303ea8e38.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;(line 17) - Modified to 8080 TCP port&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;Testing the setup&lt;/h4&gt;&lt;/div&gt;&lt;div&gt;You can easily see how to access the cluster by describing the Route:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/c767c424b886760cb8975c2f99b4f401.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&lt;div&gt;Now let's try to play with the data:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/2e1a1b5f8c4c33eb2e5b9f75f56582ca.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;Cleaning up&lt;/h4&gt;&lt;/div&gt;&lt;div&gt;Finally, when you are done with experimenting, you can remove everything using 'oc delete' command:&lt;/div&gt;&lt;div&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/slaskawi/dee86d5ad704bf3aa63cdc4202d40020.js"/&gt;&lt;/div&gt;&lt;div&gt;&lt;h4&gt;Conclusion&lt;/h4&gt;&lt;/div&gt;&lt;div&gt;Running Infinispan cluster inside an OpenShift cloud is really simple. Just 3 steps to remember:&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;Create an Infinispan app ('oc new-app')&lt;/li&gt;&lt;li&gt;Tell it to use Kubernetes JGroups Stack and in which project look for other cluster members ('oc edit dc/infinispan-server')&lt;/li&gt;&lt;li&gt;Allow access to the OpenShift API ('oc policy add-role-to-user')&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;Happy scaling!&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/p&gt;</p> <em>Posted by Sebastian Łaskawiec</em> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>