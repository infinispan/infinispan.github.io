<!DOCTYPE html>
<html>

<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GPD7V946LB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GPD7V946LB');
  </script>
  <title>JDBC Migrator or: How I Learned to Stop Worrying About Buckets and Utilise permalink: /blog/:year/:month/:day/jdbc-migrator-or-how-i-learned-to-stop the JdbcStringBasedStore!</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Infinispan is a distributed in-memory key/value data store with optional schema, available under the Apache License 2.0.">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.7.2/css/all.css" integrity="sha384-nRgPTkuX86pH8yjPJUAFuASXQSSl2/bBUiNV47vSYpKFxHJhbcrGnmlYpYJMeD7a" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.css">
  <link rel="stylesheet" href="/assets/css/cookieconsent.css">
  <link rel="alternate" type="application/rss+xml"
        title="Infinispan's RSS Feed"
        href="/feed.xml" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<body class="blog">
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/infinispan-logo-white.png" class="project-logo" title="Infinispan Logo"></a>
    </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/learn/">Learn <i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/introduction" class="">Introduction</a></li>
          <li><a href="/features" class="">Features</a></li>
          <li><a href="/documentation" class="">Documentation</a></li>
          <li><a href="/tutorials" class="">Tutorials</a></li>
          <li><a href="/videos" class="">Videos</a></li>
          <li><a href="/references" class="">References</a></li>
          <li><a href="/experiments" class="">Experiments</a></li>
          <li><a href="/roadmap" class="">Roadmap</a></li>
        </ul>
      </li>
      <li>
        <a href="/use-cases/" class="">Use Cases</a>
      </li>
      <li>
        <a href="/community/" class="">Community</a>
      </li>
      <li>
        <a href="/blog/" class="active">Blog</a>
      </li>
      <li>
        <a href="/download/" class="">Download</a>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    
<div class="component-slim full-width-bg dark-bg light-blue">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <a href="/blog">Blogs</a>  <i class="fas fa-chevron-right"></i> JDBC Migrator or: How I Learned to Stop Worrying About Buckets and Utilise permalink: /blog/:year/:month/:day/jdbc-migrator-or-how-i-learned-to-stop the JdbcStringBasedStore!
    </div>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="grid__item width-10-12 width-12-12-m doc-content">
    <h1>JDBC Migrator or: How I Learned to Stop Worrying About Buckets and Utilise permalink: /blog/:year/:month/:day/jdbc-migrator-or-how-i-learned-to-stop the JdbcStringBasedStore!</h1>
    <div class="post-date">March 10, 2017
      Tags: <a href="/blog/tag/jdbc">jdbc</a> <a href="/blog/tag/cache-stores">cache stores</a> <a href="/blog/tag/migration">migration</a> 
    </div>
    <div class="grid-wrapper">
      <div class="grid__item width-8-12 width-12-12-m margin-tb-sm">
        <div class="grid-wrapper">
          <div class="width-2-12 justify-self-center align-self-center">
            <img src="/assets/images/blog/authors/remerson.jpg">
          </div>
          <div class="width-10-12 align-self-center">
            <p class="byline">By Ryan Emerson</p>
          </div>
        </div>
      </div>
      <div class="grid__item width-12-12">
          <div class="paragraph">
<p>Infinispan 9 has introduced many improvements to its marshalling
codebase in order to improve performance and allow for greater
flexibility. Consequently, data marshalled and persisted by Infinispan
8.x is no longer compatible with Infinispan 9.x. Furthermore, as part of
our ongoing efforts to improve the cache stores provided by Infinispan,
we have removed both the JdbcBinaryStore and JdbcMixedStore in
Infinispan 9.0.</p>
</div>
<div class="paragraph">
<p>To assist users migrating from Infinispan 8.x, we have created the JDBC
Migrator that enables existing JDBC stores to be migrated to Infinispan
9&#8217;s JdbcStringBasedStore.</p>
</div>
<div class="sect1">
<h2 id="no-more-binary-keyed-stores">No More Binary Keyed Stores!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The original intention of the JdbcBinaryStore was to provide greater
flexibility over the JdbcStringBasedStore as it did not require a
Key2StringMapper implementation.  This was achieved by utilising the
hashcode of an entries key for a table&#8217;s ID column entry.  However, due
to the possibility of hash collisions all entries had to be placed
inside a Bucket object which was then serialised and inserted into the
underlying table. Utilising buckets in this manner was far from optimal
as each read/write to the underlying table required an existing bucket
for a given hash to be retrieved, deserialised, updated, serialised and
then re-inserted back into the db.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introducing-jdbc-migrator">Introducing JDBC Migrator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JDBCMigrator is a standalone application that takes a single
argument, the path to a .properties file which must contain the
configuration properties for both the source and target stores.  To use
the migrator you need the infinispan-tools-9.x.jar, as well as the jdbc
drivers required by your source and target databases, on your
classpath.</p>
</div>
<div class="paragraph">
<p>An example maven pom that launches the migrator via mvn exec:java is
presented below:</p>
</div>
<div class="sect2">
<h3 id="migration-examples">Migration Examples</h3>
<div class="paragraph">
<p>Below are several example .properties files used for migrating various
stores, however an exhaustive list of all available properties can be
found in
the  <a href="https://infinispan.org/docs/9.0.x/user_guide/user_guide.html#jdbc_migrator">Infinispan
user guide</a>.  </p>
</div>
<div class="paragraph">
<p>*
*</p>
</div>
<div class="paragraph">
<p><strong>Before attempting to migrate your existing stores please ensure you
have backed up your database!</strong>
*
*</p>
</div>
<div class="sect3">
<h4 id="8-x-jdbcbinarystore-9-x-jdbcstringbasedstore">8.x JdbcBinaryStore &#8594; 9.x JdbcStringBasedStore</h4>
<div class="paragraph">
<p>The most important property to set in this example is
"source.marshaller.type=LEGACY" as this instructs the migrator to
utilise the Infinispan 8.x marshaller to unmarshall data stored in your
existing DB tables. </p>
</div>
<div class="paragraph">
<p>If you specified custom AdvancedExternalizer implementations in your
Infinispan 8.x configuration, then it is necessary for you to specify
these in the migrator configuration and ensure that they are available
on the migrators classpath.  To Specify the AdvancedExternalizers to
load, it is necessary to define the "source.marshaller.externalizers"
property with a comma-separated list of class names. If an ID was
explicitly set for your externalizer, then it is possible to prepend the
externalizers class name with "&lt;id&gt;:" to ensure the IDs is respected by
the marshaller. </p>
</div>
</div>
<div class="sect3">
<h4 id="twowaykey2stringmapper-migration">TwoWayKey2StringMapper Migration</h4>
<div class="paragraph">
<p>As well as using the JDBC Migrator to migrate from Infinispan 8.x, it is
also possible to utilise it to migrate from one DB dialect to another or
to migrate from one TwoWayKey2StringMapper implementation to another. </p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="summary">Summary</h3>
<div class="paragraph">
<p>Infinispan 9 stores are no longer compatible with Infinispan 8.x stores
due to internal marshalling changes. Furthermore, the JdbcBinary and
JdbcMixed stores have been removed due to their poor performance
characteristics.  To aid users in their transition from Infinispan 8.x
we have created the JDBC Migrator to enable users to migrate their
existing JDBC stores.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re a user of the JDBC stores and have any feedback on the latest
changes, let us know via the forum, issue tracker or the #infinispan
channel on Freenode. </p>
</div>
</div>
</div>
</div>
          
      </div>
      <div class="grid__item width-12-12">
        <h2>Get it, Use it, Ask us! </h2>
We’re hard at work on new features, improvements and fixes, so watch this space for more announcements!
<div class="paragraph">
    <p>Please, <a href="/download" target="_blank">download</a> and test the latest release.</p>
</div>
<div class="paragraph">
    <p>The source code is hosted on <a href="" target="_blank">GitHub</a>.
        If you need to report a bug or request a new feature, look for a similar one on our <a href="https://github.com/infinispan/infinispan/issues" target="_blank">GitHub issues tracker</a>.
        If you don’t find any, <a href="https://github.com/infinispan/infinispan/issues" target="_blank">create a new issue</a>.</p>
</div>
<div class="paragraph">
    <p>If you have questions, are experiencing a bug or want advice on using Infinispan,
        you can use <a href="https://github.com/infinispan/infinispan/discussions/"
                       target="_blank">GitHub discussions</a>.
        We will do our best to answer you as soon as we can.</p>
</div>
<div class="paragraph">
    <p>The Infinispan community uses <a href="https://zulipchat.com/"
                                        target="_blank">Zulip</a> for real-time communications.
        Join us using either a web-browser or a <a href="https://infinispan.zulipchat.com/apps/" target="_blank">dedicated
            application</a> on the <a href="https://infinispan.zulipchat.com/" target="_blank">Infinispan chat</a>.</p>
</div>
      </div>
      
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/infinispan-logo.png" class="project-logo" title="Infinispan Logo" alt="Infinispan"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Infinispan is released under the Apache 2.0 open source license. Learn more about the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>.<br/><br/>This website built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/infinispan/infinispan.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <b>Navigation</b>
        <ul class="footer-links width-1-12">
          
            
            <li><a href="/" >Home</a></li>
          
            
            <li><a href="/features" >Features</a></li>
          
            
            <li><a href="/documentation" >Docs</a></li>
          
            
            <li><a href="/tutorials" >Tutorials</a></li>
          
            
            <li><a href="/videos" >Videos</a></li>
          
            
            <li><a href="/use-cases" >Use Cases</a></li>
          
            
            <li><a href="/community" >Community</a></li>
          
            
            <li><a href="/download" >Download</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <b>Contribute</b>
        <ul class="footer-links width-1-12">
          
            
            <li><a href="https://github.com/infinispan/infinispan/issues" target="_blank">Submit a Bug</a></li>
          
            
            <li><a href="https://github.com/infinispan" target="_blank">Write Code</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <b>Follow Us</b>
        <ul class="footer-links width-1-12">
          
            
            <li><a href="/blog" >Blog</a></li>
          
            
            <li><a href="https://twitter.com/infinispan" target="_blank">Twitter</a></li>
          
        </ul>
      </div>
    

    <div class="width-6-12 more-links">
      <div class="grid-wrapper">
        <div class="width-6-12">
          <b>A Member of</b><br/>
          <a href="https://www.commonhaus.org/" target="_blank"><img src="/assets/images/CF_logo_horizontal.svg" title="Commonhaus Foundation"></a><br/>
        </div>
        <div class="width-6-12">
          <b>Thanks to</b><br/>
          <a href="https://zulip.com" target="_blank"><img src="/assets/images/footer/zulip.png" title="Zulip" alt="Zulip"></a>
          <a href="https://weblate.org" target="_blank"><img src="/assets/images/footer/weblate.png" title="Weblate" alt="Weblate"></a>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="content-slim redhat-footer">
  <div class="grid-wrapper">
    <span class="cookie-preferences">
      <a href="#" data-cc="show-preferencesModal">Manage cookie preferences</a>
    </span>
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/truncate-list.js"></script>

  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/cookieconsent.umd.js" type="text/javascript"></script>
  <script src="/assets/javascript/cookieconsent.config.js" type="module"></script>

<!--   <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script> -->
</body>

</html>
