<!DOCTYPE html> <html lang="en"> <head> <title>Infinispan on Openshift v3 - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="http://blog.infinispan.org">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <h3>Friday 13 March 2015</h3> <h1>Infinispan on Openshift v3</h1> <p>&lt;p&gt;&lt;div dir="ltr" style="text-align: left;" trbidi="on"&gt;&lt;br/&gt;Openshift v3 is the open source next generation of Paas, where applications run on &lt;a href="https://www.docker.com/"&gt;Docker&lt;/a&gt; containers and are orchestrated/controlled/scheduled by &lt;a href="http://kubernetes.io/"&gt;Kubernetes&lt;/a&gt;.&lt;br/&gt;&lt;br/&gt;In this post I'll show how to create an Infinispan cluster on Openshift v3 and resize it with a snap of a finger.&lt;br/&gt;&lt;br/&gt;&lt;h3 style="text-align: left;"&gt;&lt;span style="font-size: large;"&gt;Installing Openshift v3&lt;/span&gt;&lt;/h3&gt;&lt;h3 style="text-align: left;"/&gt;&lt;div style="text-align: left;"&gt;Openshift v3 has not been released yet, so I'm going to use the code from &lt;a href="https://github.com/openshift/origin"&gt;origin&lt;/a&gt;.&lt;br/&gt;There are &lt;a href="http://docs.openshift.org/latest/getting_started/installation.html"&gt;many ways&lt;/a&gt; to install Openshift v3, but for simplicity, I'll run a full multinode cluster locally on top of VirtualBoxes using the provided &lt;a href="https://www.vagrantup.com/"&gt;Vagrant&lt;/a&gt; scripts.&lt;br/&gt;&lt;br/&gt;Let's start by checking out and building the sources:&lt;/div&gt;&lt;pre class="line-pre"&gt;&lt;span class="pl-s2"&gt;&lt;br/&gt;&lt;/span&gt;&lt;/pre&gt;&lt;div style="text-align: left;"&gt;&lt;script src="https://gist.github.com/bb5ea3e7844dc027c2e8.js"&gt; &lt;/script&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;br/&gt;To boot Openshift, it's a simple matter of starting up the desired number of nodes:&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/151fcb45f690bb92dbcb.js"&gt; &lt;/script&gt; Grab a beer while the cluster is being provisioned, after a while you should be able to see 3 instances running:&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/7ffca3a6e1de7b9a017b.js"&gt; &lt;/script&gt; &lt;br/&gt;&lt;h3 style="text-align: left;"/&gt;&lt;h3 style="text-align: left;"&gt;&lt;span style="font-size: large;"&gt;Creating the Infinispan template&lt;/span&gt;&lt;/h3&gt;&lt;br/&gt;The following template defines a 2 node Infinispan cluster communicating via TCP, and discovery done using the &lt;a href="http://www.jgroups.org/javadoc/org/jgroups/stack/GossipRouter.html"&gt;JGroups gossip router&lt;/a&gt;:&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/63ad346b3a8ccac0d59a.js"&gt; &lt;/script&gt; There are few different components declared in this template:&lt;br/&gt;&lt;br/&gt;&lt;ul style="text-align: left;"&gt;&lt;li&gt;A service with id &lt;i&gt;jgroups-gossip-service&lt;/i&gt; that will expose a JGroups gossip router service on port 11000, around the &lt;a href="https://registry.hub.docker.com/u/gustavonalle/jgroups-gossip/"&gt;JGroups Gossip container&lt;/a&gt;&lt;/li&gt;&lt;li&gt;A ReplicationController with id &lt;i&gt;jgroups-gossip-controller&lt;/i&gt;. Replication Controllers are used to ensure that, at any moment, there will be a certain number of replicas of a pod (a group of related docker containers) running. If for some reason a node crashes, the ReplicationController will instantiate a new pod elsewhere, keeping the service endpoint address unchanged.&lt;/li&gt;&lt;li&gt;Another ReplicationController with id &lt;i&gt;infinispan-controller&lt;/i&gt;. This controller will start 2 replicas of the &lt;i&gt;infinispan-pod&lt;/i&gt;. As it happens with the &lt;i&gt;jgroups-pod&lt;/i&gt;, the &lt;i&gt;infinispan-pod&lt;/i&gt; has only one container defined: the infinispan-server container (based on &lt;a href="https://registry.hub.docker.com/u/jboss/infinispan-server/"&gt;jboss/infinispan-server&lt;/a&gt;) , that is started with the 'clustered.xml' profile and configured with the 'jgroups-gossip-service' address. By defining the gossip router as a service, Openshift guarantees that environment variables such as&lt;span class="pl-s1"&gt; JGROUPS_GOSSIP_SERVICE_SERVICE_HOST are&lt;/span&gt; available to other pods (consumers). &lt;/li&gt;&lt;/ul&gt;&lt;br/&gt;&lt;br/&gt;&lt;h3 style="text-align: left;"&gt;&lt;span style="font-size: large;"&gt;Applying the template&lt;/span&gt;&lt;/h3&gt;&lt;br/&gt;&lt;br/&gt;To apply the template via cmd line:&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/aa0fb5adc2868a382375.js"&gt; &lt;/script&gt; Grab another beer, it can take a while since in this case the docker images need to be fetched on each of the minions from the public registry. In the meantime, to inspect the pods, along with their containers and statuses:&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/563daa6de95d6bdcab4d.js"&gt; &lt;/script&gt; &lt;br/&gt;&lt;h3 style="text-align: left;"&gt;&lt;span style="font-size: large;"&gt;Resizing the cluster&lt;/span&gt;&lt;/h3&gt;&lt;br/&gt;Changing the number of pods (and thus the number of nodes in the Infinispan cluster) is a simple matter of manipulating the number of replicas in the Replication Controller. To increase the number of nodes to 4:&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/3cc859246fee3386e906.js"&gt; &lt;/script&gt; &lt;br/&gt;This should take only a few seconds, since the docker images are already present in all the minions.&lt;br/&gt;&lt;br/&gt;&lt;script src="https://gist.github.com/b3ca4643d29d2930d99f.js"&gt; &lt;/script&gt; &lt;br/&gt;&lt;br/&gt;And this concludes the post, be sure to check other cool features of Openshift in the &lt;a href="http://docs.openshift.org/latest/welcome/index.html#"&gt;project documentation&lt;/a&gt; and try out other &lt;a href="https://github.com/openshift/origin/tree/master/examples"&gt;samples&lt;/a&gt;.&lt;br/&gt;&lt;br/&gt;&lt;/div&gt;&lt;/div&gt;&lt;/p&gt;</p> <em>Posted by Gustavo Fernandes</em> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>