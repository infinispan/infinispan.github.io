<!DOCTYPE html> <html lang="en"> <head> <title> Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script crossorigin="anonymous" src="https://kit.fontawesome.com/4167a38cfa.js"></script> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <link href="/feed.atom" rel="alternate" type="application/atom+xml"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Thursday, 08 December 2016 </h3> <h1> <a href="/blog/2016/12/08/meet-ickle/">Meet Ickle!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div id="docs-internal-guid-04619441-de6b-024f-1a8e-a4977a23b5c6" class="paragraph"> <p>As you’ve already learned from an earlier post this week, Infinispan 9 is on its final approach to landing and is bringing a new query language. Hurray! But wait, was there something wrong with the old one(s)? Not wrong really &#8230;&#8203;  I’ll explain.</p> </div> <div class="paragraph"> <p>Infinispan is a data grid of several query languages. Historically, it has offered search support early in its existence by integrating with Hibernate Search which provides a powerful Java-based DSL enabling you to build Lucene queries and run them on top of your Java domain model living in the data grid. Usage of this integration is confined to embedded mode, but that still succeeds in making Java users happy.</p> </div> <div class="paragraph"> <p>While the Hibernate Search combination is neat and very appealing to Java users it completely leaves non-JVM languages accessing Infinispan via remote protocols out in the cold.</p> </div> <div class="paragraph"> <p>Enter Remote Query. Infinispan 6.0 starts to address the need of searching the grid remotely via Hot Rod. The internals are still built on top of Lucene and Hibernate Search bedrock but these technologies are now hidden behind a new query API, the <a href="https://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/query/dsl/QueryBuilder.html">QueryBuilder</a>, an internal DSL resembling JPA criteria query. The QueryBuilder has implementations for both embedded mode and Hot Rod. This new API provides all relational operators you can think of, but no full-text search initially, we planned to add that later.</p> </div> <div class="paragraph"> <p>Creating a new internal DSL was fun. However, having a long term strategy for evolving it while keeping complete backward compatibility and also doing so uniformly across implementations in multiple languages proved to be a difficult challenge. So while we were contemplating adding new full-text operators to this DSL we decided on making a long leap forward and adopt a more flexible alternative by having our own string based query language instead, another DSL really, albeit an external one this time.</p> </div> <div class="paragraph"> <p>So after the long ado, let me introduce Ickle, Infinispan’s new query language, conspicuously resembling JP-QL.</p> </div> <div class="paragraph"> <p>Ickle:</p> </div> <div class="paragraph"> <p>is a light and small subset of JP-QL, hence the lovely name</p> </div> <div class="paragraph"> <p>queries Java classes and supports Protocol Buffers too</p> </div> <div class="paragraph"> <p>queries can target a single entity type</p> </div> <div class="paragraph"> <p>queries can filter on properties of embedded objects too, including collections</p> </div> <div class="paragraph"> <p>supports projections, aggregations, sorting, named parameters</p> </div> <div class="paragraph"> <p>supports indexed and non-indexed execution</p> </div> <div class="paragraph"> <p>supports complex boolean expressions</p> </div> <div class="paragraph"> <p>does not support computations in expressions (eg. user.age &gt; sqrt(user.shoeSize + 3) is not allowed but user.age &gt;= 18 is fine)</p> </div> <div class="paragraph"> <p>does not support joins</p> </div> <div class="ulist"> <ul> <li> <p>but, navigations along embedded entities are implicit joins and are allowed</p> </li> <li> <p>joining on embedded collections is allowed</p> </li> <li> <p>other join types not supported</p> </li> </ul> </div> <div class="paragraph"> <p>subqueries are not supported</p> </div> <div class="paragraph"> <p>besides the normal relational operators it offers full-text operators, similar to Lucene’s  query parser</p> </div> <div class="paragraph"> <p>is now supported across various Infinispan APIs, wherever a Query produced by the QueryBuilder is accepted (even for continuous queries or in event filters for listeners!)</p> </div> <div class="paragraph"> <p>That is to say we squeezed JP-QL to the bare minimum and added full-text predicates that closely follow the syntax of <a href="https://lucene.apache.org/core/6_2_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package.description">Lucene’s query parser</a>.</p> </div> <div class="paragraph"> <p>If you are familiar with JPA/JP-QL then the following example will speak for itself:</p> </div> <div class="paragraph"> <p>select accountId, sum(amount) from com.acme.Transaction     where amount &lt; 20.0     group by accountId     having sum(amount) &gt; 1000.0     order by accountId</p> </div> <div class="paragraph"> <p>The same query can be written using the QueryBuilder:</p> </div> <div class="paragraph"> <p>Query query = queryFactory.from(Transaction.class) .select(Expression.property("accountId"), Expression.sum("amount")) .having("amount").lt(20.0) .groupBy("accountId") .having(Expression.sum("amount")).gt(1000.0) .orderBy("accountId").build();</p> </div> <div class="paragraph"> <p>Both examples look nice but I hope you will agree the first one is better.</p> </div> <div class="paragraph"> <p>Ickle supports several new predicates for full-text matching that the QueryBuilder is missing. These predicates use the : operator that you are probably familiar from Lucene’s own query language.  This example demonstrates a simple full-text term query:</p> </div> <div class="paragraph"> <p>select transactionId, amount, description from com.acme.Transaction where amount &gt; 10 and description : "coffee"</p> </div> <div class="paragraph"> <p>As you can see, relational predicates and full-text predicates can be combined with boolean operators at will.</p> </div> <div class="paragraph"> <p>The only important thing to remark here is relational predicates are applicable to non-analyzed fields while full-text predicates can be applied to analyzed field only. How does indexing work, what is analysis and how do I turn it on/off for my fields? That’s the topic of a future post, so please be patient or start readinghttps://docs.jboss.org/hibernate/search/5.6/reference/en-US/html_single/#_analysis[ here].</p> </div> <div class="paragraph"> <p>Besides term queries we support several more:</p> </div> <div class="ulist"> <ul> <li> <p>Term                     description : "coffee"</p> </li> <li> <p>Fuzzy                    description : "cofee"~2</p> </li> <li> <p>Range                   amount : [40 to 90}</p> </li> <li> <p>Phrase                  description : "hello world"</p> </li> <li> <p>Proximity               description : "canceling fee"~3</p> </li> <li> <p>Wildcard                description : "te?t"</p> </li> <li> <p>Regexp                 description : /[mb]oat/</p> </li> <li> <p>Boosting                description : "beer"^3 and description : "books"</p> </li> </ul> </div> <div class="paragraph"> <p>You can read all about them starting from <a href="https://lucene.apache.org/core/6_2_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package.description">here</a>.</p> </div> <div class="paragraph"> <p>But is Ickle really new? Not really. The name is new, the full-text features are new, but a JP-QL-ish query string was always internally present in the Query objects produced by the QueryBuilder since the beginning of Remote Query. That language was never exposed and specified until now. It evolved significantly over time and now it is ready for you to use it. The QueryBuilder / criteria-like API is still there as a convenience but it might go out of favor over time. It will be limited to non-full-text functionality only. As Ickle grows we’ll probably not be able to include some of the additions in the QueryBuilder in a backward compatible manner. If growing will cause too much pain we might consider deprecating it in favor of Ickle or if there is serious demand for it we might continue to evolve the QueryBuilder in a non compatible manner.</p> </div> <div class="paragraph"> <p>Being a string based query language, Ickle is very convenient for our REST endpoint, the CLI, and the administration console allowing you to quickly inspect the contents of the grid. You’ll be able to use it there pretty soon. We’ll also continue to expand Ickle with more advanced full-text features like spatial queries and faceting, but that’s a subject for another major version. Until then, why not grab the current 9.0 Beta1 and test drive the new query language yourself? We’d love to hear your feedback on thehttps://developer.jboss.org/en/infinispan/content[ forum], on ourhttps://issues.jboss.org/projects/ISPN[ issue tracker] or on IRC on the #infinispan channel onhttp://webchat.freenode.net/?channels=%23infinispan[ Freenode].</p> </div> <div class="paragraph"> <p>Happy coding!</p> </div> </div> </div> </div> <em>Posted by Unknown on 2016-12-08</em> <br> <em>Tags:</em> <a href="/blog/tags/JP-QL/"> JP-QL </a> <a href="/blog/tags/Hibernate-Search/"> Hibernate-Search </a> <a href="/blog/tags/jpa/"> jpa </a> <a href="/blog/tags/lucene/"> lucene </a> <a href="/blog/tags/full-text/"> full-text </a> <a href="/blog/tags/indexing/"> indexing </a> <a href="/blog/tags/language/"> language </a> <a href="/blog/tags/query/"> query </a> <a href="/blog/tags/DSL/"> DSL </a> <hr> <div class="post"></div> <h3> Friday, 17 April 2015 </h3> <h1> <a href="/blog/2015/04/17/infinispan-720cr1-released/">Infinispan 7.2.0.CR1 released</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear community,</p> </div> <div class="paragraph"> <p>We are proud to announce the release of Infinispan 7.2.0.CR1!</p> </div> <div class="paragraph"> <p>This is the first release candidate of 7.2, bringing some exciting new features:</p> </div> <div class="ulist"> <ul> <li> <p>Faster bulk operations, putAll and getAll, for both embedded and HotRod client (<a href="https://issues.jboss.org/browse/ISPN-2183">ISPN-2183</a>, <a href="https://issues.jboss.org/browse/ISPN-5264">ISPN-5264</a>, <a href="https://issues.jboss.org/browse/ISPN-5266">ISPN-5266</a>)</p> </li> <li> <p>Cache creation and configuration changes without the need to restart the server (<a href="https://issues.jboss.org/browse/ISPN-5147">ISPN-5147</a>)</p> </li> <li> <p>Support for defining filters using the Query DSL for event listeners (<a href="https://issues.jboss.org/browse/ISPN-5349">ISPN-5349</a> and <a href="https://issues.jboss.org/browse/ISPN-5350">ISPN-5350</a>)</p> </li> <li> <p>Lock-free clear() operation (<a href="https://issues.jboss.org/browse/ISPN-5370">ISPN-5370</a>)</p> </li> </ul> </div> <div class="paragraph"> <p>For the complete list of features and bug fixes, please refer to the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12326575">release notes</a></p> </div> <div class="paragraph"> <p>Feel free to join us and shape the future releases on our <a href="http://www.jboss.org/infinispan/forums">forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or our <a href="http://webchat.freenode.net/?channels=%23infinispan">#infinispan</a> IRC channel.</p> </div> </div> </div> </div> <em>Posted by Gustavo on 2015-04-17</em> <br> <em>Tags:</em> <a href="/blog/tags/getAll/"> getAll </a> <a href="/blog/tags/hotrod/"> hotrod </a> <a href="/blog/tags/putAll/"> putAll </a> <a href="/blog/tags/listeners/"> listeners </a> <a href="/blog/tags/release candidate/"> release candidate </a> <a href="/blog/tags/DSL/"> DSL </a> <hr> <div class="post"></div> <h3> Thursday, 26 September 2013 </h3> <h1> <a href="/blog/2013/09/26/embedded-and-remote-queries-in/"> Embedded and remote queries in Infinispan 6.0.0.Beta1</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>If you&#8217;re following Infinispan&#8217;s mailing lists you&#8217;ve probably caught a glimpse of the new developments in the Query land: a new DSL, remote querying via Hot Rod client, a new marshaller based on Google&#8217;s Protobuf. Time to unveil these properly!</p> </div> <div class="exampleblock"> <div class="content"> <div class="paragraph"> <p>==== The new Query DSL</p> </div> </div> </div> <div class="paragraph"> <p>Starting with version 6.0 Infinispan offers a new (experimental) way of running queries against your cached entities based on a simple filtering DSL. The aim of the new DSL is to simplify the way you write queries and to be agnostic of the underlying query mechanism(s) making it possible to provide alternative query engines in the future besides Lucene and still being able to use the same query language/API. The previous Hibernate Search &amp; Lucene based <a href="https://docs.jboss.org/author/display/ISPN/Querying+Infinispan">approach</a> is still in place and will continue to be supported and in fact the new DSL is currently implemented right on top of it. The future will surely bring index-less searching based on map-reduce and possibly other new cool search technologies.</p> </div> <div class="paragraph"> <p>Running DSL-based queries in embedded mode is almost identical to running the existing Lucene-based queries. All you need to do is have infinispan-query-dsl.jar and infinispan-query.jar in your classpath (besides Infinispan and its dependecies), enable indexing for your caches, annotate your POJO cache values and your&#8217;re ready.</p> </div> <div class="paragraph"> <p>__</p> </div> <div class="literalblock"> <div class="content"> <pre>ConfigurationBuilder cfg = new ConfigurationBuilder();&#x000A;  cfg.indexing().enable();&#x000A;  &#x000A;  DefaultCacheManager cacheManager = new DefaultCacheManager(cfg.build());&#x000A;  &#x000A;  Cache cache = cacheManager.getCache();</pre> </div> </div> <div class="paragraph"> <p>____Alternatively, indexing (and everything else) can also be configured via XML configuration, as already described in the user guide, so we&#8217;ll not delve into details here.</p> </div> <div class="paragraph"> <p>Your Hibernate Search annotated entity might look like this.</p> </div> <div class="paragraph"> <p>__</p> </div> <div class="literalblock"> <div class="content"> <pre>import org.hibernate.search.annotations.*;&#x000A;  ...&#x000A;  &#x000A;  @Indexed&#x000A;  public class User {&#x000A;  &#x000A;      @Field(store = Store.YES, analyze = Analyze.NO)&#x000A;      private String name;&#x000A;  &#x000A;      @Field(store = Store.YES, analyze = Analyze.NO, indexNullAs = Field.DEFAULT_NULL_TOKEN)&#x000A;      private String surname;&#x000A;  &#x000A;      @IndexedEmbedded(indexNullAs = Field.DEFAULT_NULL_TOKEN)&#x000A;      private List addresses;&#x000A;  &#x000A;      // .. the rest omitted for brevity&#x000A;  }</pre> </div> </div> <div class="paragraph"> <p><em>___Running a DSL based query involves obtaining a _https://github.com/infinispan/infinispan/blob/6.0.0.Beta1/query-dsl/src/main/java/org/infinispan/query/dsl/QueryFactory.java[QueryFactory]</em> from the (cache scoped) <em>SearchManager</em> and then constructing the query as follows:</p> </div> <div class="paragraph"> <p>__</p> </div> <div class="literalblock"> <div class="content"> <pre>import org.infinispan.query.Search;&#x000A;  import org.infinispan.query.dsl.QueryFactory;&#x000A;  import org.infinispan.query.dsl.Query;&#x000A;  ...&#x000A;  &#x000A;  QueryFactory qf = Search.getSearchManager(cache).getQueryFactory();&#x000A;  &#x000A;  Query q = qf.from(User.class)&#x000A;      .having("name").eq("John")&#x000A;      .toBuilder().build();&#x000A;  &#x000A;  List list = q.list();&#x000A;  &#x000A;  assertEquals(1, list.size());&#x000A;  assertEquals("John", list.get(0).getName());&#x000A;  assertEquals("Doe", list.get(0).getSurname());</pre> </div> </div> <div class="paragraph"> <p><em>___That&#8217;s it! I&#8217;m sure this raised your curiosity as to what the DSL is actually capable of so you might want to look at the list of supported filter operators in _https://github.com/infinispan/infinispan/blob/6.0.0.Beta1/query-dsl/src/main/java/org/infinispan/query/dsl/FilterConditionEndContext.java[FilterConditionEndContext]</em>. Combining multiple conditions with boolean operators, including sub-conditions, is also possible:</p> </div> <div class="literalblock"> <div class="content"> <pre>Query q = qf.from(User.class)&#x000A;      .having("name").eq("John")&#x000A;      .and().having("surname").eq("Doe")&#x000A;      .and().not(qf.having("address.street").like("%Tanzania%").or().having("address.postCode").in("TZ13", "TZ22"))&#x000A;      .toBuilder().build();</pre> </div> </div> <div class="paragraph"> <p>The DSL is pretty nifty right now and will surely be expanded in the future based on your feedback. It also provides support for result pagination, sorting, projections, embedded objects, all demonstrated in <em><a href="https://github.com/infinispan/infinispan/blob/6.0.0.Beta1/query/src/test/java/org/infinispan/query/dsl/embedded/QueryDslConditionsTest.java">QueryDslConditionsTest</a></em> which I encourage you to look at until the proper user guide is published. Still, this is not a relational database, so keep in mind that all queries are written in the scope of the <em>single</em> targeted entity (and its embedded entities). There are no joins (yet), no correlated subqueries, no grouping or aggregations.</p> </div> <div class="paragraph"> <p>Moving further, probably the most exciting thing about the new DSL is using it remotely via the Hot Rod client. But to make this leap we first had to adopt a common format for storing our cache entries and marshalling them over the wire that would also be cross-language and robust enough to support evolving object schemas. But probably most of all, this format had to have a schema rather than just being an opaque blob otherwise indexing and searching are meaningless. Enter Protocol Buffers.</p> </div> </div> </div> <div class="sect3"> <h4 id="_the_protobuf_marshaller"><a class="anchor" href="#_the_protobuf_marshaller"></a>The Protobuf marshaller</h4> <div class="paragraph"> <p>Configuring the <em>RemoteCacheManager</em> of the Java Hot Rod client to use it is straight forward: __</p> </div> <div class="literalblock"> <div class="content"> <pre>import org.infinispan.client.hotrod.configuration.ConfigurationBuilder;&#x000A;  ...&#x000A;  &#x000A;  ConfigurationBuilder clientBuilder = new ConfigurationBuilder();&#x000A;  clientBuilder.addServer()&#x000A;      .host("127.0.0.1").port(11234)&#x000A;      .marshaller(new ProtoStreamMarshaller());</pre> </div> </div> <div class="paragraph"> <p><em>___Now you&#8217;ll be able to store and get from the remote cache your _User</em> instaces encoded in protobuf format provided that:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>a Protobuf type was declared for your entity in a <em>.proto</em> <a href="https://github.com/infinispan/protostream/blob/1.0.0.Alpha6/sample-domain-definition/src/main/resources/bank.proto">file</a> which was then compiled into a <em>.protobin</em> <a href="https://developers.google.com/protocol-buffers/docs/techniques?hl=ro#self-description">binary descriptor</a></p> </li> <li> <p>the binary descriptor was registered with your <em>RemoteCacheManager</em>'s <em>ProtoStreamMarshaller</em> instance like this: __</p> </li> </ol> </div> <div class="literalblock"> <div class="content"> <pre>ProtoStreamMarshaller.getSerializationContext(remoteCacheManager)&#x000A;      .registerProtofile("my-test-schema.protobin");</pre> </div> </div> <div class="paragraph"> <p><em>__3. a per-entity marshaller was registered: </em></p> </div> <div class="literalblock"> <div class="content"> <pre>ProtoStreamMarshaller.getSerializationContext(remoteCacheManager)&#x000A;      .registerMarshaller(User.class, new UserMarshaller());</pre> </div> </div> <div class="paragraph"> <p><em>___Steps 2 and 3 are closely tied to the way <a href="https://github.com/infinispan/protostream">Protosteam</a> library works, which is pretty straight forward but cannot be detailed here. Having a look at our <a href="https://github.com/infinispan/protostream/blob/1.0.0.Alpha6/sample-domain-implementation/src/main/java/org/infinispan/protostream/sampledomain/marshallers/UserMarshaller.java">_UserMarshaller</em></a> sample should clear this up.</p> </div> <div class="paragraph"> <p>Keeping your objects stored in protobuf format has the benefit of being able to consume them with compatible clients written in other languages. But if this does not sound enticing enough probably the fact they can now be easily indexed should be more appealing.</p> </div> </div> <div class="sect3"> <h4 id="_remote_querying_via_the_hot_rod_client"><a class="anchor" href="#_remote_querying_via_the_hot_rod_client"></a>Remote querying via the Hot Rod client</h4> <div class="paragraph"> <p>Given a <em>RemoteCacheManager</em> configured as previously described the next steps to enable remote query over its caches are:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>add the DSL jar to client&#8217;s classpath, infinispan-remote-query-server.jar to server&#8217;s classpath and infinispan-remote-query-client.jar to both</p> </li> <li> <p>enable indexing in your cache configuration - same as for embedded mode</p> </li> <li> <p>register your protobuf binary descriptor by invoking the '<em>registerProtofile</em>' method of the server&#8217;s <em>ProtobufMetadataManager</em> MBean (one instance per <em>EmbeddedCacheManager</em>)</p> </li> </ol> </div> <div class="paragraph"> <p>All data placed in cache now is being indexed without the need to annotate your entities for Hibernate Search. In fact these classes are only meaningful to the Java client and do not even exist on the server.</p> </div> <div class="paragraph"> <p>Running the queries over the Hot Rod client is now very similar to embedded mode. The DSL is in fact the same. The only part that is slightly different is how you obtain the <em>QueryFactory</em>:</p> </div> <div class="paragraph"> <p>__</p> </div> <div class="literalblock"> <div class="content"> <pre>import org.infinispan.client.hotrod.Search;&#x000A;  import org.infinispan.query.dsl.QueryFactory;&#x000A;  import org.infinispan.query.dsl.Query;&#x000A;  ...&#x000A;  &#x000A;  remoteCache.put(2, new User("John", "Doe", 33));&#x000A;  &#x000A;  QueryFactory qf = Search.getQueryFactory(remoteCache);&#x000A;  &#x000A;  Query query = qf.from(User.class)&#x000A;      .having("name").eq("John")&#x000A;      .toBuilder().build();&#x000A;  &#x000A;  List list = query.list();&#x000A;  assertEquals(1, list.size());&#x000A;  assertEquals("John", list.get(0).getName());&#x000A;  assertEquals("Doe", list.get(0).getSurname());</pre> </div> </div> <div class="paragraph"> <p>__</p> </div> <div class="paragraph"> <p><em> </em> </p> </div> <div class="paragraph"> <p>Voila! The end of our journey for today! Stay tuned, keep an eye on Infinispan Query and please share your comments with us.</p> </div> </div> </div> <em>Posted by Unknown on 2013-09-26</em> <br> <em>Tags:</em> <a href="/blog/tags/ protostream/"> protostream </a> <a href="/blog/tags/hotrod/"> hotrod </a> <a href="/blog/tags/lucene/"> lucene </a> <a href="/blog/tags/Protobuf/"> Protobuf </a> <a href="/blog/tags/remote query/"> remote query </a> <a href="/blog/tags/hibernate search/"> hibernate search </a> <a href="/blog/tags/embedded query/"> embedded query </a> <a href="/blog/tags/Infinispan Query/"> Infinispan Query </a> <a href="/blog/tags/DSL/"> DSL </a> <hr> <div class="pagination-links"><span class="current-page">1</span> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://infinispan.org/blog/" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>