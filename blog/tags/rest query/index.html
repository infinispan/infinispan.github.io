<!DOCTYPE html> <html lang="en"> <head> <title>Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Friday, 09 February 2018 </h3> <h1> <a href="/blog/2018/02/09/restful-queries-coming-to-infinispan-92/">RESTful queries coming to Infinispan 9.2</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>One of the interesting features in the upcoming Infinispan 9.2 release is the possibility to execute queries over the REST endpoint, enabling users to take advantage of the easy-to-use and expressiveness of the Ickle query language, that combines a subset of JP-QL with full-text features. You can learn more info about Ickle in a <a href="http://blog.infinispan.org/2016/12/meet-ickle.html">previous post</a>.</p> </div> <div class="paragraph"> <p>Besides exposing query over REST, Infinispan 9.2 also adds support for mapping between JSON and Protobuf formats, allowing an efficient storage in binary format while exposing queries, reading and writing content as JSON documents.</p> </div> <div class="paragraph"> <p>To illustrate those new capabilities, this post will walk you through a sample app from scratch!</p> </div> <div class="paragraph"> <p>=== Sample app</p> </div> <div class="exampleblock"> <div class="content"> <div class="paragraph"> <p>Running the server</p> </div> <div class="paragraph"> <p>We start by <a href="https://github.com/jboss-dockerfiles/infinispan/tree/master/server">running</a> the Infinispan Server 9.2.0.CR2 (the latest release candidate):</p> </div> <div class="paragraph"> <p>This will get you a fresh instance of Infinispan running, with login and password 'user' and the REST port 8080 mapped to localhost. TIP: if you run more than one container, they&#8217;ll form a cluster automatically.</p> </div> <div class="paragraph"> <p>===== Creating an indexed cache</p> </div> <div class="paragraph"> <p>Next step is to create an indexed cache called 'pokemon'. We make use of the CLI  (Command Line Interface) to create this cache. In the future, with <a href="https://issues.jboss.org/browse/ISPN-8529">ISPN-8529</a>, we&#8217;ll also be able to create cache with arbitrary configuration using REST, but for now we execute a CLI recipe:</p> </div> <div class="paragraph"> <p>===== Creating the schema</p> </div> <div class="paragraph"> <p>In order to be able to query, we need to define a protobuf schema for our data. The schema follows the Protobuf 2 format (Protobuf 3 support is coming) and allows for extensions to define indexing properties (analyzers, storage, etc).</p> </div> <div class="paragraph"> <p>Here&#8217;s how it looks like:</p> </div> <div class="paragraph"> <p>The protobuf schema can contain some comments on top of fields and messages with "annotations" to control indexing. Hibernate Search users will recognize some of those pseudo annotations we are using here: they resemble closely their counterpart.</p> </div> <div class="paragraph"> <p>===== Registering the schema</p> </div> <div class="paragraph"> <p>Once we have our schema, we can easily register it via REST:</p> </div> </div> </div> <div class="paragraph"> <p>Populating the cache</p> </div> <div class="paragraph"> <p>We&#8217;re now ready to put some data in the cache. As mentioned earlier, ingesting can be done by sending JSON documents directly. Once Infinispan receives those documents, it will convert them to protobuf, index and store them.</p> </div> <div class="paragraph"> <p>In order to match a particular inbound document to an entity in the schema, Infinispan uses a special meta field called <strong><em>_type</em></strong> that must be provided in the document. Here&#8217;s an example of a JSON document that conforms to our schema:</p> </div> <div class="paragraph"> <p>Writing the document is easy:</p> </div> <div class="paragraph"> <p>we can retrieve content by key as JSON:</p> </div> </div> </div> <div class="sect4"> <h5 id="_querying"><a class="anchor" href="#_querying"></a>Querying</h5> <div class="paragraph"> <p>The new query endpoint can be called with an "action" parameter named "search", after the cache name. The simplest query, which returns all data can be done with:</p> </div> <div class="paragraph"> <p><a href="http://localhost:8080/rest/pokemon?action=search&amp;query=from%20Pokemon">http://localhost:8080/rest/pokemon?action=search&amp;query=from</a></p> </div> <div class="paragraph"> <p>If you do not want to return all the fields, use a <em>Select</em> clause:</p> </div> <div class="paragraph"> <p><a href="http://localhost:8080/rest/pokemon?action=search&amp;query=Select%20name,%20speed%20from%20Pokemon">http://localhost:8080/rest/pokemon?action=search&amp;query=Select</a></p> </div> <div class="paragraph"> <p>Pagination can be controlled with the <em>offset</em>, <em>max_results</em> URL parameters:</p> </div> <div class="paragraph"> <p><a href="http://localhost:8080/rest/pokemon?action=search&amp;query=from%20Pokemon&amp;offset=2&amp;max_results=20">http://localhost:8080/rest/pokemon?action=search&amp;query=from</a></p> </div> <div class="paragraph"> <p>Grouping is also possible:</p> </div> <div class="paragraph"> <p><a href="http://localhost:8080/rest/pokemon?action=search&amp;query=select%20count(p.name)%20from%20Pokemon%20p%20group%20by%20generation">http://localhost:8080/rest/pokemon?action=search&amp;query=select</a></p> </div> <div class="paragraph"> <p>Example of a query result:</p> </div> <div class="paragraph"> <p><a href="http://localhost:8080/rest/pokemon?action=search&amp;query=select%20name,pokedex_number,against_fire%20from%20Pokemon%20order%20by%20against_fire%20asc&amp;max_results=5">http://localhost:8080/rest/pokemon?action=search&amp;query=select</a></p> </div> <div class="paragraph"> <p>Results:</p> </div> </div> <div class="sect2"> <h3 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h3> </div> <div class="sect2"> <h3 id=""><a class="anchor" href="#"></a> </h3> <div class="paragraph"> <p>Infinispan 9.2 makes it easier to quickly ingest and query datasets using the ubiquitous JSON format, without sacrificing type safety and storage size.</p> </div> <div class="paragraph"> <p>By storing Protobuf, this will also enable other clients like the Hot Rod C#/C++ clients to query, read and write data simultaneously with REST clients.</p> </div> <div class="paragraph"> <p>The full source code for the demo, along with instructions on how to populate the whole dataset can be found at <a href="https://github.com/infinispan-demos/infinispan-pokemon">Github</a>.</p> </div> <div class="paragraph"> <p>Finally, please try out this new feature in your own dataset and let us know how it goes!</p> </div> </div> </div> <a class="label" href="/blog/tags/rest query/"> rest query </a> <a class="label" href="/blog/tags/9.2/"> 9.2 </a> <a class="label" href="/blog/tags/Protobuf/"> Protobuf </a> <a class="label" href="/blog/tags/JSON/"> JSON </a> <a class="label" href="/blog/tags/query/"> query </a> <hr> <div class="post"></div> <h3> Tuesday, 14 November 2017 </h3> <h1> <a href="/blog/2017/11/14/infinispan-920beta1-and-913final-have/">Infinispan 9.2.0.Beta1 and 9.1.3.Final have been released</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear Infinispan Community,</p> </div> <div class="paragraph"> <p>Two new releases are ready for you today, our newest and greatest 9.2.0.Beta1 and an updated Final of our stable branch, 9.1.3. Both can be found as usual on our download <a href="http://infinispan.org/download/">page</a>.</p> </div> <div class="paragraph"> <p>The highlights of 9.2.0.Beta1 are:</p> </div> <div class="ulist"> <ul> <li> <p>New API for querying using Ickle via the REST server, taking advantage of the JSON/Protobuf interoperability [<a href="https://issues.jboss.org/browse/ISPN-8113">ISPN-8113</a>].</p> </li> <li> <p>Clustered Locks, first experimental release. A <em>ClusteredLock</em> is a data structure used for concurrent programming between Infinispan instances in cluster mode.</p> </li> <li> <p>Clustered Counters have received serveral improvements. It&#8217;s now possible to manage your counters via JMX [<a href="https://issues.jboss.org/browse/ISPN-7926">ISPN-7926</a>] and other management methods are on the way. The strong counter has a new method: <em>compare-and-swap</em> [<a href="https://issues.jboss.org/browse/ISPN-8489">ISPN-8489</a>]. If you used <em>compare-and-set</em>, the <em>compare-and-swap</em> may improve your code performance. And last but not least, a new <em>sync()</em> method was added to the strong and weak counters, useful if you don&#8217;t want to handle the CompletableFuture! <a href="https://issues.jboss.org/browse/ISPN-8379" class="bare">https://issues.jboss.org/browse/ISPN-8379</a></p> </li> <li> <p>Clustered Cache Configuration: Both <em>EmbeddedCacheManager</em> and <em>RemoteCacheManager</em> now have an API for creating/removing caches across the cluster [<a href="https://issues.jboss.org/browse/ISPN-7776">ISPN-7776</a>]. Caches created with this API will also be created on any new members that will join the cluster. Additionally, the configuration for caches created in this way can be made persistent so that they are automatically recreated when a cluster restarts.</p> </li> <li> <p>Server deployment of Lucene analyzers for remote query [<a href="https://issues.jboss.org/browse/ISPN-7714">ISPN-7714</a>]. <a href="https://issues.jboss.org/browse/ISPN-7865" class="bare">https://issues.jboss.org/browse/ISPN-7865</a></p> </li> </ul> </div> <div class="paragraph"> <p>9.1.3.Final and 9.2.0.Beta1 both add several Off-heap improvements and fixes.</p> </div> <div class="paragraph"> <p>Full details of the new features and enhancements included in these two releases can be found <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12335607">here</a> and <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12335980">here</a>.</p> </div> <div class="paragraph"> <p>We have even more exciting stuff coming up for Infinispan 9.2. Thank you for following us and stay tuned!</p> </div> <div class="paragraph"> <p>The Infinispan Team</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/Ickle/"> Ickle </a> <a class="label" href="/blog/tags/rest query/"> rest query </a> <a class="label" href="/blog/tags/clustered cache configuration/"> clustered cache configuration </a> <a class="label" href="/blog/tags/9.2/"> 9.2 </a> <a class="label" href="/blog/tags/9.1/"> 9.1 </a> <a class="label" href="/blog/tags/clustered counters/"> clustered counters </a> <a class="label" href="/blog/tags/beta release/"> beta release </a> <a class="label" href="/blog/tags/clustered locks/"> clustered locks </a> <hr> <div class="pagination-links"><span class="current-page">1</span> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>