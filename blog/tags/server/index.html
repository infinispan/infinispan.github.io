<!DOCTYPE html> <html lang="en"> <head> <title> Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script crossorigin="anonymous" src="https://kit.fontawesome.com/4167a38cfa.js"></script> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <link href="/feed.atom" rel="alternate" type="application/atom+xml"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Friday, 01 November 2019 </h3> <h1> <a href="/blog/2019/11/01/serverng/">Infinispan's new server</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>One of the biggest changes in Infinispan 10 is the new server, which replaces the WildFly-based server we had been using up until 9.x.</p> </div> <div class="paragraph"> <p>This is the first of a series of blog posts which will describe the new server, how to use it, how to configure it and how to deploy it in your environment. More specifically, this post will focus mostly on the reasons behind the change, while the next ones will be of a more practical nature.</p> </div> </div> </div> <div class="sect1"> <h2 id="_a_history_of_servers"><a class="anchor" href="#_a_history_of_servers"></a>A history of servers</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan has had a server implementing the Hot Rod protocol since 4.1. Originally it was just a main class which bootstrapped the server protocol. It was configured via the same configuration file used by the embedded library, it had no security and only handled Hot Rod.</p> </div> <div class="paragraph"> <p>Over time both a RESTful HTTP and a Memcached protocol were added and could be bootstrapped in the same way.</p> </div> <div class="paragraph"> <p>While the server bootstrap code was trivial, it was not going to scale to support all the things we needed (security, management, provisioning, etc). We therefore decided to build our next server on top of the very robust foundation provided by WildFly (aka, the application server previously known as JBoss AS 7), which made its first appearance in 5.3.</p> </div> <div class="paragraph"> <p>Integration with WildFly&#8217;s management model was not trivial but it gave us all of the things we were looking for and more, such as deployments, data sources, CLI, console, etc. It also came with a way to provision multiple nodes and manage them from a central controller, i.e. domain mode. All of these facilities however came at the cost of a lot of extra integration code to maintain as well as a larger footprint, both in terms of memory and storage use, caused by a number of subsystems which we had to carry along, even though we didn&#8217;t use them directly.</p> </div> </div> </div> <div class="sect1"> <h2 id="_a_different_server"><a class="anchor" href="#_a_different_server"></a>A different server</h2> <div class="sectionbody"> <div class="paragraph"> <p>Fast-forward several versions, and the computing landscape has changed considerably: services are containerized, they are provisioned and managed via advanced orchestration tools like Kubernetes or via configuration management tools like Ansible and the model we were using was overlapping (if not altogether clashing) with the container model, where global configuration is immutable and managed externally.</p> </div> <div class="paragraph"> <p>With the above in mind, we have therefore decided to <em>reboot</em> our server implementation. During planning and development it has been known affectionately as <em>ServerNG</em>, but nowadays it is just the <em>Infinispan Server</em>. The WildFly-based server is now the <em>legacy server</em>.</p> </div> <div class="sect2"> <h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3> <div class="paragraph"> <p>The new server separates global configuration (clustering, endpoints, security) from the configuration of dynamic resources like caches, counters, etc. This means that global configuration can be made immutable while the ,mutable configuration is stored separately in the global persistence location. In a containerized environment you will place the persistence location onto a volume that will survive restarts.</p> </div> </div> </div> </div> <h1 id="_a_quick_two_node_cluster_with_docker" class="sect0"><a class="anchor" href="#_a_quick_two_node_cluster_with_docker"></a>A quick two-node cluster with Docker</h1> <div class="openblock partintro"> <div class="content"> <div class="paragraph"> <p>Starting a two-node cluster using the latest version of the server image is easy:</p> </div> <div class="listingblock"> <div class="content"> <pre>$ docker run --name ispn1 --hostname ispn1 -e USER=admin -e PASS=admin -p 11222:11222 infinispan/server&#x000A;  $ docker run --name ispn2 --hostname ispn2 -e USER=admin -e PASS=admin -p 11322:11222 infinispan/server</pre> </div> </div> <div class="paragraph"> <p>The two nodes will discover each other, as can be seen from the logs:</p> </div> <div class="listingblock"> <div class="content"> <pre>15:58:21,201 INFO  [org.infinispan.CLUSTER] (jgroups-5,ispn-1-42736) ISPN000094: Received new cluster view for channel infinispan: [ispn-1-42736|1] (2) [ispn-1-42736, ispn-2-51789]&#x000A;  15:58:21,206 INFO  [org.infinispan.CLUSTER] (jgroups-5,ispn-1-42736) ISPN100000: Node ispn-2-51789 joined the cluster</pre> </div> </div> <div class="paragraph"> <p>Next we will connect to the cluster using the CLI:</p> </div> <div class="listingblock"> <div class="content"> <pre>$ docker run -it --rm infinispan/server /opt/infinispan/bin/cli.sh&#x000A;  [disconnected]&gt; connect http://172.17.0.2:11222&#x000A;  Username: admin&#x000A;  Password: *****&#x000A;  [ispn-1-42736@infinispan//containers/DefaultCacheManager]&gt;</pre> </div> </div> <div class="paragraph"> <p>Next we will create a distributed cache and select it for future operations:</p> </div> <div class="listingblock"> <div class="content"> <pre>[ispn-1-42736@infinispan//containers/DefaultCacheManager]&gt; create cache --template=org.infinispan.DIST_SYNC distcache&#x000A;  [ispn-1-42736@infinispan//containers/DefaultCacheManager]&gt; cache distcache&#x000A;  [ispn-1-42736@infinispan//containers/DefaultCacheManager/caches/distcache]&gt;</pre> </div> </div> <div class="paragraph"> <p>Let&#8217;s insert some data now:</p> </div> <div class="listingblock"> <div class="content"> <pre>[ispn-1-42736@infinispan//containers/DefaultCacheManager/caches/distcache]&gt; put k1 v1&#x000A;  [ispn-1-42736@infinispan//containers/DefaultCacheManager/caches/distcache]&gt; put k2 v2&#x000A;  [ispn-1-42736@infinispan//containers/DefaultCacheManager/caches/distcache]&gt; ls&#x000A;  k2&#x000A;  k1&#x000A;  [ispn-1-42736@infinispan//containers/DefaultCacheManager/caches/distcache]&gt; get k1&#x000A;  v1</pre> </div> </div> <div class="paragraph"> <p>Now let&#8217;s use the RESTful API to fetch one of the entries:</p> </div> <div class="listingblock"> <div class="content"> <pre>$ curl --digest -u admin:admin http://localhost:11222/rest/v2/caches/distcache/k2&#x000A;  v2</pre> </div> </div> <div class="paragraph"> <p>Since we didn&#8217;t map persistent volumes to our containers, both the cache and its contents will be lost when we terminate the containers.</p> </div> <div class="paragraph"> <p>In the next blog post we will look at configuration and persistence in more depth.</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Tuesday, 24 July 2018 </h3> <h1> <a href="/blog/2018/07/24/infinispan-spark-connector-08-relased/">Infinispan Spark connector 0.8 released</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The Infinispan Spark connector version 0.8 has been released and is available in Maven central and <a href="https://spark-packages.org/?q=infinispan-spark">SparkPackages</a>.</p> </div> <div class="paragraph"> <p>This is a maintenance only release to bring compatibility with Spark 2.3 and Infinispan 9.3.</p> </div> <div class="paragraph"> <p>For more information about the connector, please consult the <a href="https://github.com/infinispan/infinispan-spark">documentation</a> and also try the docker based <a href="https://github.com/infinispan/infinispan-spark/tree/master/examples/twitter">sample.</a></p> </div> <div class="paragraph"> <p>For feedback and general help, please use the Infinispan <a href="https://infinispan.zulipchat.com/">chat.</a></p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 07 March 2018 </h3> <h1> <a href="/blog/2018/03/07/rest-with-http2/">REST with HTTP/2</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>HTTP has become one of the most successful and heavily used network protocols around the world. Version 1.0 was created in 1996 and received a minor update 3 years later. But it took more than a decade to create HTTP/2 (which was approved in 2015). Why did it take so long? Well, I wouldn’t tell you all the truth if I didn’t mention an <a href="https://developers.google.com/web/fundamentals/performance/http2/">experimental protocol, called SPDY</a>. SPDY was primarily focused on improving performance. The initial results were very promising and inside Google’s lab, the developers <a href="https://blog.chromium.org/2009/11/2x-faster-web.html">measured 55% speed improvement</a>. This work and experience was converted into HTTP/2 proposal back in 2012. A few years later, we can all use HTTP/2 (sometimes called h2) along with its older brother - HTTP/1.1.</p> </div> </div> </div> <div class="sect1"> <h2 id="_main_differences_between_http1_1_and_http2"><a class="anchor" href="#_main_differences_between_http1_1_and_http2"></a>Main differences between HTTP/1.1 and HTTP/2</h2> <div class="sectionbody"> <div class="paragraph"> <p><span class="image"><img src="https://lh6.googleusercontent.com/QGDSTl40Vz0ROc0koZA_QWHQ_yGB1M_rEISrd42_mQv4MA9WJCUyag6RUsfTkCx0juSiZnbGiTXLvJDr86REpdAPWDEfntqVjaXh8zN3uDf3J1qRugr9nsk3wfqCR4WkZ1jLtg-s" alt="image" width="624" height="515"></span></p> </div> <div class="paragraph"> <p>HTTP/1.1 is a text-based protocol. Sometimes this is very convenient, since you can use low level tools, such as Telnet, for hacking. But it doesn’t work very well for transporting large, binary payloads. HTTP/2 solves this problem by using a completely redesigned architecture. Each HTTP message (a request or a response) consists of one or more frames. A frame is the smallest portion of data travelling through a TCP connection. A set of messages is aggregated into a, so called stream.</p> </div> <div class="paragraph"> <p><span class="image"><img src="https://lh3.googleusercontent.com/PYdtYy6RLlUFY3pUVfg-E_5_AomfRZW9O1EHTkytWnkKDXhlCkjsf-D4N7_CiG9AndYDZ7tAYTkrMQEeDi56PvcnvPaZ-9YNqswuTtqUY0IsTzo6UtXJrInhTKTc_SzGy-Zh_u0V" alt="image" width="624" height="171"></span></p> </div> <div class="paragraph"> <p>HTTP/2 allows to lower the number of physical connections between the server and the client by multiplexing logical connections into one TCP connection. Streams allow the server to recognize, which frame belongs to which conversation.</p> </div> <div class="sect4"> <h5 id="_how_to_connect_using_http2"><a class="anchor" href="#_how_to_connect_using_http2"></a>How to connect using HTTP/2?</h5> <div class="paragraph"> <p>There are two ways for starting an HTTP/2 conversation.</p> </div> <div class="paragraph"> <p>The first one, and the most commonly used one, is <a href="https://tools.ietf.org/html/rfc7301">TLS/ALPN</a>. During TLS handshake the server and the client negotiate protocol for further communication. Unfortunately JDK below 9 doesn’t support it by default (there are a couple of workarounds but please refer to your favorite HTTP client’s manual to find some suggestions).</p> </div> <div class="paragraph"> <p>The second one, much less popular, is so called plain text upgrade. During HTTP/1.1 conversation, the client issues an HTTP/1.1 Upgrade header and proposes new conversation protocol. If the server agrees, they start using it. If not, they stick with HTTP/1.1.</p> </div> <div class="paragraph"> <p>The good news is that Infinispan supports both those upgrade paths. Thanks to the ALPN Hack Engine (the credit goes to Stuart Douglas from the Wildfly Team), we support TLS/ALPN without any bootstrap classpath modification.</p> </div> </div> <div class="sect4"> <h5 id="_configuring_infinispan_server_for_http2"><a class="anchor" href="#_configuring_infinispan_server_for_http2"></a>Configuring Infinispan server for HTTP/2</h5> <div class="paragraph"> <p>Infinispan’s REST server already supports plain text upgrades out of the box. TLS/ALPN however, requires additional configuration since the server needs to use a Keystore. In order to make it even more convenient, we support <a href="http://infinispan.org/docs/stable/server_guide/server_guide.html#security:hotrod_rest_encryption">generating keystores automatically when needed</a>. Here’s an example showing how to configure a security realm:</p> </div> <div class="paragraph"> <p>The next step is to bind the security realm to a REST endpoint:</p> </div> <div class="paragraph"> <p>You may also use one of our configuration examples. The easiest way to get it working is to use our <a href="https://github.com/jboss-dockerfiles/infinispan/tree/master/server">Docker image</a>:</p> </div> <div class="paragraph"> <p>Let’s explain a couple of things from the command above:</p> </div> <div class="ulist"> <ul> <li> <p>-e "APP_USER=test" - This is a user name we will be used for REST authentication.</p> </li> <li> <p>-e "APP_PASS=test" - Corresponding password.</p> </li> <li> <p>../../docs/examples/configs/standalone-rest-ssl.xml - Here is a ready-to-go configuration with REST and TLS/ALPN support</p> </li> </ul> </div> <div class="paragraph"> <p>Unfortunately, HTTP/2 functionality <a href="https://issues.jboss.org/browse/ISPN-8896">has been broken in 9.2.0.Final</a>. But we promise to fix it as soon as we can :) Please use 9.1.5.Final in the meantime.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_testing_using_curl"><a class="anchor" href="#_testing_using_curl"></a>Testing using CURL</h2> <div class="sectionbody"> <div class="paragraph"> <p><a href="https://linux.die.net/man/1/curl">Curl</a> is one of my favorite tools. It’s very simple, powerful, and… it supports HTTP/2. Assuming that you already started Infinispan server using <code>docker run</code> command, you can put something into the cache:</p> </div> <div class="paragraph"> <p>Once, it’s there, let’s try to get it back:</p> </div> <div class="paragraph"> <p>Let’s analyze CURL switches one by one:</p> </div> <div class="ulist"> <ul> <li> <p>-k - Ignores certificate validation. All automatically generated certificates and self-signed and not trusted by default.</p> </li> <li> <p>-v - Debug logging.</p> </li> <li> <p>-u test:test - Username and password for authentication.</p> </li> <li> <p>-d test - This is the payload when invoking HTTP POST.</p> </li> <li> <p>-H “Accept: text/plain” - This tells the server what type of data we’d like to get in return.</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="_conclusions_and_links"><a class="anchor" href="#_conclusions_and_links"></a>Conclusions and links</h2> <div class="sectionbody"> <div class="paragraph"> <p>I hope you enjoyed this small tutorial about HTTP/2. I highly encourage you to have a look at the links below to learn some more things about this topic. You may also measure the performance of your app when using HTTP/1.1 and HTTP/2. You will be surprised!</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://hpbn.co/">High Performance Browser Networking</a> - One of the best books about HTTP and network performance. Most of the graphics in this article has been copied from that book. I highly recommend it!</p> </li> <li> <p><a href="https://linux.die.net/man/1/curl">Curl manual</a></p> </li> <li> <p><a href="https://hub.docker.com/r/jboss/infinispan-server/">Infinispan on Docker Hub</a></p> </li> </ul> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Sunday, 10 September 2017 </h3> <h1> <a href="/blog/2017/09/10/multi-tenancy-infinispan-as-service/">Multi-tenancy - Infinispan as a Service (also on OpenShift)</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>In recent years Software as a Service concept has gained a lot of traction. I&#8217;m pretty sure you&#8217;ve used it many times before. Let&#8217;s take a look at a practical example and explain what&#8217;s going on behind the scenes.</p> </div> </div> </div> <div class="sect4"> <h5 id="_practical_example_photo_album_application"><a class="anchor" href="#_practical_example_photo_album_application"></a>Practical example - photo album application</h5> <div class="paragraph"> <p>Imagine a very simple photo album application hosted within the cloud. Upon the first usage you are asked to create an account. Once you sign up, a new tenant is created for you in the application with all necessary details and some dedicated storage just for you. Starting from this point you can start using the album - download and upload photos. </p> </div> <div class="paragraph"> <p>The software provider that created the photo album application can also celebrate. They have a new client! But with a new client the system needs to increase its capacity to ensure it can store all those lovely photos. There are also other concerns - how to prevent leaking photos and other data from one account into another? And finally, since all the content will be transferred through the Internet, how to secure transmission?</p> </div> <div class="paragraph"> <p>As you can see, multi-tenancy is not that easy as it would seem. The good news is that if it&#8217;s properly configured and secured, it might be beneficial both for the client and for the software provider. </p> </div> </div> <div class="sect4"> <h5 id="_multi_tenancy_in_infinispan"><a class="anchor" href="#_multi_tenancy_in_infinispan"></a>Multi-tenancy in Infinispan</h5> <div class="paragraph"> <p>Let&#8217;s think again about our photo album application for a moment. Whenever a new client signs up we need to create a new account for him and dedicate some storage. Translating that into Infinispan concepts this would mean creating a new <a href="https://docs.jboss.org/infinispan/9.1/apidocs/org/infinispan/manager/CacheContainer.html">CacheContainer</a>. Within a CacheContainer we can create multiple Caches for user details, metadata and photos. You might be wondering why creating a new <a href="https://docs.jboss.org/infinispan/9.1/apidocs/org/infinispan/Cache.html">Cache</a> is not sufficient? It turns out that when a Hot Rod client connects to a cluster, it connects to a CacheContainer exposed via a Hot Rod Endpoint. Such a client has access to all Caches. Considering our example, your friends could possibly see your photos. That&#8217;s definitely not good! So we need to create a CacheContainer per tenant. Before we introduced Multi-tenancy, you could expose each CacheContainer using a separate port (using separate Hot Rod Endpoint for each of them). In many scenarios this is impractical because of proliferation of ports. For this reason we introduced the Router concept. It allows multiple clients to access their own CacheContainers through a single endpoint and also prevents them from accessing data which doesn&#8217;t belong to them. The final piece of the puzzle is transmitting sensitive data through an unsecured channel such as the Internet. The use of TLS encryption solves this problem. The final outcome should look like the following:</p> </div> <div class="paragraph"> <p><a href="https://4.bp.blogspot.com/-9gJn1KCZK1Y/WUjMfn5VKXI/AAAAAAAAJrg/m6QfOjXjpPU6mfAsvn3kGnt5YYFOas1iQCLcBGAs/s1600/multiple-data-containers-and-router.png"><span class="image"><img src="https://4.bp.blogspot.com/-9gJn1KCZK1Y/WUjMfn5VKXI/AAAAAAAAJrg/m6QfOjXjpPU6mfAsvn3kGnt5YYFOas1iQCLcBGAs/s320/multiple-data-containers-and-router.png" alt="image" width="320" height="170"></span></a></p> </div> <div class="paragraph"> <p>The Router component on the diagram above is responsible for recognizing data from each client and redirecting it to the appropriate Hot Rod endpoint. As the name implies, the router inspects incoming traffic and reroutes it to the appropriate underlying CacheContainer. To do this it can use two different strategies depending on the protocol: <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">TLS/SNI</a> for the Hot Rod protocol, matching each server certificate to a specific cache container  and path prefixes for REST. The SNI strategy detects the SNI Host Name (which is used as tenant) and also requires TLS certificates to match. By creating proper trust stores we can match which tenant can access which CacheContainers. URL path prefix is very easy to understand, but it is also less secure unless you enable authentication. For this reason it should not be used in production unless you know what you are doing (the SNI strategy for the REST endpoint will be implemented in the near future). Each client has its own unique REST path prefix that needs to be used for accessing the data (e.g. <em><a href="http://127.0.0.1:8080/rest/" class="bare">http://127.0.0.1:8080/rest/</a><strong>client1</strong>/fotos/2</em>).</p> </div> <div class="paragraph"> <p>Confused? Let&#8217;s clarify this with an example.</p> </div> </div> <div class="sect4"> <h5 id="_foto_application_sample_configuration"><a class="anchor" href="#_foto_application_sample_configuration"></a>Foto application sample configuration</h5> <div class="paragraph"> <p>The first step is to generate proper key/trust stores for the server and client:</p> </div> <div class="paragraph"> <p>The next step is to configure the server. The snippet below shows only the most important parts:</p> </div> <div class="paragraph"> <p>Let&#8217;s analyze the most critical lines:</p> </div> <div class="ulist"> <ul> <li> <p>7, 15 - We need to add generated key stores to the server identities</p> </li> <li> <p>25, 30 - It is highly recommended to use separate CacheContainers</p> </li> <li> <p>38, 39 - A Hot Rod connector (but without socket binding) is required to provide proper mapping to CacheContainer. You can also use many useful settings on this level (like ignored caches or authentication).</p> </li> <li> <p>42 - Router definition which binds into default Hot Rod and REST ports.</p> </li> <li> <p>44 - 46 - The most important bit which states that only a client using <em>SSLRealm1</em> (which uses trust store corresponding to <em>client_1_server_keystore.jks</em>) and TLS/SNI Host name <em>client-1</em> can access Hot Rod endpoint named <em>multi-tenant-hotrod-1</em> (which points to CacheContainer <em>multi-tenancy-1</em>).</p> </li> </ul> </div> </div> <div class="sect4"> <h5 id="_improving_the_application_by_using_openshift"><a class="anchor" href="#_improving_the_application_by_using_openshift"></a>Improving the application by using OpenShift</h5> <div class="paragraph"> <p><em>Hint: You might be interested in looking at our previous blog posts about hosting Infinispan on OpenShift. You may find them at the bottom of the page.</em></p> </div> <div class="paragraph"> <p>So far we&#8217;ve learned how to create and configure a new CacheContainer per tenant. But we also need to remember that system capacity needs to be increased with each new tenant. OpenShift is a perfect tool for scaling the system up and down. The configuration we created in the previous step almost matches our needs but needs some tuning.</p> </div> <div class="paragraph"> <p>As we mentioned earlier, we need to encrypt transport between the client and the server. The main disadvantage is that OpenShift Router will not be able to inspect it and take routing decisions. A <a href="https://docs.openshift.org/latest/architecture/core_concepts/routes.html#secured-routes">passthrough Route</a> fits perfectly in this scenario but requires creating TLS/SNI Host Names as Fully Qualified Application Names. So if you start OpenShift locally (using <em>oc cluster up</em>) the tenant names will look like the following: <em>client-1-fotoalbum.192.168.0.17.nip.io</em>. </p> </div> <div class="paragraph"> <p>We also need to think how to store generated key stores. The easiest way is to use <a href="https://docs.openshift.org/latest/dev_guide/secrets.html">Secrets</a>:</p> </div> <div class="paragraph"> <p>Finally, a full DeploymentConfiguration:</p> </div> <div class="paragraph"> <p>If you&#8217;re interested in playing with the demo by yourself, you might find a working example <a href="https://github.com/infinispan-demos/infinispan-openshift-multitenancy">here</a>. It mainly targets OpenShift but the concept and configuration are also applicable for local deployment.</p> </div> </div> <div class="sect4"> <h5 id="_links"><a class="anchor" href="#_links"></a>Links</h5> <div class="ulist"> <ul> <li> <p><a href="http://blog.infinispan.org/2016/08/running-infinispan-cluster-on-openshift.html">Running Infinispan cluster on OpenShift</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2016/09/configuration-management-on-openshift.html">Configuration management on OpenShift, Kubernetes and Docker</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2017/03/checking-infinispan-cluster-health-and.html">Checking Infinispan cluster health and Kubernetes/OpenShift</a></p> </li> <li> <p><a href="https://github.com/infinispan-demos/infinispan-openshift-multitenancy">Source code for the demo</a></p> </li> </ul> </div> </div> </div> <hr> <div class="post"></div> <h3> Monday, 03 April 2017 </h3> <h1> <a href="/blog/2017/04/03/infinispan-spark-connector-05-released/">Infinispan Spark connector 0.5 released!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The Infinispan Spark connector offers seamless integration between Apache Spark and Infinispan Servers. Apart from supporting Infinispan 9.0.0.Final and Spark 2.1.0, this release brings many usability improvements, and support for another major Spark API.</p> </div> </div> </div> <div class="sect3"> <h4 id="_configuration_changes"><a class="anchor" href="#_configuration_changes"></a>Configuration changes</h4> <div class="paragraph"> <p>The connector no longer uses a <em>java.util.Properties</em> object to hold configuration, that&#8217;s now duty of <em>org.infinispan.spark.config.ConnectorConfiguration</em>, type safe and both Java and Scala friendly:</p> </div> </div> <div class="sect3"> <h4 id=""><a class="anchor" href="#"></a> </h4> </div> <div class="sect3"> <h4 id="_filtering_by_query_string"><a class="anchor" href="#_filtering_by_query_string"></a>Filtering by query String</h4> <div class="paragraph"> <p>The previous version introduced the possibility of filtering an InfinispanRDD by providing a <em>Query</em> instance, that required going through the QueryDSL which in turn required a properly configured remote cache.</p> </div> <div class="paragraph"> <p>It&#8217;s now possible to simply use an Ickle query string:</p> </div> </div> <div class="sect3"> <h4 id="_improved_support_for_protocol_buffers"><a class="anchor" href="#_improved_support_for_protocol_buffers"></a>Improved support for Protocol Buffers</h4> <div class="paragraph"> <p>Support for reading from a Cache with protobuf encoding was present in the previous connector version, but now it&#8217;s possible to also write using protobuf encoding and also have protobuf schema registration automatically handled.</p> </div> <div class="paragraph"> <p>To see this in practice, consider an arbitrary non-Infinispan based <em>RDD&lt;Integer, Hotel&gt;</em> where Hotel is given by:</p> </div> <div class="paragraph"> <p>In order to write this RDD to Infinispan it&#8217;s just a matter of doing:</p> </div> <div class="paragraph"> <p>Internally the connector will trigger the auto-generation of the <em>.proto</em> file and message marshallers related to the configured entity(ies) and will handle registration of schemas in the server prior to writing.</p> </div> </div> <div class="sect3"> <h4 id="_splitter_is_now_pluggable"><a class="anchor" href="#_splitter_is_now_pluggable"></a>Splitter is now pluggable</h4> <div class="paragraph"> <p>The <em>Splitter</em> is the interface responsible to create one or more partitions from a Infinispan cache, being each partition related to one or more segments. The Infinispan Spark connector now can be created using a custom implementation of Splitter allowing for different data partitioning strategies during the job processing.</p> </div> </div> <div class="sect3"> <h4 id="_goodbye_scala_2_10"><a class="anchor" href="#_goodbye_scala_2_10"></a>Goodbye Scala 2.10</h4> <div class="paragraph"> <p>Scala 2.10 support was removed, Scala 2.11 is currently the only supported version. Scala 2.12 support will follow <a href="https://issues.apache.org/jira/browse/SPARK-14220" class="bare">https://issues.apache.org/jira/browse/SPARK-14220</a></p> </div> </div> <div class="sect3"> <h4 id="_2"><a class="anchor" href="#_2"></a> </h4> </div> <div class="sect3"> <h4 id="_streams_with_initial_state"><a class="anchor" href="#_streams_with_initial_state"></a>Streams with initial state</h4> <div class="paragraph"> <p>It is possible to configure the <em><span class="pl-en">InfinispanInputDStream</span></em> with an extra boolean parameter to receive the current cache state as events.</p> </div> </div> <div class="sect3"> <h4 id="_3"><a class="anchor" href="#_3"></a> </h4> </div> <div class="sect3"> <h4 id="_dataset_support"><a class="anchor" href="#_dataset_support"></a>Dataset support</h4> <div class="paragraph"> <p>The Infinispan Spark connector now ships with support for Spark&#8217;s Dataset API, with support for pushing down predicates, similar to <em>rdd.filterByQuery</em>. The entry point of this API is the Spark session:</p> </div> <div class="paragraph"> <p>To create an Infinispan based Dataframe, the "infinispan" data source need to be used, along with the usual connector configuration:</p> </div> <div class="paragraph"> <p>From here it&#8217;s possible to use the untyped API, for example:</p> </div> <div class="paragraph"> <p>or execute SQL queries by setting a view:</p> </div> <div class="paragraph"> <p>In both cases above, the predicates and the required columns will be converted to an Infinispan Ickle filter, thus filtering data at the source rather than at Spark processing phase.</p> </div> <div class="paragraph"> <p>For the full list of changes see the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12316820&amp;version=12331257">release notes.</a> For more information about the connector, the <a href="https://github.com/infinispan/infinispan-spark/blob/master/README.md">official documentation</a> is the place to go. Also check the <a href="https://github.com/infinispan/infinispan-spark/tree/master/examples/twitter">twitter data processing sample</a> and to report bugs or request new features use the <a href="https://issues.jboss.org/projects/ISPRK">project JIRA</a>.</p> </div> </div> </div> <hr> <div class="post"></div> <h3> Tuesday, 21 March 2017 </h3> <h1> <a href="/blog/2017/03/21/docker-image-security-changes/">Docker image security changes</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><a href="https://1.bp.blogspot.com/-y_wfaayyDoo/WMu8fNe-DdI/AAAAAAAAAbY/g2zK9M_O4DUnGLoTreUYgEs6Yu5-X1IOQCLcB/s1600/docker.png"><span class="image"><img src="https://1.bp.blogspot.com/-y_wfaayyDoo/WMu8fNe-DdI/AAAAAAAAAbY/g2zK9M_O4DUnGLoTreUYgEs6Yu5-X1IOQCLcB/s320/docker.png" alt="image" width="320" height="158"></span></a></p> </div> <div class="paragraph"> <p>In the latest 9.0.0.CR3 version, the Infinispan REST endpoint is secured by default, and in order to facilitate remote access, the Docker image has some changes related to the security.</p> </div> <div class="paragraph"> <p>The image now creates a default user login upon start; this user can be changed via environment variables if desired:</p> </div> <div class="paragraph"> <p>You can check if the settings are in place by manipulating data via REST. Trying to do a curl without credentials should lead to a 401 response:</p> </div> <div class="paragraph"> <p>So make sure to always include the credentials from now on when interacting with the Rest endpoint! If using curl, this is the syntax:</p> </div> <div class="paragraph"> <p>And that&#8217;s all for this post. To find out more about the Infinispan Docker image, check the <a href="https://github.com/jboss-dockerfiles/infinispan/blob/master/server/README.md">documentation</a>, give it a try and let us know if you have any issues or suggestions!</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Monday, 05 December 2016 </h3> <h1> <a href="/blog/2016/12/05/composing-infinispan-docker-image/">Composing the Infinispan Docker image</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>In the <a href="http://blog.infinispan.org/2016/10/infinispan-docker-image-custom.html">previous</a> post we showed how to manipulate the Infinispan Docker container configuration at both runtime and boot time.</p> </div> <div class="paragraph"> <p>Before diving into multi-host Docker usage, in this post we&#8217;ll explore how to create multi-container Docker applications involving Infinispan with the help of <a href="https://docs.docker.com/compose/">Docker Compose</a>.</p> </div> <div class="paragraph"> <p>For this we&#8217;ll look at a typical scenario of an Infinispan server backed by an Oracle database as a cache store.</p> </div> <div class="paragraph"> <p>All the code for this sample can be found on <a href="https://github.com/gustavonalle/infinispan-docker-compose">github</a>.</p> </div> </div> </div> <div class="sect2"> <h3 id=""><a class="anchor" href="#"></a> </h3> </div> <div class="sect2"> <h3 id="_infinispan_with_oracle_jdbc_cache_store"><a class="anchor" href="#_infinispan_with_oracle_jdbc_cache_store"></a>Infinispan with Oracle JDBC cache store</h3> </div> <div class="sect2"> <h3 id="_2"><a class="anchor" href="#_2"></a> </h3> <div class="paragraph"> <p>In order to have a cache with persistence with Oracle, we need to do some configuration: configure the driver in the server, create the data source associated with the driver, and configure the cache itself with JDBC persistence.</p> </div> <div class="paragraph"> <p>Let&#8217;s take a look at each of those steps:</p> </div> <div class="sect4"> <h5 id="_obtaining_and_configuring_the_driver"><a class="anchor" href="#_obtaining_and_configuring_the_driver"></a>Obtaining and configuring the driver</h5> <div class="paragraph"> <p>The driver (ojdbc6.jar) should be <a href="http://www.oracle.com/technetwork/apps-tech/jdbc-112010-090769.html">downloaded</a> and placed in the 'driver' folder of the sample project.</p> </div> <div class="paragraph"> <p>The module.xml declaration used to make it available on the server is as follows:</p> </div> </div> <div class="sect4"> <h5 id="_configuring_the_data_source"><a class="anchor" href="#_configuring_the_data_source"></a>Configuring the Data source</h5> <div class="paragraph"> <p>The data source is configured in the "datasource" element of the server configuration file as shown below:</p> </div> <div class="paragraph"> <p>and inside the "datasource/drivers" element, we need to declare the driver:</p> </div> </div> <div class="sect4"> <h5 id="_creating_the_cache"><a class="anchor" href="#_creating_the_cache"></a>Creating the cache</h5> <div class="paragraph"> <p>The last piece is to define a cache with the proper JDBC Store:</p> </div> </div> <div class="sect4"> <h5 id="_putting_all_together"><a class="anchor" href="#_putting_all_together"></a>Putting all together</h5> <div class="paragraph"> <p>From now on, without using Docker we&#8217;d be ready to download and install Oracle following the specific instructions for your OS, then download the Infinispan Server, edit the configuration files, copy over the driver jar, figure out how to launch the database and server, taking care not to have any port conflicts.</p> </div> <div class="paragraph"> <p>If it sounds too much work, it&#8217;s because it really is. Wouldn&#8217;t it be nice to have all these wired together and launched with a simple command line? Let&#8217;s take a look at the Docker way next. </p> </div> </div> </div> <div class="sect2"> <h3 id="_enter_docker_compose"><a class="anchor" href="#_enter_docker_compose"></a>Enter Docker Compose</h3> <div class="paragraph"> <p>Docker Compose is a tool part of the Docker stack to facilitate configuration, execution and management of related Docker containers.</p> </div> <div class="paragraph"> <p>By describing the application aspects in a single yaml file, it allows centralized control of the containers, including custom configuration and parameters, and it also allows runtime interactions with each of the exposed services.</p> </div> <div class="sect4"> <h5 id="_composing_infinispan"><a class="anchor" href="#_composing_infinispan"></a>Composing Infinispan</h5> <div class="paragraph"> <p>Our Docker Compose file to assemble the application is given below:</p> </div> <div class="paragraph"> <p>It contains two services:</p> </div> <div class="ulist"> <ul> <li> <p>one called <strong><em>oracle</em></strong> that uses the <a href="https://hub.docker.com/r/wnameless/oracle-xe-11g/">wnameless/oracle-xe-11g</a> Docker image, with an environment variable to allow remote connections.</p> </li> <li> <p> another one called <em>*infinispan*</em> that uses version 8.2.5.Final of the <a href="https://store.docker.com/community/images/jboss/infinispan-server">Infinispan Server image</a>. It is launched with a custom command pointing to the changed configuration file and it also mounts two volumes in the container: one for the driver and its module.xml and another for the folder holding our server xml configuration.</p> </li> </ul> </div> </div> <div class="sect4"> <h5 id="_launching"><a class="anchor" href="#_launching"></a>Launching</h5> <div class="paragraph"> <p>To start the application, just execute</p> </div> <div class="paragraph"> <p>To inspect the status of the containers:</p> </div> <div class="paragraph"> <p>To follow the Infinispan server logs, use:</p> </div> <div class="paragraph"> <p>Infinispan usually starts faster than the database, and since the server waits until the database is ready (more on that later), keep an eye in the log output for "Infinispan Server 8.2.5.Final (WildFly Core 2.0.10.Final) started". After that, both Infinispan and Oracle are properly initialized.</p> </div> </div> <div class="sect4"> <h5 id="_testing_it"><a class="anchor" href="#_testing_it"></a>Testing it</h5> <div class="paragraph"> <p>Let&#8217;s insert a value using the Rest endpoint from Infinispan and verify it was saved to the Oracle database:</p> </div> <div class="paragraph"> <p>To check the Oracle database, we can attach to the container and use Sqlplus:</p> </div> </div> <div class="sect4"> <h5 id="_other_operations"><a class="anchor" href="#_other_operations"></a>Other operations</h5> <div class="paragraph"> <p>It&#8217;s also possible to increase and decrease the number of containers for each of the services:</p> </div> </div> </div> <div class="sect2"> <h3 id="_a_thing_or_two_about_startup_order"><a class="anchor" href="#_a_thing_or_two_about_startup_order"></a>A thing or two about startup order</h3> </div> <div class="sect2"> <h3 id="_3"><a class="anchor" href="#_3"></a> </h3> <div class="paragraph"> <p>When dealing with dependent containers in Docker based environments, it&#8217;s highly recommended to make the connection obtention between parties robust enough so that the fact that one dependency is not totally initialized doesn&#8217;t cause the whole application to fail when starting.</p> </div> <div class="paragraph"> <p>Although Compose does have a <strong><em>depends_on</em></strong> instruction, it simply starts the containers in the declared order but it has no means to detected when a certain container is fully initialized and ready to serve requests before launching a dependent one.</p> </div> <div class="paragraph"> <p>One may be tempted to simply write some glue script to detect if a certain port is open, but that does not work in practice: the network socket may be opened, but the background service could still be in transient initialization state.</p> </div> <div class="paragraph"> <p>The recommended solution for this it to make whoever depends on a service to retry periodically until the dependency is ready. On the Infinispan + Oracle case, we specifically configured the data source with retries to avoid failing at once if the database is not ready:</p> </div> <div class="paragraph"> <p>When starting the application via Compose you&#8217;ll notice that Infinispan print some WARN with connection exceptions until Oracle is available: don&#8217;t panic, this is expected!</p> </div> </div> <div class="sect2"> <h3 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h3> <div class="paragraph"> <p>Docker Compose is a powerful and easy to use tool to launch applications involving multiple containers: in this post it allowed to start Infinispan plus Oracle with custom configurations with a single command. It&#8217;s also a handy tool to have during development and testing phase of a project, specially when using/evaluating Infinispan with its many possible integrations.</p> </div> <div class="paragraph"> <p>Be sure to check other examples of using Docker Compose involving Infinispan: the <a href="https://github.com/infinispan/infinispan-spark/tree/master/examples/twitter">Infinispan+Spark Twitter demo</a>, and the <a href="https://github.com/infinispan/infinispan-hadoop/tree/master/samples/flink">Infinispan+Apache Flink</a> demo.</p> </div> </div> </div> <hr> <div class="post"></div> <h3> Friday, 28 October 2016 </h3> <h1> <a href="/blog/2016/10/28/infinispan-docker-image-custom/">Infinispan Docker image: custom configuration</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>In the <a href="http://blog.infinispan.org/2016/07/improved-infinispan-docker-image.html">previous post</a> we introduced the improved Docker image for Infinispan and showed how to run it with different parameters in order to create standalone, clustered and domain mode servers.</p> </div> <div class="paragraph"> <p>This post will show how to address more advanced configuration changes than swapping the JGroups stack, covering cases like creating extra caches or using a pre-existent configuration file.</p> </div> </div> </div> <div class="sect3"> <h4 id=""><a class="anchor" href="#"></a> </h4> </div> <div class="sect3"> <h4 id="_runtime_configuration_changes"><a class="anchor" href="#_runtime_configuration_changes"></a>Runtime configuration changes</h4> <div class="paragraph"> <p>Since the Infinispan server is based on Wildfly, it also supports the Command Line Interface (CLI) to change configurations at runtime.</p> </div> <div class="paragraph"> <p>Let&#8217;s consider an example of a custom indexed cache with Infinispan storage. In order to configure it, we need 4 caches, one cache to hold our data, called <em>testCache</em> and other three caches to hold the indexes:  <em>LuceneIndexesMetadata</em>, <em>LuceneIndexesData</em> and <em>LuceneIndexesLocking</em>.</p> </div> <div class="paragraph"> <p>This is normally achieved by adding this piece of configuration to the server xml:</p> </div> <div class="paragraph"> <p>This is equivalent to the following script:</p> </div> <div class="paragraph"> <p>To apply it to the server, save the script to a file, and run:</p> </div> <div class="paragraph"> <p>where CONTAINER is the id of the running container.</p> </div> <div class="paragraph"> <p>Everything that is applied using the CLI is automatically persisted in the server, and to check what the script produced, use the command to dump the config to a local file called <em>config.xml.</em></p> </div> <div class="paragraph"> <p>Check the file <em>config.xml</em>: it should contain all four caches created via the CLI.</p> </div> </div> <div class="sect3"> <h4 id="_2"><a class="anchor" href="#_2"></a> </h4> </div> <div class="sect3"> <h4 id="_using_an_existent_configuration_file"><a class="anchor" href="#_using_an_existent_configuration_file"></a> Using an existent configuration file</h4> <div class="paragraph"> <p>Most of the time changing configuration at runtime is sufficient, but it may be desirable to run the server with an existent xml, or change configurations that cannot be applied without a restart. For those cases, the easier option is to mount a volume in the Docker container and start the container with the provided configuration.</p> </div> <div class="paragraph"> <p>This can be achieved with Docker&#8217;s volume support. Consider an xml file called <em>customConfig.xml</em> located on a local folder <em>/home/user/config</em>. The following command:</p> </div> <div class="paragraph"> <p>will create a volume inside the container at the <em>/opt/jboss/infinispan-server/standalone/configuration/extra/</em> directory, with the contents of the local folder <em>/home/user/config</em>.</p> </div> <div class="paragraph"> <p>The container is then launched with the entrypoint <em>extra/customConfig</em>, which means it will use a configuration named <em>customConfig</em> located under the <em>extra</em> folder relative to where the configurations are usually located at <em>/opt/jboss/infinispan-server/standalone/configuration</em>.</p> </div> </div> <div class="sect3"> <h4 id="_3"><a class="anchor" href="#_3"></a> </h4> </div> <div class="sect3"> <h4 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h4> <div class="paragraph"> <p>And that&#8217;s all about custom configuration using the Infinispan Docker image.</p> </div> <div class="paragraph"> <p>Stay tuned for the next post where we&#8217;ll dive into multi-host clusters with the Infinispan Docker image.</p> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 20 July 2016 </h3> <h1> <a href="/blog/2016/07/20/improved-infinispan-docker-image/">Improved Infinispan Docker image available</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><a href="https://www.docker.com/sites/default/files/Engine.png"><span class="image"><img src="https://www.docker.com/sites/default/files/Engine.png" alt="image" width="200" height="196"></span></a></p> </div> <div class="paragraph"> <p>The <a href="https://hub.docker.com/r/jboss/infinispan-server/">Infinispan Docker image</a> has been improved, making it easier to run Infinispan Servers in clustered, domain and standalone modes, with different protocol stacks.</p> </div> <div class="paragraph"> <p>In this blog post we&#8217;ll show a few usage scenarios and how to combine it with the <a href="https://hub.docker.com/r/jboss/jgroups-gossip/">jgroups-gossip</a> image to create Infinispan Server clusters in docker based environments.</p> </div> <div class="exampleblock"> <div class="content"> <div class="exampleblock"> <div class="content"> <div class="paragraph"> <p>==== Getting started</p> </div> </div> </div> <div class="paragraph"> <p>By default the container runs in clustered mode, and to start a node simply execute:</p> </div> <div class="paragraph"> <p>Bringing a second container will cause it to form a cluster.The membership can be verified by running a command directly in the newly launched container:</p> </div> <div class="paragraph"> <p>Example output:</p> </div> <div class="exampleblock"> <div class="content"> <div class="paragraph"> <p>==== Using a different JGroups stack</p> </div> </div> </div> <div class="paragraph"> <p>The command above creates a cluster with the default JGroups stack (UDP), but it&#8217;s possible to pick another one provided it&#8217;s supported by the server. For example, to use TCP:</p> </div> <div class="paragraph"> <p>==== Running on cloud environments</p> </div> <div class="paragraph"> <p>We recently dockerized the JGroups Gossip Router to be used as an alternative discovery mechanism in environments where multicast is not enabled, such as cloud environments.</p> </div> <div class="paragraph"> <p>Employing  a gossip router will enable discovery via TCP, where the router acts as a registry: each member will register itself in this registry upon start and also discover other members.</p> </div> <div class="paragraph"> <p>The gossip router container can be launched by:     </p> </div> <div class="paragraph"> <p>Take note of the address where the router will bind to, it&#8217;s needed by the Infinispan nodes. The address can be easily obtained by:    </p> </div> <div class="paragraph"> <p>Finally we can now launch our cluster specifying the tcp-gossip stack with the location of the gossip router:</p> </div> <div class="paragraph"> <p>==== Launching Standalone mode</p> </div> <div class="paragraph"> <p>Passing an extra parameter allows to run a server in standalone (non-clustered) mode:</p> </div> <div class="exampleblock"> <div class="content"> <div class="paragraph"> <p>==== Server Management Console in Domain mode</p> </div> </div> </div> <div class="paragraph"> <p>Domain mode is a special case of clustered mode (and currently a requirement to use the Server Management Console), that involves launching a domain controller process plus one or more host controller processes. The domain controller does not hold data, it is used as a centralized management process that can replicate configuration and provision servers on the host controllers.</p> </div> <div class="paragraph"> <p>Running a domain controller is easily achievable with a parameter:</p> </div> <div class="paragraph"> <p>Once the domain controller is running, it&#8217;s possible to start one or more host controllers. In the default configuration, each host controller has two Infinispan server instances:</p> </div> <div class="paragraph"> <p>The command line interface can be used to verify the hosts managed in the domain:</p> </div> <div class="paragraph"> <p>It should output all the host names that are part of the domain, including the master (domain controller):</p> </div> <div class="paragraph"> <p>To get access to the Management console, use credentials admin/admin and go to port 9990 of the domain controller, for example: <a href="http://172.17.0.2:9990/">http://172.17.0.2:9990/</a></p> </div> <div class="paragraph"> <p>==== Versions</p> </div> <div class="paragraph"> <p>The image is built on <a href="https://hub.docker.com/r/jboss/infinispan-server/">Dockerhub</a> shortly after each Infinispan release (stable and unstable), and the improvements presented in this post are available for Infinispan 9.0.0.Alpha3 and Infinispan 8.2.3.Final. As a reminder, make sure to pick the right version when launching containers:</p> </div> <div class="paragraph"> <p>Getting involved</p> </div> <div class="paragraph"> <p>The image was created to be flexible and easy to use, but if something is not working for you or if you have any suggestions to improve it, please report it at <a href="https://github.com/jboss-dockerfiles/infinispan/issues/" class="bare">https://github.com/jboss-dockerfiles/infinispan/issues/</a></p> </div> <div class="paragraph"> <p>Enjoy!</p> </div> </div> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 09 December 2015 </h3> <h1> <a href="/blog/2015/12/09/infinispan-spark-connector-02-released/">Infinispan Spark connector 0.2 released!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The connector allows the Infinispan Server to become a data source for Apache Spark, for both batch jobs and stream processing, including read and write.</p> </div> <div class="paragraph"> <p>In this release, the highlight is the addition of two new operators to the RDD that support filtering using native capabilities of Infinispan. The first one is filterByQuery:</p> </div> <div class="paragraph"> <p>The second operator was introduced to replace the previous configuration based filter factory name, and was extended to support arbitrary parameters:</p> </div> <div class="paragraph"> <p>The connector has also been updated to be compatible with Spark 1.5.2 and Infinispan 8.1.0.Final.</p> </div> <div class="paragraph"> <p>For more details including full list of changes and download info please visit the <a href="http://infinispan.org/integrations/">Connectors Download section</a>.  The project <a href="https://github.com/infinispan/infinispan-spark">Github</a> contains up-to-date info on how to get started with the connector, also make sure to try the included <a href="https://github.com/infinispan/infinispan-spark/tree/master/examples/twitter">docker based demo</a>. To report any issue or to request new features, use the new dedicated <a href="https://issues.jboss.org/projects/ISPRK">issue tracker</a>. We&#8217;d love to get your feedback!</p> </div> </div> </div> </div> <hr> <div class="pagination-links"><span class="current-page">1</span> <a href="/blog/tags/server/page/2/" class="page-link">2</a> <a href="/blog/tags/server/page/2/" class="next-link">Next</a> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>