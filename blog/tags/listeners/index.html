<!DOCTYPE html> <html lang="en"> <head> <title>Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Thursday, 14 December 2017 </h3> <h1> <a href="/blog/2017/12/14/first-steps-with-vertx-and-infinispan-push-api/">First steps with Vert.x and Infinispan - PUSH API (Part 2)</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Welcome to the second in a multi-part series of blog posts about creating <a href="http://vertx.io/">Eclipse Vert.x</a> applications with <a href="http://infinispan.org/">Infinispan</a>. In the <a href="http://blog.infinispan.org/2017/12/first-steps-with-vertx-and-infinispan-rest-api.html">previous blog post</a> we have seen how to create a REST API. The purpose of this tutorial is to showcase how to create a PUSH API implemented with Vert.x and using Infinispan as a server.</p> </div> <div class="quoteblock"> <blockquote> <div class="paragraph"> <p><em>All the code of this tutorial is available in this <a href="https://github.com/karesti/cute-names">GitHub repository</a>. The backend is a Java project using Maven, so all the needed dependencies can be found in the pom.xml. The front is a super simple react application.</em></p> </div> </blockquote> </div> <div class="paragraph"> <p>* *</p> </div> </div> </div> <div class="sect1"> <h2 id="_push_api"><a class="anchor" href="#_push_api"></a>PUSH API</h2> <div class="sectionbody"> <div class="paragraph"> <p>Creating a REST API is very straightforward. But today, even if we are heavily using REST, we don&#8217;t always want to use request/response or polling, but instead we want to push directly from the server to the client. In this example, we are going to create an API that pushes every new value inserted in the default cache of Infinispan. These values are cute names, as we did in the REST API example.</p> </div> <div class="paragraph"> <p>We are using two features here :</p> </div> <div class="ulist"> <ul> <li> <p>Infinispan client listeners</p> </li> <li> <p>Vert.x bridge between the <a href="http://vertx.io/docs/vertx-core/java/#event_bus">Event Bus</a> and the browser</p> </li> </ul> </div> <div class="paragraph"> <p><a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#_Listeners_and_notifications_section">Infinispan Listeners</a> provide a way to the client get notified when something happens in a cache.</p> </div> <div class="paragraph"> <p>The <a href="http://vertx.io/docs/vertx-web/java/#_sockjs_event_bus_bridge">Event Bus Bridge</a> that connects to the browser, uses <a href="http://sockjs.org/">SockJS</a>. SockJS is a JavaScript library that provides a WebSocket API, but it can be used with browsers that don&#8217;t support web-sockets (see the website of the project for more detailed information). Vert.x supports this library and creates a bridge between your browser and your back-end easily through the Event Bus.</p> </div> <div class="sect2"> <h3 id="_creating_an_event_bus_bridge"><a class="anchor" href="#_creating_an_event_bus_bridge"></a>Creating an Event Bus bridge</h3> <div class="paragraph"> <p>Vert.x is a reactive framework, which means that uses <a href="https://github.com/ReactiveX/RxJava">RxJava</a> too, and provides a fancy API on top of it.</p> </div> <div class="paragraph"> <p>First, we are going to create a new verticle called SendCuteNamesAPI. This verticle extends the CacheAccessVerticle we created in the <a href="http://blog.infinispan.org/2017/12/first-steps-with-vertx-and-infinispan-rest-api.html">previous blog post</a>. CacheAccessVerticle initialises the connection with Infinispan using the <a href="http://infinispan.org/docs/dev/user_guide/user_guide.html#using_hot_rod_server">Hot Rod protocol.</a></p> </div> <div class="paragraph"> <p>Now we need to create a SocketJSHandler. This handler has a method called bridge, where we configure some BridgeOptions. Obviously <strong>we don&#8217;t want the client to be able to read everything</strong> traveling on the event bus, and this won&#8217;t happen. We <strong>configure an address</strong>, <strong>'cute-names'</strong>, and we add the permission to read and write to this address.</p> </div> <div class="paragraph"> <p>This handler is passed to the event bus route, where the path is /eventbus/*.</p> </div> <div class="paragraph"> <p>Finally, we create a http server as we did in the REST API example. The difference is that instead of calling listen method, we call <strong>rxListen</strong> and <strong>subscribe</strong>.</p> </div> </div> <div class="sect2"> <h3 id="_getting_notified_and_publishing"><a class="anchor" href="#_getting_notified_and_publishing"></a>Getting notified and publishing</h3> <div class="paragraph"> <p>Using <a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#_Listeners_and_notifications_section">Infinispan listeners</a> is very easy.</p> </div> <div class="paragraph"> <p>First, we are going to create a class that has the @ClientListener annotation. The client listener has to be added to the cache client configuration. We add a protected method called addConfigToCache that will be called just after the initialisation of the defaultCache in the abstract CacheAccessVerticle. Verticles extending the abstract class can now add custom configuration to the client.</p> </div> <div class="paragraph"> <p>We want to be notified when a new entry is created. In this case, our listener has to contain a method with the @ClientCacheEntryCreated annotation on it. The signature of the method has to include a ClientCacheEntryCreatedEvent&lt;String&gt; parameter. This parameter will hold the 'key' of the entry that has been created.</p> </div> <div class="paragraph"> <p>Finally, we use the key to retrieve the name using the getAsync method and then <strong>publish</strong> the value in the<strong> Vert.x event bus</strong> to the <strong>address </strong>where the <strong>socket listener</strong> is permitted to read <strong>: cute-names</strong>.</p> </div> <div class="paragraph"> <p>Now we can run the main method and whenever we post a new name, we will see in the logs that the client listener is notified!</p> </div> </div> <div class="sect2"> <h3 id="_client_code"><a class="anchor" href="#_client_code"></a>Client code</h3> <div class="paragraph"> <p>We are going to create a super simple react application that will just display hello. React community is <strong>huge</strong>, so there are lot&#8217;s of tutorials out there to create a hello world client application. This application has a single component that displays "Hello".</p> </div> <div class="paragraph"> <p>The react application runs calling npm install and npm start  in <a href="http://localhost:9000/" class="bare">http://localhost:9000/</a>.</p> </div> <div class="paragraph"> <p>Now we need to connect the client to the backend with <strong>SockJS</strong>.<strong> </strong>Vert.x provides a JavaScript library for that: <a href="https://www.npmjs.com/package/vertx3-eventbus-client">vertx3-eventbus-client</a>, built on top of SockJS. We create an EventBus object that will connect to <strong><a href="http://localhost:8082/eventbus" class="bare">http://localhost:8082/eventbus</a></strong> as we configured in the SendCuteNamesAPI. We register a handler on the <strong>'cute-names'</strong> address. The body of the message will contain the new cute name published in the event bus. Every time the handler is called, we update the component&#8217;s state, and it will be rendered.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_wrap_up"><a class="anchor" href="#_wrap_up"></a>Wrap up</h2> <div class="sectionbody"> <div class="paragraph"> <p>We have learned how to create PUSH APIs with Vert.x, powered by Infinispan. The repository has some unit tests. Feedback is more than welcome to improve the code and the provided examples. I hope you enjoyed this tutorial ! On the next tutorials we will talk about <a href="https://github.com/vert-x3/vertx-infinispan">Infinispan as the cluster manager for Vert.x</a>. Stay tuned !</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Monday, 12 October 2015 </h3> <h1> <a href="/blog/2015/10/12/functional-map-api-listeners/">Functional Map API: Listeners</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>We continue with the blog series on the experimental Functional Map API which was released as part of <a href="http://blog.infinispan.org/2015/08/infinispan-800final.html">Infinispan 8.0.0.Final</a>. In this blog post we&#8217;ll be focusing on how to listen for Functional Map events. For reference, here are the previous entries in the series:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p><a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">Functional Map Introduction</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2015/09/functional-map-api-working-with-single.html">Working with single entries</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2015/09/functional-map-api-working-with.html">Working with multiple entries</a></p> </li> </ol> </div> <div class="paragraph"> <p>The first thing to notice about Functional Map listeners is that they only send events post-event, so that means the events are received after the event has happened. In contrast with Infinispan Cache listeners, there are no pre-event listener invocations. The reason pre-events are not available is because listeners are meant to be an opportunity to find out what has happened, and having pre-events can sometimes hint as if the listener was able to alter the execution of the operation, for which the listener is not really suited. If interested in pre-events or potentially altering the execution, <a href="http://infinispan.org/docs/8.1.x/user_guide/user_guide.html#_custom_interceptors">plugging custom interceptors</a> is the recommended solution.</p> </div> <div class="paragraph"> <p>Functional Map offers two type of event listeners: write-only operation listeners and read-write operation listeners.</p> </div> </div> </div> <div class="sect2"> <h3 id="_write_only_listeners"><a class="anchor" href="#_write_only_listeners"></a>Write-Only Listeners</h3> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html">Write listeners</a> enable users to register listeners for any cache entry write events that happen in either a read-write or write-only functional map.</p> </div> <div class="paragraph"> <p>Listeners for write events cannot distinguish between cache entry created and cache entry modify/update events because they don’t have access to the previous value. All they know is that a new non-null entry has been written. However, write event listeners can distinguish between entry removals and cache entry create/modify-update events because they can query what the new entry’s value via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#find--">ReadEntryView.find()</a> method.</p> </div> <div class="paragraph"> <p>Adding a write listener is done via the WriteListeners interface which is accessible via both <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html#listeners--">ReadWriteMap.listeners()</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#listeners--">WriteOnlyMap.listeners()</a> method. A write listener implementation can be defined either passing a function to <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html#onWrite-java.util.function.Consumer-">onWrite(Consumer&lt;ReadEntryView&lt;K, V&gt;&gt;)</a> method, or passing a WriteListener implementation to <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html#add-org.infinispan.commons.api.functional.Listeners.WriteListeners.WriteListener-">add(WriteListener&lt;K, V&gt;)</a> method. Either way, all these methods return an <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/AutoCloseable.html">AutoCloseable</a> instance that can be used to de-register the function listener. Example and expected output:</p> </div> </div> <div class="sect2"> <h3 id="_read_write_listeners"><a class="anchor" href="#_read_write_listeners"></a>Read-Write Listeners</h3> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html">Read-write listeners</a> enable users to register listeners for cache entry created, modified and removed events, and also register listeners for any cache entry write events. Entry created, modified and removed events can only be fired when these originate on a read-write functional map, since this is the only one that guarantees that the previous value has been read, and hence the differentiation between create, modified and removed can be fully guaranteed.</p> </div> <div class="paragraph"> <p>Adding a read-write listener is done via the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html">ReadWriteListeners</a> interface which is accessible via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html#listeners--">ReadWriteMap.listeners()</a> method. If interested in only one of the event types, the simplest way to add a listener is to pass a function to either <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onCreate-org.infinispan.commons.api.functional.EntryView.ReadEntryView-">onCreate</a>, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onModify-org.infinispan.commons.api.functional.EntryView.ReadEntryView-org.infinispan.commons.api.functional.EntryView.ReadEntryView-">onModify</a> or <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onRemove-org.infinispan.commons.api.functional.EntryView.ReadEntryView-">onRemove</a> methods. Otherwise, if interested in multiple type of events, passing a <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html">ReadWriteListener</a> implementation via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html#add-org.infinispan.commons.api.functional.Listeners.ReadWriteListeners.ReadWriteListener-">add(ReadWriteListener&lt;K, V&gt;)</a> is the easiest. As with write-listeners, all these methods return an AutoCloseable instance that can be used to de-register the listener.</p> </div> <div class="paragraph"> <p>Here&#8217;s an example of adding a ReadWriteListener that handles multiple type of events:</p> </div> </div> <div class="sect2"> <h3 id="_closing_notes"><a class="anchor" href="#_closing_notes"></a>Closing Notes</h3> <div class="paragraph"> <p>More listener event types are yet to be implemented for Functional API, such as expiration events or passivation/activation events. We are capturing this future work and other improvements under the <a href="https://issues.jboss.org/browse/ISPN-5704">ISPN-5704</a> issue.</p> </div> <div class="paragraph"> <p>We&#8217;d love to hear from you on how you are finding this new API. To provide feedback or report any problems with it, head to our <a href="http://infinispan.org/community/">user forums</a> and create a post there.</p> </div> <div class="paragraph"> <p>In next blog post in the series, we&#8217;ll be looking into how to pass per-invocation parameters to tweak operations.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> <hr> <div class="post"></div> <h3> Friday, 17 April 2015 </h3> <h1> <a href="/blog/2015/04/17/infinispan-720cr1-released/">Infinispan 7.2.0.CR1 released</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear community,</p> </div> <div class="paragraph"> <p>We are proud to announce the release of Infinispan 7.2.0.CR1!</p> </div> <div class="paragraph"> <p>This is the first release candidate of 7.2, bringing some exciting new features:</p> </div> <div class="ulist"> <ul> <li> <p>Faster bulk operations, putAll and getAll, for both embedded and HotRod client (<a href="https://issues.jboss.org/browse/ISPN-2183">ISPN-2183</a>, <a href="https://issues.jboss.org/browse/ISPN-5264">ISPN-5264</a>, <a href="https://issues.jboss.org/browse/ISPN-5266">ISPN-5266</a>)</p> </li> <li> <p>Cache creation and configuration changes without the need to restart the server (<a href="https://issues.jboss.org/browse/ISPN-5147">ISPN-5147</a>)</p> </li> <li> <p>Support for defining filters using the Query DSL for event listeners (<a href="https://issues.jboss.org/browse/ISPN-5349">ISPN-5349</a> and <a href="https://issues.jboss.org/browse/ISPN-5350">ISPN-5350</a>)</p> </li> <li> <p>Lock-free clear() operation (<a href="https://issues.jboss.org/browse/ISPN-5370">ISPN-5370</a>)</p> </li> </ul> </div> <div class="paragraph"> <p>For the complete list of features and bug fixes, please refer to the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12326575">release notes</a></p> </div> <div class="paragraph"> <p>Feel free to join us and shape the future releases on our <a href="http://www.jboss.org/infinispan/forums">forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or our <a href="http://webchat.freenode.net/?channels=%23infinispan">#infinispan</a> IRC channel.</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 05 March 2014 </h3> <h1> <a href="/blog/2014/03/05/embedded-cluster-listeners-in/">Embedded Cluster Listeners in Infinispan 7.0.0.Alpha1</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>If you are following on the dev listing, you may have seen a <a href="https://github.com/infinispan/infinispan/wiki/Clustered-listeners">design doc</a> come through that details adding support for Clustered Listeners to Infinispan.  This features allows for listeners to be used in a distributed cache configuration.  I am happy to say that this feature is now in <a href="http://blog.infinispan.org/2014/02/infinispan-700alpha1-release.html">Infinispan 7.0.0.Alpha1</a> !</p> </div> <div class="paragraph"> <p>This feature is needed since local listeners in a distributed cache are only notified of events on the node where the data resides.  Therefore, clustered listeners allow for a single listener to receive any write notification (limited to CacheEntryCreatedEvent, CacheEntryModifiedEvent and CacheEntryRemovedEvent) that occurs in the cluster which is installed on 1 node.</p> </div> </div> </div> <div class="sect3"> <h4 id="_basic_example"><a class="anchor" href="#_basic_example"></a>Basic Example</h4> <div class="paragraph"> <p>Using a cluster listener is just as easy as a regular listener. Here is a simple use case that stores the events as it receives them.</p> </div> <div class="paragraph"> <p>That is all that is required is just to set the property of your Listener annotated class to say <em>clustered = true</em>. There are other important changes in the rest of the document. Please let us know how you like the new cluster listeners ! Also if any issues are found, it is much appreciated to log those to <a href="https://issues.jboss.org/browse/ISPN">JIRA</a>.</p> </div> </div> <div class="sect3"> <h4 id="_differences_between_local_and_cluster_listeners"><a class="anchor" href="#_differences_between_local_and_cluster_listeners"></a>Differences between Local and Cluster Listeners</h4> <div class="sect4"> <h5 id="_pre_and_post_notifications"><a class="anchor" href="#_pre_and_post_notifications"></a>Pre and post Notifications</h5> <div class="paragraph"> <p>In a local cluster listener, the listener is notified twice, before the operation is completed and after the entry is updated.  A cluster listener is <strong>ONLY</strong> notified after the operation is completed while still holding locks.  Therefore, the <em>isPre</em> method always returns false in a cluster listener.</p> </div> </div> <div class="sect4"> <h5 id="_transaction_begin_and_completion"><a class="anchor" href="#_transaction_begin_and_completion"></a>Transaction begin and completion</h5> <div class="paragraph"> <p>In a transactional cache, local listeners are notified when a transaction begins and when it is completed (either through rollback or commit).  A cluster listener is never notified of anything occurring until after the data has been updated, and thus will only ever be notified of committed entries and also will not receive TransactionRegisteredEvent or TransactionCompletedEvent events.</p> </div> </div> </div> <div class="sect2"> <h3 id="_api_changes"><a class="anchor" href="#_api_changes"></a>API Changes</h3> <div class="paragraph"> <p>There are a few new API classes that have been added to allow for configuration and operation of cluster listeners.</p> </div> <div class="sect3"> <h4 id="_listener_annotation"><a class="anchor" href="#_listener_annotation"></a>Listener annotation</h4> <div class="paragraph"> <p>The existing org.infinispan.notifications.Listener annotation has had a couple properties added to it.</p> </div> <div class="paragraph"> <p>The new clustered property defines whether or not this listener is a cluster listener or not.  This means the listener will be sent all write modification events.</p> </div> <div class="paragraph"> <p>A cluster listener is not supported in an Invalidation cache.  Local or replicated caches can use a cluster listener though.  They will behave like a local cluster listener, except that replicated will be less performant.</p> </div> <div class="paragraph"> <p>The includeCurrentState property is also new and will provide a way for a listener when being registered to immediately be sent a CacheCreatedEvent for every entry in the cache.  This will be supported for both local and cluster listeners.  In a local listener it will only query the local data that is available, so in the case of a Distributed cache this will still only provide a possible subset of data.  However a clustered listener will retrieve the data from all nodes as needed.  A cache will still be available for writes during the includeCurrentState period.  However the notifications will be queued until all state has been first sent. <strong>NOTE: includeCurrentState is currently not implemented but is planned during this release still</strong> see <a href="https://issues.jboss.org/browse/ISPN-4068">ISPN-4068</a></p> </div> </div> <div class="sect3"> <h4 id="_keyvaluefilter"><a class="anchor" href="#_keyvaluefilter"></a>KeyValueFilter</h4> <div class="paragraph"> <p>This is a new Filter class that can be used to filter events or other operations based on the key value and metadata of the updated object.</p> </div> </div> <div class="sect3"> <h4 id="_converter"><a class="anchor" href="#_converter"></a>Converter</h4> <div class="paragraph"> <p>A converter is used to convert a given key, value, metadata entry to a resulting value. This is useful if your listener doesn&#8217;t require the entire value and need just a portion from it. Or if the listener were to do some sort of translation, this would allow it to scale to each node instead of having to run the translation all on the node where the listener is registered.</p> </div> </div> <div class="sect3"> <h4 id="_cache"><a class="anchor" href="#_cache"></a>Cache</h4> <div class="paragraph"> <p>The cache interface also has an additional overloaded method to allow for registering the previously mentioned KeyValueFilter and Converter with the Listener provided.  Note that either type of listener, cluster or local, may be used with any of the overloaded addListener methods on the Cache interface.</p> </div> <div class="paragraph"> <p>This new method is similar to the other addListener methods, but is specially optimized for use with cluster listeners in distributed mode. Whenever a modification occurs which would cause an event to be sent to the cluster notifier the KeyValueFilter is first ran to see if this event should even be sent to the listener. If it is then the converter will be used to convert result into whatever data is desired to send back to the listener. These combined allow for reducing overall network traffic for events that you don&#8217;t want to get or reduce payload size by sending a different or subset of the value.</p> </div> </div> <div class="sect3"> <h4 id="_events"><a class="anchor" href="#_events"></a>Events</h4> <div class="paragraph"> <p>There are some cases in Infinispan when it is unclear if a notification was properly raised in a non transactional cache. Due to this we have made available an additional value on the CacheEntryCreatedEvent, CacheEntryModifiedEvent, and CacheEntryRemovedEvent. This is to symbolize that this event could have been possibly duplicated or even changed types (CacheEntryModifiedEvent instead of CacheEntryCreatedEvent).</p> </div> <div class="paragraph"> <p>This should only return true if we had a node who was an owner go down while in the middle of processing the write.</p> </div> </div> </div> <div class="sect2"> <h3 id="_functional_changes"><a class="anchor" href="#_functional_changes"></a>Functional Changes</h3> <div class="sect3"> <h4 id="_cacheentrymodified_during_creates"><a class="anchor" href="#_cacheentrymodified_during_creates"></a>CacheEntryModified during creates</h4> <div class="paragraph"> <p>Prior to Infinispan 7.0, whenever a new entry was created, this would generate both CacheEntryCreated and CacheEntryModified events.  This has been changed now so that only a CacheEntryCreated event is raised to more consistently model what has occurred.</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Monday, 09 September 2013 </h3> <h1> <a href="/blog/2013/09/09/infinispan-600alpha4-out-with-new/">Infinispan 6.0.0.Alpha4 out with new CacheLoader/CacheWriter API!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan 6.0.0.Alpha4 is now with a few very important changes, particularly around cache stores. We&#8217;ve completely revamped the cache store/loader API to align it a bit better with JSR-107 (old CacheStore has become CacheWriter) and to simplify creation of new implementations. The new <a href="https://github.com/infinispan/infinispan/blob/6.0.0.Alpha4/core/src/main/java/org/infinispan/persistence/spi/CacheLoader.java">CacheLoader</a> and <a href="https://github.com/infinispan/infinispan/blob/6.0.0.Alpha4/core/src/main/java/org/infinispan/persistence/spi/CacheWriter.java">CacheWriter</a> should help implementors focus on the important operations and reduce the coding time. We&#8217;ve also created <a href="https://github.com/infinispan/infinispan/blob/6.0.0.Alpha4/core/src/main/java/org/infinispan/persistence/spi/AdvancedCacheLoader.java">AdvancedCacheLoader</a> and <a href="https://github.com/infinispan/infinispan/blob/6.0.0.Alpha4/core/src/main/java/org/infinispan/persistence/spi/AdvancedCacheWriter.java">AdvancedCacheWriter</a> in order to separate for bulk operations or purging for those implementations that wish optionally implement them. Expect a blog post from Mircea in the next few days providing many more details on this topic.</p> </div> <div class="paragraph"> <p>This new Infinispan version comes with other important goodies:</p> </div> <div class="ulist"> <ul> <li> <p>Rolling upgrades of a Infinsipan REST cluster</p> </li> <li> <p>Support for Cache-Control headers for REST operations</p> </li> <li> <p>Remote querying server modules and Hot Rod client update</p> </li> <li> <p>REST and LevelDB stores added to Infinispan Server</p> </li> <li> <p><a href="https://github.com/infinispan/infinispan/blob/6.0.0.Alpha4/core/src/main/java/org/infinispan/notifications/KeyFilter.java">KeyFilters</a> can now be applied to Cache listeners</p> </li> <li> <p>Allow Cache listener events to be invoked only on the primary data owner</p> </li> </ul> </div> <div class="paragraph"> <p>For a complete list of features and fixes included in this release please refer to the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12321856">release notes</a>. Visit our <a href="http://www.jboss.org/infinispan/downloads">downloads</a> section to find the latest release and if you have any questions please check <a href="http://www.jboss.org/infinispan/forums">our forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or ping us directly on <a href="irc://irc.freenode.org/infinispan">IRC</a>.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <hr> <div class="pagination-links"><span class="current-page">1</span> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>