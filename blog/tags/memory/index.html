<!DOCTYPE html> <html lang="en"> <head> <title>Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Friday, 25 September 2015 </h3> <h1> <a href="/blog/2015/09/25/memory-based-eviction/">Memory based eviction</a> </h1> <div class="content"> <div class="sect1"> <h2 id="_eviction_today"><a class="anchor" href="#_eviction_today"></a>Eviction Today</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan since its inception has supported a way to help users control how much memory the in memory cache entries consume in the JVM.  This has always been limited to a number of entries.  In the past users have had to estimate the average amount of bytes their entries used on the heap.  With this average you can easily calculate how many entries could safely be stored in memory without running into issues.  For users who have keys and values that are relatively similar this can work well.  However when the case requires entries that vary in size this can be problematic and you end up calculating the average size based on the worse case.</p> </div> </div> </div> <div class="sect1"> <h2 id="_enter_memory_based_eviction"><a class="anchor" href="#_enter_memory_based_eviction"></a>Enter Memory Based Eviction</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan 8 introduces memory based eviction counting.  That is Infinispan will automatically keep track of how large the key, value and overhead if possible.  It can use these values then to try to limit the number of entries instead to a memory count such as 1 Gigabyte.</p> </div> <div class="sect2"> <h3 id="_keyvalue_limitations"><a class="anchor" href="#_keyvalue_limitations"></a>Key/Value limitations</h3> <div class="paragraph"> <p>Unfortunately this is currently limited to only using keys and values stored as primitives, primitive wrappers (ie. Integer), java.lang.String(s) and any of the previously mentioned stored in an array.  This means this feature cannot be used with any custom classes.  If enough feedback is provided we could provide a SPI to allow the user to plug in their own counter for their own classes, but this is not planned currently.</p> </div> <div class="paragraph"> <p>There are a couple ways to easily get around this.  One is to use <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_store_as_binary">storeAsBinary</a>, which will store your keys and/or values as byte arrays for you automatically, satisfying this limitation.  A second way is when you are using the client such as HotRod, in this case the data is stored in the serialized (byte[]) form.  Note that <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_enable_compatibility_mode">compatibility mode</a> will prevent this from occurring and you are unable to use these configurations together.</p> </div> </div> <div class="sect2"> <h3 id="_eviction_type_limitation"><a class="anchor" href="#_eviction_type_limitation"></a>Eviction Type limitation</h3> <div class="paragraph"> <p>Due to the complexity of LIRS, memory based eviction is only supported with LRU at this time. See the types <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_eviction_strategies">here</a>.  This could be enhanced at a later point, but is also not planned.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_how_to_enable"><a class="anchor" href="#_how_to_enable"></a>How to enable</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can enable memory based eviction either through programmatic or declarative configuration.  Note that Infinispan added long support (limited to 2^48) for the size value which directly helps memory based eviction if users want to utilize caches larger than 2 GB.</p> </div> <div class="sect2"> <h3 id="_programmatic"><a class="anchor" href="#_programmatic"></a>Programmatic</h3> </div> <div class="sect2"> <h3 id="_declarative"><a class="anchor" href="#_declarative"></a>Declarative </h3> <div class="paragraph"> <p>==</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_supported_jvms"><a class="anchor" href="#_supported_jvms"></a>Supported JVMs</h2> <div class="sectionbody"> <div class="paragraph"> <p>This was tested and written specifically for Oracle and OpenJDK JVMs.  In testing these JVMs showed memory accuracy within 1% of desired value. Other JVMs may shown incorrect values.</p> </div> <div class="paragraph"> <p>The algorithm takes into account JVM options, such as compressed pointers and 32 bit JVM vs 64 bit JVM.  Keep in mind this is only for the data container and doesn&#8217;t take into account additional overhead such as created threads or other runtime objects.</p> </div> <div class="paragraph"> <p>Other JVMs are not handled such as the IBM JVM which was briefly tested and showed incorrect numbers greater than 10% of the desired amount.  Support for other JVMs can be added later as interest is shown for them.</p> </div> </div> </div> <div class="sect1"> <h2 id="_closing_notes"><a class="anchor" href="#_closing_notes"></a>Closing Notes</h2> <div class="sectionbody"> <div class="paragraph"> <p>I hope this feature helps people to better handle their memory constraints while using Infinispan!  Let us know if you have any <a href="http://infinispan.org/getinvolved/">feedback or concerns</a>.</p> </div> <div class="paragraph"> <p>Cheers!</p> </div> <div class="paragraph"> <p> - Will</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/eviction/"> eviction </a> <a class="label" href="/blog/tags/memory/"> memory </a> <hr> <div class="post"></div> <h3> Tuesday, 02 July 2013 </h3> <h1> <a href="/blog/2013/07/02/lower-memory-overhead-in-infinispan/">Lower memory overhead in Infinispan 5.3.0.Final</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan users worried about memory consumption should upgrade to <a href="http://infinispan.blogspot.cz/2013/06/infinispan-530final-is-out.html">Infinispan 5.3.0.Final</a> as soon as possible, because as part of the work we&#8217;ve done to <a href="https://docs.jboss.org/author/x/2oD2Aw">support storing byte arrays without wrappers</a>, and the development of the <a href="http://infinispan.blogspot.co.uk/2013/05/interoperability-between-embedded-and.html">interoperability mode</a>, we&#8217;ve been working to reduce Infinispan&#8217;s memory overhead.</p> </div> <div class="paragraph"> <p>To measure overhead, we&#8217;ve used <a href="http://infinispan.blogspot.cz/2013/01/infinispan-memory-overhead.html">Martin Gencur&#8217;s excellent memory consumption tests</a>. The results for entries with 512 bytes are:</p> </div> <div class="paragraph"> <p>Infinispan memory overhead, used in library mode: Infinispan 5.2.0.Final: ~151 bytes Infinispan 5.3.0.Final: ~135 bytes Memory consumption reduction: ~12%</p> </div> <div class="paragraph"> <p>Infinispan memory overhead, for the Hot Rod server: Infinispan 5.2.0.Final: ~174 bytes Infinispan 5.3.0.Final: ~151 bytes Memory consumption reduction: ~15%</p> </div> <div class="paragraph"> <p>Infinispan memory overhead, for the REST server: Infinispan 5.2.0.Final: ~208 bytes Infinispan 5.3.0.Final: ~172 bytes Memory consumption reduction: ~21%</p> </div> <div class="paragraph"> <p>Infinispan memory overhead, for the Memcached server:</p> </div> <div class="paragraph"> <p>Infinispan 5.2.0.Final: ~184 bytes</p> </div> <div class="paragraph"> <p>Infinispan 5.3.0.Final: ~180 bytes Memory consumption reduction: ~2%</p> </div> <div class="paragraph"> <p>This is great news for the Infinispan community but our effort doesn&#8217;t end here. We&#8217;ll be working on further improvements in next releases to bring down cost even further.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/overhead/"> overhead </a> <a class="label" href="/blog/tags/5.3/"> 5.3 </a> <a class="label" href="/blog/tags/memory/"> memory </a> <a class="label" href="/blog/tags/performance/"> performance </a> <hr> <div class="post"></div> <h3> Monday, 20 May 2013 </h3> <h1> <a href="/blog/2013/05/20/storing-arrays-in-infinispan-53-without/">Storing arrays in Infinispan 5.3 without wrapper objects!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>As we head towards the latter part of Infinispan 5.3 series, we&#8217;re doing a series of blog posts where we provide more detailed information of some of the key features in this release.</p> </div> <div class="paragraph"> <p>As part of Infinispan 5.3.0.Beta1, we added the ability to store data directly in Infinispan which previously would have required using a custom wrapper object, e.g. arrays. The way Infinispan supports storing these type of objects is by allowing a custom <a href="https://github.com/infinispan/infinispan/blob/master/core/src/main/java/org/infinispan/util/Equivalence.java">Equivalence</a> function to be configured for keys and/or values.</p> </div> <div class="paragraph"> <p>This is a less cumbersome method that enables object requiring custom equals/hashCode implementations to be stored without incurring on a extra cost per cache entry. We&#8217;ve already been using this internally to store Hot Rod, REST and Memcached data where keys and/or values can be byte arrays, and we&#8217;ve seen some nice improvements in terms of memory consumption.</p> </div> <div class="paragraph"> <p>A nice side effect of being able to store byte arrays natively is that it makes sharing data between multiple endpoints less cumbersome since you&#8217;re now dealing with byte arrays directly instead of having to wrap/unwrap the byte arrays. More on this topic very shortly.</p> </div> <div class="paragraph"> <p>Full details on how to implement and configure these new <a href="https://github.com/infinispan/infinispan/blob/master/core/src/main/java/org/infinispan/util/Equivalence.java">Equivalence</a> functions can be found in the <a href="https://docs.jboss.org/author/x/2oD2Aw">Infinispan community documentation</a>. To give this a go, make sure you <a href="http://www.jboss.org/infinispan/downloads">download the latest Infinispan 5.3 release</a>.</p> </div> <div class="paragraph"> <p>Cheers, Galder</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/equivalence/"> equivalence </a> <a class="label" href="/blog/tags/5.3/"> 5.3 </a> <a class="label" href="/blog/tags/memory/"> memory </a> <hr> <div class="post"></div> <h3> Saturday, 12 January 2013 </h3> <h1> <a href="/blog/2013/01/12/infinispan-memory-overhead/">Infinispan memory overhead</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Have you ever wondered how much Java heap memory is actually consumed when data is stored in Infinispan cache? Let&#8217;s look at some numbers obtained through real measurement.</p> </div> <div class="paragraph"> <p>The strategy was the following:</p> </div> <div class="paragraph"> <p>1) Start Infinispan server in local mode (only one server instance, eviction disabled) 2) Keep calling full garbage collection (via JMX or directly via System.gc() when Infinispan is deployed as a library) until the difference in consumed memory by the running server gets under 100kB between two consecutive runs of GC 3) Load the cache with <strong>100MB</strong> of data via respective client (or directly store in the cache when Infinispan is deployed as a library) 4) Keep calling the GC until the used memory is stabilised 5) Measure the difference between the final values of consumed memory after the first and second cycle of GC runs 6) Repeat steps 3, 4 and 5 four times to get an average value (first iteration ignored)</p> </div> <div class="paragraph"> <p>The amount of consumed memory was obtained from a verbose GC log (related JVM options: -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/tmp/gc.log)</p> </div> <div class="paragraph"> <p>The test output looks like this: <a href="https://gist.github.com/4512589" class="bare">https://gist.github.com/4512589</a></p> </div> <div class="paragraph"> <p>The operating system (Ubuntu) as well as JVM (Oracle JDK 1.6) were 64-bit. Infinispan 5.2.0.Beta6. Keys were kept intentionally small (10 character Strings) with byte arrays as values. The target entry size is a sum of key size and value size.</p> </div> </div> </div> <div class="sect1"> <h2 id="_memory_overhead_of_infinispan_accessed_through_clients"><a class="anchor" href="#_memory_overhead_of_infinispan_accessed_through_clients"></a><strong>Memory overhead of Infinispan accessed through clients</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>==</p> </div> <div class="paragraph"> <p><strong>HotRod client</strong></p> </div> <div class="paragraph"> <p>entry size &#8594; overall memory</p> </div> <div class="paragraph"> <p>512B       &#8594; 137144kB</p> </div> <div class="paragraph"> <p>1kB        &#8594; 120184kB</p> </div> <div class="paragraph"> <p>10kB       &#8594; 104145kB</p> </div> <div class="paragraph"> <p>1MB        &#8594; 102424kB</p> </div> <div class="paragraph"> <p>So how much additional memory is consumed on top of each entry?</p> </div> <div class="paragraph"> <p>entry size/actual memory per entry &#8594; overhead per entry</p> </div> <div class="paragraph"> <p>512B/686B                &#8594; ~174B</p> </div> <div class="paragraph"> <p>1kB(1024B)/1202B         &#8594; ~178B</p> </div> <div class="paragraph"> <p>10kB(10240B)/10414B      &#8594; ~176B</p> </div> <div class="paragraph"> <p>1MB(1048576B)/1048821B   &#8594; ~245B</p> </div> <div class="paragraph"> <p><strong>MemCached client (text protocol, SpyMemcached client) </strong></p> </div> <div class="paragraph"> <p>entry size &#8594; overall memory</p> </div> <div class="paragraph"> <p>512B       &#8594; 139197kB</p> </div> <div class="paragraph"> <p>1kB        &#8594; 120517kB</p> </div> <div class="paragraph"> <p>10kB       &#8594; 104226kB</p> </div> <div class="paragraph"> <p>1MB        &#8594; N/A (SpyMemcached allows max. 20kB per entry)</p> </div> <div class="paragraph"> <p>entry size/actual memory per entry &#8594; overhead per entry</p> </div> <div class="paragraph"> <p>512B/696B               &#8594; ~184B</p> </div> <div class="paragraph"> <p>1kB(1024B)/1205B        &#8594; ~181B</p> </div> <div class="paragraph"> <p>10kB(10240B)/10422B     &#8594; ~182B</p> </div> <div class="paragraph"> <p>==</p> </div> <div class="paragraph"> <p><strong>REST client (Content-Type: application/octet-stream)</strong></p> </div> <div class="paragraph"> <p>entry size &#8594; overall memory</p> </div> <div class="paragraph"> <p>512B       &#8594; 143998kB</p> </div> <div class="paragraph"> <p>1kB        &#8594; 122909kB</p> </div> <div class="paragraph"> <p>10kB       &#8594; 104466kB</p> </div> <div class="paragraph"> <p>1MB        &#8594; 102412kB</p> </div> <div class="paragraph"> <p>entry size/actual memory per entry &#8594; overhead per entry</p> </div> <div class="paragraph"> <p>512B/720B               &#8594; ~208B</p> </div> <div class="paragraph"> <p>1kB(1024B)/1229B        &#8594; ~205B</p> </div> <div class="paragraph"> <p>10kB(10240B)/10446B     &#8594; ~206B</p> </div> <div class="paragraph"> <p>1MB(1048576B)/1048698B  &#8594; ~123B</p> </div> <div class="paragraph"> <p>The memory overhead for individual entries seems to be more or less constant across different cache entry sizes.</p> </div> </div> </div> <div class="sect1"> <h2 id="_memory_overhead_of_infinispan_deployed_as_a_library"><a class="anchor" href="#_memory_overhead_of_infinispan_deployed_as_a_library"></a>Memory overhead of Infinispan deployed as a library</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan was deployed to <a href="http://www.jboss.org/jbossas">JBoss Application Server 7</a> using <a href="http://arquillian.org/">Arquillian</a>.</p> </div> <div class="paragraph"> <p>entry size &#8594; overall memory/overall with storeAsBinary</p> </div> <div class="paragraph"> <p>512B       &#8594; 132736kB / 132733kB</p> </div> <div class="paragraph"> <p>1kB        &#8594; 117568kB / 117568kB</p> </div> <div class="paragraph"> <p>10kB       &#8594; 103953kB / 103950kB</p> </div> <div class="paragraph"> <p>1MB        &#8594; 102414kB / 102415kB</p> </div> <div class="paragraph"> <p>There was almost no difference in overall consumed memory when enabling or disabling storeAsBinary.</p> </div> <div class="paragraph"> <p>entry size/actual memory per entry&#8594; overhead per entry (w/o storeAsBinary)</p> </div> <div class="paragraph"> <p>512B/663B               &#8594; ~151B</p> </div> <div class="paragraph"> <p>1kB(1024B)/1175B        &#8594; ~151B</p> </div> <div class="paragraph"> <p>10kB(10240B)/10395B     &#8594; ~155B</p> </div> <div class="paragraph"> <p>1MB(1048576B)/1048719B  &#8594; ~143B</p> </div> <div class="paragraph"> <p>As you can see, the overhead per entry is constant across different entry sizes and is ~151 bytes.</p> </div> </div> </div> <div class="sect1"> <h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2> <div class="sectionbody"> <div class="paragraph"> <p>The memory overhead is slightly more than 150 bytes per entry when storing data into the cache locally. When accessing the cache via remote clients, the memory overhead is a little bit higher and ranges from ~170 to ~250 bytes, depending on remote client type and cache entry size. If we ignored the statistics for 1MB entries, which could be affected by a small number of entries (100) stored in the cache, the range would have been even narrower.</p> </div> <div class="paragraph"> <p>Cheers, Martin</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/overhead/"> overhead </a> <a class="label" href="/blog/tags/memory/"> memory </a> <a class="label" href="/blog/tags/performance/"> performance </a> <hr> <div class="post"></div> <h3> Thursday, 22 December 2011 </h3> <h1> <a href="/blog/2011/12/22/startup-performance/">Startup performance</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>One of the things I&#8217;ve done recently was to benchmark how quickly Infinispan starts up.  Specifically looking at LOCAL mode (where you don&#8217;t have the delays of opening sockets and discovery protocols you see in clustered mode), I wrote up a very simple test to start up 2000 caches in a loop, using the same cache manager.</p> </div> <div class="paragraph"> <p>This is a pretty valid use case, since when used as a non-clustered 2nd level cache in Hibernate, a separate cache instance is created <em>per entity type</em>, and in the past this has become somewhat of a bottleneck.</p> </div> <div class="paragraph"> <p>In this test, I compared Infinispan 5.0.1.Final, 5.1.0.CR1 and 5.1.0.CR2.  5.1.0 is significantly quicker, but I used this test (and subsequent profiling) to commit a couple of interesting changes in 5.1.0.CR2, which has improved things even more - both in terms of CPU performance as well as memory footprint.</p> </div> <div class="paragraph"> <p>Essentially, 5.1.0.CR1 made use of <a href="https://github.com/jbossas/jandex">Jandex</a> to perform annotation scanning of internal components at build-time, to prevent expensive reflection calls to determine component dependencies and lifecycle at runtime.  5.1.0.CR2 takes this concept a step further - now we don&#8217;t just cache annotation lookups at build-time, but entire dependency graphs.  And determining and ordering of lifecycle methods are done at build-time too, again making startup times significantly quicker while offering a much tighter memory footprint.</p> </div> <div class="paragraph"> <p>Enough talk.  Here is <a href="https://github.com/maniksurtani/InfinispanStartupBenchmark">the test used</a>, and here are the performance numbers, as per my laptop, a 2010 MacBook Pro with an i5 CPU.</p> </div> <div class="paragraph"> <p>Multiverse:InfinispanStartupBenchmark manik [master]$ ./bench.sh  ---- Starting benchmark ---</p> </div> <div class="paragraph"> <p>  Please standby &#8230;&#8203; </p> </div> <div class="paragraph"> <p>Using Infinispan 5.0.1.FINAL (JMX enabled? false)     Created 2000 caches in <strong>10.9 seconds</strong> and consumed <strong>172.32 Mb</strong> of memory.</p> </div> <div class="paragraph"> <p>Using Infinispan 5.0.1.FINAL (JMX enabled? true)     Created 2000 caches in <strong>56.18 seconds</strong> and consumed <strong>315.21 Mb</strong> of memory.</p> </div> <div class="paragraph"> <p>Using Infinispan 5.1.0.CR1 (JMX enabled? false)     Created 2000 caches in <strong>7.13 seconds</strong> and consumed <strong>157.5 Mb</strong> of memory.</p> </div> <div class="paragraph"> <p>Using Infinispan 5.1.0.CR1 (JMX enabled? true)     Created 2000 caches in <strong>34.9 seconds</strong> and consumed <strong>243.33 Mb</strong> of memory.</p> </div> <div class="paragraph"> <p>Using Infinispan 5.1.0.CR2(JMX enabled? false)     Created 2000 caches in <strong>3.18 seconds</strong> and consumed <strong>142.2 Mb</strong> of memory.</p> </div> <div class="paragraph"> <p>Using Infinispan 5.1.0.CR2(JMX enabled? true)     Created 2000 caches in <strong>17.62 seconds</strong> and consumed <strong>176.13 Mb</strong> of memory.</p> </div> <div class="paragraph"> <p>A whopping 3.5 times faster, and significantly more memory-efficient especially when enabling JMX reporting.  :-)</p> </div> <div class="paragraph"> <p>Enjoy! Manik</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/benchmarks/"> benchmarks </a> <a class="label" href="/blog/tags/cpu/"> cpu </a> <a class="label" href="/blog/tags/memory/"> memory </a> <a class="label" href="/blog/tags/performance/"> performance </a> <hr> <div class="pagination-links"><span class="current-page">1</span> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>