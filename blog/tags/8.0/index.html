<!DOCTYPE html> <html lang="en"> <head> <title>Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Thursday, 21 January 2016 </h3> <h1> <a href="/blog/2016/01/21/infinispan-8-talk-on-jbug-london/">Infinispan 8 talk on JBUG London</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><a href="http://4.bp.blogspot.com/-Yk6ff5YQ220/VqF5PYfeW5I/AAAAAAAAAWk/wJSedH83FF4/s1600/jbug.jpg"><span class="image"><img src="http://4.bp.blogspot.com/-Yk6ff5YQ220/VqF5PYfeW5I/AAAAAAAAAWk/wJSedH83FF4/s320/jbug.jpg" alt="image" width="320" height="170"></span></a></p> </div> <div class="paragraph"> <p>In the next Wednesday, 27th January, the London JBUG will host the talk "<strong>Infinispan 8 tour</strong>", presented by Gustavo Fernandes. It&#8217;s the chance to catch up with all the features introduced by Infinispan 8, in a session packed with samples and demos!</p> </div> <div class="paragraph"> <p>Attendance is free, but places are limited. Full details on <a href="https://skillsmatter.com/meetups/7582-infinispan-8-tour#" class="bare">https://skillsmatter.com/meetups/7582-infinispan-8-tour#</a></p> </div> </div> </div> </div> <a class="label" href="/blog/tags/conference/"> conference </a> <a class="label" href="/blog/tags/presentations/"> presentations </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/jbug/"> jbug </a> <hr> <div class="post"></div> <h3> Wednesday, 25 November 2015 </h3> <h1> <a href="/blog/2015/11/25/infinispan-810cr1-and-802final/">Infinispan 8.1.0.CR1 (and 8.0.2.Final)</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear all,</p> </div> <div class="paragraph"> <p>we have two releases for you today:</p> </div> <div class="paragraph"> <p>Infinispan 8.1.0.CR1 brings more refinement to the server management console, many improvements to query, statistics, management, security improvements and more.</p> </div> <div class="paragraph"> <p>Infinispan 8.0.2.Final brings a number of stabilization bug fixes. Upgrading is highly recommended.</p> </div> <div class="paragraph"> <p>You can get both releases from our <a href="http://infinispan.org/download/">download page</a>. If you are new to Infinispan you can <a href="http://infinispan.org/tutorials/">learn</a> how to use it, and <a href="http://infinispan.org/getinvolved/">help</a> us continually improve it.</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/8.1/"> 8.1 </a> <a class="label" href="/blog/tags/release/"> release </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <hr> <div class="post"></div> <h3> Monday, 12 October 2015 </h3> <h1> <a href="/blog/2015/10/12/functional-map-api-listeners/">Functional Map API: Listeners</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>We continue with the blog series on the experimental Functional Map API which was released as part of <a href="http://blog.infinispan.org/2015/08/infinispan-800final.html">Infinispan 8.0.0.Final</a>. In this blog post we&#8217;ll be focusing on how to listen for Functional Map events. For reference, here are the previous entries in the series:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p><a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">Functional Map Introduction</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2015/09/functional-map-api-working-with-single.html">Working with single entries</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2015/09/functional-map-api-working-with.html">Working with multiple entries</a></p> </li> </ol> </div> <div class="paragraph"> <p>The first thing to notice about Functional Map listeners is that they only send events post-event, so that means the events are received after the event has happened. In contrast with Infinispan Cache listeners, there are no pre-event listener invocations. The reason pre-events are not available is because listeners are meant to be an opportunity to find out what has happened, and having pre-events can sometimes hint as if the listener was able to alter the execution of the operation, for which the listener is not really suited. If interested in pre-events or potentially altering the execution, <a href="http://infinispan.org/docs/8.1.x/user_guide/user_guide.html#_custom_interceptors">plugging custom interceptors</a> is the recommended solution.</p> </div> <div class="paragraph"> <p>Functional Map offers two type of event listeners: write-only operation listeners and read-write operation listeners.</p> </div> </div> </div> <div class="sect2"> <h3 id="_write_only_listeners"><a class="anchor" href="#_write_only_listeners"></a>Write-Only Listeners</h3> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html">Write listeners</a> enable users to register listeners for any cache entry write events that happen in either a read-write or write-only functional map.</p> </div> <div class="paragraph"> <p>Listeners for write events cannot distinguish between cache entry created and cache entry modify/update events because they don’t have access to the previous value. All they know is that a new non-null entry has been written. However, write event listeners can distinguish between entry removals and cache entry create/modify-update events because they can query what the new entry’s value via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#find--">ReadEntryView.find()</a> method.</p> </div> <div class="paragraph"> <p>Adding a write listener is done via the WriteListeners interface which is accessible via both <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html#listeners--">ReadWriteMap.listeners()</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#listeners--">WriteOnlyMap.listeners()</a> method. A write listener implementation can be defined either passing a function to <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html#onWrite-java.util.function.Consumer-">onWrite(Consumer&lt;ReadEntryView&lt;K, V&gt;&gt;)</a> method, or passing a WriteListener implementation to <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html#add-org.infinispan.commons.api.functional.Listeners.WriteListeners.WriteListener-">add(WriteListener&lt;K, V&gt;)</a> method. Either way, all these methods return an <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/AutoCloseable.html">AutoCloseable</a> instance that can be used to de-register the function listener. Example and expected output:</p> </div> </div> <div class="sect2"> <h3 id="_read_write_listeners"><a class="anchor" href="#_read_write_listeners"></a>Read-Write Listeners</h3> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html">Read-write listeners</a> enable users to register listeners for cache entry created, modified and removed events, and also register listeners for any cache entry write events. Entry created, modified and removed events can only be fired when these originate on a read-write functional map, since this is the only one that guarantees that the previous value has been read, and hence the differentiation between create, modified and removed can be fully guaranteed.</p> </div> <div class="paragraph"> <p>Adding a read-write listener is done via the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html">ReadWriteListeners</a> interface which is accessible via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html#listeners--">ReadWriteMap.listeners()</a> method. If interested in only one of the event types, the simplest way to add a listener is to pass a function to either <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onCreate-org.infinispan.commons.api.functional.EntryView.ReadEntryView-">onCreate</a>, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onModify-org.infinispan.commons.api.functional.EntryView.ReadEntryView-org.infinispan.commons.api.functional.EntryView.ReadEntryView-">onModify</a> or <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onRemove-org.infinispan.commons.api.functional.EntryView.ReadEntryView-">onRemove</a> methods. Otherwise, if interested in multiple type of events, passing a <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html">ReadWriteListener</a> implementation via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html#add-org.infinispan.commons.api.functional.Listeners.ReadWriteListeners.ReadWriteListener-">add(ReadWriteListener&lt;K, V&gt;)</a> is the easiest. As with write-listeners, all these methods return an AutoCloseable instance that can be used to de-register the listener.</p> </div> <div class="paragraph"> <p>Here&#8217;s an example of adding a ReadWriteListener that handles multiple type of events:</p> </div> </div> <div class="sect2"> <h3 id="_closing_notes"><a class="anchor" href="#_closing_notes"></a>Closing Notes</h3> <div class="paragraph"> <p>More listener event types are yet to be implemented for Functional API, such as expiration events or passivation/activation events. We are capturing this future work and other improvements under the <a href="https://issues.jboss.org/browse/ISPN-5704">ISPN-5704</a> issue.</p> </div> <div class="paragraph"> <p>We&#8217;d love to hear from you on how you are finding this new API. To provide feedback or report any problems with it, head to our <a href="http://infinispan.org/community/">user forums</a> and create a post there.</p> </div> <div class="paragraph"> <p>In next blog post in the series, we&#8217;ll be looking into how to pass per-invocation parameters to tweak operations.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> <a class="label" href="/blog/tags/functional/"> functional </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/listeners/"> listeners </a> <a class="label" href="/blog/tags/API/"> API </a> <hr> <div class="post"></div> <h3> Friday, 25 September 2015 </h3> <h1> <a href="/blog/2015/09/25/memory-based-eviction/">Memory based eviction</a> </h1> <div class="content"> <div class="sect1"> <h2 id="_eviction_today"><a class="anchor" href="#_eviction_today"></a>Eviction Today</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan since its inception has supported a way to help users control how much memory the in memory cache entries consume in the JVM.  This has always been limited to a number of entries.  In the past users have had to estimate the average amount of bytes their entries used on the heap.  With this average you can easily calculate how many entries could safely be stored in memory without running into issues.  For users who have keys and values that are relatively similar this can work well.  However when the case requires entries that vary in size this can be problematic and you end up calculating the average size based on the worse case.</p> </div> </div> </div> <div class="sect1"> <h2 id="_enter_memory_based_eviction"><a class="anchor" href="#_enter_memory_based_eviction"></a>Enter Memory Based Eviction</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan 8 introduces memory based eviction counting.  That is Infinispan will automatically keep track of how large the key, value and overhead if possible.  It can use these values then to try to limit the number of entries instead to a memory count such as 1 Gigabyte.</p> </div> <div class="sect2"> <h3 id="_keyvalue_limitations"><a class="anchor" href="#_keyvalue_limitations"></a>Key/Value limitations</h3> <div class="paragraph"> <p>Unfortunately this is currently limited to only using keys and values stored as primitives, primitive wrappers (ie. Integer), java.lang.String(s) and any of the previously mentioned stored in an array.  This means this feature cannot be used with any custom classes.  If enough feedback is provided we could provide a SPI to allow the user to plug in their own counter for their own classes, but this is not planned currently.</p> </div> <div class="paragraph"> <p>There are a couple ways to easily get around this.  One is to use <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_store_as_binary">storeAsBinary</a>, which will store your keys and/or values as byte arrays for you automatically, satisfying this limitation.  A second way is when you are using the client such as HotRod, in this case the data is stored in the serialized (byte[]) form.  Note that <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_enable_compatibility_mode">compatibility mode</a> will prevent this from occurring and you are unable to use these configurations together.</p> </div> </div> <div class="sect2"> <h3 id="_eviction_type_limitation"><a class="anchor" href="#_eviction_type_limitation"></a>Eviction Type limitation</h3> <div class="paragraph"> <p>Due to the complexity of LIRS, memory based eviction is only supported with LRU at this time. See the types <a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_eviction_strategies">here</a>.  This could be enhanced at a later point, but is also not planned.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_how_to_enable"><a class="anchor" href="#_how_to_enable"></a>How to enable</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can enable memory based eviction either through programmatic or declarative configuration.  Note that Infinispan added long support (limited to 2^48) for the size value which directly helps memory based eviction if users want to utilize caches larger than 2 GB.</p> </div> <div class="sect2"> <h3 id="_programmatic"><a class="anchor" href="#_programmatic"></a>Programmatic</h3> </div> <div class="sect2"> <h3 id="_declarative"><a class="anchor" href="#_declarative"></a>Declarative </h3> <div class="paragraph"> <p>==</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_supported_jvms"><a class="anchor" href="#_supported_jvms"></a>Supported JVMs</h2> <div class="sectionbody"> <div class="paragraph"> <p>This was tested and written specifically for Oracle and OpenJDK JVMs.  In testing these JVMs showed memory accuracy within 1% of desired value. Other JVMs may shown incorrect values.</p> </div> <div class="paragraph"> <p>The algorithm takes into account JVM options, such as compressed pointers and 32 bit JVM vs 64 bit JVM.  Keep in mind this is only for the data container and doesn&#8217;t take into account additional overhead such as created threads or other runtime objects.</p> </div> <div class="paragraph"> <p>Other JVMs are not handled such as the IBM JVM which was briefly tested and showed incorrect numbers greater than 10% of the desired amount.  Support for other JVMs can be added later as interest is shown for them.</p> </div> </div> </div> <div class="sect1"> <h2 id="_closing_notes"><a class="anchor" href="#_closing_notes"></a>Closing Notes</h2> <div class="sectionbody"> <div class="paragraph"> <p>I hope this feature helps people to better handle their memory constraints while using Infinispan!  Let us know if you have any <a href="http://infinispan.org/getinvolved/">feedback or concerns</a>.</p> </div> <div class="paragraph"> <p>Cheers!</p> </div> <div class="paragraph"> <p> - Will</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/eviction/"> eviction </a> <a class="label" href="/blog/tags/memory/"> memory </a> <hr> <div class="post"></div> <h3> Monday, 14 September 2015 </h3> <h1> <a href="/blog/2015/09/14/initial-support-for-apache-avro-and-gora/">Initial Support for Apache Avro and Gora</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><a href="https://avro.apache.org/">Avro</a> and <a href="http://gora.apache.org/">Gora</a> are two Apache projects that belong to the <a href="https://hadoop.apache.org/">Hadoop</a> ecosystem. Avro is a data serialization framework that relies on JSON for defining data types and protocols, and serializes data in a compact binary format. Its primary use in Hadoop is to provide a serialization format for persistent data, and a wire format for communication between Hadoop nodes, and from client programs to the Hadoop services. Gora is an open-source software framework that provides an in-memory data model and persistence for big data. Gora supports persisting to column stores, key/value stores or databases, and analyzing the data with extensive Apache Hadoop MapReduce support.</p> </div> <div class="paragraph"> <p>As an effort to run Hadoop based applications atop Infinispan, the <a href="http://www.leads-project.eu/">LEADS</a> EU FP7 project has developed an Avro backend (<a href="https://github.com/leads-project/infinispan-avro">infinispan-avro</a>) and a Gora module (<a href="https://github.com/leads-project/gora-infinispan">gora-infinispan</a>). The former allows to store, retrieve and query Avro defined types via the HotRod protocol. The latter allows Gora-based applications to use Infinispan as a storage backend for their MapReduce jobs. In the current state of the implementation, the two modules make use of Infinispan 8.0.0.Final, Avro 1.7.6 and Gora 0.6</p> </div> <div class="paragraph"> <p><strong>What’s in it for you Infinispan user</strong></p> </div> <div class="paragraph"> <p>There are several use cases for which you can benefit from those modules.</p> </div> <div class="ulist"> <ul> <li> <p>With Infinispan’s Avro support, you can decide to persist your data in Infinispan using Avro’s portable format instead of Infinispan’s own format (or Java serialization’s format). This might help you standardize upon a common format for your data at rest. </p> </li> <li> <p>If you use Apache Gora to store/query some of your data in, or even out, of the Hadoop ecosystem, you can use Infinispan as the backend and benefit Infinispan’s features that you come to know like data distribution, partition handling, cross-site clustering. </p> </li> <li> <p>The last use case is to run legacy Hadoop applications, using Infinispan as the primary storage. For instance, it is possible to run the Apache <a href="http://nutch.apache.org/">Nutch</a> web crawler atop Infinispan. A recent paper at <a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=7214069&amp;filter%3DAND%28p_IS_Number%3A7212169%29%26rowsPerPage%3D100">IEEE Cloud 2015</a> gives a detailed description of such an approach in a geo-distributed environment (a preprint is available <a href="https://drive.google.com/open?id=0BwFkGepvBDQoakFGdkpKNUNCWmM&amp;authuser=0">here</a>). </p> </li> </ul> </div> </div> </div> </div> <a class="label" href="/blog/tags/marshalling/"> marshalling </a> <a class="label" href="/blog/tags/hotrod/"> hotrod </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/map reduce/"> map reduce </a> <hr> <div class="post"></div> <h3> Monday, 14 September 2015 </h3> <h1> <a href="/blog/2015/09/14/new-redis-cache-store-introduced-in/">New Redis Cache Store Introduced in Infinispan 8</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>A new cache store for storage of cache data within the Redis key/value server has been introduced with Infinispan 8. This allows all storage of cache data to be stored in a centralised Redis deployment which all Infinispan clients access.</p> </div> <div class="paragraph"> <p>The cache store supports 3 Redis deployment topologies. They are, single server, Sentinel and cluster (Redis v3 required). Redis versions 2.8+ and 3.0+ are currently supported.</p> </div> <div class="paragraph"> <p>Data expiration and purging is handled via Redis itself, reducing workload from Infinispan servers to manually delete cache entries.</p> </div> </div> </div> <div class="sect1"> <h2 id="_topologies"><a class="anchor" href="#_topologies"></a><strong>Topologies</strong></h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_single_server"><a class="anchor" href="#_single_server"></a><strong>Single Server</strong></h3> <div class="paragraph"> <p>In a single server deployment, the cache store is given the location of a Redis master server with which it connects to directly to handle all data storage. Using this topology, Redis has no fault tolerance unless a custom solution is built on top of Redis. To declare a single server local cache store:</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="server" socket-timeout="10000" connection-timeout="10000"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> <div class="paragraph"> <p>Note the topology attribute is declared as <strong>server</strong>. This is needed to ensure a single server Redis topology is applied by the cache store. Only a single Redis server need be declared (only the first server will be used if multiple servers are declared) and the port will default to the Redis port 6379, but can be overridden using the port attribute. All connections are handled via a connection pool, which can optionally also test the validity of a connection on creation, lease, return from and when idling in the connection the pool.</p> </div> </div> <div class="sect2"> <h3 id="_sentinel"><a class="anchor" href="#_sentinel"></a><strong>Sentinel</strong></h3> <div class="paragraph"> <p>The Sentinel topology relies on Redis Sentinel servers to connect to a Redis master server. Here, Infinispan connects to Redis Sentinel servers, requesting a master server name, then gets forwarded on to the correct location of the Redis master server. This topology gives resilience via Redis Sentinel, providing failure detection and automatic failover of Redis servers.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="sentinel" master-name="mymaster" socket-timeout="10000" connection-timeout="10000"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server2" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server3" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> <div class="paragraph"> <p>For a Sentinel deployment, the topology attribute changes to <strong>sentinel</strong>. A master name must also be specified to select the correct Redis master required as Sentinel can monitor multiple Redis master servers. The Sentinel server is declared using a sentinel-server XML tag, which you’ll notice is different to the main Redis servers used in single server and cluster topologies. This is to allow defaulting of the Sentinel port to 26379 if not declared. At least one Sentinel server must be declared, though if you run more Sentinel servers, they should all be declared too for the benefit of failure detection of the Sentinel servers themselves.</p> </div> </div> <div class="sect2"> <h3 id="_cluster"><a class="anchor" href="#_cluster"></a><strong>Cluster</strong></h3> <div class="paragraph"> <p>A cluster topology gives Infinispan the ability to connect to a Redis cluster. One or more cluster nodes are declared to infinispan (the more the better) which are then used to store all data. Redis cluster supports failure detection so if a master node in the cluster fails, a slave takes over. Redis v3 is required to run a Redis cluster.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="cluster" socket-timeout="10000" connection-timeout="10000"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server1" port="6379" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server2" port="6379" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;redis-server host="server3" port="6379" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> <div class="paragraph"> <p>For cluster deployments, the topology attribute must change to <strong>cluster.</strong> One or more Redis cluster nodes must be declared to access the cluster which uses the redis-server XML tag. Note that when operating a cluster, database IDs are not supported.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_multiple_cache_stores_single_redis_deployment"><a class="anchor" href="#_multiple_cache_stores_single_redis_deployment"></a><strong>Multiple Cache Stores, Single Redis Deployment</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>Redis single server and Sentinel deployments support the option of database IDs. A database ID allows a single Redis server to host multiple individual databases, referenced via an integer ID number. This allows Infinispan to support multiple cache stores on the same Redis deployment, isolating the data between the stores. Redis cluster does not support the database ID. A database ID is defined using the database attribute on the redis-store XML tag.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="sentinel" master-name="mymaster" socket-timeout="10000" connection-timeout="10000" database="5"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server2" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server3" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> </div> </div> <div class="sect1"> <h2 id="_redis_password_authentication"><a class="anchor" href="#_redis_password_authentication"></a><strong>Redis Password Authentication</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>In order to secure access to a Redis server, a password can optionally be used in Redis. This then requires the cache store to declare the password when connecting. The password is added via a password attribute on the redis-store XML tag.</p> </div> <div class="paragraph"> <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p> </div> <div class="paragraph"> <p>&lt;infinispan</p> </div> <div class="paragraph"> <p>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p> </div> <div class="paragraph"> <p>    xsi:schemaLocation="urn:infinispan:config:8.0 <a href="http://www.infinispan.org/schemas/infinispan-config-8.0.xsd" class="bare">http://www.infinispan.org/schemas/infinispan-config-8.0.xsd</a></p> </div> <div class="paragraph"> <p>                          urn:infinispan:config:store:redis:8.0 <a href="http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"" class="bare">http://www.infinispan.org/schemas/infinispan-cachestore-redis-config-8.0.xsd"</a></p> </div> <div class="paragraph"> <p>    xmlns="urn:infinispan:config:8.0"</p> </div> <div class="paragraph"> <p>    xmlns:redis="urn:infinispan:config:store:redis:8.0" &gt;</p> </div> <div class="paragraph"> <p>    &lt;cache-container&gt;</p> </div> <div class="paragraph"> <p>        &lt;local-cache&gt;</p> </div> <div class="paragraph"> <p>            &lt;persistence passivation="false"&gt;</p> </div> <div class="paragraph"> <p>                &lt;redis-store xmlns="urn:infinispan:config:store:redis:8.0"</p> </div> <div class="paragraph"> <p>                    topology="sentinel" master-name="mymaster" socket-timeout="10000" connection-timeout="10000" password="mysecret"&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server1" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server2" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;sentinel-server host="server3" /&gt;</p> </div> <div class="paragraph"> <p>                    &lt;connection-pool min-idle="6" max-idle="10" max-total="20" min-evictable-idle-time="30000" time-between-eviction-runs="30000" /&gt;</p> </div> <div class="paragraph"> <p>                &lt;/redis-store&gt;</p> </div> <div class="paragraph"> <p>            &lt;/persistence&gt;</p> </div> <div class="paragraph"> <p>        &lt;/local-cache&gt;</p> </div> <div class="paragraph"> <p>    &lt;/cache-container&gt;</p> </div> <div class="paragraph"> <p>&lt;/infinispan&gt;</p> </div> </div> </div> <div class="sect1"> <h2 id="_what_about_ssl_support"><a class="anchor" href="#_what_about_ssl_support"></a><strong>What about SSL support?</strong></h2> <div class="sectionbody"> <div class="paragraph"> <p>Redis does not provide protocol encryption, instead leaving this to other specialist software. At this time, the Redis client used to integrate Infinispan with Redis servers (Jedis) does not yet support SSL connection negotiation natively.</p> </div> <div class="paragraph"> <p>**</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/release/"> release </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/redis/"> redis </a> <a class="label" href="/blog/tags/cache store/"> cache store </a> <hr> <div class="post"></div> <h3> Thursday, 10 September 2015 </h3> <h1> <a href="/blog/2015/09/10/infinispan-801final-and-725final/">Infinispan 8.0.1.Final (and 7.2.5.Final)</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear all,</p> </div> <div class="paragraph"> <p>we&#8217;ve just cooked two new point releases of Infinispan to address a number of issues.</p> </div> <div class="paragraph"> <p>The highlights for 8.0.1.Final are:  </p> </div> <div class="ulist"> <ul> <li> <p>ISPN-5717 Notify continuous query also when entry expires</p> </li> <li> <p>ISPN-5591 Simple local cache without interceptor stack. This is an extremely fast cache with very few features (no transactions, no indexing, no persistence, etc). Its primary intendend usage is as a 2nd-level cache for Hibernate, but we&#8217;re sure you can find lot&#8217;s of other applications for it, provided you don&#8217;t require all the bells and whistles that come with our fully-fledged caches.</p> </li> <li> <p>Bump Hibernate Search to 5.5.0.CR1 and Lucene to 5.3.0</p> </li> <li> <p>A number of query fixes, including indexing and searching of null non-string properties, aggregation expressions in orderBy, filter with both 'where' and 'having' in the same query</p> </li> <li> <p>ISPN-5731 Cannot use aggregation expression in orderBy</p> </li> <li> <p>Read the complete <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12328068">release notes</a></p> </li> </ul> </div> <div class="paragraph"> <p>The highlights for 7.2.5.Final are:</p> </div> <div class="ulist"> <ul> <li> <p>ISPN-5607 Preemptively invalidate near cache after writes</p> </li> <li> <p>ISPN-5670 Hot Rod server sets -1 for lifespan or maxIdle as default</p> </li> <li> <p>ISPN-5677 RemoteCache async methods use flags</p> </li> <li> <p>ISPN-5684 Make getAll work with compatibility mode in DIST</p> </li> <li> <p>Read the complete <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12327781">release notes</a></p> </li> </ul> </div> <div class="paragraph"> <p><a href="http://infinispan.org/download/">Get</a> it, <a href="http://infinispan.org/tutorials/">learn</a> how to use it, <a href="http://infinispan.org/getinvolved/">help</a> us improve it.</p> </div> <div class="paragraph"> <p>Enjoy !</p> </div> <div class="paragraph"> <p>The Infinispan team</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/7.2/"> 7.2 </a> <a class="label" href="/blog/tags/release/"> release </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <hr> <div class="post"></div> <h3> Tuesday, 08 September 2015 </h3> <h1> <a href="/blog/2015/09/08/functional-map-api-working-with/">Functional Map API: Working with multiple entries</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>We continue with the blog series on the experimental Functional Map API which was released as part of Infinispan 8.0.0.Final. In this blog post we&#8217;ll be focusing on how to work with multiple entries at the same time. For reference, here are the previous entries in the series:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p><a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">Functional Map Introduction</a></p> </li> <li> <p><a href="http://blog.infinispan.org/2015/09/functional-map-api-working-with-single.html">Working with single entries</a></p> </li> </ol> </div> <div class="paragraph"> <p>The approach taken by the Functional Map API when working with multiple keys is to provide a lazy, pull-style API. All multi-key operations take a collection parameter which indicates the keys to work with (and sometimes contain value information too), and a function to execute for each key/value pair. Each function&#8217;s ability depends on the entry view received as function parameter, which changes depending on the underlying map: <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html">ReadEntryView</a> for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a>, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.WriteEntryView.html">WriteEntryView</a> for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a>, or <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadWriteEntryView.html">ReadWriteView</a> for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a>. The return type for all multi-key operations, except the ones from <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a>, return an instance of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> which exposes methods for working with the returned data from each function execution. Let&#8217;s see an example:</p> </div> <div class="paragraph"> <p>This example demonstrates some of the key aspects of working with multiple entries using the Functional Map API:</p> </div> <div class="ulist"> <ul> <li> <p>As explained in the previous blog post, all data-handling methods (including multi-key methods) for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a> return <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;Void&gt;</a>, because there&#8217;s nothing the function can provide that could not be computed in advance or outside the function.</p> </li> <li> <p>Normally, the order of the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> matches the order of the input collection though this is not currently guaranteed.</p> </li> </ul> </div> <div class="paragraph"> <p>There is a special type of multi-key operations which work on all keys/entries stored in Infinispan. The behaviour is very similar to the multi-key operations shown above, with the exception that they do not take a collection of keys (and/or values) as parameters:</p> </div> <div class="paragraph"> <p>There&#8217;s a few interesting things to note about working with all entries using the Functional Map API:</p> </div> <div class="ulist"> <ul> <li> <p>When working with all entries, the order of the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> is not guaranteed.</p> </li> <li> <p>Read-only&#8217;s <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html#keys--">keys()</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html#entries--">entries()</a> offer the possibility to traverse all keys and entries present in the cache. When traversing entries, both keys and values including metadata are available. Contrary to Java&#8217;s <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a>, there&#8217;s no possibility to navigate only the values (and metadata) since there&#8217;s little to be gained from such method and once a key&#8217;s entry has been retrieved, there&#8217;s no extra cost to provide the key as well.</p> </li> </ul> </div> <div class="paragraph"> <p>It&#8217;s worth noting that when we sat down to think about how to work with multiple entries, we considered having a push-style API where the user would receive callbacks pushed as the entries to work with were located. This is the approach that reactive APIs such as <a href="http://reactivex.io/">Rx</a> follow, but we decided against using such APIs at this level for several reasons:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>We have huge interest in providing a Rx-style API for Infinispan, but we didn&#8217;t want the core API to have a dependency on <a href="http://reactivex.io/">Rx</a> or <a href="http://www.reactive-streams.org/">Reactive Streams</a>. </p> </li> <li> <p>We didn&#8217;t want to reimplement a push-style async API since this is not trivial to do and requires careful thinking, specially around back-pressure and flow control.</p> </li> <li> <p>Push-style APIs require more work on the user side compared to pull-style APIs.</p> </li> <li> <p>Pull-style APIs can still be lazy and partly asynchronous since the user can decide to work with the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> at a later stage, and the separation between intermediate and terminating operations provides a good abstraction to avoid unnecessary computation.</p> </li> </ol> </div> <div class="paragraph"> <p>In fact, it is this desire to keep a clear separation between intermediate and terminating operations at <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> that has resulted in having no manual way to iterate over the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a>. In other words, there is no iterator() nor spliterator() methods in <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html">Traversable</a> since these are often associated with manual, user-end iteration, and we want to avoid such thing since in the majority of cases, Infinispan knows best how to exactly iterate over the data.</p> </div> <div class="paragraph"> <p>In the next blog post, we&#8217;ll be looking at how to work with listeners using the Functional Map API.</p> </div> <div class="paragraph"> <p>Cheers, Galder</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/functional/"> functional </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/API/"> API </a> <a class="label" href="/blog/tags/lambda/"> lambda </a> <hr> <div class="post"></div> <h3> Wednesday, 02 September 2015 </h3> <h1> <a href="/blog/2015/09/02/functional-map-api-working-with-single/">Functional Map API: Working with single entries</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>In this blog post we&#8217;ll continue with the introduction of the experimental Functional Map API, which was released as part of <a href="http://blog.infinispan.org/2015/08/infinispan-800final.html">Infinispan 8.0.0.Final</a>, focusing on how to manipulate data using single-key operations.</p> </div> <div class="paragraph"> <p>As mentioned in the <a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">Functional Map API introduction</a>, there are three types of operations that can be executed against a functional map: read-only operations (executed via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a>), write-only operations (executed via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a>), and read-write operations (executed via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a>) and .</p> </div> <div class="paragraph"> <p>Firstly, we need construct instances of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a>, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a> to be able to work with them:</p> </div> <div class="paragraph"> <p>Next, let&#8217;s see all three types of operations in action, chaining them to store a single key/value pair along with some metadata, then read it and finally delete a returning the previously stored data:</p> </div> <div class="paragraph"> <p>This example demonstrates some of the key aspects of working with single entries using the Functional Map API:</p> </div> <div class="ulist"> <ul> <li> <p>Single entry methods are asynchronous returning <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> instances which provide methods to compose and chain operations so that it can feel is they&#8217;re being executed sequentially. Unfortunately Java does not have <a href="https://en.wikibooks.org/wiki/Haskell/do_notation">Haskell&#8217;s do notation</a> or <a href="http://docs.scala-lang.org/tutorials/FAQ/yield.html">Scala&#8217;s for comprehensions</a> to make it more palatable, but it&#8217;s great news that Java finally offers mechanisms to work with CompletableFutures in a non-blocking way, even if they&#8217;re a bit more verbose than what&#8217;s proposed in other languages.</p> </li> <li> <p>All data-handling methods for <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">WriteOnlyMap</a> return <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture&lt;Void&gt;</a>, meaning that the user can find out when the operation has completed but nothing else, because there&#8217;s nothing the function can provide that could not be computed in advance or outside the function.</p> </li> <li> <p>The return type for most of the data handling methods in <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html">ReadOnlyMap</a> (and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">ReadWriteMap</a>) are quite flexible. So, a function can decide to return value information, or metadata, or for convenience, it can also return the ReadEntryView it receives as parameter. This can be useful for users wanting to return both value and metadata parameter information.</p> </li> <li> <p>The read-write operation demonstrated above showed how to remove an entry and return the previously associated value. In this particular case, we know there&#8217;s a value associated with the entry and hence we called <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html">ReadEntryView.get()</a> directly, but if we were not sure if the value is present or not, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#find--">ReadEntryView.find()</a> should be called and return the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> instance instead.</p> </li> <li> <p>In the example, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.MetaLifespan.html">Lifespan metadata parameter</a> is constructed using the new Java Time API available in Java 8, but it could have been done equally with <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeUnit.html">java.util.concurrent.TimeUnit</a> as long as the conversion was done to number of milliseconds during which the entry should be accessible.</p> </li> <li> <p>Lifespan-based expiration works just as it does with other Infinispan APIs, so you can easily modify the example to lower the lifespan, wait for duration to pass and then verify that the value is not present any more.</p> </li> </ul> </div> <div class="paragraph"> <p>If storing a constant value, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#eval-K-java.util.function.Consumer-">WriteOnlyMap.eval(K, Consumer)</a> could be used instead of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#eval-K-V-java.util.function.BiConsumer-">WriteOnlyMap.eval(K, V, Consumer)</a>, making the code clearer, but if the value is variable, <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#eval-K-V-java.util.function.BiConsumer-">WriteOnlyMap.eval(K, V, Consumer)</a> should be used to avoid, as much as possible, functions capturing external variables. Clearly, operations exposed by functional map can&#8217;t cover all scenarios and there might be situations where external variables are captured by functions, but these should in general, should be a minority. Here is as example showing how to implement <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListMap.html#replace-K-V-V-">ConcurrentMap.replace(K, V, V)</a> where external variable capturing is required:</p> </div> <div class="paragraph"> <p>The reason we didn&#8217;t add a WriteOnly.eval(K, V, V, Consumer) to the API is because value-equality-based replace comparisons are just one type of replace operations that could be executed. In other cases, metadata parameter based comparison might be more suitable, e.g. Hot Rod replace operation where version (a type of metadata parameter) equality is the deciding factor to determine whether the replace should happen or not.</p> </div> <div class="paragraph"> <p>In the next blog post, we&#8217;ll be looking at how to work with multiple entries using the Functional Map API.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/functional/"> functional </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <a class="label" href="/blog/tags/introduction/"> introduction </a> <a class="label" href="/blog/tags/API/"> API </a> <a class="label" href="/blog/tags/lambda/"> lambda </a> <hr> <div class="post"></div> <h3> Monday, 31 August 2015 </h3> <h1> <a href="/blog/2015/08/31/infinispan-800final/">Infinispan 8.0.0.Final</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear all,</p> </div> <div class="paragraph"> <p>it is with the greatest pleasure that we announce the first stable release of Infinispan 8.</p> </div> <div class="paragraph"> <p><a href="http://1.bp.blogspot.com/-Lpj9nKgBhfg/VUx71csPPWI/AAAAAAAAIBE/ny7hhnn8W2A/s1600/infinispan8.png"><span class="image"><img src="http://1.bp.blogspot.com/-Lpj9nKgBhfg/VUx71csPPWI/AAAAAAAAIBE/ny7hhnn8W2A/s320/infinispan8.png" alt="image" width="320" height="94"></span></a></p> </div> <div class="paragraph"> <p> The number "8" is quite special for Infinispan for two reasons:</p> </div> <div class="ulist"> <ul> <li> <p>it has been embedded in our logo, disguised as the infinity symbol, since the very beginning</p> </li> <li> <p>it marks the move of the Infinispan code-base to Java 8</p> </li> </ul> </div> <div class="paragraph"> <p>So without further ado, let&#8217;s see what Infinispan 8 brings to the table:</p> </div> <div class="ulist"> <ul> <li> <p>A new functional-style API for interacting with caches which takes advantage of all the language goodies introduced by Java 8, such as lambdas, Optional, CompletableFuture, etc. We have already <a href="http://blog.infinispan.org/2015/08/new-functional-map-api-in-infinispan-8.html">started</a> a blog series describing the API, and the reasoning behind it and we want your opinion too.</p> </li> <li> <p>Support for the Java 8&#8217;s Streams API which, in the context of Infinispan, becomes fully distributed: parallel streams become truly parallel !</p> </li> <li> <p>Indexing and querying received a host of new features: Continuous querying, grouping and aggregation, simultaneous querying on both indexed and non-indexed fields.</p> </li> <li> <p>Expired entries now trigger events, thus allowing your applications to perform operations like refresh from an external datasource, archiving, etc.</p> </li> <li> <p>Eviction is now memory size-aware, so you can define the maximum amount of memory you want a cache to grow to, before entries are removed or passivated to an external store. </p> </li> <li> <p>Infinispan Server now fully supports domain mode, and that is now the recommended way for clustered operations.</p> </li> <li> <p>We have a new management console for Infinispan Server which will greatly simplify configuration and monitoring without requiring an external console. This is evolving rapidly and we will be adding quite a lot of functionality in the following months.</p> </li> <li> <p>We are working hard to reduce the number of resources used by Infinispan and removing many internal locks and increasing concurrency. This work is ongoing and you will see further improvements during the 8.x series.</p> </li> <li> <p>We now provide integrations with <a href="http://spark.apache.org/">Spark</a> and <a href="http://hadoop.apache.org/">Hadoop</a> so that you can use all of the wonderful processing tools from those ecosystem against data stored in Infinispan.</p> </li> <li> <p>Both the declarative and programmatic configuration API have been enhanced to support templates and configuration inheritance. It should make your life easier when you need many caches configured in the same way.</p> </li> <li> <p>A cache store for <a href="http://redis.io/">Redis</a> implemented by Simon Paulger. Thanks for the contribution !</p> </li> <li> <p>Lots more&#8230;&#8203; Look at the resolved issues to find out what else we&#8217;ve fixed.</p> </li> </ul> </div> <div class="paragraph"> <p>We have also made some significant changes to our <a href="http://infinispan.org/">website</a>:</p> </div> <div class="ulist"> <ul> <li> <p>clearer layout</p> </li> <li> <p>brand new use-case-driven examples</p> </li> <li> <p>the download page for cache stores are now clearly divides core cache stores (i.e. the ones included in Infinispan release), extra stores (i.e. ones that need to be downloaded separately) and the version compatibility</p> </li> <li> <p>project references, i.e. other open-source projects which use Infinispan</p> </li> </ul> </div> <div class="paragraph"> <p>The 8.0 release marks only the beginning of a number of exciting things we will be working on, so please check out our <a href="http://infinispan.org/roadmap/">roadmap</a>.</p> </div> <div class="paragraph"> <p>An important note: we will be maintaining the 7.2 branch of Infinispan for quite a while, so, if you are still stuck with Java 7, you shouldn&#8217;t worry about upgrading just yet&#8230;&#8203; unless you want to use the new stuff :)</p> </div> </div> </div> </div> <a class="label" href="/blog/tags/release/"> release </a> <a class="label" href="/blog/tags/8.0/"> 8.0 </a> <hr> <div class="pagination-links"><span class="current-page">1</span> <a href="/blog/tags/8.0/page/2/" class="page-link">2</a> <a href="/blog/tags/8.0/page/2/" class="next-link">Next</a> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>