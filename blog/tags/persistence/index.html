<!DOCTYPE html> <html lang="en"> <head> <title> Blog - Infinispan</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="DENY" http-equiv="X-Frame-Options"> <meta content="1; mode=block" http-equiv="X-XSS-Protection"> <meta content="nosniff" http-equiv="X-Content-Type-Options"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet"> <script crossorigin="anonymous" src="https://kit.fontawesome.com/4167a38cfa.js"></script> <script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script> <link href="/images/favicon.png" rel="shortcut icon" type="image/png"> <link href="//static.jboss.org/images/example/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="//static.jboss.org/images/example/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="//static.jboss.org/images/example/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="//static.jboss.org/images/example/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" rel="stylesheet"> <link href="https://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet"> <style>
      .jumbotron {
        padding: 0.5em 0.1em 0.5em 0.1em;
        background-image: none;
        background-color: #ffec9f;
      }
      .jumbotron p, 
      .jumbotron h1 {
        color: #656565;
      }
      .dropup {
        z-index: 1032;
      }
      .navbar {
        font-size: x-large;
      }
      .navbar ul {
        padding-top: 0.7em;
      }
      .navbar-brand {
        height: 80px;
      }
      .navbar-default {
        background-color: white;
      }
      .navbar-default .navbar-nav > li > a {
        color: #336699;
      }
      .navbar-default .navbar-nav > li > a:hover {
        color: #204060;
      }
      .navbar-default .navbar-nav > .open > a,
      .navbar-default .navbar-nav > .open > a:hover,
      .navbar-default .navbar-nav > .open > a:focus {
        background-color: #4a5d75;
      }
      h3.well {
        border-color: #ffd630;
        background-color: #ffec9f;
      }
      .panel-sidebar {
        border-color: #f5f5f5;
      }
      .panel-sidebar > .panel-heading {
        border-color: #e3e3e3;
        background-color: #f5f5f5;
        color: #656565;
      }
      .btn-primary {
        border-color: #ffd630;
        background-color: #ffec9f;
        color: #656565;
      }
      footer.container {
        background-color: white;
      }
      footer.container h1, footer.container h2, footer.container h3, footer.container h4, footer.container h5, footer.container h6, footer.container p, footer.container a {
        color: #656565;
      }
      footer.container ul {
        padding: 0;
      }
      i.enormous-icon {
        margin-top: 0.3em;
      }
      .home-examples {
        font-size: 16px;
      }
    </style> <script src="//static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
    ga('create', 'UA-8601422-1', 'auto');
    ga('send', 'pageview');
    
    </script> </head> <body> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div class="container" id="content"> <nav class="navbar navbar-default navbar-fixed-top"> <div class="container"> <div class="navbar-header"> <button aria-expanded="false" class="navbar-toggle collapsed" data-target="#thenavbar" data-toggle="collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img alt="Infinispan" src="/images/infinispan_nav_brand.png"> </a> </div> <div class="navbar-collapse collapse" id="thenavbar"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/about">About <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/about">Introduction</a></li> <li><a href="/features">Features</a></li> <li><a href="/release-notes">Release notes</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/experiments/">Experiments</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/documentation">Learn <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/documentation">Documentation</a></li> <li><a href="/tutorials">Tutorials</a></li> <li><a href="/videos">Videos</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/download">Download <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/download">Infinispan Releases</a></li> <li><a href="/cache-store-implementations">Cache Store Implementations</a></li> <li><a href="/hotrod-clients">Hot Rod Clients</a></li> <li><a href="/integrations">Integrations</a></li> <li><a href="/download-archive">Archive</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="/community">Community <b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="/community">Ask for Help</a></li> <li><a href="/getinvolved">Get Involved</a></li> </ul> </li> <li class=""><a href="/roadmap">Road Map</a></li> <li class="divider"></li> </ul> </div> </div> </nav> <div class="post"></div> <h3> Monday, 05 December 2016 </h3> <h1> <a href="/blog/2016/12/05/composing-infinispan-docker-image/">Composing the Infinispan Docker image</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>In the <a href="http://blog.infinispan.org/2016/10/infinispan-docker-image-custom.html">previous</a> post we showed how to manipulate the Infinispan Docker container configuration at both runtime and boot time.</p> </div> <div class="paragraph"> <p>Before diving into multi-host Docker usage, in this post we&#8217;ll explore how to create multi-container Docker applications involving Infinispan with the help of <a href="https://docs.docker.com/compose/">Docker Compose</a>.</p> </div> <div class="paragraph"> <p>For this we&#8217;ll look at a typical scenario of an Infinispan server backed by an Oracle database as a cache store.</p> </div> <div class="paragraph"> <p>All the code for this sample can be found on <a href="https://github.com/gustavonalle/infinispan-docker-compose">github</a>.</p> </div> </div> </div> <div class="sect2"> <h3 id=""><a class="anchor" href="#"></a> </h3> </div> <div class="sect2"> <h3 id="_infinispan_with_oracle_jdbc_cache_store"><a class="anchor" href="#_infinispan_with_oracle_jdbc_cache_store"></a>Infinispan with Oracle JDBC cache store</h3> </div> <div class="sect2"> <h3 id="_2"><a class="anchor" href="#_2"></a> </h3> <div class="paragraph"> <p>In order to have a cache with persistence with Oracle, we need to do some configuration: configure the driver in the server, create the data source associated with the driver, and configure the cache itself with JDBC persistence.</p> </div> <div class="paragraph"> <p>Let&#8217;s take a look at each of those steps:</p> </div> <div class="sect4"> <h5 id="_obtaining_and_configuring_the_driver"><a class="anchor" href="#_obtaining_and_configuring_the_driver"></a>Obtaining and configuring the driver</h5> <div class="paragraph"> <p>The driver (ojdbc6.jar) should be <a href="http://www.oracle.com/technetwork/apps-tech/jdbc-112010-090769.html">downloaded</a> and placed in the 'driver' folder of the sample project.</p> </div> <div class="paragraph"> <p>The module.xml declaration used to make it available on the server is as follows:</p> </div> </div> <div class="sect4"> <h5 id="_configuring_the_data_source"><a class="anchor" href="#_configuring_the_data_source"></a>Configuring the Data source</h5> <div class="paragraph"> <p>The data source is configured in the "datasource" element of the server configuration file as shown below:</p> </div> <div class="paragraph"> <p>and inside the "datasource/drivers" element, we need to declare the driver:</p> </div> </div> <div class="sect4"> <h5 id="_creating_the_cache"><a class="anchor" href="#_creating_the_cache"></a>Creating the cache</h5> <div class="paragraph"> <p>The last piece is to define a cache with the proper JDBC Store:</p> </div> </div> <div class="sect4"> <h5 id="_putting_all_together"><a class="anchor" href="#_putting_all_together"></a>Putting all together</h5> <div class="paragraph"> <p>From now on, without using Docker we&#8217;d be ready to download and install Oracle following the specific instructions for your OS, then download the Infinispan Server, edit the configuration files, copy over the driver jar, figure out how to launch the database and server, taking care not to have any port conflicts.</p> </div> <div class="paragraph"> <p>If it sounds too much work, it&#8217;s because it really is. Wouldn&#8217;t it be nice to have all these wired together and launched with a simple command line? Let&#8217;s take a look at the Docker way next. </p> </div> </div> </div> <div class="sect2"> <h3 id="_enter_docker_compose"><a class="anchor" href="#_enter_docker_compose"></a>Enter Docker Compose</h3> <div class="paragraph"> <p>Docker Compose is a tool part of the Docker stack to facilitate configuration, execution and management of related Docker containers.</p> </div> <div class="paragraph"> <p>By describing the application aspects in a single yaml file, it allows centralized control of the containers, including custom configuration and parameters, and it also allows runtime interactions with each of the exposed services.</p> </div> <div class="sect4"> <h5 id="_composing_infinispan"><a class="anchor" href="#_composing_infinispan"></a>Composing Infinispan</h5> <div class="paragraph"> <p>Our Docker Compose file to assemble the application is given below:</p> </div> <div class="paragraph"> <p>It contains two services:</p> </div> <div class="ulist"> <ul> <li> <p>one called <strong><em>oracle</em></strong> that uses the <a href="https://hub.docker.com/r/wnameless/oracle-xe-11g/">wnameless/oracle-xe-11g</a> Docker image, with an environment variable to allow remote connections.</p> </li> <li> <p> another one called <em>*infinispan*</em> that uses version 8.2.5.Final of the <a href="https://store.docker.com/community/images/jboss/infinispan-server">Infinispan Server image</a>. It is launched with a custom command pointing to the changed configuration file and it also mounts two volumes in the container: one for the driver and its module.xml and another for the folder holding our server xml configuration.</p> </li> </ul> </div> </div> <div class="sect4"> <h5 id="_launching"><a class="anchor" href="#_launching"></a>Launching</h5> <div class="paragraph"> <p>To start the application, just execute</p> </div> <div class="paragraph"> <p>To inspect the status of the containers:</p> </div> <div class="paragraph"> <p>To follow the Infinispan server logs, use:</p> </div> <div class="paragraph"> <p>Infinispan usually starts faster than the database, and since the server waits until the database is ready (more on that later), keep an eye in the log output for "Infinispan Server 8.2.5.Final (WildFly Core 2.0.10.Final) started". After that, both Infinispan and Oracle are properly initialized.</p> </div> </div> <div class="sect4"> <h5 id="_testing_it"><a class="anchor" href="#_testing_it"></a>Testing it</h5> <div class="paragraph"> <p>Let&#8217;s insert a value using the Rest endpoint from Infinispan and verify it was saved to the Oracle database:</p> </div> <div class="paragraph"> <p>To check the Oracle database, we can attach to the container and use Sqlplus:</p> </div> </div> <div class="sect4"> <h5 id="_other_operations"><a class="anchor" href="#_other_operations"></a>Other operations</h5> <div class="paragraph"> <p>It&#8217;s also possible to increase and decrease the number of containers for each of the services:</p> </div> </div> </div> <div class="sect2"> <h3 id="_a_thing_or_two_about_startup_order"><a class="anchor" href="#_a_thing_or_two_about_startup_order"></a>A thing or two about startup order</h3> </div> <div class="sect2"> <h3 id="_3"><a class="anchor" href="#_3"></a> </h3> <div class="paragraph"> <p>When dealing with dependent containers in Docker based environments, it&#8217;s highly recommended to make the connection obtention between parties robust enough so that the fact that one dependency is not totally initialized doesn&#8217;t cause the whole application to fail when starting.</p> </div> <div class="paragraph"> <p>Although Compose does have a <strong><em>depends_on</em></strong> instruction, it simply starts the containers in the declared order but it has no means to detected when a certain container is fully initialized and ready to serve requests before launching a dependent one.</p> </div> <div class="paragraph"> <p>One may be tempted to simply write some glue script to detect if a certain port is open, but that does not work in practice: the network socket may be opened, but the background service could still be in transient initialization state.</p> </div> <div class="paragraph"> <p>The recommended solution for this it to make whoever depends on a service to retry periodically until the dependency is ready. On the Infinispan + Oracle case, we specifically configured the data source with retries to avoid failing at once if the database is not ready:</p> </div> <div class="paragraph"> <p>When starting the application via Compose you&#8217;ll notice that Infinispan print some WARN with connection exceptions until Oracle is available: don&#8217;t panic, this is expected!</p> </div> </div> <div class="sect2"> <h3 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h3> <div class="paragraph"> <p>Docker Compose is a powerful and easy to use tool to launch applications involving multiple containers: in this post it allowed to start Infinispan plus Oracle with custom configurations with a single command. It&#8217;s also a handy tool to have during development and testing phase of a project, specially when using/evaluating Infinispan with its many possible integrations.</p> </div> <div class="paragraph"> <p>Be sure to check other examples of using Docker Compose involving Infinispan: the <a href="https://github.com/infinispan/infinispan-spark/tree/master/examples/twitter">Infinispan+Spark Twitter demo</a>, and the <a href="https://github.com/infinispan/infinispan-hadoop/tree/master/samples/flink">Infinispan+Apache Flink</a> demo.</p> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 03 February 2016 </h3> <h1> <a href="/blog/2016/02/03/the-return-of-cassandra-cachestore/">The return of the Cassandra CacheStore</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Ever since we spruced up our Cache Store SPI in Infinispan 6.0, some of our "extra" cache stores have lied in a state of semi-abandonment, waiting for a kind soul with time and determination to bring them back to life. I&#8217;m glad to announce that such a kind soul, in the form of Jakub Markos, had the necessary qualities to accomplish the resurrection of the Cassandra Cache Store.</p> </div> <div class="paragraph"> <p><a href="http://cassandra.apache.org/">Apache Cassandra</a> is a database with a distributed architecture which can be used to provide a virtually unlimited, horizontally scalable persistent store for Infinispan&#8217;s caches. The new Cassandra Cache Store leverages the Datastax Cassandra client driver instead of the old Thrift client approach, which makes it much more robust and reliable.</p> </div> </div> </div> <div class="sect1"> <h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>In order to use this cache store you need to add the following dependency to your project:</p> </div> <div class="paragraph"> <p>You will also need to create an appropriate keyspace on your Cassandra database, or configure the auto-create-keyspace to create it automatically. The following CQL commands show how to configure the keyspace manually (using cqlsh for example):</p> </div> <div class="paragraph"> <p>You then need to add an appropriate cache declaration to your <code>infinispan.xml</code> (or whichever file you use to configure Infinispan):</p> </div> <div class="paragraph"> <p>It is important the the shared property on the cassandra-store element is set to true because all the Infinispan nodes will share the same Cassandra cluster.</p> </div> </div> </div> <div class="sect1"> <h2 id="_limitations"><a class="anchor" href="#_limitations"></a>Limitations</h2> <div class="sectionbody"> <div class="paragraph"> <p>The cache store uses Cassandra&#8217;s own expiration mechanisms (time to live = TTL) to handle expiration of entries. Since TTL is specified in seconds, expiration lifespan and maxIdle values are handled only with seconds-precision.</p> </div> <div class="paragraph"> <p>In addition to this, when both lifespan and maxIdle are used, entries in the cache store effectively behave as if their lifespan = maxIdle, due to an existing bug <a href="https://issues.jboss.org/browse/ISPN-3202" class="bare">https://issues.jboss.org/browse/ISPN-3202</a>.</p> </div> <div class="paragraph"> <p>So, try it out and <a href="https://developer.jboss.org/en/infinispan/content">let us know</a> about your experience !</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Tuesday, 19 November 2013 </h3> <h1> <a href="/blog/2013/11/19/infinispan-600final-is-out/">Infinispan 6.0.0.Final is out!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div id="docs-internal-guid-54debdf5-71e3-c43d-f1fc-150a34a883db" class="paragraph"> <p>Dear Infinispan community,</p> </div> <div class="paragraph"> <p>We&#8217;re pleased to announce the final release of Infinispan 6.0 "Infinium". As <a href="http://infinispan.blogspot.co.uk/2013/05/infinispan-to-adopt-apache-software.html">announced</a>, this is the first Infinispan stable version to be released under the terms of <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License v2.0</a>.</p> </div> <div class="paragraph"> <p>This release brings some highly demanded features besides many stability enhancements and bug fixes:</p> </div> <div class="ulist"> <ul> <li> <p>Support for <a href="http://blog.infinispan.org/2013/09/embedded-and-remote-query-in-infinispan.html">remote query</a>. It is now possible for the HotRod clients to query an Infinispan grid using a new expressive query DSL. This querying functionality is built on top of Apache Lucene and Google Protobuf and lays the foundation for storing information and querying an Infinispan server in a language neutral manner. The Java HotRod client has already been enhanced to support this, the soon-to-be announced C++ HotRod client will also contain this functionality (initially for write/read, then full blown querying).</p> </li> <li> <p>C HotRod client.  Allows C applications to read and write information from an Infinispan server. This is a fully fledged HotRod client that is topology (level 2) and consistent hash aware (level 3) and will be released in the following days. Some features (such as Remote Query and SSL support) will be developed during the next iteration so that it maintains feature parity with its Java counterpart.</p> </li> <li> <p>Better persistence integration. We’ve revisited the entire cache loader API and we’re quite pleased with the result: the new <a href="http://blog.infinispan.org/2013/09/new-persistence-api-in-infinispan.html">Persistence API</a> brought by Infinispan 6.0 supports parallel iteration of the stored entries, reduces the overall serialization overhead and also is aligned with the <a href="http://jcp.org/en/jsr/detail?id=107">JSR-107</a> specification, which makes implementations more portable.</p> </li> <li> <p>A more efficient FileCacheStore <a href="http://blog.infinispan.org/2013/07/faster-file-cache-store-no-extra.html">implementation</a>. This file store is built with efficiency in mind: it outperforms the existing file store with up to 2 levels of magnitude. This comes at a cost though, as keys need to be kept  in memory. Thanks to <a href="https://github.com/kblees">Karsten Blees</a> for contributing this!</p> </li> <li> <p>Support for <a href="http://blog.infinispan.org/2013/09/heterogenous-clusters-with-infinispan.html">heterogeneous clusters</a>. Up to this release, every member of the cluster owns an equal share of the cluster’s data. This doesn’t work well if one machine is more powerful than the other cluster participants. This functionality allows specifying the amount of data, compared with the average, held by a particular machine.</p> </li> <li> <p>A new set of usage and performance <a href="https://issues.jboss.org/browse/ISPN-2861">statistics</a> developed within the scope of the CloudTM projecthttps://issues.jboss.org/browse/ISPN-3234[].</p> </li> <li> <p><a href="https://issues.jboss.org/browse/ISPN-3234">JCache</a> (JSR-107) implementation upgrade. First released in Infinispan 5.3.0, the standard caching support is now upgraded to version 1.0.0-PFD.</p> </li> </ul> </div> <div class="paragraph"> <p>For a complete list of features included in this release please refer to the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12322480">release notes</a>.</p> </div> <div class="paragraph"> <p>The user documentation for this release has been revamped and migrated to the <a href="http://infinispan.org/documentation/">new website</a> - we think it looks much better and hope you’ll like it too!</p> </div> <div class="paragraph"> <p>This release has spread over a period of 5 months: a sustained effort from the core development team, QE team and our growing community - a BIG thanks to everybody involved! Please visit our <a href="http://infinispan.org/download/">downloads</a> section to find the latest release. Also if you have any questions please check our <a href="http://infinispan.org/community/">forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or ping us directly on <a href="irc://irc.freenode.org/infinispan">IRC</a>.</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Adrian</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Monday, 16 September 2013 </h3> <h1> <a href="/blog/2013/09/16/new-persistence-api-in-infinispan/">New persistence API in Infinispan 6.0.0.Alpha4</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The existing CacheLoader/CacheStore API has been around since Infinispan 4.0. In this release of Infinispan we&#8217;ve taken a major step forward in both simplifying the integration with persistence and opening the door for some pretty significant performance improvements.</p> </div> </div> </div> <div class="sect1"> <h2 id="_whats_new"><a class="anchor" href="#_whats_new"></a>What&#8217;s new</h2> <div class="sectionbody"> <div class="paragraph"> <p>So here&#8217;s what the new persistence integration brings to the table:</p> </div> <div class="ulist"> <ul> <li> <p>alignment with <a href="http://jcp.org/en/jsr/detail?id=107">JSR-107</a>: now we have a <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/CacheWriter.html">CacheWriter</a> and <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/CacheLoader.html">CacheLoader</a> interface similar to the the <a href="https://github.com/jsr107/jsr107spec/blob/master/src/main/java/javax/cache/integration/CacheLoader.java">loader</a> and <a href="https://github.com/jsr107/jsr107spec/blob/master/src/main/java/javax/cache/integration/CacheWriter.java">writer</a> in JSR 107, which should considerably help writing portable stores across JCache compliant vendors</p> </li> <li> <p>simplified transaction integration: all the locking is now handled within the Infinispan layer, so implementors don&#8217;t have to be concerned coordinating concurrent access to the store (old <a href="http://docs.jboss.org/infinispan/4.1/apidocs/org/infinispan/loaders/LockSupportCacheStore.html">LockSupportCacheStore</a> is dropped for that reason).</p> </li> <li> <p>parallel iteration: it is now possible to iterate over entries in the store with multiple threads in parallel. Map/Reduce tasks immediately benefit from this, as the map/reduce  tasks now run in parallel over both the nodes in the cluster and within the same node (multiple threads)</p> </li> <li> <p><a href="https://issues.jboss.org/browse/ISPN-3512">reduced serialization</a> (translated in less CPU usage): the new API allows exposing the stored entries in serialized format. If an entry is fetched from persistent storage for the sole purpose of being sent remotely, we no longer need to deserialize it (when reading from the store) and serialize it back (when writing to the wire). Now we can write to the wire the serialized format as read fro the storage directly</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="_api"><a class="anchor" href="#_api"></a>API</h2> <div class="sectionbody"> <div class="paragraph"> <p>Now let&#8217;s take a look at the API in more detail:</p> </div> <div class="paragraph"> <p><a href="http://1.bp.blogspot.com/-aqX4MDbuzy4/Ujbq-om6YsI/AAAAAAAAMkQ/taQggrqe7Kc/s1600/new_loader_API.png"><span class="image"><img src="http://1.bp.blogspot.com/-aqX4MDbuzy4/Ujbq-om6YsI/AAAAAAAAMkQ/taQggrqe7Kc/s320/new_loader_API.png" alt="image" width="320" height="305"></span></a></p> </div> <div class="paragraph"> <p>  The diagram above shows the main classes in the API:</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/commons/io/ByteBuffer.html">ByteBuffer</a></p> <div class="ulist"> <ul> <li> <p>abstracts the serialized form on an object</p> </li> </ul> </div> </li> <li> <p><a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/MarshalledEntry.html">MarshalledEntry</a> - abstracts the information held within a persistent store corresponding to a key-value added to the cache. Provides method for reading this information both in serialized (<a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/commons/io/ByteBuffer.html">ByteBuffer</a>) and deserialized (Object) format. Normally data read from the store is kept in serialized format and lazily deserialized on demand, within the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/MarshalledEntry.html">MarshalledEntry</a> implementation</p> </li> <li> <p> <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/CacheWriter.html">CacheWriter</a> and <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/CacheLoader.html">CacheLoader</a>  provide basic methods for reading and writing to a store</p> </li> <li> <p><a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/AdvancedCacheLoader.html">AdvancedCacheLoader</a> and <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/AdvancedCacheWriter.html">AdvancedCacheWriter</a> provide operations to manipulate the underlaying storage in bulk: parallel iteration and purging of expired entries, clear and size. </p> </li> </ul> </div> <div class="paragraph"> <p>A provider might choose to only implement a subset of these interfaces:</p> </div> <div class="ulist"> <ul> <li> <p>Not implementing the  <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/AdvancedCacheWriter.html">AdvancedCacheWriter</a> makes the given writer not usable for purging expired entries or clear</p> </li> <li> <p>Not implementing  the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/persistence/spi/AdvancedCacheLoader.html">AdvancedCacheLoader</a> makes the information stored in the given loader not used for preloading, nor for the map/reduce iteration</p> </li> </ul> </div> <div class="paragraph"> <p>If you&#8217;re looking at migrating your existing store to the new API, looking at the <a href="https://github.com/infinispan/infinispan/blob/master/core/src/main/java/org/infinispan/persistence/file/SingleFileStore.java">SingleFileStore</a>  for inspiration can be of great help.</p> </div> <div class="sect3"> <h4 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h4> <div class="paragraph"> <p>And finally, the way the stores are configured has changed:</p> </div> <div class="ulist"> <ul> <li> <p>the 5.x <em>loaders</em> element is now replaced with <em>persistence</em></p> </li> <li> <p>both the loaders and writers are configured through a unique <em>store</em> element  (vs <em>loader</em> and  <em>store</em>, as allowed in 5.x)</p> </li> <li> <p>the <em>preload</em> and <em>shared</em> attributes are configured at each individual store, giving more flexibility when it comes to configuring multiple chained stores </p> </li> </ul> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Mircea</p> </div> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Thursday, 18 July 2013 </h3> <h1> <a href="/blog/2013/07/18/faster-file-cache-store-no-extra/">Faster file cache store (no extra dependencies!) in 6.0.0.Alpha1</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>As <a href="http://infinispan.blogspot.ch/2013/07/infinispan-600alpha1-is-out.html">announced yesterday by Adrian</a>, the brand new Infinispan 6.0.0.Alpha1 release contains a new file-based cache store which needs no extra dependencies. This is essentially a replacement of the existing FileCacheStore which didn&#8217;t perform as expected, and caused major issues due to the number of files it created.</p> </div> <div class="paragraph"> <p>The new cache store, contributed by a <a href="https://github.com/kblees">Karsten Blees</a> (who also contributed an improved asynchronous cache store), is called <a href="https://github.com/infinispan/infinispan/blob/master/core/src/main/java/org/infinispan/loaders/file/SingleFileCacheStore.java">SingleFileCacheStore</a> and it keeps all data in a single file. The way it looks up data is by keeping an in-memory index of keys and the positions of their values in this file. This design outperforms the existing FileCacheStore and even LevelDB based JNI cache store.</p> </div> <div class="paragraph"> <p>The classic case for a file based cache store is when you want to have a cache with a cache store available locally which stores data that has overflowed from memory, having exceeded size and/or time restrictions. We ran some performance tests to verify how fast different cache store implementations could deal with reading and writing overflowed data, and these are the results we got (in Ks):</p> </div> <div class="ulist"> <ul> <li> <p>FileCacheStore: 0.75k reads/s, 0.285k writes/s</p> </li> <li> <p>LevelDB-JNI impl: 46k reads/s, 15.2k writes/s</p> </li> <li> <p>SingleFileCacheStore: 458k reads/s, 137k writes/s</p> </li> </ul> </div> <div class="paragraph"> <p>The difference is quite astonishing but as already hinted, this performance increase comes at a cost. Having to maintain an index of keys and positions in the file in memory has a cost in terms of extra memory required, and potential impact on GC. That&#8217;s why the SingleFileCacheStore is not recommended for use cases where the keys are too big.</p> </div> <div class="paragraph"> <p>In order to help tame this memory consumption issues, the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/configuration/cache/SingleFileCacheStoreConfigurationBuilder.html#maxEntries(int)">size of the cache store can be optionally limited, providing a maximum number of entries to store in it</a>. However, setting this parameter will only work in use cases where Infinispan is used as a cache. When used as a cache, data not present in Infinispan can be recomputed or re-retrieved from the authoritative data store and stored in Infinispan cache. The reason for this limitation is because once the maximum number of entries is reached, older data in the cache store is removed, so if Infinispan was used as an authoritative data store, it would lead to data loss which is not good.</p> </div> <div class="paragraph"> <p>Existing FileCacheStore users might wonder: what is it gonna happen to the existing FileCacheStore? We&#8217;re not 100% sure yet what we&#8217;re going to do with it, but we&#8217;re looking into some ways to migrate data from the FileCacheStore to the SingleFileCacheStore. <a href="https://issues.jboss.org/browse/ISPN-3318">Some interesting ideas</a> have already been submitted which we&#8217;ll investigate in next Infinispan 6.0 pre-releases.</p> </div> <div class="paragraph"> <p>So, if you&#8217;re a FileCacheStore user, give the new SingleFileCacheStore a go and let us know how it goes! Switching from one to the other is <a href="https://github.com/infinispan/infinispan/blob/master/core/src/test/java/org/infinispan/loaders/file/SingleFileCacheStoreFunctionalTest.java#L58">easy</a> :)</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Galder</p> </div> </div> </div> </div> <hr> <div class="post"></div> <h3> Wednesday, 17 July 2013 </h3> <h1> <a href="/blog/2013/07/17/infinispan-600alpha1-is-out/">Infinispan 6.0.0.Alpha1 is out!</a> </h1> <div class="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Dear Infinispan community,</p> </div> <div class="paragraph"> <p>We&#8217;re proud to announce the first Alpha release of Infinispan 6.0.0. Starting with this release, Infinispan license is moving to the terms of the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache Software Licence version 2.0</a>.</p> </div> <div class="paragraph"> <p>Besides increased stability (about 30 bug fixes) this release also brings several new features:</p> </div> <div class="ulist"> <ul> <li> <p>A more efficient FileCacheStore implementation (courtesy Karsten Blees)</p> </li> <li> <p>A new set of usage and performance statistics developed within the scope of the CloudTM project</p> </li> <li> <p>A new (experimental) marshaller for Hot Rod based on <a href="http://code.google.com/p/protobuf/">protobuf</a>, which will be primarily used by the upcoming remote querying feature. Since this has reuse potential in other projects it was promoted to an independent project named <a href="https://github.com/infinispan/protostream"><em>protostream</em></a> under the Infinispan umbrella</p> </li> </ul> </div> <div class="paragraph"> <p>For a complete list of features and fixes included in this release please refer to the <a href="https://issues.jboss.org/secure/ReleaseNote.jspa?projectId=12310799&amp;version=12320762">release notes</a>.</p> </div> <div class="paragraph"> <p>Visit our <a href="http://www.jboss.org/infinispan/downloads">downloads</a> section to find the latest release and if you have any questions please check our <a href="http://www.jboss.org/infinispan/forums">forums</a>, our <a href="https://lists.jboss.org/mailman/listinfo/infinispan-dev">mailing lists</a> or ping us directly on <a href="http://www.blogger.com/null">IRC</a>.</p> </div> <div class="paragraph"> <p>Thanks to everyone for their involvement and contribution!</p> </div> <div class="paragraph"> <p>Cheers,</p> </div> <div class="paragraph"> <p>Adrian</p> </div> <div class="paragraph"> <p><a href="https://github.com/infinispan/protostream" class="bare">https://github.com/infinispan/protostream</a></p> </div> </div> </div> </div> <hr> <div class="pagination-links"><span class="current-page">1</span> </div> </div> <footer class="container"> <hr> <div class="row"> <div class="col-md-2 col-md-offset-1"> <h4>Navigate</h4> <ul> <li> <a href="/about" title="About">About</a> </li> <li> <a href="/documentation" title="Learn">Learn</a> </li> <li> <a href="/community" title="Community">Community</a> </li> <li> <a href="/getinvolved" title="Get Involved">Get Involved</a> </li> <li> <a href="/download" title="Download">Download</a> </li> </ul> </div> <div class="col-md-2"> <h4>Contribute</h4> <ul> <li> <a href="https://issues.jboss.org/browse/ISPN" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://github.com/infinispan" title="Write code">Write Code</a> </li> </ul> <h4>Follow Us</h4> <ul> <li> <a href="https://blog.infinispan.org" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/infinispan" title="Twitter">Twitter</a> </li> </ul> </div> <div class="col-md-2"> <h4>Open Source</h4> <p> Infinispan is released under the <b>Apache 2.0 open source license.</b> Learn more about the Apache 2.0 license <a href="https://www.apache.org/licenses/LICENSE-2.0">here.</a> </p> </div> <div class="col-md-2"> <h4>A member of</h4> <a alt="CloudTM" href="http://www.cloudtm.eu/" target="_NEW"> <img src="/images/cloudtm.png"> </a> <a alt="LEADS" href="http://leads-project.eu/" target="_NEW"> <img src="/images/leads.png"> </a> <a alt="CloudButton" href="http://cloudbutton.eu/" target="_NEW"> <img src="/images/cloudbutton.png"> </a> </div> <div class="col-md-2"> <h4>Thanks to</h4> <p>JetBrains Intellij IDEA</p> <a alt="JetBrains Intellij IDEA" href="https://www.jetbrains.com/idea/" target="_NEW"> <img src="/images/icon_IntelliJIDEA.png"> </a> </div> </div> <div class="col-md-10"> <p style="margin-top: 5px; font-size: 80%;"> © Copyright 2009-2019 Red Hat, Inc. <br> <i class="icon-fire"></i> Made with <a href="https://github.com/jbossorg/bootstrap-community" style="text-decoration: underline;" target="_NEW">JBoss Community Bootstrap</a> and <a href="http://awestruct.org/" style="text-decoration: underline;" target="_NEW">Awestruct</a> <br> <i class="icon-globe"></i> This website is open source! If you want to improve it, <a href="https://github.com/infinispan/infinispan.github.io" style="text-decoration: underline;" target="_NEW">fork the project,</a> and hack on it, then send a pull request. You can also view the <a href="https://www.seethestats.com/site/infinispan.org" style="text-decoration: underline;" target="_NEW">visitor stats.</a> <br> <i class="icon-share"></i> Website and documentation released under <a href="https://creativecommons.org/licenses/by/3.0/" style="text-decoration: underline;" target="_NEW">CC BY 3.0.</a> </p> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="//static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="//static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script>
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
        }
      </script> </div> </body> </html>