<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Configuring Infinispan 10.0</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<link rel="canonical" href="http://infinispan.org/docs/stable/user_guide/user_guide.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Configuring Infinispan 10.0</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#cache_modes">1. Infinispan Caches</a>
<ul class="sectlevel2">
<li><a href="#caches-configuring">1.1. Cache Interface</a></li>
<li><a href="#cache_managers-configuring">1.2. Cache Managers</a></li>
<li><a href="#cache_containers-configuring">1.3. Cache Containers</a></li>
<li><a href="#cache_modes-configuring">1.4. Cache Modes</a>
<ul class="sectlevel3">
<li><a href="#cache_mode_comparison-configuring">1.4.1. Cache Mode Comparison</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#local-configuring">2. Local Caches</a>
<ul class="sectlevel2">
<li><a href="#simple_cache-configuring">2.1. Simple Caches</a></li>
</ul>
</li>
<li><a href="#clustered_caches">3. Clustered Caches</a>
<ul class="sectlevel2">
<li><a href="#invalidation-configuring">3.1. Invalidation Mode</a></li>
<li><a href="#replicated-configuring">3.2. Replicated Caches</a></li>
<li><a href="#distribution-configuring">3.3. Distributed Caches</a>
<ul class="sectlevel3">
<li><a href="#read_consistency">3.3.1. Read consistency</a></li>
<li><a href="#key_ownership">3.3.2. Key Ownership</a>
<ul class="sectlevel4">
<li><a href="#capacity_factors">Capacity Factors</a></li>
</ul>
</li>
<li><a href="#zero_capacity_node">3.3.3. Zero Capacity Node</a></li>
<li><a href="#hashing_configuration">3.3.4. Hashing Configuration</a></li>
<li><a href="#initial_cluster_size">3.3.5. Initial cluster size</a></li>
<li><a href="#l1_caching">3.3.6. L1 Caching</a></li>
<li><a href="#server_hinting">3.3.7. Server Hinting</a>
<ul class="sectlevel4">
<li><a href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a href="#key_affinity_service">3.3.8. Key affinity service</a>
<ul class="sectlevel4">
<li><a href="#api">API</a></li>
<li><a href="#lifecycle">Lifecycle</a></li>
<li><a href="#topology_changes">Topology changes</a></li>
<li><a href="#grouping_api">The Grouping API</a></li>
<li><a href="#how_does_it_work">How does it work?</a></li>
<li><a href="#how_do_i_use_the_grouping_api">How do I use the grouping API?</a></li>
<li><a href="#advanced_interface">Advanced Interface</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#scattered-configuring">3.4. Scattered Caches</a></li>
<li><a href="#async_clusters">3.5. Asynchronous Communication with Clustered Caches</a>
<ul class="sectlevel3">
<li><a href="#async-configuring">3.5.1. Asynchronous Communications</a></li>
<li><a href="#async_api-configuring">3.5.2. Asynchronous API</a></li>
<li><a href="#async_return_values-configuring">3.5.3. Return Values in Asynchronous Communication</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#declarative">4. Configuring Caches Declaratively</a>
<ul class="sectlevel2">
<li><a href="#infinispan_subsystem">4.1. Infinispan subsystem</a>
<ul class="sectlevel3">
<li><a href="#containers">4.1.1. Containers</a></li>
<li><a href="#cache_declarations">4.1.2. Cache declarations</a></li>
</ul>
</li>
<li><a href="#locking">4.2. Locking</a></li>
<li><a href="#loaders_and_stores">4.3. Loaders and Stores</a></li>
<li><a href="#state_transfer">4.4. State Transfer</a></li>
<li><a href="#cache_configuration_declarative">4.5. Declarative Cache Configuration</a></li>
<li><a href="#cache_configuration_templates">4.6. Cache configuration templates</a></li>
<li><a href="#cache_configuration_wildcards">4.7. Cache configuration wildcards</a></li>
<li><a href="#cache_configuration_xinclude">4.8. XInclude support</a></li>
<li><a href="#cache_configuration_declarative_ref">4.9. Declarative configuration reference</a></li>
</ul>
</li>
<li><a href="#programmatic">5. Configuring Caches Programmatically</a>
<ul class="sectlevel2">
<li><a href="#cache_configuration_programmatic">5.1. CacheManager and ConfigurationBuilder API</a></li>
<li><a href="#cache_configuration_programmatic_api">5.2. ConfigurationBuilder Programmatic Configuration API</a>
<ul class="sectlevel3">
<li><a href="#enabling_jmx_mbeans_and_statistics">5.2.1. Enabling JMX MBeans and statistics</a></li>
<li><a href="#configuring_thread_pools">5.2.2. Configuring thread pools</a></li>
<li><a href="#configuring_transactions_and_locking">5.2.3. Configuring transactions and locking</a></li>
<li><a href="#configuring_cache_stores">5.2.4. Configuring cache stores</a></li>
<li><a href="#cache_configuration_programmatic_advanced">5.2.5. Advanced programmatic configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cluster_transport">6. Setting Up Cluster Transport</a>
<ul class="sectlevel2">
<li><a href="#jgroups_getting_started-configuring">6.1. Getting Started with Default Stacks</a>
<ul class="sectlevel3">
<li><a href="#preconfigured_jgroups_stacks-configuring">6.1.1. Default JGroups Stacks</a></li>
<li><a href="#default_jgroups_stacks-configuring">6.1.2. Default JGroups Stacks</a></li>
</ul>
</li>
<li><a href="#jgroups_inline-configuring">6.2. Using Inline JGroups Stacks</a></li>
<li><a href="#jgroups_inheritance-configuring">6.3. Adjusting and Tuning JGroups Stacks</a>
<ul class="sectlevel3">
<li><a href="#jgroups_stackcombine-configuring">6.3.1. Stack Combine Attribute</a></li>
</ul>
</li>
<li><a href="#jgroups_external-configuring">6.4. Using JGroups Stacks in External Files</a></li>
<li><a href="#jgroups_tune_system_props-configuring">6.5. Tuning JGroups Stacks with System Properties</a>
<ul class="sectlevel3">
<li><a href="#jgroups_system_props-configuring">6.5.1. System Properties for Default JGroups Stacks</a></li>
</ul>
</li>
<li><a href="#jgroups_jchannels-configuring">6.6. Using Custom JChannels</a></li>
</ul>
</li>
<li><a href="#cluster_discovery">7. Configuring Cluster Discovery</a>
<ul class="sectlevel2">
<li><a href="#tcpping">7.1. TCPPING</a></li>
<li><a href="#gossip_router">7.2. Gossip Router</a></li>
<li><a href="#dns_ping">7.3. DNS_PING</a></li>
<li><a href="#kube_ping">7.4. KUBE_PING</a></li>
<li><a href="#native_s3_ping">7.5. NATIVE_S3_PING</a></li>
<li><a href="#jdbc_ping">7.6. JDBC_PING</a></li>
<li><a href="#azure_ping">7.7. AZURE_PING</a></li>
<li><a href="#google2_ping">7.8. GOOGLE2_PING</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="cache_modes"><a class="anchor" href="#cache_modes"></a>1. Infinispan Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan caches provide flexible, in-memory data stores that you can configure to suit use cases such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>boosting application performance with high-speed local caches.</p>
</li>
<li>
<p>optimizing databases by decreasing the volume of write operations.</p>
</li>
<li>
<p>providing resiliency and durability for consistent data across clusters.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="caches-configuring"><a class="anchor" href="#caches-configuring"></a>1.1. Cache Interface</h3>
<div class="paragraph">
<p><code>Cache&lt;K,â€‹V&gt;</code> is the central interface for Infinispan and extends
<code>java.util.concurrent.ConcurrentMap</code>.</p>
</div>
<div class="paragraph">
<p>Cache entries are highly concurrent data structures in <code>key:value</code> format that
support a wide and configurable range of data types, from simple strings to
much more complex objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache_managers-configuring"><a class="anchor" href="#cache_managers-configuring"></a>1.2. Cache Managers</h3>
<div class="paragraph">
<p>Infinispan provides a <code>CacheManager</code> interface that lets you create, modify,
and manage local or clustered caches. Cache Managers are the starting point for
using Infinispan caches.</p>
</div>
<div class="paragraph">
<p>There are two <code>CacheManager</code> implementations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>EmbeddedCacheManager</code></dt>
<dd>
<p>Entry point for caches when running Infinispan inside the same Java Virtual
Machine (JVM) as the client application, which is also known as Library Mode.</p>
</dd>
<dt class="hdlist1"><code>RemoteCacheManager</code></dt>
<dd>
<p>Entry point for caches when running Infinispan as a remote server in its own
JVM. When it starts running, <code>RemoteCacheManager</code> establishes a persistent TCP connection to a Hot Rod endpoint on a Infinispan server.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Both embedded and remote <code>CacheManager</code> implementations share some methods and
properties. However, semantic differences do exist between
<code>EmbeddedCacheManager</code> and <code>RemoteCacheManager</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cache_containers-configuring"><a class="anchor" href="#cache_containers-configuring"></a>1.3. Cache Containers</h3>
<div class="paragraph">
<p>Cache containers declare one or more local or clustered caches that a Cache Manager controls.</p>
</div>
<div class="listingblock">
<div class="title">Cache container declaration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cache_modes-configuring"><a class="anchor" href="#cache_modes-configuring"></a>1.4. Cache Modes</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan Cache Managers can create and control multiple caches that use
different modes. For example, you can use the same Cache Manager for local
caches, distributes caches, and caches with invalidation mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Local Caches</dt>
<dd>
<p>Infinispan runs as a single node and never replicates read or write operations on cache entries.</p>
</dd>
<dt class="hdlist1">Clustered Caches</dt>
<dd>
<p>Infinispan instances running on the same network can automatically discover
each other and form clusters to handle cache operations.</p>
</dd>
<dt class="hdlist1">Invalidation Mode</dt>
<dd>
<p>Rather than replicating cache entries across the cluser, Infinispan evicts
stale data from all nodes whenever operations modify entries in the cache.
Infinispan performs local read operations only.</p>
</dd>
<dt class="hdlist1">Replicated Caches</dt>
<dd>
<p>Infinispan replicates each cache entry on all nodes and performs local read operations only.</p>
</dd>
<dt class="hdlist1">Distributed Caches</dt>
<dd>
<p>Infinispan stores cache entries across a subset of nodes and assigns
entries to fixed owner nodes. Infinispan requests read operations from owner
nodes to ensure it returns the correct value.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Scattered Caches</dt>
<dd>
<p>Infinispan stores cache entries across a subset of nodes. By default
Infinispan assigns a primary owner and a backup owner to each cache entry in
scattered caches. Infinispan assigns primary owners in the same way as with
distributed caches, while backup owners are always the nodes that initiate the
write operations. Infinispan requests read operations from at least one owner
node to ensure it returns the correct value.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="cache_mode_comparison-configuring"><a class="anchor" href="#cache_mode_comparison-configuring"></a>1.4.1. Cache Mode Comparison</h4>
<div class="paragraph">
<p>The cache mode that you should choose depends on the qualities and guarantees you need for your data.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the primary differences between cache modes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 13.6363%;">
<col style="width: 13.6363%;">
<col style="width: 13.6363%;">
<col style="width: 13.6363%;">
<col style="width: 13.6363%;">
<col style="width: 13.6367%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">Simple</th>
<th class="tableblock halign-center valign-top">Local</th>
<th class="tableblock halign-center valign-top">Invalidation</th>
<th class="tableblock halign-center valign-top">Replicated</th>
<th class="tableblock halign-center valign-top">Distributed</th>
<th class="tableblock halign-center valign-top">Scattered</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clustered</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">No</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">No</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Yes</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Yes</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Yes</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Yes</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read performance</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Highest</strong><br>
(local)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">High</strong><br>
(local)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">High</strong><br>
(local)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">High</strong><br>
(local)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">Medium</strong><br>
(owners)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">Medium</strong><br>
(primary)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write performance</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Highest</strong><br>
(local)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">High</strong><br>
(local)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Low</strong><br>
(all nodes, no data)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Lowest</strong><br>
(all nodes)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">Medium</strong><br>
(owner nodes)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">Higher</strong><br>
(single RPC)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capacity</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Single node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Single node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Single node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Smallest node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Cluster</strong><br>
\$(sum_(i=1)^"nodes""node_capacity")/"owners"\$</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Cluster</strong><br>
\$(sum_(i=1)^"nodes""node_capacity")/"2"\$</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Availability</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Single node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Single node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">Single node</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">All nodes</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">Owner nodes</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">Owner nodes</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">No TX, persistence, indexing</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">All</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">All</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">All</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">All</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="yellow">No TX</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="local-configuring"><a class="anchor" href="#local-configuring"></a>2. Local Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While Infinispan is particularly interesting in clustered mode, it also offers a very
capable local mode.
In this mode, it acts as a simple, in-memory data cache similar to a <code>ConcurrentHashMap</code>.</p>
</div>
<div class="paragraph">
<p>But why would one use a local cache rather than a map?
Caches offer a lot of features over and above a simple map, including write-through and
write-behind to a persistent store, eviction of entries to prevent running out of memory,
and expiration.</p>
</div>
<div class="paragraph">
<p>Infinispan&#8217;s <code>Cache</code> interface extends JDK&#8217;s <code>ConcurrentMap</code>&#8201;&#8212;&#8201;making migration from a
map to Infinispan trivial.</p>
</div>
<div class="paragraph">
<p>Infinispan caches also support transactions, either integrating with an existing
transaction manager or running a separate one.
Local caches transactions have two choices:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When to lock?
<strong>Pessimistic locking</strong> locks keys on a write operation or when the user calls
<code>AdvancedCache.lock(keys)</code> explicitly.
<strong>Optimistic locking</strong> only locks keys during the transaction commit, and instead it throws
a <code>WriteSkewCheckException</code> at commit time, if another transaction modified the same keys
after the current transaction read them.</p>
</li>
<li>
<p>Isolation level.
We support <strong>read-committed</strong> and <strong>repeatable read</strong>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="simple_cache-configuring"><a class="anchor" href="#simple_cache-configuring"></a>2.1. Simple Caches</h3>
<div class="paragraph">
<p>Traditional local caches use the same architecture as clustered caches, i.e. they use the interceptor stack.
That way a lot of the implementation can be reused. However, if the advanced features
are not needed and performance is more important, the interceptor stack can be stripped
away and simple cache can be used.</p>
</div>
<div class="paragraph">
<p>So, which features are stripped away? From the configuration perspective, simple cache does not support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>transactions and invocation batching</p>
</li>
<li>
<p>persistence (cache stores and loaders)</p>
</li>
<li>
<p>custom interceptors (there&#8217;s no interceptor stack!)</p>
</li>
<li>
<p>indexing</p>
</li>
<li>
<p>transcoding</p>
</li>
<li>
<p>store as binary (which is hardly useful for local caches)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From the API perspective these features throw an exception:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>adding custom interceptors</p>
</li>
<li>
<p>Distributed Executors Framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, what&#8217;s left?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>basic map-like API</p>
</li>
<li>
<p>cache listeners (local ones)</p>
</li>
<li>
<p>expiration</p>
</li>
<li>
<p>eviction</p>
</li>
<li>
<p>security</p>
</li>
<li>
<p>JMX access</p>
</li>
<li>
<p>statistics (though for max performance it is recommended to switch this off using statistics-available=false)</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Declarative configuration</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySimpleCache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">simple-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- expiration, eviction, security... --&gt;</span>
<span class="tag">&lt;/local-cache&gt;</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Programmatic configuration</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CacheManager cm = getCacheManager();
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder().simpleCache(<span class="predefined-constant">true</span>);
cm.defineConfiguration(<span class="string"><span class="delimiter">&quot;</span><span class="content">mySimpleCache</span><span class="delimiter">&quot;</span></span>, builder.build());
Cache cache = cm.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">mySimpleCache</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simple cache checks against features it does not support, if you configure it
to use e.g. transactions, configuration validation will throw an exception.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clustered_caches"><a class="anchor" href="#clustered_caches"></a>3. Clustered Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clustered caches store data across multiple Infinispan nodes using JGroups
technology as the transport layer to pass data across the network.</p>
</div>
<div class="sect2">
<h3 id="invalidation-configuring"><a class="anchor" href="#invalidation-configuring"></a>3.1. Invalidation Mode</h3>
<div class="paragraph">
<p>You can use Infinispan in invalidation mode to optimize systems that perform
high volumes of read operations. A good example is to use invalidation to
prevent lots of database writes when state changes occur.</p>
</div>
<div class="paragraph">
<p>This cache mode only makes sense if you have another, permanent store for your data such
as a database and are only using Infinispan as an optimization in a read-heavy system,
to prevent hitting the database for every read.
If a cache is configured for invalidation, every time data is changed in a cache, other
caches in the cluster receive a message informing them that their data is now stale and
should be removed from memory and from any local store.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./../../topics/images/clustering-invalidation.svg" alt="clustering invalidation">
</div>
<div class="title">Figure 1. Invalidation mode</div>
</div>
<div class="paragraph">
<p>Sometimes the application reads a value from the external store and wants to write it to
the local cache, without removing it from the other nodes.
To do this, it must call <code>Cache.putForExternalRead(key, value)</code> instead of
<code>Cache.put(key, value)</code>.</p>
</div>
<div class="paragraph">
<p>Invalidation mode can be used with a shared cache store.
A write operation will both update the shared store, and it would remove the stale values
from the other nodes' memory.
The benefit of this is twofold: network traffic is minimized as invalidation messages are
very small compared to replicating the entire value, and also other caches in the cluster
look up modified data in a lazy manner, only when needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Never use invalidation mode with a <strong>local</strong> store.
The invalidation message will not remove entries in the local store, and some
nodes will keep seeing the stale value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An invalidation cache can also be configured with a special cache loader, <code>ClusterLoader</code>.
When <code>ClusterLoader</code> is enabled, read operations that do not find the key on the local
node will request it from all the other nodes first, and store it in memory locally.
In certain situation it will store stale values, so only use it if you have a high
tolerance for stale values.</p>
</div>
<div class="paragraph">
<p>Invalidation mode can be synchronous or asynchronous.
When synchronous, a write blocks until all nodes in the cluster have evicted the stale
value. When asynchronous, the originator broadcasts invalidation messages but doesn&#8217;t
wait for responses.
That means other nodes still see the stale value for a while after the write completed on
the originator.</p>
</div>
<div class="paragraph">
<p>Transactions can be used to batch the invalidation messages.
Transactions acquire the key lock on the primary owner.
To find more about how primary owners are assigned, please read the
<a href="#key_ownership">Key Ownership</a> section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With pessimistic locking, each write triggers a lock message, which is
broadcast to all the nodes.
During transaction commit, the originator broadcasts a one-phase prepare message
(optionally fire-and-forget) which invalidates all affected keys and releases the locks.</p>
</li>
<li>
<p>With optimistic locking, the originator broadcasts a prepare message, a commit message,
and an unlock message (optional).
Either the one-phase prepare or the unlock message is fire-and-forget,
and the last message always releases the locks.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="replicated-configuring"><a class="anchor" href="#replicated-configuring"></a>3.2. Replicated Caches</h3>
<div class="paragraph">
<p>Entries written to a replicated cache on any node will be replicated to all other nodes
in the cluster, and can be retrieved locally from any node.
Replicated mode provides a quick and easy way to share state across a cluster,
however replication practically only performs well in small clusters (under 10 nodes),
due to the number of messages needed for a write scaling linearly with the cluster size.
Infinispan can be configured to use UDP multicast, which mitigates this problem to some
degree.</p>
</div>
<div class="paragraph">
<p>Each key has a primary owner, which serializes data container updates in order to
provide consistency.
To find more about how primary owners are assigned, please read the
<a href="#key_ownership">Key Ownership</a> section.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./../../topics/images/clustering-replicated.svg" alt="clustering replicated">
</div>
<div class="title">Figure 2. Replicated mode</div>
</div>
<div class="paragraph">
<p>Replicated mode can be synchronous or asynchronous.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronous replication blocks the caller (e.g. on a <code>cache.put(key, value)</code>) until
the modifications have been replicated successfully to all the nodes in the cluster.</p>
</li>
<li>
<p>Asynchronous replication performs replication in the background, and write operations
return immediately.
Asynchronous replication is not recommended, because communication errors, or errors
that happen on remote nodes are not reported to the caller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If transactions are enabled, write operations are not replicated through the primary
owner.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With pessimistic locking, each write triggers a lock message, which is
broadcast to all the nodes.
During transaction commit, the originator broadcasts a one-phase prepare message and an
unlock message (optional).
Either the one-phase prepare or the unlock message is fire-and-forget.</p>
</li>
<li>
<p>With optimistic locking, the originator broadcasts a prepare message, a commit message,
and an unlock message (optional).
Again, either the one-phase prepare or the unlock message is fire-and-forget.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="distribution-configuring"><a class="anchor" href="#distribution-configuring"></a>3.3. Distributed Caches</h3>
<div class="paragraph">
<p>Distribution tries to keep a fixed number of copies of any entry in the cache,
configured as <code>numOwners</code>.
This allows the cache to scale linearly, storing more data as nodes are added to the
cluster.</p>
</div>
<div class="paragraph">
<p>As nodes join and leave the cluster, there will be times when a key has more or less than
<code>numOwners</code> copies.
In particular, if <code>numOwners</code> nodes leave in quick succession, some entries will be lost,
so we say that a distributed cache tolerates <code>numOwners - 1</code> node failures.</p>
</div>
<div class="paragraph">
<p>The number of copies represents a trade-off between performance and durability of data.
The more copies you maintain, the lower performance will be, but also the lower the risk
of losing data due to server or network failures.
Regardless of how many copies are maintained, distribution still scales linearly, and
this is key to Infinispan&#8217;s scalability.</p>
</div>
<div class="paragraph">
<p>The owners of a key are split into one <strong>primary owner</strong>, which coordinates writes to the
key, and zero or more <strong>backup owners</strong>.
To find more about how primary and backup owners are assigned, please read the
<a href="#key_ownership">Key Ownership</a> section.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./../../topics/images/clustering-distributed.svg" alt="clustering distributed">
</div>
<div class="title">Figure 3. Distributed mode</div>
</div>
<div class="paragraph">
<p>A read operation will request the value from the primary owner, but if it doesn&#8217;t respond
in a reasonable amount of time, we request the value from the backup owners as well.
(The <code>infinispan.stagger.delay</code> system property, in milliseconds, controls the delay
between requests.)
A read operation may require <code>0</code> messages if the key is present in the local cache,
or up to <code>2 * numOwners</code> messages if all the owners are slow.</p>
</div>
<div class="paragraph">
<p>A write operation will also result in at most <code>2 * numOwners</code> messages: one message from
the originator to the primary owner, <code>numOwners - 1</code> messages from the primary to the
backups, and the corresponding ACK messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Cache topology changes may cause retries and additional messages, both for reads
and for writes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just as replicated mode, distributed mode can also be synchronous or asynchronous.
And as in replicated mode, asynchronous replication is not recommended because it can
lose updates.
In addition to losing updates, asynchronous distributed caches can also see a stale value
when a thread writes to a key and then immediately reads the same key.</p>
</div>
<div class="paragraph">
<p>Transactional distributed caches use the same kinds of messages as transactional
replicated caches, except lock/prepare/commit/unlock messages are sent only to the
<strong>affected nodes</strong> (all the nodes that own at least one key affected by the transaction)
instead of being broadcast to all the nodes in the cluster.
As an optimization, if the transaction writes to a single key and the originator is the
primary owner of the key, lock messages are not replicated.</p>
</div>
<div class="sect3">
<h4 id="read_consistency"><a class="anchor" href="#read_consistency"></a>3.3.1. Read consistency</h4>
<div class="paragraph">
<p>Even with synchronous replication, distributed caches are not linearizable.
(For transactional caches, we say they do not support serialization/snapshot isolation.)
We can have one thread doing a single put:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cache.get(k) -&gt; v1
cache.put(k, v2)
cache.get(k) -&gt; v2</code></pre>
</div>
</div>
<div class="paragraph">
<p>But another thread might see the values in a different order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cache.get(k) -&gt; v2
cache.get(k) -&gt; v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that read can return the value from <strong>any</strong> owner, depending on how fast
the primary owner replies.
The write is not atomic across all the owners&#8201;&#8212;&#8201;in fact, the primary commits the update
only after it receives a confirmation from the backup.
While the primary is waiting for the confirmation message from the backup, reads from the
backup will see the new value, but reads from the primary will see the old one.</p>
</div>
</div>
<div class="sect3">
<h4 id="key_ownership"><a class="anchor" href="#key_ownership"></a>3.3.2. Key Ownership</h4>
<div class="paragraph">
<p>Distributed caches split entries into a fixed number of segments and assign
each segment to a list of owner nodes. Replicated caches do the same, with the
exception that every node is an owner.</p>
</div>
<div class="paragraph">
<p>The first node in the list of owners is the <strong>primary owner</strong>. The other nodes in
the list are <strong>backup owners</strong>. When the cache topology changes, because a node
joins or leaves the cluster, the segment ownership table is broadcast to every
node. This allows nodes to locate keys without making multicast requests or
maintaining metadata for each key.</p>
</div>
<div class="paragraph">
<p>The <code>numSegments</code> property configures the number of segments available.
However, the number of segments cannot change unless the cluster is restarted.</p>
</div>
<div class="paragraph">
<p>Likewise the key-to-segment mapping cannot change. Keys must always map to the
same segments regardless of cluster topology changes. It is important that the
key-to-segment mapping evenly distributes the number of segments allocated to each node while minimizing the number of segments that must move when the cluster topology changes.</p>
</div>
<div class="paragraph">
<p>You can customize the key-to-segment mapping by configuring a
<a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/distribution/ch/KeyPartitioner.html">KeyPartitioner</a> or by using the
<a href="#grouping_api">Grouping API</a>.</p>
</div>
<div class="paragraph">
<p>However, Infinispan provides the following implementations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SyncConsistentHashFactory</dt>
<dd>
<p>Uses an algorithm based on
<a href="http://en.wikipedia.org/wiki/Consistent_hashing">consistent hashing</a>. Selected by default when server hinting is disabled.</p>
<div class="paragraph">
<p>This implementation always assigns keys to the same nodes in every cache as
long as the cluster is symmetric. In other words, all caches run on all nodes.
This implementation does have some negative points in that the load distribution is slightly uneven. It also moves more segments than strictly necessary on a join or leave.</p>
</div>
</dd>
<dt class="hdlist1">TopologyAwareSyncConsistentHashFactory</dt>
<dd>
<p>Similar to <code>SyncConsistentHashFactory</code>, but adapted for
<a href="#server_hinting">Server Hinting</a>. Selected by default when server hinting is enabled.</p>
</dd>
<dt class="hdlist1">DefaultConsistentHashFactory</dt>
<dd>
<p>Achieves a more even distribution than <code>SyncConsistentHashFactory</code>, but with one
disadvantage. The order in which nodes join the cluster determines which nodes
own which segments. As a result, keys might be assigned to different nodes in
different caches.</p>
<div class="paragraph">
<p>Was the default from version 5.2 to version 8.1 with server hinting disabled.</p>
</div>
</dd>
<dt class="hdlist1">TopologyAwareConsistentHashFactory</dt>
<dd>
<p>Similar to <em>DefaultConsistentHashFactory</em>, but adapted for
<a href="#server_hinting">Server Hinting</a>.</p>
<div class="paragraph">
<p>Was the default from version 5.2 to version 8.1 with server hinting enabled.</p>
</div>
</dd>
<dt class="hdlist1">ReplicatedConsistentHashFactory</dt>
<dd>
<p>Used internally to implement replicated caches. You should never explicitly
select this algorithm in a distributed cache.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="capacity_factors"><a class="anchor" href="#capacity_factors"></a>Capacity Factors</h5>
<div class="paragraph">
<p>Capacity factors are another way to customize the mapping of segments to nodes.
The nodes in a cluster are not always identical.
If a node has 2x the memory of a "regular" node, configuring it with a <code>capacityFactor</code>
of <code>2</code> tells Infinispan to allocate 2x segments to that node.
The capacity factor can be any non-negative number, and the hashing algorithm will try to
assign to each node a load weighted by its capacity factor (both as a primary owner and as
a backup owner).</p>
</div>
<div class="paragraph">
<p>One interesting use case is nodes with a capacity factor of <code>0</code>.
This could be useful when some nodes are too short-lived to be useful as data owners, but
they can&#8217;t use HotRod (or other remote protocols) because they need transactions.
With cross-site replication as well, the "site master" should only deal with forwarding
commands between sites and shouldn&#8217;t handle user requests, so it makes sense to configure
it with a capacity factor of <code>0</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="zero_capacity_node"><a class="anchor" href="#zero_capacity_node"></a>3.3.3. Zero Capacity Node</h4>
<div class="paragraph">
<p>You might need to configure a whole node where the capacity factor is <code>0</code> for every cache,
user defined caches and internal caches.
When defining a zero capacity node, the node won&#8217;t hold any data.
This is how you declare a zero capacity node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">zero-capacity-node</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">new</span> GlobalConfigurationBuilder().zeroCapacityNode(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, note that this will be true for distributed caches only. If you are using replicated
caches, the node will still keep a copy of the value. Use only distributed caches to make the
best use of this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="hashing_configuration"><a class="anchor" href="#hashing_configuration"></a>3.3.4. Hashing Configuration</h4>
<div class="paragraph">
<p>This is how you configure hashing declaratively, via XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">distributedCache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">owners</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">segments</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">capacity-factor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is how you can configure it programmatically, in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder()
   .clustering()
      .cacheMode(CacheMode.DIST_SYNC)
      .hash()
         .numOwners(<span class="integer">2</span>)
         .numSegments(<span class="integer">100</span>)
         .capacityFactor(<span class="integer">2</span>)
   .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="initial_cluster_size"><a class="anchor" href="#initial_cluster_size"></a>3.3.5. Initial cluster size</h4>
<div class="paragraph">
<p>Infinispan&#8217;s very dynamic nature in handling topology changes (i.e. nodes being added / removed
at runtime) means that, normally, a node doesn&#8217;t wait for the presence of other nodes before
starting. While this is very flexible, it might not be suitable for applications which require
a specific number of nodes to join the cluster before caches are started. For this reason,
you can specify how many nodes should have joined the cluster before proceeding with cache
initialization. To do this, use the <code>initialClusterSize</code> and <code>initialClusterTimeout</code> transport
properties. The declarative XML configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;transport</span> <span class="attribute-name">initial-cluster-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial-cluster-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The programmatic Java configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration global = <span class="keyword">new</span> GlobalConfigurationBuilder()
   .transport()
       .initialClusterSize(<span class="integer">4</span>)
       .initialClusterTimeout(<span class="integer">30000</span>)
   .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will wait for <em>4</em> nodes to join the cluster before initialization. If
the initial nodes do not appear within the specified timeout, the cache manager will fail to
start.</p>
</div>
</div>
<div class="sect3">
<h4 id="l1_caching"><a class="anchor" href="#l1_caching"></a>3.3.6. L1 Caching</h4>
<div class="paragraph">
<p>When L1 is enabled, a node will keep the result of remote reads locally for a short
period of time (configurable, 10 minutes by default), and repeated lookups will return
the local L1 value instead of asking the owners again.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./../../topics/images/clustering-l1.svg" alt="clustering l1">
</div>
<div class="title">Figure 4. L1 caching</div>
</div>
<div class="paragraph">
<p>L1 caching is not free though.
Enabling it comes at a cost, and this cost is that every entry update must broadcast an
invalidation message to all the nodes.
L1 entries can be evicted just like any other entry when the the cache is configured
with a maximum size.
Enabling L1 will improve performance for repeated reads of non-local keys, but it will
slow down writes and it will increase memory consumption to some degree.</p>
</div>
<div class="paragraph">
<p>Is L1 caching right for you?
The correct approach is to benchmark your application with and without L1 enabled and see
what works best for your access pattern.</p>
</div>
</div>
<div class="sect3">
<h4 id="server_hinting"><a class="anchor" href="#server_hinting"></a>3.3.7. Server Hinting</h4>
<div class="paragraph">
<p>The following topology hints can be specified:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Machine</dt>
<dd>
<p>This is probably the most useful, when multiple JVM instances run on the
same node, or even when multiple virtual machines run on the same physical machine.</p>
</dd>
<dt class="hdlist1">Rack</dt>
<dd>
<p>In larger clusters, nodes located on the same rack are more likely to experience a
hardware or network failure at the same time.</p>
</dd>
<dt class="hdlist1">Site</dt>
<dd>
<p>Some clusters may have nodes in multiple physical locations for extra resilience.
Note that Cross site replication is another alternative for
clusters that need to span two or more data centres.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All of the above are optional.
When provided, the distribution algorithm will try to spread the ownership of each
segment across as many sites, racks, and machines (in this order) as possible.</p>
</div>
<div class="sect4">
<h5 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h5>
<div class="paragraph">
<p>The hints are configured at transport level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;transport</span>
    <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyCluster</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">machine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LinuxServer01</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">rack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Rack01</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">US-WestCoast</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="key_affinity_service"><a class="anchor" href="#key_affinity_service"></a>3.3.8. Key affinity service</h4>
<div class="paragraph">
<p>In a distributed cache, a key is allocated to a list of nodes with an opaque algorithm.
There is no easy way to reverse the computation and generate a key that maps to a
particular node.
However, we can generate a sequence of (pseudo-)random keys, see what their primary
owner is, and hand them out to the application when it needs a key mapping to a
particular node.</p>
</div>
<div class="sect4">
<h5 id="api"><a class="anchor" href="#api"></a>API</h5>
<div class="paragraph">
<p>Following code snippet depicts how a reference to this service can be obtained and used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 1. Obtain a reference to a cache</span>
Cache cache = ...
Address address = cache.getCacheManager().getAddress();

<span class="comment">// 2. Create the affinity service</span>
KeyAffinityService keyAffinityService = KeyAffinityServiceFactory.newLocalKeyAffinityService(
      cache,
      <span class="keyword">new</span> RndKeyGenerator(),
      <span class="predefined-type">Executors</span>.newSingleThreadExecutor(),
      <span class="integer">100</span>);

<span class="comment">// 3. Obtain a key for which the local node is the primary owner</span>
<span class="predefined-type">Object</span> localKey = keyAffinityService.getKeyForAddress(address);

<span class="comment">// 4. Insert the key in the cache</span>
cache.put(localKey, <span class="string"><span class="delimiter">&quot;</span><span class="content">yourValue</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service is started at step 2: after this point it uses the supplied <em>Executor</em> to
generate and queue keys.
At step 3, we obtain a key from the service, and at step 4 we use it.</p>
</div>
</div>
<div class="sect4">
<h5 id="lifecycle"><a class="anchor" href="#lifecycle"></a>Lifecycle</h5>
<div class="paragraph">
<p><code>KeyAffinityService</code> extends <code>Lifecycle</code>, which allows stopping and (re)starting it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Lifecycle</span> {
<span class="error">Â </span><span class="error">Â </span> <span class="type">void</span> start();
<span class="error">Â </span><span class="error">Â </span> <span class="type">void</span> stop();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service is instantiated through <code>KeyAffinityServiceFactory</code>. All the factory methods
have an <code>Executor</code> parameter, that is used for asynchronous key generation (so that it
won&#8217;t happen in the caller&#8217;s thread).
It is the user&#8217;s responsibility to handle the shutdown of this <code>Executor</code>.</p>
</div>
<div class="paragraph">
<p>The <code>KeyAffinityService</code>, once started, needs to be explicitly stopped. This stops the
background key generation and releases other held resources.</p>
</div>
<div class="paragraph">
<p>The only situation in which <code>KeyAffinityService</code> stops by itself is when the cache manager
with which it was registered is shutdown.</p>
</div>
</div>
<div class="sect4">
<h5 id="topology_changes"><a class="anchor" href="#topology_changes"></a>Topology changes</h5>
<div class="paragraph">
<p>When the cache topology changes (i.e. nodes join or leave the cluster), the ownership of
the keys generated by the <code>KeyAffinityService</code> might change.
The key affinity service keep tracks of these topology changes and doesn&#8217;t return keys
that would currently map to a different node, but it won&#8217;t do anything about keys
generated earlier.</p>
</div>
<div class="paragraph">
<p>As such, applications should treat <code>KeyAffinityService</code> purely as an optimization, and
they should not rely on the location of a generated key for correctness.</p>
</div>
<div class="paragraph">
<p>In particular, applications should not rely on keys generated by <code>KeyAffinityService</code>
for the same address to always be located together.
Collocation of keys is only provided by the <a href="#grouping_api">Grouping API</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="grouping_api"><a class="anchor" href="#grouping_api"></a>The Grouping API</h5>
<div class="paragraph">
<p>Complementary to <a href="#key_affinity_service">Key affinity service</a>,
the grouping API allows you to co-locate a group of entries on the same nodes, but without
being able to select the actual nodes.</p>
</div>
</div>
<div class="sect4">
<h5 id="how_does_it_work"><a class="anchor" href="#how_does_it_work"></a>How does it work?</h5>
<div class="paragraph">
<p>By default, the segment of a key is computed using the key&#8217;s <code>hashCode()</code>.
If you use the grouping API, Infinispan will compute the segment of the group and use
that as the segment of the key.
See the <a href="#key_ownership">Key Ownership</a> section for more details on how segments are
then mapped to nodes.</p>
</div>
<div class="paragraph">
<p>When the group API is in use, it is important that every node can still compute the
owners of every key without contacting other nodes.
For this reason, the group cannot be specified manually.
The group can either be intrinsic to the entry (generated by the key class) or extrinsic
(generated by an external function).</p>
</div>
</div>
<div class="sect4">
<h5 id="how_do_i_use_the_grouping_api"><a class="anchor" href="#how_do_i_use_the_grouping_api"></a>How do I use the grouping API?</h5>
<div class="paragraph">
<p>First, you must enable groups. If you are configuring Infinispan programmatically, then call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder()
   .clustering().hash().groups().enabled()
   .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, if you are using XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
Â  Â <span class="tag">&lt;groups</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have control of the key class (you can alter the class definition, it&#8217;s not part of
an unmodifiable library), then we recommend using an intrinsic group.
The intrinsic group is specified by adding the <code>@Group</code> annotation to a method.
Let&#8217;s take a look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">User</span> {
   ...
   String office;
   ...

   public <span class="type">int</span> hashCode() {
      <span class="comment">// Defines the hash for the key, normally used to determine location</span>
      ...
   }

   <span class="comment">// Override the location by specifying a group</span>
   <span class="comment">// All keys in the same group end up with the same owners</span>
   <span class="annotation">@Group</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> getOffice() {
      <span class="keyword">return</span> office;
   }
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The group method must return a <code>String</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t have control over the key class, or the determination of the group is an
orthogonal concern to the key class, we recommend using an extrinsic group.
An extrinsic group is specified by implementing the <code>Grouper</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Grouper</span>&lt;T&gt; {
    <span class="predefined-type">String</span> computeGroup(T key, <span class="predefined-type">String</span> group);

    <span class="predefined-type">Class</span>&lt;T&gt; getKeyType();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If multiple <code>Grouper</code> classes are configured for the same key type, all of them will be
called, receiving the value computed by the previous one.
If the key class also has a <code>@Group</code> annotation, the first <code>Grouper</code> will receive the
group computed by the annotated method.
This allows you even greater control over the group when using an intrinsic group.
Let&#8217;s take a look at an example <code>Grouper</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">KXGrouper</span> <span class="directive">implements</span> Grouper&lt;<span class="predefined-type">String</span>&gt; {

   <span class="comment">// The pattern requires a String key, of length 2, where the first character is</span>
   <span class="comment">// &quot;k&quot; and the second character is a digit. We take that digit, and perform</span>
   <span class="comment">// modular arithmetic on it to assign it to group &quot;0&quot; or group &quot;1&quot;.</span>
   <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Pattern</span> kPattern = <span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">(^k)(&lt;a&gt;</span><span class="char">\\</span><span class="content">d&lt;/a&gt;)$</span><span class="delimiter">&quot;</span></span>);

   <span class="directive">public</span> <span class="predefined-type">String</span> computeGroup(<span class="predefined-type">String</span> key, <span class="predefined-type">String</span> group) {
      <span class="predefined-type">Matcher</span> matcher = kPattern.matcher(key);
      <span class="keyword">if</span> (matcher.matches()) {
         <span class="predefined-type">String</span> g = <span class="predefined-type">Integer</span>.parseInt(matcher.group(<span class="integer">2</span>)) % <span class="integer">2</span> + <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
         <span class="keyword">return</span> g;
      } <span class="keyword">else</span> {
         <span class="keyword">return</span> <span class="predefined-constant">null</span>;
      }
   }

   <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">String</span>&gt; getKeyType() {
      <span class="keyword">return</span> <span class="predefined-type">String</span>.class;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Grouper</code> implementations must be registered explicitly in the cache configuration.
If you are configuring Infinispan programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder()
   .clustering().hash().groups().enabled().addGrouper(<span class="keyword">new</span> KXGrouper())
   .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, if you are using XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;groups</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;grouper</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.KXGrouper</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/groups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="advanced_interface"><a class="anchor" href="#advanced_interface"></a>Advanced Interface</h5>
<div class="paragraph">
<p><code>AdvancedCache</code> has two group-specific methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/AdvancedCache.html#getGroup-java.lang.String-">getGroup(groupName)</a></dt>
<dd>
<p>Retrieves all keys in the cache that belong to a group.</p>
</dd>
<dt class="hdlist1"><a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/AdvancedCache.html#removeGroup-java.lang.String-">removeGroup(groupName)</a></dt>
<dd>
<p>Removes all the keys in the cache that belong to a group.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Both methods iterate over the entire data container and store (if present), so they can
be slow when a cache contains lots of small groups.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scattered-configuring"><a class="anchor" href="#scattered-configuring"></a>3.4. Scattered Caches</h3>
<div class="paragraph">
<p>Scattered mode is very similar to Distribution Mode as it allows linear scaling of the cluster.
It allows single node failure by maintaining two copies of the data (as Distribution Mode with numOwners=2).
Unlike Distributed, the location of data is not fixed; while we use the same Consistent Hash algorithm
to locate the primary owner, the backup copy is stored on the node that wrote the data last time.
When the write originates on the primary owner, backup copy is stored on any other node (the exact location
of this copy is not important).</p>
</div>
<div class="paragraph">
<p>This has the advantage of single Remote Procedure Call (RPC) for any write (Distribution Mode requires one or two RPCs), but reads
have to always target the primary owner. That results in faster writes but possibly slower reads, and therefore this
mode is more suitable for write-intensive applications.</p>
</div>
<div class="paragraph">
<p>Storing multiple backup copies also results in slightly higher memory consumption. In order to remove out-of-date
backup copies, invalidation messages are broadcast in the cluster, which generates some overhead. This makes
scattered mode less performant in very big clusters (this behaviour might be optimized in the future).</p>
</div>
<div class="paragraph">
<p>When a node crashes, the primary copy may be lost. Therefore, the cluster has to reconcile the backups
and find out the last written backup copy. This process results in more network traffic during state transfer.</p>
</div>
<div class="paragraph">
<p>Since the writer of data is also a backup, even if we specify machine/rack/site ids on the transport level the cluster
cannot be resilient to more than one failure on the same machine/rack/site.</p>
</div>
<div class="paragraph">
<p>Currently it is not possible to use scattered mode in transactional cache. Asynchronous replication
is not supported either; use asynchronous Cache API instead. Functional commands are not implemented neither
but these are expected to be added soon.</p>
</div>
<div class="paragraph">
<p>The cache is configured in a similar way as the other cache modes, here is an example of declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;scattered-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scatteredCache</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is how you can configure it programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder()
   .clustering().cacheMode(CacheMode.SCATTERED_SYNC)
   .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Scattered mode is not exposed in the server configuration as the server is usually accessed through the Hot Rod
protocol. The protocol automatically selects primary owner for the writes and therefore the write (in distributed
mode with two owner) requires single RPC inside the cluster, too. Therefore, scattered cache would not bring
the performance benefit.</p>
</div>
</div>
<div class="sect2">
<h3 id="async_clusters"><a class="anchor" href="#async_clusters"></a>3.5. Asynchronous Communication with Clustered Caches</h3>
<div class="sect3">
<h4 id="async-configuring"><a class="anchor" href="#async-configuring"></a>3.5.1. Asynchronous Communications</h4>
<div class="paragraph">
<p>All clustered cache modes can be configured to use asynchronous communications with the
<a href="https://docs.jboss.org/infinispan/10.0/configdocs/"><code>mode="ASYNC"</code></a>
attribute on the <code>&lt;replicated-cache/&gt;</code>, <code>&lt;distributed-cache&gt;</code>, or <code>&lt;invalidation-cache/&gt;</code>
element.</p>
</div>
<div class="paragraph">
<p>With asynchronous communications, the originator node does not receive any
acknowledgement from the other nodes about the status of the operation, so there is no
way to check if it succeeded on other nodes.</p>
</div>
<div class="paragraph">
<p>We do not recommend asynchronous communications in general, as they can cause
inconsistencies in the data, and the results are hard to reason about.
Nevertheless, sometimes speed is more important than consistency, and the option is
available for those cases.</p>
</div>
</div>
<div class="sect3">
<h4 id="async_api-configuring"><a class="anchor" href="#async_api-configuring"></a>3.5.2. Asynchronous API</h4>
<div class="paragraph">
<p>The Asynchronous API allows you to use synchronous communications,
but without blocking the user thread.</p>
</div>
<div class="paragraph">
<p>There is one caveat:
The asynchronous operations do NOT preserve the program order.
If a thread calls <code>cache.putAsync(k, v1); cache.putAsync(k, v2)</code>, the final value of <code>k</code>
may be either <code>v1</code> or <code>v2</code>.
The advantage over using asynchronous communications is that the final value can&#8217;t be
<code>v1</code> on one node and <code>v2</code> on another.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Prior to version 9.0, the asynchronous API was emulated by borrowing a thread from
an internal thread pool and running a blocking operation on that thread.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="async_return_values-configuring"><a class="anchor" href="#async_return_values-configuring"></a>3.5.3. Return Values in Asynchronous Communication</h4>
<div class="paragraph">
<p>Because the <code>Cache</code> interface extends <code>java.util.Map</code>, write methods like
<code>put(key, value)</code> and <code>remove(key)</code> return the previous value by default.</p>
</div>
<div class="paragraph">
<p>In some cases, the return value may not be correct:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When using <code>AdvancedCache.withFlags()</code> with <code>Flag.IGNORE_RETURN_VALUE</code>,
<code>Flag.SKIP_REMOTE_LOOKUP</code>, or <code>Flag.SKIP_CACHE_LOAD</code>.</p>
</li>
<li>
<p>When the cache is configured with <code>unreliable-return-values="true"</code>.</p>
</li>
<li>
<p>When using asynchronous communications.</p>
</li>
<li>
<p>When there are multiple concurrent writes to the same key, and the cache topology
changes.
The topology change will make Infinispan retry the write operations, and a retried
operation&#8217;s return value is not reliable.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Transactional caches return the correct previous value in cases 3 and 4.
However, transactional caches also have a gotcha: in distributed mode, the
read-committed isolation level is implemented as repeatable-read.
That means this example of "double-checked locking" won&#8217;t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cache cache = ...
TransactionManager tm = ...

tm.begin();
<span class="keyword">try</span> {
   <span class="predefined-type">Integer</span> v1 = cache.get(k);
   <span class="comment">// Increment the value</span>
   <span class="predefined-type">Integer</span> v2 = cache.put(k, v1 + <span class="integer">1</span>);
   <span class="keyword">if</span> (Objects.equals(v1, v2) {
      <span class="comment">// success</span>
   } <span class="keyword">else</span> {
      <span class="comment">// retry</span>
   }
} <span class="keyword">finally</span> {
  tm.commit();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The correct way to implement this is to use
<code>cache.getAdvancedCache().withFlags(Flag.FORCE_WRITE_LOCK).get(k)</code>.</p>
</div>
<div class="paragraph">
<p>In caches with optimistic locking, writes can also return stale previous values. Write skew checks can avoid stale previous values.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declarative"><a class="anchor" href="#declarative"></a>4. Configuring Caches Declaratively</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan declarative configuration.</p>
</div>
<div class="sect2">
<h3 id="infinispan_subsystem"><a class="anchor" href="#infinispan_subsystem"></a>4.1. Infinispan subsystem</h3>
<div class="paragraph">
<p>The Infinispan subsystem configures the cache containers and caches.</p>
</div>
<div class="paragraph">
<p>The subsystem declaration is enclosed in the following XML element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:9.4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="containers"><a class="anchor" href="#containers"></a>4.1.1. Containers</h4>
<div class="paragraph">
<p>The Infinispan subsystem can declare multiple containers. A container is declared as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan does not provide an implicit default cache, but lets you name a cache as the default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to declare clustered caches (distributed, replicated, invalidation), you also need to specify the <code>&lt;transport/&gt;</code> element which references an existing JGroups transport. This is not needed if you only intend to have local caches only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;transport</span> <span class="attribute-name">executor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-transport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-cluster-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cache_declarations"><a class="anchor" href="#cache_declarations"></a>4.1.2. Cache declarations</h4>
<div class="paragraph">
<p>Now you can declare your caches. Please be aware that only the caches declared in the configuration will be available to the endpoints and that attempting to access an undefined cache is an illegal operation. Contrast this with the default Infinispan library behaviour where obtaining an undefined cache will implicitly create one using the default settings. The following are example declarations for all four available types of caches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/local-cache&gt;</span>

<span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/replicated-cache&gt;</span>

<span class="tag">&lt;invalidation-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/invalidation-cache&gt;</span>

<span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">distcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">segments</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">owners</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking"><a class="anchor" href="#locking"></a>4.2. Locking</h3>
<div class="paragraph">
<p>To define the locking configuration for a cache, add the <code>&lt;locking/&gt;</code> element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;locking</span> <span class="attribute-name">isolation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPEATABLE_READ</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acquire-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">concurrency-level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">striping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible attributes for the locking element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>isolation</em> sets the cache locking isolation level. Can be NONE, READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE. Defaults to REPEATABLE_READ</p>
</li>
<li>
<p><em>striping</em> if true, a pool of shared locks is maintained for all entries that need to be locked. Otherwise, a lock is created per entry in the cache. Lock striping helps control memory footprint but may reduce concurrency in the system.</p>
</li>
<li>
<p><em>acquire-timeout</em> maximum time to attempt a particular lock acquisition.</p>
</li>
<li>
<p><em>concurrency-level</em> concurrency level for lock containers. Adjust this value according to the number of concurrent threads interacting with Infinispan.</p>
</li>
<li>
<p><em>concurrent-updates</em> for non-transactional caches only: if set to true(default value) the cache keeps data consistent in the case of concurrent updates. For clustered caches this comes at the cost of an additional RPC, so if you don&#8217;t expect your application to write data concurrently, disabling this flag increases performance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="loaders_and_stores"><a class="anchor" href="#loaders_and_stores"></a>4.3. Loaders and Stores</h3>
<div class="paragraph">
<p>Loaders and stores can be defined in server mode in almost the same way as in embedded mode.</p>
</div>
<div class="paragraph">
<p>However, in server mode it is no longer necessary to define the <code>&lt;persistence&gt;&#8230;&#8203;&lt;/persistence&gt;</code> tag. Instead, a store&#8217;s attributes are
now defined on the store type element. For example, to configure the H2 database with a distributed cache in domain mode
we define the "default" cache as follows in our domain.xml configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:9.4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;global-state</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;string-keyed-jdbc-store</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fetch-state</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">shared</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;string-keyed-table</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISPN</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;id-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;data-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">datum</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BINARY</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;timestamp-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BIGINT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/string-keyed-table&gt;</span>
        <span class="tag">&lt;write-behind</span> <span class="attribute-name">modification-queue-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/string-keyed-jdbc-store&gt;</span>
    <span class="tag">&lt;/distributed-cache&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important thing to note in this example, is that we use the "ExampleDS" datasource which is defined in the datasources
subsystem in our domain.xml configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:datasources:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;datasources&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use-java-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;connection-url&gt;</span>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<span class="tag">&lt;/connection-url&gt;</span>
      <span class="tag">&lt;driver&gt;</span>h2<span class="tag">&lt;/driver&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="tag">&lt;user-name&gt;</span>sa<span class="tag">&lt;/user-name&gt;</span>
        <span class="tag">&lt;password&gt;</span>sa<span class="tag">&lt;/password&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/datasource&gt;</span>
  <span class="tag">&lt;/datasources&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For additional examples of store configurations, please view the configuration templates in the default "domain.xml" file
provided with in the server distribution at <code>./domain/configuration/domain.xml</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="state_transfer"><a class="anchor" href="#state_transfer"></a>4.4. State Transfer</h3>
<div class="paragraph">
<p>To define the state transfer configuration for a distributed or replicated cache, add the <code>&lt;state-transfer/&gt;</code> element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;state-transfer</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">240000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">chunk-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">await-initial-transfer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible attributes for the state-transfer element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>enabled</em> if true, this will cause the cache to ask neighboring caches for state when it starts up, so the cache starts 'warm', although it will impact startup time. Defaults to true.</p>
</li>
<li>
<p><em>timeout</em> the maximum amount of time (ms) to wait for state from neighboring caches, before throwing an exception and aborting startup. Defaults to 240000 (4 minutes).</p>
</li>
<li>
<p><em>chunk-size</em> the number of cache entries to batch in each transfer. Defaults to 512.</p>
</li>
<li>
<p><em>await-initial-transfer</em> if true, this will cause the cache to wait for initial state transfer to complete before responding to requests. Defaults to true.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cache_configuration_declarative"><a class="anchor" href="#cache_configuration_declarative"></a>4.5. Declarative Cache Configuration</h3>
<div class="paragraph">
<p>Declarative configuration comes in a form of XML document that adheres to a provided Infinispan configuration XML
<a href="http://www.infinispan.org/schemas/infinispan-config-10.0.xsd">schema</a>.</p>
</div>
<div class="paragraph">
<p>Every aspect of Infinispan that can be configured declaratively can also be configured programmatically.
In fact, declarative configuration, behind the scenes, invokes the programmatic configuration API as the XML configuration file is being processed.
One can even use a combination of these approaches.
For example, you can read static XML configuration files and at runtime programmatically tune that same configuration.
Or you can use a certain static configuration defined in XML as a starting point or template for defining additional configurations in runtime.</p>
</div>
<div class="paragraph">
<p>There are two main configuration abstractions in Infinispan: <code>global</code> and <code>cache</code>.</p>
</div>
<div class="paragraph">
<div class="title">Global configuration</div>
<p>Global configuration defines global settings shared among all cache instances created by a single <a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/manager/EmbeddedCacheManager.html">EmbeddedCacheManager</a>.
Shared resources like thread pools, serialization/marshalling settings, transport and network settings, JMX domains are all part of global configuration.</p>
</div>
<div class="paragraph">
<div class="title">Cache configuration</div>
<p>Cache configuration is specific to the actual caching domain itself: it specifies eviction, locking, transaction, clustering, persistence etc.
You can specify as many named cache configurations as you need. One of these caches can be indicated as the <code>default</code> cache,
which is the cache returned by the <code>CacheManager.getCache()</code> API, whereas other named caches are retrieved via the <code>CacheManager.getCache(String name)</code> API.</p>
</div>
<div class="paragraph">
<p>Whenever they are specified, named caches inherit settings from the default cache while additional behavior can be specified or overridden.
Infinispan also provides a very flexible inheritance mechanism, where you can define a hierarchy of configuration templates,
allowing multiple caches to share the same settings, or overriding specific parameters as necessary.</p>
</div>
<div class="paragraph">
<p>One of the major goals of Infinispan is to aim for zero configuration.
A simple XML configuration file containing nothing more than a single infinispan element is enough to get you started.
The configuration file listed below provides sensible defaults and is perfectly valid.</p>
</div>
<div class="listingblock">
<div class="title">infinispan.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, that would only give you the most basic, local mode, non-clustered cache manager with no caches.
Non-basic configurations are very likely to use customized global and default cache elements.</p>
</div>
<div class="paragraph">
<p>Declarative configuration is the most common approach to configuring Infinispan cache instances.
In order to read XML configuration files one would typically construct an instance of DefaultCacheManager by pointing to an XML file containing Infinispan configuration.
Once the configuration file is read you can obtain reference to the default cache instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmbeddedCacheManager manager = <span class="keyword">new</span> DefaultCacheManager(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-config-file.xml</span><span class="delimiter">&quot;</span></span>);
Cache defaultCache = manager.getCache();</code></pre>
</div>
</div>
<div class="paragraph">
<p>or any other named instance specified in <code>my-config-file.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cache someNamedCache = manager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">someNamedCache</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the default cache is defined in the <code>&lt;cache-container&gt;</code> element of the XML configuration file, and additional
caches can be configured using the <code>&lt;local-cache&gt;</code>,<code>&lt;distributed-cache&gt;</code>,<code>&lt;invalidation-cache&gt;</code> or <code>&lt;replicated-cache&gt;</code> elements.</p>
</div>
<div class="paragraph">
<p>The following example shows the simplest possible configuration for each of the cache types supported by Infinispan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
   <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mycluster</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;invalidation-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invalidation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repl-sync</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dist-sync</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cache_configuration_templates"><a class="anchor" href="#cache_configuration_templates"></a>4.6. Cache configuration templates</h3>
<div class="paragraph">
<p>As mentioned above, Infinispan supports the notion of <em>configuration templates</em>. These are full or partial configuration
declarations which can be shared among multiple caches or as the basis for more complex configurations.</p>
</div>
<div class="paragraph">
<p>The following example shows how a configuration named <code>local-template</code> is used to define a cache named <code>local</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
   <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- template configurations --&gt;</span>
      <span class="tag">&lt;local-cache-configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-template</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;expiration</span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lifespan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-idle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/local-cache-configuration&gt;</span>

      <span class="comment">&lt;!-- cache definitions --&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-template</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Templates can inherit from previously defined templates, augmenting and/or overriding some or all of the configuration elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
   <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- template configurations --&gt;</span>
      <span class="tag">&lt;local-cache-configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">base-template</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;expiration</span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lifespan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-idle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/local-cache-configuration&gt;</span>

      <span class="tag">&lt;local-cache-configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extended-template</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">base-template</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;expiration</span> <span class="attribute-name">lifespan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;memory&gt;</span>
            <span class="tag">&lt;object</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/memory&gt;</span>
      <span class="tag">&lt;/local-cache-configuration&gt;</span>

      <span class="comment">&lt;!-- cache definitions --&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">base-template</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-bounded</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extended-template</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, <code>base-template</code> defines a local cache with a specific <em>expiration</em> configuration. The <code>extended-template</code>
configuration inherits from <code>base-template</code>, overriding just a single parameter of the <em>expiration</em> element (all other
attributes are inherited) and adds a <em>memory</em> element. Finally, two caches are defined: <code>local</code> which uses the <code>base-template</code>
configuration and <code>local-bounded</code> which uses the <code>extended-template</code> configuration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be aware that for multi-valued elements (such as <code>properties</code>) the inheritance is additive, i.e. the child configuration will be the result of merging the properties from the parent and its own.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cache_configuration_wildcards"><a class="anchor" href="#cache_configuration_wildcards"></a>4.7. Cache configuration wildcards</h3>
<div class="paragraph">
<p>An alternative way to apply templates to caches is to use wildcards in the template name, e.g. <code>basecache*</code>. Any cache whose name matches the template wildcard will inherit that configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
    <span class="tag">&lt;cache-container&gt;</span>
        <span class="tag">&lt;local-cache-configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basecache*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;expiration</span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10500</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lifespan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-idle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/local-cache-configuration&gt;</span>
        <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basecache-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basecache-2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Above, caches <code>basecache-1</code> and <code>basecache-2</code> will use the <code>basecache*</code> configuration. The configuration will also
be applied when retrieving undefined caches programmatically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a cache name matches multiple wildcards, i.e. it is ambiguous, an exception will be thrown.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cache_configuration_xinclude"><a class="anchor" href="#cache_configuration_xinclude"></a>4.8. XInclude support</h3>
<div class="paragraph">
<p>The configuration parser supports <a href="https://www.w3.org/TR/xinclude/">XInclude</a> which means you can split your XML configuration across multiple files:</p>
</div>
<div class="listingblock">
<div class="title">infinispan.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan</span> <span class="attribute-name">xmlns:xi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XInclude</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;cache-container&gt;</span>
        <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cache-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xi:include</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">included.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">included.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cache-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the parser supports a minimal subset of the XInclude spec (no support for XPointer, fallback, text processing and content negotiation).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cache_configuration_declarative_ref"><a class="anchor" href="#cache_configuration_declarative_ref"></a>4.9. Declarative configuration reference</h3>
<div class="paragraph">
<p>For more details on the declarative configuration schema, refer to the <a href="https://docs.jboss.org/infinispan/10.0/configdocs/">configuration reference</a>.</p>
</div>
<div class="paragraph">
<p>If you are using XML editing tools for configuration writing you can use the provided Infinispan <a href="http://infinispan.org/schemas/infinispan-config-10.0.xsd">schema</a> to assist you.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="programmatic"><a class="anchor" href="#programmatic"></a>5. Configuring Caches Programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan programmatic configuration.</p>
</div>
<div class="sect2">
<h3 id="cache_configuration_programmatic"><a class="anchor" href="#cache_configuration_programmatic"></a>5.1. CacheManager and ConfigurationBuilder API</h3>
<div class="paragraph">
<p>Programmatic Infinispan configuration is centered around the CacheManager and ConfigurationBuilder API.
Although every single aspect of Infinispan configuration could be set programmatically, the most usual approach is to create a starting point in a form of XML configuration file and then in runtime, if needed, programmatically tune a specific configuration to suit the use case best.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmbeddedCacheManager manager = <span class="keyword">new</span> DefaultCacheManager(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-config-file.xml</span><span class="delimiter">&quot;</span></span>);
Cache defaultCache = manager.getCache();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s assume that a new synchronously replicated cache is to be configured programmatically.
First, a fresh instance of Configuration object is created using ConfigurationBuilder helper object, and the cache mode is set to synchronous replication.
Finally, the configuration is defined/registered with a manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder().clustering().cacheMode(CacheMode.REPL_SYNC).build();

<span class="predefined-type">String</span> newCacheName = <span class="string"><span class="delimiter">&quot;</span><span class="content">repl</span><span class="delimiter">&quot;</span></span>;
manager.defineConfiguration(newCacheName, c);
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = manager.getCache(newCacheName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default cache configuration (or any other cache configuration) can be used as a starting point for creation of a new cache.
For example, lets say that <code>infinispan-config-file.xml</code> specifies a replicated cache as a default and that a distributed cache is desired with a specific L1 lifespan while at the same time retaining all other aspects of a default cache.
Therefore, the starting point would be to read an instance of a default Configuration object and use <code>ConfigurationBuilder</code> to construct and modify cache mode and L1 lifespan on a new <code>Configuration</code> object. As a final step the configuration is defined/registered with a manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmbeddedCacheManager manager = <span class="keyword">new</span> DefaultCacheManager(<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-config-file.xml</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Configuration</span> dcc = manager.getDefaultCacheConfiguration();
<span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder().read(dcc).clustering().cacheMode(CacheMode.DIST_SYNC).l1().lifespan(<span class="integer">60000L</span>).build();
<span class="error">Â </span>
<span class="predefined-type">String</span> newCacheName = <span class="string"><span class="delimiter">&quot;</span><span class="content">distributedWithL1</span><span class="delimiter">&quot;</span></span>;
manager.defineConfiguration(newCacheName, c);
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = manager.getCache(newCacheName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As long as the base configuration is the default named cache, the previous code works perfectly fine. However, other times the base configuration might be another named cache. So, how can new configurations be defined based on other defined caches? Take the previous example and imagine that instead of taking the default cache as base, a named cache called "replicatedCache" is used as base. The code would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmbeddedCacheManager manager = <span class="keyword">new</span> DefaultCacheManager(<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-config-file.xml</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Configuration</span> rc = manager.getCacheConfiguration(<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Configuration</span> c = <span class="keyword">new</span> ConfigurationBuilder().read(rc).clustering().cacheMode(CacheMode.DIST_SYNC).l1().lifespan(<span class="integer">60000L</span>).build();
<span class="error">Â </span>
<span class="predefined-type">String</span> newCacheName = <span class="string"><span class="delimiter">&quot;</span><span class="content">distributedWithL1</span><span class="delimiter">&quot;</span></span>;
manager.defineConfiguration(newCacheName, c);
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = manager.getCache(newCacheName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/manager/CacheManager.html">CacheManager</a> , <a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/configuration/cache/ConfigurationBuilder.html">ConfigurationBuilder</a> , <a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/configuration/cache/Configuration.html">Configuration</a> , and <a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/configuration/global/GlobalConfiguration.html">GlobalConfiguration</a> javadocs for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache_configuration_programmatic_api"><a class="anchor" href="#cache_configuration_programmatic_api"></a>5.2. ConfigurationBuilder Programmatic Configuration API</h3>
<div class="paragraph">
<p>While the above paragraph shows how to combine declarative and programmatic configuration, starting from an XML configuration is completely optional.
The ConfigurationBuilder fluent interface style allows for easier to write and more readable programmatic configuration.
This approach can be used for both the global and the cache level configuration.
GlobalConfiguration objects are constructed using GlobalConfigurationBuilder while Configuration objects are built using ConfigurationBuilder.
Let&#8217;s look at some examples on configuring both global and cache level options with this API:</p>
</div>
<div class="sect3">
<h4 id="enabling_jmx_mbeans_and_statistics"><a class="anchor" href="#enabling_jmx_mbeans_and_statistics"></a>5.2.1. Enabling JMX MBeans and statistics</h4>
<div class="paragraph">
<p>Sometimes you might also want to enable collection of <a href="https://docs.jboss.org/infinispan/10.0/apidocs/jmxComponents.html">global JMX statistics</a>
at cache manager level or get information about the transport. To enable global JMX statistics simply do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
<span class="error">Â </span> .globalJmxStatistics()
  .enable()
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that by not enabling (or by explicitly disabling) global JMX statistics your are just turning off statistics
collection. The corresponding MBean is still registered and can be used to manage the cache manager in general, but the
statistics attributes do not return meaningful values.</p>
</div>
<div class="paragraph">
<p>Further options at the global JMX statistics level allows you to configure the cache manager name which comes handy when you have multiple cache managers running on the same system, or how to locate the JMX MBean Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
<span class="error">Â </span> .globalJmxStatistics()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .cacheManagerName(<span class="string"><span class="delimiter">&quot;</span><span class="content">SalesCacheManager</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .mBeanServerLookup(<span class="keyword">new</span> JBossMBeanServerLookup())
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring_thread_pools"><a class="anchor" href="#configuring_thread_pools"></a>5.2.2. Configuring thread pools</h4>
<div class="paragraph">
<p>Some of the Infinispan features are powered by a group of the thread pool executors which can also be tweaked at this global level. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
<span class="error">Â </span>  .replicationQueueThreadPool()
     .threadPoolFactory(ScheduledThreadPoolExecutorFactory.create())
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can not only configure global, cache manager level, options, but you can also configure cache level options such as the cluster mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> config = <span class="keyword">new</span> ConfigurationBuilder()
<span class="error">Â </span> .clustering()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .cacheMode(CacheMode.DIST_SYNC)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .sync()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .l1().lifespan(<span class="integer">25000L</span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .hash().numOwners(<span class="integer">3</span>)
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can configure eviction and expiration settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> config = <span class="keyword">new</span> ConfigurationBuilder()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .memory()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .size(<span class="integer">20000</span>)
          .expiration()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .wakeUpInterval(<span class="integer">5000L</span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .maxIdle(<span class="integer">120000L</span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring_transactions_and_locking"><a class="anchor" href="#configuring_transactions_and_locking"></a>5.2.3. Configuring transactions and locking</h4>
<div class="paragraph">
<p>An application might also want to interact with an Infinispan cache within the boundaries of JTA and to do that you need to configure the transaction layer and optionally tweak the locking settings. When interacting with transactional caches, you might want to enable recovery to deal with transactions that finished with an heuristic outcome and if you do that, you will often want to enable JMX management and statistics gathering too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> config = <span class="keyword">new</span> ConfigurationBuilder()
  .locking()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .concurrencyLevel(<span class="integer">10000</span>).isolationLevel(IsolationLevel.REPEATABLE_READ)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .lockAcquisitionTimeout(<span class="integer">12000L</span>).useLockStriping(<span class="predefined-constant">false</span>).writeSkewCheck(<span class="predefined-constant">true</span>)
    .versioning().enable().scheme(VersioningScheme.SIMPLE)
<span class="error">Â </span> .transaction()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .transactionManagerLookup(<span class="keyword">new</span> GenericTransactionManagerLookup())
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .recovery()
<span class="error">Â </span> .jmxStatistics()
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring_cache_stores"><a class="anchor" href="#configuring_cache_stores"></a>5.2.4. Configuring cache stores</h4>
<div class="paragraph">
<p>Configuring Infinispan with chained cache stores is simple too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> config = <span class="keyword">new</span> ConfigurationBuilder()
   .persistence().passivation(<span class="predefined-constant">false</span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span>.addSingleFileStore().location(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp</span><span class="delimiter">&quot;</span></span>).async().enable()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span>.preload(<span class="predefined-constant">false</span>).shared(<span class="predefined-constant">false</span>).threadPoolSize(<span class="integer">20</span>).build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cache_configuration_programmatic_advanced"><a class="anchor" href="#cache_configuration_programmatic_advanced"></a>5.2.5. Advanced programmatic configuration</h4>
<div class="paragraph">
<p>The fluent configuration can also be used to configure more advanced or exotic options, such as advanced externalizers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
<span class="error">Â </span> .serialization()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .addAdvancedExternalizer(<span class="integer">998</span>, <span class="keyword">new</span> PersonExternalizer())
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .addAdvancedExternalizer(<span class="integer">999</span>, <span class="keyword">new</span> AddressExternalizer())
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, add custom interceptors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> config = <span class="keyword">new</span> ConfigurationBuilder()
<span class="error">Â </span> .customInterceptors().addInterceptor()
<span class="error">Â </span><span class="error">Â </span>  .interceptor(<span class="keyword">new</span> FirstInterceptor()).position(InterceptorConfiguration.Position.FIRST)
    .interceptor(<span class="keyword">new</span> LastInterceptor()).position(InterceptorConfiguration.Position.LAST)
    .interceptor(<span class="keyword">new</span> FixPositionInterceptor()).index(<span class="integer">8</span>)
    .interceptor(<span class="keyword">new</span> AfterInterceptor()).after(NonTransactionalLockingInterceptor.class)
    .interceptor(<span class="keyword">new</span> BeforeInterceptor()).before(CallInterceptor.class)
<span class="error">Â </span> .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information on the individual configuration options, please check the <a href="https://docs.jboss.org/infinispan/10.0/configdocs/">configuration guide</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster_transport"><a class="anchor" href="#cluster_transport"></a>6. Setting Up Cluster Transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan nodes rely on a transport layer to join and leave clusters as well
as to replicate data across the network.</p>
</div>
<div class="paragraph">
<p>Infinispan uses JGroups technology to handle cluster transport. You configure
cluster transport with JGroups stacks, which define properties for either UDP
or TCP protocols.</p>
</div>
<div class="sect2">
<h3 id="jgroups_getting_started-configuring"><a class="anchor" href="#jgroups_getting_started-configuring"></a>6.1. Getting Started with Default Stacks</h3>
<div class="paragraph">
<p>Use default JGroups stacks with recommended settings as a starting point for
your cluster transport layer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Default JGroups stacks are included in <code>infinispan-core.jar</code> and, as a result,
are on the classpath.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Programmatic procedure</div>
<ul>
<li>
<p>Specify default JGroups stacks with the <code>addProperty()</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder().transport()
        .defaultTransport()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .clusterName(<span class="string"><span class="delimiter">&quot;</span><span class="content">qa-cluster</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span>  <span class="comment">// Use default JGroups stacks with the addProperty() method.</span>
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .addProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">configurationFile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">default-jgroups-tcp.xml</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .machineId(<span class="string"><span class="delimiter">&quot;</span><span class="content">qa-machine</span><span class="delimiter">&quot;</span></span>).rackId(<span class="string"><span class="delimiter">&quot;</span><span class="content">qa-rack</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .build();</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Declarative procedure</div>
<ul>
<li>
<p>Specify default JGroups stacks with the <code>stack</code> attribute.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
Â  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Add default JGroups stacks to clustered caches. --&gt;</span>
Â Â Â  <span class="tag">&lt;transport</span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  Â  ...
Â  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>cluster-stack</code> argument with the Infinispan server startup script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh --cluster-stack=tcp</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="preconfigured_jgroups_stacks-configuring"><a class="anchor" href="#preconfigured_jgroups_stacks-configuring"></a>6.1.1. Default JGroups Stacks</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File name</th>
<th class="tableblock halign-left valign-top">Stack name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-udp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>udp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses UDP for transport and UDP multicast for discovery. Suitable for larger clusters (over 100 nodes) or if you are using replicated caches or invalidation mode. Minimises the number of open sockets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-tcp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and UDP multicast for discovery. Suitable for smaller clusters (under 100 nodes) <em>only if</em> you are using distributed caches because TCP is more efficient than UDP as a point-to-point protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ec2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>S3_PING</code> for discovery. Suitable for Amazon EC2 nodes where UDP multicast is not available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-kubernetes.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>DNS_PING</code> for discovery. Suitable for Kubernetes and Red Hat OpenShift nodes where UDP multicast is not always available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>GOOGLE_PING2</code> for discovery. Suitable for Google Cloud Platform nodes where UDP multicast is not available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>AZURE_PING</code> for discovery. Suitable for Microsoft Azure nodes where UDP multicast is not available.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Next Steps</div>
<p>After you get up and running with the default JGroups stacks, use inheritance
to combine, extend, remove, and replace stack properties. See
<a href="#jgroups_inline-configuring">Adjusting and Tuning JGroups Stacks</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="default_jgroups_stacks-configuring"><a class="anchor" href="#default_jgroups_stacks-configuring"></a>6.1.2. Default JGroups Stacks</h4>
<div class="paragraph">
<p>Infinispan uses the following JGroups <code>TCP</code> and <code>UDP</code> stacks by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UDP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PING</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span>
<span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-mping</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">use_mcast_xmit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/protocol&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To improve performance, Infinispan uses some values for properties other than the JGroups default values. You should examine the following files to review the JGroups configuration for Infinispan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infinispan servers</p>
<div class="ulist">
<ul>
<li>
<p><code>jgroups-defaults.xml</code></p>
</li>
<li>
<p><code>infinispan-jgroups.xml</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Embedded Infinispan</p>
<div class="ulist">
<ul>
<li>
<p><code>default-jgroups-tcp.xml</code></p>
</li>
<li>
<p><code>default-jgroups-udp.xml</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default <code>TCP</code> stack uses the <code>MPING</code> protocol for discovery, which uses
<code>UDP</code> multicast.</p>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual/html/protlist.html">JGroups Protocol</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual/html/protlist.html#DiscoveryProtocols">JGroups Discovery Protocols</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups_inline-configuring"><a class="anchor" href="#jgroups_inline-configuring"></a>6.2. Using Inline JGroups Stacks</h3>
<div class="paragraph">
<p>Use inline JGroups stack definitions to customize cluster transport for optimal
network performance.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use inheritance with inline JGroups stacks to tune and customize specific
transport properties.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Embed your custom JGroups stack definitions in <code>infinispan.xml</code> as in the
following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="comment">&lt;!-- jgroups is the parent for stack declarations. --&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Add JGroups stacks for Infinispan clustering. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">recv_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">send_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">640000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;MPING</span> <span class="attribute-name">bind_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">break_on_coord_rsp</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">mcast_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mping.mcast_addr:228.2.4.6}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">mcast_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mping.mcast_port:43366}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">ip_ttl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.ip_ttl:2}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;MERGE3</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FD_SOCK</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FD_ALL</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout_check_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;VERIFY_SUSPECT</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.NAKACK2</span> <span class="attribute-name">use_mcast_xmit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_num_rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">xmit_table_msgs_per_row</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_max_compaction_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;UNICAST3</span> <span class="attribute-name">xmit_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_num_rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_msgs_per_row</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmit_table_max_compaction_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.STABLE</span> <span class="attribute-name">stability_delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">desired_avg_gossip</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max_bytes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1M</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.GMS</span> <span class="attribute-name">print_local_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">join_timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.join_timeout:2000}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;UFC_NB</span> <span class="attribute-name">max_credits</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3m</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min_threshold</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;MFC_NB</span> <span class="attribute-name">max_credits</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3m</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min_threshold</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FRAG3</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
Â  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Add JGroups stacks to clustered caches. --&gt;</span>
Â Â Â  <span class="tag">&lt;transport</span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    ...
Â  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/10.0/configdocs/">Infinispan Configuration Schema</a></p>
</div>
</div>
<div class="sect2">
<h3 id="jgroups_inheritance-configuring"><a class="anchor" href="#jgroups_inheritance-configuring"></a>6.3. Adjusting and Tuning JGroups Stacks</h3>
<div class="paragraph">
<p>Use inheritance to combine, extend, remove, and replace specific properties in
the default JGroups stacks or custom configurations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a new JGroups stack declaration.</p>
</li>
<li>
<p>Name a parent stack with the <code>extends</code> attribute.</p>
</li>
<li>
<p>Modify transport properties with the <code>stack.combine</code> attribute.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, you want to evaluate using a Gossip router for cluster discovery using a <code>TCP</code> stack configuration named <code>prod</code>.</p>
</div>
<div class="paragraph">
<p>You can create a new stack named <code>gossip-prod</code> that inherits from <code>prod</code> and
use <code>stack.combine</code> to change properties for the Gossip router configuration,
as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;jgroups&gt;</span>
  ...
  <span class="comment">&lt;!-- &quot;gossip-prod&quot; inherits properties from &quot;prod&quot; --&gt;</span>
  <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gossip-prod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Use TCPGOSSIP discovery instead of MPING. --&gt;</span>
    <span class="tag">&lt;TCPGOSSIP</span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.tunnel.gossip_router_hosts:localhost[12001]}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPLACE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Remove FD_SOCK. --&gt;</span>
    <span class="tag">&lt;FD_SOCK</span> <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Increase VERIFY_SUSPECT. --&gt;</span>
    <span class="tag">&lt;VERIFY_SUSPECT</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Add SYM_ENCRYPT. --&gt;</span>
    <span class="tag">&lt;SYM_ENCRYPT</span> <span class="attribute-name">sym_algorithm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AES</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">key_store_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultStore.keystore</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">store_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/stack&gt;</span>
  ...
<span class="tag">&lt;/jgroups&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="jgroups_stackcombine-configuring"><a class="anchor" href="#jgroups_stackcombine-configuring"></a>6.3.1. Stack Combine Attribute</h4>
<div class="paragraph">
<p><code>stack.combine</code> lets you override and modify inherited JGroups properties.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMBINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides existing protocol attributes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPLACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaces existing protocols that you identify with the <code>stack.position</code> attribute. If you do not specify <code>stack.position</code>, Infinispan defaults to the same protocol as the inherited configuration, which resets all non-specified attributes to the default values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts protocols after any protocols that you identify with the <code>stack.position</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REMOVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes protocols from the inherited configuration.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="jgroups_external-configuring"><a class="anchor" href="#jgroups_external-configuring"></a>6.4. Using JGroups Stacks in External Files</h3>
<div class="paragraph">
<p>Use JGroups transport configuration from external files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan looks for JGroups configuration files on your classpath first and
then for absolute path names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Programmatic procedure</div>
<ul>
<li>
<p>Specify your JGroups transport configuration with the <code>addProperty()</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder().transport()
        .defaultTransport()
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .clusterName(<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-cluster</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span>  <span class="comment">// Add custom JGroups stacks with the addProperty() method.</span>
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .addProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">configurationFile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">prod-jgroups-tcp.xml</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .machineId(<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-machine</span><span class="delimiter">&quot;</span></span>).rackId(<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-rack</span><span class="delimiter">&quot;</span></span>)
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> .build();</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Declarative procedure</div>
<ul>
<li>
<p>Add your JGroups stack file and then configure the Infinispan cluster to use
it.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
     <span class="comment">&lt;!-- Add custom JGroups stacks in external files. --&gt;</span>
     <span class="tag">&lt;stack-file</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-jgroups-tcp.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
Â  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Add custom JGroups stacks to clustered caches. --&gt;</span>
Â Â Â  <span class="tag">&lt;transport</span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-tcp</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
Â  <span class="tag">&lt;/cache-container&gt;</span>
Â  ...
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/configuration/global/GlobalConfigurationBuilder.html#transport()">GlobalConfigurationBuilder.transport()</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/10.0/apidocs/org/infinispan/configuration/global/TransportConfigurationBuilder.html">TransportConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jgroups_tune_system_props-configuring"><a class="anchor" href="#jgroups_tune_system_props-configuring"></a>6.5. Tuning JGroups Stacks with System Properties</h3>
<div class="paragraph">
<p>Pass system properties to the JVM at startup to tune JGroups stacks.</p>
</div>
<div class="paragraph">
<p>For example, to change the <code>TCP</code> port and IP address do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ java -cp ... -Djgroups.tcp.port=1234 -Djgroups.tcp.address=192.0.2.0</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="jgroups_system_props-configuring"><a class="anchor" href="#jgroups_system_props-configuring"></a>6.5.1. System Properties for Default JGroups Stacks</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default-jgroups-udp.xml</code></dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.udp.mcast_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for multicast, both discovery and inter-cluster communication. The IP address must be a valid "class D" address that is suitable for IP multicast.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>228.6.7.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.udp.mcast_port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the multicast socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.udp.ip_ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the time-to-live (TTL) for IP multicast packets. The value defines the number of network hops a packet can make before it is dropped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default-jgroups-tcp.xml</code></dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.tcp.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for TCP transport.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.tcp.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the TCP socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.udp.mcast_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for multicast discovery. The IP address must be a valid "class D" address that is suitable for IP multicast.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>228.6.7.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.udp.mcast_port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the multicast socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.udp.ip_ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the time-to-live (TTL) for IP multicast packets. The value defines the number of network hops a packet can make before it is dropped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default-jgroups-ec2.xml</code></dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.tcp.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for TCP transport.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.tcp.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the TCP socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.access_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon S3 access key for an S3 bucket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.secret_access_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon S3 secret key used for an S3 bucket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.bucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 bucket. The name must already exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default-jgroups-kubernetes.xml</code></dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.tcp.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for TCP transport.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eth0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.tcp.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the TCP socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#SystemProperties">JGroups System Properties</a></p>
</li>
<li>
<p><a href="http://jgroups.org/manual/html/protlist.html">JGroups Protocol List</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups_jchannels-configuring"><a class="anchor" href="#jgroups_jchannels-configuring"></a>6.6. Using Custom JChannels</h3>
<div class="paragraph">
<p>Construct custom JGroups JChannels as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfigurationBuilder global = <span class="keyword">new</span> GlobalConfigurationBuilder();
JChannel jchannel = <span class="keyword">new</span> JChannel();
<span class="comment">// Configure the jchannel to your needs.</span>
JGroupsTransport transport = <span class="keyword">new</span> JGroupsTransport(jchannel);
global.transport().transport(transport);
<span class="keyword">new</span> DefaultCacheManager(global.build());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan cannot use custom JChannels that are already connected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="http://www.jgroups.org/manual4/index.html#JChannel">JGroups JChannel</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster_discovery"><a class="anchor" href="#cluster_discovery"></a>7. Configuring Cluster Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Running Infinispan on hosted services requires using discovery mechanisms that are adapted to network constraints that individual cloud providers impose. For instance, Amazon EC2 does not allow UDP multicast.</p>
</div>
<div class="paragraph">
<p>Infinispan can use the following cloud discovery mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generic discovery protocols (<code>TCPPING</code> and <code>TCPGOSSIP</code>)</p>
</li>
<li>
<p>JGroups PING protocols (<code>KUBE_PING</code> and <code>DNS_PING</code>)</p>
</li>
<li>
<p>Cloud-specific PING protocols</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Embedded Infinispan requires cloud provider dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="tcpping"><a class="anchor" href="#tcpping"></a>7.1. TCPPING</h3>
<div class="paragraph">
<p><code>TCPPING</code> is a generic JGroups discovery mechanism that uses a static list of IP
addresses for cluster members.</p>
</div>
<div class="paragraph">
<p>To use <code>TCPPING</code>, you must add the list of static IP addresses to the JGroups
configuration file for each Infinispan node. However, the drawback to
<code>TCPPING</code> is that it does not allow nodes to dynamically join Infinispan
clusters.</p>
</div>
<div class="listingblock">
<div class="title">TCPPING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
Â Â Â Â Â  <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
Â Â Â Â Â  <span class="tag">&lt;TCPPING</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.tcpping.initial_hosts:localhost[7800],localhost[7801]}</span><span class="delimiter">&quot;</span></span>
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> <span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
<span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span><span class="error">Â </span> <span class="attribute-name">num_initial_members</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
...
...
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="http://community.jboss.org/wiki/JGroupsTCPPING">JGroups TCPPING</a></p>
</div>
</div>
<div class="sect2">
<h3 id="gossip_router"><a class="anchor" href="#gossip_router"></a>7.2. Gossip Router</h3>
<div class="paragraph">
<p>Gossip routers provide a centralized location on the network from which your
Infinispan cluster can retrieve addresses of other nodes.</p>
</div>
<div class="paragraph">
<p>You inject the address (<code>IP:PORT</code>) of the Gossip router into Infinispan nodes as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass the address as a system property to the JVM; for example, <code>-DGossipRouterAddress="10.10.2.4[12001]"</code>.</p>
</li>
<li>
<p>Reference that system property in the JGroups configuration file.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Gossip router configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
Â Â Â  <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
Â Â Â  <span class="tag">&lt;TCPGOSSIP</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${GossipRouterAddress}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">num_initial_members</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
...
...
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="http://community.jboss.org/docs/DOC-10890">JGroups Gossip Router</a></p>
</div>
</div>
<div class="sect2">
<h3 id="dns_ping"><a class="anchor" href="#dns_ping"></a>7.3. DNS_PING</h3>
<div class="paragraph">
<p>JGroups <code>DNS_PING</code> queries DNS servers to discover Infinispan cluster members
in Kubernetes environments such as OKD and Red Hat OpenShift.</p>
</div>
<div class="listingblock">
<div class="title">DNS_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dns-ping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
    <span class="tag">&lt;dns.DNS_PING</span>
      <span class="attribute-name">dns_query</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myservice.myproject.svc.cluster.local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
...
<span class="tag">&lt;/stack&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#_dns_ping">JGroups DNS_PING</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a> (Kubernetes documentation for adding DNS entries)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kube_ping"><a class="anchor" href="#kube_ping"></a>7.4. KUBE_PING</h3>
<div class="paragraph">
<p>JGroups <code>Kube_PING</code> uses a Kubernetes API to discover Infinispan cluster
members in environments such as OKD and Red Hat OpenShift.</p>
</div>
<div class="listingblock">
<div class="title">KUBE_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
Â Â Â  <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${match-interface:eth.*}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
Â Â Â  <span class="tag">&lt;kubernetes.KUBE_PING</span> <span class="tag">/&gt;</span>
...
...
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">KUBE_PING configuration requirements</div>
<ul>
<li>
<p>Your <code>KUBE_PING</code> configuration must bind the JGroups stack to the <code>eth0</code>
network interface. Docker containers use <code>eth0</code> for communication.</p>
</li>
<li>
<p><code>KUBE_PING</code> uses environment variables inside containers for configuration.
The <code>KUBERNETES_NAMESPACE</code> environment variable must specify a valid namespace.
You can either hardcode it or populate it via the Kubernetes Downward API.</p>
</li>
<li>
<p><code>KUBE_PING</code> requires additional privileges on Red Hat OpenShift. Assuming that <code>oc project -q</code> returns the current namespace and <code>default</code> is the service account name, you can run:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default -n $(oc project -q)</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#_kube_ping">JGroups Kube_PING</a></p>
</li>
<li>
<p><a href="https://github.com/kubernetes/kubernetes/tree/release-1.0/docs/user-guide/downward-api">Kubernetes Downward API</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/">Docker Networking</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="native_s3_ping"><a class="anchor" href="#native_s3_ping"></a>7.5. NATIVE_S3_PING</h3>
<div class="paragraph">
<p>On Amazon Web Service (AWS), use the <code>S3_PING</code> protocol for discovery.</p>
</div>
<div class="paragraph">
<p>You can configure JGroups to use shared storage to exchange the details of
Infinispan nodes. <code>NATIVE_S3_PING</code> allows Amazon S3 as the shared storage but
requires both Amazon S3 and EC2 subscriptions.</p>
</div>
<div class="listingblock">
<div class="title">NATIVE_S3_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;config&gt;</span>
    <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;org.jgroups.aws.s3.NATIVE_S3_PING</span>
            <span class="attribute-name">region_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replace this with your region (e.g. eu-west-1)</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">bucket_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replace this with your bucket name</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">bucket_prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replace this with a prefix to use for entries in the bucket (optional)</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">NATIVE_S3_PING dependencies for embedded Infinispan</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jgroups.aws.s3<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>native-s3-ping<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.jgroups.native_s3_ping} with the
  version of the native-s3-ping module you want to use. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.jgroups.native_s3_ping}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc_ping"><a class="anchor" href="#jdbc_ping"></a>7.6. JDBC_PING</h3>
<div class="paragraph">
<p><code>JDBC_PING</code> uses JDBC connections to shared databases, such as Amazon RDS on
EC2, to store information about Infinispan nodes.</p>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="http://community.jboss.org/wiki/JDBCPING">JDBC_PING Wiki</a></p>
</div>
</div>
<div class="sect2">
<h3 id="azure_ping"><a class="anchor" href="#azure_ping"></a>7.7. AZURE_PING</h3>
<div class="paragraph">
<p>On Microsoft Azure, use a generic discovery protocol or <code>AZURE_PING</code>, which
uses shared Azure Blob Storage to store discovery information.</p>
</div>
<div class="listingblock">
<div class="title">AZURE_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;azure.AZURE_PING</span>
        <span class="attribute-name">storage_account_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replace this with your account name</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">storage_access_key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replace this with your access key</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replace this with your container name</span><span class="delimiter">&quot;</span></span>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">AZURE_PING dependencies for embedded Infinispan</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jgroups.azure<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jgroups-azure<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.jgroups.azure} with the
  version of the jgroups-azure module you want to use. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.jgroups.azure}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="google2_ping"><a class="anchor" href="#google2_ping"></a>7.8. GOOGLE2_PING</h3>
<div class="paragraph">
<p>On Google Compute Engine (GCE), use a generic discovery protocol or
<code>GOOGLE2_PING</code>, which uses Google Cloud Storage (GCS) to store information
about the cluster members.</p>
</div>
<div class="listingblock">
<div class="title">GOOGLE2_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;org.jgroups.protocols.google.GOOGLE_PING2</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.google.bucket_name}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">GOOGLE2_PING dependencies for embedded Infinispan</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jgroups.google<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jgroups-google<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.jgroups.google} with the
  version of the jgroups-goole module you want to use. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.jgroups.google}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-10-27 08:15:43 UTC
</div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>