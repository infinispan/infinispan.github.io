<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Upgrading Infinispan 11.0</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="http://infinispan.org/docs/stable/user_guide/user_guide.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Upgrading Infinispan 11.0</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#upgrading">1. Infinispan Version Details</a>
<ul class="sectlevel2">
<li><a href="#upgrading_from_10_1_to_11_0">1.1. Upgrading from 10.1 to 11.0</a>
<ul class="sectlevel3">
<li><a href="#protobuf_marshalling">1.1.1. Protobuf Marshalling</a></li>
<li><a href="#hotrod_client">1.1.2. HotRod Client</a></li>
<li><a href="#wildfly_modules">1.1.3. Wildfly modules</a></li>
<li><a href="#cross_site_replication">1.1.4. Cross Site Replication</a></li>
<li><a href="#total_order_transaction_protocol_removed">1.1.5. Total Order transaction protocol removed</a></li>
<li><a href="#osgi">1.1.6. OSGi</a></li>
<li><a href="#search">1.1.7. Search</a>
<ul class="sectlevel4">
<li><a href="#indexing">Indexing</a></li>
<li><a href="#querying">Querying</a>
<ul class="sectlevel5">
<li><a href="#entity_mappings">Entity Mappings</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#threadfactoryconfiguration_changes">1.1.8. ThreadFactoryConfiguration changes</a></li>
<li><a href="#persistence">1.1.9. Persistence</a>
<ul class="sectlevel4">
<li><a href="#single_file_store">Single File Store</a></li>
<li><a href="#clusterloader">ClusterLoader</a></li>
</ul>
</li>
<li><a href="#hotrod">1.1.10. HotRod</a></li>
<li><a href="#memory_configuration_changes">1.1.11. Memory configuration changes</a></li>
<li><a href="#encoding_in_server_caches">1.1.12. Encoding in Server Caches</a></li>
<li><a href="#security">1.1.13. Security</a>
<ul class="sectlevel4">
<li><a href="#server_security">Server security</a></li>
<li><a href="#cache_authorization_roles">Cache authorization roles</a></li>
</ul>
</li>
<li><a href="#rest">1.1.14. REST</a></li>
</ul>
</li>
<li><a href="#upgrading_from_10_0_to_10_1_and_10_0_to_11_0">1.2. Upgrading from 10.0 to 10.1 and 10.0 to 11.0</a>
<ul class="sectlevel3">
<li><a href="#maximum_idle_timeouts_with_clustered_cache_modes">1.2.1. Maximum Idle Timeouts with Clustered Cache Modes</a></li>
</ul>
</li>
<li><a href="#upgrading_from_10_0_to_10_1">1.3. Upgrading from 10.0 to 10.1</a>
<ul class="sectlevel3">
<li><a href="#rest_store">1.3.1. REST Store</a></li>
<li><a href="#infinispan_lucene_directory_is_deprecated">1.3.2. Infinispan Lucene Directory is deprecated</a></li>
<li><a href="#security_role_mappers_and_audit_loggers">1.3.3. Security role mappers and audit loggers</a></li>
<li><a href="#memcached_protocol_server_is_deprecated">1.3.4. Memcached protocol server is deprecated</a></li>
<li><a href="#hot_rod_client_default_mechanism_changed_to_scram_sha_512">1.3.5. Hot Rod client default mechanism changed to SCRAM-SHA-512</a></li>
<li><a href="#transactions">1.3.6. Transactions</a></li>
</ul>
</li>
<li><a href="#upgrading_from_9_4_to_10_0">1.4. Upgrading from 9.4 to 10.0</a>
<ul class="sectlevel3">
<li><a href="#marshalling">1.4.1. Marshalling</a>
<ul class="sectlevel4">
<li><a href="#externalizer_deprecations">Externalizer Deprecations</a></li>
<li><a href="#store_migration">Store Migration</a></li>
<li><a href="#store_defaults">Store Defaults</a></li>
</ul>
</li>
<li><a href="#cachecontainteradmin">1.4.2. CacheContainterAdmin</a></li>
<li><a href="#hot_rod_3_0">1.4.3. Hot Rod 3.0</a></li>
<li><a href="#total_order_transaction_protocol_is_deprecated">1.4.4. Total Order transaction protocol is deprecated</a></li>
<li><a href="#removed_the_infinispan_server_hotrod_workerthreads_system_property">1.4.5. Removed the infinispan.server.hotrod.workerThreads system property</a></li>
<li><a href="#removed_atomicmap_and_finegrainedatomicmap">1.4.6. Removed AtomicMap and FineGrainedAtomicMap</a></li>
<li><a href="#removed_delta_and_deltaaware">1.4.7. Removed Delta and DeltaAware</a></li>
<li><a href="#removed_compatibility_mode">1.4.8. Removed compatibility mode</a></li>
<li><a href="#removed_the_implicit_default_cache">1.4.9. Removed the implicit default cache</a></li>
<li><a href="#removed_distributedexecutor">1.4.10. Removed DistributedExecutor</a></li>
<li><a href="#removed_the_tree_module">1.4.11. Removed the Tree module</a></li>
<li><a href="#the_jdbc_pooledconnectionfactory_now_utilises_agroal">1.4.12. The JDBC PooledConnectionFactory now utilises Agroal</a></li>
<li><a href="#xml_configuration_changes">1.4.13. XML configuration changes</a></li>
<li><a href="#remotecache_changes">1.4.14. RemoteCache Changes</a>
<ul class="sectlevel4">
<li><a href="#marshalling_changes">Marshalling Changes</a></li>
<li><a href="#the_getbulk_methods_have_been_removed">The getBulk methods have been removed</a></li>
</ul>
</li>
<li><a href="#persistence_changes">1.4.15. Persistence changes</a></li>
<li><a href="#clientserver_changes">1.4.16. Client/Server changes</a></li>
<li><a href="#skip_listener_notification_flag">1.4.17. SKIP_LISTENER_NOTIFICATION flag</a></li>
<li><a href="#performasync_header_removed_from_rest">1.4.18. performAsync header removed from REST</a></li>
<li><a href="#rest_status_code_change">1.4.19. REST status code change</a></li>
<li><a href="#default_jgroups_stacks_in_the_xml_configuration">1.4.20. Default JGroups stacks in the XML configuration</a></li>
<li><a href="#jgroups_s3_ping_replaced_with_native_s3_ping">1.4.21. JGroups S3_PING replaced with NATIVE_S3_PING</a></li>
<li><a href="#cache_and_cache_manager_listeners_can_now_be_configured_to_be_non_blocking">1.4.22. Cache and Cache Manager Listeners can now be configured to be non blocking</a></li>
<li><a href="#distributed_streams_operations_no_longer_support_null_values">1.4.23. Distributed Streams operations no longer support null values</a></li>
<li><a href="#removed_the_infinispan_cloud_module">1.4.24. Removed the infinispan-cloud module</a></li>
<li><a href="#removed_experimental_flag_guaranteed_delivery">1.4.25. Removed experimental flag GUARANTEED_DELIVERY</a></li>
<li><a href="#cache_health">1.4.26. Cache Health</a></li>
<li><a href="#multi_tenancy">1.4.27. Multi-tenancy</a></li>
<li><a href="#offheap_automatic_resizing">1.4.28. OffHeap Automatic Resizing</a></li>
<li><a href="#deprecated_methods_from_datacontainer_removed">1.4.29. Deprecated methods from DataContainer removed</a></li>
</ul>
</li>
<li><a href="#upgrading_from_9_3_to_9_4">1.5. Upgrading from 9.3 to 9.4</a>
<ul class="sectlevel3">
<li><a href="#clientserver_changes_2">1.5.1. Client/Server changes</a>
<ul class="sectlevel4">
<li><a href="#compatibility_mode_deprecation">Compatibility mode deprecation</a></li>
<li><a href="#memcached_storage">Memcached storage</a></li>
<li><a href="#scripts_response">Scripts Response</a></li>
<li><a href="#websocket_endpoint_removal">WebSocket endpoint removal</a></li>
<li><a href="#hot_rod_client_connection_pool_properties">Hot Rod client connection pool properties</a></li>
<li><a href="#server_thread_pools">Server thread pools</a></li>
</ul>
</li>
<li><a href="#persistence_changes_2">1.5.2. Persistence Changes</a>
<ul class="sectlevel4">
<li><a href="#shared_and_passivation">Shared and Passivation</a></li>
</ul>
</li>
<li><a href="#query_changes">1.5.3. Query changes</a>
<ul class="sectlevel4">
<li><a href="#affinityindexmanager">AffinityIndexManager</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#upgrading_from_9_2_to_9_3">1.6. Upgrading from 9.2 to 9.3</a>
<ul class="sectlevel3">
<li><a href="#advancedcacheloader_changes">1.6.1. AdvancedCacheLoader changes</a></li>
<li><a href="#partition_handling_configuration">1.6.2. Partition Handling Configuration</a></li>
<li><a href="#stat_changes">1.6.3. Stat Changes</a></li>
<li><a href="#event_log_changes">1.6.4. Event log changes</a></li>
<li><a href="#max_idle_expiration_changes">1.6.5. Max Idle Expiration Changes</a></li>
<li><a href="#wildfly_modules_2">1.6.6. WildFly Modules</a></li>
<li><a href="#deserialization_whitelist">1.6.7. Deserialization Whitelist</a></li>
</ul>
</li>
<li><a href="#upgrading_from_9_0_to_9_1">1.7. Upgrading from 9.0 to 9.1</a>
<ul class="sectlevel3">
<li><a href="#kubernetes_ping_changes">1.7.1. Kubernetes Ping changes</a></li>
<li><a href="#stat_changes_2">1.7.2. Stat Changes</a></li>
<li><a href="#finegrainedatomicmap_reimplemented">1.7.3. (FineGrained)AtomicMap reimplemented</a></li>
<li><a href="#remotecache_keysetentrysetvalues">1.7.4. RemoteCache keySet/entrySet/values</a></li>
<li><a href="#deltaaware_deprecated">1.7.5. DeltaAware deprecated</a></li>
<li><a href="#infinispan_query_configuration">1.7.6. Infinispan Query Configuration</a></li>
<li><a href="#store_batch_size_changes">1.7.7. Store Batch Size Changes</a></li>
<li><a href="#partition_handling_changes">1.7.8. Partition Handling changes</a></li>
</ul>
</li>
<li><a href="#upgrading_from_8_x_to_9_0">1.8. Upgrading from 8.x to 9.0</a>
<ul class="sectlevel3">
<li><a href="#default_transaction_mode_changed">1.8.1. Default transaction mode changed</a></li>
<li><a href="#removed_eagerlocking_and_eagerlockingsinglenode_configuration_settings">1.8.2. Removed eagerLocking and eagerLockingSingleNode configuration settings</a></li>
<li><a href="#removed_async_transaction_support">1.8.3. Removed async transaction support</a></li>
<li><a href="#deprecated_all_the_dummy_related_transaction_classes">1.8.4. Deprecated all the dummy related transaction classes.</a></li>
<li><a href="#clustering_configuration_changes">1.8.5. Clustering configuration changes</a></li>
<li><a href="#default_cache_changes">1.8.6. Default Cache changes</a></li>
<li><a href="#marshalling_enhancements_and_store_compatibility">1.8.7. Marshalling Enhancements and Store Compatibility</a></li>
<li><a href="#new_cloud_module_for_library_mode">1.8.8. New Cloud module for library mode</a></li>
<li><a href="#entry_retriever_is_now_removed">1.8.9. Entry Retriever is now removed</a></li>
<li><a href="#map_reduce_is_now_removed">1.8.10. Map / Reduce is now removed</a></li>
<li><a href="#spring_4_support_is_now_removed">1.8.11. Spring 4 support is now removed</a></li>
<li><a href="#function_classes_have_moved_packages">1.8.12. Function classes have moved packages</a></li>
<li><a href="#segmentcompletionlistener_interface_has_moved">1.8.13. SegmentCompletionListener interface has moved</a></li>
<li><a href="#spring_module_dependency_changes">1.8.14. Spring module dependency changes</a></li>
<li><a href="#total_order_executor_is_now_removed">1.8.15. Total order executor is now removed</a></li>
<li><a href="#hikaricp_is_now_the_default_implementation_for_jdbc_pooledconnectionfactory">1.8.16. HikariCP is now the default implementation for JDBC PooledConnectionFactory</a></li>
<li><a href="#rocksdb_in_place_of_leveldb">1.8.17. RocksDB in place of LevelDB</a></li>
<li><a href="#jdbc_mixed_and_binary_stores_removed">1.8.18. JDBC Mixed and Binary stores removed</a></li>
<li><a href="#store_annotation_introduced">1.8.19. @Store Annotation Introduced</a></li>
<li><a href="#server_authentication_changes">1.8.20. Server authentication changes</a></li>
<li><a href="#package_org_infinispan_util_concurrent_jdk8backported_has_been_removed">1.8.21. Package org.infinispan.util.concurrent.jdk8backported has been removed</a>
<ul class="sectlevel4">
<li><a href="#moved_classes">Moved classes</a></li>
<li><a href="#removed_classes">Removed classes</a></li>
</ul>
</li>
<li><a href="#store_as_binary_is_deprecated">1.8.22. Store as Binary is deprecated</a></li>
<li><a href="#datacontainer_collection_methods_are_deprecated">1.8.23. DataContainer collection methods are deprecated</a></li>
</ul>
</li>
<li><a href="#upgrading_from_8_1_to_8_2">1.9. Upgrading from 8.1 to 8.2</a>
<ul class="sectlevel3">
<li><a href="#entry_retriever_is_deprecated">1.9.1. Entry Retriever is deprecated</a></li>
<li><a href="#map_reduce_is_deprecated">1.9.2. Map / Reduce is deprecated</a></li>
</ul>
</li>
<li><a href="#upgrading_from_8_x_to_8_1">1.10. Upgrading from 8.x to 8.1</a>
<ul class="sectlevel3">
<li><a href="#packaging_changes">1.10.1. Packaging changes</a>
<ul class="sectlevel4">
<li><a href="#cdi_module_split">CDI module split</a></li>
<li><a href="#spring_module_split">Spring module split</a></li>
</ul>
</li>
<li><a href="#spring_3_support_is_deprecated">1.10.2. Spring 3 support is deprecated</a></li>
</ul>
</li>
<li><a href="#upgrading_from_7_x_to_8_0">1.11. Upgrading from 7.x to 8.0</a>
<ul class="sectlevel3">
<li><a href="#configuration_changes">1.11.1. Configuration changes</a>
<ul class="sectlevel4">
<li><a href="#removal_of_async_marshalling">Removal of Async Marshalling</a></li>
<li><a href="#reenabling_of_isolation_level_configurations_in_server">Reenabling of isolation level configurations in server</a></li>
<li><a href="#subsystem_renaming_in_server">Subsystem renaming in server</a></li>
<li><a href="#server_domain_mode">Server domain mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#upgrading_from_6_0_to_7_0">1.12. Upgrading from 6.0 to 7.0</a>
<ul class="sectlevel3">
<li><a href="#api_changes">1.12.1. API Changes</a>
<ul class="sectlevel4">
<li><a href="#cache_loader">Cache Loader</a></li>
<li><a href="#cache_writer">Cache Writer</a></li>
<li><a href="#filters">Filters</a></li>
</ul>
</li>
<li><a href="#declarative_configuration">1.12.2. Declarative configuration</a></li>
</ul>
</li>
<li><a href="#upgrading_from_5_3_to_6_0">1.13. Upgrading from 5.3 to 6.0</a>
<ul class="sectlevel3">
<li><a href="#declarative_configuration_2">1.13.1. Declarative configuration</a></li>
<li><a href="#deprecated_api_removal">1.13.2. Deprecated API removal</a></li>
</ul>
</li>
<li><a href="#upgrading_from_5_2_to_5_3">1.14. Upgrading from 5.2 to 5.3</a>
<ul class="sectlevel3">
<li><a href="#declarative_configuration_3">1.14.1. Declarative configuration</a></li>
</ul>
</li>
<li><a href="#upgrading_from_5_1_to_5_2">1.15. Upgrading from 5.1 to 5.2</a>
<ul class="sectlevel3">
<li><a href="#declarative_configuration_4">1.15.1. Declarative configuration</a></li>
<li><a href="#transaction">1.15.2. Transaction</a></li>
<li><a href="#cache_loader_and_store_configuration">1.15.3. Cache Loader and Store configuration</a></li>
<li><a href="#virtual_nodes_and_segments">1.15.4. Virtual Nodes and Segments</a></li>
</ul>
</li>
<li><a href="#upgrading_from_5_0_to_5_1">1.16. Upgrading from 5.0 to 5.1</a>
<ul class="sectlevel3">
<li><a href="#api">1.16.1. API</a></li>
<li><a href="#eviction_and_expiration">1.16.2. Eviction and Expiration</a></li>
<li><a href="#transactions_2">1.16.3. Transactions</a></li>
<li><a href="#state_transfer">1.16.4. State transfer</a></li>
<li><a href="#configuration">1.16.5. Configuration</a></li>
<li><a href="#flags_and_classloaders">1.16.6. Flags and ClassLoaders</a></li>
<li><a href="#jgroups_bind_address">1.16.7. JGroups Bind Address</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rolling_server_upgrades">2. Performing Rolling Upgrades for Infinispan Servers</a>
<ul class="sectlevel2">
<li><a href="#upgrade_target">2.1. Setting Up Target Clusters</a>
<ul class="sectlevel3">
<li><a href="#upgrade_remote_store">2.1.1. Remote Cache Stores for Rolling Upgrades</a></li>
</ul>
</li>
<li><a href="#sync_data">2.2. Synchronizing Data to Target Clusters</a></li>
</ul>
</li>
<li><a href="#patching">3. Patching Infinispan Server Installations</a>
<ul class="sectlevel2">
<li><a href="#patches-server">3.1. Infinispan Server Patches</a></li>
<li><a href="#patching_create-server">3.2. Creating Server Patches</a></li>
<li><a href="#patching_install-server">3.3. Installing Server Patches</a></li>
<li><a href="#patching_rollback-server">3.4. Rolling Back Server Patches</a></li>
</ul>
</li>
<li><a href="#offline_data_migration">4. Migrating Data Between Cache Stores</a>
<ul class="sectlevel2">
<li><a href="#store_migrator-upgrade">4.1. Cache Store Migrator</a></li>
<li><a href="#get_store_migrator-upgrade">4.2. Getting the Store Migrator</a></li>
<li><a href="#configure_store_migrator-upgrade">4.3. Configuring the Store Migrator</a>
<ul class="sectlevel3">
<li><a href="#store_migrator_properties-upgrade">4.3.1. Store Migrator Properties</a></li>
</ul>
</li>
<li><a href="#migrating_stores-upgrade">4.4. Migrating Cache Stores</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="upgrading"><a class="anchor" href="#upgrading"></a>1. Infinispan Version Details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Learn about changes in Infinispan versions before you upgrade.</p>
</div>
<div class="sect2">
<h3 id="upgrading_from_10_1_to_11_0"><a class="anchor" href="#upgrading_from_10_1_to_11_0"></a>1.1. Upgrading from 10.1 to 11.0</h3>
<div class="sect3">
<h4 id="protobuf_marshalling"><a class="anchor" href="#protobuf_marshalling"></a>1.1.1. Protobuf Marshalling</h4>
<div class="paragraph">
<p>Infinispan includes an upgraded version of the ProtoStream API that can
affect upgrade from previous Infinispan versions.</p>
</div>
<div class="paragraph">
<p>In previous versions, the ProtoStream API did not correctly nest message types
with the result that the messages were generated as top-level only. For this
reason, if you have Protobuf messages in a persistent cache store and upgrade
to Infinispan 11.0.4, then you should modify Java classes so that Protobuf
annotations are at top-level. This ensures that the nesting in your persisted
messages matches the nesting in your Java classes, otherwise data
incompatibility issues can occur.</p>
</div>
</div>
<div class="sect3">
<h4 id="hotrod_client"><a class="anchor" href="#hotrod_client"></a>1.1.2. HotRod Client</h4>
<div class="paragraph">
<p>The <code>GenericJBossMarshaller</code> is no longer automatically configured if the <code>infinispan-jboss-marshalling</code> module is on the
classpath. If jboss-marshalling is required, it&#8217;s necessary for the aforementioned jar to be on the classpath and for
the <code>org.infinispan.jboss.marshalling.commons.GenericJBossMarshaller</code> to be explicitly configured when creating the
RemoteCacheManager.</p>
</div>
</div>
<div class="sect3">
<h4 id="wildfly_modules"><a class="anchor" href="#wildfly_modules"></a>1.1.3. Wildfly modules</h4>
<div class="paragraph">
<p>The Wildfly modules are now deprecated. The <code>jgroups</code>, <code>infinispan</code> and <code>endpoint</code> extensions have been removed and
all the components are now in a single <code>org.infinispan</code> module.</p>
</div>
</div>
<div class="sect3">
<h4 id="cross_site_replication"><a class="anchor" href="#cross_site_replication"></a>1.1.4. Cross Site Replication</h4>
<div class="ulist">
<ul>
<li>
<p>The <code>org.infinispan.xsite.CustomFailurePolicy</code> interface has been deprecated and it will be replaced by
<code>org.infinispan.configuration.cache.CustomFailurePolicy</code>.</p>
</li>
<li>
<p>Cross Site Replication was disabled for local caches. They are unable to send or receive updates.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="total_order_transaction_protocol_removed"><a class="anchor" href="#total_order_transaction_protocol_removed"></a>1.1.5. Total Order transaction protocol removed</h4>
<div class="paragraph">
<p>Total Order transaction protocol was deprecated in 10.0 and now it is removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="osgi"><a class="anchor" href="#osgi"></a>1.1.6. OSGi</h4>
<div class="paragraph">
<p>OSGi support has been deprecated and will be removed in a future release.</p>
</div>
</div>
<div class="sect3">
<h4 id="search"><a class="anchor" href="#search"></a>1.1.7. Search</h4>
<div class="sect4">
<h5 id="indexing"><a class="anchor" href="#indexing"></a>Indexing</h5>
<div class="ulist">
<ul>
<li>
<p>The Infinispan Lucene Directory, the <code>InfinispanIndexManager</code> and <code>AffinityIndexManager</code> index managers, and the Infinispan Directory provider for Hibernate Search were deprecated and are now removed.</p>
</li>
<li>
<p>The <code>auto-config</code> attribute is deprecated and will be removed in a future version.</p>
</li>
<li>
<p>The index mode configuration <code><code>index()</code></code> is no longer necessary. The system will automatically choose the best
way to manage indexing once it is enabled and several previously supported values are no longer supported and will
result in a fatal configuration error when used.
The following substitutions should be done:</p>
<div class="ulist">
<ul>
<li>
<p><code>.indexing().index(Index.NONE)</code> &#8594; <code>indexing().enabled(false)</code></p>
</li>
<li>
<p>All the other enum values &#8594; <code>indexing().enabled(true)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the XML configuration it is possible to omit <code>enabled="true"</code> if the configuration contains others sub-elements. Programmatic and JSON configurations must use it.</p>
</div>
<div class="paragraph">
<p>It is forbidden to use both the <code>.indexing().enabled( )</code> and the deprecated <code>.indexing().index( )</code> configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indexed types required: starting with version 11 it is mandatory to declare all indexed types in the indexing configuration or else warnings will be logged when the undeclared type is firstly used.
This requirement exists solely for indexed caches and applies to both Java classes and protobuf types.
Please consider updating your cache configurations in order to avoid these warnings now.
Starting with next major such incomplete configurations will be considered invalid and will result in a fatal error at cache startup time.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="querying"><a class="anchor" href="#querying"></a>Querying</h5>
<div class="ulist">
<ul>
<li>
<p>The <code>SearchManager</code> has been deprecated and no longer supports Lucene and Hibernate Search native objects:</p>
<div class="ulist">
<ul>
<li>
<p><code>.getQuery()</code> methods that take a Lucene Query have been removed. The alternative methods that take an Ickle query from the <code>org.infinispan.query.Search</code> entry point should be used instead.</p>
</li>
<li>
<p><code>.buildQueryBuilderForClass()</code>, that allows to build Hibernate Search queries directly has been removed. Ickle queries should be used instead.</p>
</li>
<li>
<p>It is not possible anymore to specify multiple target entity(ies) class(es) when calling <code>.getQuery()</code>. The entity will come from the Ickle query string, so multi-entity queries are not supported anymore.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>CacheQuery</code> has been deprecated and <code>org.infinispan.query.dsl.Query</code> obtained from <code>Search.getQueryFactory()</code> should be used instead.</p>
</li>
<li>
<p>Instances of <code>org.infinispan.query.dsl.Query</code> don&#8217;t cache query results anymore and allow queries to be re-executed when
calling methods such as <code>list()</code>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="entity_mappings"><a class="anchor" href="#entity_mappings"></a>Entity Mappings</h6>
<div class="ulist">
<ul>
<li>
<p>It is now required to annotate a field that requires sorting with <code>@SortableField</code>, both for embedded and remote queries.</p>
</li>
<li>
<p>Several features have been deprecated:</p>
<div class="ulist">
<ul>
<li>
<p>Custom bridges, declared with  <code>@FieldBridge</code> and <code>@ClassBridge</code></p>
</li>
<li>
<p>Analyzer definitions, declared with <code>@AnalyzerDef</code> and <code>@NormalizerDef</code></p>
</li>
<li>
<p>Dynamic selection of analyzers based on a discriminator, declared with <code>@AnalyzerDiscriminator</code></p>
</li>
<li>
<p>Index time boosting, declared as an attribute of the <code>@Field</code> annotation</p>
</li>
<li>
<p>Definition of a default analyzer, either using the configuration property <code>hibernate.search.analyzer</code> or using the <code>@Analyzer</code> annotation</p>
</li>
<li>
<p><code>indexNullAs</code>, used as an attribute in the <code>@Field</code> declaration</p>
</li>
<li>
<p>The configuration <code>hibernate.search.index_uninverting_allowed</code>, that allows regular <code>@Field</code> to be sortable by un-inverting them at runtime</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="threadfactoryconfiguration_changes"><a class="anchor" href="#threadfactoryconfiguration_changes"></a>1.1.8. ThreadFactoryConfiguration changes</h4>
<div class="paragraph">
<p>The ThreadGroup configuration setting has been removed and only thread group name is allowed now.
This configuration was inconsistent between programmatic and declarative configuration and is now
consistent.</p>
</div>
</div>
<div class="sect3">
<h4 id="persistence"><a class="anchor" href="#persistence"></a>1.1.9. Persistence</h4>
<div class="sect4">
<h5 id="single_file_store"><a class="anchor" href="#single_file_store"></a>Single File Store</h5>
<div class="paragraph">
<p>The <code>&lt;file-store relative-to="""&gt;</code> attribute has been removed. This attribute will be ignored in pre 11.0 schemas with
only the <code>path</code> attribute being taking into account when configuring the stores location.</p>
</div>
</div>
<div class="sect4">
<h5 id="clusterloader"><a class="anchor" href="#clusterloader"></a>ClusterLoader</h5>
<div class="paragraph">
<p>The <code>ClusterLoader</code> has been deprecated and will be removed in a future release with no direct replacement.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hotrod"><a class="anchor" href="#hotrod"></a>1.1.10. HotRod</h4>
<div class="paragraph">
<p>The <code>LAZY_RETRIEVAL</code> option utilises the now deprecated <code>ClusterLoader</code> and consequently has also been deprecated. It will be removed in a
future release with no direct replacement.</p>
</div>
</div>
<div class="sect3">
<h4 id="memory_configuration_changes"><a class="anchor" href="#memory_configuration_changes"></a>1.1.11. Memory configuration changes</h4>
<div class="ulist">
<ul>
<li>
<p>The <code>BINARY</code> storage has been deprecated, and will no longer store primitives and String mixed with <code>byte[]</code>, but only <code>byte[]</code>.</p>
</li>
<li>
<p>The child elements <code>&lt;object&gt;</code>, <code>&lt;binary&gt;</code> and <code>&lt;off-heap&gt;</code> are also deprecated. The following config changes should be done:</p>
<div class="ulist">
<ul>
<li>
<p>On heap storage:</p>
<div class="literalblock">
<div class="content">
<pre>10.1</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;memory&gt;</span>
   <span class="tag">&lt;object</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/memory&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>11.0</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;memory</span> <span class="attribute-name">max-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">when-full</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Binary, on heap storage:</p>
<div class="literalblock">
<div class="content">
<pre>10.1</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cache&gt;</span>
   <span class="tag">&lt;memory&gt;</span>
      <span class="tag">&lt;binary</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EXCEPTION</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">eviction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MEMORY</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/memory&gt;</span>
<span class="tag">&lt;/cache&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>11.0</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cache&gt;</span>
   <span class="comment">&lt;!-- Or any other binary format --&gt;</span>
   <span class="tag">&lt;encoding</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="comment">&lt;!-- Sizes are human-readable, e.g.: &quot;1 GB&quot;, &quot;0.5TB&quot; --&gt;</span>
   <span class="tag">&lt;memory</span> <span class="attribute-name">max-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500 MB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">when-full</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EXCEPTION</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/cache&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Off-heap:</p>
<div class="literalblock">
<div class="content">
<pre>10.1</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cache&gt;</span>
   <span class="tag">&lt;memory&gt;</span>
      <span class="tag">&lt;off-heap</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">eviction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COUNT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/memory&gt;</span>
<span class="tag">&lt;/cache&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>11.0</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;memory</span> <span class="attribute-name">storage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OFF_HEAP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Due to the changes above, cache configurations serialized to XML or JSON (for example, when using REST) will always be in the new format.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="encoding_in_server_caches"><a class="anchor" href="#encoding_in_server_caches"></a>1.1.12. Encoding in Server Caches</h4>
<div class="ulist">
<ul>
<li>
<p>Server caches should configure the MediaType for keys and values, or else a WARN will be logged.
Usage of operations that require data conversion or indexing will not be supported for caches without encoding
configuration in a future version. These operations include search, task execution, remote filters/converter/listeners,
REST/Hot Rod reading/writing in different data formats</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="security"><a class="anchor" href="#security"></a>1.1.13. Security</h4>
<div class="sect4">
<h5 id="server_security"><a class="anchor" href="#server_security"></a>Server security</h5>
<div class="paragraph">
<p>The server is now secure by default. Use the <code>user-tool</code> to add users or remove the security realm attribute from the endpoint to allow anonymous connections.</p>
</div>
</div>
<div class="sect4">
<h5 id="cache_authorization_roles"><a class="anchor" href="#cache_authorization_roles"></a>Cache authorization roles</h5>
<div class="paragraph">
<p>If you do not explicitly specify roles when enabling cache authorization, all roles declared in the global configuration apply.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest"><a class="anchor" href="#rest"></a>1.1.14. REST</h4>
<div class="ulist">
<ul>
<li>
<p>REST API calls that have the extra URL parameter <code>?action</code> to perform operations with side effects now also
support the POST method (returning 200 when the response has content or 204 otherwise).
Support for using <code>GET</code> method on those calls will be removed in a future version.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_10_0_to_10_1_and_10_0_to_11_0"><a class="anchor" href="#upgrading_from_10_0_to_10_1_and_10_0_to_11_0"></a>1.2. Upgrading from 10.0 to 10.1 and 10.0 to 11.0</h3>
<div class="sect3">
<h4 id="maximum_idle_timeouts_with_clustered_cache_modes"><a class="anchor" href="#maximum_idle_timeouts_with_clustered_cache_modes"></a>1.2.1. Maximum Idle Timeouts with Clustered Cache Modes</h4>
<div class="paragraph">
<p>Maximum idle expiration has been changed to improve data consistency with clustered cache modes when Infinispan nodes fail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><code>Cache.get()</code> calls do not return until the touch commands complete. This
synchronous behavior increases latency of client requests and reduces
performance.</p>
</li>
<li>
<p>Maximum idle expiration, <code>max-idle</code>, does not currently work with entries
stored in off-heap memory.</p>
</li>
<li>
<p>Likewise, <code>max-idle</code> does not work if caches use cache stores as a persistence
layer.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="{../configuring/configuring.html#expiration_maxidle}">Maximum Idle Expiration</a> for complete details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_10_0_to_10_1"><a class="anchor" href="#upgrading_from_10_0_to_10_1"></a>1.3. Upgrading from 10.0 to 10.1</h3>
<div class="sect3">
<h4 id="rest_store"><a class="anchor" href="#rest_store"></a>1.3.1. REST Store</h4>
<div class="paragraph">
<p>The following configurations were removed from the REST store: <code><code>append-cache-name-to-path</code></code> and <code><code>path</code></code>.</p>
</div>
<div class="paragraph">
<p>To specify the remote server endpoint path, a single configuration <code><code>cache-name</code></code> should be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="infinispan_lucene_directory_is_deprecated"><a class="anchor" href="#infinispan_lucene_directory_is_deprecated"></a>1.3.2. Infinispan Lucene Directory is deprecated</h4>
<div class="paragraph">
<p>The Infinispan Lucene directory is now deprecated and will be removed in a future release.
Consequently, the Infinispan Directory provider for Hibernate Search will also be discontinued, with no replacement.</p>
</div>
<div class="paragraph">
<p>Both IndexManagers that rely on the Lucene Directory are also deprecated, the InfinispanIndexManager and the AffinityIndexManager.
Users are encouraged to reconfigure their indexes as non-shared, using the Near Real Time IndexManager, with file system storage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;indexing</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PRIMARY_OWNER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.indexmanager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>near-real-time<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.indexBase</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/opt/infinispan/server/data/indexes<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Queries need to be adjusted to use the <code><code>BROADCAST</code></code> runtime option.</p>
</div>
</div>
<div class="sect3">
<h4 id="security_role_mappers_and_audit_loggers"><a class="anchor" href="#security_role_mappers_and_audit_loggers"></a>1.3.3. Security role mappers and audit loggers</h4>
<div class="paragraph">
<p>The security role mapper implementations have been moved from the <code>org.infinispan.security.impl</code> package to the
<code>org.infinispan.security.mappers</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.infinispan.security.impl.CommonNameRoleMapper</code> &#8658; <code>org.infinispan.security.mappers.CommonNameRoleMapper</code></p>
</li>
<li>
<p><code>org.infinispan.security.impl.ClusterRoleMapper</code> &#8658; <code>org.infinispan.security.mappers.ClusterRoleMapper</code></p>
</li>
<li>
<p><code>org.infinispan.security.impl.IdentityRoleMapper</code> &#8658; <code>org.infinispan.security.mappers.IdentityRoleMapper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The security audit logger implementations have been moved from the <code>org.infinispan.security.impl</code> package to the
<code>org.infinispan.security.audit</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.infinispan.security.impl.LoggingAuditLogger</code> &#8658; <code>org.infinispan.security.audit.LoggingAuditLogger</code></p>
</li>
<li>
<p><code>org.infinispan.security.impl.NullAuditLogger</code> &#8658; <code>org.infinispan.security.audit.NullAuditLogger</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="memcached_protocol_server_is_deprecated"><a class="anchor" href="#memcached_protocol_server_is_deprecated"></a>1.3.4. Memcached protocol server is deprecated</h4>
<div class="paragraph">
<p>The Memcached protocol server is now deprecated and will be removed in a future release.
This is being done because Infinispan only implements the very dated text-only protocol instead of the binary protocol
which means no security (authentication / encryption), no support for some new Memcached features and no integration
with Infinispan features like single-port. If someone in the community wishes to implement the binary protocol, we
would revert the decision.</p>
</div>
</div>
<div class="sect3">
<h4 id="hot_rod_client_default_mechanism_changed_to_scram_sha_512"><a class="anchor" href="#hot_rod_client_default_mechanism_changed_to_scram_sha_512"></a>1.3.5. Hot Rod client default mechanism changed to SCRAM-SHA-512</h4>
<div class="paragraph">
<p>The default Hot Rod client authentication mechanism has been changed from <code>DIGEST-MD5</code> to <code>SCRAM-SHA-512</code>.
If you are using <code>property</code> user realms, you must make sure you are using <code>plain-text</code> storage.</p>
</div>
</div>
<div class="sect3">
<h4 id="transactions"><a class="anchor" href="#transactions"></a>1.3.6. Transactions</h4>
<div class="paragraph">
<p>The Map implementation <code>EntryVersionsMap</code> has been removed and replaced with a <code>Map&lt;Object, IncrementalEntryVersion&gt;</code>.
If the old <code>EntryVersionsMap#merge</code> logic is required, it can be replaced with <code>org.infinispan.transaction.impl.WriteSkewHelper#mergeEntryVersions</code>,
however users should not rely on this code as it could be removed in the future without notice,</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_9_4_to_10_0"><a class="anchor" href="#upgrading_from_9_4_to_10_0"></a>1.4. Upgrading from 9.4 to 10.0</h3>
<div class="sect3">
<h4 id="marshalling"><a class="anchor" href="#marshalling"></a>1.4.1. Marshalling</h4>
<div class="paragraph">
<p>The internal marshalling capabilities of Infinispan have undergone a significant refactoring in 10.0. The marshalling of
internal Infinispan objects and user objects are now truly isolated. This means that it&#8217;s now possible to configure
<a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/commons/marshall/Marshaller.html">Marshaller</a> implementations in embedded mode or on the
server, without having to handle the marshalling of Infinispan internal classes. Consequently, it&#8217;s possible to easily
change the marshaller implementation, in a similar manner to how users of the HotRod client are accustomed.</p>
</div>
<div class="paragraph">
<p>As a consequence of the above changes, the default marshaller used for marshalling user types is no longer based upon JBoss Marshalling. Instead
we now utilise the ProtoStream library to store user types in the language agnostic <a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a>
format. It is still possible to utilise the old default, <a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/jboss/marshalling/core/JBossUserMarshaller.html">JBossUserMarshaller</a>,
however it&#8217;s necessary to add the <code>org.infinispan:infinispan-jboss-marshalling</code> artifact to your application&#8217;s classpath.</p>
</div>
<div class="sect4">
<h5 id="externalizer_deprecations"><a class="anchor" href="#externalizer_deprecations"></a>Externalizer Deprecations</h5>
<div class="paragraph">
<p>The following interfaces/annotations have been deprecated as a consequence of the marshalling refactoring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/commons/marshall/Externalizer.html">Externalizer</a>,</p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/commons/marshall/AdvancedExternalizer.html">AdvancedExternalizer</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/commons/marshall/SerializeWith.html">SerializeWith</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For cluster communication any configured <a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/commons/marshall/Externalizer.html">Externalizer</a>'s
are still utilised to marshall objects, however they are ignored when persisting data to cache stores unless the
<a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/jboss/marshalling/core/JBossUserMarshaller.html">JBossUserMarshaller</a> is explicitly configured
via the global <a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/configuration/global/SerializationConfiguration.html">SerializationConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s highly recommended to migrate from the old Externalizer and JBoss marshalling approach to the new ProtoStream based
marshalling, as the interfaces listed above and the JBossUserMarshaller implementation will be removed in future versions.</p>
</div>
</div>
<div class="sect4">
<h5 id="store_migration"><a class="anchor" href="#store_migration"></a>Store Migration</h5>
<div class="paragraph">
<p>Unfortunately, the extensive marshalling changes mean that the binary format used by Infinispan stores in <code>9.4.x</code> is no
longer compatible with <code>10.0.x</code>. Therefore, it&#8217;s necessary for any existing stores to be migrated to the new format via
the StoreMigrator tool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whilst we regret that 9.4.x stores are no longer binary compatible, these extensive changes should ensure binary
compatibility across future major versions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="store_defaults"><a class="anchor" href="#store_defaults"></a>Store Defaults</h5>
<div class="paragraph">
<p>Stores now default to being segmented if the property is not configured. Some stores do not support
being segmented, which will result in a configuration exception being thrown at startup. The moving forward
position is to use segmented stores when possible to increase cache wide performance and reduce memory
requirements for various operations including state transfer.</p>
</div>
<div class="paragraph">
<p>The file based stores (SingleFileStore and SoftIndexFileStore) both support being segmented, but their
current implementation requires opening file descriptors based on how many segments there are. This may
cause issues in some configurations and users should be aware. Infinispan will print a single WARN message
when such a configuration is found.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cachecontainteradmin"><a class="anchor" href="#cachecontainteradmin"></a>1.4.2. CacheContainterAdmin</h4>
<div class="paragraph">
<p>Caches created through the CacheContainerAdmin API will now be <code>PERMANENT</code> by default. Use the <code>VOLATILE</code> flag to obtain the previous behaviour.</p>
</div>
</div>
<div class="sect3">
<h4 id="hot_rod_3_0"><a class="anchor" href="#hot_rod_3_0"></a>1.4.3. Hot Rod 3.0</h4>
<div class="paragraph">
<p>Older versions of the Hot Rod protocol treated expiration values greater than the number of milliseconds in 30 days as Unix time. Starting with Hot Rod 3.0 this adjustment no longer happens and expiration is taken literally.</p>
</div>
</div>
<div class="sect3">
<h4 id="total_order_transaction_protocol_is_deprecated"><a class="anchor" href="#total_order_transaction_protocol_is_deprecated"></a>1.4.4. Total Order transaction protocol is deprecated</h4>
<div class="paragraph">
<p>Total Order transaction protocol is going to be removed in a future release.
Use the default protocol (2PC).</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_the_infinispan_server_hotrod_workerthreads_system_property"><a class="anchor" href="#removed_the_infinispan_server_hotrod_workerthreads_system_property"></a>1.4.5. Removed the infinispan.server.hotrod.workerThreads system property</h4>
<div class="paragraph">
<p>The <code>infinispan.server.hotrod.workerThreads</code> property was introduced as a hack to work around the fact that the configuration did not expose it.
The property has been removed and endpoint worker threads must now be exclusively configured using the <code>worker-threads</code> attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_atomicmap_and_finegrainedatomicmap"><a class="anchor" href="#removed_atomicmap_and_finegrainedatomicmap"></a>1.4.6. Removed AtomicMap and FineGrainedAtomicMap</h4>
<div class="paragraph">
<p>AtomicMapLookup, AtomicMap and FineGrainedAtomicMap have been removed. Please see FunctionalMaps or Cache#Merge for
similar functionality.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_delta_and_deltaaware"><a class="anchor" href="#removed_delta_and_deltaaware"></a>1.4.7. Removed Delta and DeltaAware</h4>
<div class="paragraph">
<p>The previously deprecated Delta and DeltaAware interfaces have been removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_compatibility_mode"><a class="anchor" href="#removed_compatibility_mode"></a>1.4.8. Removed compatibility mode</h4>
<div class="paragraph">
<p>The previously deprecated Compatibility Mode has been removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_the_implicit_default_cache"><a class="anchor" href="#removed_the_implicit_default_cache"></a>1.4.9. Removed the implicit default cache</h4>
<div class="paragraph">
<p>The default cache must now be named explicitly via the <a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/configuration/global/GlobalConfigurationBuilder.html#defaultCacheName(java.lang.String)">GlobalConfigurationBuilder#defaultCacheName()</a> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_distributedexecutor"><a class="anchor" href="#removed_distributedexecutor"></a>1.4.10. Removed DistributedExecutor</h4>
<div class="paragraph">
<p>The previously deprecated DistributedExecutor is now removed. References should be updated to use ClusterExecutor.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_the_tree_module"><a class="anchor" href="#removed_the_tree_module"></a>1.4.11. Removed the Tree module</h4>
<div class="paragraph">
<p>TreeCache has been unsupported for a long time and was only intended as a quick stopgap for JBossCache users. The module has now been removed
completely.</p>
</div>
</div>
<div class="sect3">
<h4 id="the_jdbc_pooledconnectionfactory_now_utilises_agroal"><a class="anchor" href="#the_jdbc_pooledconnectionfactory_now_utilises_agroal"></a>1.4.12. The JDBC PooledConnectionFactory now utilises Agroal</h4>
<div class="paragraph">
<p>Previously the JDBC PooledConnectionFactory provided c3p0 and HikariCP based connection pools.
From 10.0 we only provide a PooledConnectionFactory based upon the <a href="https://agroal.github.io/">Agroal project</a>.
This means that it is no longer possible to utilise <code>c3p0.properties</code> and <code>hikari.properties</code> files to configure the pool,
instead an agroal compatiblet properties file can be provided.</p>
</div>
</div>
<div class="sect3">
<h4 id="xml_configuration_changes"><a class="anchor" href="#xml_configuration_changes"></a>1.4.13. XML configuration changes</h4>
<div class="paragraph">
<p>Several configuration elements and attributes that were deprecated since 9.0 have been removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;eviction&gt;</code> - replaced with <code>memory</code></p>
</li>
<li>
<p><code>&lt;versioning&gt;</code> - automatically enabled</p>
</li>
<li>
<p><code>&lt;data-container&gt;</code> - no longer customizable</p>
</li>
<li>
<p><code>deadlock-detection-spin</code> - always disabled</p>
</li>
<li>
<p><code>write-skew</code> - enabled automatically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The xsite state transfer chunk size (<code>&lt;backup&gt;&lt;state-transfer chunk-size="X"/&gt;&lt;/backup&gt;</code>) can no longer be <code>&gt;= 0</code>,
same as the regular state transfer chunk size.
Previously a value &lt;= 0 would transfer the entire cache in a single batch, which is almost always a bad idea.</p>
</div>
</div>
<div class="sect3">
<h4 id="remotecache_changes"><a class="anchor" href="#remotecache_changes"></a>1.4.14. RemoteCache Changes</h4>
<div class="sect4">
<h5 id="marshalling_changes"><a class="anchor" href="#marshalling_changes"></a>Marshalling Changes</h5>
<div class="paragraph">
<p>The default marshaller is no longer GenericJbossMarshaller. We now utilise the <a href="https://github.com/infinispan/protostream">ProtoStream</a>
library as the default. If Java Serialization is required by clients, we strongly recommend utilising the
link:<a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/commons/marshall/JavaSerializationMarshaller">JavaSerializationMarshaller</a> instead.
However if the GenericJbossMarshaller must be used, it&#8217;s necessary to add the <code>org.infinispan:infinispan-jboss-marshalling</code>
artifact to your client&#8217;s classpath and for the <code>GenericJbossMarshaller</code> to be configured as the marshaller.</p>
</div>
</div>
<div class="sect4">
<h5 id="the_getbulk_methods_have_been_removed"><a class="anchor" href="#the_getbulk_methods_have_been_removed"></a>The getBulk methods have been removed</h5>
<div class="paragraph">
<p>The getBulk method is an expensive method as it requires holding all keys in memory at once and requires a possibly very single result
to populate it. The new retrieveEntries, entrySet, keySet and values methods handle this in a much more efficient way. Therefore the
getBulk methods have been removed in favor of them.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="persistence_changes"><a class="anchor" href="#persistence_changes"></a>1.4.15. Persistence changes</h4>
<div class="ulist">
<ul>
<li>
<p>File-based cache stores (SingleFileStore, SoftIndexFileStore, RocksDBStore) filesystem layout has been normalized so that they will use the <code>GlobalStateConfiguration</code> persistent location as a default location. Additionally, all stores will now use the cache name as part of the data file/directory naming allowing multiple stores to avoid conflicts and ambiguity.</p>
</li>
<li>
<p>The CLI loader (<code>infinispan-persistence-cli</code>) has been removed.</p>
</li>
<li>
<p>The LevelDB store (<code>infinispan-cachestore-leveldb</code>) has been removed. Use the RocksDB store instead, as it is fully backwards compatible.</p>
</li>
<li>
<p>The deprecated <code>singleton</code> store configuration option and the wrapper class <code>SingletonCacheWriter</code> have been removed.</p>
<div class="paragraph">
<p>Using <code>shared=true</code> is enough, as only the primary owner of each key will write to a shared store.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="clientserver_changes"><a class="anchor" href="#clientserver_changes"></a>1.4.16. Client/Server changes</h4>
<div class="ulist">
<ul>
<li>
<p>The Hot Rod client and server only support protocol versions 2.0 and higher. Support for Hot Rod versions 1.0 to 1.3 has been dropped.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="skip_listener_notification_flag"><a class="anchor" href="#skip_listener_notification_flag"></a>1.4.17. SKIP_LISTENER_NOTIFICATION flag</h4>
<div class="paragraph">
<p><code>SKIP_LISTENER_NOTIFICATION</code> notification flag has been added in the hotrod client.
This flag only works when the client and the server version is 9.4.15 or higher.
Spring Session integration uses this flag when a session id has changed.
If you are using Spring Session with Infinispan 9.4, consider upgrading the client and the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="performasync_header_removed_from_rest"><a class="anchor" href="#performasync_header_removed_from_rest"></a>1.4.18. performAsync header removed from REST</h4>
<div class="paragraph">
<p>The <code>performAsync</code> header was removed from the REST server. Clients that want to perform async operations with
the REST server should manage the request and response on their side to avoid blocking.</p>
</div>
</div>
<div class="sect3">
<h4 id="rest_status_code_change"><a class="anchor" href="#rest_status_code_change"></a>1.4.19. REST status code change</h4>
<div class="paragraph">
<p>REST operations that don&#8217;t return resources and are used with <code>PUT</code>, <code>POST</code> and <code>DELETE</code> methods now return status <code>204</code> (No content) instead of <code>200</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="default_jgroups_stacks_in_the_xml_configuration"><a class="anchor" href="#default_jgroups_stacks_in_the_xml_configuration"></a>1.4.20. Default JGroups stacks in the XML configuration</h4>
<div class="paragraph">
<p>With the introduction of inline XML JGroups stacks in the configuration, two default stacks are always enabled: <code>udp</code> and <code>tcp</code>.
If you are declaring your own stacks with the same names, an exception reporting the conflict will be thrown. Simply rename
your own configurations to avoid the conflict.</p>
</div>
</div>
<div class="sect3">
<h4 id="jgroups_s3_ping_replaced_with_native_s3_ping"><a class="anchor" href="#jgroups_s3_ping_replaced_with_native_s3_ping"></a>1.4.21. JGroups S3_PING replaced with NATIVE_S3_PING</h4>
<div class="paragraph">
<p>Because of changes in AWS&#8217;s access policy regarding signatures, S3_PING will not work in newer regions and will stop working in older regions too.
For this reason, you should migrate to using NATIVE_S3_PING instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache_and_cache_manager_listeners_can_now_be_configured_to_be_non_blocking"><a class="anchor" href="#cache_and_cache_manager_listeners_can_now_be_configured_to_be_non_blocking"></a>1.4.22. Cache and Cache Manager Listeners can now be configured to be non blocking</h4>
<div class="paragraph">
<p>Listeners in the past that were sync, always ran in the thread that caused the event. We now allow a Listener method to
be non-blocking in that it will still fire in the original thread, under the assumption that it will return immediately.
Please read the Listener Javadoc for information and examples on this.</p>
</div>
</div>
<div class="sect3">
<h4 id="distributed_streams_operations_no_longer_support_null_values"><a class="anchor" href="#distributed_streams_operations_no_longer_support_null_values"></a>1.4.23. Distributed Streams operations no longer support null values</h4>
<div class="paragraph">
<p>Distributed Streams has parts rewritten to utilize non blocking reactive streams based operations. As such null values
are not supported as values from operations as per the reactive streams spec. Please utilize other means to denote
a null value.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_the_infinispan_cloud_module"><a class="anchor" href="#removed_the_infinispan_cloud_module"></a>1.4.24. Removed the infinispan-cloud module</h4>
<div class="paragraph">
<p>The infinispan-cloud module has been removed and the <code>kubernetes</code>, <code>ec2</code>, <code>google</code> and <code>azure</code> default configurations have been included in <code>infinispan-core</code> and can be
referenced as default named JGroups configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_experimental_flag_guaranteed_delivery"><a class="anchor" href="#removed_experimental_flag_guaranteed_delivery"></a>1.4.25. Removed experimental flag GUARANTEED_DELIVERY</h4>
<div class="paragraph">
<p>Almost as soon as GUARANTEED_DELIVERY was added, UNICAST3 and NAKACK2.resend_last_seqno removed the need for it.
It was always documented as experimental, so we removed it without deprecation and we also removed the RSVP protocol
from the default JGroups stacks.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache_health"><a class="anchor" href="#cache_health"></a>1.4.26. Cache Health</h4>
<div class="paragraph">
<p>The possible statuses of the cache health are now HEALTHY, HEALTHY_REBALANCING and DEGRADED to better
reflect the fact that <code>rebalancing</code> doesn&#8217;t mean a cluster is unhealthy.</p>
</div>
</div>
<div class="sect3">
<h4 id="multi_tenancy"><a class="anchor" href="#multi_tenancy"></a>1.4.27. Multi-tenancy</h4>
<div class="paragraph">
<p>When using multi-tenancy in the WildFly based server, it&#8217;s necessary to specify the <code>content-path</code> for each of the REST connectors, to match the <code>prefix</code> element under <code>multi-tenancy\rest\prefix</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="offheap_automatic_resizing"><a class="anchor" href="#offheap_automatic_resizing"></a>1.4.28. OffHeap Automatic Resizing</h4>
<div class="paragraph">
<p>Off Heap memory containers now will dynamically resize based on number of entries in the container. Due to this the
address count configuration value  is now deprecated for APIs and has been removed from the xml parser.</p>
</div>
</div>
<div class="sect3">
<h4 id="deprecated_methods_from_datacontainer_removed"><a class="anchor" href="#deprecated_methods_from_datacontainer_removed"></a>1.4.29. Deprecated methods from DataContainer removed</h4>
<div class="paragraph">
<p>The deprecated methods keySet, values, entrySet and executeTask has been removed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_9_3_to_9_4"><a class="anchor" href="#upgrading_from_9_3_to_9_4"></a>1.5. Upgrading from 9.3 to 9.4</h3>
<div class="sect3">
<h4 id="clientserver_changes_2"><a class="anchor" href="#clientserver_changes_2"></a>1.5.1. Client/Server changes</h4>
<div class="sect4">
<h5 id="compatibility_mode_deprecation"><a class="anchor" href="#compatibility_mode_deprecation"></a>Compatibility mode deprecation</h5>
<div class="paragraph">
<p>Compatibility mode has been deprecated and will be removed in the next Infinispan version.</p>
</div>
<div class="paragraph">
<p>To use a cache from multiple endpoints, it is recommended to store data in binary format and to configure the MediaType for keys and values.</p>
</div>
<div class="paragraph">
<p>If storing data as unmarshalled objects is still desired, the equivalent of compatibility mode is to configure keys and values to store object content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;encoding&gt;</span>
   <span class="tag">&lt;key</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-java-object</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;value</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-java-object</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/encoding&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="memcached_storage"><a class="anchor" href="#memcached_storage"></a>Memcached storage</h5>
<div class="paragraph">
<p>For better interoperability between endpoints, the Memcached server no longer stores keys as <code>java.lang.String</code>, but as UTF-8 <code>byte[]</code>.</p>
</div>
<div class="paragraph">
<p>If using memcached, it&#8217;s recommended to run a rolling upgrade from 9.3 to store data in the new format, or reload the data in the cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="scripts_response"><a class="anchor" href="#scripts_response"></a>Scripts Response</h5>
<div class="paragraph">
<p>Distributed scripts with text-based data type no longer return <code>null</code> when the result from each server is null. The response is now a JSON array with each individual result, e.g. <code>"[null, null]"</code></p>
</div>
</div>
<div class="sect4">
<h5 id="websocket_endpoint_removal"><a class="anchor" href="#websocket_endpoint_removal"></a>WebSocket endpoint removal</h5>
<div class="paragraph">
<p>The WebSocket endpoint has been unmaintained for several years. It has been removed.</p>
</div>
</div>
<div class="sect4">
<h5 id="hot_rod_client_connection_pool_properties"><a class="anchor" href="#hot_rod_client_connection_pool_properties"></a>Hot Rod client connection pool properties</h5>
<div class="paragraph">
<p>Since the Hot Rod client was overhauled in 9.2, the way the connection pool configuration is handled has changed.
Infinispan 9.4 introduces a new naming scheme for the connection pool properties which deprecates the old <em>commons-pool</em>
names. For a complete reference of the available configuration options for the properties file please refer to
<a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html#package.description">remote client configuration</a> javadoc.</p>
</div>
</div>
<div class="sect4">
<h5 id="server_thread_pools"><a class="anchor" href="#server_thread_pools"></a>Server thread pools</h5>
<div class="paragraph">
<p>The threads that handle the child Netty event loops have been renamed from *-ServerWorker to *-ServerIO</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="persistence_changes_2"><a class="anchor" href="#persistence_changes_2"></a>1.5.2. Persistence Changes</h4>
<div class="sect4">
<h5 id="shared_and_passivation"><a class="anchor" href="#shared_and_passivation"></a>Shared and Passivation</h5>
<div class="paragraph">
<p>A store cannot be configured as both shared and having passivation enabled.
Doing so can cause data inconsistencies as there is no way to synchronize
data between all the various nodes. As such this configuration will now
cause a startup exception. Please update your configuration as appropriate.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="query_changes"><a class="anchor" href="#query_changes"></a>1.5.3. Query changes</h4>
<div class="sect4">
<h5 id="affinityindexmanager"><a class="anchor" href="#affinityindexmanager"></a>AffinityIndexManager</h5>
<div class="paragraph">
<p>The default number of shards is down to <code>4</code>, it was previously equals to the number of segments in the cache.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_9_2_to_9_3"><a class="anchor" href="#upgrading_from_9_2_to_9_3"></a>1.6. Upgrading from 9.2 to 9.3</h3>
<div class="sect3">
<h4 id="advancedcacheloader_changes"><a class="anchor" href="#advancedcacheloader_changes"></a>1.6.1. AdvancedCacheLoader changes</h4>
<div class="paragraph">
<p>The AdvancedCacheLoader SPI has been enhanced to provide an alternative method to process and instead allows reactive streams based publishKeys and publishEntries methods which provide benefits in performance, threading and ease of use. Note this change will only affect you if you wish take advantage of it in any custom CacheLoaders you may have implemented.</p>
</div>
</div>
<div class="sect3">
<h4 id="partition_handling_configuration"><a class="anchor" href="#partition_handling_configuration"></a>1.6.2. Partition Handling Configuration</h4>
<div class="paragraph">
<p>In 9.3 the default MergePolicy is now MergePolicy.NONE, opposed to MergePolicy.PREFERRED_ALWAYS.</p>
</div>
</div>
<div class="sect3">
<h4 id="stat_changes"><a class="anchor" href="#stat_changes"></a>1.6.3. Stat Changes</h4>
<div class="paragraph">
<p>We have reverted the stat changes introduced in 9.1, so average values for read, write and removals are once again returned
as milliseconds.</p>
</div>
</div>
<div class="sect3">
<h4 id="event_log_changes"><a class="anchor" href="#event_log_changes"></a>1.6.4. Event log changes</h4>
<div class="paragraph">
<p>Several new event log messages have been added, and one message has been removed (ISPN100013).</p>
</div>
</div>
<div class="sect3">
<h4 id="max_idle_expiration_changes"><a class="anchor" href="#max_idle_expiration_changes"></a>1.6.5. Max Idle Expiration Changes</h4>
<div class="paragraph">
<p>The max idle entry expiration information is sent between owners in the cluster. However when an entry expires via max idle on a given node, this was not replicated (only removing it locally). Max idle has been enhanced to now expire an entry across the entire cluster, instead of per node. This includes ensuring that max idle expiration is applied across all owners (meaning if another node has accessed the entry within the given time it will prevent that entry from expiring on other nodes that didn&#8217;t have an access).</p>
</div>
<div class="paragraph">
<p>Max idle in a transactional clustered cache does not remove expired entries on access (although it will not be returned). These entries are only removed via the expiration reaper.</p>
</div>
<div class="paragraph">
<p>Iteration in a clustered cache will still show entries that are expired via maxIdle to ensure good performance, but could be removed at any point due to expiration reaper.</p>
</div>
</div>
<div class="sect3">
<h4 id="wildfly_modules_2"><a class="anchor" href="#wildfly_modules_2"></a>1.6.6. WildFly Modules</h4>
<div class="paragraph">
<p>The Infinispan WildFly modules are now located in the <code>system/add-ons/ispn</code> dir as per the
<a href="https://developer.jboss.org/wiki%20/LayeredDistributionsAndModulePathOrganization">WildFly module conventions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deserialization_whitelist"><a class="anchor" href="#deserialization_whitelist"></a>1.6.7. Deserialization Whitelist</h4>
<div class="paragraph">
<p>Deserialization of content sent by clients to the server are no longer allowed by default.
This applies to JSON, XML, and marshalled byte[] that, depending on the cache configuration, will cause the server
to convert it to Java Objects either to store it or to perform any operation that cannot be done on a byte[] directly.</p>
</div>
<div class="paragraph">
<p>The deserialization needs to be enabled using system properties, ether by class name or regular expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>// Comma separated list of fully qualified class names
-Dinfinispan.deserialization.whitelist.classes=java.time.Instant,com.myclass.Entity

// Regex expression
-Dinfinispan.deserialization.whitelist.regexps=.*</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_9_0_to_9_1"><a class="anchor" href="#upgrading_from_9_0_to_9_1"></a>1.7. Upgrading from 9.0 to 9.1</h3>
<div class="sect3">
<h4 id="kubernetes_ping_changes"><a class="anchor" href="#kubernetes_ping_changes"></a>1.7.1. Kubernetes Ping changes</h4>
<div class="paragraph">
<p>The latest version of Kubernetes Ping uses unified environmental variables for both Kubernetes and OpenShift.
Some of them were shortened for example <code>OPENSHIFT_KUBE_PING_NAMESPACE</code> was changed to <code>KUBERNETES_NAMESPACE</code>.
Please refer to <a href="https://github.com/jgroups-extras/jgroups-kubernetes/blob/master/README.adoc">Kubernetes Ping documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="stat_changes_2"><a class="anchor" href="#stat_changes_2"></a>1.7.2. Stat Changes</h4>
<div class="paragraph">
<p>Average values for read, write and removals are now returned in Nanoseconds, opposed to Milliseconds.</p>
</div>
</div>
<div class="sect3">
<h4 id="finegrainedatomicmap_reimplemented"><a class="anchor" href="#finegrainedatomicmap_reimplemented"></a>1.7.3. (FineGrained)AtomicMap reimplemented</h4>
<div class="paragraph">
<p>Infinispan now contains a new implementation of both <code>AtomicMap</code> and <code>FineGrainedAtomicMap</code>, but the semantics has been preserved. The new implementation does not use <code>DeltaAware</code> interface but the Functional API instead.</p>
</div>
<div class="paragraph">
<p>There are no changes needed for <code>AtomicMap</code>, but it now supports non-transactional use case as well.</p>
</div>
<div class="paragraph">
<p><code>FineGrainedAtomicMap</code> now uses the Grouping API and therefore you need to enable groups in configuration. Also it holds entries as regular cache entries, plus one cache entry for cached key set (the map itself). Therefore the cache size or iteration/streaming results may differ. Note that fine grained atomic maps are still supported on transactional caches only.</p>
</div>
</div>
<div class="sect3">
<h4 id="remotecache_keysetentrysetvalues"><a class="anchor" href="#remotecache_keysetentrysetvalues"></a>1.7.4. RemoteCache keySet/entrySet/values</h4>
<div class="paragraph">
<p>RemoteCache now implements all of the collection backed methods from <code>Map</code> interface.
Previously <code>keySet</code> was implemented, however it was a deep copy. This has now changed
and it is a backing set. That is that the set retrieves the updated values on each
invocation or updates to the backing remote cache for writes. The entrySet and values
methods are also now supported as backing variants as well.</p>
</div>
<div class="paragraph">
<p>If you wish to have a copy like was provided before it is recommended to copy the
contents into a in memory local set such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span>&lt;K&gt; keysCopy = remoteCache.keySet().stream().collect(Collectors.toSet());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deltaaware_deprecated"><a class="anchor" href="#deltaaware_deprecated"></a>1.7.5. DeltaAware deprecated</h4>
<div class="paragraph">
<p>Interfaces <code>DeltaAware</code>, <code>Delta</code> and <code>CopyableDeltaAware</code> have been deprecated. Method <code>AdvancedCache.applyDelta()</code> has been deprecated and the implementation does not allow custom set of locked keys. <code>ApplyDeltaCommand</code> and its uses in interceptor stack are deprecated.</p>
</div>
<div class="paragraph">
<p>Any partial updates to an entry should be replaced using the Functional API.</p>
</div>
</div>
<div class="sect3">
<h4 id="infinispan_query_configuration"><a class="anchor" href="#infinispan_query_configuration"></a>1.7.6. Infinispan Query Configuration</h4>
<div class="paragraph">
<p>The configuration property <code>directory_provider</code> now accepts a new value <code>local-heap</code>.
This value replaces the now deprecated <code>ram</code>, and as its predecessor will cause the index to be stored in a <code>org.apache.lucene.store.RAMDirectory</code>.</p>
</div>
<div class="paragraph">
<p>The configuration value <code>ram</code> is still accepted and will have the same effect, but failing to replace <code>ram</code> with <code>local-heap</code> will cause a warning to be logged.
We suggest to perform this replacement, as the <code>ram</code> value will no longer be recognised by Infinispan in a future version.</p>
</div>
<div class="paragraph">
<p>This change was made as the team believes the <code>local-heap</code> name better expresses the storage model, especially as this storage method will not allow real-time replication of the index across multiple nodes.
This index storage option is mostly useful for single node integration testing of the query functionality.</p>
</div>
</div>
<div class="sect3">
<h4 id="store_batch_size_changes"><a class="anchor" href="#store_batch_size_changes"></a>1.7.7. Store Batch Size Changes</h4>
<div class="paragraph">
<p>TableManipulation::batchSize and JpaStoreConfiguration::batchSize have been deprecated and replaced by the higher level AbstractStoreConfiguration::maxBatchSize.</p>
</div>
</div>
<div class="sect3">
<h4 id="partition_handling_changes"><a class="anchor" href="#partition_handling_changes"></a>1.7.8. Partition Handling changes</h4>
<div class="paragraph">
<p>In Infinispan 9.1 partition handling has been improved to allow for automatic conflict resolution on partition merges. Consequently,
PartitionHandlingConfiguration::enabled has been deprecated in favour of PartitionHandlingConfiguration::whenSplit.
Configuring whenSplit to the DENY_READ_WRITES strategy is equivalent to setting enabled to true, whilst specifying
ALLOW_READ_WRITES is equivalent to disabling partition handling (default).</p>
</div>
<div class="paragraph">
<p>Furthermore, during a partition merge with ALLOW_READ_WRITES, the default EntryMergePolicy is
MergePolicies.PREFERRED_ALWAYS which provides a deterministic way of tie-breaking CacheEntry conflicts.
If you require the old behaviour, simply set the merge-policy to null.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_8_x_to_9_0"><a class="anchor" href="#upgrading_from_8_x_to_9_0"></a>1.8. Upgrading from 8.x to 9.0</h3>
<div class="sect3">
<h4 id="default_transaction_mode_changed"><a class="anchor" href="#default_transaction_mode_changed"></a>1.8.1. Default transaction mode changed</h4>
<div class="paragraph">
<p>The default configuration for transactional caches changed from <code>READ_COMMITTED</code> and <code>OPTIMISTIC</code> locking to <code>REPEATABLE_READ</code> and <code>OPTIMISTIC</code> locking with <code>write-skew</code> enabled.</p>
</div>
<div class="paragraph">
<p>Also, using the <code>REPEATABLE_READ</code> isolation level and <code>OPTIMISTIC</code> locking without <code>write-skew</code> enabled is no longer allowed.
To help with the upgrade, <code>write-skew</code> will be automatically enabled in this case.</p>
</div>
<div class="paragraph">
<p>The following configuration has been deprecated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>write-skew</code>: as said, it is automatically enabled.</p>
</li>
<li>
<p><code>&lt;versioning&gt;</code> and its attributes. It is automatically enabled and configured when needed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="removed_eagerlocking_and_eagerlockingsinglenode_configuration_settings"><a class="anchor" href="#removed_eagerlocking_and_eagerlockingsinglenode_configuration_settings"></a>1.8.2. Removed eagerLocking and eagerLockingSingleNode configuration settings</h4>
<div class="paragraph">
<p>Both were deprecated since version 5.1.
<code>eagerLocking(true)</code> can be replaced with <code>lockingMode(LockingMode.PESSIMISTIC)</code>,
and <code>eagerLockingSingleNode()</code> does not need a replacement because it was a no-op.</p>
</div>
</div>
<div class="sect3">
<h4 id="removed_async_transaction_support"><a class="anchor" href="#removed_async_transaction_support"></a>1.8.3. Removed async transaction support</h4>
<div class="paragraph">
<p>Asynchronous mode is no longer supported in transactional caches and it will automatically use the synchronous cache mode.
In addition, the second phase of a transaction commit is done synchronously.
The following methods (and related) are deprecated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TransactionConfigurationBuilder.syncCommitPhase(boolean)</code></p>
</li>
<li>
<p><code>TransactionConfigurationBuilder.syncRollbackPhase(boolean)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deprecated_all_the_dummy_related_transaction_classes"><a class="anchor" href="#deprecated_all_the_dummy_related_transaction_classes"></a>1.8.4. Deprecated all the dummy related transaction classes.</h4>
<div class="paragraph">
<p>The following classes have been deprecated and they will be removed in the future:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DummyBaseTransactionManager</code>: replaced by <code>EmbeddedBasedTransactionManager</code>;</p>
</li>
<li>
<p><code>DummyNoXaXid</code> and <code>DummyXid</code>: replaced by <code>EmbeddedXid</code>;</p>
</li>
<li>
<p><code>DummyTransaction</code>: replaced by <code>EmbeddedTransaction</code>;</p>
</li>
<li>
<p><code>DummyTransactionManager</code>: replaced by <code>EmbeddedTransactionManager</code>;</p>
</li>
<li>
<p><code>DummyTransactionManagerLookup</code> and <code>RecoveryDummyTransactionManagerLookup</code>: replaced by <code>EmbeddedTransactionManagerLookup</code>;</p>
</li>
<li>
<p><code>DummyUserTransaction</code>: replaced by <code>EmbeddedUserTransaction</code>;</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="clustering_configuration_changes"><a class="anchor" href="#clustering_configuration_changes"></a>1.8.5. Clustering configuration changes</h4>
<div class="paragraph">
<p>The <code>mode</code> attribute in the XML declaration of clustered caches is no longer mandatory. It defaults to SYNC.</p>
</div>
</div>
<div class="sect3">
<h4 id="default_cache_changes"><a class="anchor" href="#default_cache_changes"></a>1.8.6. Default Cache changes</h4>
<div class="paragraph">
<p>Up to Infinispan 8.x, the default cache always implicitly existed, even if not declared in the XML configuration.
Additionally, the default cache configuration affected all other cache configurations, acting as some kind of base template.
Since 9.0, the default cache only exists if it has been explicitly configured. Additionally, even if it has been specified,
it will never act as base template for other caches.</p>
</div>
</div>
<div class="sect3">
<h4 id="marshalling_enhancements_and_store_compatibility"><a class="anchor" href="#marshalling_enhancements_and_store_compatibility"></a>1.8.7. Marshalling Enhancements and Store Compatibility</h4>
<div class="paragraph">
<p>Internally Infinispan 9.x has introduced many improvements to its marshalling codebase in order to improve performance
and allow for greater flexibility. Consequently, data marshalled and persisted by Infinispan 8.x is no longer compatible with Infinispan 9.0.
To aid you in migrating your existing stores to 9.0, we have provided a Store Migrator, however at present this only allows the migration of JDBC stores.</p>
</div>
</div>
<div class="sect3">
<h4 id="new_cloud_module_for_library_mode"><a class="anchor" href="#new_cloud_module_for_library_mode"></a>1.8.8. New Cloud module for library mode</h4>
<div class="paragraph">
<p>In Infinispan 8.x, cloud related configuration were added to <code>infinispan-core</code> module. Since 9.0 they were moved to <code>infinispan-cloud</code> module.</p>
</div>
</div>
<div class="sect3">
<h4 id="entry_retriever_is_now_removed"><a class="anchor" href="#entry_retriever_is_now_removed"></a>1.8.9. Entry Retriever is now removed</h4>
<div class="paragraph">
<p>The entry retriever feature has been removed.  Please update to use the new Streams feature detailed in the User Guide.
The <code>org.infinispan.filter.CacheFilters</code> class can be used to convert <code>KeyValueFilter</code> and <code>Converter</code> instances
into proper Stream operations that are able to be marshalled.</p>
</div>
</div>
<div class="sect3">
<h4 id="map_reduce_is_now_removed"><a class="anchor" href="#map_reduce_is_now_removed"></a>1.8.10. Map / Reduce is now removed</h4>
<div class="paragraph">
<p>Map reduce has been removed in favor of the new Streams feature which should provide more features and performance.
There are no bridge classes to convert to the new streams and all references must be rewritten.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring_4_support_is_now_removed"><a class="anchor" href="#spring_4_support_is_now_removed"></a>1.8.11. Spring 4 support is now removed</h4>
<div class="paragraph">
<p>Spring 4 is no longer supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="function_classes_have_moved_packages"><a class="anchor" href="#function_classes_have_moved_packages"></a>1.8.12. Function classes have moved packages</h4>
<div class="paragraph">
<p>The class <code>SerializableSupplier</code> has moved from the <code>org.infinispan.stream</code>
package to the <code>org.infinispan.util.function</code> package.</p>
</div>
<div class="paragraph">
<p>The class <code>CloseableSupplier</code> has moved from the <code>org.infinispan.util</code>
package to the <code>org.infinispan.util.function</code> package.</p>
</div>
<div class="paragraph">
<p>The classes <code>TriConsumer</code>, <code>CloseableSupplier</code>, <code>SerializableRunnable</code>,
<code>SerializableFunction</code> &amp; <code>SerializableCallable</code> have all been moved from
the <code>org.infinispan.util</code> package to the <code>org.infinispan.util.function</code> package.</p>
</div>
</div>
<div class="sect3">
<h4 id="segmentcompletionlistener_interface_has_moved"><a class="anchor" href="#segmentcompletionlistener_interface_has_moved"></a>1.8.13. SegmentCompletionListener interface has moved</h4>
<div class="paragraph">
<p>The interface <code>SegmentCompletionListener</code> has moved from the interface
<code>org.infinispan.CacheStream</code> to the new <code>org.infinispan.BaseCacheStream</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring_module_dependency_changes"><a class="anchor" href="#spring_module_dependency_changes"></a>1.8.14. Spring module dependency changes</h4>
<div class="paragraph">
<p>All Infinispan, Spring and Logger dependencies are now in the <code>provided</code> scope. One can decide whether to use small jars or uber jars but they need to be added to the classpath of the application.
It also gives one freedom in choosing Spring (or Spring Boot) version.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>infinispan-embedded<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>infinispan-spring5-embedded<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>spring-context<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.springframework.session<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>spring-session<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally there is no Logger implementation specified (since this may vary depending on use case).</p>
</div>
</div>
<div class="sect3">
<h4 id="total_order_executor_is_now_removed"><a class="anchor" href="#total_order_executor_is_now_removed"></a>1.8.15. Total order executor is now removed</h4>
<div class="paragraph">
<p>The total order protocol now uses the <code>remote-command-executor</code>. The attribute <code>total-order-executor</code> in <code>&lt;container&gt;</code> tag is removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="hikaricp_is_now_the_default_implementation_for_jdbc_pooledconnectionfactory"><a class="anchor" href="#hikaricp_is_now_the_default_implementation_for_jdbc_pooledconnectionfactory"></a>1.8.16. HikariCP is now the default implementation for JDBC PooledConnectionFactory</h4>
<div class="paragraph">
<p><a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a> offers superior performance to c3p0 and is now the default implementation.
Additional properties for HikariCP can be provided by placing a <code>hikari.properties</code> file on the classpath or by specifying
the path to the file via <code>PooledConnectionFactoryConfiguration.propertyFile</code> or <code>properties-file</code> in the connection pool&#8217;s
xml config. N.B. a properties file specified explicitly in the configuration is loaded instead of the <code>hikari.properties</code>
file on the class path and Connection pool characteristics which are explicitly set in PooledConnectionFactoryConfiguration
always override the values loaded from a properties file.</p>
</div>
<div class="paragraph">
<p>Support for c3p0 has been deprecated and will be removed in a future release. Users can force c3p0 to be utilised as before
by providing the system property <code>-Dinfinispan.jdbc.c3p0.force=true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="rocksdb_in_place_of_leveldb"><a class="anchor" href="#rocksdb_in_place_of_leveldb"></a>1.8.17. RocksDB in place of LevelDB</h4>
<div class="paragraph">
<p>The LevelDB cache store was replaced with a <a href="http//rocksdb.org">RocksDB</a>. RocksDB is a fork of LevelDB which provides
superior performance in high concurrency scenarios. The new cache store can parse old LevelDB configurations but will always use
the RocksDB implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc_mixed_and_binary_stores_removed"><a class="anchor" href="#jdbc_mixed_and_binary_stores_removed"></a>1.8.18. JDBC Mixed and Binary stores removed</h4>
<div class="paragraph">
<p>The JDBC Mixed and Binary stores have been removed due to the poor performance associated with storing entries in buckets.
Storing entries in buckets is non-optimal as each read/write to the store requires an existing bucket for a given hash to be retrieved,
deserialised, updated, serialised and then re-inserted back into the db.  If you were previously using one of the removed
stores, we have provided a migrator tool to assist in migrating data from an existing binary table to a JDBC string based
store.</p>
</div>
</div>
<div class="sect3">
<h4 id="store_annotation_introduced"><a class="anchor" href="#store_annotation_introduced"></a>1.8.19. @Store Annotation Introduced</h4>
<div class="paragraph">
<p>A new annotation, <code>@Store</code>, has been added for persistence stores. This allows a store&#8217;s properties to be
explicitly defined and validated against the provided store configuration.  Existing stores should be updated to use this
annotation and the store&#8217;s configuration class should also declare the <code>@ConfigurationFor</code> annotation.  If neither of these
annotations are present on the store or configuration class, then a your store will continue to function as before, albeit
with a warning that additional store validation cannot be completed.</p>
</div>
</div>
<div class="sect3">
<h4 id="server_authentication_changes"><a class="anchor" href="#server_authentication_changes"></a>1.8.20. Server authentication changes</h4>
<div class="paragraph">
<p>The no-anonymous policy is now automatically enabled for Hot Rod authentication unless explicitly specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="package_org_infinispan_util_concurrent_jdk8backported_has_been_removed"><a class="anchor" href="#package_org_infinispan_util_concurrent_jdk8backported_has_been_removed"></a>1.8.21. Package org.infinispan.util.concurrent.jdk8backported has been removed</h4>
<div class="sect4">
<h5 id="moved_classes"><a class="anchor" href="#moved_classes"></a>Moved classes</h5>
<div class="paragraph">
<p>Classes regarding EntrySizeCalculator have now been moved down to the org.infinispan.util package.</p>
</div>
</div>
<div class="sect4">
<h5 id="removed_classes"><a class="anchor" href="#removed_classes"></a>Removed classes</h5>
<div class="paragraph">
<p>The *ConcurrentHashMapV8 classes and their supporting classes have all been removed. The
CollectionFactory#makeBoundedConcurrentMap method should be used if you desire to have a
bounded ConcurrentMap.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="store_as_binary_is_deprecated"><a class="anchor" href="#store_as_binary_is_deprecated"></a>1.8.22. Store as Binary is deprecated</h4>
<div class="paragraph">
<p>Store as Binary configuration is now deprecated and will be removed in a future release. This is replaced by
the new memory configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="datacontainer_collection_methods_are_deprecated"><a class="anchor" href="#datacontainer_collection_methods_are_deprecated"></a>1.8.23. DataContainer collection methods are deprecated</h4>
<div class="paragraph">
<p>The keySet, entrySet and values methods on DataContainer have been deprecated. These behavior of these methods
are very inconsistent and will be removed later. It is recommended to update references to use iterator or
iteratorIncludingExpired methods intead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_8_1_to_8_2"><a class="anchor" href="#upgrading_from_8_1_to_8_2"></a>1.9. Upgrading from 8.1 to 8.2</h3>
<div class="sect3">
<h4 id="entry_retriever_is_deprecated"><a class="anchor" href="#entry_retriever_is_deprecated"></a>1.9.1. Entry Retriever is deprecated</h4>
<div class="paragraph">
<p>Entry Retriever is now deprecated and will be removed in Infinispan 9.  This is replaced by the new Streams feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="map_reduce_is_deprecated"><a class="anchor" href="#map_reduce_is_deprecated"></a>1.9.2. Map / Reduce is deprecated</h4>
<div class="paragraph">
<p>Map reduce is now deprecated and will be removed in Infinispan 9.  This is replaced by the new Streams feature.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_8_x_to_8_1"><a class="anchor" href="#upgrading_from_8_x_to_8_1"></a>1.10. Upgrading from 8.x to 8.1</h3>
<div class="sect3">
<h4 id="packaging_changes"><a class="anchor" href="#packaging_changes"></a>1.10.1. Packaging changes</h4>
<div class="sect4">
<h5 id="cdi_module_split"><a class="anchor" href="#cdi_module_split"></a>CDI module split</h5>
<div class="paragraph">
<p>CDI module (GroupId:ArtifactId <code>org.infinispan:infinispan-cdi</code>) has been split into <code>org.infinispan:infinispan-cdi-embedded</code> and <code>org.infinispan:infinispan-cdi-remote</code>. Please make sure that you use proper artifact.</p>
</div>
</div>
<div class="sect4">
<h5 id="spring_module_split"><a class="anchor" href="#spring_module_split"></a>Spring module split</h5>
<div class="paragraph">
<p>Spring module (GroupId:ArtifactId <code>org.infinispan:infinispan-spring5</code>) has been split into <code>org.infinispan:infinispan-spring5-embedded</code> and <code>org.infinispan:infinispan-spring5-remote</code>. Please make sure that you use proper artifact.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spring_3_support_is_deprecated"><a class="anchor" href="#spring_3_support_is_deprecated"></a>1.10.2. Spring 3 support is deprecated</h4>
<div class="paragraph">
<p>Spring 3 support (GroupId:ArtifactId <code>org.infinispan:infinispan-spring</code>) is deprecated. Please consider migrating into Spring 4 support.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_7_x_to_8_0"><a class="anchor" href="#upgrading_from_7_x_to_8_0"></a>1.11. Upgrading from 7.x to 8.0</h3>
<div class="sect3">
<h4 id="configuration_changes"><a class="anchor" href="#configuration_changes"></a>1.11.1. Configuration changes</h4>
<div class="sect4">
<h5 id="removal_of_async_marshalling"><a class="anchor" href="#removal_of_async_marshalling"></a>Removal of Async Marshalling</h5>
<div class="paragraph">
<p>Async marshalling has been entirely dropped since it was never reliable enough. The "async-marshalling" attribute has been removed from the 8.0 XML schema and will be ignored when parsing 7.x configuration files. The programmatic configuration methods related to asyncMarshalling/syncMarshalling are now deprecated and have no effect aside from producing a WARN message in the logs.</p>
</div>
</div>
<div class="sect4">
<h5 id="reenabling_of_isolation_level_configurations_in_server"><a class="anchor" href="#reenabling_of_isolation_level_configurations_in_server"></a>Reenabling of isolation level configurations in server</h5>
<div class="paragraph">
<p>Because of the inability to configure write skew in the server, the isolation level attribute was ignored and defaulted to READ_COMMITTED. Now, when enabling REPEATABLE_READ together with optimistic locking, write skew is enabled by default in local and synchronous configurations.</p>
</div>
</div>
<div class="sect4">
<h5 id="subsystem_renaming_in_server"><a class="anchor" href="#subsystem_renaming_in_server"></a>Subsystem renaming in server</h5>
<div class="paragraph">
<p>In order to avoid conflict and confusion with the similar subsystems in WildFly, we have renamed the following subsystems in server:
* infinispan &#8594; datagrid-infinispan
* jgroups &#8594; datagrid-jgroups
* endpoint &#8594; datagrid-infinispan-endpoint</p>
</div>
</div>
<div class="sect4">
<h5 id="server_domain_mode"><a class="anchor" href="#server_domain_mode"></a>Server domain mode</h5>
<div class="paragraph">
<p>We no longer support the use of standalone mode for running clusters of servers. Domain mode (bin/domain.sh) should be used instead.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_6_0_to_7_0"><a class="anchor" href="#upgrading_from_6_0_to_7_0"></a>1.12. Upgrading from 6.0 to 7.0</h3>
<div class="sect3">
<h4 id="api_changes"><a class="anchor" href="#api_changes"></a>1.12.1. API Changes</h4>
<div class="sect4">
<h5 id="cache_loader"><a class="anchor" href="#cache_loader"></a>Cache Loader</h5>
<div class="paragraph">
<p>To be more inline with JCache and java.util.collections interfaces we have changed the first argument type for the CacheLoader.load &amp; CacheLoader.contains methods to be Object from type K.</p>
</div>
</div>
<div class="sect4">
<h5 id="cache_writer"><a class="anchor" href="#cache_writer"></a>Cache Writer</h5>
<div class="paragraph">
<p>To be more inline with JCache and java.util.collections interfaces we have changed the first argument type for the CacheWriter.delete method to be Object from type K.</p>
</div>
</div>
<div class="sect4">
<h5 id="filters"><a class="anchor" href="#filters"></a>Filters</h5>
<div class="paragraph">
<p>Over time Infinispan added 2 interfaces with identical names and almost identical methods.  The org.infinispan.notifications.KeyFilter and org.infinispan.persistence.spi.AdvancedCacheLoader$KeyFilter interfaces.</p>
</div>
<div class="paragraph">
<p>Both of these interfaces are used for the sole purpose of filtering an entry by it&#8217;s given key.  Infinispan 7.0 has also introduced the KeyValueFilter which is similar to both but also can filter on the entries value and/or metadata.</p>
</div>
<div class="paragraph">
<p>As such all of these classes have been moved into a new package org.infinispan.filter and all of their related helper classes.</p>
</div>
<div class="paragraph">
<p>The new org.infinispan.filter.KeyFilter interface has replaced both of the previous interfaces and all previous references use the new interface.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declarative_configuration"><a class="anchor" href="#declarative_configuration"></a>1.12.2. Declarative configuration</h4>
<div class="paragraph">
<p>The XML schema for the embedded configuration has changed to more closely follow the server configuration. Use the <code>config-converter.sh</code> or <code>config-converter.bat</code> scripts to convert an Infinispan 6.0 to the current format.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_5_3_to_6_0"><a class="anchor" href="#upgrading_from_5_3_to_6_0"></a>1.13. Upgrading from 5.3 to 6.0</h3>
<div class="sect3">
<h4 id="declarative_configuration_2"><a class="anchor" href="#declarative_configuration_2"></a>1.13.1. Declarative configuration</h4>
<div class="paragraph">
<p>In order to use all of the latest features, make sure you change the namespace declaration at the top of your XML configuration files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;infinispan</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:6.0 https://infinispan.org/schemas/infinispan-config-6.0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:6.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deprecated_api_removal"><a class="anchor" href="#deprecated_api_removal"></a>1.13.2. Deprecated API removal</h4>
<div class="ulist">
<ul>
<li>
<p>Class <code>org.infinispan.persistence.remote.wrapperEntryWrapper</code>.</p>
</li>
<li>
<p>Method <code>ObjectOutput startObjectOutput(OutputStream os, boolean isReentrant)</code> from class
<code>org.infinispan.commons.marshall.StreamingMarshaller</code>.</p>
</li>
<li>
<p>Method <code>CacheEntry getCacheEntry(Object key, EnumSet&lt;Flag&gt; explicitFlags, ClassLoader explicitClassLoader)</code> from class
<code>org.infinispan.AdvancedCache</code>.
Please use instead: <code>AdvanceCache.withFlags(Flag&#8230;&#8203; flags).with(ClassLoader classLoader).getCacheEntry(K key)</code>.</p>
</li>
<li>
<p>Method <code>AtomicMap&lt;K, V&gt; getAtomicMap(Cache&lt;MK, ?&gt; cache, MK key, FlagContainer flagContainer)</code> from class
<code>org.infinispan.atomic.AtomicMapLookup</code>.
Please use instead <code>AtomicMapLookup.getAtomicMap(cache.getAdvancedCache().withFlags(Flag&#8230;&#8203; flags), MK key)</code>.</p>
</li>
<li>
<p>Package <code>org.infinispan.config</code> (and all methods involving the old configuration classes).
All methods removed has an overloaded method which receives the new configuration classes as parameters.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This only affects the programmatic configuration.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Class <code>org.infinispan.context.FlagContainer</code>.</p>
</li>
<li>
<p>Method <code>boolean isLocal(Object key)</code> from class <code>org.infinispan.distribution.DistributionManager</code>.
Please use instead <code>DistributionManager.getLocality(Object key)</code>.</p>
</li>
<li>
<p>JMX operation <code>void setStatisticsEnabled(boolean enabled)</code> from class <code>org.infinispan.interceptors.TxInterceptor</code>
Please use instead the <code>statisticsEnabled</code> attribute.</p>
</li>
<li>
<p>Method <code>boolean delete(boolean synchronous)</code> from class <code>org.infinispan.io.GridFile</code>.
Please use instead <code>GridFile.delete()</code>.</p>
</li>
<li>
<p>JMX attribute <code>long getLocallyInterruptedTransactions()</code> from class
<code>org.infinispan.util.concurrent.locks.DeadlockDetectingLockManager</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_5_2_to_5_3"><a class="anchor" href="#upgrading_from_5_2_to_5_3"></a>1.14. Upgrading from 5.2 to 5.3</h3>
<div class="sect3">
<h4 id="declarative_configuration_3"><a class="anchor" href="#declarative_configuration_3"></a>1.14.1. Declarative configuration</h4>
<div class="paragraph">
<p>In order to use all of the latest features, make sure you change the namespace declaration at the top of your XML configuration files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;infinispan</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:5.2 https://infinispan.org/schemas/infinispan-config-5.2.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:5.3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_5_1_to_5_2"><a class="anchor" href="#upgrading_from_5_1_to_5_2"></a>1.15. Upgrading from 5.1 to 5.2</h3>
<div class="sect3">
<h4 id="declarative_configuration_4"><a class="anchor" href="#declarative_configuration_4"></a>1.15.1. Declarative configuration</h4>
<div class="paragraph">
<p>In order to use all of the latest features, make sure you change the namespace declaration at the top of your XML configuration files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;infinispan</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:5.2 https://infinispan.org/schemas/infinispan-config-5.2.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:5.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transaction"><a class="anchor" href="#transaction"></a>1.15.2. Transaction</h4>
<div class="paragraph">
<p>The default transaction enlistment model has changed ( <a href="https://issues.jboss.org/browse/ISPN-1284">ISPN-1284</a> ) from <a href="https://docs.oracle.com/javase/8/docs/api/javax/transaction/xa/XAResource.html"><code>XAResource</code></a> to <a href="https://docs.oracle.com/javase/8/docs/api/javax/transaction/Synchronization.html"><code>Synchronization</code></a>.
Also now, if the <code>XAResource</code> enlistment is used, then recovery is enabled by default.</p>
</div>
<div class="paragraph">
<p>In practical terms, if you were using the default values, this should not cause any backward compatibility issues but an increase in performance of about 5-7%. However in order to use the old configuration defaults, you need to configure the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;transaction</span> <span class="attribute-name">useSynchronization</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;recovery</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/transaction&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the programmatic configuration equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.transaction().useSynchronization(<span class="predefined-constant">false</span>).recovery().enabled(<span class="predefined-constant">false</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cache_loader_and_store_configuration"><a class="anchor" href="#cache_loader_and_store_configuration"></a>1.15.3. Cache Loader and Store configuration</h4>
<div class="paragraph">
<p>Cache Loader and Store configuration has changed greatly in Infinispan 5.2.</p>
</div>
</div>
<div class="sect3">
<h4 id="virtual_nodes_and_segments"><a class="anchor" href="#virtual_nodes_and_segments"></a>1.15.4. Virtual Nodes and Segments</h4>
<div class="paragraph">
<p>The concept of Virtual Nodes doesn&#8217;t exist anymore in Infinispan 5.2 and has been replaced by Segments.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading_from_5_0_to_5_1"><a class="anchor" href="#upgrading_from_5_0_to_5_1"></a>1.16. Upgrading from 5.0 to 5.1</h3>
<div class="sect3">
<h4 id="api"><a class="anchor" href="#api"></a>1.16.1. API</h4>
<div class="paragraph">
<p>The cache and cache manager hierarchies have changed slightly in 5.1 with the introduction of
<a href="https://docs.jboss.org/infinispan/5.1/apidocs/org/infinispan/api/BasicCache.html"><code>BasicCache</code></a>
and
<a href="https://docs.jboss.org/infinispan/5.1/apidocs/org/infinispan/api/BasicCacheContainer.html"><code>BasicCacheContainer</code></a>
, which are parent classes of existing
<a href="https://docs.jboss.org/infinispan/5.1/apidocs/org/infinispan/Cache.html"><code>Cache</code></a>
and
<a href="https://docs.jboss.org/infinispan/5.1/apidocs/org/infinispan/manager/CacheContainer.html"><code>CacheContainer</code></a>
classes respectively. What&#8217;s important is that Hot Rod clients must now code
against <code>BasicCache</code> and <code>BasicCacheContainer</code> rather than <code>Cache</code> and <code>CacheContainer</code>.
So previous code that was written like this will no longer compile.</p>
</div>
<div class="listingblock">
<div class="title">WontCompile.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.Cache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.manager.CacheContainer</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.RemoteCacheManager</span>;
...
CacheContainer cacheContainer = <span class="keyword">new</span> RemoteCacheManager();
Cache cache = cacheContainer.getCache();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, if Hot Rod clients want to continue using interfaces higher up the hierarchy from the remote cache/container classes, they&#8217;ll have to write:</p>
</div>
<div class="listingblock">
<div class="title">Correct.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.BasicCache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.manager.BasicCacheContainer</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.RemoteCacheManager</span>;
...
BasicCacheContainer cacheContainer = <span class="keyword">new</span> RemoteCacheManager();
BasicCache cache = cacheContainer.getCache();</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, previous code that interacted against the <code>RemoteCache</code> and <code>RemoteCacheManager</code> will work as it used to:</p>
</div>
<div class="listingblock">
<div class="title">AlsoCorrect.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.RemoteCache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.RemoteCacheManager</span>;
...
RemoteCacheManager cacheContainer = <span class="keyword">new</span> RemoteCacheManager();
RemoteCache cache = cacheContainer.getCache();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eviction_and_expiration"><a class="anchor" href="#eviction_and_expiration"></a>1.16.2. Eviction and Expiration</h4>
<div class="ulist">
<ul>
<li>
<p>The eviction XML element no longer defines the <code>wakeUpInterval</code> attribute. This is now configured via the <code>expiration</code> element:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;expiration</span> <span class="attribute-name">wakeUpInterval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="attribute-name">...</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Eviction&#8217;s <code>maxEntries</code> is used as guide for the entire cache, but eviction happens on a per cache segment, so when the segment is full, the segment is evicted. That&#8217;s why <code>maxEntries</code> is a theoretical limit but in practical terms, it&#8217;ll be a bit less than that. This is done for performance reasons.</p>
</div>
</div>
<div class="sect3">
<h4 id="transactions_2"><a class="anchor" href="#transactions_2"></a>1.16.3. Transactions</h4>
<div class="ulist">
<ul>
<li>
<p>A cache marked as <code>TRANSACTIONAL</code> cannot be accessed outside of a transaction, and a <code>NON_TRANSACTIONAL</code> cache cannot be accessed within a transaction. In 5.0, a transactional cache would support non-transactional calls as well.  This change was done to be in-line with expectations set out in <a href="https://github.com/jsr107">JSR-107</a> as well as to provide more consistent behavior.</p>
</li>
<li>
<p>In 5.0, commit and rollback phases were asynchronous by default. Starting with 5.1, these are now synchronous by default, to provide the guarantees required by a single lock-owner model.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="state_transfer"><a class="anchor" href="#state_transfer"></a>1.16.4. State transfer</h4>
<div class="paragraph">
<p>One of the big changes we made in 5.1 was to use the same push-based state transfer we introduced in 5.0 both for rehashing in distributed mode and for state retrieval in replicated mode. We even borrow the consistent hash concept in replicated mode to transfer state from all previous cache members at once in order to speed up transfer.</p>
</div>
<div class="paragraph">
<p>As a consequence we&#8217;ve unified the state transfer configuration as well, there is now a <code>stateTransfer</code> element containing a simplified state transfer configuration. The corresponding attributes in the <code>stateRetrieval</code> and <code>hash</code> elements have been deprecated, as have been some attributes that are no longer used.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a>1.16.5. Configuration</h4>
<div class="paragraph">
<p>If you use XML to configure Infinispan, you shouldn&#8217;t notice any change, except a much faster startup, courtesy of the <a href="http://en.wikipedia.org/wiki/StAX">StAX</a> based parser. However, if you use programmatic configuration, read on for the important differences.</p>
</div>
<div class="paragraph">
<p>Configuration is now packaged in <code>org.infinispan.configuration</code>, and you must use a fluent, builder style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c1 = <span class="keyword">new</span> ConfigurationBuilder()
   <span class="comment">// Adjust any configuration defaults you want</span>
   .clustering()
      .l1()
         .disable()
      .mode(DIST_SYNC)
      .hash()
         .numOwners(<span class="integer">5</span>)
   .build();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The old javabean style configuration is now deprecated and will be removed in a later version.</p>
</li>
<li>
<p>Configuration properties which can be safely changed at runtime are mutable, and all others are immutable.</p>
</li>
<li>
<p>To copy a configuration, use the <code>read()</code> method on the builder, for example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Configuration</span> c2 = <span class="keyword">new</span> ConfigurationBuilder()
   <span class="comment">// Read in C1 to provide defaults</span>
   .read(c1)
   .clustering()
      .l1()
         .enable()
   <span class="comment">// This cache is DIST_SYNC, will have 5 owners, with L1 cache enabled</span>
   .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This completely replaces the old system of defining a set of overrides on bean properties. Note that this means the behaviour of Infinispan configuration is somewhat different when used programmatically. Whilst before, you could define a default configuration, and any overrides would be applied on top of <em>your</em> defaults when defined, now you must explicitly read in your defaults to the builder. This allows for much greater flexibility in your code (you can have a as many "default" configurations as you want), and makes your code more explicit and type safe (finding references works).</p>
</div>
<div class="paragraph">
<p>The schema is unchanged from before. Infinispan 4.0 configurations are currently not being parsed. To upgrade, just change the schema definition from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;infinispan</span>
     <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:4.1 https://infinispan.org/schemas/infinispan-config-4.1.xsd</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:4.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;infinispan</span>
     <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:5.1 https://infinispan.org/schemas/infinispan-config-5.1.xsd</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:5.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The schema documentation has changed format, as it is now produced using the standard tool <code>xsddoc</code>. This should be a significant improvement, as better navigation is offered. Some elements and attributes are missing docs right now, we are working on adding this. As an added benefit, your IDE should now show documentation when an xsd referenced (as above)</p>
</div>
<div class="paragraph">
<p>We are in the process of adding in support for this configuration style for modules (such as cache stores). In the meantime, please use the old configuration or XML if you require support for cache store module configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="flags_and_classloaders"><a class="anchor" href="#flags_and_classloaders"></a>1.16.6. Flags and ClassLoaders</h4>
<div class="paragraph">
<p>The <code>Flags</code> and <code>ClassLoader</code> API has changed. In the past, the following would work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> cache.withFlags(f1, f2); cache.withClassLoader(cl); cache.put(k, v);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In 5.1.0, these <code>withX()</code> methods return a new instance and not the cache itself, so thread locals are avoided and the code above will not work. If used in a fluent manner however, things still work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cache.withFlags(f1, f2).withClassLoader(cl).put(k, v);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above pattern has always been the intention of this API anyway.</p>
</div>
</div>
<div class="sect3">
<h4 id="jgroups_bind_address"><a class="anchor" href="#jgroups_bind_address"></a>1.16.7. JGroups Bind Address</h4>
<div class="paragraph">
<p>Since upgrading to JGroups 3.x, <code>-Dbind.address</code> is ignored. This should be replaced with <code>-Djgroups.bind_addr</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rolling_server_upgrades"><a class="anchor" href="#rolling_server_upgrades"></a>2. Performing Rolling Upgrades for Infinispan Servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Perform rolling upgrades of your Infinispan clusters to change between
versions without downtime or data loss. Rolling upgrades migrate both your
Infinispan servers and your data to the target version over Hot Rod.</p>
</div>
<div class="sect2">
<h3 id="upgrade_target"><a class="anchor" href="#upgrade_target"></a>2.1. Setting Up Target Clusters</h3>
<div class="paragraph">
<p>Create a cluster that runs the target Infinispan version and uses a remote
cache store to load data from the source cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install a Infinispan cluster with the target upgrade version.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the network properties for the target cluster do not overlap with those
for the source cluster. You should specify unique names for the target and
source clusters in the JGroups transport configuration. Depending on your
environment you can also use different network interfaces and specify port
offsets to keep the target and source clusters separate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a <code>RemoteCacheStore</code> on the target cluster for each cache you want
to migrate from the source cluster.</p>
<div class="paragraph">
<p>Remote cache stores use the Hot Rod protocol to retrieve data from remote
Infinispan clusters. When you add the remote cache store to the target
cluster, it can lazily load data from the source cluster to handle client
requests.</p>
</div>
</li>
<li>
<p>Switch clients over to the target cluster so it starts handling all requests.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update client configuration with the location of the target cluster.</p>
</li>
<li>
<p>Restart clients.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="upgrade_remote_store"><a class="anchor" href="#upgrade_remote_store"></a>2.1.1. Remote Cache Stores for Rolling Upgrades</h4>
<div class="paragraph">
<p>You must use specific remote cache store configuration to perform rolling
upgrades, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;persistence</span> <span class="attribute-name">passivation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="tag">&lt;remote-store</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:store:remote:11.0</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDistCache</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
                 <span class="attribute-name">protocol-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.5</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
                 <span class="attribute-name">hotrod-wrapping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
                 <span class="attribute-name">raw-values</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
                 <span class="attribute-name">segmented</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
      <span class="tag">&lt;remote-server</span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11222</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
   <span class="tag">&lt;/remote-store&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disables passivation. Remote cache stores for rolling upgrades must disable passivation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Matches the name of a cache in the source cluster. Target clusters load data from this cache using the remote cache store.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Matches the Hot Rod protocol version of the source cluster. <code>2.5</code> is the minimum version and is suitable for any upgrade paths. You do not need to set another Hot Rod version.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Ensures that entries are wrapped in a suitable format for the Hot Rod protocol.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Stores data in the remote cache store in raw format. This ensures that clients can use data directly from the remote cache store.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Disables segmentation for the remote cache store. You should enable segmentation for remote cache stores only if the number of segments in the target cluster matches the number of segements for the cache in the source cluster.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Points to the location of the source cluster.</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/configdocs/infinispan-cachestore-remote-config-11.0.html">Remote cache store configuration schema</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/persistence/remote/RemoteStore.html">RemoteStore</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/persistence/remote/configuration/RemoteStoreConfigurationBuilder.html">RemoteStoreConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sync_data"><a class="anchor" href="#sync_data"></a>2.2. Synchronizing Data to Target Clusters</h3>
<div class="paragraph">
<p>When your target cluster is running and handling client requests using a remote
cache store to load data on demand, you can synchronize data from the source
cluster to the target cluster.</p>
</div>
<div class="paragraph">
<p>This operation reads data from the source cluster and writes it to the target
cluster. Data migrates to all nodes in the target cluster in parallel, with
each node receiving a subset of the data. You must perform the synchronization
for each cache in your Infinispan configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start the synchronization operation for each cache in your Infinispan
configuration that you want to migrate to the target cluster.</p>
<div class="paragraph">
<p>Use the Infinispan REST API and invoke <code>POST</code> requests with the <code>?action=sync-
data</code> parameter. For example, to synchronize data in a cache named "myCache"
from a source cluster to a target cluster, do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/myCache?action=sync-data</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the operation completes, Infinispan responds with the total number of
entries copied to the target cluster.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use JMX by invoking
<code>synchronizeData(migratorName=hotrod)</code> on the <code>RollingUpgradeManager</code> MBean.</p>
</div>
</li>
<li>
<p>Disconnect each node in the target cluster from the source cluster.</p>
<div class="paragraph">
<p>For example, to disconnect the "myCache" cache from the source cluster, invoke the following <code>POST</code> request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/myCache?action=disconnect-source</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use JMX, invoke <code>disconnectSource(migratorName=hotrod)</code> on the <code>RollingUpgradeManager</code> MBean.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>After you synchronize all data from the source cluster, the rolling upgrade
process is complete. You can now decommission the source cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="patching"><a class="anchor" href="#patching"></a>3. Patching Infinispan Server Installations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install and manage patches for Infinispan server installations.</p>
</div>
<div class="paragraph">
<p>You can apply patches to multiple Infinispan servers with different versions
to upgrade to a desired target version. However, patches do not take effect if
Infinispan servers are running. For this reason you install patches while
servers are offline. If you want to upgrade Infinispan clusters without
downtime, create a new cluster with the target version and perform a rolling
upgrade to that version instead of patching.</p>
</div>
<div class="sect2">
<h3 id="patches-server"><a class="anchor" href="#patches-server"></a>3.1. Infinispan Server Patches</h3>
<div class="paragraph">
<p>Infinispan server patches are <code>.zip</code> archives that contain artifacts that you
can apply to your <code>$ISPN_HOME</code> directory to fix issues and add new features.</p>
</div>
<div class="paragraph">
<p>Patches also provide a set of rules for Infinispan to modify your server
installation. When you apply patches, Infinispan overwrites some files and
removes others, depending on if they are required for the target version.</p>
</div>
<div class="paragraph">
<p>However, Infinispan does not make any changes to configuration files that you
have created or modified when applying a patch. Server patches do not modify or
replace any custom configuration or data.</p>
</div>
</div>
<div class="sect2">
<h3 id="patching_create-server"><a class="anchor" href="#patching_create-server"></a>3.2. Creating Server Patches</h3>
<div class="paragraph">
<p>You can create patches for Infinispan servers from an existing server
installation.</p>
</div>
<div class="paragraph">
<p>You can create patches for Infinispan servers starting from 10.1.7. You can
patch any 10.1 or later server installation. However you cannot patch 9.4.x or
earlier servers with 10.1.7 or later.</p>
</div>
<div class="paragraph">
<p>You can also create patches that either upgrade or downgrade the Infinispan
server version. For example, you can create a patch from version 10.1.7 and use
it to upgrade version 10.1.5 or downgrade version 11.0.0.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for a Infinispan server installation that has
the target version for the patch you want to create.</p>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>patch create</code> command to generate a patch archive and include the <code>-q</code> option with a meaningful qualifier to describe the patch.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch create -q &quot;this is my test patch&quot; path/to/mypatch.zip \
path/to/target/server/home path/to/source/server/home</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding command generates a <code>.zip</code> archive in the specified directory.
Paths are relative to <code>$ISPN_HOME</code> for the target server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Create single patches for multiple different Infinispan versions, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch create -q &quot;this is my test patch&quot; path/to/mypatch.zip \
path/to/target/server/home \
path/to/source/server1/home path/to/source/server2/home</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>server1</code> and <code>server2</code> are different Infinispan versions where you can
install "mypatch.zip".</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Describe the generated patch archive.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch describe path/to/mypatch.zip

Infinispan patch target=$target_version(my test patch)  source=$source_version created=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> is the Infinispan server version from which the patch was created.</p>
</li>
<li>
<p><code>$source_version</code> is one or more Infinispan server versions to which you can apply the patch.</p>
<div class="paragraph">
<p>You can apply patches to Infinispan servers that match the <code>$source_version</code>
only. Attempting to apply patches to other versions results in the following
exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>java.lang.IllegalStateException: The supplied patch cannot be applied to `$source_version`</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="patching_install-server"><a class="anchor" href="#patching_install-server"></a>3.3. Installing Server Patches</h3>
<div class="paragraph">
<p>Apply patches to Infinispan servers to upgrade or downgrade an existing
version.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a server patch for the target version.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for the Infinispan server you want to patch.</p>
</li>
<li>
<p>Stop the server if it is running.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you patch a server while it is running, the version changes take effect
after restart. If you do not want to stop the server, create a new cluster with
the target version and perform a rolling upgrade to that version instead of
patching.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Install the patch.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch install path/to/patch.zip

Infinispan patch target=$target_version source=$source_version \
created=$timestamp installed=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> displays the Infinispan version that the patch installed.</p>
</li>
<li>
<p><code>$source_version</code> displays the Infinispan version before you installed the patch.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Start the server to verify the patch is installed.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh
...
ISPN080001: Infinispan Server $version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the patch is installed successfully <code>$version</code> matches <code>$target_version</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--server</code> option to install patches in a different <code>$ISPN_HOME</code>
directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch install path/to/patch.zip --server=path/to/server/home</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="patching_rollback-server"><a class="anchor" href="#patching_rollback-server"></a>3.4. Rolling Back Server Patches</h3>
<div class="paragraph">
<p>Remove patches from Infinispan servers by rolling them back and restoring the
previous Infinispan version.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a server has multiple patches installed, you can roll back the last
installed patch only.</p>
</div>
<div class="paragraph">
<p>Rolling back patches does not revert configuration changes you make to
Infinispan server. Before you roll back patches, you should ensure that your
configuration is compatible with the version to which you are rolling back.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for the Infinispan server installation you want to roll back.</p>
</li>
<li>
<p>Stop the server if it is running.</p>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>List the installed patches.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch ls

Infinispan patch target=$target_version source=$source_version
created=$timestamp installed=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> is the Infinispan server version after the patch was applied.</p>
</li>
<li>
<p><code>$source_version</code> is the version for Infinispan server before the patch was applied. Rolling back the patch restores the server to this version.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Roll back the last installed patch.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch rollback</code></pre>
</div>
</div>
</li>
<li>
<p>Quit the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; quit</code></pre>
</div>
</div>
</li>
<li>
<p>Start the server to verify the patch is rolled back to the previous version.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh
...
ISPN080001: Infinispan Server $version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the patch is rolled back successfully <code>$version</code> matches <code>$source_version</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--server</code> option to rollback patches in a different <code>$ISPN_HOME</code>
directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch rollback --server=path/to/server/home</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="offline_data_migration"><a class="anchor" href="#offline_data_migration"></a>4. Migrating Data Between Cache Stores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides a Java utility for migrating persisted data between cache
stores.</p>
</div>
<div class="paragraph">
<p>In the case of upgrading Infinispan, functional differences between major
versions do not allow backwards compatibility between cache stores. You can use
<code>StoreMigrator</code> to convert your data so that it is compatible with the target
version.</p>
</div>
<div class="paragraph">
<p>For example, upgrading to Infinispan
10.0
changes the default marshaller to Protostream. In previous Infinispan
versions, cache stores use a binary format that is not compatible with the
changes to marshalling. This means that Infinispan
10.1
cannot read from cache stores with previous Infinispan versions.</p>
</div>
<div class="paragraph">
<p>In other cases Infinispan versions deprecate or remove cache store
implementations, such as JDBC Mixed and Binary stores. You can use
<code>StoreMigrator</code> in these cases to convert to different cache store
implementations.</p>
</div>
<div class="sect2">
<h3 id="store_migrator-upgrade"><a class="anchor" href="#store_migrator-upgrade"></a>4.1. Cache Store Migrator</h3>
<div class="paragraph">
<p>Infinispan provides the <code>StoreMigrator.java</code> utility that recreates data for
the latest Infinispan cache store implementations.</p>
</div>
<div class="paragraph">
<p><code>StoreMigrator</code> takes a cache store from a previous version of Infinispan as
source and uses a cache store implementation as target.</p>
</div>
<div class="paragraph">
<p>When you run <code>StoreMigrator</code>, it creates the target cache with the cache store
type that you define using the <code>EmbeddedCacheManager</code> interface. <code>StoreMigrator</code>
then loads entries from the source store into memory and then puts them into
the target cache.</p>
</div>
<div class="paragraph">
<p><code>StoreMigrator</code> also lets you migrate data from one type of cache store to
another. For example, you can migrate from a JDBC String-Based cache store to a
Single File cache store.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>StoreMigrator</code> cannot migrate data from segmented cache stores to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-segmented cache store.</p>
</li>
<li>
<p>Segmented cache stores that have a different number of segments.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="get_store_migrator-upgrade"><a class="anchor" href="#get_store_migrator-upgrade"></a>4.2. Getting the Store Migrator</h3>
<div class="paragraph">
<p><code>StoreMigrator</code> is available as part of the Infinispan tools library,
<code>infinispan-tools</code>, and is included in the Maven repository.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure your <code>pom.xml</code> for <code>StoreMigrator</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

    <span class="tag">&lt;groupId&gt;</span>org.infinispan.example<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbc-migrator-example<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>

    <span class="tag">&lt;dependencies&gt;</span>
      <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>infinispan-tools<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;/dependency&gt;</span>
      <span class="comment">&lt;!-- Additional dependencies --&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>

    <span class="tag">&lt;build&gt;</span>
      <span class="tag">&lt;plugins&gt;</span>
        <span class="tag">&lt;plugin&gt;</span>
          <span class="tag">&lt;groupId&gt;</span>org.codehaus.mojo<span class="tag">&lt;/groupId&gt;</span>
          <span class="tag">&lt;artifactId&gt;</span>exec-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
          <span class="tag">&lt;version&gt;</span>1.2.1<span class="tag">&lt;/version&gt;</span>
          <span class="tag">&lt;executions&gt;</span>
            <span class="tag">&lt;execution&gt;</span>
              <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>java<span class="tag">&lt;/goal&gt;</span>
              <span class="tag">&lt;/goals&gt;</span>
            <span class="tag">&lt;/execution&gt;</span>
          <span class="tag">&lt;/executions&gt;</span>
          <span class="tag">&lt;configuration&gt;</span>
            <span class="tag">&lt;mainClass&gt;</span>org.infinispan.tools.store.migrator.StoreMigrator<span class="tag">&lt;/mainClass&gt;</span>
            <span class="tag">&lt;arguments&gt;</span>
              <span class="tag">&lt;argument&gt;</span>path/to/migrator.properties<span class="tag">&lt;/argument&gt;</span>
            <span class="tag">&lt;/arguments&gt;</span>
          <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
      <span class="tag">&lt;/plugins&gt;</span>
    <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configure_store_migrator-upgrade"><a class="anchor" href="#configure_store_migrator-upgrade"></a>4.3. Configuring the Store Migrator</h3>
<div class="paragraph">
<p>Set properties for source and target cache stores in a <code>migrator.properties</code>
file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>migrator.properties</code> file.</p>
</li>
<li>
<p>Configure the source cache store in <code>migrator.properties</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Prepend all configuration properties with <code>source.</code> as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre>source.type=SOFT_INDEX_FILE_STORE
source.cache_name=myCache
source.location=/path/to/source/sifs</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the target cache store in <code>migrator.properties</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Prepend all configuration properties with <code>target.</code> as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre>target.type=SINGLE_FILE_STORE
target.cache_name=myCache
target.location=/path/to/target/sfs.dat</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="store_migrator_properties-upgrade"><a class="anchor" href="#store_migrator_properties-upgrade"></a>4.3.1. Store Migrator Properties</h4>
<div class="paragraph">
<p>Configure source and target cache stores in a <code>StoreMigrator</code> properties.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Cache Store Type Property</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of cache store type for a source or target.</p>
<p class="tableblock"><code>.type=JDBC_STRING</code></p>
<p class="tableblock"><code>.type=JDBC_BINARY</code></p>
<p class="tableblock"><code>.type=JDBC_MIXED</code></p>
<p class="tableblock"><code>.type=LEVELDB</code></p>
<p class="tableblock"><code>.type=ROCKSDB</code></p>
<p class="tableblock"><code>.type=SINGLE_FILE_STORE</code></p>
<p class="tableblock"><code>.type=SOFT_INDEX_FILE_STORE</code></p>
<p class="tableblock"><code>.type=JDBC_MIXED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Common Properties</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Names the cache that the store backs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.cache_name=myCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>segment_count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of segments for target cache stores that can use
segmentation.</p>
<p class="tableblock">The number of segments must match <code>clustering.hash.numSegments</code> in the
Infinispan configuration.</p>
<p class="tableblock">In other words, the number of segments for a cache store must match the number
of segments for the corresponding cache. If the number of segments is not the
same, Infinispan cannot read data from the cache store.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.segment_count=256</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. JDBC Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the dialect of the underlying database.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the marshaller version for source cache stores. Set one of the following values:</p>
<p class="tableblock">* <code>8</code> for Infinispan 8.x</p>
<p class="tableblock">* <code>9</code> for Infinispan 9.x</p>
<p class="tableblock">* <code>10</code> Infinispan 10.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for source stores only.</p>
<p class="tableblock">For example: <code>source.version=9</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>marshaller.class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a custom marshaller class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if using custom marshallers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>marshaller.externalizers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a comma-separated list of custom <code>AdvancedExternalizer</code> implementations to load in this format: <code>[id]:&lt;Externalizer class&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connection_pool.connection_url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the JDBC connection URL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connection_pool.driver_class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the class of the JDBC driver.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connection_pool.username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a database username.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connection_pool.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a password for the database username.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db.major_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the database major version.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db.minor_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the database minor version.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db.disable_upsert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables database upsert.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db.disable_indexing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies if table indexes are created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>table.string.table_name_prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies additional prefixes for the table name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>table.string.&lt;id|data|timestamp&gt;.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the column name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>table.string.&lt;id|data|timestamp&gt;.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the column type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key_to_string_mapper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the <code>TwoWayKey2StringMapper</code> class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To migrate from Binary cache stores in older Infinispan versions, change
<code>table.string.*</code> to <code>table.binary.\*</code> in the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>source.table.binary.table_name_prefix</code></p>
</li>
<li>
<p><code>source.table.binary.&lt;id\|data\|timestamp&gt;.name</code></p>
</li>
<li>
<p><code>source.table.binary.&lt;id\|data\|timestamp&gt;.type</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre># Example configuration for migrating to a JDBC String-Based cache store
target.type=STRING
target.cache_name=myCache
target.dialect=POSTGRES
target.marshaller.class=org.example.CustomMarshaller
target.marshaller.externalizers=25:Externalizer1,org.example.Externalizer2
target.connection_pool.connection_url=jdbc:postgresql:postgres
target.connection_pool.driver_class=org.postrgesql.Driver
target.connection_pool.username=postgres
target.connection_pool.password=redhat
target.db.major_version=9
target.db.minor_version=5
target.db.disable_upsert=false
target.db.disable_indexing=false
target.table.string.table_name_prefix=tablePrefix
target.table.string.id.name=id_column
target.table.string.data.name=datum_column
target.table.string.timestamp.name=timestamp_column
target.table.string.id.type=VARCHAR
target.table.string.data.type=bytea
target.table.string.timestamp.type=BIGINT
target.key_to_string_mapper=org.infinispan.persistence.keymappers. DefaultTwoWayKey2StringMapper</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. RocksDB Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the database directory.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the compression type to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre># Example configuration for migrating from a RocksDB cache store.
source.type=ROCKSDB
source.cache_name=myCache
source.location=/path/to/rocksdb/database
source.compression=SNAPPY</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. SingleFileStore Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the directory that contains the cache store <code>.dat</code> file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre># Example configuration for migrating to a Single File cache store.
target.type=SINGLE_FILE_STORE
target.cache_name=myCache
target.location=/path/to/sfs.dat</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. SoftIndexFileStore Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required/Optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the database directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index_location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the database index directory.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre># Example configuration for migrating to a Soft-Index File cache store.
target.type=SOFT_INDEX_FILE_STORE
target.cache_name=myCache
target.location=path/to/sifs/database
target.location=path/to/sifs/index</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating_stores-upgrade"><a class="anchor" href="#migrating_stores-upgrade"></a>4.4. Migrating Cache Stores</h3>
<div class="paragraph">
<p>Run <code>StoreMigrator</code> to migrate data from one cache store to another.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Get <code>infinispan-tools.jar</code>.</p>
</li>
<li>
<p>Create a <code>migrator.properties</code> file that configures the source and target
cache stores.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>If you build <code>infinispan-tools.jar</code> from source, do the following:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>infinispan-tools.jar</code> and dependencies for your source and target
databases, such as JDBC drivers, to your classpath.</p>
</li>
<li>
<p>Specify <code>migrator.properties</code> file as an argument for <code>StoreMigrator</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If you pull <code>infinispan-tools.jar</code> from the Maven
repository, run the following command:</p>
<div class="paragraph">
<p><code>mvn exec:java</code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-11-30 02:47:11 -0500
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>