<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 2.0.10"> <title>Deploying and Configuring Infinispan 10.1 Servers</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"> <style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <link rel="canonical" href="http://infinispan.org/docs/stable/user_guide/user_guide.html"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css"> <link rel="stylesheet" href="../../css/css.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script> <script src="../../js/js.js"></script> </head> <body class="book toc2 toc-left"> <div id="header"> <h1>Deploying and Configuring Infinispan 10.1 Servers</h1> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#start_server">1. Getting Started with Infinispan Server</a> <ul class="sectlevel2"> <li><a href="#infinispan_server_requirements">1.1. Infinispan Server Requirements</a></li> <li><a href="#downloading_server_distributions">1.2. Downloading Server Distributions</a></li> <li><a href="#installing_infinispan_server">1.3. Installing Infinispan Server</a></li> <li><a href="#server_quickstart">1.4. Running Infinispan Servers</a> <ul class="sectlevel3"> <li><a href="#starting_infinispan_servers">1.4.1. Starting Infinispan Servers</a></li> <li><a href="#verifying_infinispan_cluster_discovery">1.4.2. Verifying Infinispan Cluster Discovery</a></li> <li><a href="#cli_operations-server_quickstart">1.4.3. Performing Operations with the Infinispan CLI</a> <ul class="sectlevel4"> <li><a href="#starting_the_infinispan_cli">Starting the Infinispan CLI</a></li> <li><a href="#connecting_to_infinispan_servers">Connecting to Infinispan Servers</a></li> <li><a href="#creating_caches_from_templates">Creating Caches from Templates</a></li> <li><a href="#adding_cache_entries">Adding Cache Entries</a></li> <li><a href="#shutting_down_infinispan_servers">Shutting Down Infinispan Servers</a></li> </ul> </li> </ul> </li> </ul> </li> <li><a href="#configuring_endpoints">2. Setting Up Infinispan Endpoints</a> <ul class="sectlevel2"> <li><a href="#infinispan_endpoints">2.1. Infinispan Endpoints</a> <ul class="sectlevel3"> <li><a href="#hot_rod">2.1.1. Hot Rod</a></li> <li><a href="#rest">2.1.2. REST</a></li> <li><a href="#memcached">2.1.3. Memcached</a></li> <li><a href="#protocol_comparison">2.1.4. Protocol Comparison</a></li> </ul> </li> <li><a href="#endpoint_connectors">2.2. Endpoint Connectors</a> <ul class="sectlevel3"> <li><a href="#hot_rod_connectors">2.2.1. Hot Rod Connectors</a></li> <li><a href="#rest_connectors">2.2.2. REST Connectors</a></li> <li><a href="#memcached_connectors">2.2.3. Memcached Connectors</a></li> </ul> </li> </ul> </li> <li><a href="#monitoring">3. Monitoring Infinispan Servers</a> <ul class="sectlevel2"> <li><a href="#logs">3.1. Working with Infinispan Server Logs</a> <ul class="sectlevel3"> <li><a href="#infinispan_log_files">3.1.1. Infinispan Log Files</a></li> <li><a href="#configuring_infinispan_log_properties">3.1.2. Configuring Infinispan Log Properties</a> <ul class="sectlevel4"> <li><a href="#log_levels">Log Levels</a></li> <li><a href="#infinispan_log_categories">Infinispan Log Categories</a></li> <li><a href="#root_logger">Root Logger</a></li> <li><a href="#log_handlers">Log Handlers</a></li> <li><a href="#log_formatters">Log Formatters</a></li> <li><a href="#enabling_and_configuring_the_json_log_handler">Enabling and Configuring the JSON Log Handler</a></li> </ul> </li> <li><a href="#logging_framework">3.1.3. Logging Framework</a></li> <li><a href="#server_access_logs">3.1.4. Access Logs</a> <ul class="sectlevel4"> <li><a href="#enabling_access_logs">Enabling Access Logs</a></li> <li><a href="#access_log_properties">Access Log Properties</a></li> </ul> </li> </ul> </li> <li><a href="#server_health">3.2. Retrieving Server Health Statistics</a> <ul class="sectlevel3"> <li><a href="#accessing_the_health_api_via_jmx">3.2.1. Accessing the Health API via JMX</a></li> <li><a href="#accessing_the_health_api_via_rest">3.2.2. Accessing the Health API via REST</a></li> </ul> </li> <li><a href="#monitoring_infinispan_servers_over_jmx">3.3. Monitoring Infinispan Servers Over JMX</a> <ul class="sectlevel3"> <li><a href="#jmx_mgmt_tooling">3.3.1. JMX Monitoring</a> <ul class="sectlevel4"> <li><a href="#jmx">JMX</a> <ul class="sectlevel5"> <li><a href="#understanding_the_exposed_mbeans">Understanding The Exposed MBeans</a></li> <li><a href="#enabling_jmx_statistics">Enabling JMX Statistics</a></li> <li><a href="#monitoring_cluster_health">Monitoring cluster health</a></li> <li><a href="#multiple_jmx_domains">Multiple JMX Domains</a></li> <li><a href="#registering_mbeans_in_non_default_mbean_servers">Registering MBeans In Non-Default MBean Servers</a></li> <li><a href="#available_mbeans">Available MBeans</a></li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> <li><a href="#security">4. Securing Infinispan Servers</a> <ul class="sectlevel2"> <li><a href="#security_concepts">4.1. Security Concepts</a> <ul class="sectlevel3"> <li><a href="#authorization">4.1.1. Authorization</a></li> <li><a href="#server_realms">4.1.2. Server Realms</a></li> </ul> </li> <li><a href="#security_hotrod_auth">4.2. Hot Rod Authentication</a> <ul class="sectlevel3"> <li><a href="#security_saslqop">4.2.1. SASL Quality of Protection</a></li> <li><a href="#sasl_policies">4.2.2. SASL Policies</a></li> <li><a href="#using_gssapikerberos">4.2.3. Using GSSAPI/Kerberos</a></li> </ul> </li> <li><a href="#security_hotrod_rest_encryption">4.3. Hot Rod and REST encryption (TLS/SSL)</a></li> </ul> </li> <li><a href="#server_single_port">5. Single Port</a> <ul class="sectlevel2"> <li><a href="#single_port_router">5.1. Single-Port router</a> <ul class="sectlevel3"> <li><a href="#testing_the_single_port_router">5.1.1. Testing the Single-Port router</a></li> </ul> </li> <li><a href="#hot_rod_protocol_detection">5.2. Hot Rod Protocol Detection</a> <ul class="sectlevel3"> <li><a href="#tlsalpn_protocol_selection">5.2.1. TLS/ALPN protocol selection</a> <ul class="sectlevel4"> <li><a href="#enabling_alpn">Enabling ALPN</a></li> </ul> </li> </ul> </li> </ul> </li> <li><a href="#remote_server_execution">6. Remotely Executing Server-Side Tasks</a> <ul class="sectlevel2"> <li><a href="#server_tasks">6.1. Creating Server Tasks</a> <ul class="sectlevel3"> <li><a href="#tasks">6.1.1. Server Tasks</a></li> <li><a href="#server_tasks-server">6.1.2. Deploying Server Tasks to Infinispan Servers</a></li> </ul> </li> <li><a href="#server_scripts">6.2. Creating Server Scripts</a> <ul class="sectlevel3"> <li><a href="#scripts">6.2.1. Server Scripts</a> <ul class="sectlevel4"> <li><a href="#server_script_metdata">Script Metadata</a></li> <li><a href="#server_script_bindings">Script Bindings</a></li> <li><a href="#server_script_parameters">Script Parameters</a></li> </ul> </li> <li><a href="#adding_scripts_cli-server">6.2.2. Adding Scripts to Infinispan Servers</a></li> <li><a href="#add_script_hotrod">6.2.3. Programmatically Creating Scripts</a></li> </ul> </li> <li><a href="#running_tasks_scripts">6.3. Running Server-Side Tasks and Scripts</a> <ul class="sectlevel3"> <li><a href="#running_scripts_cli">6.3.1. Running Tasks and Scripts</a></li> <li><a href="#running_scripts_hotrod">6.3.2. Programmatically Running Scripts</a></li> <li><a href="#running_tasks_hotrod">6.3.3. Programmatically Running Tasks</a></li> </ul> </li> </ul> </li> <li><a href="#custom_marshaller">7. Adding Custom Marshaller Bridges</a> <ul class="sectlevel2"> <li><a href="#protostuff">7.1. Protostuff</a></li> <li><a href="#kryo">7.2. Kryo</a></li> <li><a href="#storing_deserialized_objects">7.3. Storing deserialized objects</a></li> <li><a href="#registering_custom_schemasserializers">7.4. Registering Custom Schemas/Serializers</a></li> </ul> </li> <li><a href="#server_rolling_upgrade">8. Performing Rolling Upgrades</a> <ul class="sectlevel2"> <li><a href="#rolling_upgrades">8.1. Rolling Upgrades</a></li> <li><a href="#setting_up_target_clusters">8.2. Setting Up Target Clusters</a></li> <li><a href="#synchronizing_data_from_source_clusters">8.3. Synchronizing Data from Source Clusters</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan server is a managed, distributed, and clusterable data grid that provides elastic scaling and high performance access to caches from multiple endpoints, such as Hot Rod and REST.</p> </div> </div> </div> <div class="sect1"> <h2 id="start_server"><a class="anchor" href="#start_server"></a>1. Getting Started with Infinispan Server</h2> <div class="sectionbody"> <div class="paragraph"> <p>Quickly set up Infinispan server and learn the basics.</p> </div> <div class="sect2"> <h3 id="infinispan_server_requirements"><a class="anchor" href="#infinispan_server_requirements"></a>1.1. Infinispan Server Requirements</h3> <div class="paragraph"> <p>Check host system requirements for the Infinispan server.</p> </div> <div class="paragraph"> <p>Infinispan server requires a Java Virtual Machine and supports:</p> </div> <div class="ulist"> <ul> <li> <p>Java 8</p> </li> <li> <p>Java 11</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="downloading_server_distributions"><a class="anchor" href="#downloading_server_distributions"></a>1.2. Downloading Server Distributions</h3> <div class="paragraph"> <p>The Infinispan server distribution is an archive of Java libraries (<code>JAR</code> files), configuration files, and a <code>data</code> directory.</p> </div> <div class="paragraph"> <div class="title">Procedure</div> <p>Download the Infinispan 10.1 server from <a href="https://infinispan.org/download/">Infinispan downloads</a>.</p> </div> <div class="paragraph"> <div class="title">Verification</div> <p>Use the checksum to verify the integrity of your download.</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Run the <code>sha1sum</code> command with the server download archive as the argument, for example:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ sha1sum infinispan-server-${version}.zip</code></pre> </div> </div> </li> <li> <p>Compare with the <code>SHA-1</code> checksum value on the Infinispan downloads page.</p> </li> </ol> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://github.com/infinispan/infinispan/blob/master/server/runtime/README.adoc">Infinispan Server README</a> describes the contents of the server distribution.</p> </div> </div> <div class="sect2"> <h3 id="installing_infinispan_server"><a class="anchor" href="#installing_infinispan_server"></a>1.3. Installing Infinispan Server</h3> <div class="paragraph"> <p>Extract the Infinispan server archive to any directory on your host.</p> </div> <div class="paragraph"> <div class="title">Procedure</div> <p>Use any extraction tool with the server archive, for example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ unzip infinispan-server-${version}.zip</code></pre> </div> </div> <div class="paragraph"> <p>The resulting directory is your <code>$ISPN_HOME</code>.</p> </div> </div> <div class="sect2"> <h3 id="server_quickstart"><a class="anchor" href="#server_quickstart"></a>1.4. Running Infinispan Servers</h3> <div class="paragraph"> <p>Spin up Infinispan server instances that automatically form clusters. Learn how to create cache definitions to store your data.</p> </div> <div class="sect3"> <h4 id="starting_infinispan_servers"><a class="anchor" href="#starting_infinispan_servers"></a>1.4.1. Starting Infinispan Servers</h4> <div class="paragraph"> <p>Launch Infinispan server with the startup script.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Open a terminal in <code>$ISPN_HOME</code>.</p> </li> <li> <p>Run the <code>server</code> script.</p> <div class="dlist"> <dl> <dt class="hdlist1">Linux</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/server.sh</code></pre> </div> </div> </dd> <dt class="hdlist1">Microsoft Windows</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>bin\server.bat</code></pre> </div> </div> <div class="paragraph"> <p>The server gives you these messages when it starts:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>INFO  [org.infinispan.SERVER] (main) ISPN080004: Protocol SINGLE_PORT listening
on 127.0.0.1:11222
INFO  [org.infinispan.SERVER] (main) ISPN080001: Infinispan Server ${version}
started in 7453ms</code></pre> </div> </div> </dd> </dl> </div> </li> </ol> </div> <div class="paragraph"> <p><em>Hello Infinispan!</em></p> </div> <div class="ulist"> <ul> <li> <p>Open <code>127.0.0.1:11222</code> in any browser to see the Infinispan server welcome message.</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://github.com/infinispan/infinispan/blob/master/server/runtime/README.adoc">Infinispan Server README</a> describes command line arguments for the <code>server</code> script.</p> </div> </div> <div class="sect3"> <h4 id="verifying_infinispan_cluster_discovery"><a class="anchor" href="#verifying_infinispan_cluster_discovery"></a>1.4.2. Verifying Infinispan Cluster Discovery</h4> <div class="paragraph"> <p>Infinispan servers running on the same network discover each other with the <code>MPING</code> protocol.</p> </div> <div class="paragraph"> <p>This procedure shows you how to use Infinispan server command arguments to start two instances on the same host and verify that the cluster view forms.</p> </div> <div class="paragraph"> <div class="title">Prerequisites</div> <p>Start a Infinispan server.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Install and run a new Infinispan server instance.</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>Open a terminal in <code>$ISPN_HOME</code>.</p> </li> <li> <p>Copy the root directory to <code>server2</code>.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ cp -r server server2</code></pre> </div> </div> </li> </ol> </div> </li> <li> <p>Specify a port offset and the location of the <code>server2</code> root directory.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/server.sh -o 100 -s server2</code></pre> </div> </div> </li> </ol> </div> <div class="paragraph"> <div class="title">Verification</div> <p>Running servers return the following messages when new servers join clusters:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN000094: Received new cluster view for channel cluster:
[&lt;server_hostname&gt;|3] (2) [&lt;server_hostname&gt;, &lt;server2_hostname&gt;]
INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN100000: Node &lt;server2_hostname&gt; joined the cluster</code></pre> </div> </div> <div class="paragraph"> <p>Servers return the following messages when they join clusters:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>INFO  [org.infinispan.remoting.transport.jgroups.JGroupsTransport] (main)
ISPN000078: Starting JGroups channel cluster
INFO  [org.infinispan.CLUSTER] (main)
ISPN000094: Received new cluster view for channel cluster:
[&lt;server_hostname&gt;|3] (2) [&lt;server_hostname&gt;, &lt;server2_hostname&gt;]</code></pre> </div> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://github.com/infinispan/infinispan/blob/master/server/runtime/README.adoc">Infinispan Server README</a> describes command line arguments for the <code>server</code> script.</p> </div> </div> <div class="sect3"> <h4 id="cli_operations-server_quickstart"><a class="anchor" href="#cli_operations-server_quickstart"></a>1.4.3. Performing Operations with the Infinispan CLI</h4> <div class="paragraph"> <p>Connect to servers with the Infinispan command line interface (CLI) to access data and perform administrative functions.</p> </div> <div class="sect4"> <h5 id="starting_the_infinispan_cli"><a class="anchor" href="#starting_the_infinispan_cli"></a>Starting the Infinispan CLI</h5> <div class="paragraph"> <p>Start the Infinispan CLI as follows:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Open a terminal in <code>$ISPN_HOME</code>.</p> </li> <li> <p>Run the CLI.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre> </div> </div> </li> </ol> </div> </div> <div class="sect4"> <h5 id="connecting_to_infinispan_servers"><a class="anchor" href="#connecting_to_infinispan_servers"></a>Connecting to Infinispan Servers</h5> <div class="paragraph"> <p>Do one of the following:</p> </div> <div class="ulist"> <ul> <li> <p>Run the <code>connect</code> command to connect to a Infinispan server on the default port of <code>11222</code>:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; connect
[hostname1@cluster//containers/default]&gt;</code></pre> </div> </div> </li> <li> <p>Specify the location of a Infinispan server. For example, connect to a local server that has a port offset of 100:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; connect 127.0.0.1:11322
[hostname2@cluster//containers/default]&gt;</code></pre> </div> </div> </li> </ul> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>Press the tab key to display available commands and options. Use the <code>-h</code> option to display help text.</p> </div> </td> </tr> </table> </div> </div> <div class="sect4"> <h5 id="creating_caches_from_templates"><a class="anchor" href="#creating_caches_from_templates"></a>Creating Caches from Templates</h5> <div class="paragraph"> <p>Use Infinispan cache templates to add caches with recommended default settings.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Create a distributed, synchronous cache from a template and name it "mycache".</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; create cache --template=org.infinispan.DIST_SYNC mycache</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>Press the tab key after the <code>--template=</code> argument to list available cache templates.</p> </div> </td> </tr> </table> </div> </li> <li> <p>Retrieve the cache configuration.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; describe caches/mycache
{
  &quot;distributed-cache&quot; : {
    &quot;mode&quot; : &quot;SYNC&quot;,
    &quot;remote-timeout&quot; : 17500,
    &quot;state-transfer&quot; : {
      &quot;timeout&quot; : 60000
    },
    &quot;transaction&quot; : {
      &quot;mode&quot; : &quot;NONE&quot;
    },
    &quot;locking&quot; : {
      &quot;concurrency-level&quot; : 1000,
      &quot;acquire-timeout&quot; : 15000,
      &quot;striping&quot; : false
    }
  }
}</code></pre> </div> </div> </li> </ol> </div> </div> <div class="sect4"> <h5 id="adding_cache_entries"><a class="anchor" href="#adding_cache_entries"></a>Adding Cache Entries</h5> <div class="paragraph"> <p>Add data to caches with the Infinispan CLI.</p> </div> <div class="ulist"> <div class="title">Prerequisites</div> <ul> <li> <p>Create a cache named "mycache".</p> </li> </ul> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Add a key/value pair to <code>mycache</code>.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; put --cache=mycache hello world</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>If the CLI is in the context of a cache, do <code>put k1 v1</code> for example:</p> </div> <div class="listingblock"> <div class="content"> <pre>[//containers/default]&gt; cd caches/mycache
[//containers/default/caches/mycache]&gt; put hello world</pre> </div> </div> </td> </tr> </table> </div> </li> <li> <p>List keys in the cache.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; ls caches/mycache
hello</code></pre> </div> </div> </li> <li> <p>Get the value for the <code>hello</code> key.</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>Navigate to the cache.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; cd caches/mycache</code></pre> </div> </div> </li> <li> <p>Use the <code>get</code> command to retrieve the key value.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default/caches/mycache]&gt; get hello
world</code></pre> </div> </div> </li> </ol> </div> </li> </ol> </div> </div> <div class="sect4"> <h5 id="shutting_down_infinispan_servers"><a class="anchor" href="#shutting_down_infinispan_servers"></a>Shutting Down Infinispan Servers</h5> <div class="paragraph"> <p>Use the CLI to gracefully shutdown running servers. This ensures that Infinispan passivates all entries to disk and persists state.</p> </div> <div class="ulist"> <ul> <li> <p>Use the <code>shutdown server</code> command to stop individual servers, for example:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; shutdown server server_hostname</code></pre> </div> </div> </li> <li> <p>Use the <code>shutdown cluster</code> command to stop all servers joined to the cluster, for example:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; shutdown cluster</code></pre> </div> </div> </li> </ul> </div> <div class="paragraph"> <p>Infinispan servers log the following shutdown messages:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>INFO  [org.infinispan.SERVER] (pool-3-thread-1) ISPN080002: Infinispan Server stopping
INFO  [org.infinispan.CONTAINER] (pool-3-thread-1) ISPN000029: Passivating all entries to disk
INFO  [org.infinispan.CONTAINER] (pool-3-thread-1) ISPN000030: Passivated 28 entries in 46 milliseconds
INFO  [org.infinispan.CLUSTER] (pool-3-thread-1) ISPN000080: Disconnecting JGroups channel cluster
INFO  [org.infinispan.CONTAINER] (pool-3-thread-1) ISPN000390: Persisted state, version=&lt;Infinispan version&gt; timestamp=YYYY-MM-DDTHH:MM:SS
INFO  [org.infinispan.SERVER] (pool-3-thread-1) ISPN080003: Infinispan Server stopped
INFO  [org.infinispan.SERVER] (Thread-0) ISPN080002: Infinispan Server stopping
INFO  [org.infinispan.SERVER] (Thread-0) ISPN080003: Infinispan Server stopped</code></pre> </div> </div> <div class="paragraph"> <p>When you shutdown Infinispan clusters, the shutdown messages include:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>INFO  [org.infinispan.SERVER] (pool-3-thread-1) ISPN080029: Cluster shutdown
INFO  [org.infinispan.CLUSTER] (pool-3-thread-1) ISPN000080: Disconnecting JGroups channel cluster</code></pre> </div> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="configuring_endpoints"><a class="anchor" href="#configuring_endpoints"></a>2. Setting Up Infinispan Endpoints</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan servers provide listener endpoints that handle requests from remote client applications.</p> </div> <div class="sect2"> <h3 id="infinispan_endpoints"><a class="anchor" href="#infinispan_endpoints"></a>2.1. Infinispan Endpoints</h3> <div class="paragraph"> <p>Infinispan endpoints expose the <code>CacheManager</code> interface over different connector protocols so you can remotely access data and perform operations to manage and maintain Infinispan clusters.</p> </div> <div class="paragraph"> <p>You can define multiple endpoint connectors on different socket bindings.</p> </div> <div class="sect3"> <h4 id="hot_rod"><a class="anchor" href="#hot_rod"></a>2.1.1. Hot Rod</h4> <div class="paragraph"> <p>Hot Rod is a binary TCP client-server protocol designed to provide faster data access and improved performance in comparison to text-based protocols.</p> </div> <div class="paragraph"> <p>Infinispan provides Hot Rod client libraries in Java, C++, C#, Node.js and other programming languages.</p> </div> <div class="paragraph"> <div class="title">Topology state transfer</div> <p>Infinispan uses topology caches to provide clients with cluster views. Topology caches contain entries that map internal JGroups transport addresses to exposed Hot Rod endpoints.</p> </div> <div class="paragraph"> <p>When client send requests, Infinispan servers compare the topology ID in request headers with the topology ID from the cache. Infinispan servers send new topology views if client have older topology IDs.</p> </div> <div class="paragraph"> <p>Cluster topology views allow Hot Rod clients to immediately detect when nodes join and leave, which enables dynamic load balancing and failover.</p> </div> <div class="paragraph"> <p>In distributed cache modes, the consistent hashing algorithm also makes it possible to route Hot Rod client requests directly to primary owners.</p> </div> <div class="ulist"> <div class="title">Reference</div> <ul> <li> <p><a href="../hotrod_java/hotrod_java.html">Infinispan Hot Rod Server</a></p> </li> <li> <p><a href="http://www.infinispan.org/hotrod-clients">Hot Rod client implementations</a></p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="rest"><a class="anchor" href="#rest"></a>2.1.2. REST</h4> <div class="paragraph"> <p>Infinispan exposes a RESTful interface that allows HTTP clients to access data, monitor and maintain clusters, and perform administrative operations.</p> </div> <div class="paragraph"> <p>You can use standard HTTP load balancers to provide clients with load balancing and failover capabilities. However, HTTP load balancers maintain static cluster views and require manual updates when cluster topology changes occur.</p> </div> <div class="ulist"> <div class="title">Reference</div> <ul> <li> <p><a href="../rest/rest.html">Infinispan REST Server</a></p> </li> <li> <p><a href="http://www.jboss.org/mod_cluster">mod_cluster HTTP load balancer</a></p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="memcached"><a class="anchor" href="#memcached"></a>2.1.3. Memcached</h4> <div class="paragraph"> <p>Infinispan provides an implementation of the Memcached text protocol for remote client access.</p> </div> <div class="paragraph"> <p>The Infinispan Memcached server supports clustering with replicated and distributed cache modes.</p> </div> <div class="paragraph"> <p>There are some Memcached client implementations, such as the Cache::Memcached Perl client, that can offer load balancing and failover detection capabilities with static lists of Infinispan server addresses that require manual updates when cluster topology changes occur.</p> </div> <div class="ulist"> <div class="title">Reference</div> <ul> <li> <p><a href="../memcached/memcached.html">Infinispan Memcached Server</a></p> </li> <li> <p><a href="http://code.google.com/p/memcached/wiki/Clients">Memcached clients</a></p> </li> <li> <p><a href="http://github.com/memcached/memcached/blob/master/doc/protocol.txt">Memcached text protocol</a></p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="protocol_comparison"><a class="anchor" href="#protocol_comparison"></a>2.1.4. Protocol Comparison</h4> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top"></th> <th class="tableblock halign-center valign-top">Hot Rod</th> <th class="tableblock halign-center valign-top">HTTP / REST</th> <th class="tableblock halign-center valign-top">Memcached</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology-aware</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash-aware</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Encryption</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Conditional ops</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Bulk ops</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transactions</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listeners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Query</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Execution</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site failover</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> <td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td> </tr> </tbody> </table> </div> </div> <div class="sect2"> <h3 id="endpoint_connectors"><a class="anchor" href="#endpoint_connectors"></a>2.2. Endpoint Connectors</h3> <div class="paragraph"> <p>You configure Infinispan server endpoints with connector declarations that specify socket bindings, authentication mechanisms, and encryption configuration.</p> </div> <div class="paragraph"> <p>The default endpoint connector configuration is as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;memcached-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcached</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p><code>endpoints</code> contains endpoint connector declarations and defines global configuration for endpoints such as default socket bindings, security realms, and whether clients must present valid TLS certificates.</p> </li> <li> <p><code>&lt;hotrod-connector name="hotrod"/&gt;</code> declares a Hot Rod connector.</p> </li> <li> <p><code>&lt;rest-connector name="rest"/&gt;</code> declares a Hot Rod connector.</p> </li> <li> <p><code>&lt;memcached-connector socket-binding="memcached"/&gt;</code> declares a Memcached connector that uses the memcached socket binding.</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/configdocs/">urn:infinispan:server</a> schema provides all available endpoint configuration.</p> </div> <div class="sect3"> <h4 id="hot_rod_connectors"><a class="anchor" href="#hot_rod_connectors"></a>2.2.1. Hot Rod Connectors</h4> <div class="paragraph"> <p>Hot Rod connector declarations enable Hot Rod servers.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;topology-state-transfer</span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;authentication&gt;</span>
    ...
  <span class="tag">&lt;/authentication&gt;</span>
  <span class="tag">&lt;encryption&gt;</span>
    ...
  <span class="tag">&lt;/encryption&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p><code>name="hotrod"</code> logically names the Memcached connector.</p> </li> <li> <p><code>topology-state-transfer</code> tunes the state transfer operations that provide Hot Rod clients with cluster topology.</p> </li> <li> <p><code>authentication</code> configures SASL authentication mechanisms.</p> </li> <li> <p><code>encryption</code> configures TLS settings for client connections.</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/configdocs/">urn:infinispan:server</a> schema provides all available Hot Rod connector configuration.</p> </div> </div> <div class="sect3"> <h4 id="rest_connectors"><a class="anchor" href="#rest_connectors"></a>2.2.2. REST Connectors</h4> <div class="paragraph"> <p>REST connector declarations enable REST servers.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;authentication&gt;</span>
    ...
  <span class="tag">&lt;/authentication&gt;</span>
  <span class="tag">&lt;cors-rules&gt;</span>
    ...
  <span class="tag">&lt;/cors-rules&gt;</span>
  <span class="tag">&lt;encryption&gt;</span>
    ...
  <span class="tag">&lt;/encryption&gt;</span>
<span class="tag">&lt;/rest-connector&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p><code>name="rest"</code> logically names the REST connector.</p> </li> <li> <p><code>authentication</code> configures authentication mechanisms.</p> </li> <li> <p><code>cors-rules</code> specifies CORS (Cross Origin Resource Sharing) rules for cross-domain requests.</p> </li> <li> <p><code>encryption</code> configures TLS settings for client connections.</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/configdocs/">urn:infinispan:server</a> schema provides all available REST connector configuration.</p> </div> </div> <div class="sect3"> <h4 id="memcached_connectors"><a class="anchor" href="#memcached_connectors"></a>2.2.3. Memcached Connectors</h4> <div class="paragraph"> <p>Memcached connector declarations enable Memcached servers.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>Infinispan servers do not enable Memcached connectors by default.</p> </div> </td> </tr> </table> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;memcached-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcached</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcached</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p><code>name="memcached"</code> logically names the Memcached connector.</p> </li> <li> <p><code>socket-binding="memcached"</code> declares a unique socket binding for the Memcached connector.</p> </li> <li> <p><code>cache="mycache"</code> names the cache that the Memcached connector exposes. The default is <code>memcachedCache</code>.</p> <div class="paragraph"> <p>Memcached connectors expose a single cache only. To expose multiple caches through the Memcached endpoint, you must declare additional connectors. Each Memcached connector must also have a unique socket binding.</p> </div> </li> </ul> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/configdocs/">urn:infinispan:server</a> schema provides all available Memcached connector configuration.</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="monitoring"><a class="anchor" href="#monitoring"></a>3. Monitoring Infinispan Servers</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="logs"><a class="anchor" href="#logs"></a>3.1. Working with Infinispan Server Logs</h3> <div class="paragraph"> <p>Infinispan uses JBoss LogManager to provide configurable logging mechanisms that capture details about the environment and record cache operations for troubleshooting purposes and root cause analysis.</p> </div> <div class="sect3"> <h4 id="infinispan_log_files"><a class="anchor" href="#infinispan_log_files"></a>3.1.1. Infinispan Log Files</h4> <div class="paragraph"> <p>Infinispan writes log messages to the following directory:<br> <code>$ISPN_HOME/${infinispan.server.root}/log</code></p> </div> <div class="dlist"> <dl> <dt class="hdlist1"><code>server.log</code></dt> <dd> <p>Messages in human readable format, including boot logs that relate to the server startup. Infinispan creates this file by default when you launch servers.</p> </dd> <dt class="hdlist1"><code>server.log.json</code></dt> <dd> <p>Messages in JSON format that let you parse and analyze Infinispan logs. Infinispan creates this file when you enable the JSON-FILE log handler.</p> </dd> </dl> </div> </div> <div class="sect3"> <h4 id="configuring_infinispan_log_properties"><a class="anchor" href="#configuring_infinispan_log_properties"></a>3.1.2. Configuring Infinispan Log Properties</h4> <div class="paragraph"> <p>You configure Infinispan logs with <code>logging.properties</code>, which is a standard Java properties file with the <code>property=value</code> format.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Open <code>$ISPN_HOME/${infinispan.server.root}/conf/logging.properties</code> with any text editor.</p> </li> <li> <p>Configure logging properties as appropriate.</p> </li> <li> <p>Save and close <code>logging.properties</code>.</p> </li> </ol> </div> <div class="sect4"> <h5 id="log_levels"><a class="anchor" href="#log_levels"></a>Log Levels</h5> <div class="paragraph"> <p>Log levels indicate the nature and severity of messages.</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Log level</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">TRACE</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Provides detailed information about running state of applications. This is the most verbose log level.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the progress of individual requests or activities.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates overall progress of applications, including lifecycle events.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates circumstances that can lead to error or degrade performance.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates error conditions that might prevent operations or activites from being successful but do not prevent applications from running.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates events that could cause critical service failure and application shutdown.</p></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="infinispan_log_categories"><a class="anchor" href="#infinispan_log_categories"></a>Infinispan Log Categories</h5> <div class="paragraph"> <p>Infinispan provides categories for INFO, WARN, ERROR, FATAL level messages that organize logs by functional area.</p> </div> <div class="dlist"> <dl> <dt class="hdlist1"><code>org.infinispan.CLUSTER</code></dt> <dd> <p>Messages specific to Infinispan clustering that include state transfer operations, rebalancing events, partitioning, and so on.</p> </dd> <dt class="hdlist1"><code>org.infinispan.CONFIG</code></dt> <dd> <p>Messages specific to Infinispan configuration.</p> </dd> <dt class="hdlist1"><code>org.infinispan.CONTAINER</code></dt> <dd> <p>Messages specific to the data container that include expiration and eviction operations, cache listener notifications, transactions, and so on.</p> </dd> <dt class="hdlist1"><code>org.infinispan.PERSISTENCE</code></dt> <dd> <p>Messages specific to cache loaders and stores.</p> </dd> <dt class="hdlist1"><code>org.infinispan.SECURITY</code></dt> <dd> <p>Messages specific to Infinispan security.</p> </dd> <dt class="hdlist1"><code>org.infinispan.SERVER</code></dt> <dd> <p>Messages specific to Infinispan servers.</p> </dd> <dt class="hdlist1"><code>org.infinispan.XSITE</code></dt> <dd> <p>Messages specific to cross-site replication operations.</p> </dd> </dl> </div> </div> <div class="sect4"> <h5 id="root_logger"><a class="anchor" href="#root_logger"></a>Root Logger</h5> <div class="paragraph"> <p>The root logger is <code>org.infinispan</code> and is always configured. This logger captures all messages for Infinispan log categories.</p> </div> </div> <div class="sect4"> <h5 id="log_handlers"><a class="anchor" href="#log_handlers"></a>Log Handlers</h5> <div class="paragraph"> <p>Log handlers define how Infinispan records log messages.</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">CONSOLE</dt> <dd> <p>Write log messages to the host standard out (<code>stdout</code>) or standard error (<code>stderr</code>) stream.<br> Uses the <code>org.jboss.logmanager.handlers.ConsoleHandler</code> class by default.</p> </dd> <dt class="hdlist1">FILE</dt> <dd> <p>Write log messages to a file.<br> Uses the <code>org.jboss.logmanager.handlers.PeriodicRotatingFileHandler</code> class by default.</p> </dd> <dt class="hdlist1">JSON-FILE</dt> <dd> <p>Write log messages to a file in JSON format.<br> Uses the <code>org.jboss.logmanager.handlers.PeriodicRotatingFileHandler</code> class by default.</p> </dd> </dl> </div> </div> <div class="sect4"> <h5 id="log_formatters"><a class="anchor" href="#log_formatters"></a>Log Formatters</h5> <div class="paragraph"> <p>Log formatters:</p> </div> <div class="ulist"> <ul> <li> <p>Configure log handlers and define the appearance of log messages.</p> </li> <li> <p>Are strings that use syntax based on the <code>java.util.logging.Formatter</code> class.</p> </li> </ul> </div> <div class="paragraph"> <p>An example is the default pattern for messages with the FILE log handler:<br> <code>%d{yyyy-MM-dd HH\:mm\:ss,SSS} %-5p [%c] (%t) %s%e%n</code></p> </div> <div class="ulist"> <ul> <li> <p><code>%d</code> adds the current time and date.</p> </li> <li> <p><code>%-5p</code> specifies the log level.</p> </li> <li> <p><code>%c</code> specifies the logging category.</p> </li> <li> <p><code>%t</code> adds the name of the current thread.</p> </li> <li> <p><code>%s</code> specifies the simple log message.</p> </li> <li> <p><code>%e</code> adds the exception stack trace.</p> </li> <li> <p><code>%n</code> adds a new line.</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.logging/java/util/logging/Formatter.html">java.util.logging.Formatter</a></p> </div> </div> <div class="sect4"> <h5 id="enabling_and_configuring_the_json_log_handler"><a class="anchor" href="#enabling_and_configuring_the_json_log_handler"></a>Enabling and Configuring the JSON Log Handler</h5> <div class="paragraph"> <p>Infinispan provides a JSON log handler to write messages in JSON format.</p> </div> <div class="paragraph"> <div class="title">Prerequisites</div> <p>Ensure that Infinispan is not running. You cannot dynamically enable log handlers.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Open <code>$ISPN_HOME/${infinispan.server.root}/conf/logging.properties</code> with any text editor.</p> </li> <li> <p>Add <code>JSON-FILE</code> as a log handler, for example:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>logger.handlers=CONSOLE,FILE,JSON-FILE</code></pre> </div> </div> </li> <li> <p>Optionally configure the JSON log handler and formatter.</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>Use the <code>handler.JSON-FILE</code> property to configure the JSON log handler.</p> </li> <li> <p>Use the <code>formatter.JSON-FORMATTER</code> property to configure the JSON log formatter.</p> </li> </ol> </div> </li> <li> <p>Save and close <code>logging.properties</code>.</p> </li> </ol> </div> <div class="paragraph"> <p>When you start Infinispan, it writes each log message as a JSON map in the following file:<br> <code>$ISPN_HOME/${infinispan.server.root}/log/server.log.json</code></p> </div> </div> </div> <div class="sect3"> <h4 id="logging_framework"><a class="anchor" href="#logging_framework"></a>3.1.3. Logging Framework</h4> <div class="paragraph"> <p>Infinispan uses the JBoss Logging Framework and delegates to logging providers in the following order:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>JBoss Logging, if you are running Infinispan servers.</p> </li> <li> <p>Apache Log4j, if <code>org.apache.log4j.LogManager</code> and <code>org.apache.log4j.Hierarchy</code> are on the classpath.</p> </li> <li> <p>LogBack, if <code>ch.qos.logback.classic.Logger</code> is on the classpath.</p> </li> <li> <p>JDK logging (<code>java.util.logging</code>), if no other logging provider is available.</p> </li> </ol> </div> </div> <div class="sect3"> <h4 id="server_access_logs"><a class="anchor" href="#server_access_logs"></a>3.1.4. Access Logs</h4> <div class="paragraph"> <p>Hot Rod and REST endpoints can record all inbound client requests as log entries with the following categories:</p> </div> <div class="ulist"> <ul> <li> <p><code>org.infinispan.HOTROD_ACCESS_LOG</code> logging category for the Hot Rod endpoint.</p> </li> <li> <p><code>org.infinispan.REST_ACCESS_LOG</code> logging category for the REST endpoint.</p> </li> </ul> </div> <div class="sect4"> <h5 id="enabling_access_logs"><a class="anchor" href="#enabling_access_logs"></a>Enabling Access Logs</h5> <div class="paragraph"> <p>Access logs for Hot Rod and REST endpoints are disabled by default. To enable either logging category, set the level to <code>TRACE</code> in the Infinispan server configuration, as in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;logger</span> <span class="attribute-name">category</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.HOTROD_ACCESS_LOG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use-parent-handlers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;level</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;handlers&gt;</span>
       <span class="tag">&lt;handler</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HR-ACCESS-FILE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/handlers&gt;</span>
<span class="tag">&lt;/logger&gt;</span></code></pre> </div> </div> </div> <div class="sect4"> <h5 id="access_log_properties"><a class="anchor" href="#access_log_properties"></a>Access Log Properties</h5> <div class="paragraph"> <p>The default format for access logs is as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>`%X{address} %X{user} [%d{dd/MMM/yyyy:HH:mm:ss z}] &amp;quot;%X{method} %m %X{protocol}&amp;quot; %X{status} %X{requestSize} %X{responseSize} %X{duration}%n`</code></pre> </div> </div> <div class="paragraph"> <p>The preceding format creates log entries such as the following:</p> </div> <div class="paragraph"> <p><code>127.0.0.1 - [DD/MM/YYYY:HH:MM:SS] "PUT /rest/v2/caches/default/key HTTP/1.1" 404 5 77 10</code></p> </div> <div class="paragraph"> <p>Logging properties use the <code>%X{name}</code> notation and let you modify the format of access logs. The following are the default logging properties:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Either the <code>X-Forwarded-For</code> header or the client IP address.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Principal name, if using authentication.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Method used. <code>PUT</code>, <code>GET</code>, and so on.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Protocol used. <code>HTTP/1.1</code>, <code>HTTP/2</code>, <code>HOTROD/2.9</code>, and so on.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP status code for the REST endpoint. <code>OK</code> or an exception for the Hot Rod endpoint.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestSize</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the request.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseSize</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the response.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds that the server took to handle the request.</p></td> </tr> </tbody> </table> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>Use the header name prefixed with <code>h:</code> to log headers that were included in requests; for example, <code>%X{h:User-Agent}</code>.</p> </div> </td> </tr> </table> </div> </div> </div> </div> <div class="sect2"> <h3 id="server_health"><a class="anchor" href="#server_health"></a>3.2. Retrieving Server Health Statistics</h3> <div class="paragraph"> <p>Monitor the health of your Infinispan clusters in the following ways:</p> </div> <div class="ulist"> <ul> <li> <p>Programmatically with <code>embeddedCacheManager.getHealth()</code> method calls.</p> </li> <li> <p>JMX MBeans</p> </li> <li> <p>Infinispan REST Server</p> </li> </ul> </div> <div class="sect3"> <h4 id="accessing_the_health_api_via_jmx"><a class="anchor" href="#accessing_the_health_api_via_jmx"></a>3.2.1. Accessing the Health API via JMX</h4> <div class="paragraph"> <p>Retrieve Infinispan cluster health statistics via JMX.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Connect to Infinispan server using any JMX capable tool such as JConsole and navigate to the following object:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>org.infinispan:type=CacheManager,name=&quot;default&quot;,component=CacheContainerHealth</code></pre> </div> </div> </li> <li> <p>Select available MBeans to retrieve cluster health statistics.</p> </li> </ol> </div> </div> <div class="sect3"> <h4 id="accessing_the_health_api_via_rest"><a class="anchor" href="#accessing_the_health_api_via_rest"></a>3.2.2. Accessing the Health API via REST</h4> <div class="paragraph"> <p>Get Infinispan cluster health via the REST API.</p> </div> <div class="ulist"> <div class="title">Procedure</div> <ul> <li> <p>Invoke a <code>GET</code> request to retrieve cluster health.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">GET /rest/v2/cache-managers/{cacheManagerName}/health</code></pre> </div> </div> </li> </ul> </div> <div class="paragraph"> <p>Infinispan responds with a <code>JSON</code> document such as the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cluster_health</span><span class="delimiter">&quot;</span></span>:{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cluster_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ISPN</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">health_status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">number_of_nodes</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">node_names</span><span class="delimiter">&quot;</span></span>:[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">NodeA-36229</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">NodeB-28703</span><span class="delimiter">&quot;</span></span>
        ]
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_health</span><span class="delimiter">&quot;</span></span>:[
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">___protobuf_metadata</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">cache2</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">cache1</span><span class="delimiter">&quot;</span></span>
        }
    ]

}</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>Get cache manager status as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>GET /rest/v2/cache-managers/{cacheManagerName}/health/status</code></pre> </div> </div> </td> </tr> </table> </div> <div class="paragraph"> <div class="title">Reference</div> <p>See the <em>REST v2 (version 2) API</em> documentation for more information.</p> </div> </div> </div> <div class="sect2"> <h3 id="monitoring_infinispan_servers_over_jmx"><a class="anchor" href="#monitoring_infinispan_servers_over_jmx"></a>3.3. Monitoring Infinispan Servers Over JMX</h3> <div class="paragraph"> <p>You can monitor an Infinispan Server over JMX in two ways:</p> </div> <div class="ulist"> <ul> <li> <p>Use JConsole or VisualVM running locally as the same user. This will use a local <a href="http://www.oracle.com/technetwork/java/jvmstat-142257.html">jvmstat</a> connection and requires no additional setup</p> </li> <li> <p>Use JMX remoting (aka JSR-160) to connect from any host. This requires connecting through the management port (usually 9990) using a special protocol which respects the server security configuration</p> </li> </ul> </div> <div class="paragraph"> <p>To setup a client for JMX remoting you need to add the $ISPN_HOME/bin/client/jboss-client.jar to your client&#8217;s classpath and use one of the following service URLs:</p> </div> <div class="ulist"> <ul> <li> <p><code>service:jmx:remote-http-jmx://host:port</code> for plain connections through the management interface</p> </li> <li> <p><code>service:jmx:remote-https-jmx://host:port</code> for TLS connections through the management interface (although this requires having the appropriate keys available)</p> </li> <li> <p><code>service:jmx:remoting-jmx://localhost:port</code> for connections through the remoting interface (necessary for connecting to individual servers in a domain)</p> </li> </ul> </div> <div class="paragraph"> <p>The JMX subsystem registers a service with the Remoting endpoint so that remote access to JMX can be obtained over the exposed Remoting connector. This is switched on by default in standalone mode and accessible over port 9990 but in domain mode it is switched off so it needs to be enabled. In domain mode the port will be the port of the Remoting connector for the Server instance to be monitored.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:jmx:1.3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;expose-resolved-model</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;expose-expression-model</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;remoting-connector</span> <span class="attribute-name">use-management-endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="jmx_mgmt_tooling"><a class="anchor" href="#jmx_mgmt_tooling"></a>3.3.1. JMX Monitoring</h4> <div class="paragraph"> <p>Management of Infinispan instances is all about exposing as much relevant statistical information that allows administrators to get a view of the state of each Infinispan instance. Taking in account that a single installation could be made up of several tens or hundreds Infinispan instances, providing clear and concise information in an efficient manner is imperative. The following sections dive into the range of management tooling that Infinispan provides.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>Any management tool that supports JMX already has basic support for Infinispan. However, custom plugins could be written to adapt the JMX information for easier consumption.</p> </div> </td> </tr> </table> </div> <div class="sect4"> <h5 id="jmx"><a class="anchor" href="#jmx"></a>JMX</h5> <div class="paragraph"> <p>Over the years, <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX</a> has become the de facto standard for management and administration of middleware and as a result, the Infinispan team has decided to standardize on this technology for the exposure of management and statistical information.</p> </div> <div class="sect5"> <h6 id="understanding_the_exposed_mbeans"><a class="anchor" href="#understanding_the_exposed_mbeans"></a>Understanding The Exposed MBeans</h6> <div class="paragraph"> <p>By connecting to the VM(s) where Infinispan is running with a standard JMX GUI such as <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/management/jconsole.html">JConsole</a> or <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/visualvm/">VisualVM</a> you should find the following MBeans:</p> </div> <div class="ulist"> <ul> <li> <p>For CacheManager level JMX statistics, without further configuration, you should see an MBean called <em>org.infinispan:type=CacheManager,name="DefaultCacheManager"</em> with <a href="https://docs.jboss.org/infinispan/10.1/apidocs/jmxComponents.html#CacheManager">properties specified by the CacheManager MBean</a> .</p> </li> <li> <p>Using the cacheManagerName attribute in globalJmxStatistics XML element, or using the corresponding GlobalJmxStatisticsConfigurationBuilder.cacheManagerName(String cacheManagerName) call, you can name the cache manager in such way that the name is used as part of the JMX object name. So, if the name had been "Hibernate2LC", the JMX name for the cache manager would have been: <em>org.infinispan:type=CacheManager,name="Hibernate2LC"</em> . This offers a nice and clean way to manage environments where multiple cache managers are deployed, which follows <a href="http://www.oracle.com/technetwork/java/javase/tech/best-practices-jsp-136021.html">JMX best practices</a> .</p> </li> <li> <p>For Cache level JMX statistics, you should see several different MBeans depending on which configuration options have been enabled. For example, if you have configured a write behind cache store, you should see an MBean exposing properties belonging to the cache store component. All Cache level MBeans follow the same format though which is the following: <code>org.infinispan:type=Cache,name="${name-of-cache}(${cache-mode})",manager="${name-of-cache-manager}",component=${component-name}</code> where:</p> </li> <li> <p>${name-of-cache} has been substituted by the actual cache name. If this cache represents the default cache, its name will be <code>___defaultCache</code>.</p> </li> <li> <p>${cache-mode} has been substituted by the cache mode of the cache. The cache mode is represented by the lower case version of the possible enumeration values shown <a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/configuration/cache/CacheMode">here</a>.</p> </li> <li> <p>${name-of-cache-manager} has been substituted by the name of the cache manager to which this cache belongs. The name is derived from the <em>cacheManagerName</em> attribute value in <code>globalJmxStatistics</code> element.</p> </li> <li> <p>${component-name} has been substituted by one of the JMX component names in the <a href="https://docs.jboss.org/infinispan/10.1/apidocs/jmxComponents.html">JMX reference documentation</a> .</p> </li> </ul> </div> <div class="paragraph"> <p>For example, the cache store JMX component MBean for a default cache configured with synchronous distribution would have the following name: <code>org.infinispan:type=Cache,name="___defaultcache(dist_sync)",manager="DefaultCacheManager",component=CacheStore</code></p> </div> <div class="paragraph"> <p>Please note that cache and cache manager names are quoted to protect against illegal characters being used in these user-defined names.</p> </div> </div> <div class="sect5"> <h6 id="enabling_jmx_statistics"><a class="anchor" href="#enabling_jmx_statistics"></a>Enabling JMX Statistics</h6> <div class="paragraph"> <p>The MBeans mentioned in the previous section are always created and registered in the MBeanServer allowing you to manage your caches but some of their attributes do not expose meaningful values unless you take the extra step of enabling collection of statistics. Gathering and reporting statistics via JMX can be enabled at 2 different levels:</p> </div> <div class="paragraph"> <div class="title">CacheManager level</div> <p>The CacheManager is the entity that governs all the cache instances that have been created from it. Enabling CacheManager statistics collections differs depending on the configuration style:</p> </div> <div class="ulist"> <ul> <li> <p>If configuring the CacheManager via XML, make sure you add the following XML under the <code>&lt;cache-container /&gt;</code> element:</p> <div class="literalblock"> <div class="content"> <pre>&lt;cache-container statistics="true"/&gt;</pre> </div> </div> </li> <li> <p>If configuring the CacheManager programmatically, simply add the following code:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">GlobalConfigurationBuilder globalConfigurationBuilder = ...
globalConfigurationBuilder.globalJmxStatistics().enable();</code></pre> </div> </div> <div class="paragraph"> <div class="title">Cache level</div> <p>At this level, you will receive management information generated by individual cache instances. Enabling Cache statistics collections differs depending on the configuration style:</p> </div> <div class="ulist"> <ul> <li> <p>If configuring the Cache via XML, make sure you add the following XML under the one of the top level cache elements, such as <code>&lt;local-cache /&gt;</code>:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;local-cache</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p>If configuring the Cache programmatically, simply add the following code:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder configurationBuilder = ...
configurationBuilder.jmxStatistics().enable();</code></pre> </div> </div> </div> <div class="sect5"> <h6 id="monitoring_cluster_health"><a class="anchor" href="#monitoring_cluster_health"></a>Monitoring cluster health</h6> <div class="paragraph"> <p>It is also possible to monitor Infinispan cluster health using JMX. On CacheManager there&#8217;s an additional object called <code>CacheContainerHealth</code>. It contains the following attributes:</p> </div> <div class="ulist"> <ul> <li> <p>cacheHealth - a list of caches and corresponding statuses (HEALTHY, DEGRADED or HEALTHY_REBALANCING)</p> </li> <li> <p>clusterHealth - overall cluster health</p> </li> <li> <p>clusterName - cluster name</p> </li> <li> <p>freeMemoryKb - Free memory obtained from JVM runtime measured in KB</p> </li> <li> <p>numberOfCpus - The number of CPUs obtained from JVM runtime</p> </li> <li> <p>numberOfNodes - The number of nodes in the cluster</p> </li> <li> <p>totalMemoryKb - Total memory obtained from JVM runtime measured in KB</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="multiple_jmx_domains"><a class="anchor" href="#multiple_jmx_domains"></a>Multiple JMX Domains</h6> <div class="paragraph"> <p>There can be situations where several CacheManager instances are created in a single VM, or Cache names belonging to different CacheManagers under the same VM clash.</p> </div> <div class="paragraph"> <p>Using different JMX domains for multi cache manager environments should be last resort. Instead, it&#8217;s possible to name a cache manager in such way that it can easily be identified and used by monitoring tools. For example:</p> </div> <div class="ulist"> <ul> <li> <p>Via XML:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hibernate2LC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p>Programmatically:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">GlobalConfigurationBuilder globalConfigurationBuilder = ...
globalConfigurationBuilder.globalJmxStatistics()
    .enable()
    .cacheManagerName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hibernate2LC</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>Using either of these options should result on the CacheManager MBean name being: <code>org.infinispan:type=CacheManager,name="Hibernate2LC"</code></p> </div> <div class="paragraph"> <p>For the time being, you can still set your own jmxDomain if you need to and we also allow duplicate domains, or rather duplicate JMX names, but these should be limited to very special cases where different cache managers within the same JVM are named equally.</p> </div> </div> <div class="sect5"> <h6 id="registering_mbeans_in_non_default_mbean_servers"><a class="anchor" href="#registering_mbeans_in_non_default_mbean_servers"></a>Registering MBeans In Non-Default MBean Servers</h6> <div class="paragraph"> <p>Let&#8217;s discuss where Infinispan registers all these MBeans. By default, Infinispan registers them in the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/ManagementFactory.html#getPlatformMBeanServer--">standard JVM MBeanServer platform</a> . However, users might want to register these MBeans in a different MBeanServer instance. For example, an application server might work with a different MBeanServer instance to the default platform one. In such cases, users should implement the <a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/jmx/MBeanServerLookup.html">MBeanServerLookup interface</a> provided by Infinispan so that the <a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/jmx/MBeanServerLookup.html#getMBeanServer--">getMBeanServer() method</a> returns the MBeanServer under which Infinispan should register the management MBeans. Once you have your implementation ready, simply configure Infinispan with the fully qualified name of this class. For example:</p> </div> <div class="ulist"> <ul> <li> <p>Via XML:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;jmx</span> <span class="attribute-name">mbean-server-lookup</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p>Programmatically:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">GlobalConfigurationBuilder globalConfigurationBuilder = ...
globalConfigurationBuilder.globalJmxStatistics()
    .enable()
    .mBeanServerLookup(<span class="keyword">new</span> com.acme.MyMBeanServerLookup());</code></pre> </div> </div> </div> <div class="sect5"> <h6 id="available_mbeans"><a class="anchor" href="#available_mbeans"></a>Available MBeans</h6> <div class="paragraph"> <p>For a complete list of available MBeans, refer to the <a href="https://docs.jboss.org/infinispan/10.1/apidocs/jmxComponents.html">JMX reference documentation</a></p> </div> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="security"><a class="anchor" href="#security"></a>4. Securing Infinispan Servers</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="security_concepts"><a class="anchor" href="#security_concepts"></a>4.1. Security Concepts</h3> <div class="sect3"> <h4 id="authorization"><a class="anchor" href="#authorization"></a>4.1.1. Authorization</h4> <div class="paragraph"> <p>Just like embedded mode, the server supports cache authorization using the same configuration, e.g.:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
   <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
         <span class="tag">&lt;authorization&gt;</span>
            <span class="tag">&lt;identity-role-mapper</span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">WRITE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supervisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ WRITE EXEC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/authorization&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;security&gt;</span>
            <span class="tag">&lt;authorization</span> <span class="attribute-name">roles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin reader writer supervisor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
         <span class="tag">&lt;/security&gt;</span>
      <span class="tag">&lt;/local-cache&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>

<span class="tag">&lt;/infinispan&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="server_realms"><a class="anchor" href="#server_realms"></a>4.1.2. Server Realms</h4> <div class="paragraph"> <p>Infinispan Server security is built around the features provided by the underlying server realm and security domains. Security Realms are used by the server to provide authentication and authorization information for both the management and application interfaces.</p> </div> <div class="listingblock"> <div class="title">Security Realm configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;server</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:2.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;management&gt;</span>
        ...
        <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           <span class="tag">&lt;authentication&gt;</span>
              <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;/authentication&gt;</span>
           <span class="tag">&lt;authorization&gt;</span>
              <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-roles.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;/authorization&gt;</span>
        <span class="tag">&lt;/security-realm&gt;</span>
        ...
    <span class="tag">&lt;/management&gt;</span>
    ...
<span class="tag">&lt;/server&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Infinispan Server comes with an add-user.sh script (add-user.bat for Windows) to ease the process of adding new user/role mappings to the above property files. An example invocation for adding a user to the ApplicationRealm with an initial set of roles:</p> </div> <div class="paragraph"> <p>./bin/add-user.sh -a -u myuser -p "qwer1234!" -ro supervisor,reader,writer</p> </div> <div class="paragraph"> <p>It is also possible to authenticate/authorize against alternative sources, such as LDAP, JAAS, etc.</p> </div> <div class="paragraph"> <p>Bear in mind that the choice of authentication mechanism you select for the protocols limits the type of authentication sources, since the credentials must be in a format supported by the algorithm itself (e.g. pre-digested passwords for the digest algorithm)</p> </div> </div> </div> <div class="sect2"> <h3 id="security_hotrod_auth"><a class="anchor" href="#security_hotrod_auth"></a>4.2. Hot Rod Authentication</h3> <div class="paragraph"> <p>The Hot Rod protocol supports authentication by leveraging the SASL mechanisms. The supported SASL mechanisms (usually shortened as mechs) are:</p> </div> <div class="ulist"> <ul> <li> <p>PLAIN - This is the most insecure mech, since credentials are sent over the wire in plain-text format, however it is the simplest to get to work. In combination with encryption (i.e. TLS) it can be used safely</p> </li> <li> <p>DIGEST-MD5 - This mech hashes the credentials before sending them over the wire, so it is more secure than PLAIN</p> </li> <li> <p>GSSAPI - This mech uses Kerberos tickets, and therefore requires the presence of a properly configured Kerberos Domain Controller (such as Microsoft Active Directory)</p> </li> <li> <p>EXTERNAL - This mech obtains credentials from the underlying transport (i.e. from a X.509 client certificate) and therefore requires encryption using client-certificates to be enabled.</p> </li> </ul> </div> <div class="paragraph"> <p>The following configuration enables authentication against ApplicationRealm, using the DIGEST-MD5 SASL mechanism and only enables the <strong>auth</strong> QoP (see <a href="#security_saslqop">SASL Quality of Protection</a>):</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Notice the server-name attribute: it is the name that the server declares to incoming clients and therefore the client configuration must match. It is particularly important when using GSSAPI as it is equivalent to the Kerberos service name. You can specify multiple mechanisms and they will be attempted in order.</p> </div> <div class="sect3"> <h4 id="security_saslqop"><a class="anchor" href="#security_saslqop"></a>4.2.1. SASL Quality of Protection</h4> <div class="paragraph"> <p>While the main purpose of SASL is to provide authentication, some mechanisms also support integrity and privacy protection, also known as Quality of Protection (or qop). During authentication negotiation, ciphers are exchanged between client and server, and they can be used to add checksums and encryption to all subsequent traffic. You can tune the required level of qop as follows:</p> </div> <table class="tableblock frame-all grid-all fit-content"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">QOP</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">auth</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication only</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">auth-int</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity protection</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">auth-conf</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity and privacy protection</p></td> </tr> </tbody> </table> </div> <div class="sect3"> <h4 id="sasl_policies"><a class="anchor" href="#sasl_policies"></a>4.2.2. SASL Policies</h4> <div class="paragraph"> <p>You can further refine the way a mechanism is chosen by tuning the SASL policies. This will effectively include / exclude mechanisms based on whether they match the desired policies.</p> </div> <table class="tableblock frame-all grid-all fit-content"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Policy</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">forward-secrecy</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must support forward secrecy between sessions. This means that breaking into one session will not automatically provide information for breaking into future sessions.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">pass-credentials</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must require client credentials.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-plain-text</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to simple plain passive attacks.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-active</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to active (non-dictionary) attacks. The mechanism might require mutual authentication as a way to prevent active attacks.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-dictionary</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to passive dictionary attacks.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-anonymous</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not accept anonymous logins.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Each policy&#8217;s value is either "true" or "false". If a policy is absent, then the chosen mechanism need not have that characteristic (equivalent to setting the policy to "false"). One notable exception is the <strong>no-anonymous</strong> policy which, if absent, defaults to true, thus preventing anonymous connections.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> It is possible to have mixed anonymous and authenticated connections to the endpoint, delegating actual access logic to cache authorization configuration. To do so, set the <strong>no-anonymous</strong> policy to false and turn on cache authorization. </td> </tr> </table> </div> <div class="paragraph"> <p>The following configuration selects all available mechanisms, but effectively only enables GSSAPI, since it is the only one that respects all chosen policies:</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector policies</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAIN DIGEST-MD5 GSSAPI EXTERNAL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;policy&gt;</span>
            <span class="tag">&lt;no-active</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;no-anonymous</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;no-plain-text</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
         <span class="tag">&lt;/policy</span><span class="error">&lt;</span><span class="error">&gt;</span>
      <span class="tag">&lt;/sasl&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="using_gssapikerberos"><a class="anchor" href="#using_gssapikerberos"></a>4.2.3. Using GSSAPI/Kerberos</h4> <div class="paragraph"> <p>If you want to use GSSAPI/Kerberos, setup and configuration differs. First we need to define a Kerberos login module using the security domain subsystem:</p> </div> <div class="listingblock"> <div class="title">Security domain configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;system-properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.security.krb5.conf</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/infinispan/krb5.conf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.security.krb5.debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.security.disable.secdomain.option</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/system-properties&gt;</span>

<span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kerberos</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">storeKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refreshKrb5Config</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useKeyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doNotPrompt</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/infinispan/infinispan.keytab</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HOTROD/localhost@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/login-module&gt;</span>
    <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/security-domain&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Next we need to modify the Hot Rod connector</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">server-context-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GSSAPI</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="security_hotrod_rest_encryption"><a class="anchor" href="#security_hotrod_rest_encryption"></a>4.3. Hot Rod and REST encryption (TLS/SSL)</h3> <div class="paragraph"> <p>Both Hot Rod and REST protocols support encryption using SSL/TLS with optional TLS/SNI support (<a href="https://en.wikipedia.org/wiki/Server_Name_Indication">Server Name Indication</a>). To set this up you need to create a keystore using the keytool application which is part of the JDK to store your server certificate. Then add a &lt;server-identities&gt; element to your security realm:</p> </div> <div class="listingblock"> <div class="title">Security Realm configuration for SSL</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
            <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
    <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>When using SNI support there might be multiple Security Realms configured.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>It is also possible to generate development certificates on server startup. In order to do this, just specify <code>generate-self-signed-certificate-host</code> in the keystore element as shown below:</p> </div> <div class="listingblock"> <div class="title">Generating Keystore automatically</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
            <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">generate-self-signed-certificate-host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
    <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>There are three basic principles that you should remember when using automatically generated keystores:</p> </div> <div class="ulist"> <ul> <li> <p>They shouldn&#8217;t be used on a production environment</p> </li> <li> <p>They are generated when necessary (e.g. while obtaining the first connection from the client)</p> </li> <li> <p>They contain also certificates so they might be used in a Hot Rod client directly</p> </li> </ul> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>Next modify the &lt;hotrod-connector&gt; and/or &lt;rest-connector&gt; elements in the endpoint subsystem to require encryption. Optionally add SNI configuration:</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector SSL configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;encryption</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain1ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain2ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/encryption&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span>
<span class="tag">&lt;rest-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;encryption</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain1ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain2ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/encryption&gt;</span>
<span class="tag">&lt;/rest-connector&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> To configure the client In order to connect to the server using the Hot Rod protocol, the client needs a trust store containing the public key of the server(s) you are going to connect to, unless the key was signed by a Certification Authority (CA) trusted by the JRE. </td> </tr> </table> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(<span class="integer">11222</span>)
     .security()
        .ssl()
           .enabled(<span class="predefined-constant">true</span>)
           .sniHostName(<span class="string"><span class="delimiter">&quot;</span><span class="content">domain1</span><span class="delimiter">&quot;</span></span>)
           .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_client.jks</span><span class="delimiter">&quot;</span></span>)
           .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray());
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre> </div> </div> <div class="paragraph"> <p>Additionally, you might also want to enable client certificate authentication (and optionally also allow the use of the EXTERNAL SASL mech to authenticate and authorize clients). To enable this you will need the security realm on the server to be able to trust incoming client certificates by adding a trust store:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication&gt;</span>
      <span class="tag">&lt;truststore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
   <span class="tag">&lt;server-identities&gt;</span>
       <span class="tag">&lt;ssl&gt;</span>
           <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
       <span class="tag">&lt;/ssl&gt;</span>
   <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>And then tell the connector to require a client certificate:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;encryption</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The client, at this point, will also need to specify a keyStore which contains its certificate on top of the trustStore which trusts the server certificate.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_single_port"><a class="anchor" href="#server_single_port"></a>5. Single Port</h2> <div class="sectionbody"> <div class="paragraph"> <p>Single-Port is a special type of router connector which allows exposing multiple protocols over the same TCP port. This approach is very convenient because it reduces the number of ports required by a server, with advantages in security, configuration and management. Protocol switching is handled in three ways:</p> </div> <div class="ulist"> <ul> <li> <p><strong>HTTP/1.1 Upgrade header</strong>: initiate an HTTP/1.1 connection and send an <code>Upgrade: protocol</code> header where protocol is the name assigned to the desired endpoint.</p> </li> <li> <p><strong>TLS/ALPN</strong>: protocol selection is performed based on the SNI specified by the client.</p> </li> <li> <p><strong>Hot Rod header detection</strong>: if a Hot Rod endpoint is present in the router configuration, then any attempt to send a Hot Rod header will be detected and the protocol will be switched automatically.</p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>The initial implementation supports only HTTP/1.1, HTTP/2 and Hot Rod protocols. The Memcached protocol is not supported.</p> </div> </td> </tr> </table> </div> <div class="sect2"> <h3 id="single_port_router"><a class="anchor" href="#single_port_router"></a>5.1. Single-Port router</h3> <div class="paragraph"> <p>Internally, Single-Port is based on the same router component used to enable multi-tenancy, and therefore it shares the same configuration.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- TLS/ALPN negotiation --&gt;</span>
<span class="tag">&lt;router-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">router-ssl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">single-port-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-ssl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;single-port</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLRealm1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/single-port&gt;</span>
<span class="tag">&lt;/router-connector&gt;</span>
<span class="comment">&lt;!-- HTTP 1.1/Upgrade procedure --&gt;</span>
<span class="tag">&lt;router-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">router</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">single-port-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;single-port&gt;</span>
        <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/single-port&gt;</span>
<span class="tag">&lt;/router-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>With the configuration above, the Single-Port Router will operate on <code>rest</code> and <code>rest-ssl</code> socket bindings. The router named <code>router</code> should typically operate on port <code>8080</code> and will use HTTP/1.1 Upgrade (also known as <em>cleartext upgrade</em>) procedure. The other router instance (called <code>router-ssl</code>) should typically operate on port <code>8443</code> and will use TLS/ALPN.</p> </div> <div class="sect3"> <h4 id="testing_the_single_port_router"><a class="anchor" href="#testing_the_single_port_router"></a>5.1.1. Testing the Single-Port router</h4> <div class="paragraph"> <p>A tool such as <code>curl</code> can be used to access cache using both <em>cleartext upgrade</em> or TLS/ALPN. Here&#8217;s an example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">$ curl -v -k --http2-prior-knowledge https://127.0.0.1:8443/rest/v2/caches/default/test</code></pre> </div> </div> <div class="paragraph"> <p>The <code>--http2-prior-knowledge</code> can be exchanged with <code>--http2</code> switch allowing to control how the switch procedure is being done (via Plain-Text Upgrade or TLS/ALPN).</p> </div> </div> </div> <div class="sect2"> <h3 id="hot_rod_protocol_detection"><a class="anchor" href="#hot_rod_protocol_detection"></a>5.2. Hot Rod Protocol Detection</h3> <div class="paragraph"> <p>The single-port router has built-in automatic detection of Hot Rod messages which trigger a transparent "upgrade" to the Hot Rod protocol. This means that no changes are required on the client side to connect to a single-port endpoint. It also means that older clients will also be able to function seamlessly.</p> </div> <div class="sect3"> <h4 id="tlsalpn_protocol_selection"><a class="anchor" href="#tlsalpn_protocol_selection"></a>5.2.1. TLS/ALPN protocol selection</h4> <div class="paragraph"> <p>Another supported way to select the protocol is to use TLS/ALPN which uses the <a href="https://tools.ietf.org/html/rfc7301">Application-Layer Protocol Negotiation</a> spec. This feature requires that you have configured your endpoint to enable TLS.</p> </div> <div class="sect4"> <h5 id="enabling_alpn"><a class="anchor" href="#enabling_alpn"></a>Enabling ALPN</h5> <div class="paragraph"> <p>If you are using JDK 9 or greater, ALPN is supported by default. However, if you are using JDK 8, you will need to use <a href="https://netty.io/wiki/forked-tomcat-native.html">Netty&#8217;s BoringSSL</a> library, which leverages native libraries to enable ALPN.</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Add Netty dependencies.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
      <span class="tag">&lt;dependency&gt;</span>
         <span class="tag">&lt;groupId&gt;</span>io.netty<span class="tag">&lt;/groupId&gt;</span>
         <span class="tag">&lt;artifactId&gt;</span>netty-bom<span class="tag">&lt;/artifactId&gt;</span>
         <span class="comment">&lt;!-- Pulled from Infinispan BOM --&gt;</span>
         <span class="tag">&lt;version&gt;</span>${version.netty}<span class="tag">&lt;/version&gt;</span>
         <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
         <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
      <span class="tag">&lt;/dependency&gt;</span>
   <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>io.netty<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>netty-tcnative-boringssl-static<span class="tag">&lt;/artifactId&gt;</span>
   <span class="comment">&lt;!-- The version is defined in Netty BOM --&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> </li> <li> <p>Configure your trust store accordingly:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder()
      .addServers(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1:8443</span><span class="delimiter">&quot;</span></span>);

builder.security().ssl().enable()
      .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore.pkcs12</span><span class="delimiter">&quot;</span></span>)
      .trustStorePassword(DEFAULT_TRUSTSTORE_PASSWORD.toCharArray());

RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="content">);</span></span></code></pre> </div> </div> </li> </ol> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="remote_server_execution"><a class="anchor" href="#remote_server_execution"></a>6. Remotely Executing Server-Side Tasks</h2> <div class="sectionbody"> <div class="paragraph"> <p>Define and add tasks to Infinispan servers that you can invoke from the Infinispan command line interface, REST API, or from Hot Rod clients.</p> </div> <div class="paragraph"> <p>You can implement tasks as custom Java classes or define scripts in languages such as JavaScript.</p> </div> <div class="sect2"> <h3 id="server_tasks"><a class="anchor" href="#server_tasks"></a>6.1. Creating Server Tasks</h3> <div class="paragraph"> <p>Create custom task implementations and add them to Infinispan servers.</p> </div> <div class="sect3"> <h4 id="tasks"><a class="anchor" href="#tasks"></a>6.1.1. Server Tasks</h4> <div class="paragraph"> <p>Infinispan server tasks are classes that extend the <code>org.infinispan.tasks.ServerTask</code> interface and generally include the following method calls:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1"><code>setTaskContext()</code></dt> <dd> <p>Allows access to execution context information including task parameters, cache references on which tasks are executed, and so on. In most cases, implementations store this information locally and use it when tasks are actually executed.</p> </dd> <dt class="hdlist1"><code>getName()</code></dt> <dd> <p>Returns unique names for tasks. Clients invoke tasks with these names.</p> </dd> <dt class="hdlist1"><code>getExecutionMode()</code></dt> <dd> <p>Returns the execution mode for tasks.</p> <div class="ulist"> <ul> <li> <p><code>TaskExecutionMode.ONE_NODE</code> only the node that handles the request executes the script. Although scripts can still invoke clustered operations.</p> </li> <li> <p><code>TaskExecutionMode.ALL_NODES</code> Infinispan uses clustered executors to run scripts across nodes. For example, server tasks that invoke stream processing need to be executed on a single node because stream processing is distributed to all nodes.</p> </li> </ul> </div> </dd> <dt class="hdlist1"><code>call()</code></dt> <dd> <p>Computes a result. This method is defined in the <code>java.util.concurrent.Callable</code> interface and is invoked with server tasks.</p> </dd> </dl> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> <td class="content"> <div class="paragraph"> <p>Server task implementations must adhere to service loader pattern requirements. For example, implementations must have a zero-argument constructors.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>The following <code>HelloTask</code> class implementation provides an example task that has one parameter:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="keyword">import</span> <span class="include">org.infinispan.tasks.ServerTask</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.tasks.TaskContext</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloTask</span> <span class="directive">implements</span> ServerTask&lt;<span class="predefined-type">String</span>&gt; {

   <span class="directive">private</span> TaskContext ctx;

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> setTaskContext(TaskContext ctx) {
      <span class="local-variable">this</span>.ctx = ctx;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
      <span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) ctx.getParameters().get().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-task</span><span class="delimiter">&quot;</span></span>;
   }

}</code></pre> </div> </div> <div class="ulist"> <div class="title">Reference</div> <ul> <li> <p><a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/tasks/ServerTask.html"><code>org.infinispan.tasks.ServerTask</code></a></p> </li> <li> <p><a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html?is-external=true#call--"><code>java.util.concurrent.Callable.call()</code></a></p> </li> <li> <p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html"><code>java.util.ServiceLoader</code></a></p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="server_tasks-server"><a class="anchor" href="#server_tasks-server"></a>6.1.2. Deploying Server Tasks to Infinispan Servers</h4> <div class="paragraph"> <p>Add your custom server task classes to Infinispan servers.</p> </div> <div class="paragraph"> <div class="title">Prerequisites</div> <p>Stop any running Infinispan servers. Infinispan does not support runtime deployment of custom classes.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Package your server task implementation in a JAR file.</p> </li> <li> <p>Add a <code>META-INF/services/org.infinispan.tasks.ServerTask</code> file that contains the fully qualified names of server tasks, for example:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>example.HelloTask</code></pre> </div> </div> </li> <li> <p>Copy the JAR file to the <code>$ISPN_HOME/server/lib</code> directory of your Infinispan server.</p> </li> <li> <p>Add your classes to the deserialization whitelist in your Infinispan configuration. Alternatively set the whitelist using system properties.</p> </li> </ol> </div> <div class="ulist"> <div class="title">Reference</div> <ul> <li> <p><a href="../developing/developing.html#adding_java_classes_to_deserialization_white_lists">Adding Java Classes to Deserialization White Lists</a></p> </li> <li> <p><a href="https://docs.jboss.org/infinispan/10.1/configdocs/">Infinispan 10.1 Configuration Schema</a></p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="server_scripts"><a class="anchor" href="#server_scripts"></a>6.2. Creating Server Scripts</h3> <div class="paragraph"> <p>Create custom scripts and add them to Infinispan servers.</p> </div> <div class="sect3"> <h4 id="scripts"><a class="anchor" href="#scripts"></a>6.2.1. Server Scripts</h4> <div class="paragraph"> <p>Infinispan server scripting is based on the <code>javax.script</code> API and is compatible with any JVM-based ScriptEngine implementation. Nashorn is the default JDK ScriptEngine and provides JavaScript capabilities.</p> </div> <div class="paragraph"> <div class="title">Hello World Script Example</div> <p>The following script provides a simple example that runs on a single Infinispan server, has one parameter, and uses JavaScript:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript,parameters=[greetee]</span>
<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + greetee</code></pre> </div> </div> <div class="paragraph"> <p>When you run the preceding script, you pass a value for the <code>greetee</code> parameter and Infinispan returns <code>"Hello ${value}"</code>.</p> </div> <div class="sect4"> <h5 id="server_script_metdata"><a class="anchor" href="#server_script_metdata"></a>Script Metadata</h5> <div class="paragraph"> <p>Metadata provides additional information about scripts that Infinispan servers use when running scripts.</p> </div> <div class="paragraph"> <p>Script metadata are <code>property=value</code> pairs that you add to comments in the first lines of scripts, such as the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// name=test, language=javascript</span>
<span class="comment">// mode=local, parameters=[a,b,c]</span></code></pre> </div> </div> <div class="ulist"> <ul> <li> <p>Use comment styles that match the scripting language (<code>//</code>, <code>;;</code>, <code>#</code>).</p> </li> <li> <p>Separate <code>property=value</code> pairs with commas.</p> </li> <li> <p>Separate values with single (') or double (") quote characters.</p> </li> </ul> </div> <table class="tableblock frame-all grid-all stretch"> <caption class="title">Table 1. Metadata Properties</caption> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Defines the exection mode and has the following values:</p> <p class="tableblock"><code>local</code> only the node that handles the request executes the script. Although scripts can still invoke clustered operations.</p> <p class="tableblock"><code>distributed</code> Infinispan uses clustered executors to run scripts across nodes.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the ScriptEngine that executes the script.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>extension</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies filename extensions as an alternative method to set the ScriptEngine.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies roles that users must have to execute scripts.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>parameters</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an array of valid parameter names for this script. Invocations which specify parameters not included in this list cause exceptions.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>datatype</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Optionally sets the MediaType (MIME type) for storing data as well as parameter and return values. This property is useful for remote clients that support particular data formats only.</p> <p class="tableblock">Currently you can set only <code>text/plain; charset=utf-8</code> to use the String UTF-8 format for data.</p></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="server_script_bindings"><a class="anchor" href="#server_script_bindings"></a>Script Bindings</h5> <div class="paragraph"> <p>Infinispan exposes internal objects as bindings for script execution.</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Binding</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the cache against which the script is run.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>marshaller</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the marshaller to use for serializing data to the cache.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheManager</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the <code>cacheManager</code> for the cache.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>scriptingManager</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the instance of the script manager that runs the script. You can use this binding to run other scripts from a script.</p></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="server_script_parameters"><a class="anchor" href="#server_script_parameters"></a>Script Parameters</h5> <div class="paragraph"> <p>Infinispan lets you pass named parameters as bindings for running scripts.</p> </div> <div class="paragraph"> <p>Parameters are <code>name,value</code> pairs, where <code>name</code> is a string and <code>value</code> is any value that the marshaller can interpret.</p> </div> <div class="paragraph"> <p>The following example script has two parameters, <code>multiplicand</code> and <code>multiplier</code>. The script takes the value of <code>multiplicand</code> and multiplies it with the value of <code>multiplier</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript</span>
multiplicand * multiplier</code></pre> </div> </div> <div class="paragraph"> <p>When you run the preceding script, Infinispan responds with the result of the expression evaluation.</p> </div> </div> </div> <div class="sect3"> <h4 id="adding_scripts_cli-server"><a class="anchor" href="#adding_scripts_cli-server"></a>6.2.2. Adding Scripts to Infinispan Servers</h4> <div class="paragraph"> <p>Use the command line interface to add scripts to Infinispan servers.</p> </div> <div class="paragraph"> <div class="title">Prerequisites</div> <p>Infinispan servers store scripts in the <code>___script_cache</code> cache. If you enable cache authorization, users must have the <code>___script_manager</code> role to access <code>___script_cache</code>.</p> </div> <div class="olist arabic"> <div class="title">Procedure</div> <ol class="arabic"> <li> <p>Define scripts as required.</p> <div class="paragraph"> <p>For example, create a file named <code>multiplication.js</code> that runs on a single Infinispan server, has two parameters, and uses JavaScript to multiply a given value:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript</span>
multiplicand * multiplier</code></pre> </div> </div> </li> <li> <p>Open a CLI connection to Infinispan and use the <code>task</code> command to upload your scripts as in the following example:</p> <div class="listingblock"> <div class="content"> <pre>[//containers/default]&gt; task upload --file=multiplication.js multiplication</pre> </div> </div> </li> <li> <p>Verify that your scripts are available.</p> <div class="listingblock"> <div class="content"> <pre>[//containers/default]&gt; ls tasks
multiplication</pre> </div> </div> </li> </ol> </div> </div> <div class="sect3"> <h4 id="add_script_hotrod"><a class="anchor" href="#add_script_hotrod"></a>6.2.3. Programmatically Creating Scripts</h4> <div class="paragraph"> <p>Add scripts with the Hot Rod <code>RemoteCache</code> interface as in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; scriptCache = cacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">___script_cache</span><span class="delimiter">&quot;</span></span>);
scriptCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>,
  <span class="string"><span class="delimiter">&quot;</span><span class="content">// mode=local,language=javascript</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
  <span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand * multiplier</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p> </div> </div> </div> <div class="sect2"> <h3 id="running_tasks_scripts"><a class="anchor" href="#running_tasks_scripts"></a>6.3. Running Server-Side Tasks and Scripts</h3> <div class="paragraph"> <p>Execute tasks and custom scripts on Infinispan servers.</p> </div> <div class="sect3"> <h4 id="running_scripts_cli"><a class="anchor" href="#running_scripts_cli"></a>6.3.1. Running Tasks and Scripts</h4> <div class="paragraph"> <p>Use the command line interface to run tasks and scripts on Infinispan servers.</p> </div> <div class="ulist"> <div class="title">Prerequisites</div> <ul> <li> <p>Open a CLI connection to Infinispan.</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Procedure</div> <p>Use the <code>task</code> command to run tasks and scripts on Infinispan servers, as in the following examples:</p> </div> <div class="ulist"> <ul> <li> <p>Execute a script named <code>multipler.js</code> and specify two parameters:</p> <div class="listingblock"> <div class="content"> <pre>[//containers/default]&gt; task exec multipler.js -Pmultiplicand=10 -Pmultiplier=20
200.0</pre> </div> </div> </li> <li> <p>Execute a task named <code>@@cache@names</code> to retrieve a list of all available caches:</p> <div class="listingblock"> <div class="content"> <pre>//containers/default]&gt; task exec @@cache@names
["___protobuf_metadata","mycache","___script_cache"]</pre> </div> </div> </li> </ul> </div> </div> <div class="sect3"> <h4 id="running_scripts_hotrod"><a class="anchor" href="#running_scripts_hotrod"></a>6.3.2. Programmatically Running Scripts</h4> <div class="paragraph"> <p>Call the <code>execute()</code> method to run scripts with the Hot Rod <code>RemoteCache</code> interface, as in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; cache = cacheManager.getCache();
<span class="comment">// Create parameters for script execution.</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand</span><span class="delimiter">&quot;</span></span>, <span class="integer">10</span>);
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplier</span><span class="delimiter">&quot;</span></span>, <span class="integer">20</span>);
<span class="comment">// Run the script with the parameters.</span>
<span class="predefined-type">Object</span> result = cache.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>, params);</code></pre> </div> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p> </div> </div> <div class="sect3"> <h4 id="running_tasks_hotrod"><a class="anchor" href="#running_tasks_hotrod"></a>6.3.3. Programmatically Running Tasks</h4> <div class="paragraph"> <p>Call the <code>execute()</code> method to run tasks with the Hot Rod <code>RemoteCache</code> interface, as in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Add configuration for a locally running server.</span>
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServer().host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>).port(<span class="integer">11222</span>);

<span class="comment">// Connect to the server.</span>
RemoteCacheManager cacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());

<span class="comment">// Retrieve the remote cache.</span>
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheManager.getCache();

<span class="comment">// Create task parameters.</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; parameters = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
parameters.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">developer</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Run the server task.</span>
<span class="predefined-type">String</span> greet = cache.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-task</span><span class="delimiter">&quot;</span></span>, parameters);
<span class="predefined-type">System</span>.out.println(greet);</code></pre> </div> </div> <div class="paragraph"> <div class="title">Reference</div> <p><a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="custom_marshaller"><a class="anchor" href="#custom_marshaller"></a>7. Adding Custom Marshaller Bridges</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan provides two marshalling bridges for marshalling client/server requests using the Kryo and Protostuff libraries. To utilise either of these marshallers, you simply place the dependency of the marshaller you require in your client pom. Custom schemas for object marshalling must then be registered with the selected library using the library&#8217;s api on the client or by implementing a RegistryService for the given marshaller bridge.</p> </div> <div class="sect2"> <h3 id="protostuff"><a class="anchor" href="#protostuff"></a>7.1. Protostuff</h3> <div class="paragraph"> <p>Add the protostuff marshaller dependency to your pom:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-marshaller-protostuff<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.infinispan} with the
  version of Infinispan that you're using. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To register custom Protostuff schemas in your own code, you must register the custom schema with Protostuff before any marshalling begins. This can be achieved by simply calling:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RuntimeSchema.register(ExampleObject.class, <span class="keyword">new</span> ExampleObjectSchema());</code></pre> </div> </div> <div class="paragraph"> <p>Or, you can implement a service provider for the <code>SchemaRegistryService.java</code> interface, placing all Schema registrations in the <code>register()</code> method. Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/protostuff/SchemaRegistryService</code> file within your deployment jar.</p> </div> </div> <div class="sect2"> <h3 id="kryo"><a class="anchor" href="#kryo"></a>7.2. Kryo</h3> <div class="paragraph"> <p>Add the kryo marshaller dependency to your pom:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-marshaller-kryo<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.infinispan} with the
  version of Infinispan that you're using. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To register custom Kryo serializer in your own code, you must register the custom serializer with Kryo before any marshalling begins. This can be achieved by implementing a service provider for the <code>SerializerRegistryService.java</code> interface, placing all serializer registrations in the <code>register(Kryo)</code> method; where serializers should be registered with the supplied <code>Kryo</code> object using the Kryo api. e.g. <code>kryo.register(ExampleObject.class, new ExampleObjectSerializer())</code>. Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/kryo/SerializerRegistryService</code> file within your deployment jar.</p> </div> </div> <div class="sect2"> <h3 id="storing_deserialized_objects"><a class="anchor" href="#storing_deserialized_objects"></a>7.3. Storing deserialized objects</h3> <div class="paragraph"> <p>When using the Protostuff/Kryo bridges in caches configured with <em>application/x-java-object</em> as MediaType (storing POJOs instead of binary content) it is necessary for the class files of all custom objects to be placed on the classpath of the server. To achieve this, you should place a jar containing all of their custom classes on the server&#8217;s classpath.</p> </div> <div class="paragraph"> <p>When utilising a custom marshaller, it is also necessary for the marshaller and it&#8217;s runtime dependencies to be on the server&#8217;s classpath. To aid with this step we have created a "bundle" jar for each of the bridge implementations which includes all of the runtime class files required by the bridge and underlying library. Therefore, it is only necessary to include this single jar on the server&#8217;s classpath.</p> </div> <div class="paragraph"> <p>Bundle jar downloads:</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-kryo-bundle/10.1/infinispan-marshaller-kryo-bundle-10.1.jar">Kryo Bundle</a></p> </li> <li> <p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-protostuff-bundle/10.1/infinispan-marshaller-protostuff-bundle-10.1.jar">Protostuff Bundle</a></p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Jar files containing custom classes must be placed in the same module/directory as the custom marshaller bundle so that the marshaller can load them. i.e. if you register the marshaller bundle in <code>modules/system/layers/base/org/infinispan/main/modules.xml</code>, then you must also register your custom classes here. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="registering_custom_schemasserializers"><a class="anchor" href="#registering_custom_schemasserializers"></a>7.4. Registering Custom Schemas/Serializers</h3> <div class="paragraph"> <p>Custom serializers/schemas for the Kryo/Protostuff marshallers must be registered via their respective service interfaces in order to store deserialized objects. To achieve this, it is necessary for a <strong>JAR</strong> that contains the service provider to be registered in the same directory or module as the marshaller bundle and custom classes.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>It is not necessary for the service provider implementation to be provided in the same <strong>JAR</strong> as the user&#8217;s custom classes. However, the <strong>JAR</strong> that contains the provider must be in the same directory/module as the marshaller and custom class <strong>JAR</strong> files.</p> </div> </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_rolling_upgrade"><a class="anchor" href="#server_rolling_upgrade"></a>8. Performing Rolling Upgrades</h2> <div class="sectionbody"> <div class="paragraph"> <p>Upgrade Infinispan without downtime or data loss. You can perform rolling upgrades for Infinispan servers to start using a more recent version of Infinispan.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>This section explains how to upgrade Infinispan servers, see the appropriate documentation for your Hot Rod client for upgrade procedures.</p> </div> </td> </tr> </table> </div> <div class="sect2"> <h3 id="rolling_upgrades"><a class="anchor" href="#rolling_upgrades"></a>8.1. Rolling Upgrades</h3> <div class="paragraph"> <p>From a high-level, you do the following to perform rolling upgrades:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Set up a target cluster. The target cluster is the Infinispan version to which you want to migrate data. The source cluster is the Infinispan deployment that is currently in use. After the target cluster is running, you configure all clients to point to it instead of the source cluster.</p> </li> <li> <p>Synchronize data from the source cluster to the target cluster.</p> </li> </ol> </div> </div> <div class="sect2"> <h3 id="setting_up_target_clusters"><a class="anchor" href="#setting_up_target_clusters"></a>8.2. Setting Up Target Clusters</h3> <div class="olist arabic"> <ol class="arabic"> <li> <p>Start the target cluster with unique network properties or a different JGroups cluster name to keep it separate from the source cluster.</p> </li> <li> <p>Configure a <code>RemoteCacheStore</code> on the target cluster for each cache you want to migrate from the source cluster.</p> <div class="dlist"> <dl> <dt class="hdlist1"><code>RemoteCacheStore</code> settings</dt> <dd> <div class="ulist"> <ul> <li> <p><code>remote-server</code> must point to the source cluster via the <code>outbound-socket-binding</code> property.</p> </li> <li> <p><code>remoteCacheName</code> must match the cache name on the source cluster.</p> </li> <li> <p><code>hotrod-wrapping</code> must be <code>true</code> (enabled).</p> </li> <li> <p><code>shared</code> must be <code>true</code> (enabled).</p> </li> <li> <p><code>purge</code> must be <code>false</code> (disabled).</p> </li> <li> <p><code>passivation</code> must be <code>false</code> (disabled).</p> </li> <li> <p><code>protocol-version</code> matches the Hot Rod protocol version of the source cluster.</p> <div class="listingblock"> <div class="title">Example <code>RemoteCacheStore</code> Configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;remote-store</span> <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyCache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tcp-no-delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">protocol-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">shared</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">hotrod-wrapping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">purge</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">passivation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;remote-server</span> <span class="attribute-name">outbound-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-store-hotrod-server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/remote-store&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span>
...
<span class="tag">&lt;socket-binding-group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">standard-sockets</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port-offset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.socket.binding.port-offset:0}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;outbound-socket-binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-store-hotrod-server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;remote-destination</span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">198.51.100.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11222</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/outbound-socket-binding&gt;</span>
  ...
<span class="tag">&lt;/socket-binding-group&gt;</span></code></pre> </div> </div> </li> </ul> </div> </dd> </dl> </div> </li> <li> <p>Configure the target cluster to handle all client requests instead of the source cluster:</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>Configure all clients to point to the target cluster instead of the source cluster.</p> </li> <li> <p>Restart each client node.</p> <div class="paragraph"> <p>The target cluster lazily loads data from the source cluster on demand via <code>RemoteCacheStore</code>.</p> </div> </li> </ol> </div> </li> </ol> </div> </div> <div class="sect2"> <h3 id="synchronizing_data_from_source_clusters"><a class="anchor" href="#synchronizing_data_from_source_clusters"></a>8.3. Synchronizing Data from Source Clusters</h3> <div class="olist arabic"> <ol class="arabic"> <li> <p>Call the <code>synchronizeData()</code> method in the <code>TargetMigrator</code> interface. Do one of the following on the target cluster for each cache that you want to migrate:</p> <div class="dlist"> <dl> <dt class="hdlist1">JMX</dt> <dd> <div class="paragraph"> <p>Invoke the <code>synchronizeData</code> operation and specify the <code>hotrod</code> parameter on the <code>RollingUpgradeManager</code> MBean.</p> </div> </dd> <dt class="hdlist1">CLI</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh --connect controller=127.0.0.1:9990 -c &quot;/subsystem=datagrid-infinispan/cache-container=clustered/distributed-cache=MyCache:synchronize-data(migrator-name=hotrod)&quot;</code></pre> </div> </div> <div class="paragraph"> <p>Data migrates to all nodes in the target cluster in parallel, with each node receiving a subset of the data.</p> </div> <div class="paragraph"> <p>Use the following parameters to tune the operation:</p> </div> <div class="ulist"> <ul> <li> <p><code>read-batch</code> configures the number of entries to read from the source cluster at a time. The default value is <code>10000</code>.</p> </li> <li> <p><code>write-threads</code> configures the number of threads used to write data. The default value is the number of processors available.</p> <div class="paragraph"> <p>For example:</p> </div> <div class="paragraph"> <p><code>synchronize-data(migrator-name=hotrod, read-batch=100000, write-threads=3)</code></p> </div> </li> </ul> </div> </dd> </dl> </div> </li> <li> <p>Disable the <code>RemoteCacheStore</code> on the target cluster. Do one of the following:</p> <div class="dlist"> <dl> <dt class="hdlist1">JMX</dt> <dd> <div class="paragraph"> <p>Invoke the <code>disconnectSource</code> operation and specify the <code>hotrod</code> parameter on the <code>RollingUpgradeManager</code> MBean.</p> </div> </dd> <dt class="hdlist1">CLI</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh --connect controller=127.0.0.1:9990 -c &quot;/subsystem=datagrid-infinispan/cache-container=clustered/distributed-cache=MyCache:disconnect-source(migrator-name=hotrod)&quot;</code></pre> </div> </div> </dd> </dl> </div> </li> <li> <p>Decommission the source cluster.</p> </li> </ol> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2019-10-27 08:15:43 UTC </div> </div> <style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style> <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script> </body> </html>