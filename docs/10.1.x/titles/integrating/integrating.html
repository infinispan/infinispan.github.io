<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Integrating Infinispan 10.1</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="http://infinispan.org/docs/stable/user_guide/user_guide.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Integrating Infinispan 10.1</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#integrations">1. Integrations</a>
<ul class="sectlevel2">
<li><a href="#apache_spark">1.1. Apache Spark</a></li>
<li><a href="#apache_hadoop">1.2. Apache Hadoop</a></li>
<li><a href="#integrations_lucene_directory">1.3. Apache Lucene</a>
<ul class="sectlevel3">
<li><a href="#lucene_compatibility">1.3.1. Lucene compatibility</a></li>
<li><a href="#maven_dependencies">1.3.2. Maven dependencies</a></li>
<li><a href="#how_to_use_it">1.3.3. How to use it</a></li>
<li><a href="#configuration">1.3.4. Configuration</a>
<ul class="sectlevel4">
<li><a href="#lock_cache">Lock Cache</a></li>
<li><a href="#metadata_cache">Metadata Cache</a></li>
<li><a href="#data_cache">Data Cache</a></li>
</ul>
</li>
<li><a href="#using_a_cacheloader">1.3.5. Using a CacheLoader</a></li>
<li><a href="#storing_the_index_in_a_database">1.3.6. Storing the index in a database</a></li>
<li><a href="#loading_an_existing_lucene_index">1.3.7. Loading an existing Lucene Index</a></li>
<li><a href="#architectural_limitations">1.3.8. Architectural limitations</a></li>
<li><a href="#suggestions_for_optimal_performance">1.3.9. Suggestions for optimal performance</a>
<ul class="sectlevel4">
<li><a href="#jgroups_and_networking_stack">JGroups and networking stack</a></li>
<li><a href="#using_a_cachestore">Using a CacheStore</a></li>
<li><a href="#apply_standard_lucene_tuning">Apply standard Lucene tuning</a></li>
<li><a href="#disable_batching_and_transactions">Disable batching and transactions</a></li>
<li><a href="#set_the_right_chunk_size">Set the right chunk size</a></li>
</ul>
</li>
<li><a href="#demo">1.3.10. Demo</a></li>
<li><a href="#additional_links">1.3.11. Additional Links</a></li>
<li><a href="#integrations_directory_provider">1.3.12. Directory Provider for Hibernate Search</a></li>
<li><a href="#maven_dependencies_2">1.3.13. Maven dependencies</a></li>
<li><a href="#how_to_use_it_2">1.3.14. How to use it</a></li>
<li><a href="#configuration_2">1.3.15. Configuration</a></li>
<li><a href="#architecture_considerations">1.3.16. Architecture considerations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#integrations_jpa_hibernate">2. JPA/Hibernate 2L Cache</a>
<ul class="sectlevel2">
<li><a href="#deployment_scenarios">2.1. Deployment Scenarios</a>
<ul class="sectlevel3">
<li><a href="#single_node_standalone_hibernate_application">2.1.1. Single-Node Standalone Hibernate Application</a></li>
<li><a href="#single_node_standalone_spring_application">2.1.2. Single-Node Standalone Spring Application</a></li>
<li><a href="#single_node_wildfly_application">2.1.3. Single-Node WildFly Application</a></li>
<li><a href="#multi_node_standalone_hibernate_application">2.1.4. Multi-Node Standalone Hibernate Application</a></li>
<li><a href="#multi_node_standalone_spring_application">2.1.5. Multi-Node Standalone Spring Application</a></li>
<li><a href="#multi_node_wildfly_application">2.1.6. Multi-Node WildFly Application</a></li>
</ul>
</li>
<li><a href="#configuration_reference">2.2. Configuration Reference</a>
<ul class="sectlevel3">
<li><a href="#default_local_configuration_second_level">2.2.1. Default Local Configuration</a></li>
<li><a href="#default_cluster_configuration_second_level">2.2.2. Default Cluster Configuration</a></li>
<li><a href="#configuration_properties">2.2.3. Configuration Properties</a></li>
</ul>
</li>
<li><a href="#cache_strategies">2.3. Cache Strategies</a></li>
<li><a href="#using_minimal_puts">2.4. Using minimal puts</a></li>
<li><a href="#integrations_hibernate_ogm">2.5. JPA / Hibernate OGM</a></li>
</ul>
</li>
<li><a href="#spring_integration">3. Using Infinispan with Spring</a>
<ul class="sectlevel2">
<li><a href="#spring_cache_provider">3.1. Setting Up Infinispan as a Spring Cache Provider</a>
<ul class="sectlevel3">
<li><a href="#spring_add_support">3.1.1. Adding Spring Cache Support</a></li>
<li><a href="#spring_configure_cache_provider">3.1.2. Configuring Infinispan as the Spring Cache Provider</a></li>
</ul>
</li>
<li><a href="#spring_add_caching">3.2. Adding Caching to Your Application</a>
<ul class="sectlevel3">
<li><a href="#spring_add_entries">3.2.1. Adding Cache Entries</a></li>
<li><a href="#spring_remove_entries">3.2.2. Deleting Cache Entries</a></li>
</ul>
</li>
<li><a href="#spring_configure_timeouts">3.3. Configuring Timeouts for Cache Operations</a></li>
<li><a href="#spring_externalize_sessions">3.4. Externalizing Sessions Using Spring Session</a></li>
</ul>
</li>
<li><a href="#infinispan_modules_for_wildfly_eap">4. Infinispan modules for WildFly / EAP</a>
<ul class="sectlevel2">
<li><a href="#modules_installation_section">4.1. Installation</a></li>
<li><a href="#application_dependencies">4.2. Application Dependencies</a>
<ul class="sectlevel3">
<li><a href="#infinispan_core">4.2.1. Infinispan core</a></li>
<li><a href="#remote">4.2.2. Remote</a></li>
<li><a href="#embedded_query">4.2.3. Embedded Query</a></li>
<li><a href="#lucene_directory">4.2.4. Lucene Directory</a></li>
<li><a href="#hibernate_search_directory_provider_for_infinispan">4.2.5. Hibernate Search directory provider for Infinispan</a>
<ul class="sectlevel4">
<li><a href="#usage_with_wildfly_internal_hibernate_search_modules">Usage with WildFly Internal Hibernate Search Modules</a></li>
<li><a href="#usage_with_other_hibernate_search_modules">Usage with other Hibernate Search modules</a></li>
</ul>
</li>
<li><a href="#usage">4.2.6. Usage</a></li>
<li><a href="#embedded_mode">4.2.7. Embedded Mode</a>
<ul class="sectlevel4">
<li><a href="#server_mode">Server Mode</a>
<ul class="sectlevel5">
<li><a href="#configuration_3">Configuration</a></li>
</ul>
</li>
<li><a href="#accessing_containers_and_caches">Accessing Containers and Caches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#troubleshooting">4.3. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#enable_logging">4.3.1. Enable logging</a></li>
<li><a href="#print_dependency_tree">4.3.2. Print dependency tree</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="integrations"><a class="anchor" href="#integrations"></a>1. Integrations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan can be integrated with a number of other projects, as detailed below.</p>
</div>
<div class="sect2">
<h3 id="apache_spark"><a class="anchor" href="#apache_spark"></a>1.1. Apache Spark</h3>
<div class="paragraph">
<p>Infinispan provides an <a href="http://spark.apache.org">Apache Spark</a> connector capable of exposing caches as an RDD, allowing batch and stream jobs to be run against data stored in Infinispan. For further details, see the <a href="https://github.com/infinispan/infinispan-spark/blob/master/README.md">Infinispan Spark connector documentation</a>.
Also check the <a href="https://github.com/infinispan/infinispan-spark/tree/master/examples/twitter/README.md">Docker based Twitter demo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="apache_hadoop"><a class="anchor" href="#apache_hadoop"></a>1.2. Apache Hadoop</h3>
<div class="paragraph">
<p>The Infinispan Hadoop connector can be used to expose Infinispan as a Hadoop compliant data source and sink that implements <a href="https://hadoop.apache.org/docs/stable/api/org/apache/hadoop/mapreduce/InputFormat.html">InputFormat</a>/<a href="https://hadoop.apache.org/docs/stable/api/org/apache/hadoop/mapreduce/OutputFormat.html">OutputFormat</a>.
For further details, refer to the full <a href="https://github.com/infinispan/infinispan-hadoop/blob/master/README.md">documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="integrations_lucene_directory"><a class="anchor" href="#integrations_lucene_directory"></a>1.3. Apache Lucene</h3>
<div class="paragraph">
<p>Infinispan includes a highly scalable distributed <a href="http://lucene.apache.org">Apache Lucene Directory</a> implementation.</p>
</div>
<div class="paragraph">
<p>This directory closely mimics the same semantics of the traditional filesystem and RAM-based directories, being able to work as a drop-in replacement for existing applications using Lucene and providing reliable index sharing and other features of Infinispan like node auto-discovery, automatic failover and rebalancing, optionally transactions, and can be backed by traditional storage solutions as filesystem, databases or cloud store engines.</p>
</div>
<div class="paragraph">
<p>The implementation extends Lucene&#8217;s <em>org.apache.lucene.store.Directory</em> so it can be used to <em>store</em> the index in a cluster-wide shared memory, making it easy to distribute the index. Compared to rsync-based replication this solution is suited for use cases in which your application makes frequent changes to the index and you need them to be quickly distributed to all nodes. Consistency levels, synchronicity and guarantees, total elasticity and auto-discovery are all configurable; also changes applied to the index can optionally participate in a JTA transaction, optionally supporting XA transactions with recovery.</p>
</div>
<div class="paragraph">
<p>Two different <em>LockFactory</em> implementations are provided to guarantee only one <em>IndexWriter</em> at a time will make changes to the index, again implementing the same semantics as when opening an index on a local filesystem. As with other Lucene Directories, you can override the <em>LockFactory</em> if you prefer to use an alternative implementation.</p>
</div>
<div class="sect3">
<h4 id="lucene_compatibility"><a class="anchor" href="#lucene_compatibility"></a>1.3.1. Lucene compatibility</h4>
<div class="paragraph">
<p>Apache Lucene versions 5.5.x</p>
</div>
</div>
<div class="sect3">
<h4 id="maven_dependencies"><a class="anchor" href="#maven_dependencies"></a>1.3.2. Maven dependencies</h4>
<div class="paragraph">
<p>All you need is the following:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-lucene-directory<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how_to_use_it"><a class="anchor" href="#how_to_use_it"></a>1.3.3. How to use it</h4>
<div class="paragraph">
<p>See the below example of using the Infinispan Lucene Directory in order to index and query a single Document:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.standard.StandardAnalyzer</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.Document</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.Field</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.StringField</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.index.DirectoryReader</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.index.IndexWriter</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.index.IndexWriterConfig</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.index.Term</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.search.IndexSearcher</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.search.TermQuery</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.search.TopDocs</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.store.Directory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.lucene.directory.DirectoryBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.manager.DefaultCacheManager</span>;

<span class="comment">// Create caches that will store the index. Here the programmatic configuration is used</span>
DefaultCacheManager defaultCacheManager = <span class="keyword">new</span> DefaultCacheManager();
Cache metadataCache = defaultCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">metadataCache</span><span class="delimiter">&quot;</span></span>);
Cache dataCache = defaultCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">dataCache</span><span class="delimiter">&quot;</span></span>);
Cache lockCache = defaultCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">lockCache</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Create the directory</span>
Directory directory = DirectoryBuilder.newDirectoryInstance(metadataCache, dataCache, lockCache, indexName).create();

<span class="comment">// Use the directory in Lucene</span>
IndexWriterConfig indexWriterConfig = <span class="keyword">new</span> IndexWriterConfig(<span class="keyword">new</span> StandardAnalyzer()).setOpenMode(IndexWriterConfig.OpenMode.CREATE_OR_APPEND);

IndexWriter indexWriter = <span class="keyword">new</span> IndexWriter(directory, indexWriterConfig);

<span class="comment">// Index a single document</span>
<span class="predefined-type">Document</span> doc = <span class="keyword">new</span> <span class="predefined-type">Document</span>();
doc.add(<span class="keyword">new</span> StringField(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Field</span>.Store.NO));
indexWriter.addDocument(doc);
indexWriter.close();

<span class="comment">// Querying the inserted document</span>
DirectoryReader directoryReader = DirectoryReader.open(directory);
IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(directoryReader);
TermQuery query = <span class="keyword">new</span> TermQuery(<span class="keyword">new</span> Term(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>));
TopDocs topDocs = searcher.search(query, <span class="integer">10</span>);
<span class="predefined-type">System</span>.out.println(topDocs.totalHits);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>indexName</em> in the <em>DirectoryBuilder</em> is a unique key to identify your index. It takes the same role as the path did on filesystem based indexes: you can create several different indexes giving them different names. When you use the same <em>indexName</em> in another instance connected to the same network (or instantiated on the same machine, useful for testing) they will join, form a cluster and share all content. Using a different <em>indexName</em> allows you to store different indexes in the same set of Caches.</p>
</div>
<div class="paragraph">
<p>The <em>metadataCache</em>, <em>dataCache</em> and <em>lockCache</em> are the caches that will store the indexes. More details provided below.</p>
</div>
<div class="paragraph">
<p>New nodes can be added or removed dynamically, making the service administration very easy and also suited for cloud environments: it&#8217;s simple to react to load spikes, as adding more memory and CPU power to the search system is done by just starting more nodes.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a>1.3.4. Configuration</h4>
<div class="paragraph">
<p>Infinispan can be configured as LOCAL clustering mode, in which case it will disable clustering features and serve as a cache for the index, or any clustering mode. A transaction manager is not mandatory, but when enabled the changes to the index can participate in transactions.</p>
</div>
<div class="paragraph">
<p>Batching was required in previous versions, it&#8217;s not strictly needed anymore.</p>
</div>
<div class="paragraph">
<p>As pointed out in the javadocs of <a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/lucene/directory/DirectoryBuilder.html">DirectoryBuilder</a>, it&#8217;s possible for it to use more than a single cache, using specific configurations for different purposes. Each cache is explained below:</p>
</div>
<div class="sect4">
<h5 id="lock_cache"><a class="anchor" href="#lock_cache"></a>Lock Cache</h5>
<div class="paragraph">
<p>The lock cache is used to store a single entry per index that will function as the directory lock. Given the small storage requirement this cache is usually configured as REPL_SYNC. Example of declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LuceneIndexesLocking</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transaction</span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;indexing</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;memory&gt;</span>
       <span class="tag">&lt;object</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/memory&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="metadata_cache"><a class="anchor" href="#metadata_cache"></a>Metadata Cache</h5>
<div class="paragraph">
<p>The metadata cache is used to store information about the files of the directory, such as buffer sizes and number of chunks. It uses more space than the Lock Cache, but not as much as the Data Cache, so using a REPL_SYNC cache should be fine for most cases.
Example of configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LuceneIndexesMetadaData</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transaction</span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;indexing</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;memory&gt;</span>
       <span class="tag">&lt;object</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/memory&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="data_cache"><a class="anchor" href="#data_cache"></a>Data Cache</h5>
<div class="paragraph">
<p>The Infinispan Lucene directory splits large (bigger than the chunkSize configuration) files into chunks and stores them in the Data cache.
This is the largest of the 3 index caches, and both DIST_SYNC/REPL_SYNC cache modes can be used.
Usage of REPL_SYNC offers lower latencies for queries since each node holds the whole index locally; DIST_SYNC, on the other hand, will affect query latency due to remote calls to fetch for chunks, but offers better scalability.</p>
</div>
<div class="paragraph">
<p>Example of configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LuceneIndexesData</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transaction</span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;indexing</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;memory&gt;</span>
       <span class="tag">&lt;object</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/memory&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using_a_cacheloader"><a class="anchor" href="#using_a_cacheloader"></a>1.3.5. Using a CacheLoader</h4>
<div class="paragraph">
<p>Using a CacheLoader you can have the index content backed up to a permanent storage; you can use a shared store for all nodes or one per node, see cache passivation for more details.</p>
</div>
<div class="paragraph">
<p>When using a CacheLoader to store a Lucene index, to get best write performance you would need to configure the CacheLoader with <em>async=true</em> .</p>
</div>
</div>
<div class="sect3">
<h4 id="storing_the_index_in_a_database"><a class="anchor" href="#storing_the_index_in_a_database"></a>1.3.6. Storing the index in a database</h4>
<div class="paragraph">
<p>It might be useful to store the Lucene index in a relational database; this would be very slow but Infinispan can act as a cache between the application and the JDBC interface, making this configuration useful in both clustered and non-clustered configurations. When storing indexes in a JDBC database, it&#8217;s suggested to use the <em>JdbcStringBasedCacheStore</em> , which will need the <code>key-to-string-mapper</code> attribute to be set to <code>org.infinispan.lucene.LuceneKey2StringMapper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;jdbc:string-keyed-jdbc-store</span> <span class="attribute-name">preload</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-to-string-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.lucene.LuceneKey2StringMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loading_an_existing_lucene_index"><a class="anchor" href="#loading_an_existing_lucene_index"></a>1.3.7. Loading an existing Lucene Index</h4>
<div class="paragraph">
<p>The <em>org.infinispan.lucene.cachestore.LuceneCacheLoader</em> is an Infinispan CacheLoader able to have Infinispan directly load data from an existing Lucene index into the grid. Currently this supports reading only.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>location</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path where the indexes are stored. Subdirectories (of first level only) should contain the indexes to be loaded, each directory matching the index name attribute of the Infinispan Directory constructor.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (mandatory)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>autoChunkSize</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A threshold in bytes: if any segment is larger than this, it will be transparently chunked in smaller cache entries up to this size.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32MB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It&#8217;s worth noting that the IO operations are delegated to Lucene&#8217;s standard <em>org.apache.lucene.store.FSDirectory</em> , which will select an optimal approach for the running platform.</p>
</div>
<div class="paragraph">
<p>Implementing write-through should not be hard: you&#8217;re welcome to try implementing it.</p>
</div>
</div>
<div class="sect3">
<h4 id="architectural_limitations"><a class="anchor" href="#architectural_limitations"></a>1.3.8. Architectural limitations</h4>
<div class="paragraph">
<p>This Directory implementation makes it possible to have almost real-time reads across multiple nodes. A fundamental limitation of the Lucene design is that only a single IndexWriter is allowed to make changes on the index: a pessimistic lock is acquired by the writer; this is generally ok as a single IndexWriter <em>instance</em> is very fast and accepts update requests from multiple threads. When sharing the Directory across Infinispan nodes the IndexWriter limitation is not lifted: since you can have only one instance, that reflects in your application as having to apply all changes on the same node. There are several strategies to write from multiple nodes on the same index:</p>
</div>
<div class="ulist">
<div class="title">Index write strategies</div>
<ul>
<li>
<p>One node writes, the other delegate to it sending messages</p>
</li>
<li>
<p>Each node writes on turns</p>
</li>
<li>
<p>You application makes sure it will only ever apply index writes on one node</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Infinispan Lucene Directory</em> protects its content by implementing a distributed locking strategy, though this is designed as a last line of defense and is not to be considered an efficient mechanism to coordinate multiple writes: if you don&#8217;t apply one of the above suggestions and get high write contention from multiple nodes you will likely get timeout exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="suggestions_for_optimal_performance"><a class="anchor" href="#suggestions_for_optimal_performance"></a>1.3.9. Suggestions for optimal performance</h4>
<div class="sect4">
<h5 id="jgroups_and_networking_stack"><a class="anchor" href="#jgroups_and_networking_stack"></a>JGroups and networking stack</h5>
<div class="paragraph">
<p>JGroups manages all network IO and as such it is a critical component to tune for your specific environment. Make sure to read the <a href="http://jgroups.org/manual-3.x/html/index.html">JGroups reference documentation</a>, and play with the performance tests included in JGroups to make sure your network stack is setup appropriately. Don&#8217;t forget to check also operating system level parameters, for example buffer sizes dedicated for networking. JGroups will log warning when it detects something wrong, but there is much more you can look into.</p>
</div>
</div>
<div class="sect4">
<h5 id="using_a_cachestore"><a class="anchor" href="#using_a_cachestore"></a>Using a CacheStore</h5>
<div class="paragraph">
<p>Currently all CacheStore implementations provided by Infinispan have a significant slowdown; we hope to resolve that soon but for the time being if you need high performance on writes with the Lucene Directory the best option is to disable any CacheStore; the second best option is to configure the CacheStore as <em>async</em> . If you only need to load a Lucene index from read-only storage, see the above description for <em>org.infinispan.lucene.cachestore.LuceneCacheLoader</em> .</p>
</div>
</div>
<div class="sect4">
<h5 id="apply_standard_lucene_tuning"><a class="anchor" href="#apply_standard_lucene_tuning"></a>Apply standard Lucene tuning</h5>
<div class="paragraph">
<p>All known options of Lucene apply to the Infinispan Lucene Directory as well; of course the effect might be less significant in some cases, but you should definitely read the <a href="http://lucene.apache.org/core/index.html">Apache Lucene documentation</a> .</p>
</div>
</div>
<div class="sect4">
<h5 id="disable_batching_and_transactions"><a class="anchor" href="#disable_batching_and_transactions"></a>Disable batching and transactions</h5>
<div class="paragraph">
<p>Early versions required Infinispan to have batching or transactions enabled. This is no longer a requirement, and in fact disabling them should provide little improvement in performance.</p>
</div>
</div>
<div class="sect4">
<h5 id="set_the_right_chunk_size"><a class="anchor" href="#set_the_right_chunk_size"></a>Set the right chunk size</h5>
<div class="paragraph">
<p>The chunk size can be specified using the <a href="https://docs.jboss.org/infinispan/10.1/apidocs/org/infinispan/lucene/directory/DirectoryBuilder.html">DirectoryBuilder</a> fluent API. To correctly set this variable you need to estimate what the expected size of your segments is; generally this is trivial by looking at the file size of the index segments generated by your application when it&#8217;s using the standard FSDirectory. You then have to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The chunk size affects the size of internally created buffers, and large chunk sizes will cause memory usage to grow. Also consider that during index writing such arrays are frequently allocated.</p>
</li>
<li>
<p>If a segment doesn&#8217;t fit in the chunk size, it&#8217;s going to be fragmented. When searching on a fragmented segment performance can&#8217;t peak.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the <em>org.apache.lucene.index.IndexWriterConfig</em> you can tune your index writing to <em>approximately</em> keep your segment size to a reasonable level, from there then tune the chunksize, after having defined the chunksize you might want to revisit your network configuration settings.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="demo"><a class="anchor" href="#demo"></a>1.3.10. Demo</h4>
<div class="paragraph">
<p>There is a simple command-line demo of its capabilities distributed with Infinispan under demos/lucene-directory; make sure you grab the "Binaries, server and demos" package from download page, which contains all demos.</p>
</div>
<div class="paragraph">
<p>Start several instances, then try adding text in one instance and searching for it on the other. The configuration is not tuned at all, but should work out-of-the box without any changes. If your network interface has multicast enabled, it will cluster across the local network with other instances of the demo.</p>
</div>
</div>
<div class="sect3">
<h4 id="additional_links"><a class="anchor" href="#additional_links"></a>1.3.11. Additional Links</h4>
<div class="ulist">
<ul>
<li>
<p>Issue tracker: <a href="https://jira.jboss.org/browse/ISPN/component/12312732" class="bare">https://jira.jboss.org/browse/ISPN/component/12312732</a></p>
</li>
<li>
<p>Source code: <a href="https://github.com/infinispan/infinispan/tree/master/lucene/lucene-directory/src/main/java/org/infinispan/lucene" class="bare">https://github.com/infinispan/infinispan/tree/master/lucene/lucene-directory/src/main/java/org/infinispan/lucene</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="integrations_directory_provider"><a class="anchor" href="#integrations_directory_provider"></a>1.3.12. Directory Provider for Hibernate Search</h4>
<div class="paragraph">
<p>Hibernate Search applications can use Infinispan as a directory provider, taking advantage of Infinispan&#8217;s distribution and low latency capabilities to store the Lucene indexes.</p>
</div>
</div>
<div class="sect3">
<h4 id="maven_dependencies_2"><a class="anchor" href="#maven_dependencies_2"></a>1.3.13. Maven dependencies</h4>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-directory-provider<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how_to_use_it_2"><a class="anchor" href="#how_to_use_it_2"></a>1.3.14. How to use it</h4>
<div class="paragraph">
<p>The directory provider alias is <em>"infinispan"</em>, and to enable it for an index, the following property should be in the <a href="https://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#configuration">Hibernate Search configuration</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hibernate.search.MyIndex.directory_provider = infinispan</pre>
</div>
</div>
<div class="paragraph">
<p>to enable it by default for all indexes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hibernate.search.default.directory_provider = infinispan</pre>
</div>
</div>
<div class="paragraph">
<p>The Infinispan cluster will start with a <a href="https://github.com/infinispan/infinispan/blob/master/lucene/directory-provider/src/main/resources/default-hibernatesearch-infinispan.xml">default configuration</a>, see below how to override it.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration_2"><a class="anchor" href="#configuration_2"></a>1.3.15. Configuration</h4>
<div class="paragraph">
<p>Optional properties allow for a custom Infinispan configuration or to use an existent <em>EmbeddedCacheManager</em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hibernate.search.infinispan.configuration_resourcename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom configuration for Infinispan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config/infinispan.xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hibernate.search.infinispan.configuration.transport_override_resourcename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the JGroups stack in the Infinispan configuration file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jgroups-ec2.xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hibernate.search.infinispan.cachemanager_jndiname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the JNDI name under which the <em>EmbeddedCacheManager</em> to use is bound. Will cause the properties above to be ignored when present</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java:jboss/infinispan/container/hibernate-search</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="architecture_considerations"><a class="anchor" href="#architecture_considerations"></a>1.3.16. Architecture considerations</h4>
<div class="paragraph">
<p>The same limitations presented in the Lucene Directory apply here, meaning the index will be shared across several nodes and only one <em>IndexWriter</em> can have the lock.</p>
</div>
<div class="paragraph">
<p>One common strategy is to use Hibernate Search&#8217;s JMS Master/Slave or JGroups backend together with the Infinispan directory provider: instead of sending updates directly to the index, they are sent to a JMS queue or JGroups channel and a single node applies all the changes on behalf of all other nodes.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="https://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search documentation</a> for instructions on how to setup JMS or JGroups backends.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrations_jpa_hibernate"><a class="anchor" href="#integrations_jpa_hibernate"></a>2. JPA/Hibernate 2L Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate manages a second-level cache where it moves data into and out as a result of operations performed by <code>Session</code> or <code>EntityManager</code> (JPA).
The second-level cache is pluggable via an SPI which Infinispan implements.
This enables Infinispan to be used as second-level cache for Hibernate.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#caching">Hibernate documentation</a>
contains a lot of information about second-level cache, types of caches&#8230;&#8203;etc.
This chapter focuses on what you need to know to use Infinispan as second-level cache provider with Hibernate.</p>
</div>
<div class="paragraph">
<p>Applications running in environments where Infinispan is not default cache provider for Hibernate will need to depend on the correct cache provider version.</p>
</div>
<div class="paragraph">
<p>The Infinispan cache provider version suitable for your application depends on the Hibernate version in use:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Hibernate 5.3</dt>
<dd>
<p>Use the following Maven coordinates:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-hibernate-cache-v53<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Hibernate 5.2</dt>
<dd>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate 5.2 is supported in Infinispan 9.2.x only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the following Maven coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-hibernate-cache<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Hibernate 5.1</dt>
<dd>
<p>Use the following Maven coordinates:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-hibernate-cache-v51<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate version 5.0 and earlier: the Infinispan cache provider is shipped by Hibernate.
Documentation and Maven coordinates are located in the
<a href="https://docs.jboss.org/hibernate/orm/5.0/userguide/html_single/Hibernate_User_Guide.html#caching-provider-infinispan">Hibernate documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apart from Infinispan specific configuration, it&#8217;s worth noting that enabling second cache requires some changes to the descriptor file
(<code>persistence.xml</code> for JPA or <code>application.properties</code> for Spring).
To use second level cache, you first need to enable the second level cache so that entities and/or collections can be cached:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Enable second-level cache</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;property name="hibernate.cache.use_second_level_cache" value="true"/&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.jpa.properties.hibernate.cache.use_second_level_cache=true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To select which entities/collections to cache, first annotate them with <code>javax.persistence.Cacheable</code>.
Then make sure shared cache mode is set to <code>ENABLE_SELECTIVE</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Enable selective shared cached mode</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;shared-cache-mode&gt;ENABLE_SELECTIVE&lt;/shared-cache-mode&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.jpa.properties.javax.persistence.sharedCache.mode=ENABLE_SELECTIVE</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is the most common way of selecting which entities/collections to cache.
However, there are alternative ways to which are explained in the
<a href="https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#caching-mappings">Hibernate documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Optionally, queries can also be cached but for that query cache needs to be enabled:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Enable query cache</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;property name="hibernate.cache.use_query_cache" value="true"/&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.jpa.properties.hibernate.cache.use_query_cache=true</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As well as enabling query cache, forcing a query to be cached requires the query to be made cacheable.
For example, for JPA queries: <code>query.setHint("org.hibernate.cacheable", Boolean.TRUE)</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The best way to find out whether second level cache is working or not is to inspect the statistics.
By inspecting the statistics you can verify if the cache is being hit, if any new data is stored in cache&#8230;&#8203;etc.
Statistics are disabled by default, so it is recommended that you enable statistics:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Enable statistics</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;property name="hibernate.generate_statistics" value="true" /&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.jpa.properties.hibernate.generate_statistics=true</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="deployment_scenarios"><a class="anchor" href="#deployment_scenarios"></a>2.1. Deployment Scenarios</h3>
<div class="paragraph">
<p>How to configure Infinispan to be the second level cache provider varies slightly depending on the deployment scenario:</p>
</div>
<div class="sect3">
<h4 id="single_node_standalone_hibernate_application"><a class="anchor" href="#single_node_standalone_hibernate_application"></a>2.1.1. Single-Node Standalone Hibernate Application</h4>
<div class="paragraph">
<p>In standalone library mode, a JPA/Hibernate application runs inside a Java SE application or inside containers that don’t offer Infinispan integration.</p>
</div>
<div class="paragraph">
<p>Enabling Infinispan second level cache provider inside a JPA/Hibernate application that runs in single node is very straightforward.
First, make sure the Hibernate Infinispan cache provider is available in the classpath.
Then, modify the persistence.xml to include these properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Use Infinispan second level cache provider --&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!--
   Force using local configuration when only using a single node.
   Otherwise a clustered configuration is loaded.
--&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.cfg</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org/infinispan/hibernate/cache/commons/builder/infinispan-configs-local.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default when running standalone, the Infinispan second-level cache provider uses an Infinispan configuration that’s designed for clustered environments.
However, Infinispan also provides a configuration designed for local, single node, environments.
To enable that configuration, set <code>hibernate.cache.infinispan.cfg</code> to <code>org/infinispan/hibernate/cache/commons/builder/infinispan-configs-local.xml</code> value.
You can find more about the configuration check the <a href="#default_local_configuration_second_level">Default Local Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>A simple tutorial showing how to use Infinispan as Hibernate cache provider in a standalone application can be found
<a href="https://github.com/infinispan/infinispan-simple-tutorials/tree/master/hibernate-cache/local">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="single_node_standalone_spring_application"><a class="anchor" href="#single_node_standalone_spring_application"></a>2.1.2. Single-Node Standalone Spring Application</h4>
<div class="paragraph">
<p>Using Hibernate within Spring applications is a very common use case.
In this section you will learn what you need to do configure Hibernate within Spring to use Infinispan as second-level cache provider.</p>
</div>
<div class="paragraph">
<p>As in the previous case, start by making sure that Hibernate Infinispan Cache provider is available in the classpath.
Then, modify <code>application.properties</code> file to contain:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Use Infinispan second level cache provider
spring.jpa.properties.hibernate.cache.region.factory_class=infinispan
#
# Force using local configuration when only using a single node.
# Otherwise a clustered configuration is loaded.
spring.jpa.properties.hibernate.cache.infinispan.cfg=org/infinispan/hibernate/cache/commons/builder/infinispan-configs-local.xml</pre>
</div>
</div>
<div class="paragraph">
<p>By default when running standalone, the Infinispan second-level cache provider uses an Infinispan configuration that’s designed for clustered environments.
However, Infinispan also provides a configuration designed for local, single node, environments.
To enable that configuration, set <code>spring.jpa.properties.hibernate.cache.infinispan.cfg</code> to <code>org/infinispan/hibernate/cache/commons/builder/infinispan-configs-local.xml</code> value.
You can find more about the configuration check the <a href="#default_local_configuration_second_level">Default Local Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>A simple tutorial showing how to use Infinispan as Hibernate cache provider in a Spring application can be found
<a href="https://github.com/infinispan/infinispan-simple-tutorials/tree/master/hibernate-cache/spring-local">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="single_node_wildfly_application"><a class="anchor" href="#single_node_wildfly_application"></a>2.1.3. Single-Node WildFly Application</h4>
<div class="paragraph">
<p>In WildFly, Infinispan is the default second level cache provider for JPA/Hibernate.
This means that when using JPA in WildFly, region factory is already set to <code>infinispan</code>.
Infinispan&#8217;s configuration is located in WildFly&#8217;s <code>standalone.xml</code> file.
It follows the same settings explained in <a href="#default_local_configuration_second_level">Default Local Configuration</a> section.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When running in WildFly, do not set <code>hibernate.cache.infinispan.cfg</code>.
The configuration of the caches comes from WildFly&#8217;s configuration file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Several aspects of the Infinispan second level cache provider can be configured directly in <code>persistence.xml</code>.
This means that some of those tweaks do not require changing WildFly&#8217;s <code>standalone.xml</code> file.
You can find out more about these changes in the <a href="#configuration_properties">Configuration Properties</a> section.</p>
</div>
<div class="paragraph">
<p>So, to enable Hibernate to use Infinispan as second-level cache, all you need to do is enable second-level cache.
This is explained in detail in the introduction of this chapter.</p>
</div>
<div class="paragraph">
<p>A simple tutorial showing how to use Infinispan as Hibernate cache provider in a WildFly application can be found
<a href="https://github.com/infinispan/infinispan-simple-tutorials/tree/master/hibernate-cache/wildfly-local">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="multi_node_standalone_hibernate_application"><a class="anchor" href="#multi_node_standalone_hibernate_application"></a>2.1.4. Multi-Node Standalone Hibernate Application</h4>
<div class="paragraph">
<p>When running a JPA/Hibernate in a multi-node environment and enabling Infinispan second-level cache, it is necessary to cluster the second-level cache so that cache consistency can be guaranteed.
Clustering the Infinispan second-level cache provider is as simple as adding the following property to the <code>persistence.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Use Infinispan second level cache provider --&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default Infinispan configuration used by the second-level cache provider is already configured to work in a cluster environment, so no need to add any extra properties.
You can find more about the configuration check the <a href="#default_cluster_configuration_second_level">Default Cluster Configuration</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="multi_node_standalone_spring_application"><a class="anchor" href="#multi_node_standalone_spring_application"></a>2.1.5. Multi-Node Standalone Spring Application</h4>
<div class="paragraph">
<p>If interested in running a Spring application that uses Hibernate and Infinispan as second level cache, the cache needs to be clustered.
Clustering the Infinispan second-level cache provider is as simple as adding the following property to the <code>application.properties</code> file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Use Infinispan second level cache provider
spring.jpa.properties.hibernate.cache.region.factory_class=infinispan</pre>
</div>
</div>
<div class="paragraph">
<p>The default Infinispan configuration used by the second-level cache provider is already configured to work in a cluster environment, so no need to add any extra properties.
You can find more about the configuration check the <a href="#default_cluster_configuration_second_level">Default Cluster Configuration</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="multi_node_wildfly_application"><a class="anchor" href="#multi_node_wildfly_application"></a>2.1.6. Multi-Node WildFly Application</h4>
<div class="paragraph">
<p>As mentioned in the single node WildFly case, Infinispan is the default second level cache provider for JPA/Hibernate when running inside WildFly.
This means that when using JPA in WildFly, region factory is already set to <code>infinispan</code>.</p>
</div>
<div class="paragraph">
<p>When running WildFly multi-node clusters, it is recommended that you start off by using <code>clustered.xml</code> configuration file.
Within this file you can find Hibernate Infinispan caches configured with the correct settings to work in a clustered environment.
You can find more about the configuration check the <a href="#default_cluster_configuration_second_level">Default Cluster Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>Several aspects of the Infinispan second level cache provider can be configured directly in <code>persistence.xml</code>.
This means that some of those tweaks do not require changing WildFly&#8217;s <code>standalone-ha.xml</code> file.
You can find out more about these changes in the <a href="#configuration_properties">Configuration Properties</a> section.</p>
</div>
<div class="paragraph">
<p>So, to enable Hibernate to use Infinispan as second-level cache, all you need to do is enable second-level cache.
Enabling second-level cache is explained in detail in the introduction of this chapter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_reference"><a class="anchor" href="#configuration_reference"></a>2.2. Configuration Reference</h3>
<div class="paragraph">
<p>This section is dedicated at explaining configuration in detail as well as some extra configuration options.</p>
</div>
<div class="sect3">
<h4 id="default_local_configuration_second_level"><a class="anchor" href="#default_local_configuration_second_level"></a>2.2.1. Default Local Configuration</h4>
<div class="paragraph">
<p>Infinispan second-level cache provider comes with a configuration designed for local, single node, environments.
These are the characteristics of such configuration:</p>
</div>
<div class="paragraph">
<p>Entities, collections, queries and timestamps are stored in non-transactional local caches.</p>
</div>
<div class="paragraph">
<p>Entities and collections query caches are configured with the following eviction settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eviction wake up interval is 5 seconds.</p>
</li>
<li>
<p>Max number of entries are 10,000.</p>
</li>
<li>
<p>Max idle time before expiration is 100 seconds.</p>
</li>
<li>
<p>Default eviction algorithm is LRU, least recently used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can change these settings on a per entity or collection basis or per individual entity or collection type.
More information in the <a href="#configuration_properties">Configuration Properties</a> section below.</p>
</div>
<div class="paragraph">
<p><em>No eviction/expiration is configured for timestamp caches</em>, nor it&#8217;s allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="default_cluster_configuration_second_level"><a class="anchor" href="#default_cluster_configuration_second_level"></a>2.2.2. Default Cluster Configuration</h4>
<div class="paragraph">
<p>Infinispan second-level cache provider default configuration is designed for multi-node clustered environments.
The aim of this section is to explain the default settings for each of the different global data type caches (entity, collection, query and timestamps), why these were chosen and what are the available alternatives.
These are the characteristics of such configuration:</p>
</div>
<div class="paragraph">
<div class="title">Entities and Collections</div>
<p>By default all <em>entities and collections are configured to use a synchronous invalidation</em> as clustering mode.
Whenever a new <em>entity or collection is read from database</em> and needs to be cached, <em>it&#8217;s only cached locally</em> in order to reduce intra-cluster traffic.
This option can be changed so that entities/collections are cached cluster wide, by switching the entity/collection cache to be replicated or distributed.
How to change this option is explained in the <a href="#configuration_properties">Configuration Properties</a> section.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When data read from the database is put in the cache, with replicated or distributed caches,
the data is propagated to other nodes using asynchronous communication.
In the presence of concurrent database loads, one operation will succeed while others might fail (silently).
This is fine because they&#8217;d all be trying to put the same data loaded from the database.
This has the side effect that under these circumstances, the cache might not be up to date right after making the JPA call that leads to the database load.
However, the cache will eventually contain the data loaded, even if it happens after a short delay.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All <em>entities and collections are configured to use a synchronous invalidation</em> as clustering mode.
This means that when an entity is updated, the updated cache will send a message to the other members of the cluster telling them that the entity has been modified.
Upon receipt of this message, the other nodes will remove this data from their local cache, if it was stored there.
This option can be changed so that both local and remote nodes contain the updates by configuring entities or collections to use a replicated or distributed cache.
With replicated caches all nodes would contain the update, whereas with distributed caches only a subset of the nodes.
How to change this option is explained in the <a href="#configuration_properties">Configuration Properties</a> section.</p>
</div>
<div class="paragraph">
<p>All <em>entities and collections have initial state transfer disabled</em> since there&#8217;s no need for it.</p>
</div>
<div class="paragraph">
<p>Entities and collections are configured with the following eviction settings.
You can change these settings on a per entity or collection basis or per individual entity or collection type.
More information in the <a href="#configuration_properties">Configuration Properties</a> section below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eviction wake up interval is 5 seconds.</p>
</li>
<li>
<p>Max number of entries are 10,000.</p>
</li>
<li>
<p>Max idle time before expiration is 100 seconds.</p>
</li>
<li>
<p>Default eviction algorithm is LRU, least recently used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Queries</div>
<p>Assuming that query caching has been enabled for the persistence unit (see chapter introduction), the query cache is configured so that <em>queries are only cached locally</em>.
Alternatively, you can configure query caching to use replication by selecting the <code>replicated-query</code> as query cache name.
However, replication for query cache only makes sense if, and only if, all of this conditions are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Performing the query is quite expensive.</p>
</li>
<li>
<p>The same query is very likely to be repeatedly executed on different cluster nodes.</p>
</li>
<li>
<p>The query is unlikely to be invalidated out of the cache</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hibernate must aggressively invalidate query results from the cache any time any instance of one of the entity types targeted by the query.
All such query results are invalidated, even if the change made to the specific entity instance would not have affected the query result.
For example: the cached result of <code>SELECT id FROM cars where color = 'red'</code> is thrown away when you call <code>INSERT INTO cars VALUES &#8230;&#8203;, color = 'blue'</code>.
Also, the result of an update within a transaction is not visible to the result obtained from the query cache.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>query cache</em> uses the <em>same eviction/expiration settings as for entities/collections</em>.</p>
</div>
<div class="paragraph">
<p><em>query cache has initial state transfer disabled</em>. It is not recommended that this is enabled.</p>
</div>
<div class="paragraph">
<p>Up to Hibernate 5.2 both transactional and non-transactional query caches have been supported, though non-transactional variant is recommended. Hibernate 5.3 drops support for transactional caches, only non-transactional variant is supported. If the cache is configured with transactions this setting is ignored and warning is logged.</p>
</div>
<div class="paragraph">
<div class="title">Timestamps</div>
<p>The <em>timestamps cache is configured with asynchronous replication</em> as clustering mode.
Local or invalidated cluster modes are not allowed, since all cluster nodes must store all timestamps.
As a result, <em>no eviction/expiration is allowed for timestamp caches either</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Asynchronous replication was selected as default for timestamps cache for performance reasons.
A side effect of this choice is that when an entity/collection is updated, for a very brief period of time stale queries might be returned.
It&#8217;s important to note that due to how Infinispan deals with asynchronous replication, stale queries might be found even query is done right after an entity/collection update on same node.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hibernate must aggressively invalidate query results from the cache any time any instance of one of the entity types is modified.
All cached query results referencing given entity type are invalidated, even if the change made to the specific entity instance would not have affected the query result.
The timestamps cache plays here an important role - it contains last modification timestamp for each entity type.
After a cached query results is loaded, its timestamp is compared to all timestamps of the entity types that are referenced in the query.
If any of these is higher, the cached query result is discarded and the query is executed against DB.
This requires synchronization of the wall clock across the cluster to work as expected.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuration_properties"><a class="anchor" href="#configuration_properties"></a>2.2.3. Configuration Properties</h4>
<div class="paragraph">
<p>As explained above, Infinispan second-level cache provider comes with default configuration in <code>infinispan-config.xml</code> that is suited for clustered use.
If there&#8217;s only single JVM accessing the DB, you can use more performant <code>infinispan-config-local.xml</code> by setting the <code>hibernate.cache.infinispan.cfg</code> property.
If you require further tuning of the cache, you can provide your own configuration.
Caches that are not specified in the provided configuration will default to <code>infinispan-config.xml</code> (if the provided configuration uses clustering) or <code>infinispan-config-local.xml</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is not possible to specify the configuration this way in WildFly.
Cache configuration changes in WildFly should be done either modifying the cache configurations inside the application server configuration, or creating new caches with the desired tweaks and plugging them accordingly.
See examples below on how entity/collection specific configurations can be applied.
</td>
</tr>
</table>
</div>
<div id="caching_provider_infinispan_config_example" class="listingblock">
<div class="title">Use custom Infinispan configuration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-infinispan-configuration.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the cache is configured as transactional, Infinispan cache provider automatically sets transaction manager so that the TM used by Infinispan is the same as TM used by Hibernate.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cache configuration can differ for each type of data stored in the cache.
In order to override the cache configuration template, use property <code>hibernate.cache.infinispan.<em>data-type</em>.cfg</code> where <code><em>data-type</em></code> can be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>entity</code>:
Entities indexed by <code>@Id</code> or <code>@EmbeddedId</code> attribute.</p>
</li>
<li>
<p><code>immutable-entity</code>:
Entities tagged with <code>@Immutable</code> annotation or set as <code>mutable=false</code> in mapping file.</p>
</li>
<li>
<p><code>naturalid</code>:
Entities indexed by their <code>@NaturalId</code> attribute.</p>
</li>
<li>
<p><code>collection</code>:
All collections.</p>
</li>
<li>
<p><code>timestamps</code>:
Mapping <em>entity type</em> &#8594; <em>last modification timestamp</em>.
Used for query caching.</p>
</li>
<li>
<p><code>query</code>:
Mapping <em>query</em> &#8594; <em>query result</em>.</p>
</li>
<li>
<p><code>pending-puts</code>:
Auxiliary caches for regions using invalidation mode caches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For specifying cache template for specific region, use region name instead of the <code><em>data-type</em></code>:</p>
</div>
<div id="caching_provider_infinispan_config_cache_example" class="listingblock">
<div class="title">Use custom cache template</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.entities.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom-entities</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.query.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom-query-cache</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.com.example.MyEntity.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-entities</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.com.example.MyEntity.someCollection.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-entities-some-collection</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Use custom cache template in WildFly</div>
<p>When applying entity/collection level changes inside JPA applications deployed in WildFly, it is necessary to specify deployment name and persistence unit name (separated by <code>#</code> character):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan._war_or_ear_name_#_unit_name_.com.example.MyEntity.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-entities</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan._war_or_ear_name_#_unit_name_.com.example.MyEntity.someCollection.cfg</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-entities-some-collection</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Cache configurations are used only as a template for the cache created for given region.
Usually each entity hierarchy or collection has its own region
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Except for eviction/expiration settings, it is highly recommended not to deviate from the template configuration settings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some options in the cache configuration can also be overridden directly through properties.
These are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hibernate.cache.infinispan.<em>something</em>.eviction.strategy</code>:
Available options are <code>NONE</code>, <code>LRU</code> and <code>LIRS</code>.</p>
</li>
<li>
<p><code>hibernate.cache.infinispan.<em>something</em>.eviction.max_entries</code>:
Maximum number of entries in the cache.</p>
</li>
<li>
<p><code>hibernate.cache.infinispan.<em>something</em>.expiration.lifespan</code>:
Lifespan of entry from insert into cache (in milliseconds).</p>
</li>
<li>
<p><code>hibernate.cache.infinispan.<em>something</em>.expiration.max_idle</code>:
Lifespan of entry from last read/modification (in milliseconds).</p>
</li>
<li>
<p><code>hibernate.cache.infinispan.<em>something</em>.expiration.wake_up_interval</code>:
Period of thread checking expired entries.</p>
</li>
<li>
<p><code>hibernate.cache.infinispan.statistics</code>:
Globally enables/disable Infinispan statistics collection, and their exposure via JMX.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.entity.eviction.strategy</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.entity.eviction.wake_up_interval</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.entity.eviction.max_entries</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.entity.expiration.lifespan</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.entity.expiration.max_idle</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above configuration, you&#8217;re overriding whatever eviction/expiration settings were defined for the default entity cache name in the Infinispan cache configuration used.
This happens regardless of whether it&#8217;s the default one or user defined.
More specifically, we&#8217;re defining the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All entities to use LRU eviction strategy</p>
</li>
<li>
<p>The eviction thread to wake up every 2 seconds (2000 milliseconds)</p>
</li>
<li>
<p>The maximum number of entities for each entity type to be 5000 entries</p>
</li>
<li>
<p>The lifespan of each entity instance to be 1 minute (60000 milliseconds).</p>
</li>
<li>
<p>The maximum idle time for each entity instance to be 30 seconds (30000 milliseconds).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also override eviction/expiration settings on a per entity/collection type basis.
This allows overrides that only affects a particular entity (i.e. <code>com.acme.Person</code>) or collection type (i.e. <code>com.acme.Person.addresses</code>).
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.com.acme.Person.eviction.strategy</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">LIRS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside of WildFly, same as with the entity/collection configuration override, eviction/expiration settings would also require deployment name and persistence unit information
(a working example can be found
<a href="https://github.com/infinispan/infinispan-simple-tutorials/tree/master/hibernate-cache/wildfly-local">here</a>
):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan._war_or_ear_name_#_unit_name_.com.acme.Person.eviction.strategy</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">LIRS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan._war_or_ear_name_#_unit_name_.com.acme.Person.expiration.lifespan</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">value</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">65000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cache_strategies"><a class="anchor" href="#cache_strategies"></a>2.3. Cache Strategies</h3>
<div class="paragraph">
<p>Infinispan cache provider supports all Hibernate cache strategies:
<code>transactional</code>, <code>read-write</code>, <code>nonstrict-read-write</code> and <code>read-only</code>.</p>
</div>
<div class="paragraph">
<p>Integrations with Hibernate 4.x required <em>transactional invalidation caches</em> and in integrations with Hibernate &le; 5.2 <em>transactional invalidation caches</em> are supported (in JTA environment). However for all 5.x versions <em>non-transactional caches</em> are preferred. With Hibernate 5.3 the support for transactional caches has been dropped completely, and both <code>read-write</code> and <code>transactional</code> use the same implementation. Infinispan provides the same consistency guarantees for both <code>transactional</code> and <code>read-write</code> strategies, use of transactions is considered an implementation detail.</p>
</div>
<div class="paragraph">
<p>In integrations with Hibernate 5.2 or lower the actual setting of cache concurrency mode (<code>read-write</code> vs. <code>transactional</code>) is not honored on invalidation caches, the appropriate strategy is selected based on the cache configuration (<em>non-transactional</em> vs. <em>transactional</em>).</p>
</div>
<div class="paragraph">
<p>Support for <em>replicated/distributed</em> caches for <code>read-write</code> and <code>read-only</code> strategies has been added during 5.x development and this requires exclusively <em>non-transactional configuration</em>.
Also eviction should not be used in this configuration as it can lead to consistency issues. Expiration (with reasonably long max-idle times) can be used.</p>
</div>
<div class="paragraph">
<p><code>Nonstrict-read-write</code> strategy is supported on <em>non-transactional distributed/replicated</em> caches, but the eviction should be turned off as well. In addition to that, the entities must use versioning. This means that this strategy cannot be used for caching natural IDs (which are never versioned). This mode mildly relaxes the consistency - between DB commit and end of transaction commit a stale read may occur in another transaction.
However this strategy uses less RPCs and can be more performant than the other ones.</p>
</div>
<div class="paragraph">
<p><code>Read-only</code> mode is supported in all configurations mentioned above but use of this mode currently does not bring any performance gains.</p>
</div>
<div class="paragraph">
<p>The available combinations are summarized in table below:</p>
</div>
<table id="caching_provider_infinispan_compatibility_table" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Cache concurrency strategy/cache mode compatibility table</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Concurrency strategy</th>
<th class="tableblock halign-left valign-top">Cache transactions</th>
<th class="tableblock halign-left valign-top">Cache mode</th>
<th class="tableblock halign-left valign-top">Eviction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&le; 5.2 transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">invalidation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&ge; 5.3 non-transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">invalidation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read-write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">invalidation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read-write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">distributed/replicated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nonstrict-read-write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">distributed/replicated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Changing caches to behave different to the default behaviour explained in previous section is explained in the <a href="#configuration_properties">Configuration Properties</a> section.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Use of transactional caches is possible only in JTA environment. Hibernate supports JDBC-only transactions but Infinispan transactional caches do not integrate with these. Therefore, in non-JTA environment the only option is to use <code>read-write</code>, <code>nonstrict-read-write</code> or <code>read-only</code> on non-transactional cache. Configuring the cache as transactional in non-JTA can lead to undefined behaviour.
</td>
</tr>
</table>
</div>
<div id="caching_provider_infinispan_stale_read_example" class="listingblock">
<div class="title">Stale read with <code>nonstrict-read-write</code> strategy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">A=<span class="integer">0</span> (non-cached), B=<span class="integer">0</span> (cached in <span class="integer">2L</span>C)
TX1: write A = <span class="integer">1</span>, write B = <span class="integer">1</span>
TX1: start commit
TX1: commit A, B in DB
TX2: read A = <span class="integer">1</span> (from DB), read B = <span class="integer">0</span> (from <span class="integer">2L</span>C) <span class="comment">// breaks transactional atomicity</span>
TX1: update A, B in <span class="integer">2L</span>C
TX1: end commit
Tx3: read A = <span class="integer">1</span>, B = <span class="integer">1</span> <span class="comment">// reads after TX1 commit completes are consistent again</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using_minimal_puts"><a class="anchor" href="#using_minimal_puts"></a>2.4. Using minimal puts</h3>
<div class="paragraph">
<p>Hibernate offers a configuration option <code>hibernate.cache.use_minimal_puts</code> which is off by default in Infinispan implementation. This option checks if the cache contains given key before updating the value from database (put-from-load) and omits the update if the cached value is already present.
When using invalidation caches it makes sense to keep this off as the put-from-load is local node-only and silently fails if the entry is locked. With replicated/distributed caches the update is applied to remote nodes, even if the local node already contains the entry, and this has higher performance impact, so it might make sense to turn this option on and avoid updating the cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="integrations_hibernate_ogm"><a class="anchor" href="#integrations_hibernate_ogm"></a>2.5. JPA / Hibernate OGM</h3>
<div class="paragraph">
<p>Hibernate can perform CRUD operations directly on an Infinispan cluster.</p>
</div>
<div class="paragraph">
<p>Hibernate OGM is an extension of the popular Hibernate ORM project which makes
the Hibernate API suited to interact with NoSQL databases such as Infinispan.</p>
</div>
<div class="paragraph">
<p>When some of your object graphs need high scalability and elasticity, you can
use Hibernate OGM to store these specific entities into Infinispan instead of
your traditional RDBMS.
The drawback is that Infinispan - not being a relational database - can not run
complex relational queries.</p>
</div>
<div class="paragraph">
<p>Hibernate OGM allows you to get started with Infinispan in minutes, as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the JPA API and its annotations are simple and well known</p>
</li>
<li>
<p>you don&#8217;t need to learn Protobuf or Externalizer encoding formats</p>
</li>
<li>
<p>no need to learn the Infinispan API</p>
</li>
<li>
<p>the Hot Rod client is also setup and managed for you</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It will still be beneficial to eventually learn how to configure Infinispan for
top performance and learn about all capabilities it has, but you can get a proof
of concept application done quickly with the example configuration.</p>
</div>
<div class="paragraph">
<p>Hibernate OGM also gives you several more benefits; being designed and
implemented in collaboration with the Infinispan team it incorporates experience
and deep understanding of how to best perform some common operations.</p>
</div>
<div class="paragraph">
<p>For example a common mistake for people new to Infinispan is to "serialize"
Java POJOs for long term storage of important information; the Infinispan API
allows this as it&#8217;s useful for short lived caching of metadata, but you wouldn&#8217;t
be able to de-serialize your data when you make any changes to your model.
You wouldn&#8217;t want to wipe your database after any and each update of your
application, would you?</p>
</div>
<div class="paragraph">
<p>In the best of cases such an encoding wouldn&#8217;t be very efficient; in some worse
scenarios your team might not have thought such details though and you get stuck
into a complex migration on your live data.</p>
</div>
<div class="paragraph">
<p>Just like when using Hibernate ORM with a relational database, data stored over
Hibernate OGM is easy to recover even using other tools as it&#8217;s encoded using a
well defined Protobuf schema.</p>
</div>
<div class="paragraph">
<p>Being able to "map" new domain objects by simply adding a couple of annotations
is going to make you more productive than re-inventing such error-prone encoding
techniques, or figuring out how to best store object graphs and relations
into Infinispan.</p>
</div>
<div class="paragraph">
<p>Finally, using Hibernate OGM allows you to use all existing framework
integration points, such as injecting an <code>EntityManager</code> as usual: it&#8217;s not
yet another tool but it&#8217;s the real Hibernate, so inheriting all well known
integrations: this will work in Java EE, Spring, Grails, Jhipster, &#8230;&#8203; and all
other technologies integrating with Hibernate.</p>
</div>
<div class="paragraph">
<p>It&#8217;s booted like any Hibernate instance: compared to using it with an RDBMS
you just have to change some configuration properties, and of course omit the
<code>DataSource</code> as Infinispan won&#8217;t use one.</p>
</div>
<div class="paragraph">
<p>For more details, check the <a href="http://hibernate.org/ogm/">Hibernate OGM project</a>
and the <a href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/#ogm-infinispan">Hibernate OGM / Infinispan</a>
section of the documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring_integration"><a class="anchor" href="#spring_integration"></a>3. Using Infinispan with Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan integrates with the Spring Framework to make it easy to add caching capabilities to your applications.</p>
</div>
<div class="sect2">
<h3 id="spring_cache_provider"><a class="anchor" href="#spring_cache_provider"></a>3.1. Setting Up Infinispan as a Spring Cache Provider</h3>
<div class="paragraph">
<p>Infinispan implements the Spring SPI to offer high-performance, in-memory caching capabilities.</p>
</div>
<div class="sect3">
<h4 id="spring_add_support"><a class="anchor" href="#spring_add_support"></a>3.1.1. Adding Spring Cache Support</h4>
<div class="paragraph">
<p>The <a href="http://spring.io/">Spring Framework</a> offers a <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache">cache abstraction</a> with two simple annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Cacheable</code> adds entries to the cache.</p>
</li>
<li>
<p><code>@CacheEvict</code> removes entries from the cache.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To add caching support to your application, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable cache annotations in your application context either declaratively or programmatically.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Declaratively:</strong> Add <code>&lt;cache:annotation-driven/&gt;</code> to your application context.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/cache</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;cache:annotation-driven</span> <span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Programmatically:</strong> Enable cache support as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@EnableCaching</span> <span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span> {
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add Infinispan and the Spring integration module to your <code>pom.xml</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Embedded mode: <code>infinispan-spring5-embedded</code></p>
</li>
<li>
<p>Remote client-server mode: <code>infinispan-spring5-remote</code></p>
<div class="paragraph">
<p>The following is an example with embedded mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>infinispan-spring5-embedded<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="comment">&lt;!-- Tip: Use the Spring Boot starter
    instead of the spring-boot artifact. --&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-context<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${version.spring}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="spring_configure_cache_provider"><a class="anchor" href="#spring_configure_cache_provider"></a>3.1.2. Configuring Infinispan as the Spring Cache Provider</h4>
<div class="paragraph">
<p>The Spring cache provider SPI has two interfaces through which it interacts with Infinispan: <code>org.springframework.cache.CacheManager</code> and <code>org.springframework.cache.Cache</code>. The <code>CacheManager</code> interface acts as a factory for named <code>Cache</code> instances.</p>
</div>
<div class="paragraph">
<p>At runtime Spring looks for a <code>CacheManager</code> implementation that has a bean named <code>cacheManager</code> in the application context.</p>
</div>
<div class="paragraph">
<p>You can configure your application context either declaratively or programmatically.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Declaratively:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Infinispan cache manager --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.spring.embedded.provider.SpringEmbeddedCacheManagerFactoryBean</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">p:configurationFileLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/org/infinispan/spring/embedded/provider/sample/books-infinispan-config.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Programmatically:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@EnableCaching</span>
<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span> {

   <span class="annotation">@Bean</span>
   <span class="directive">public</span> CacheManager cacheManager() {
      <span class="keyword">return</span> <span class="keyword">new</span> SpringEmbeddedCacheManager(infinispanCacheManager());
   }

   <span class="directive">private</span> EmbeddedCacheManager infinispanCacheManager() {
      <span class="keyword">return</span> <span class="keyword">new</span> DefaultCacheManager();
   }

}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring_add_caching"><a class="anchor" href="#spring_add_caching"></a>3.2. Adding Caching to Your Application</h3>
<div class="paragraph">
<p>Add the <code>@Cacheable</code> and <code>@CacheEvict</code> annotations to your application code.</p>
</div>
<div class="sect3">
<h4 id="spring_add_entries"><a class="anchor" href="#spring_add_entries"></a>3.2.1. Adding Cache Entries</h4>
<div class="paragraph">
<p>The <code>@Cacheable</code> annotation adds returned values to a defined cache.</p>
</div>
<div class="paragraph">
<p>For instance, you have a data access object (DAO) for books. You want book instances to be cached after they have been loaded from the underlying database using <code>BookDao#findBook(Integer bookId)</code>.</p>
</div>
<div class="paragraph">
<p>Annotate the <code>findBook(Integer bookId)</code> method with <code>@Cacheable</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@Transactional</span>
<span class="annotation">@Cacheable</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, key = <span class="string"><span class="delimiter">&quot;</span><span class="content">#bookId</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<span class="predefined-type">Integer</span> bookId) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any <code>Book</code> instances returned from <code>findBook(Integer bookId)</code> are stored in a cache named <code>books</code>, using <code>bookId</code> as the key.</p>
</div>
<div class="paragraph">
<p>Note that "#bookId" is an expression in the <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/expressions.html">Spring Expression Language</a> that evaluates the <code>bookId</code> argument.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application needs to reference entries in the cache directly, you should include the <code>key</code> attribute. Without this attribute, Spring generates a hash from the supplied method arguments to use as the cache key.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="spring_remove_entries"><a class="anchor" href="#spring_remove_entries"></a>3.2.2. Deleting Cache Entries</h4>
<div class="paragraph">
<p>The <code>@CacheEvict</code> annotation deletes entries from a defined cache.</p>
</div>
<div class="paragraph">
<p>Annotate the <code>deleteBook(Integer bookId)</code> method with <code>@CacheEvict</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Evict all entries in the &quot;books&quot; cache</span>
<span class="annotation">@Transactional</span>
<span class="annotation">@CacheEvict</span> (value=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, key = <span class="string"><span class="delimiter">&quot;</span><span class="content">#bookId</span><span class="delimiter">&quot;</span></span>, allEntries = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">void</span> deleteBookAllEntries() {...}

<span class="comment">// Evict entries in the &quot;books&quot; cache that match #bookId</span>
<span class="annotation">@Transactional</span>
<span class="annotation">@CacheEvict</span> (value=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, key = <span class="string"><span class="delimiter">&quot;</span><span class="content">#bookId</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> deleteBook(<span class="predefined-type">Integer</span> bookId) {...]}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring_configure_timeouts"><a class="anchor" href="#spring_configure_timeouts"></a>3.3. Configuring Timeouts for Cache Operations</h3>
<div class="paragraph">
<p>The Infinispan Spring cache provider defaults to blocking behaviour when performing read and write operations. By default operations are synchronous and do not time out. However, you might want to set a maximum time to wait for operations before timing out in some situations. For example, timeouts are useful if you need to ensure that an operation completes within a certain time and you can ignore the cached value.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>infinispan.spring.operation.read.timeout</code></dt>
<dd>
<p>Specifies the time, in milliseconds, to wait for read operations to complete. The default is <code>0</code> which means unlimited wait time.</p>
</dd>
<dt class="hdlist1"><code>infinispan.spring.operation.write.timeout</code></dt>
<dd>
<p>Specifies the time, in milliseconds, to wait for write operations to complete. The default is <code>0</code> which means unlimited wait time.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To configure timeouts for cache operations, set the properties in the context XML for your application on either <code>SpringEmbeddedCacheManagerFactoryBean</code> or <code>SpringRemoteCacheManagerFactoryBean</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In remote client-server mode, you can also add these properties to <code>hotrod-client.properties</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows the timeout properties in the context XML for <code>SpringRemoteCacheManagerFactoryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">springRemoteCacheManagerConfiguredUsingConfigurationProperties</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.spring.remote.provider.SpringRemoteCacheManagerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">configurationProperties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
           <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.spring.operation.read.timeout</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>500<span class="tag">&lt;/prop&gt;</span>
           <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.spring.operation.write.timeout</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>700<span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring_externalize_sessions"><a class="anchor" href="#spring_externalize_sessions"></a>3.4. Externalizing Sessions Using Spring Session</h3>
<div class="paragraph">
<p><a href="http://docs.spring.io/spring-session/docs/current/reference/html5">Spring Session</a> lets you externalize user session information into Infinispan.</p>
</div>
<div class="paragraph">
<p>To configure Spring Session integration in your application, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add dependencies to your <code>pom.xml</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Embedded mode: <code>infinispan-spring5-embedded</code></p>
</li>
<li>
<p>Remote client-server mode: <code>infinispan-spring5-remote</code></p>
<div class="paragraph">
<p>The following is an example with remote client-server mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>infinispan-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>infinispan-spring5-remote<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-context<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${version.spring}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>spring-session-core<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;version&gt;</span>${version.spring}<span class="tag">&lt;/version&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>spring-web<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;version&gt;</span>${version.spring}<span class="tag">&lt;/version&gt;</span>
   <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Specify the appropriate FactoryBean to expose a <code>CacheManager</code> instance.</p>
<div class="ulist">
<ul>
<li>
<p>Embedded mode: <code>SpringEmbeddedCacheManagerFactoryBean</code></p>
</li>
<li>
<p>Remote client-server mode: <code>SpringRemoteCacheManagerFactoryBean</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Enable Spring Session with the appropriate annotation.</p>
<div class="ulist">
<ul>
<li>
<p>Embedded mode: <code>@EnableInfinispanEmbeddedHttpSession</code></p>
</li>
<li>
<p>Remote client-server mode: <code>@EnableInfinispanRemoteHttpSession</code></p>
<div class="paragraph">
<p>These annotations have optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxInactiveIntervalInSeconds</code> sets session expiration time in seconds. The default is <code>1800</code>.</p>
</li>
<li>
<p><code>cacheName</code> specifies the name of the cache that stores sessions. The default is <code>sessions</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows a complete, annotation-based configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@EnableInfinispanEmbeddedHttpSession</span>
<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span> {

   <span class="annotation">@Bean</span>
   <span class="directive">public</span> SpringEmbeddedCacheManagerFactoryBean springCacheManager() {
      <span class="keyword">return</span> <span class="keyword">new</span> SpringEmbeddedCacheManagerFactoryBean();
   }

   <span class="comment">//An optional configuration bean responsible for replacing the default</span>
   <span class="comment">//cookie that obtains configuration.</span>
   <span class="comment">//For more information refer to the Spring Session documentation.</span>
   <span class="annotation">@Bean</span>
   <span class="directive">public</span> HttpSessionStrategy httpSessionStrategy() {
      <span class="keyword">return</span> <span class="keyword">new</span> HeaderHttpSessionStrategy();
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="infinispan_modules_for_wildfly_eap"><a class="anchor" href="#infinispan_modules_for_wildfly_eap"></a>4. Infinispan modules for WildFly / EAP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As the Infinispan modules shipped with <a href="http://wildfly.org/">WildFly</a> / <a href="https://www.redhat.com/en/technologies/jboss-middleware/application-platform">EAP</a> are tailored to its internal usage, it is recommend to install separate modules
if you want to use Infinispan in your application that is deployed to WildFly / EAP. By installing these modules, it is possible to deploy user applications without packaging the Infinispan JARs within the deployments (WARs, EARs, etc), thus minimizing their size.
Also, there will be no conflict with WildFly / EAP&#8217;s internal modules since the slot will be different.</p>
</div>
<div class="sect2">
<h3 id="modules_installation_section"><a class="anchor" href="#modules_installation_section"></a>4.1. Installation</h3>
<div class="paragraph">
<p>The modules for WildFly / EAP are available in the <a href="http://infinispan.org/download/">downloads</a> section of our site.
After extracting the zip, copy the contents of the <code>modules</code> directory to the <code>WILDFLY_HOME/modules</code> directory, so that
for example the Infinispan core module would be under <code>WILDFLY_HOME/modules/system/add-ons/ispn/org/infinispan/core</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="application_dependencies"><a class="anchor" href="#application_dependencies"></a>4.2. Application Dependencies</h3>
<div class="paragraph">
<p>If you are using Maven to build your application, mark the Infinispan dependencies as <em>provided</em> and configure your artifact archiver to generate the appropriate MANIFEST.MF file:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>infinispan-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>infinispan-cachestore-jdbc<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;build&gt;</span>
  <span class="tag">&lt;plugins&gt;</span>
     <span class="tag">&lt;plugin&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;configuration&gt;</span>
         <span class="tag">&lt;archive&gt;</span>
           <span class="tag">&lt;manifestEntries&gt;</span>
             <span class="tag">&lt;Dependencies&gt;</span>org.infinispan.core:ispn-10.1 services, org.infinispan.cachestore.jdbc:ispn-10.1 services<span class="tag">&lt;/Dependencies&gt;</span>
           <span class="tag">&lt;/manifestEntries&gt;</span>
         <span class="tag">&lt;/archive&gt;</span>
      <span class="tag">&lt;/configuration&gt;</span>
    <span class="tag">&lt;/plugin&gt;</span>
  <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next section illustrates the manifest entries for different types of Infinispan&#8217;s dependencies.</p>
</div>
<div class="sect3">
<h4 id="infinispan_core"><a class="anchor" href="#infinispan_core"></a>4.2.1. Infinispan core</h4>
<div class="paragraph">
<p>In order expose only Infinispan core dependencies to your application, add the follow to the manifest:</p>
</div>
<div class="listingblock">
<div class="title">MANIFEST.MF</div>
<div class="content">
<pre class="CodeRay highlight"><code>Manifest-Version: 1.0
Dependencies: org.infinispan:ispn-10.1 services</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remote"><a class="anchor" href="#remote"></a>4.2.2. Remote</h4>
<div class="paragraph">
<p>If you need to connect to remote Infinispan servers via Hot Rod, including execution of remote queries, use the module <code>org.infinispan.remote</code> that exposes the needed dependencies conveniently:</p>
</div>
<div class="listingblock">
<div class="title">MANIFEST.MF</div>
<div class="content">
<pre class="CodeRay highlight"><code>Manifest-Version: 1.0
Dependencies: org.infinispan.remote:ispn-10.1 services</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embedded_query"><a class="anchor" href="#embedded_query"></a>4.2.3. Embedded Query</h4>
<div class="paragraph">
<p>For embedded querying, including the Infinispan Query DSL, Lucene and Hibernate Search Queries, add the following:</p>
</div>
<div class="listingblock">
<div class="title">MANIFEST.MF</div>
<div class="content">
<pre class="CodeRay highlight"><code>Manifest-Version: 1.0
Dependencies: org.infinispan:ispn-10.1 services, org.infinispan.query:ispn-10.1 services</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lucene_directory"><a class="anchor" href="#lucene_directory"></a>4.2.4. Lucene Directory</h4>
<div class="paragraph">
<p>Lucene users who wants to simple use Infinispan as a <em>org.apache.lucene.store.Directory</em> don&#8217;t need to add the query module, the entry below is sufficient:</p>
</div>
<div class="listingblock">
<div class="title">MANIFEST.MF</div>
<div class="content">
<pre class="CodeRay highlight"><code>Manifest-Version: 1.0
Dependencies: org.infinispan.lucene-directory:ispn-10.1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hibernate_search_directory_provider_for_infinispan"><a class="anchor" href="#hibernate_search_directory_provider_for_infinispan"></a>4.2.5. Hibernate Search directory provider for Infinispan</h4>
<div class="paragraph">
<p>The Hibernate Search directory provider for Infinispan is also contained within the Infinispan modules zip. It is not necessary to add an entry to the manifest file since the Hibernate Search module already has an optional dependency to it.
When choosing the Infinispan module zip to use, start by checking which Hibernate Search is in use, more details below.</p>
</div>
<div class="sect4">
<h5 id="usage_with_wildfly_internal_hibernate_search_modules"><a class="anchor" href="#usage_with_wildfly_internal_hibernate_search_modules"></a>Usage with WildFly Internal Hibernate Search Modules</h5>
<div class="paragraph">
<p>The Hibernate Search module present in WildFly
10.x
has slot "5.5", which in turn has an optional dependency to <code>org.infinispan.hibernate-search.directory-provider:for-hibernatesearch-5.5</code>.
This dependency will be available once the Infinispan modules are <a href="#modules_installation_section">installed</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="usage_with_other_hibernate_search_modules"><a class="anchor" href="#usage_with_other_hibernate_search_modules"></a>Usage with other Hibernate Search modules</h5>
<div class="paragraph">
<p>The module <code>org.hibernate.search:ispn-10.1</code> distributed with Infinispan is to be used together with Infinispan Query only (querying data from caches), and should not be used by Hibernate ORM applications.
To use a Hibernate Search with a different version that is present in WildFly, please consult the <a href="https://docs.jboss.org/hibernate/search/5.6/reference/en-US/html_single/#search-configuration-deploy-on-wildfly">Hibernate Search documentation</a>.</p>
</div>
<div class="paragraph">
<p>Make sure that the chosen Hibernate Search optional slot for <code>org.infinispan.hibernate-search.directory-provider</code> matches the one distributed with Infinispan.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage"><a class="anchor" href="#usage"></a>4.2.6. Usage</h4>
<div class="paragraph">
<p>There are two possible ways for your application to utilize Infinispan within WildFly, embedded mode and server mode.</p>
</div>
</div>
<div class="sect3">
<h4 id="embedded_mode"><a class="anchor" href="#embedded_mode"></a>4.2.7. Embedded Mode</h4>
<div class="paragraph">
<p>All CacheManagers and cache instances are created in your application logic.  The lifecycle of your EmbeddedCacheManager
is tightly coupled with your application&#8217;s lifecycle, resulting in any manager instances created by your application being destroyed with your application.</p>
</div>
<div class="sect4">
<h5 id="server_mode"><a class="anchor" href="#server_mode"></a>Server Mode</h5>
<div class="paragraph">
<p>In server mode, it is possible for cache containers and caches to be created before runtime as part of WildFly&#8217;s
standalone/domain.xml configuration. This allows cache instances to be shared across multiple applications, with the
lifecycle of the underlying cache container being independent of the deployed application.</p>
</div>
<div class="sect5">
<h6 id="configuration_3"><a class="anchor" href="#configuration_3"></a>Configuration</h6>
<div class="paragraph">
<p>To enable server mode, make the following additions to your WildFly configuration in <code>standalone/domain.xml</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the Infinispan extensions to your <code>&lt;extensions&gt;</code> section.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;extensions&gt;</span>
  <span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.extension:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.server.endpoint:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups.extension:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="comment">&lt;!--Other wildfly extensions--&gt;</span>
<span class="tag">&lt;/extensions&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Infinispan subsystem and your required containers and caches in the server profile that requires Infinispan.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure that you define the <code>module</code> attribute to load the correct Infinispan classes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:10.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 <span class="tag">&lt;cache-container</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.extension:ispn-10.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan_container</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;transport</span><span class="tag">/&gt;</span>
   <span class="tag">&lt;global-state</span><span class="tag">/&gt;</span>
   <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcachedCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namedCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Define the WildFly <a href="https://docs.jboss.org/author/display/WFLY10/Interfaces+and+ports">socket-bindings</a> required by the endpoint and/or JGroup subsystems</p>
</li>
<li>
<p>Configure any endpoints that you require via the endpoint subsystem:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:endpoint:10.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan_container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;topology-state-transfer</span> <span class="attribute-name">lazy-retrieval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">replication-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/hotrod-connector&gt;</span>
  <span class="tag">&lt;rest-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan_container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auth-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/rest-connector&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Define the JGroups transport, ensuring that you define the <code>model</code> attribute for each protocol.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You do not neet to define a JGroups transport for local cache configurations. The JGroups transport is required for clustered cache configurations only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:jgroups:10.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 <span class="tag">&lt;channels</span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;/channels&gt;</span>
 <span class="tag">&lt;stacks&gt;</span>
   <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UDP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PING</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp-fd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UFC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups:ispn-10.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/stack&gt;</span>
 <span class="tag">&lt;/stacks&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing_containers_and_caches"><a class="anchor" href="#accessing_containers_and_caches"></a>Accessing Containers and Caches</h5>
<div class="paragraph">
<p>Once a container has been defined in your server&#8217;s configuration, it is possible to inject an instance of a CacheContainer
or Cache into your application using the <code>@Resource</code> JNDI lookup. A container is accessed using the following string
<code>java:jboss/datagrid-infinispan/container/&lt;container_name&gt;</code> and similarly a cache is
accessed via <code>java:jboss/datagrid-infinispan/container/&lt;container_name&gt;/cache/&lt;cache_name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The example below shows how to inject the CacheContainer
called "infinispan_container" and the distributed cache "namedCache" into an application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleApplication</span> {
    <span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datagrid-infinispan/container/infinispan_container</span><span class="delimiter">&quot;</span></span>)
    CacheContainer container;

    <span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datagrid-infinispan/container/infinispan_container/cache/namedCache</span><span class="delimiter">&quot;</span></span>)
    Cache cache;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>4.3. Troubleshooting</h3>
<div class="sect3">
<h4 id="enable_logging"><a class="anchor" href="#enable_logging"></a>4.3.1. Enable logging</h4>
<div class="paragraph">
<p>Enabling trace on <code>org.jboss.modules</code> can be useful to debug issues like <code>LinkageError</code> and <code>ClassNotFoundException</code>.
To enable it at runtime using the WildFly CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/jboss-cli.sh -c '/subsystem=logging/logger=org.jboss.modules:add'
bin/jboss-cli.sh -c '/subsystem=logging/logger=org.jboss.modules:write-attribute(name=level,value=TRACE)'</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="print_dependency_tree"><a class="anchor" href="#print_dependency_tree"></a>4.3.2. Print dependency tree</h4>
<div class="paragraph">
<p>The following command can be used to print all dependencies for a certain module. For example, to obtain the tree for the module <code>org.infinispan:ispn-10.1</code>, execute from <code>WILDFLY_HOME</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -jar jboss-modules.jar -deptree -mp modules/ &quot;org.infinispan:ispn-10.1&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-05-03 12:31:45 -0400
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>