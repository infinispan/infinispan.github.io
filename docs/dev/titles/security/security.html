<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Infinispan Security Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPD7V946LB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GPD7V946LB');
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.17/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<link rel="stylesheet" href="/assets/css/clipboard.css">
<link rel="stylesheet" href="/assets/css/cookieconsent.css">
<link rel="shortcut icon" type="image/png" href="/favicon.ico" >
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.17/jstree.min.js"></script>
<script src="/assets/javascript/clipboard.min.js"></script>
<script src="/assets/javascript/copy.js"></script>
<script src="/assets/javascript/cookieconsent.umd.js"></script>
<script src="/assets/javascript/cookieconsent.config.js" type="module"></script>
<script src="../../js/js.js"></script>
<link rel="canonical" href="https://infinispan.org/docs/stable/titles/security/security.html">
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Infinispan Security Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#security">1. Infinispan Security</a></li>
<li><a href="#security-authorization">2. Security authorization with role-based access control</a>
<ul class="sectlevel2">
<li><a href="#default-user-roles_security-authorization">2.1. Infinispan user roles and permissions</a>
<ul class="sectlevel3">
<li><a href="#user-permissions_security-authorization">2.1.1. Permissions</a></li>
<li><a href="#role-mappers_security-authorization">2.1.2. Role and permission mappers</a>
<ul class="sectlevel4">
<li><a href="#mapping_users_to_roles_and_permissions_in_infinispan">Mapping users to roles and permissions in Infinispan</a></li>
</ul>
</li>
<li><a href="#configuring-role-mappers_security-authorization">2.1.3. Configuring role mappers</a></li>
<li><a href="#configuring-cluster-role-mapper_security-authorization">2.1.4. Configuring the cluster role and permission mappers</a>
<ul class="sectlevel4">
<li><a href="#creating-roles_security-authorization">Creating new roles</a></li>
<li><a href="#granting-roles-to-users_security-authorization">Granting roles to users</a></li>
<li><a href="#cluster_role_mapper_name_rewriters">Cluster role mapper name rewriters</a>
<ul class="sectlevel5">
<li><a href="#case_principal_transformer">Case Principal Transformer</a></li>
<li><a href="#regex_principal_transformer">Regex Principal Transformer</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuring-cache-authorization_security-authorization">2.2. Configuring caches with security authorization</a></li>
</ul>
</li>
<li><a href="#security-realms">3. Security realms</a>
<ul class="sectlevel2">
<li><a href="#creating-security-realms_security-realms">3.1. Creating security realms</a></li>
<li><a href="#setting-up-kerberos-identities_security-realms">3.2. Setting up Kerberos identities</a></li>
<li><a href="#property-security-realms_security-realms">3.3. Property realms</a>
<ul class="sectlevel3">
<li><a href="#property_realm_file_structure">3.3.1. Property realm file structure</a></li>
</ul>
</li>
<li><a href="#ldap-security-realms_security-realms">3.4. LDAP realms</a>
<ul class="sectlevel3">
<li><a href="#ldap_connection_properties">3.4.1. LDAP connection properties</a></li>
<li><a href="#ldap_realm_user_authentication_methods">3.4.2. LDAP realm user authentication methods</a></li>
<li><a href="#mapping_user_entries_to_their_associated_groups">3.4.3. Mapping user entries to their associated groups</a></li>
<li><a href="#ldap_realm_configuration_reference">3.4.4. LDAP realm configuration reference</a>
<ul class="sectlevel4">
<li><a href="#ldap-realm-principal-rewriting_security-realms">LDAP realm principal rewriting</a></li>
<li><a href="#ldap_principal_rewriting_configuration_reference">LDAP principal rewriting configuration reference</a></li>
<li><a href="#ldap_user_and_group_mapping_process_with_infinispan">LDAP user and group mapping process with Infinispan</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#token-security-realms_security-realms">3.5. Token realms</a></li>
<li><a href="#trust-store-security-realms_security-realms">3.6. Trust store realms</a></li>
<li><a href="#distributed-security-realms_security-realms">3.7. Distributed security realms</a></li>
<li><a href="#aggregate-security-realms_security-realms">3.8. Aggregate security realms</a>
<ul class="sectlevel3">
<li><a href="#name_rewriters">3.8.1. Name rewriters</a>
<ul class="sectlevel4">
<li><a href="#case_principal_transformer_3">Case Principal Transformer</a></li>
<li><a href="#common_name_principal_transformer_2">Common Name Principal Transformer</a></li>
<li><a href="#regex_principal_transformer_3">Regex Principal Transformer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#caching-security-realms_security-realms">3.9. Security realm caching</a>
<ul class="sectlevel3">
<li><a href="#flushing_realm_caches">3.9.1. Flushing realm caches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#authentication-mechanisms">4. Endpoint authentication mechanisms</a>
<ul class="sectlevel2">
<li><a href="#server-authentication_endpoint-authentication">4.1. Infinispan Server authentication</a></li>
<li><a href="#configuring-server-authentication_endpoint-authentication">4.2. Configuring Infinispan Server authentication mechanisms</a>
<ul class="sectlevel3">
<li><a href="#disabling-authentication_endpoint-authentication">4.2.1. Disabling authentication</a></li>
</ul>
</li>
<li><a href="#server-endpoint-authentication-mechanisms_endpoint-authentication">4.3. Infinispan Server authentication mechanisms</a>
<ul class="sectlevel3">
<li><a href="#sasl-authentication-mechanisms_endpoint-authentication">4.3.1. SASL authentication mechanisms</a></li>
<li><a href="#sasl-quality-of-protection_endpoint-authentication">4.3.2. SASL quality of protection (QoP)</a></li>
<li><a href="#sasl-policies-hot-rod-authentication_endpoint-authentication">4.3.3. SASL policies</a></li>
<li><a href="#rest-authentication-mechanisms_endpoint-authentication">4.3.4. HTTP authentication mechanisms</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuring-encryption">5. Configuring TLS/SSL encryption</a>
<ul class="sectlevel2">
<li><a href="#configuring-server-keystores_endpoint-security">5.1. Configuring Infinispan Server keystores</a>
<ul class="sectlevel3">
<li><a href="#ssltls_certificate_rotation">5.1.1. SSL/TLS Certificate rotation</a></li>
<li><a href="#generating-server-keystores_endpoint-security">5.1.2. Generating Infinispan Server keystores</a></li>
<li><a href="#configuring-ssl-engine_endpoint-security">5.1.3. Configuring TLS versions and cipher suites</a></li>
</ul>
</li>
<li><a href="#configuring-server-fips_endpoint-security">5.2. Configuring Infinispan Server on a system with FIPS 140-2 compliant cryptography</a>
<ul class="sectlevel3">
<li><a href="#configuring_the_pkcs11_cryptographic_provider">5.2.1. Configuring the PKCS11 cryptographic provider</a></li>
<li><a href="#configuring_the_bouncy_castle_fips_cryptographic_provider">5.2.2. Configuring the Bouncy Castle FIPS cryptographic provider</a></li>
</ul>
</li>
<li><a href="#configuring-client-certificate-authentication_endpoint-security">5.3. Configuring client certificate authentication</a></li>
<li><a href="#configuring-client-certificate-authorization_endpoint-security">5.4. Configuring authorization with client certificates</a></li>
</ul>
</li>
<li><a href="#credential-keystores">6. Storing Infinispan Server credentials in keystores</a>
<ul class="sectlevel2">
<li><a href="#setting-up-credential-keystores_credential-keystores">6.1. Setting up credential keystores</a></li>
<li><a href="#securing-passwords-credential-keystores_credential-keystores">6.2. Securing passwords for credential keystores</a></li>
<li><a href="#credential-keystore-configuration_credential-keystores">6.3. Credential keystore configuration</a></li>
<li><a href="#credential-keystore-references_credential-keystores">6.4. Credential keystore references</a></li>
</ul>
</li>
<li><a href="#secure-cluster-transport">7. Encrypting cluster transport</a>
<ul class="sectlevel2">
<li><a href="#securing-cluster-transport-tls-identities_secure-cluster-transport">7.1. Securing cluster transport with TLS identities</a></li>
<li><a href="#jgroups-encryption-protocols_secure-cluster-transport">7.2. JGroups encryption protocols</a></li>
<li><a href="#configuring-jgroups-asym-encrypt_secure-cluster-transport">7.3. Securing cluster transport with asymmetric encryption</a></li>
<li><a href="#configuring-jgroups-sym-encrypt_secure-cluster-transport">7.4. Securing cluster transport with symmetric encryption</a></li>
</ul>
</li>
<li><a href="#ports_protocols">8. Infinispan ports and protocols</a>
<ul class="sectlevel2">
<li><a href="#server-ports-protocols_network">8.1. Infinispan Server ports and protocols</a>
<ul class="sectlevel3">
<li><a href="#configuring-firewalls_network">8.1.1. Configuring network firewalls for Infinispan traffic</a></li>
</ul>
</li>
<li><a href="#jgroups-ports_network">8.2. TCP and UDP ports for cluster traffic</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Securing the environment and restricting access to clusters is of critical importance for any deployment that stores sensitive data.
This guide provides information and security best practices to help you protect Infinispan caches against network intrusion and unauthorized access.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security"><a class="anchor" href="#security"></a>1. Infinispan Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides security for components as well as data across different layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Within the core library to provide role-based access control (RBAC) to CacheManagers, Cache instances, and stored data.</p>
</li>
<li>
<p>Over remote protocols to authenticate client requests and encrypt network traffic.</p>
</li>
<li>
<p>Across nodes in clusters to authenticate new cluster members and encrypt the cluster transport.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Infinispan core library uses standard Java security libraries such as
JAAS, JSSE, JCA, JCE, and SASL to ease integration and improve compatibility
with custom applications and container environments. For this reason, the
Infinispan core library provides only interfaces and a set of basic
implementations.</p>
</div>
<div class="paragraph">
<p>Infinispan servers support a wide range of security standards and mechanisms
to readily integrate with enterprise-level security frameworks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-authorization"><a class="anchor" href="#security-authorization"></a>2. Security authorization with role-based access control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Role-based access control (RBAC) capabilities use different permissions levels to restrict user interactions with Infinispan.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For information on creating users and configuring authorization specific to remote or embedded caches, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../server/server.html#rbac-remote">Configuring user roles and permissions with Infinispan Server</a></p>
</li>
<li>
<p><a href="../embedding/embedding.html#rbac-embedded">Programmatically configuring user roles and permissions</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="default-user-roles_security-authorization"><a class="anchor" href="#default-user-roles_security-authorization"></a>2.1. Infinispan user roles and permissions</h3>
<div class="paragraph">
<p>Infinispan includes several roles that provide users with permissions to access caches and Infinispan resources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superuser with all permissions including control of the Cache Manager lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR, CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and delete Infinispan resources in addition to <code>application</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read and write access to Infinispan resources in addition to <code>observer</code> permissions. Can also listen to events and execute server tasks and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>observer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read access to Infinispan resources in addition to <code>monitor</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view statistics via JMX and the <code>metrics</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/security/AuthorizationPermission.html">org.infinispan.security.AuthorizationPermission Enum</a></p>
</li>
<li>
<p><a href="../../configuration-schema/index.html">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="user-permissions_security-authorization"><a class="anchor" href="#user-permissions_security-authorization"></a>2.1.1. Permissions</h4>
<div class="paragraph">
<p>User roles are sets of permissions with different access levels.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<caption class="title">Table 1. Cache Manager permissions</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIGURATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defineConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines new cache configurations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stops the Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCache</code>, <code>removeCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and remove container resources  such as caches, counters, schemas, and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all Cache Manager permissions.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<caption class="title">Table 2. Cache permissions</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>contains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves entries from a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put</code>, <code>putIfAbsent</code>, <code>replace</code>, <code>remove</code>, <code>evict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes, replaces, removes, evicts data in a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distexec</code>, <code>streams</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows code execution against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keySet</code>, <code>values</code>, <code>entrySet</code>, <code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk retrieve operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clear</code>, <code>putAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk write operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code>, <code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts and stops a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getVersion</code>, <code>addInterceptor*</code>, <code>removeInterceptor</code>, <code>getInterceptorChain</code>, <code>getEvictionManager</code>, <code>getComponentRegistry</code>, <code>getDistributionManager</code>, <code>getAuthorizationManager</code>, <code>evict</code>, <code>getRpcManager</code>, <code>getCacheConfiguration</code>, <code>getCacheManager</code>, <code>getInvocationContextContainer</code>, <code>setAvailability</code>, <code>getDataContainer</code>, <code>getStats</code>, <code>getXAResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to underlying components and internal structures.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all cache permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the READ and BULK_READ permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the WRITE and BULK_WRITE permissions.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="role-mappers_security-authorization"><a class="anchor" href="#role-mappers_security-authorization"></a>2.1.2. Role and permission mappers</h4>
<div class="paragraph">
<p>Infinispan implements users as a collection of principals.
Principals represent either an individual user identity, such as a username, or a group to which the users belong. Internally, these are implemented with the <code>javax.security.auth.Subject</code> class.</p>
</div>
<div class="paragraph">
<p>To enable authorization, the principals must be mapped to role names, which are then expanded into a set of permissions.</p>
</div>
<div class="paragraph">
<p>Infinispan includes the <code>PrincipalRoleMapper</code> API for associating security principals to roles, and the <code>RolePermissionMapper</code> API for associating roles with specific permissions.</p>
</div>
<div class="paragraph">
<p>Infinispan provides the following role and permission mapper implementations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cluster role mapper</dt>
<dd>
<p>Stores principal to role mappings in the cluster registry.</p>
</dd>
<dt class="hdlist1">Cluster permission mapper</dt>
<dd>
<p>Stores role to permission mappings in the cluster registry. Allows you to dynamically modify user roles and permissions.</p>
</dd>
<dt class="hdlist1">Identity role mapper</dt>
<dd>
<p>Uses the principal name as the role name. The type or format of the principal name depends on the source. For example, in an LDAP directory the principal name could be a Distinguished Name (DN).</p>
</dd>
<dt class="hdlist1">Common name role mapper</dt>
<dd>
<p>Uses the Common Name (CN) as the role name. You can use this role mapper with an LDAP directory or with client certificates that contain Distinguished Names (DN); for example <code>cn=managers,ou=people,dc=example,dc=com</code> maps to the <code>managers</code> role.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, principal-to-role mapping is only applied to principals which represent groups.
It is possible to configure Infinispan to also perform the mapping for user principals by setting the
<code>authorization.group-only-mapping</code> configuration attribute to <code>false</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="mapping_users_to_roles_and_permissions_in_infinispan"><a class="anchor" href="#mapping_users_to_roles_and_permissions_in_infinispan"></a>Mapping users to roles and permissions in Infinispan</h5>
<div class="paragraph">
<p>Consider the following user retrieved from an LDAP server, as a collection of DNs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CN=myapplication,OU=applications,DC=mycompany
CN=dataprocessors,OU=groups,DC=mycompany
CN=finance,OU=groups,DC=mycompany</pre>
</div>
</div>
<div class="paragraph">
<p>Using the <strong>Common name role mapper</strong>, the user would be mapped to the following roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataprocessors
finance</pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan has the following role definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataprocessors: ALL_WRITE ALL_READ
finance: LISTEN</pre>
</div>
</div>
<div class="paragraph">
<p>The user would have the following permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ALL_WRITE ALL_READ LISTEN</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/security/PrincipalRoleMapper.html">org.infinispan.security.PrincipalRoleMapper</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/security/RolePermissionMapper.html">org.infinispan.security.RolePermissionMapper</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/security/mappers/IdentityRoleMapper.html">org.infinispan.security.mappers.IdentityRoleMapper</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/security/mappers/CommonNameRoleMapper.html">org.infinispan.security.mappers.CommonNameRoleMapper</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-role-mappers_security-authorization"><a class="anchor" href="#configuring-role-mappers_security-authorization"></a>2.1.3. Configuring role mappers</h4>
<div class="paragraph">
<p>Infinispan enables the cluster role mapper and cluster permission mapper by default.
To use a different implementation for role mapping, you must configure the role mappers.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Declare the role mapper as part of the security authorization in the Cache Manager configuration.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With embedded caches you can programmatically configure role and permission mappers with the <code>principalRoleMapper()</code> and <code>rolePermissionMapper()</code> methods.</p>
</div>
<h5 id="role_mapper_configuration" class="discrete">Role mapper configuration</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;cache-container&gt;
  &lt;security&gt;
    &lt;authorization&gt;
      &lt;common-name-role-mapper /&gt;
    &lt;/authorization&gt;
  &lt;/security&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "security" : {
        "authorization" : {
          "common-name-role-mapper": {}
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">infinispan:
  cacheContainer:
    security:
      authorization:
        commonNameRoleMapper: ~</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../configuration-schema/index.html">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-cluster-role-mapper_security-authorization"><a class="anchor" href="#configuring-cluster-role-mapper_security-authorization"></a>2.1.4. Configuring the cluster role and permission mappers</h4>
<div class="paragraph">
<p>The cluster role mapper maintains a dynamic mapping between principals and roles.
The cluster permission mapper maintains a dynamic set of role definitions.
In both cases, the mappings are stored in the cluster registry and can be manipulated at runtime using either the CLI or the REST API.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Start the Infinispan CLI.</p>
</li>
<li>
<p>Connect to a running Infinispan cluster.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="creating-roles_security-authorization"><a class="anchor" href="#creating-roles_security-authorization"></a>Creating new roles</h5>
<div class="paragraph">
<p>Create new roles and set the permissions.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create roles with the <code class="command">user roles create</code> command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">user roles create --permissions=ALL_READ,ALL_WRITE simple</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>List roles that you grant to users with the <code class="command">user roles ls</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">user roles ls
["observer","application","admin","monitor","simple","deployer"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Describe roles with the <code class="command">user roles describe</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">user roles describe simple
{
  "name" : "simple",
  "permissions" : [ "ALL_READ","ALL_WRITE" ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="granting-roles-to-users_security-authorization"><a class="anchor" href="#granting-roles-to-users_security-authorization"></a>Granting roles to users</h5>
<div class="paragraph">
<p>Assign roles to users and grant them permissions to perform cache operations and interact with Infinispan resources.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grant roles to groups instead of users if you want to assign the same role to multiple users and centrally maintain their permissions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Create Infinispan users.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Assign roles to users with the <code class="command">user roles grant</code> command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">user roles grant --roles=deployer katie</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>List roles that you grant to users with the <code class="command">user roles ls</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">user roles ls katie
["deployer"]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cluster_role_mapper_name_rewriters"><a class="anchor" href="#cluster_role_mapper_name_rewriters"></a>Cluster role mapper name rewriters</h5>
<div class="paragraph">
<p>By default, the mapping is performed using a strict string equivalence between principal names and roles.
It is possible to configure the cluster role mapper to apply transformation to the principal name before performing a lookup.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Specify a name rewriter for the cluster role mapper as part of the security authorization in the Cache Manager configuration.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Principal names may have different forms, depending on the security realm type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties and Token realms may return simple strings</p>
</li>
<li>
<p>Trust and LDAP realms may return X.500-style distinguished names</p>
</li>
<li>
<p>Kerberos realms may return <code>user@domain</code>-style names</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Names can be normalized to a common form using one of the following transformers:</p>
</div>
<div class="sect5">
<h6 id="case_principal_transformer"><a class="anchor" href="#case_principal_transformer"></a>Case Principal Transformer</h6>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;cache-container&gt;
   &lt;security&gt;
      &lt;authorization&gt;
         &lt;cluster-role-mapper&gt;
            &lt;name-rewriter&gt;
               &lt;case-principal-transformer uppercase="false"/&gt;
            &lt;/name-rewriter&gt;
         &lt;/cluster-role-mapper&gt;
      &lt;/authorization&gt;
   &lt;/security&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "cache-container": {
    "security": {
      "authorization": {
        "cluster-role-mapper": {
          "name-rewriter": {
            "case-principal-transformer": {}
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">cacheContainer:
  security:
    authorization:
      clusterRoleMapper:
        nameRewriter:
          casePrincipalTransformer:
            uppercase: false</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="regex_principal_transformer"><a class="anchor" href="#regex_principal_transformer"></a>Regex Principal Transformer</h6>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;cache-container&gt;
   &lt;security&gt;
      &lt;authorization&gt;
         &lt;cluster-role-mapper&gt;
            &lt;name-rewriter&gt;
               &lt;regex-principal-transformer pattern="cn=([^,]+),.*" replacement="$1"/&gt;
            &lt;/name-rewriter&gt;
         &lt;/cluster-role-mapper&gt;
      &lt;/authorization&gt;
   &lt;/security&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "cache-container": {
    "security": {
      "authorization": {
        "cluster-role-mapper": {
          "name-rewriter": {
            "regex-principal-transformer": {
              "pattern": "cn=([^,]+),.*",
              "replacement": "$1"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">cacheContainer:
  security:
    authorization:
      clusterRoleMapper:
        nameRewriter:
          regexPrincipalTransformer:
            pattern: "cn=([^,]+),.*"
            replacement: "$1"</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../configuration-schema/index.html">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-cache-authorization_security-authorization"><a class="anchor" href="#configuring-cache-authorization_security-authorization"></a>2.2. Configuring caches with security authorization</h3>
<div class="paragraph">
<p>Add security authorization to caches to enforce role-based access control (RBAC).
This requires Infinispan users to have a role with a sufficient level of permission to perform cache operations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create Infinispan users and either grant them with roles or assign them to groups.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add a <code>security</code> section to the configuration.</p>
</li>
<li>
<p>Specify roles that users must have to perform cache operations with the <code>authorization</code> element.</p>
<div class="paragraph">
<p>You can implicitly add all roles defined in the Cache Manager or explicitly define a subset of roles.</p>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="implicit_role_configuration" class="discrete">Implicit role configuration</h4>
<div class="paragraph">
<p>The following configuration implicitly adds every role defined in the Cache Manager:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;distributed-cache&gt;
  &lt;security&gt;
    &lt;authorization/&gt;
  &lt;/security&gt;
&lt;/distributed-cache&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "distributed-cache": {
    "security": {
      "authorization": {
        "enabled": true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">distributedCache:
  security:
    authorization:
      enabled: true</code></pre>
</div>
</div>
<h4 id="explicit_role_configuration" class="discrete">Explicit role configuration</h4>
<div class="paragraph">
<p>The following configuration explicitly adds a subset of roles defined in the Cache Manager.
In this case Infinispan denies cache operations for any users that do not have one of the configured roles.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;distributed-cache&gt;
  &lt;security&gt;
    &lt;authorization roles="admin supervisor"/&gt;
  &lt;/security&gt;
&lt;/distributed-cache&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "distributed-cache": {
    "security": {
      "authorization": {
        "enabled": true,
        "roles": ["admin","supervisor"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">distributedCache:
  security:
    authorization:
      enabled: true
      roles: ["admin","supervisor"]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-realms"><a class="anchor" href="#security-realms"></a>3. Security realms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security realms integrate Infinispan Server deployments with the network protocols and infrastructure in your environment that control access and verify user identities.</p>
</div>
<div class="sect2">
<h3 id="creating-security-realms_security-realms"><a class="anchor" href="#creating-security-realms_security-realms"></a>3.1. Creating security realms</h3>
<div class="paragraph">
<p>Add security realms to Infinispan Server configuration to control access to deployments.
You can add one or more security realm to your configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you add security realms to your configuration, Infinispan Server automatically enables the matching authentication mechanisms for the Hot Rod and REST endpoints.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add socket bindings to your Infinispan Server configuration as required.</p>
</li>
<li>
<p>Create keystores, or have a PEM file, to configure the security realm with TLS/SSL encryption.</p>
<div class="paragraph">
<p>Infinispan Server can also generate keystores at startup.</p>
</div>
</li>
<li>
<p>Provision the resources or services that the security realm configuration relies on.<br>
For example, if you add a token realm, you need to provision OAuth services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure demonstrates how to configure multiple property realms.
Before you begin, you need to create properties files that add users and assign permissions with the Command Line Interface (CLI).
Use the <code class="command">user create</code> commands as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">user create &lt;username&gt; -p &lt;changeme&gt; -g &lt;role&gt; \
     --users-file=application-users.properties \
     --groups-file=application-groups.properties

user create &lt;username&gt; -p &lt;changeme&gt; -g &lt;role&gt; \
     --users-file=management-users.properties \
     --groups-file=management-groups.properties</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code class="command">user create --help</code> for examples and more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Adding credentials to a properties realm with the CLI creates the user only on the server instance to which you are connected.
You must manually synchronize credentials in a properties realm to each node in the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Use the <code>security-realms</code> element in the <code>security</code> configuration to contain create multiple security realms.</p>
</li>
<li>
<p>Add a security realm with the <code>security-realm</code> element and give it a unique name with the <code>name</code> attribute.</p>
<div class="paragraph">
<p>To follow the example, create one security realm named <code>application-realm</code> and another named <code>management-realm</code>.</p>
</div>
</li>
<li>
<p>Provide the TLS/SSL identify for Infinispan Server with the <code>server-identities</code> element and configure a keystore as required.</p>
</li>
<li>
<p>Specify the type of security realm by adding one the following elements or fields:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties-realm</code></p>
</li>
<li>
<p><code>ldap-realm</code></p>
</li>
<li>
<p><code>token-realm</code></p>
</li>
<li>
<p><code>truststore-realm</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Specify properties for the type of security realm you are configuring as appropriate.</p>
<div class="paragraph">
<p>To follow the example, specify the <code>*.properties</code> files you created with the CLI using the <code>path</code> attribute on the <code>user-properties</code> and <code>group-properties</code> elements or fields.</p>
</div>
</li>
<li>
<p>If you add multiple different types of security realm to your configuration, include the <code>distributed-realm</code> element or field so that Infinispan Server uses the realms in combination with each other.</p>
</li>
<li>
<p>Configure Infinispan Server endpoints to use the security realm with the with the <code>security-realm</code> attribute.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="multiple_property_realms" class="discrete">Multiple property realms</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="application-realm"&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="application-users.properties"/&gt;
          &lt;group-properties path="application-groups.properties"/&gt;
        &lt;/properties-realm&gt;
      &lt;/security-realm&gt;
      &lt;security-realm name="management-realm"&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="management-users.properties"/&gt;
          &lt;group-properties path="management-groups.properties"/&gt;
        &lt;/properties-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "management-realm",
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "management-realm",
            "path": "management-users.properties"
          },
          "group-properties": {
            "path": "management-groups.properties"
          }
        }
      }, {
        "name": "application-realm",
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "application-realm",
            "path": "application-users.properties"
          },
          "group-properties": {
            "path": "application-groups.properties"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "management-realm"
        propertiesRealm:
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "management-realm"
            path: "management-users.properties"
          groupProperties:
            path: "management-groups.properties"
      - name: "application-realm"
        propertiesRealm:
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "application-realm"
            path: "application-users.properties"
          groupProperties:
            path: "application-groups.properties"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-kerberos-identities_security-realms"><a class="anchor" href="#setting-up-kerberos-identities_security-realms"></a>3.2. Setting up Kerberos identities</h3>
<div class="paragraph">
<p>Add Kerberos identities to a security realm in your Infinispan Server configuration to use <em>keytab</em> files that contain service principal names and encrypted keys, derived from Kerberos passwords.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have Kerberos service account principals.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>keytab</em> files can contain both user and service account principals.
However, Infinispan Server uses service account principals only which means it can provide identity to clients and allow clients to authenticate with Kerberos servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In most cases, you create unique principals for the Hot Rod and REST endpoints.
For example, if you have a "datagrid" server in the "INFINISPAN.ORG" domain you should create the following service principals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hotrod/datagrid@INFINISPAN.ORG</code> identifies the Hot Rod service.</p>
</li>
<li>
<p><code>HTTP/datagrid@INFINISPAN.ORG</code> identifies the REST service.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create keytab files for the Hot Rod and REST services.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">ktutil
ktutil:  addent -password -p datagrid@INFINISPAN.ORG -k 1 -e aes256-cts
Password for datagrid@INFINISPAN.ORG: [enter your password]
ktutil:  wkt http.keytab
ktutil:  quit</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">ktpass -princ HTTP/datagrid@INFINISPAN.ORG -pass * -mapuser INFINISPAN\USER_NAME
ktab -k http.keytab -a HTTP/datagrid@INFINISPAN.ORG</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Copy the keytab files to the <code>server/conf</code> directory of your Infinispan Server installation.</p>
</li>
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan server security realm.</p>
</li>
<li>
<p>Specify the location of keytab files that provide service principals to Hot Rod and REST connectors.</p>
</li>
<li>
<p>Name the Kerberos service principals.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="kerberos_identity_configuration" class="discrete">Kerberos identity configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="kerberos-realm"&gt;
        &lt;server-identities&gt;
          &lt;!-- Specifies a keytab file that provides a Kerberos identity. --&gt;
          &lt;!-- Names the Kerberos service principal for the Hot Rod endpoint. --&gt;
          &lt;!-- The required="true" attribute specifies that the keytab file must be present when the server starts. --&gt;
          &lt;kerberos keytab-path="hotrod.keytab"
                    principal="hotrod/datagrid@INFINISPAN.ORG"
                    required="true"/&gt;
          &lt;!-- Specifies a keytab file and names the Kerberos service principal for the REST endpoint. --&gt;
          &lt;kerberos keytab-path="http.keytab"
                    principal="HTTP/localhost@INFINISPAN.ORG"
                    required="true"/&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="kerberos-realm"&gt;
     &lt;hotrod-connector&gt;
        &lt;authentication&gt;
           &lt;sasl server-name="datagrid"
                 server-principal="hotrod/datagrid@INFINISPAN.ORG"/&gt;
        &lt;/authentication&gt;
     &lt;/hotrod-connector&gt;
     &lt;rest-connector&gt;
       &lt;authentication server-principal="HTTP/localhost@INFINISPAN.ORG"/&gt;
     &lt;/rest-connector&gt;
   &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "kerberos-realm",
        "server-identities": [{
          "kerberos": {
            "principal": "hotrod/datagrid@INFINISPAN.ORG",
            "keytab-path": "hotrod.keytab",
            "required": true
          },
          "kerberos": {
            "principal": "HTTP/localhost@INFINISPAN.ORG",
            "keytab-path": "http.keytab",
            "required": true
          }
        }]
      }]
    },
    "endpoints": {
      "endpoint": {
        "socket-binding": "default",
        "security-realm": "kerberos-realm",
        "hotrod-connector": {
          "authentication": {
            "security-realm": "kerberos-realm",
            "sasl": {
              "server-name": "datagrid",
              "server-principal": "hotrod/datagrid@INFINISPAN.ORG"
            }
          }
        },
        "rest-connector": {
          "authentication": {
            "server-principal": "HTTP/localhost@INFINISPAN.ORG"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "kerberos-realm"
        serverIdentities:
          - kerberos:
              principal: "hotrod/datagrid@INFINISPAN.ORG"
              keytabPath: "hotrod.keytab"
              required: "true"
          - kerberos:
              principal: "HTTP/localhost@INFINISPAN.ORG"
              keytabPath: "http.keytab"
              required: "true"
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "kerberos-realm"
      hotrodConnector:
        authentication:
          sasl:
            serverName: "datagrid"
            serverPrincipal: "hotrod/datagrid@INFINISPAN.ORG"
      restConnector:
        authentication:
          securityRealm: "kerberos-realm"
          serverPrincipal" : "HTTP/localhost@INFINISPAN.ORG"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="property-security-realms_security-realms"><a class="anchor" href="#property-security-realms_security-realms"></a>3.3. Property realms</h3>
<div class="paragraph">
<p>Property realms use property files to define users and groups.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>users.properties</code> contains Infinispan user credentials.
Passwords can be pre-digested.</p>
</li>
<li>
<p><code>groups.properties</code> associates users with roles and permissions.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">users.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">myuser=a_password
user2=another_password</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">groups.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">myuser=supervisor,reader,writer
user2=supervisor</code></pre>
</div>
</div>
<h4 id="property_realm_configuration" class="discrete">Property realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;!-- groups-attribute configures the "groups.properties" file to contain security authorization roles. --&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="users.properties"
                           relative-to="infinispan.server.config.path"
                           plain-text="true"/&gt;
          &lt;group-properties path="groups.properties"
                            relative-to="infinispan.server.config.path"/&gt;
        &lt;/properties-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "default",
            "path": "users.properties",
            "relative-to": "infinispan.server.config.path",
            "plain-text": true
          },
          "group-properties": {
            "path": "groups.properties",
            "relative-to": "infinispan.server.config.path"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        propertiesRealm:
          # groupsAttribute configures the "groups.properties" file
          # to contain security authorization roles.
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "default"
            path: "users.properties"
            relative-to: 'infinispan.server.config.path'
            plainText: "true"
          groupProperties:
            path: "groups.properties"
            relative-to: 'infinispan.server.config.path'</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="property_realm_file_structure"><a class="anchor" href="#property_realm_file_structure"></a>3.3.1. Property realm file structure</h4>
<div class="paragraph">
<p>User properties files are structured as follows:</p>
</div>
<div class="listingblock">
<div class="title">users.properties structure</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">#$REALM_NAME=default$
#$ALGORITHM=encrypted$
#Wed Jul 31 08:32:08 CEST 2024
admin=algorithm-1\:hash-1;algorithm-2\:hash-2;...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first three lines are special comments that define the name of the realm (<code>$REALM_NAME</code>), whether the passwords are
stored in <code>clear</code> or <code>encrypted</code> format (<code>$ALGORITHM</code>) and the timestamp of the last update.</p>
</div>
<div class="paragraph">
<p>User credentials are stored in traditional key/value format: the key corresponds to the username and the value
corresponds to the password. Encrypted passwords are represented as semi-colon-separated algorithm/hash pairs, with the
hash encoded in Base64.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Credentials are encrypted using the realm name. Changing a realm&#8217;s name requires re-encrypting all the passwords.
Use the Infinispan CLI to enter the correct security realm name to the file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap-security-realms_security-realms"><a class="anchor" href="#ldap-security-realms_security-realms"></a>3.4. LDAP realms</h3>
<div class="paragraph">
<p>LDAP realms connect to LDAP servers, such as OpenLDAP, Red Hat Directory
Server, Apache Directory Server, or Microsoft Active Directory, to authenticate
users and obtain membership information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LDAP servers can have different entry layouts, depending on the type of server and deployment.
It is beyond the scope of this document to provide examples for all possible configurations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ldap_connection_properties"><a class="anchor" href="#ldap_connection_properties"></a>3.4.1. LDAP connection properties</h4>
<div class="paragraph">
<p>Specify the LDAP connection properties in the LDAP realm configuration.</p>
</div>
<div class="paragraph">
<p>The following properties are required:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
url
</td>
<td class="hdlist2">
<p>Specifies the URL of the LDAP server. The URL should be in format <code>ldap://hostname:port</code> or <code>ldaps://hostname:port</code> for secure connections using TLS.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
principal
</td>
<td class="hdlist2">
<p>Specifies a distinguished name (DN) of a valid user in the LDAp server. The DN uniquely identifies the user within the LDAP directory structure.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
credential
</td>
<td class="hdlist2">
<p>Corresponds to the password associated with the principal mentioned above.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The principal for LDAP connections must have necessary privileges to perform LDAP queries and access specific attributes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the <code>url</code> uses LDAPS, it may be necessary to define a <a href="../server/server.html#configuring-encryption">server identity</a> containing an appropriate truststore and reference it in the <code>ldap-realm.client-ssl-context</code> configuration attribute.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enabling <code>connection-pooling</code> significantly improves the performance of authentication to LDAP servers.
The connection pooling mechanism is provided by the JDK. For more information see <a href="https://docs.oracle.com/javase/jndi/tutorial/ldap/connect/config.html">Connection Pooling Configuration</a> and <a href="https://docs.oracle.com/javase/tutorial/jndi/ldap/pool.html">Java Tutorials: Pooling</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ldap_realm_user_authentication_methods"><a class="anchor" href="#ldap_realm_user_authentication_methods"></a>3.4.2. LDAP realm user authentication methods</h4>
<div class="paragraph">
<p>Configure the user authentication method in the LDAP realm.</p>
</div>
<div class="paragraph">
<p>The LDAP realm can authenticate users in two ways:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Hashed password comparison
</td>
<td class="hdlist2">
<p>by comparing the hashed password stored in a user&#8217;s password attribute (usually <code>userPassword</code>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Direct verification
</td>
<td class="hdlist2">
<p>by authenticating against the LDAP server using the supplied credentials</p>
<div class="paragraph">
<p>Direct verification is the only approach that works with Active Directory, because access to the <code>password</code> attribute is forbidden.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot use endpoint authentication mechanisms that performs hashing with the <code>direct-verification</code> attribute, since this method requires having the password in clear text.
As a result you must use the <code>BASIC</code> authentication mechanism with the REST endpoint and <code>PLAIN</code> with the Hot Rod endpoint to integrate with Active Directory Server.
A more secure alternative is to use Kerberos, which allows the <code>SPNEGO</code>, <code>GSSAPI</code>, and <code>GS2-KRB5</code> authentication mechanisms.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The LDAP realm searches the directory to find the entry which corresponds to the authenticated user.
The <code>rdn-identifier</code> attribute specifies an LDAP attribute that finds the user entry based on a provided identifier, which is typically a username; for example, the <code>uid</code> or <code>sAMAccountName</code> attribute.
Add <code>search-recursive="true"</code> to the configuration to search the directory recursively.
By default, the search for the user entry uses the <code>(rdn_identifier={0})</code> filter.
You can specify a different filter using the <code>filter-name</code> attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping_user_entries_to_their_associated_groups"><a class="anchor" href="#mapping_user_entries_to_their_associated_groups"></a>3.4.3. Mapping user entries to their associated groups</h4>
<div class="paragraph">
<p>In the LDAP realm configuration, specify the <code>attribute-mapping</code> element to retrieve and associate all groups that a user is a member of.</p>
</div>
<div class="paragraph">
<p>The membership information is stored typically in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under group entries that usually have class <code>groupOfNames</code> or <code>groupOfUniqueNames</code> in the <code>member</code> attribute. This is the default behavior in most LDAP installations, except for Active Directory. In this case, you can use an attribute filter. This filter searches for entries that match the supplied filter, which locates groups with a <code>member</code> attribute equal to the user&#8217;s DN. The filter then extracts the group entry&#8217;s CN as specified by <code>from</code>, and adds it to the user&#8217;s <code>Roles</code>.</p>
</li>
<li>
<p>In the user entry in the <code>memberOf</code> attribute. This is typically the case for Active Directory. In this case you should use an attribute reference such as the following:</p>
<div class="paragraph">
<p><code>&lt;attribute-reference reference="memberOf" from="cn" to="Roles" /&gt;</code></p>
</div>
<div class="paragraph">
<p>This reference gets all <code>memberOf</code> attributes from the user&#8217;s entry, extracts the CN as specified by <code>from</code>, and adds them to the user&#8217;s groups (<code>Roles</code> is the internal name used to map the groups).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ldap_realm_configuration_reference"><a class="anchor" href="#ldap_realm_configuration_reference"></a>3.4.4. LDAP realm configuration reference</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;!-- Specifies connection properties. --&gt;
        &lt;ldap-realm url="ldap://my-ldap-server:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"
                    connection-timeout="3s"
                    read-timeout="30s"
                    connection-pooling="true"
                    referral-mode="ignore"
                    page-size="30"
                    direct-verification="true"&gt;
          &lt;!-- Defines how principals are mapped to LDAP entries. --&gt;
          &lt;identity-mapping rdn-identifier="uid"
                            search-dn="ou=People,dc=infinispan,dc=org"
                            search-recursive="false"&gt;
            &lt;!-- Retrieves all the groups of which the user is a member. --&gt;
            &lt;attribute-mapping&gt;
              &lt;attribute from="cn" to="Roles"
                         filter="(&amp;amp;(objectClass=groupOfNames)(member={1}))"
                         filter-dn="ou=Roles,dc=infinispan,dc=org"/&gt;
            &lt;/attribute-mapping&gt;
          &lt;/identity-mapping&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "url": "ldap://my-ldap-server:10389",
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "credential": "strongPassword",
          "connection-timeout": "3000",
          "read-timeout": "30000",
          "connection-pooling": "true",
          "referral-mode": "ignore",
          "page-size": "30",
          "direct-verification": "true",
          "identity-mapping": {
            "rdn-identifier": "uid",
            "search-dn": "ou=People,dc=infinispan,dc=org",
            "search-recursive": "false",
            "attribute-mapping": [{
              "from": "cn",
              "to": "Roles",
              "filter": "(&amp;(objectClass=groupOfNames)(member={1}))",
              "filter-dn": "ou=Roles,dc=infinispan,dc=org"
            }]
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: ldap-realm
        ldapRealm:
          url: 'ldap://my-ldap-server:10389'
          principal: 'uid=admin,ou=People,dc=infinispan,dc=org'
          credential: strongPassword
          connectionTimeout: '3000'
          readTimeout: '30000'
          connectionPooling: true
          referralMode: ignore
          pageSize: '30'
          directVerification: true
          identityMapping:
            rdnIdentifier: uid
            searchDn: 'ou=People,dc=infinispan,dc=org'
            searchRecursive: false
            attributeMapping:
              - filter: '(&amp;(objectClass=groupOfNames)(member={1}))'
                filterDn: 'ou=Roles,dc=infinispan,dc=org'
                from: cn
                to: Roles</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="ldap-realm-principal-rewriting_security-realms"><a class="anchor" href="#ldap-realm-principal-rewriting_security-realms"></a>LDAP realm principal rewriting</h5>
<div class="paragraph">
<p>Principals obtained by SASL authentication mechanisms such as <code>GSSAPI</code>, <code>GS2-KRB5</code> and <code>Negotiate</code> usually include the domain name, for example <code>myuser@INFINISPAN.ORG</code>.
Before using these principals in LDAP queries, it is necessary to transform them to ensure their compatibility.
This process is called rewriting.</p>
</div>
<div class="paragraph">
<p>Infinispan includes the following transformers:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
case-principal-transformer
</td>
<td class="hdlist2">
<p>rewrites the principal to either all uppercase or all lowercase. For example <code>MyUser</code> would be rewritten as <code>MYUSER</code> in uppercase mode and <code>myuser</code> in lowercase mode.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
common-name-principal-transformer
</td>
<td class="hdlist2">
<p>rewrites principals in the LDAP Distinguished Name format (as defined by <a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a>). It extracts the first attribute of type <code>CN</code> (commonName). For example, <code>DN=CN=myuser,OU=myorg,DC=mydomain</code> would be rewritten as <code>myuser</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
regex-principal-transformer
</td>
<td class="hdlist2">
<p>rewrites principals using a regular expression with capturing groups, allowing, for example, for extractions of any substring.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="ldap_principal_rewriting_configuration_reference"><a class="anchor" href="#ldap_principal_rewriting_configuration_reference"></a>LDAP principal rewriting configuration reference</h5>
<h5 id="case_principal_transformer_2" class="discrete">Case principal transformer</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;ldap-realm url="ldap://${org.infinispan.test.host.address}:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;name-rewriter&gt;
            &lt;!-- Defines a rewriter that transforms usernames to lowercase --&gt;
            &lt;case-principal-transformer uppercase="false"/&gt;
          &lt;/name-rewriter&gt;
          &lt;!-- further configuration omitted --&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://${org.infinispan.test.host.address}:10389",
          "credential": "strongPassword",
          "name-rewriter": {
            "case-principal-transformer": {
              "uppercase": false
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "ldap-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://${org.infinispan.test.host.address}:10389"
          credential: "strongPassword"
          nameRewriter:
            casePrincipalTransformer:
              uppercase: false
          # further configuration omitted</code></pre>
</div>
</div>
<h5 id="common_name_principal_transformer" class="discrete">Common name principal transformer</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;ldap-realm url="ldap://${org.infinispan.test.host.address}:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;name-rewriter&gt;
            &lt;!-- Defines a rewriter that obtains the first CN from a DN --&gt;
            &lt;common-name-principal-transformer /&gt;
          &lt;/name-rewriter&gt;
          &lt;!-- further configuration omitted --&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://${org.infinispan.test.host.address}:10389",
          "credential": "strongPassword",
          "name-rewriter": {
            "common-name-principal-transformer": {}
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "ldap-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://${org.infinispan.test.host.address}:10389"
          credential: "strongPassword"
          nameRewriter:
            commonNamePrincipalTransformer: ~
          # further configuration omitted</code></pre>
</div>
</div>
<h5 id="regex_principal_transformer_2" class="discrete">Regex principal transformer</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;ldap-realm url="ldap://${org.infinispan.test.host.address}:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;name-rewriter&gt;
            &lt;!-- Defines a rewriter that extracts the username from the principal using a regular expression. --&gt;
            &lt;regex-principal-transformer pattern="(.*)@INFINISPAN\.ORG"
                                         replacement="$1"/&gt;
          &lt;/name-rewriter&gt;
          &lt;!-- further configuration omitted --&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://${org.infinispan.test.host.address}:10389",
          "credential": "strongPassword",
          "name-rewriter": {
            "regex-principal-transformer": {
              "pattern": "(.*)@INFINISPAN\\.ORG",
              "replacement": "$1"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "ldap-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://${org.infinispan.test.host.address}:10389"
          credential: "strongPassword"
          nameRewriter:
            regexPrincipalTransformer:
              pattern: (.*)@INFINISPAN\.ORG
              replacement: "$1"
          # further configuration omitted</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ldap_user_and_group_mapping_process_with_infinispan"><a class="anchor" href="#ldap_user_and_group_mapping_process_with_infinispan"></a>LDAP user and group mapping process with Infinispan</h5>
<div class="paragraph">
<p>This example illustrates the process of loading and internally mapping LDAP users and groups to Infinispan subjects.
The following is a LDIF (LDAP Data Interchange Format) file, which describes multiple LDAP entries:</p>
</div>
<div class="listingblock">
<div class="title">LDIF</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-ldif hljs" data-lang="ldif"># Users

dn: uid=root,ou=People,dc=infinispan,dc=org
objectclass: top
objectclass: uidObject
objectclass: person
uid: root
cn: root
sn: root
userPassword: strongPassword

# Groups

dn: cn=admin,ou=Roles,dc=infinispan,dc=org
objectClass: top
objectClass: groupOfNames
cn: admin
description: the Infinispan admin group
member: uid=root,ou=People,dc=infinispan,dc=org

dn: cn=monitor,ou=Roles,dc=infinispan,dc=org
objectClass: top
objectClass: groupOfNames
cn: monitor
description: the Infinispan monitor group
member: uid=root,ou=People,dc=infinispan,dc=org</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>root</code> user is a member of the <code>admin</code> and <code>monitor</code> groups.</p>
</div>
<div class="paragraph">
<p>When a request to authenticate the user <code>root</code> with the password <code>strongPassword</code> is made on one of the endpoints, the following operations are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The username is optionally rewritten using the chosen principal transformer.</p>
</li>
<li>
<p>The realm searches within the <code>ou=People,dc=infinispan,dc=org</code> tree for an entry whose <code>uid</code> attribute is equal to <code>root</code> and finds the entry with DN <code>uid=root,ou=People,dc=infinispan,dc=org</code>, which becomes the user principal.</p>
</li>
<li>
<p>The realm searches within the <code>u=Roles,dc=infinispan,dc=org</code> tree for entries of <code>objectClass=groupOfNames</code> that include <code>uid=root,ou=People,dc=infinispan,dc=org</code> in the <code>member</code> attribute. In this case it finds two entries:
<code>cn=admin,ou=Roles,dc=infinispan,dc=org</code> and <code>cn=monitor,ou=Roles,dc=infinispan,dc=org</code>. From these entries, it extracts the <code>cn</code> attributes which become the group principals.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resulting subject will therefore look like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NamePrincipal: <code>uid=root,ou=People,dc=infinispan,dc=org</code></p>
</li>
<li>
<p>RolePrincipal: <code>admin</code></p>
</li>
<li>
<p>RolePrincipal: <code>monitor</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, the global authorization mappers are applied on the above subject to convert the principals into roles.
The roles are then expanded into a set of permissions, which are validated against the requested cache and operation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token-security-realms_security-realms"><a class="anchor" href="#token-security-realms_security-realms"></a>3.5. Token realms</h3>
<div class="paragraph">
<p>Token realms use external services to validate tokens and require providers
that are compatible with RFC-7662 (OAuth2 Token Introspection), such as
KeyCloak.</p>
</div>
<h4 id="token_realm_configuration" class="discrete">Token realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="token-realm"&gt;
        &lt;!-- Specifies the URL of the authentication server. --&gt;
        &lt;token-realm name="token"
                     auth-server-url="https://oauth-server/auth/"&gt;
          &lt;!-- Specifies the URL of the token introspection endpoint. --&gt;
          &lt;oauth2-introspection introspection-url="https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect"
                                client-id="infinispan-server"
                                client-secret="1fdca4ec-c416-47e0-867a-3d471af7050f"/&gt;
        &lt;/token-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "token-realm",
        "token-realm": {
          "auth-server-url": "https://oauth-server/auth/",
          "oauth2-introspection": {
            "client-id": "infinispan-server",
            "client-secret": "1fdca4ec-c416-47e0-867a-3d471af7050f",
            "introspection-url": "https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: token-realm
        tokenRealm:
          authServerUrl: 'https://oauth-server/auth/'
          oauth2Introspection:
            clientId: infinispan-server
            clientSecret: '1fdca4ec-c416-47e0-867a-3d471af7050f'
            introspectionUrl: 'https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>introspection-url</code> uses HTTPS, it may be necessary to define a <a href="../server/server.html#configuring-encryption">server identity</a> containing an appropriate truststore and reference it in the <code>oauth2-introspection.client-ssl-context</code> configuration attribute.</p>
</div>
<h4 id="token_realm_configuration_with_tls" class="discrete">Token realm configuration with TLS</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="keycloak"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;truststore path="keycloak-trust.pfx" password="secret"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
         &lt;/security-realm&gt;
         &lt;security-realm name="default"&gt;
            &lt;!-- The TLS identity of this server --&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;keystore path="server.pfx" password="secret" alias="server"/&gt;1
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
            &lt;!-- Specifies the URL of the authentication server. --&gt;
            &lt;token-realm name="token"
                         auth-server-url="https://oauth-server/auth/"&gt;
               &lt;!-- Specifies the URL of the token introspection endpoint and uses the `keycloak` SSL context defined above to trust the server --&gt;
               &lt;oauth2-introspection introspection-url="https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect"
                                     client-id="infinispan-server"
                                     client-secret="1fdca4ec-c416-47e0-867a-3d471af7050f"
                                     client-ssl-context="keycloak"
               /&gt;
            &lt;/token-realm&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
   &lt;endpoints socket-binding="default" security-realm="default"/&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "infinispan" : {
    "server" : {
      "security" : {
        "security-realms" : [ {
          "name" : "keycloak",
          "server-identities" : {
            "ssl" : {
              "truststore" : {
                "path" : "ca.pfx",
                "password" : "secret"
              }
            }
          }
        },{
          "name" : "default",
          "server-identities" : {
            "ssl" : {
              "keystore" : {
                "path" : "server.pfx",
                "password" : "secret"
              }
            }
          },
          "token-realm" : {
            "name" : "token-realm",
            "auth-server-url" : "https://127.0.0.1:14568/auth/",
            "client-id" : "infinispan-console",
            "oauth2-introspection" : {
              "client-id" : "infinispan-server",
              "client-ssl-context" : "keycloak",
              "introspection-url" : "https://127.0.0.1:14568/realms/infinispan/protocol/openid-connect/token/introspect",
              "client-secret" : "1fdca4ec-c416-47e0-867a-3d471af7050f"
            }
          }
        } ]
      },
      "endpoints" : {
        "endpoint" : {
          "socket-binding" : "default",
          "security-realm" : "default"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">infinispan:
  server:
    security:
      securityRealms:
        - name: "keycloak"
          serverIdentities:
            ssl:
              truststore:
                path: "ca.pfx"
                password: "secret"
        - name: "default"
          serverIdentities:
            ssl:
              keystore:
                path: "server.pfx"
                password: "secret"
          tokenRealm:
            name: "token-realm"
            authServerUrl: "https://127.0.0.1:14568/auth/"
            clientId: "infinispan-console"
            # Specifies the URL of the token introspection endpoint and uses the `keycloak` SSL context defined above to trust the server
            oauth2Introspection:
              clientId: "infinispan-server"
              clientSslContext: "keycloak"
              introspectionUrl: "https://127.0.0.1:14568/realms/infinispan/protocol/openid-connect/token/introspect"
              clientSecret: "1fdca4ec-c416-47e0-867a-3d471af7050f"
    endpoints:
      socketBinding: "default"
      securityRealm: "default"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trust-store-security-realms_security-realms"><a class="anchor" href="#trust-store-security-realms_security-realms"></a>3.6. Trust store realms</h3>
<div class="paragraph">
<p>Trust store realms use certificates, or certificates chains, that verify Infinispan Server and client identities when they negotiate connections.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Keystores</dt>
<dd>
<p>Contain server certificates that provide a Infinispan Server identity to clients. If you configure a keystore with server certificates, Infinispan Server encrypts traffic using industry standard SSL/TLS protocols.</p>
</dd>
<dt class="hdlist1">Trust stores</dt>
<dd>
<p>Contain client certificates, or certificate chains, that clients present to Infinispan Server. Client trust stores are optional and allow Infinispan Server to perform client certificate authentication.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Client certificate authentication</div>
<p>You must add the <code>require-ssl-client-auth="true"</code> attribute to the endpoint configuration if you want Infinispan Server to validate or authenticate client certificates.</p>
</div>
<h4 id="trust_store_realm_configuration" class="discrete">Trust store realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="trust-store-realm"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Provides an SSL/TLS identity with a keystore that contains server certificates. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      keystore-password="secret"
                      alias="server"/&gt;
            &lt;!-- Configures a trust store that contains client certificates or part of a certificate chain. --&gt;
            &lt;truststore path="trust.p12"
                        relative-to="infinispan.server.config.path"
                        password="secret"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
        &lt;!-- Authenticates client certificates against the trust store. If you configure this, the trust store must contain the public certificates for all clients. --&gt;
        &lt;truststore-realm/&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "trust-store-realm",
        "server-identities": {
          "ssl": {
            "keystore": {
              "path": "server.p12",
              "relative-to": "infinispan.server.config.path",
              "keystore-password": "secret",
              "alias": "server"
            },
            "truststore": {
              "path": "trust.p12",
              "relative-to": "infinispan.server.config.path",
              "password": "secret"
            }
          }
        },
        "truststore-realm": {}
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "trust-store-realm"
        serverIdentities:
          ssl:
            keystore:
              path: "server.p12"
              relative-to: "infinispan.server.config.path"
              keystore-password: "secret"
              alias: "server"
            truststore:
              path: "trust.p12"
              relative-to: "infinispan.server.config.path"
              password: "secret"
        truststoreRealm: ~</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distributed-security-realms_security-realms"><a class="anchor" href="#distributed-security-realms_security-realms"></a>3.7. Distributed security realms</h3>
<div class="paragraph">
<p>Distributed realms combine multiple different types of security realms.
When users attempt to access the Hot Rod or REST endpoints, Infinispan Server uses each security realm in turn until it finds one that can perform the authentication.</p>
</div>
<h4 id="distributed_realm_configuration" class="discrete">Distributed realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="distributed-realm"&gt;
        &lt;ldap-realm url="ldap://my-ldap-server:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;identity-mapping rdn-identifier="uid"
                            search-dn="ou=People,dc=infinispan,dc=org"
                            search-recursive="false"&gt;
            &lt;attribute-mapping&gt;
              &lt;attribute from="cn" to="Roles"
                         filter="(&amp;amp;(objectClass=groupOfNames)(member={1}))"
                         filter-dn="ou=Roles,dc=infinispan,dc=org"/&gt;
            &lt;/attribute-mapping&gt;
          &lt;/identity-mapping&gt;
        &lt;/ldap-realm&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="users.properties"
                           relative-to="infinispan.server.config.path"/&gt;
          &lt;group-properties path="groups.properties"
                            relative-to="infinispan.server.config.path"/&gt;
        &lt;/properties-realm&gt;
        &lt;distributed-realm/&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "distributed-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://my-ldap-server:10389",
          "credential": "strongPassword",
          "identity-mapping": {
            "rdn-identifier": "uid",
            "search-dn": "ou=People,dc=infinispan,dc=org",
            "search-recursive": false,
            "attribute-mapping": {
              "attribute": {
                "filter": "(&amp;(objectClass=groupOfNames)(member={1}))",
                "filter-dn": "ou=Roles,dc=infinispan,dc=org",
                "from": "cn",
                "to": "Roles"
              }
            }
          }
        },
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "distributed-realm",
            "path": "users.properties"
          },
          "group-properties": {
            "path": "groups.properties"
          }
        },
        "distributed-realm": {}
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "distributed-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://my-ldap-server:10389"
          credential: "strongPassword"
          identityMapping:
            rdnIdentifier: "uid"
            searchDn: "ou=People,dc=infinispan,dc=org"
            searchRecursive: "false"
            attributeMapping:
              attribute:
                filter: "(&amp;(objectClass=groupOfNames)(member={1}))"
                filterDn: "ou=Roles,dc=infinispan,dc=org"
                from: "cn"
                to: "Roles"
        propertiesRealm:
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "distributed-realm"
            path: "users.properties"
          groupProperties:
            path: "groups.properties"
        distributedRealm: ~</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aggregate-security-realms_security-realms"><a class="anchor" href="#aggregate-security-realms_security-realms"></a>3.8. Aggregate security realms</h3>
<div class="paragraph">
<p>Aggregate realms combine multiple realms: the first one for the authentication steps and the others for loading the identity for the authorization steps.
For example, this can be used to authenticate users via a client certificate, and retrieve identity from a properties or LDAP realm.</p>
</div>
<h4 id="aggregate_realm_configuration" class="discrete">Aggregate realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="default" default-realm="aggregate"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;keystore path="server.pfx" password="secret" alias="server"/&gt;
                  &lt;truststore path="trust.pfx" password="secret"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
            &lt;properties-realm name="properties" groups-attribute="Roles"&gt;
               &lt;user-properties path="users.properties" relative-to="infinispan.server.config.path"/&gt;
               &lt;group-properties path="groups.properties" relative-to="infinispan.server.config.path"/&gt;
            &lt;/properties-realm&gt;
            &lt;truststore-realm name="trust"/&gt;
            &lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
               &lt;name-rewriter&gt;
                  &lt;common-name-principal-transformer/&gt;
               &lt;/name-rewriter&gt;
            &lt;/aggregate-realm&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [
        {
          "name": "aggregate-realm",
          "default-realm": "aggregate",
          "server-identities": {
            "ssl": {
              "keystore": {
                "path": "server.p12",
                "relative-to": "infinispan.server.config.path",
                "keystore-password": "secret",
                "alias": "server"
              },
              "truststore": {
                "path": "trust.p12",
                "relative-to": "infinispan.server.config.path",
                "password": "secret"
              }
            }
          },
          "properties-realm": {
            "name": "properties",
            "groups-attribute": "Roles",
            "user-properties": {
              "digest-realm-name": "distributed-realm",
              "path": "users.properties"
            },
            "group-properties": {
              "path": "groups.properties"
            }
          },
          "truststore-realm": {
            "name": "trust"
          },
          "aggregate-realm": {
            "authentication-realm": "trust",
            "authorization-realms": ["properties"],
            "name-rewriter": {
              "common-name-principal-transformer": {}
            }
          }
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "aggregate-realm"
        defaultRealm: "aggregate"
        serverIdentities:
          ssl:
            keystore:
              path: "server.p12"
              relative-to: "infinispan.server.config.path"
              keystore-password: "secret"
              alias: "server"
            truststore:
              path: "trust.p12"
              relative-to: "infinispan.server.config.path"
              password: "secret"
        truststoreRealm:
          name: "trust"
        propertiesRealm:
          name: "properties"
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "distributed-realm"
            path: "users.properties"
          groupProperties:
            path: "groups.properties"
        aggregateRealm:
          authenticationRealm: "trust"
          authorizationRealms:
            - "properties"
          nameRewriter:
            common-name-principal-transformer: ~</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="name_rewriters"><a class="anchor" href="#name_rewriters"></a>3.8.1. Name rewriters</h4>
<div class="paragraph">
<p>Principal names may have different forms, depending on the security realm type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties and Token realms may return simple strings</p>
</li>
<li>
<p>Trust and LDAP realms may return X.500-style distinguished names</p>
</li>
<li>
<p>Kerberos realms may return <code>user@domain</code>-style names</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Names must be normalized to a common form when using the aggregate realm using one of the following transformers.</p>
</div>
<div class="sect4">
<h5 id="case_principal_transformer_3"><a class="anchor" href="#case_principal_transformer_3"></a>Case Principal Transformer</h5>
<div class="paragraph">
<p>The <code>case-principal-transformer</code> transforms a name to all uppercase or all lowercase letters.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
   &lt;name-rewriter&gt;
      &lt;case-principal-transformer uppercase="false"/&gt;
   &lt;/name-rewriter&gt;
&lt;/aggregate-realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "aggregate-realm": {
    "authentication-realm": "trust",
    "authorization-realms": [
      "properties"
    ],
    "name-rewriter": {
      "case-principal-transformer": {
        "uppercase": "false"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aggregateRealm:
  authenticationRealm: "trust"
  authorizationRealms:
    - "properties"
  nameRewriter:
    casePrincipalTransformer:
      uppercase: false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="common_name_principal_transformer_2"><a class="anchor" href="#common_name_principal_transformer_2"></a>Common Name Principal Transformer</h5>
<div class="paragraph">
<p>The <code>common-name-principal-transformer</code> extracts the first <code>CN</code> element from a <code>DN</code> used by LDAP or Certificates.
For example, given a principal in the form <code>CN=app1,CN=serviceA,OU=applications,DC=infinispan,DC=org</code>, the following
configuration will extract <code>app1</code> as the principal.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
   &lt;name-rewriter&gt;
      &lt;common-name-principal-transformer/&gt;
   &lt;/name-rewriter&gt;
&lt;/aggregate-realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "aggregate-realm": {
    "authentication-realm": "trust",
    "authorization-realms": [
      "properties"
    ],
    "name-rewriter": {
      "common-name-principal-transformer": {}
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aggregateRealm:
  authenticationRealm: "trust"
  authorizationRealms:
    - "properties"
  nameRewriter:
    commonNamePrincipalTransformer: ~</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="regex_principal_transformer_3"><a class="anchor" href="#regex_principal_transformer_3"></a>Regex Principal Transformer</h5>
<div class="paragraph">
<p>The <code>regex-principal-transformer</code> can perform find and replace using a regular expression.
The example shows how to extract the local-part from a <code>user@domain.com</code> identifier.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
   &lt;name-rewriter&gt;
      &lt;regex-principal-transformer pattern="([^@]+)@.*" replacement="$1" replace-all="false"/&gt;
   &lt;/name-rewriter&gt;
&lt;/aggregate-realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "aggregate-realm": {
    "authentication-realm": "trust",
    "authorization-realms": [
      "properties"
    ],
    "name-rewriter": {
      "regex-principal-transformer": {
        "pattern" : "([^@]+)@.*",
        "replacement": "$1",
        "replace-all": false
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aggregateRealm:
  authenticationRealm: "trust"
  authorizationRealms:
    - "properties"
  nameRewriter:
    regexPrincipalTransformer:
      pattern: "([^@]+)@.*"
      replacement: "$1"
      replaceAll: false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-security-realms_security-realms"><a class="anchor" href="#caching-security-realms_security-realms"></a>3.9. Security realm caching</h3>
<div class="paragraph">
<p>Security realms implement caching to avoid having to repeatedly retrieve data which usually changes very infrequently.
By default</p>
</div>
<h4 id="realm_caching_realm_configuration" class="discrete">Realm caching realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
    &lt;security&gt;
        &lt;security-realms&gt;
            &lt;security-realm name="default" cache-max-size="1024" cache-lifespan="20m"&gt;
            &lt;/security-realm&gt;
        &lt;/security-realms&gt;
    &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "cache-max-size": 1024,
        "cache-lifespan": 120000
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        cache-max-size: 1024
        cache-lifespan: 120000</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="flushing_realm_caches"><a class="anchor" href="#flushing_realm_caches"></a>3.9.1. Flushing realm caches</h4>
<div class="paragraph">
<p>Use the CLI to flush security realm caches across the whole cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[node-1@mycluster//containers/default]&gt; server aclcache flush</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication-mechanisms"><a class="anchor" href="#authentication-mechanisms"></a>4. Endpoint authentication mechanisms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server can use custom authentication mechanisms for Hot Rod and binary Memcached (SASL) and REST (HTTP) endpoints. The RESP endpoint does not offer alternative authentication mechanisms, because of its specification.</p>
</div>
<div class="sect2">
<h3 id="server-authentication_endpoint-authentication"><a class="anchor" href="#server-authentication_endpoint-authentication"></a>4.1. Infinispan Server authentication</h3>
<div class="paragraph">
<p>Authentication restricts user access to endpoints as well as the Infinispan Console and Command Line Interface (CLI).</p>
</div>
<div class="paragraph">
<p>Infinispan Server includes a "default" security realm that enforces user authentication.
Default authentication uses a property realm with user credentials stored in the <code>server/conf/users.properties</code> file.
Infinispan Server also enables security authorization by default so you must assign users with permissions stored in the <code>server/conf/groups.properties</code> file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code class="command">user create</code> command with the Command Line Interface (CLI) to add users and assign permissions.
Run <code class="command">user create --help</code> for examples and more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-authentication_endpoint-authentication"><a class="anchor" href="#configuring-server-authentication_endpoint-authentication"></a>4.2. Configuring Infinispan Server authentication mechanisms</h3>
<div class="paragraph">
<p>You can explicitly configure Hot Rod and REST endpoints to use specific authentication mechanisms.
Configuring authentication mechanisms is required only if you need to explicitly override the default mechanisms for a security realm.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each <code>endpoint</code> section in your configuration must include <code>hotrod-connector</code> and <code>rest-connector</code> elements or fields.
For example, if you explicitly declare a <code>hotrod-connector</code> you must also declare a <code>rest-connector</code> even if it does not configure an authentication mechanism.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add security realms to your Infinispan Server configuration as required.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add an <code>endpoint</code> element or field and specify the security realm that it uses with the <code>security-realm</code> attribute.</p>
</li>
<li>
<p>Add a <code>hotrod-connector</code> element or field to configure the Hot Rod endpoint.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add an <code>authentication</code> element or field.</p>
</li>
<li>
<p>Specify SASL authentication mechanisms for the Hot Rod endpoint to use with the <code>sasl mechanisms</code> attribute.</p>
</li>
<li>
<p>If applicable, specify SASL quality of protection settings with the <code>qop</code> attribute.</p>
</li>
<li>
<p>Specify the Infinispan Server identity with the <code>server-name</code> attribute if necessary.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Add a <code>rest-connector</code> element or field to configure the REST endpoint.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add an <code>authentication</code> element or field.</p>
</li>
<li>
<p>Specify HTTP authentication mechanisms for the REST endpoint to use with the <code>mechanisms</code> attribute.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="authentication_mechanism_configuration" class="discrete">Authentication mechanism configuration</h4>
<div class="paragraph">
<p>The following configuration specifies SASL mechanisms for the Hot Rod endpoint to use for authentication:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="my-realm"&gt;
      &lt;hotrod-connector&gt;
        &lt;authentication&gt;
           &lt;sasl mechanisms="SCRAM-SHA-512 SCRAM-SHA-384 SCRAM-SHA-256
                             DIGEST-SHA-512 DIGEST-SHA-384 DIGEST-SHA-256
                             PLAIN"
                 server-name="infinispan"
                 qop="auth"/&gt;
        &lt;/authentication&gt;
      &lt;/hotrod-connector&gt;
      &lt;rest-connector&gt;
        &lt;authentication mechanisms="DIGEST BASIC"/&gt;
      &lt;/rest-connector&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "endpoints": {
      "endpoint": {
        "socket-binding": "default",
        "security-realm": "my-realm",
        "hotrod-connector": {
          "authentication": {
            "security-realm": "default",
            "sasl": {
              "server-name": "infinispan",
              "mechanisms": ["SCRAM-SHA-512", "SCRAM-SHA-384", "SCRAM-SHA-256", "DIGEST-SHA-512", "DIGEST-SHA-384", "DIGEST-SHA-256", "PLAIN"],
              "qop": ["auth"]
            }
          }
        },
        "rest-connector": {
          "authentication": {
            "mechanisms": ["DIGEST", "BASIC"],
            "security-realm": "default"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">server:
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "my-realm"
      hotrodConnector:
        authentication:
          securityRealm: "default"
          sasl:
            serverName: "infinispan"
            mechanisms:
              - "SCRAM-SHA-512"
              - "SCRAM-SHA-384"
              - "SCRAM-SHA-256"
              - "DIGEST-SHA-512"
              - "DIGEST-SHA-384"
              - "DIGEST-SHA-256"
              - "PLAIN"
            qop:
              - "auth"
      restConnector:
        authentication:
          mechanisms:
            - "DIGEST"
            - "BASIC"
          securityRealm: "default"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="disabling-authentication_endpoint-authentication"><a class="anchor" href="#disabling-authentication_endpoint-authentication"></a>4.2.1. Disabling authentication</h4>
<div class="paragraph">
<p>In local development environments or on isolated networks you can configure Infinispan to allow unauthenticated client requests.
When you disable user authentication you should also disable authorization in your Infinispan security configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Remove the <code>security-realm</code> attribute from the <code>endpoints</code> element or field.</p>
</li>
<li>
<p>Remove any <code>authorization</code> elements from the <code>security</code> configuration for the <code>cache-container</code> and each cache configuration.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;endpoints socket-binding="default"/&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "endpoints": {
      "endpoint": {
        "socket-binding": "default"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">server:
  endpoints:
    endpoint:
      socketBinding: "default"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-endpoint-authentication-mechanisms_endpoint-authentication"><a class="anchor" href="#server-endpoint-authentication-mechanisms_endpoint-authentication"></a>4.3. Infinispan Server authentication mechanisms</h3>
<div class="paragraph">
<p>Infinispan Server automatically configures endpoints with authentication mechanisms that match your security realm configuration.
For example, if you add a Kerberos security realm then Infinispan Server enables the <code>GSSAPI</code> and <code>GS2-KRB5</code> authentication mechanisms for the Hot Rod endpoint.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, you cannot use the Lightweight Directory Access Protocol (LDAP) protocol with the <code>DIGEST</code> or <code>SCRAM</code> authentication mechanisms, because these mechanisms require access to specific hashed passwords.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Hot Rod endpoints</div>
<p>Infinispan Server enables the following SASL authentication mechanisms for Hot Rod endpoints when your configuration includes the corresponding security realm:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">SASL authentication mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM</code>, <code>DIGEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code>, <code>GS2-KRB5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">REST endpoints</div>
<p>Infinispan Server enables the following HTTP authentication mechanisms for REST endpoints when your configuration includes the corresponding security realm:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">HTTP authentication mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEARER_TOKEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_CERT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPNEGO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BASIC</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Memcached endpoints</div>
<p>Infinispan Server enables the following SASL authentication mechanisms for Memcached binary protocol endpoints when your configuration includes the corresponding security realm:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">SASL authentication mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM</code>, <code>DIGEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI, GS2-KRB5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Infinispan Server enables authentication on Memcached text protocol endpoints only with security realms which support password-based authentication:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">Memcached text authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">RESP endpoints</div>
<p>Infinispan Server enables authentication on RESP endpoints only with security realms which support password-based authentication:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">RESP authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="sasl-authentication-mechanisms_endpoint-authentication"><a class="anchor" href="#sasl-authentication-mechanisms_endpoint-authentication"></a>4.3.1. SASL authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan Server supports the following SASL authentications mechanisms with Hot Rod and Memcached binary protocol endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Security realm type</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>PLAIN</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BASIC</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. Hot Rod connectors support <code>DIGEST-SHA-256</code>, <code>DIGEST-SHA-384</code>, and <code>DIGEST-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>salt</em> values in addition to hashing algorithms and nonce values. Hot Rod connectors support <code>SCRAM-SHA-256</code>, <code>SCRAM-SHA-384</code>, and <code>SCRAM-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GS2-KRB5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>CLIENT_CERT</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BEARER_TOKEN</code> HTTP mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sasl-quality-of-protection_endpoint-authentication"><a class="anchor" href="#sasl-quality-of-protection_endpoint-authentication"></a>4.3.2. SASL quality of protection (QoP)</h4>
<div class="paragraph">
<p>If SASL mechanisms support integrity and privacy protection (QoP) settings, you can add them to your Hot Rod and Memcached endpoint configuration with the <code>qop</code> attribute.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">QoP setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity protection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity and privacy protection.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sasl-policies-hot-rod-authentication_endpoint-authentication"><a class="anchor" href="#sasl-policies-hot-rod-authentication_endpoint-authentication"></a>4.3.3. SASL policies</h4>
<div class="paragraph">
<p>SASL policies provide fine-grain control over Hot Rod and Memcached authentication mechanisms.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan cache authorization restricts access to caches based on roles and
permissions.
Configure cache authorization and then set <code>&lt;no-anonymous value=false /&gt;</code> to allow anonymous login and delegate access logic to cache authorization.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forward-secrecy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use only SASL mechanisms that support forward secrecy between sessions. This means that breaking into one session does not automatically provide information for breaking into future sessions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pass-credentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use only SASL mechanisms that require client credentials.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-plain-text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to simple plain passive attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to active, non-dictionary, attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-dictionary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to passive dictionary attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-anonymous</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that accept anonymous logins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<h5 id="sasl_policy_configuration" class="discrete">SASL policy configuration</h5>
<div class="paragraph">
<p>In the following configuration the Hot Rod endpoint uses the <code>GSSAPI</code> mechanism for authentication because it is the only mechanism that complies with all SASL policies:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="default"&gt;
      &lt;hotrod-connector&gt;
        &lt;authentication&gt;
          &lt;sasl mechanisms="PLAIN DIGEST-SHA-256 GSSAPI EXTERNAL"
                server-name="infinispan"
                qop="auth"
                policy="no-active no-plain-text"/&gt;
        &lt;/authentication&gt;
      &lt;/hotrod-connector&gt;
      &lt;rest-connector/&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "endpoints" : {
      "endpoint" : {
        "socket-binding" : "default",
        "security-realm" : "default",
        "hotrod-connector" : {
          "authentication" : {
            "sasl" : {
              "server-name" : "infinispan",
              "mechanisms" : [ "PLAIN","DIGEST-SHA-256","GSSAPI","EXTERNAL" ],
              "qop" : [ "auth" ],
              "policy" : [ "no-active","no-plain-text" ]
            }
          }
        },
        "rest-connector" : ""
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "default"
      hotrodConnector:
        authentication:
          sasl:
            serverName: "infinispan"
            mechanisms:
              - "PLAIN"
              - "DIGEST-SHA-256"
              - "GSSAPI"
              - "EXTERNAL"
            qop:
              - "auth"
            policy:
              - "no-active"
              - "no-plain-text"
      restConnector: ~</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest-authentication-mechanisms_endpoint-authentication"><a class="anchor" href="#rest-authentication-mechanisms_endpoint-authentication"></a>4.3.4. HTTP authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan Server supports the following HTTP authentication mechanisms with REST endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Security realm type</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BASIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>BASIC</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Basic</code> HTTP authentication scheme and is similar to the <code>PLAIN</code> SASL mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. REST connectors support <code>SHA-512</code>, <code>SHA-256</code> and <code>MD5</code> hashing algorithms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Digest</code> HTTP authentication scheme and is similar to <code>DIGEST-*</code> SASL mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPNEGO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Negotiate</code> HTTP authentication scheme and is similar to the <code>GSSAPI</code> and <code>GS2-KRB5</code> SASL mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEARER_TOKEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Bearer</code> HTTP authentication scheme and is similar to <code>OAUTHBEARER</code> SASL mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_CERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>EXTERNAL</code> SASL mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-encryption"><a class="anchor" href="#configuring-encryption"></a>5. Configuring TLS/SSL encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can secure Infinispan Server connections using SSL/TLS encryption by configuring a keystore that contains public and private keys for Infinispan.
You can also configure client certificate authentication if you require mutual TLS.</p>
</div>
<div class="sect2">
<h3 id="configuring-server-keystores_endpoint-security"><a class="anchor" href="#configuring-server-keystores_endpoint-security"></a>5.1. Configuring Infinispan Server keystores</h3>
<div class="paragraph">
<p>Add keystores to Infinispan Server and configure it to present SSL/TLS certificates that verify its identity to clients.
If a security realm contains TLS/SSL identities, it encrypts any connections to Infinispan Server endpoints that use that security realm.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a keystore that contains certificates, or certificate chains, for Infinispan Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan Server supports the following keystore formats: JKS, JCEKS, PKCS12/PFX and PEM.
BKS, BCFKS, and UBER are also supported if the <a href="https://www.bouncycastle.org/">Bouncy Castle</a> library is present.</p>
</div>
<div class="paragraph">
<p>Certificates should include the <code>subjectAltName</code> extension of type <code>dNSName</code> and/or <code>iPAddress</code> so that clients can correctly perform
hostname validation, according to the rules defined by the <a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC 2818</a> specification.
The server will issue a warning if it is started with a certificate which does not include such an extension.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In production environments, server certificates should be signed by a trusted Certificate Authority, either Root or Intermediate CA.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use PEM files as keystores if they contain both of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A private key in PKCS#1 or PKCS#8 format.</p>
</li>
<li>
<p>One or more certificates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should also configure PEM file keystores with an empty password (<code>password=""</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add the keystore that contains SSL/TLS identities for Infinispan Server to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the keystore file name with the <code>path</code> attribute.</p>
</li>
<li>
<p>Provide the keystore password and certificate alias with the <code>keystore-password</code> and <code>alias</code> attributes.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Configure clients with a trust store so they can verify SSL/TLS identities for Infinispan Server.</p>
</div>
<h4 id="keystore_configuration" class="discrete">Keystore configuration</h4>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Adds a keystore that contains server certificates that provide SSL/TLS identities to clients. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="my-server"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "alias": "my-server",
              "path": "server.p12",
              "password": "secret"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              alias: "my-server"
              path: "server.p12"
              password: "secret"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="ssltls_certificate_rotation"><a class="anchor" href="#ssltls_certificate_rotation"></a>5.1.1. SSL/TLS Certificate rotation</h4>
<div class="paragraph">
<p>SSL/TLS certificates have an expiration date, after which they are no longer valid.
The process of renewing a certificate is also known as "rotation".
Infinispan monitors the keystore files for changes and automatically reloads them without requiring a server or client
restart.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To ensure seamless operations during certificate rotation, use certificates signed by a Certificate Authority (CA) and
configure both server and client trust stores with the CA certificate. Using self-signed certificates will cause
temporary handshake failures until all clients and servers have been updated.
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html#configuring-hotrod-encryption_hotrod-client-configuration">Configuring Hot Rod client encryption</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="generating-server-keystores_endpoint-security"><a class="anchor" href="#generating-server-keystores_endpoint-security"></a>5.1.2. Generating Infinispan Server keystores</h4>
<div class="paragraph">
<p>Configure Infinispan Server to automatically generate keystores at startup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatically generated keystores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Should not be used in production environments.</p>
</li>
<li>
<p>Are generated whenever necessary; for example, while obtaining the first connection from a client.</p>
</li>
<li>
<p>Contain certificates that you can use directly in Hot Rod clients.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Include the <code>generate-self-signed-certificate-host</code> attribute for the <code>keystore</code> element in the server configuration.</p>
</li>
<li>
<p>Specify a hostname for the server certificate as the value.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="generated_keystore_configuration" class="discrete">Generated keystore configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="generated-keystore"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Generates a keystore that includes a self-signed certificate with the specified hostname. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="server"
                      generate-self-signed-certificate-host="localhost"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "generated-keystore",
        "server-identities": {
          "ssl": {
            "keystore": {
              "alias": "server",
              "generate-self-signed-certificate-host": "localhost",
              "path": "server.p12",
              "password": "secret"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "generated-keystore"
        serverIdentities:
          ssl:
            keystore:
              alias: "server"
              generateSelfSignedCertificateHost: "localhost"
              path: "server.p12"
              password: "secret"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ssl-engine_endpoint-security"><a class="anchor" href="#configuring-ssl-engine_endpoint-security"></a>5.1.3. Configuring TLS versions and cipher suites</h4>
<div class="paragraph">
<p>When using SSL/TLS encryption to secure your deployment, you can configure Infinispan Server to use specific versions of the TLS protocol as well as specific cipher suites within the protocol.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add the <code>engine</code> element to the SSL configuration for Infinispan Server.</p>
</li>
<li>
<p>Configure Infinispan to use one or more TLS versions with the <code>enabled-protocols</code> attribute.</p>
<div class="paragraph">
<p>Infinispan Server supports TLS version 1.2 and 1.3 by default.
If appropriate you can set <code>TLSv1.3</code> only to restrict the security protocol for client connections.
Infinispan does not recommend enabling <code>TLSv1.1</code> because it is an older protocol with limited support and provides weak security.
You should never enable any version of TLS older than 1.1.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you modify the SSL <code>engine</code> configuration for Infinispan Server you must explicitly configure TLS versions with the <code>enabled-protocols</code> attribute.
Omitting the <code>enabled-protocols</code> attribute allows any TLS version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;engine enabled-protocols="TLSv1.3 TLSv1.2" /&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure Infinispan to use one or more cipher suites with the <code>enabled-ciphersuites</code> attribute (for TLSv1.2 and below) and the <code>enabled-ciphersuites-tls13</code> attribute (for TLSv1.3).</p>
<div class="paragraph">
<p>You must ensure that you set a cipher suite that supports any protocol features you plan to use; for example <code>HTTP/2 ALPN</code>.</p>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="ssl_engine_configuration" class="discrete">SSL engine configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="server"/&gt;
            &lt;!-- Configures Infinispan Server to use specific TLS versions and cipher suites. --&gt;
            &lt;engine enabled-protocols="TLSv1.3 TLSv1.2"
                    enabled-ciphersuites="TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256"
                    enabled-ciphersuites-tls13="TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "alias": "server",
              "path": "server.p12",
              "password": "secret"
            },
            "engine": {
              "enabled-protocols": ["TLSv1.3"],
              "enabled-ciphersuites": "TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256",
              "enabled-ciphersuites-tls13": "TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              alias: "server"
              path: "server.p12"
              password: "secret"
            engine:
              enabledProtocols:
                - "TLSv1.3"
              enabledCiphersuites: "TLS_AES_256_GCM_SHA384,TLS_AES_128_GCM_SHA256"
              enabledCiphersuitesTls13: "TLS_AES_256_GCM_SHA384"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-fips_endpoint-security"><a class="anchor" href="#configuring-server-fips_endpoint-security"></a>5.2. Configuring Infinispan Server on a system with FIPS 140-2 compliant cryptography</h3>
<div class="paragraph">
<p>FIPS (Federal Information Processing Standards) are standards and guidelines for US federal computer systems.
Although FIPS are developed for use by the US federal government, many in the private sector voluntarily use these standards.</p>
</div>
<div class="paragraph">
<p>FIPS 140-2 defines security requirements for cryptographic modules.
You can configure your Infinispan Server to use encryption ciphers that adhere to the FIPS 140-2 specification by using alternative JDK security providers.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/security/pkcs11-reference-guide1.html">Java PKCS#11 cryptographic provider</a></p>
</li>
<li>
<p><a href="https://www.bouncycastle.org/fips_faq.html">The Legion of the Bouncy Castle cryptographic provider</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring_the_pkcs11_cryptographic_provider"><a class="anchor" href="#configuring_the_pkcs11_cryptographic_provider"></a>5.2.1. Configuring the PKCS11 cryptographic provider</h4>
<div class="paragraph">
<p>You can configure the PKCS11 cryptographic provider by specifying the PKCS11 keystore with the <code>SunPKCS11-NSS-FIPS</code> provider.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure your system for FIPS mode. You can check if your system has FIPS Mode enabled by issuing the <code>fips-mode-setup --check</code> command in your Infinispan command-line Interface (CLI)</p>
</li>
<li>
<p>Initialize the system-wide NSS database by using the <code>certutil</code> tool.</p>
</li>
<li>
<p>Install the JDK with the <code>java.security</code> file configured to enable the <code>SunPKCS11</code> provider. This provider points to the NSS database and the SSL provider.</p>
</li>
<li>
<p>Install a certificate in the NSS database.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the PKCS11 keystore with the <code>SunPKCS11-NSS-FIPS</code> provider.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="keystore_configuration_2" class="discrete">Keystore configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="default"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;!-- Adds a keystore that reads certificates from the NSS database. --&gt;
                  &lt;keystore provider="SunPKCS11-NSS-FIPS" type="PKCS11"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "provider": "SunPKCS11-NSS-FIPS",
              "type": "PKCS11"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              provider: "SunPKCS11-NSS-FIPS"
              type: "PKCS11"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring_the_bouncy_castle_fips_cryptographic_provider"><a class="anchor" href="#configuring_the_bouncy_castle_fips_cryptographic_provider"></a>5.2.2. Configuring the Bouncy Castle FIPS cryptographic provider</h4>
<div class="paragraph">
<p>You can configure the Bouncy Castle FIPS (Federal Information Processing Standards) cryptographic provider in your Infinispan server&#8217;s configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure your system for FIPS mode. You can check if your system has FIPS Mode enabled by issuing the <code>fips-mode-setup --check</code> command in your Infinispan command-line Interface (CLI).</p>
</li>
<li>
<p>Create a keystore in BCFKS format that contains a certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the Bouncy Castle FIPS JAR file, and add the file to the <code>server/lib</code> directory of your Infinispan Server installation.</p>
</li>
<li>
<p>To install Bouncy Castle, issue the <code>install</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[disconnected]&gt; install org.bouncycastle:bc-fips:1.0.2.3</code></pre>
</div>
</div>
</li>
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the BCFKS keystore with the <code>BCFIPS</code> provider.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="keystore_configuration_3" class="discrete">Keystore configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="default"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;!-- Adds a keystore that reads certificates from the BCFKS keystore. --&gt;
                  &lt;keystore path="server.bcfks" password="secret" alias="server" provider="BCFIPS" type="BCFKS"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "path": "server.bcfks",
              "password": "secret",
              "alias": "server",
              "provider": "BCFIPS",
              "type": "BCFKS"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              path: "server.bcfks"
              password: "secret"
              alias: "server"
              provider: "BCFIPS"
              type: "BCFKS"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authentication_endpoint-security"><a class="anchor" href="#configuring-client-certificate-authentication_endpoint-security"></a>5.3. Configuring client certificate authentication</h3>
<div class="paragraph">
<p>Configure Infinispan Server to use mutual TLS to secure client connections.</p>
</div>
<div class="paragraph">
<p>You can configure Infinispan to verify client identities from certificates in a trust store in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Require a trust store that contains only the signing certificate, which is typically a Certificate Authority (CA). Any client that presents a certificate signed by the CA can connect to Infinispan.</p>
</li>
<li>
<p>Require a trust store that contains all client certificates in addition to the signing certificate. Only clients that present a signed certificate that is present in the trust store can connect to Infinispan.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively to providing trust stores you can use shared system certificates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a client trust store that contains either the CA certificate or all public certificates.</p>
</li>
<li>
<p>Create a keystore for Infinispan Server and configure an SSL/TLS identity.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PEM files can be used as trust stores provided they contain one or more certificates.
These trust stores should be configured with an empty password: <code>password=""</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add the <code>require-ssl-client-auth="true"</code> parameter to your <code>endpoints</code> configuration.</p>
</li>
<li>
<p>Add the client trust store to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Specify the <code>path</code> and <code>password</code> attributes for the <code>truststore</code> element in the Infinispan Server security realm configuration.</p>
</li>
<li>
<p>Add the <code>&lt;truststore-realm/&gt;</code> element to the security realm if you want Infinispan Server to authenticate each client certificate.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Set up authorization with client certificates in the Infinispan Server configuration if you control access with security roles and permissions.</p>
</li>
<li>
<p>Configure clients to negotiate SSL/TLS connections with Infinispan Server.</p>
</li>
</ul>
</div>
<h4 id="client_certificate_authentication_configuration" class="discrete">Client certificate authentication configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="trust-store-realm"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Provides an SSL/TLS identity with a keystore that
                 contains server certificates. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      keystore-password="secret"
                      alias="server"/&gt;
            &lt;!-- Configures a trust store that contains client certificates
                 or part of a certificate chain. --&gt;
            &lt;truststore path="trust.p12"
                        relative-to="infinispan.server.config.path"
                        password="secret"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
        &lt;!-- Authenticates client certificates against the trust store. If you configure this, the trust store must contain the public certificates for all clients. --&gt;
        &lt;truststore-realm/&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="trust-store-realm"
              require-ssl-client-auth="true"&gt;
      &lt;hotrod-connector&gt;
        &lt;authentication&gt;
          &lt;sasl mechanisms="EXTERNAL"
                server-name="infinispan"
                qop="auth"/&gt;
        &lt;/authentication&gt;
      &lt;/hotrod-connector&gt;
      &lt;rest-connector&gt;
        &lt;authentication mechanisms="CLIENT_CERT"/&gt;
      &lt;/rest-connector&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "trust-store-realm",
        "server-identities": {
          "ssl": {
            "keystore": {
              "path": "server.p12",
              "relative-to": "infinispan.server.config.path",
              "keystore-password": "secret",
              "alias": "server"
            },
            "truststore": {
              "path": "trust.p12",
              "relative-to": "infinispan.server.config.path",
              "password": "secret"
            }
          }
        },
        "truststore-realm": {}
      }]
    },
    "endpoints": [{
      "socket-binding": "default",
      "security-realm": "trust-store-realm",
      "require-ssl-client-auth": "true",
      "connectors": {
        "hotrod": {
          "hotrod-connector": {
            "authentication": {
              "sasl": {
                "mechanisms": "EXTERNAL",
                "server-name": "infinispan",
                "qop": "auth"
              }
            }
          },
          "rest": {
            "rest-connector": {
              "authentication": {
                "mechanisms": "CLIENT_CERT"
              }
            }
          }
        }
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "trust-store-realm"
        serverIdentities:
          ssl:
            keystore:
              path: "server.p12"
              relative-to: "infinispan.server.config.path"
              keystore-password: "secret"
              alias: "server"
            truststore:
              path: "trust.p12"
              relative-to: "infinispan.server.config.path"
              password: "secret"
        truststoreRealm: ~
  endpoints:
    socketBinding: "default"
    securityRealm: "trust-store-realm"
    requireSslClientAuth: "true"
    connectors:
      - hotrod:
          hotrodConnector:
            authentication:
              sasl:
                mechanisms: "EXTERNAL"
                serverName: "infinispan"
                qop: "auth"
      - rest:
          restConnector:
            authentication:
              mechanisms: "CLIENT_CERT"</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html#configuring-hotrod-encryption_hotrod-client-configuration">Configuring Hot Rod client encryption</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-shared-system-certificates">Using Shared System Certificates</a> (Red Hat Enterprise Linux 7 Security Guide)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authorization_endpoint-security"><a class="anchor" href="#configuring-client-certificate-authorization_endpoint-security"></a>5.4. Configuring authorization with client certificates</h3>
<div class="paragraph">
<p>Enabling client certificate authentication means you do not need to specify Infinispan user credentials in client configuration, which means you must associate roles with the Common Name (CN) field in the client certificate(s).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide clients with a Java keystore that contains either their public certificates or part of the certificate chain, typically a public CA certificate.</p>
</li>
<li>
<p>Configure Infinispan Server to perform client certificate authentication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Enable the <code>common-name-role-mapper</code> in the security authorization configuration.</p>
</li>
<li>
<p>Assign the Common Name (<code>CN</code>) from the client certificate a role with the appropriate permissions.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Infinispan creates the identity of the client by extracting the certificate principal. Any other Subject
Alternative Names (SANs) which may be present in the certificate are currently ignored. For this reason, the
<code>authorization.group-only-mapping</code> attribute below must be set to <code>false</code>.
</td>
</tr>
</table>
</div>
<h4 id="client_certificate_authorization_configuration" class="discrete">Client certificate authorization configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container name="certificate-authentication" statistics="true"&gt;
    &lt;security&gt;
      &lt;authorization group-only-mapping="false"&gt;
        &lt;!-- Declare a role mapper that associates the common name (CN) field in client certificate trust stores with authorization roles. --&gt;
        &lt;common-name-role-mapper/&gt;
        &lt;!-- In this example, if a client certificate contains `CN=Client1` then clients with matching certificates get ALL permissions. --&gt;
        &lt;role name="Client1" permissions="ALL"/&gt;
      &lt;/authorization&gt;
    &lt;/security&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "infinispan": {
    "cache-container": {
      "name": "certificate-authentication",
      "security": {
        "authorization": {
          "group-only-mapping": false,
          "common-name-role-mapper": null,
          "roles": {
            "Client1": {
              "role": {
                "permissions": "ALL"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">infinispan:
  cacheContainer:
    name: "certificate-authentication"
    security:
      authorization:
        groupOnlyMapping: false
        commonNameRoleMapper: ~
        roles:
          Client1:
            role:
              permissions:
                - "ALL"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="credential-keystores"><a class="anchor" href="#credential-keystores"></a>6. Storing Infinispan Server credentials in keystores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External services require credentials to authenticate with Infinispan Server.
To protect sensitive text strings such as passwords, add them to a credential keystore rather than directly in Infinispan Server configuration files.</p>
</div>
<div class="paragraph">
<p>You can then configure Infinispan Server to decrypt passwords for establishing connections with services such as databases or LDAP directories.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Plain-text passwords in <code>$ISPN_HOME/server/conf</code> are unencrypted.
Any user account with read access to the host filesystem can view plain-text passwords.</p>
</div>
<div class="paragraph">
<p>While credential keystores are password-protected store encrypted passwords, any user account with write access to the host filesystem can tamper with the keystore itself.</p>
</div>
<div class="paragraph">
<p>To completely secure Infinispan Server credentials, you should grant read-write access only to user accounts that can configure and run Infinispan Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="setting-up-credential-keystores_credential-keystores"><a class="anchor" href="#setting-up-credential-keystores_credential-keystores"></a>6.1. Setting up credential keystores</h3>
<div class="paragraph">
<p>Create keystores that encrypt credential for Infinispan Server access.</p>
</div>
<div class="paragraph">
<p>A credential keystore contains at least one alias that is associated with an encrypted password.
After you create a keystore, you specify the alias in a connection configuration such as a database connection pool.
Infinispan Server then decrypts the password for that alias from the keystore when the service attempts authentication.</p>
</div>
<div class="paragraph">
<p>You can create as many credential keystores with as many aliases as required.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a security best practice, keystores should be readable only by the user who runs the process for Infinispan Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Create a keystore and add credentials to it with the <code class="command">credentials</code> command.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, keystores are of type PKCS12.
Run <code class="command">help credentials</code> for details on changing keystore defaults.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to create a keystore that contains an alias of "dbpassword" for the password "changeme".
When you create a keystore you also specify a password to access the keystore with the <code>-p</code> argument.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">bin/cli.sh credentials add dbpassword -c changeme -p "secret1234!"</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">bin\cli.bat credentials add dbpassword -c changeme -p "secret1234!"</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Check that the alias is added to the keystore.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">bin/cli.sh credentials ls -p "secret1234!"
dbpassword</code></pre>
</div>
</div>
</li>
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Configure Infinispan to use the credential keystore.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add a <code>credential-stores</code> section to the <code>security</code> configuration.</p>
</li>
<li>
<p>Specify the name and location of the credential keystore.</p>
</li>
<li>
<p>Specify the password to access the credential keystore with the <code>clear-text-credential</code> configuration.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of adding a clear-text password for the credential keystore to your Infinispan Server configuration you can use an external command or masked password for additional security.</p>
</div>
<div class="paragraph">
<p>You can also use a password in one credential store as the master password for another credential store.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Reference the credential keystore in configuration that Infinispan Server uses to connect with an external system such as a datasource or LDAP server.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add a <code>credential-reference</code> section.</p>
</li>
<li>
<p>Specify the name of the credential keystore with the <code>store</code> attribute.</p>
</li>
<li>
<p>Specify the password alias with the <code>alias</code> attribute.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Attributes in the <code>credential-reference</code> configuration are optional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>store</code> is required only if you have multiple keystores.</p>
</li>
<li>
<p><code>alias</code> is required only if the keystore contains multiple password aliases.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="securing-passwords-credential-keystores_credential-keystores"><a class="anchor" href="#securing-passwords-credential-keystores_credential-keystores"></a>6.2. Securing passwords for credential keystores</h3>
<div class="paragraph">
<p>Infinispan Server requires a password to access credential keystores.
You can add that password to Infinispan Server configuration in clear text or, as an added layer of security, you can use an external command for the password or you can mask the password.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Set up a credential keystore for Infinispan Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code class="command">credentials mask</code> command to obscure the password, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">bin/cli.sh credentials mask -i 100 -s pepper99 "secret1234!"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Masked passwords use Password Based Encryption (PBE) and must be in the following format in your Infinispan Server configuration: &lt;MASKED_VALUE;SALT;ITERATION&gt;.</p>
</div>
</li>
<li>
<p>Use an external command that provides the password as standard output.</p>
<div class="paragraph">
<p>An external command can be any executable, such as a shell script or binary, that uses <code>java.lang.Runtime#exec(java.lang.String)</code>.<br>
If the command requires parameters, provide them as a space-separated list of strings.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="credential-keystore-configuration_credential-keystores"><a class="anchor" href="#credential-keystore-configuration_credential-keystores"></a>6.3. Credential keystore configuration</h3>
<div class="paragraph">
<p>You can add credential keystores to Infinispan Server configuration and use clear-text passwords, masked passwords, or external commands that supply passwords.</p>
</div>
<h4 id="credential_keystore_with_a_clear_text_password" class="discrete">Credential keystore with a clear text password</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials" path="credentials.pfx"&gt;
        &lt;clear-text-credential clear-text="secret1234!"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "clear-text-credential": {
          "clear-text": "secret1234!"
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        clearTextCredential:
          clearText: "secret1234!"</code></pre>
</div>
</div>
<h4 id="credential_keystore_with_a_masked_password" class="discrete">Credential keystore with a masked password</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;masked-credential masked="1oTMDZ5JQj6DVepJviXMnX;pepper99;100"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "masked-credential": {
          "masked": "1oTMDZ5JQj6DVepJviXMnX;pepper99;100"
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        maskedCredential:
          masked: "1oTMDZ5JQj6DVepJviXMnX;pepper99;100"</code></pre>
</div>
</div>
<h4 id="external_command_passwords" class="discrete">External command passwords</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;command-credential command="/path/to/executable.sh arg1 arg2"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "command-credential": {
          "command": "/path/to/executable.sh arg1 arg2"
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        commandCredential:
          command: "/path/to/executable.sh arg1 arg2"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="credential-keystore-references_credential-keystores"><a class="anchor" href="#credential-keystore-references_credential-keystores"></a>6.4. Credential keystore references</h3>
<div class="paragraph">
<p>After you add credential keystores to Infinispan Server you can reference them in connection configurations.</p>
</div>
<h4 id="datasource_connections" class="discrete">Datasource connections</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;clear-text-credential clear-text="secret1234!"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
  &lt;data-sources&gt;
    &lt;data-source name="postgres"
                 jndi-name="jdbc/postgres"&gt;
      &lt;!-- Specifies the database username in the connection factory. --&gt;
      &lt;connection-factory driver="org.postgresql.Driver"
                          username="dbuser"
                          url="${org.infinispan.server.test.postgres.jdbcUrl}"&gt;
        &lt;!-- Specifies the credential keystore that contains an encrypted password and the alias for it. --&gt;
        &lt;credential-reference store="credentials"
                              alias="dbpassword"/&gt;
      &lt;/connection-factory&gt;
      &lt;connection-pool max-size="10"
                       min-size="1"
                       background-validation="1000"
                       idle-removal="1"
                       initial-size="1"
                       leak-detection="10000"/&gt;
    &lt;/data-source&gt;
  &lt;/data-sources&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "clear-text-credential": {
          "clear-text": "secret1234!"
        }
      }],
      "data-sources": [{
        "name": "postgres",
        "jndi-name": "jdbc/postgres",
        "connection-factory": {
          "driver": "org.postgresql.Driver",
          "username": "dbuser",
          "url": "${org.infinispan.server.test.postgres.jdbcUrl}",
          "credential-reference": {
            "store": "credentials",
            "alias": "dbpassword"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        clearTextCredential:
          clearText: "secret1234!"
  dataSources:
    - name: postgres
      jndiName: jdbc/postgres
      connectionFactory:
        driver: org.postgresql.Driver
        username: dbuser
        url: '${org.infinispan.server.test.postgres.jdbcUrl}'
        credentialReference:
          store: credentials
          alias: dbpassword</code></pre>
</div>
</div>
<h4 id="ldap_connections" class="discrete">LDAP connections</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;clear-text-credential clear-text="secret1234!"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;!-- Specifies the LDAP principal in the connection factory. --&gt;
        &lt;ldap-realm name="ldap"
                    url="ldap://my-ldap-server:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"&gt;
          &lt;!-- Specifies the credential keystore that contains an encrypted password and the alias for it. --&gt;
          &lt;credential-reference store="credentials"
                                alias="ldappassword"/&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "clear-text-credential": {
          "clear-text": "secret1234!"
        }
      }],
      "security-realms": [{
        "name": "default",
        "ldap-realm": {
          "name": "ldap",
          "url": "ldap://my-ldap-server:10389",
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "credential-reference": {
            "store": "credentials",
            "alias": "ldappassword"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        clearTextCredential:
          clearText: "secret1234!"
    securityRealms:
      - name: "default"
        ldapRealm:
          name: ldap
          url: 'ldap://my-ldap-server:10389'
          principal: 'uid=admin,ou=People,dc=infinispan,dc=org'
          credentialReference:
            store: credentials
            alias: ldappassword</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="secure-cluster-transport"><a class="anchor" href="#secure-cluster-transport"></a>7. Encrypting cluster transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Secure cluster transport so that nodes communicate with encrypted messages.
You can also configure Infinispan clusters to perform certificate authentication so that only nodes with valid identities can join.</p>
</div>
<div class="sect2">
<h3 id="securing-cluster-transport-tls-identities_secure-cluster-transport"><a class="anchor" href="#securing-cluster-transport-tls-identities_secure-cluster-transport"></a>7.1. Securing cluster transport with TLS identities</h3>
<div class="paragraph">
<p>Add SSL/TLS identities to a Infinispan Server security realm and use them to secure cluster transport.
Nodes in the Infinispan Server cluster then exchange SSL/TLS certificates to encrypt JGroups messages, including RELAY messages if you configure cross-site replication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install a Infinispan Server cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a TLS keystore that contains a single certificate to identify Infinispan Server.</p>
<div class="paragraph">
<p>You can also use a PEM file if it contains a private key in PKCS#1 or PKCS#8 format, a certificate, and has an empty password: <code>password=""</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the certificate in the keystore is not signed by a public certificate authority (CA) then you must also create a trust store that contains either the signing certificate or the public key.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the keystore to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add the keystore to a new security realm in your Infinispan Server configuration.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should create dedicated keystores and security realms so that Infinispan Server endpoints do not use the same security realm as cluster transport.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;server xmlns="urn:infinispan:server:16.2"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="cluster-transport"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Adds a keystore that contains a certificate that provides SSL/TLS identity to encrypt cluster transport. --&gt;
            &lt;keystore path="server.pfx"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="server"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure cluster transport to use the security realm by specifying the name of the security realm with the <code>server:security-realm</code> attribute.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container&gt;
    &lt;transport server:security-realm="cluster-transport"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start Infinispan Server, the following log message indicates that the cluster is using the security realm for cluster transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[org.infinispan.SERVER] ISPN080060: SSL Transport using realm &lt;security_realm_name&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-encryption-protocols_secure-cluster-transport"><a class="anchor" href="#jgroups-encryption-protocols_secure-cluster-transport"></a>7.2. JGroups encryption protocols</h3>
<div class="paragraph">
<p>To secure cluster traffic, you can configure Infinispan nodes to encrypt JGroups message payloads with secret keys.</p>
</div>
<div class="paragraph">
<p>Infinispan nodes can obtain secret keys from either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The coordinator node (asymmetric encryption).</p>
</li>
<li>
<p>A shared keystore (symmetric encryption).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from coordinator nodes</div>
<p>You configure asymmetric encryption by adding the <code>ASYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to generate and distribute secret keys.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.
This protects your cluster from man-in-the-middle (MitM) attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Asymmetric encryption secures cluster traffic as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first node in the Infinispan cluster, the coordinator node, generates a secret key.</p>
</li>
<li>
<p>A joining node performs certificate authentication with the coordinator to mutually verify identity.</p>
</li>
<li>
<p>The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.</p>
</li>
<li>
<p>The coordinator node encrypts the secret key with the public key and returns it to the joining node.</p>
</li>
<li>
<p>The joining node decrypts and installs the secret key.</p>
</li>
<li>
<p>The node joins the cluster, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from shared keystores</div>
<p>You configure symmetric encryption by adding the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to obtain secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Nodes install the secret key from a keystore on the Infinispan classpath at startup.</p>
</li>
<li>
<p>Node join clusters, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Comparison of asymmetric and symmetric encryption</div>
<p><code>ASYM_ENCRYPT</code> with certificate authentication provides an additional layer of encryption in comparison with <code>SYM_ENCRYPT</code>.
You provide keystores that encrypt the requests to coordinator nodes for the secret key.
Infinispan automatically generates that secret key and handles cluster traffic, while letting you specify when to generate secret keys.
For example, you can configure clusters to generate new secret keys when nodes leave.
This ensures that nodes cannot bypass certificate authentication and join with old keys.</p>
</div>
<div class="paragraph">
<p><code>SYM_ENCRYPT</code>, on the other hand, is faster than <code>ASYM_ENCRYPT</code> because nodes do not need to exchange keys with the cluster coordinator.
A potential drawback to <code>SYM_ENCRYPT</code> is that there is no configuration to automatically generate new secret keys when cluster membership changes.
Users are responsible for generating and distributing the secret keys that nodes use to encrypt cluster traffic.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-jgroups-asym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-asym-encrypt_secure-cluster-transport"></a>7.3. Securing cluster transport with asymmetric encryption</h3>
<div class="paragraph">
<p>Configure Infinispan clusters to generate and distribute secret keys that encrypt JGroups messages.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore with certificate chains that enables Infinispan to verify node identity.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SSL_KEY_EXCHANGE</code> and <code>ASYM_ENCRYPT</code> protocols to a JGroups stack in your Infinispan configuration, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;infinispan&gt;
  &lt;jgroups&gt;
    &lt;!-- Creates a secure JGroups stack named "encrypt-tcp" that extends the default TCP stack. --&gt;
    &lt;stack name="encrypt-tcp" extends="tcp"&gt;
      &lt;!-- Adds a keystore that nodes use to perform certificate authentication. --&gt;
      &lt;!-- Uses the stack.combine and stack.position attributes to insert SSL_KEY_EXCHANGE into the default TCP stack after VERIFY_SUSPECT2. --&gt;
      &lt;SSL_KEY_EXCHANGE keystore_name="mykeystore.jks"
                        keystore_password="changeit"
                        stack.combine="INSERT_AFTER"
                        stack.position="VERIFY_SUSPECT2"/&gt;
      &lt;!-- Configures ASYM_ENCRYPT --&gt;
      &lt;!-- Uses the stack.combine and stack.position attributes to insert ASYM_ENCRYPT into the default TCP stack before pbcast.NAKACK2. --&gt;
      &lt;!-- The use_external_key_exchange = "true" attribute configures nodes to use the `SSL_KEY_EXCHANGE` protocol for certificate authentication. --&gt;
      &lt;ASYM_ENCRYPT asym_keylength="2048"
                    asym_algorithm="RSA"
                    change_key_on_coord_leave = "false"
                    change_key_on_leave = "false"
                    use_external_key_exchange = "true"
                    stack.combine="INSERT_BEFORE"
                    stack.position="pbcast.NAKACK2"/&gt;
    &lt;/stack&gt;
  &lt;/jgroups&gt;
  &lt;cache-container name="default" statistics="true"&gt;
    &lt;!-- Configures the cluster to use the JGroups stack. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
               stack="encrypt-tcp"
               node-name="${infinispan.node.name:}"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>ASYM_ENCRYPT</code> and can obtain the secret key from the coordinator node.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[org.jgroups.protocols.ASYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html">JGroups 5 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-5.5.xsd">JGroups 5.5 Schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-jgroups-sym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-sym-encrypt_secure-cluster-transport"></a>7.4. Securing cluster transport with symmetric encryption</h3>
<div class="paragraph">
<p>Configure Infinispan clusters to encrypt JGroups messages with secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore that contains a secret key.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;infinispan&gt;
  &lt;jgroups&gt;
    &lt;!-- Creates a secure JGroups stack named "encrypt-tcp" that extends the default TCP stack. --&gt;
    &lt;stack name="encrypt-tcp" extends="tcp"&gt;
      &lt;!-- Adds a keystore from which nodes obtain secret keys. --&gt;
      &lt;!-- Uses the stack.combine and stack.position attributes to insert SYM_ENCRYPT into the default TCP stack after VERIFY_SUSPECT2. --&gt;
      &lt;SYM_ENCRYPT keystore_name="myKeystore.p12"
                   keystore_type="PKCS12"
                   store_password="changeit"
                   key_password="changeit"
                   alias="myKey"
                   stack.combine="INSERT_AFTER"
                   stack.position="VERIFY_SUSPECT2"/&gt;
    &lt;/stack&gt;
  &lt;/jgroups&gt;
  &lt;cache-container name="default" statistics="true"&gt;
    &lt;!-- Configures the cluster to use the JGroups stack. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
               stack="encrypt-tcp"
               node-name="${infinispan.node.name:}"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>SYM_ENCRYPT</code> and can obtain the secret key from the shared keystore.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[org.jgroups.protocols.SYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html">JGroups 5 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-5.5.xsd">JGroups 5.5 Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ports_protocols"><a class="anchor" href="#ports_protocols"></a>8. Infinispan ports and protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As Infinispan distributes data across your network and can establish
connections for external client requests, you should be aware of the ports and
protocols that Infinispan uses to handle network traffic.</p>
</div>
<div class="paragraph">
<p>If run Infinispan as a remote server then you might need to allow remote
clients through your firewall. Likewise, you should adjust ports that
Infinispan nodes use for cluster communication to prevent conflicts or network
issues.</p>
</div>
<div class="sect2">
<h3 id="server-ports-protocols_network"><a class="anchor" href="#server-ports-protocols_network"></a>8.1. Infinispan Server ports and protocols</h3>
<div class="paragraph">
<p>Infinispan Server provides network endpoints that allow client access with different protocols.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11222</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hot Rod and REST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11221</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memcached (disabled by default)</p></td>
</tr>
</tbody>
</table>
<h4 id="single_port" class="discrete">Single port</h4>
<div class="paragraph">
<p>Infinispan Server exposes multiple protocols through a single TCP port, <code>11222</code>.
Handling multiple protocols with a single port simplifies configuration and reduces management complexity when deploying Infinispan clusters.
Using a single port also enhances security by minimizing the attack surface on the network.</p>
</div>
<div class="paragraph">
<p>Infinispan Server handles HTTP/1.1, HTTP/2, and Hot Rod protocol requests from clients via the single port in different ways.</p>
</div>
<div class="paragraph">
<div class="title">HTTP/1.1 upgrade headers</div>
<p>Client requests can include the <code>HTTP/1.1 upgrade</code> header field to initiate
HTTP/1.1 connections with Infinispan Server.
Client applications can then send the <code>Upgrade: protocol</code> header field, where <code>protocol</code> is a server endpoint.</p>
</div>
<div class="paragraph">
<div class="title">Application-Layer Protocol Negotiation (ALPN)/Transport Layer Security (TLS)</div>
<p>Client requests include Server Name Indication (SNI) mappings for Infinispan Server endpoints to negotiate protocols over a TLS connection.</p>
</div>
<div class="paragraph">
<div class="title">Automatic Hot Rod detection</div>
<p>Client requests that include Hot Rod headers automatically route to Hot Rod endpoints.</p>
</div>
<div class="sect3">
<h4 id="configuring-firewalls_network"><a class="anchor" href="#configuring-firewalls_network"></a>8.1.1. Configuring network firewalls for Infinispan traffic</h4>
<div class="paragraph">
<p>Adjust firewall rules to allow traffic between Infinispan Server and client applications.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On Red Hat Enterprise Linux (RHEL) workstations, for example, you can allow
traffic to port <code>11222</code> with firewalld as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"># firewall-cmd --add-port=11222/tcp --permanent
success
# firewall-cmd --list-ports | grep 11222
11222/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure firewall rules that apply across a network, you can use the
nftables utility.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-ports_network"><a class="anchor" href="#jgroups-ports_network"></a>8.2. TCP and UDP ports for cluster traffic</h3>
<div class="paragraph">
<p>Infinispan uses the following ports for cluster transport messages:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP/UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster bind port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups multicast</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>57800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failure detection is provided by <code>FD_SOCK2</code>.</p></td>
</tr>
</tbody>
</table>
<h4 id="cross_site_replication" class="discrete">Cross-site replication</h4>
<div class="paragraph">
<p>Infinispan uses the following ports for the JGroups RELAY2 protocol:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>7900</code></dt>
<dd>
<p>For Infinispan clusters running on Kubernetes.</p>
</dd>
<dt class="hdlist1"><code>7801</code></dt>
<dd>
<p>For other deployments.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2026-02-13 09:41:29 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>