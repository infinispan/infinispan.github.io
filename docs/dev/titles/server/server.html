<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.8"> <title>Running Infinispan 10.0 Servers</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"> <style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style> <link rel="canonical" href="http://infinispan.org/docs/stable/user_guide/user_guide.html"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css"> <link rel="stylesheet" href="../../css/css.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script> <script src="../../js/js.js"></script> </head> <body class="book toc2 toc-left"> <div id="header"> <h1>Running Infinispan 10.0 Servers</h1> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#server_start">1. Getting started with Infinispan server</a> <ul class="sectlevel2"> <li><a href="#infinispan_server">1.1. Infinispan Server</a></li> <li><a href="#downloading_the_server_distribution">1.2. Downloading the Server Distribution</a></li> </ul> </li> <li><a href="#server_modes">2. Operating modes</a> <ul class="sectlevel2"> <li><a href="#standalone_mode">2.1. Standalone mode</a></li> <li><a href="#domain_mode">2.2. Domain mode</a> <ul class="sectlevel3"> <li><a href="#host_controller">2.2.1. Host Controller</a></li> <li><a href="#domain_controller">2.2.2. Domain Controller</a></li> </ul> </li> <li><a href="#server_group">2.3. Server Group</a> <ul class="sectlevel3"> <li><a href="#server_group_configuration">2.3.1. Server group configuration</a></li> </ul> </li> <li><a href="#server_nodes">2.4. Server nodes</a> <ul class="sectlevel3"> <li><a href="#example_configurations">2.4.1. Example configurations</a></li> </ul> </li> </ul> </li> <li><a href="#server_configuring">3. Configuring Infinispan Servers</a> <ul class="sectlevel2"> <li><a href="#server_config_jgroups">3.1. JGroups Subsystem Configuration</a> <ul class="sectlevel3"> <li><a href="#switching_jgroups_stacks">3.1.1. Switching JGroups Stacks</a></li> <li><a href="#jgroups_tune_transport-server_configuring">3.1.2. Tuning Transport Protocols</a></li> <li><a href="#default_jgroups_stacks-server_configuring">3.1.3. Default JGroups Stacks</a></li> <li><a href="#tcp_ping_discovery">3.1.4. TCP PING Discovery</a></li> <li><a href="#tcp_gossip_discovery">3.1.5. TCP Gossip Discovery</a></li> <li><a href="#aws_s3_ping">3.1.6. AWS S3 Ping</a></li> <li><a href="#google_ping">3.1.7. Google Ping</a></li> <li><a href="#dns_ping">3.1.8. DNS Ping</a></li> </ul> </li> <li><a href="#infinispan_subsystem">3.2. Infinispan subsystem</a> <ul class="sectlevel3"> <li><a href="#containers">3.2.1. Containers</a></li> <li><a href="#cache_declarations">3.2.2. Cache declarations</a></li> <li><a href="#expiration">3.2.3. Expiration</a></li> <li><a href="#eviction">3.2.4. Eviction</a></li> <li><a href="#locking">3.2.5. Locking</a></li> <li><a href="#loaders_and_stores">3.2.6. Loaders and Stores</a></li> <li><a href="#state_transfer">3.2.7. State Transfer</a></li> </ul> </li> <li><a href="#endpoint_subsystem_configuration">3.3. Endpoint subsystem configuration</a> <ul class="sectlevel3"> <li><a href="#hot_rod">3.3.1. Hot Rod</a></li> <li><a href="#memcached">3.3.2. Memcached</a></li> <li><a href="#rest">3.3.3. REST</a></li> <li><a href="#common_protocol_connector_settings">3.3.4. Common Protocol Connector Settings</a></li> </ul> </li> <li><a href="#protocol_interoperability">3.4. Protocol Interoperability</a></li> <li><a href="#custom_marshaller_bridges">3.5. Custom Marshaller Bridges</a> <ul class="sectlevel3"> <li><a href="#protostuff">3.5.1. Protostuff</a></li> <li><a href="#kryo">3.5.2. Kryo</a></li> <li><a href="#storing_deserialized_objects">3.5.3. Storing deserialized objects</a></li> <li><a href="#registering_custom_schemasserializers">3.5.4. Registering Custom Schemas/Serializers</a></li> </ul> </li> </ul> </li> <li><a href="#server_rolling_upgrade">4. Performing Rolling Upgrades</a> <ul class="sectlevel2"> <li><a href="#rolling_upgrades">4.1. Rolling Upgrades</a></li> <li><a href="#setting_up_target_clusters">4.2. Setting Up Target Clusters</a></li> <li><a href="#synchronizing_data_from_source_clusters">4.3. Synchronizing Data from Source Clusters</a></li> </ul> </li> <li><a href="#server_scripts">5. Scripting</a> <ul class="sectlevel2"> <li><a href="#scripting">5.1. Scripting</a></li> <li><a href="#installing_scripts">5.2. Installing Scripts</a> <ul class="sectlevel3"> <li><a href="#script_metadata">5.2.1. Script Metadata</a> <ul class="sectlevel4"> <li><a href="#script_metadata_comments">Script Metadata Comments</a></li> <li><a href="#metadata_properties">Metadata Properties</a></li> <li><a href="#script_bindings">Script Bindings</a></li> <li><a href="#script_parameters">Script Parameters</a></li> </ul> </li> </ul> </li> <li><a href="#running_scripts_with_the_hot_rod_java_client">5.3. Running Scripts with the Hot Rod Java Client</a></li> <li><a href="#distributed_script_execution">5.4. Distributed Script Execution</a></li> </ul> </li> <li><a href="#server_health">6. Monitoring Server Health</a> <ul class="sectlevel2"> <li><a href="#health_monitoring">6.1. Health Monitoring</a></li> <li><a href="#accessing_health_api_using_jmx">6.2. Accessing Health API using JMX</a></li> <li><a href="#accessing_health_api_using_cli">6.3. Accessing Health API using CLI</a></li> <li><a href="#accessing_health_api_using_rest">6.4. Accessing Health API using REST</a></li> </ul> </li> <li><a href="#server_multitenancy">7. Multitenancy</a> <ul class="sectlevel2"> <li><a href="#multi_tenancy">7.1. Multi-tenancy</a></li> <li><a href="#multi_tenancy_with_rest">7.2. Multi-tenancy with REST</a></li> <li><a href="#multi_tenancy_with_hot_rod">7.3. Multi-tenancy with Hot Rod</a></li> <li><a href="#multi_tenant_router">7.4. Multi-tenant router</a></li> </ul> </li> <li><a href="#server_single_port">8. Single Port</a> <ul class="sectlevel2"> <li><a href="#single_port_router">8.1. Single-Port router</a> <ul class="sectlevel3"> <li><a href="#testing_the_single_port_router">8.1.1. Testing the Single-Port router</a></li> </ul> </li> <li><a href="#hot_rod_protocol_detection">8.2. Hot Rod Protocol Detection</a> <ul class="sectlevel3"> <li><a href="#tlsalpn_protocol_selection">8.2.1. TLS/ALPN protocol selection</a> <ul class="sectlevel4"> <li><a href="#enabling_alpn">Enabling ALPN</a></li> </ul> </li> </ul> </li> </ul> </li> </ul> </div> </div> <div id="content"> <div class="sect1"> <h2 id="server_start"><a class="anchor" href="#server_start"></a>1. Getting started with Infinispan server</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="infinispan_server"><a class="anchor" href="#infinispan_server"></a>1.1. Infinispan Server</h3> <div class="paragraph"> <p>Infinispan Server is a standalone server which exposes any number of caches to clients over a variety of protocols, including HotRod, Memcached and REST.</p> </div> <div class="paragraph"> <p>Because Infinispan Server is closely tied to the latest releases of Infinispan and JGroups, the subsystems which control these components are different, in that they introduce new features and change some existing ones (e.g. cross-site replication, etc).</p> </div> <div class="paragraph"> <p>For this reason, the configuration of these subsystems should use the Infinispan Server-specific schema, although for most use-cases the configuration is interchangeable.</p> </div> </div> <div class="sect2"> <h3 id="downloading_the_server_distribution"><a class="anchor" href="#downloading_the_server_distribution"></a>1.2. Downloading the Server Distribution</h3> <div class="paragraph"> <p>To get started using the server, download the Infinispan Server distribution, unpack it to a local directory and launch it using the bin/standalone.sh or bin/standalone.bat scripts depending on your platform. This will start a single-node server using the standalone/configuration/standalone.xml configuration file, with four endpoints, one for each of the supported protocols. These endpoints allow access to all of the caches configured in the Infinispan subsystem (apart from the Memcached endpoint which, because of the protocol&#8217;s design, only allows access to a single cache).</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_modes"><a class="anchor" href="#server_modes"></a>2. Operating modes</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan Server provides two different operating modes: standalone and domain.</p> </div> <div class="sect2"> <h3 id="standalone_mode"><a class="anchor" href="#standalone_mode"></a>2.1. Standalone mode</h3> <div class="paragraph"> <p>For simple configurations, standalone mode is the easiest to start with. It allows both local and clustered configurations, although we only really recommend it for running single nodes, since the configuration, management and coordination of multiple nodes is up to the user&#8217;s responsibility. For example, adding a cache to a cluster of standalone server, the user would need to configure individually to all nodes. Note that the default standalone.xml configuration does not provide a JGroups subsystem and therefore cannot work in clustered mode. To start standalone mode with an alternative configuration file, use the -c command-line switch as follows:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -c clustered.xml</pre> </div> </div> <div class="paragraph"> <p>If you start the server in clustered mode on multiple hosts, they should automatically discover each other using UDP multicast and form a cluster. If you want to start multiple nodes on a single host, start each one by specifying a port offset using the jboss.socket.binding.port-offset property together with a unique jboss.node.name as follows:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -Djboss.socket.binding.port-offset=100 -Djboss.node.name=nodeA</pre> </div> </div> <div class="paragraph"> <p>If, for some reason, you cannot use UDP multicast, you can use TCP discovery. Read the <strong>JGroups Subsystem Configuration</strong> section below for details on how to configure TCP discovery.</p> </div> </div> <div class="sect2"> <h3 id="domain_mode"><a class="anchor" href="#domain_mode"></a>2.2. Domain mode</h3> <div class="paragraph"> <p>Domain mode is the recommended way to run a cluster of servers, since they can all be managed centrally from a single control point. The following diagram explains the topology of an example domain configuration, with 4 server nodes (A1, A2, B1, B2) running on two physical hosts (A, B):</p> </div> <div class="imageblock text-center"> <div class="content"> <img src="./../../topics/images/domain.svg" alt="domain"> </div> <div class="title">Figure 1. Domain-mode</div> </div> <div class="dlist"> <dl> <dt class="hdlist1">Hosts</dt> <dd> <p>Each "Host" box in the above diagram represents a physical or virtual host. A physical host can contain zero, one or more server instances.</p> </dd> </dl> </div> <div class="sect3"> <h4 id="host_controller"><a class="anchor" href="#host_controller"></a>2.2.1. Host Controller</h4> <div class="paragraph"> <p>When the domain.sh or domain.bat script is run on a host, a process known as a Host Controller is launched. The Host Controller is solely concerned with server management; it does not itself handle Infinispan server workloads. The Host Controller is responsible for starting and stopping the individual Infinispan server processes that run on its host, and interacts with the Domain Controller to help manage them.</p> </div> <div class="paragraph"> <p>Each Host Controller by default reads its configuration from the domain/configuration/host.xml file located in the Infinispan Server installation on its host&#8217;s filesystem. The host.xml file contains configuration information that is specific to the particular host. Primarily:</p> </div> <div class="ulist"> <ul> <li> <p>the listing of the names of the actual Infinispan Server instances that are meant to run off of this installation.</p> </li> <li> <p>configuration of how the Host Controller is to contact the Domain Controller to register itself and access the domain configuration. This may either be configuration of how to find and contact a remote Domain Controller, or a configuration telling the Host Controller to itself act as the Domain Controller.</p> </li> <li> <p>configuration of items that are specific to the local physical installation. For example, named interface definitions declared in domain.xml (see below) can be mapped to an actual machine-specific IP address in host.xml. Abstract path names in domain.xml can be mapped to actual filesystem paths in host.xml.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="domain_controller"><a class="anchor" href="#domain_controller"></a>2.2.2. Domain Controller</h4> <div class="paragraph"> <p>One Host Controller instance is configured to act as the central management point for the entire domain, i.e. to be the Domain Controller. The primary responsibility of the Domain Controller is to maintain the domain&#8217;s central management policy, to ensure all Host Controllers are aware of its current contents, and to assist the Host Controllers in ensuring any running Infinispan server instances are configured in accordance with this policy. This central management policy is stored by default in the domain/configuration/domain.xml file in the Infinispan Server installation on Domain Controller&#8217;s host&#8217;s filesystem.</p> </div> <div class="paragraph"> <p>A domain.xml file must be located in the domain/configuration directory of an installation that&#8217;s meant to run the Domain Controller. It does not need to be present in installations that are not meant to run a Domain Controller; i.e. those whose Host Controller is configured to contact a remote Domain Controller. The presence of a domain.xml file on such a server does no harm.</p> </div> <div class="paragraph"> <p>The domain.xml file includes, among other things, the configuration of the various "profiles" that Infinispan Server instances in the domain can be configured to run. A profile configuration includes the detailed configuration of the various subsystems that comprise that profile (e.g. Cache Containers and Caches, Endpoints, Security Realms, DataSources, etc). The domain configuration also includes the definition of groups of sockets that those subsystems may open. The domain configuration also includes the definition of "server groups".</p> </div> </div> </div> <div class="sect2"> <h3 id="server_group"><a class="anchor" href="#server_group"></a>2.3. Server Group</h3> <div class="paragraph"> <p>A server group is set of server instances that will be managed and configured as one. In a managed domain each application server instance is a member of a server group. Even if the group only has a single server, the server is still a member of a group. It is the responsibility of the Domain Controller and the Host Controllers to ensure that all servers in a server group have a consistent configuration. They should all be configured with the same profile and they should have the same deployment content deployed. To keep things simple, ensure that all the nodes that you want to belong to an Infinispan cluster are configured as servers of one server group.</p> </div> <div class="paragraph"> <p>The domain can have multiple server groups, i.e. multiple Infinispan clusters. Different server groups can be configured with different profiles and deployments; for example in a domain with different Infinispan Server clusters ﻿providing different services. Different server groups can also run the same profile and have the same deployments.</p> </div> <div class="paragraph"> <p>An example server group definition is as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;server-group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main-server-group</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;socket-binding-group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">standard-sockets</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/server-group&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="server_group_configuration"><a class="anchor" href="#server_group_configuration"></a>2.3.1. Server group configuration</h4> <div class="paragraph"> <p>A server-group configuration includes the following required attributes:</p> </div> <div class="ulist"> <ul> <li> <p>name&#8201;&#8212;&#8201;the name of the server group</p> </li> <li> <p>profile&#8201;&#8212;&#8201;the name of the profile the servers in the group should run</p> </li> </ul> </div> <div class="paragraph"> <p>In addition, the following optional elements are available:</p> </div> <div class="ulist"> <ul> <li> <p>socket-binding-group&#8201;&#8212;&#8201;specifies the name of the default socket binding group to use on servers in the group. Can be overridden on a per-server basis in host.xml. If not provided in the server-group element, it must be provided for each server in host.xml.</p> </li> <li> <p>deployments&#8201;&#8212;&#8201;the deployment content that should be deployed on the servers in the group.</p> </li> <li> <p>system-properties&#8201;&#8212;&#8201;system properties that should be set on all servers in the group</p> </li> <li> <p>jvm&#8201;&#8212;&#8201;default jvm settings for all servers in the group. The Host Controller will merge these settings with any provided in host.xml to derive the settings to use to launch the server&#8217;s JVM. See JVM settings for further details.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="server_nodes"><a class="anchor" href="#server_nodes"></a>2.4. Server nodes</h3> <div class="paragraph"> <p>Each "Server" in the above diagram represents an actual Infinispan Server node. The server runs in a separate JVM process from the Host Controller. The Host Controller is responsible for launching that process. In a managed domain the end user cannot directly launch a server process from the command line.</p> </div> <div class="paragraph"> <p>The Host Controller synthesizes the server&#8217;s configuration by combining elements from the domain wide configuration (from domain.xml) and the host-specific configuration (from host.xml).</p> </div> <div class="sect3"> <h4 id="example_configurations"><a class="anchor" href="#example_configurations"></a>2.4.1. Example configurations</h4> <div class="paragraph"> <p>The server distribution also provides a set of example configuration files in the docs/examples/configs (mostly using standalone mode) which illustrate a variety of possible configurations and use-cases. To use them, just copy them to the standalone/configuration directory and start the server using the following syntax:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -c configuration_file_name.xml</pre> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_configuring"><a class="anchor" href="#server_configuring"></a>3. Configuring Infinispan Servers</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="server_config_jgroups"><a class="anchor" href="#server_config_jgroups"></a>3.1. JGroups Subsystem Configuration</h3> <div class="paragraph"> <p>The JGroups subsystem configures the network transport and is only required when clustering multiple Infinispan Server nodes together.</p> </div> <div class="paragraph"> <p>The subsystem declaration is enclosed in the following XML element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:jgroups:9.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;channels</span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/channels&gt;</span>
  <span class="tag">&lt;stacks</span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.default.jgroups.stack:udp}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
  <span class="tag">&lt;/stacks&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Within the subsystem, you need to declare the stacks that you wish to use and name them. The default-stack attribute in the subsystem declaration must point to one of the declared stacks.</p> </div> <div class="sect3"> <h4 id="switching_jgroups_stacks"><a class="anchor" href="#switching_jgroups_stacks"></a>3.1.1. Switching JGroups Stacks</h4> <div class="paragraph"> <p>You can switch stacks from the command-line using the jboss.default.jgroups.stack property:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -c clustered.xml -Djboss.default.jgroups.stack=tcp</pre> </div> </div> </div> <div class="sect3"> <h4 id="jgroups_tune_transport-server_configuring"><a class="anchor" href="#jgroups_tune_transport-server_configuring"></a>3.1.2. Tuning Transport Protocols</h4> <div class="paragraph"> <p>A stack declaration is composed of a transport, <code>UDP</code> or <code>TCP</code>, followed by a list of protocols. You can tune protocols by adding properties as child elements with this format:</p> </div> <div class="paragraph"> <p><code>&lt;property name="prop_name"&gt;prop_value&lt;/property&gt;</code></p> </div> </div> <div class="sect3"> <h4 id="default_jgroups_stacks-server_configuring"><a class="anchor" href="#default_jgroups_stacks-server_configuring"></a>3.1.3. Default JGroups Stacks</h4> <div class="paragraph"> <p>Infinispan uses the following JGroups <code>TCP</code> and <code>UDP</code> stacks by default:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UDP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PING</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span>
<span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-mping</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">use_mcast_xmit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/protocol&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>To improve performance, Infinispan uses some values for properties other than the JGroups default values. You should examine the following files to review the JGroups configuration for Infinispan:</p> </div> <div class="ulist"> <ul> <li> <p>Infinispan servers</p> <div class="ulist"> <ul> <li> <p><code>jgroups-defaults.xml</code></p> </li> <li> <p><code>infinispan-jgroups.xml</code></p> </li> </ul> </div> </li> <li> <p>Embedded Infinispan</p> <div class="ulist"> <ul> <li> <p><code>default-jgroups-tcp.xml</code></p> </li> <li> <p><code>default-jgroups-udp.xml</code></p> </li> </ul> </div> </li> </ul> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>The default <code>TCP</code> stack uses the <code>MPING</code> protocol for discovery, which uses <code>UDP</code> multicast.</p> </div> <div class="ulist"> <div class="title">Reference</div> <ul> <li> <p><a href="http://www.jgroups.org/manual/html/protlist.html">JGroups Protocol</a></p> </li> <li> <p><a href="http://www.jgroups.org/manual/html/protlist.html#DiscoveryProtocols">JGroups Discovery Protocols</a></p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="tcp_ping_discovery"><a class="anchor" href="#tcp_ping_discovery"></a>3.1.4. TCP PING Discovery</h4> <div class="paragraph"> <p>The following example stack configures the TCPPING discovery protocol with two initial hosts:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCPPING</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initial_hosts</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>HostA[7800],HostB[7800]<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/protocol&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">use_mcast_xmit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/protocol&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC_NB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="tcp_gossip_discovery"><a class="anchor" href="#tcp_gossip_discovery"></a>3.1.5. TCP Gossip Discovery</h4> <div class="paragraph"> <p>The default configurations come with a variety of pre-configured stacks for different environments. For example, the tcpgossip stack uses Gossip discovery:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCPGOSSIP</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initial_hosts</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.gossip.initial_hosts:}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="aws_s3_ping"><a class="anchor" href="#aws_s3_ping"></a>3.1.6. AWS S3 Ping</h4> <div class="paragraph"> <p>Use the s3 stack when running in Amazon AWS:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups.aws.s3.NATIVE_S3_PING</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jgroups.aws.s3:ispn-10.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">region_name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.region:}<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bucket_name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.bucket_name:}<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bucket_prefix</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.bucket_prefix:}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="google_ping"><a class="anchor" href="#google_ping"></a>3.1.7. Google Ping</h4> <div class="paragraph"> <p>Similarly, when using Google&#8217;s Cloud Platform, use the google stack:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GOOGLE_PING</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.google.bucket:}<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">access_key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.google.access_key:}<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret_access_key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.google.secret_access_key:}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="dns_ping"><a class="anchor" href="#dns_ping"></a>3.1.8. DNS Ping</h4> <div class="paragraph"> <p>Use the dns-ping stack to run Infinispan on Kubernetes environments such as OKD or OpenShift:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dns.DNS_PING</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dns_query</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.dns_ping.dns_query}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The value of the <code>dns_query</code> property is the DNS query that returns the cluster members. See <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a> for information about Kubernetes DNS naming.</p> </div> </div> </div> <div class="sect2"> <h3 id="infinispan_subsystem"><a class="anchor" href="#infinispan_subsystem"></a>3.2. Infinispan subsystem</h3> <div class="paragraph"> <p>The Infinispan subsystem configures the cache containers and caches.</p> </div> <div class="paragraph"> <p>The subsystem declaration is enclosed in the following XML element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:9.4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="containers"><a class="anchor" href="#containers"></a>3.2.1. Containers</h4> <div class="paragraph"> <p>The Infinispan subsystem can declare multiple containers. A container is declared as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/cache-container&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Note that in server mode is the lack of an implicit default cache, but the ability to specify a named cache as the default.</p> </div> <div class="paragraph"> <p>If you need to declare clustered caches (distributed, replicated, invalidation), you also need to specify the <code>&lt;transport/&gt;</code> element which references an existing JGroups transport. This is not needed if you only intend to have local caches only.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;transport</span> <span class="attribute-name">executor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-transport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-cluster-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="cache_declarations"><a class="anchor" href="#cache_declarations"></a>3.2.2. Cache declarations</h4> <div class="paragraph"> <p>Now you can declare your caches. Please be aware that only the caches declared in the configuration will be available to the endpoints and that attempting to access an undefined cache is an illegal operation. Contrast this with the default Infinispan library behaviour where obtaining an undefined cache will implicitly create one using the default settings. The following are example declarations for all four available types of caches:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/local-cache&gt;</span>

<span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/replicated-cache&gt;</span>

<span class="tag">&lt;invalidation-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/invalidation-cache&gt;</span>

<span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">distcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">segments</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">owners</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="expiration"><a class="anchor" href="#expiration"></a>3.2.3. Expiration</h4> <div class="paragraph"> <p>To define a default expiration for entries in a cache, add the <code>&lt;expiration/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;expiration</span> <span class="attribute-name">lifespan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-idle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the expiration element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>lifespan</em> maximum lifespan of a cache entry, after which the entry is expired cluster-wide, in milliseconds. -1 means the entries never expire.</p> </li> <li> <p><em>max-idle</em> maximum idle time a cache entry will be maintained in the cache, in milliseconds. If the idle time is exceeded, the entry will be expired cluster-wide. -1 means the entries never expire.</p> </li> <li> <p><em>interval</em> interval (in milliseconds) between subsequent runs to purge expired entries from memory and any cache stores. If you wish to disable the periodic eviction process altogether, set interval to -1.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="eviction"><a class="anchor" href="#eviction"></a>3.2.4. Eviction</h4> <div class="paragraph"> <p>To define eviction for a cache, add the <code>&lt;memory/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;memory&gt;</span>
  <span class="tag">&lt;binary</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">eviction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COUNT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/memory&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the eviction element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>strategy</em> sets the cache eviction strategy. Available options are 'UNORDERED', 'FIFO', 'LRU', 'LIRS' and 'NONE' (to disable eviction).</p> </li> <li> <p><em>max-entries</em> maximum number of entries in a cache instance. If selected value is not a power of two the actual value will default to the least power of two larger than selected value. -1 means no limit.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="locking"><a class="anchor" href="#locking"></a>3.2.5. Locking</h4> <div class="paragraph"> <p>To define the locking configuration for a cache, add the <code>&lt;locking/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;locking</span> <span class="attribute-name">isolation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPEATABLE_READ</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acquire-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">concurrency-level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">striping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the locking element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>isolation</em> sets the cache locking isolation level. Can be NONE, READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE. Defaults to REPEATABLE_READ</p> </li> <li> <p><em>striping</em> if true, a pool of shared locks is maintained for all entries that need to be locked. Otherwise, a lock is created per entry in the cache. Lock striping helps control memory footprint but may reduce concurrency in the system.</p> </li> <li> <p><em>acquire-timeout</em> maximum time to attempt a particular lock acquisition.</p> </li> <li> <p><em>concurrency-level</em> concurrency level for lock containers. Adjust this value according to the number of concurrent threads interacting with Infinispan.</p> </li> <li> <p><em>concurrent-updates</em> for non-transactional caches only: if set to true(default value) the cache keeps data consistent in the case of concurrent updates. For clustered caches this comes at the cost of an additional RPC, so if you don&#8217;t expect your application to write data concurrently, disabling this flag increases performance.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="loaders_and_stores"><a class="anchor" href="#loaders_and_stores"></a>3.2.6. Loaders and Stores</h4> <div class="paragraph"> <p>Loaders and stores can be defined in server mode in almost the same way as in embedded mode.</p> </div> <div class="paragraph"> <p>However, in server mode it is no longer necessary to define the <code>&lt;persistence&gt;&#8230;&#8203;&lt;/persistence&gt;</code> tag. Instead, a store&#8217;s attributes are now defined on the store type element. For example, to configure the H2 database with a distributed cache in domain mode we define the "default" cache as follows in our domain.xml configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:9.4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;global-state</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;string-keyed-jdbc-store</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fetch-state</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">shared</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;string-keyed-table</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISPN</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;id-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;data-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">datum</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BINARY</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;timestamp-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BIGINT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/string-keyed-table&gt;</span>
        <span class="tag">&lt;write-behind</span> <span class="attribute-name">modification-queue-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/string-keyed-jdbc-store&gt;</span>
    <span class="tag">&lt;/distributed-cache&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Another important thing to note in this example, is that we use the "ExampleDS" datasource which is defined in the datasources subsystem in our domain.xml configuration as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:datasources:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;datasources&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use-java-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;connection-url&gt;</span>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<span class="tag">&lt;/connection-url&gt;</span>
      <span class="tag">&lt;driver&gt;</span>h2<span class="tag">&lt;/driver&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="tag">&lt;user-name&gt;</span>sa<span class="tag">&lt;/user-name&gt;</span>
        <span class="tag">&lt;password&gt;</span>sa<span class="tag">&lt;/password&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/datasource&gt;</span>
  <span class="tag">&lt;/datasources&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> For additional examples of store configurations, please view the configuration templates in the default "domain.xml" file provided with in the server distribution at <code>./domain/configuration/domain.xml</code>. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="state_transfer"><a class="anchor" href="#state_transfer"></a>3.2.7. State Transfer</h4> <div class="paragraph"> <p>To define the state transfer configuration for a distributed or replicated cache, add the <code>&lt;state-transfer/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;state-transfer</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">240000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">chunk-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">await-initial-transfer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the state-transfer element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>enabled</em> if true, this will cause the cache to ask neighboring caches for state when it starts up, so the cache starts 'warm', although it will impact startup time. Defaults to true.</p> </li> <li> <p><em>timeout</em> the maximum amount of time (ms) to wait for state from neighboring caches, before throwing an exception and aborting startup. Defaults to 240000 (4 minutes).</p> </li> <li> <p><em>chunk-size</em> the number of cache entries to batch in each transfer. Defaults to 512.</p> </li> <li> <p><em>await-initial-transfer</em> if true, this will cause the cache to wait for initial state transfer to complete before responding to requests. Defaults to true.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="endpoint_subsystem_configuration"><a class="anchor" href="#endpoint_subsystem_configuration"></a>3.3. Endpoint subsystem configuration</h3> <div class="paragraph"> <p>The endpoint subsystem exposes a whole container (or in the case of Memcached, a single cache) over a specific connector protocol. You can define as many connector as you need, provided they bind on different interfaces/ports.</p> </div> <div class="paragraph"> <p>The subsystem declaration is enclosed in the following XML element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:endpoint:9.4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 ...
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="hot_rod"><a class="anchor" href="#hot_rod"></a>3.3.1. Hot Rod</h4> <div class="paragraph"> <p>The following connector declaration enables a HotRod server using the <em>hotrod</em> socket binding (declared within a <code>&lt;socket-binding-group /&gt;</code> element) and exposing the caches declared in the <em>local</em> container, using defaults for all other settings.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The connector will create a supporting topology cache with default settings. If you wish to tune these settings add the <code>&lt;topology-state-transfer /&gt;</code> child element to the connector as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;topology-state-transfer</span> <span class="attribute-name">lazy-retrieval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">replication-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The Hot Rod connector can be further tuned with additional settings such as concurrency and buffering. See the protocol connector settings paragraph for additional details</p> </div> <div class="paragraph"> <p>Furthermore the HotRod connector can be secured using SSL. First you need to declare an SSL server identity within a security realm in the management section of the configuration file. The SSL server identity should specify the path to a keystore and its secret. Refer to the AS <a href="https://docs.jboss.org/author/display/WFLY11/Security%20Realms">documentation</a> on this. Next add the <code>&lt;security /&gt;</code> element to the HotRod connector as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security</span> <span class="attribute-name">ssl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="memcached"><a class="anchor" href="#memcached"></a>3.3.2. Memcached</h4> <div class="paragraph"> <p>The following connector declaration enables a Memcached server using the <em>memcached</em> socket binding (declared within a <code>&lt;socket-binding-group /&gt;</code> element) and exposing the <em>memcachedCache</em> cache declared in the <em>local</em> container, using defaults for all other settings. Because of limitations in the Memcached protocol, only one cache can be exposed by a connector. If you wish to expose more than one cache, declare additional memcached-connectors on different socket-bindings.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;memcached-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcached</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="rest"><a class="anchor" href="#rest"></a>3.3.3. REST</h4> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;rest-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">other</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auth-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="common_protocol_connector_settings"><a class="anchor" href="#common_protocol_connector_settings"></a>3.3.4. Common Protocol Connector Settings</h4> <div class="paragraph"> <p>The HotRod and Memcached protocol connectors support a number of tuning attributes in their declaration:</p> </div> <div class="ulist"> <ul> <li> <p><em>worker-threads</em> Sets the number of worker threads. Defaults to 160.</p> </li> <li> <p><em>idle-timeout</em> Specifies the maximum time in seconds that connections from client will be kept open without activity. Defaults to -1 (connections will never timeout)</p> </li> <li> <p><em>tcp-nodelay</em> Affects TCP NODELAY on the TCP stack. Defaults to enabled.</p> </li> <li> <p><em>send-buffer-size</em> Sets the size of the send buffer.</p> </li> <li> <p><em>receive-buffer-size</em> Sets the size of the receive buffer.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="protocol_interoperability"><a class="anchor" href="#protocol_interoperability"></a>3.4. Protocol Interoperability</h3> <div class="paragraph"> <p>Clients exchange data with Infinispan through endpoints such as REST or Hot Rod.</p> </div> <div class="paragraph"> <p>Each endpoint uses a different protocol so that clients can read and write data in a suitable format. Because Infinispan can interoperate with multiple clients at the same time, it must convert data between client formats and the storage formats.</p> </div> </div> <div class="sect2"> <h3 id="custom_marshaller_bridges"><a class="anchor" href="#custom_marshaller_bridges"></a>3.5. Custom Marshaller Bridges</h3> <div class="paragraph"> <p>Infinispan provides two marshalling bridges for marshalling client/server requests using the Kryo and Protostuff libraries. To utilise either of these marshallers, you simply place the dependency of the marshaller you require in your client pom. Custom schemas for object marshalling must then be registered with the selected library using the library&#8217;s api on the client or by implementing a RegistryService for the given marshaller bridge. Examples of how to achieve this for both libraries are presented below:</p> </div> <div class="sect3"> <h4 id="protostuff"><a class="anchor" href="#protostuff"></a>3.5.1. Protostuff</h4> <div class="paragraph"> <p>Add the protostuff marshaller dependency to your pom:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-marshaller-protostuff<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.infinispan} with the
  version of Infinispan that you're using. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To register custom Protostuff schemas in your own code, you must register the custom schema with Protostuff before any marshalling begins. This can be achieved by simply calling:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RuntimeSchema.register(ExampleObject.class, <span class="keyword">new</span> ExampleObjectSchema());</code></pre> </div> </div> <div class="paragraph"> <p>Or, you can implement a service provider for the <code>SchemaRegistryService.java</code> interface, placing all Schema registrations in the <code>register()</code> method. Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/protostuff/SchemaRegistryService</code> file within your deployment jar.</p> </div> </div> <div class="sect3"> <h4 id="kryo"><a class="anchor" href="#kryo"></a>3.5.2. Kryo</h4> <div class="paragraph"> <p>Add the kryo marshaller dependency to your pom:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-marshaller-kryo<span class="tag">&lt;/artifactId&gt;</span>
  <span class="comment">&lt;!-- Replace ${version.infinispan} with the
  version of Infinispan that you're using. --&gt;</span>
  <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To register custom Kryo serializer in your own code, you must register the custom serializer with Kryo before any marshalling begins. This can be achieved by implementing a service provider for the <code>SerializerRegistryService.java</code> interface, placing all serializer registrations in the <code>register(Kryo)</code> method; where serializers should be registered with the supplied <code>Kryo</code> object using the Kryo api. e.g. <code>kryo.register(ExampleObject.class, new ExampleObjectSerializer())</code>. Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/kryo/SerializerRegistryService</code> file within your deployment jar.</p> </div> </div> <div class="sect3"> <h4 id="storing_deserialized_objects"><a class="anchor" href="#storing_deserialized_objects"></a>3.5.3. Storing deserialized objects</h4> <div class="paragraph"> <p>When using the Protostuff/Kryo bridges in caches configured with <em>application/x-java-object</em> as MediaType (storing POJOs instead of binary content) it is necessary for the class files of all custom objects to be placed on the classpath of the server. To achieve this, you should place a jar containing all of their custom classes on the server&#8217;s classpath.</p> </div> <div class="paragraph"> <p>When utilising a custom marshaller, it is also necessary for the marshaller and it&#8217;s runtime dependencies to be on the server&#8217;s classpath. To aid with this step we have created a "bundle" jar for each of the bridge implementations which includes all of the runtime class files required by the bridge and underlying library. Therefore, it is only necessary to include this single jar on the server&#8217;s classpath.</p> </div> <div class="paragraph"> <p>Bundle jar downloads:</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-kryo-bundle/10.0/infinispan-marshaller-kryo-bundle-10.0.jar">Kryo Bundle</a></p> </li> <li> <p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-protostuff-bundle/10.0/infinispan-marshaller-protostuff-bundle-10.0.jar">Protostuff Bundle</a></p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Jar files containing custom classes must be placed in the same module/directory as the custom marshaller bundle so that the marshaller can load them. i.e. if you register the marshaller bundle in <code>modules/system/layers/base/org/infinispan/main/modules.xml</code>, then you must also register your custom classes here. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="registering_custom_schemasserializers"><a class="anchor" href="#registering_custom_schemasserializers"></a>3.5.4. Registering Custom Schemas/Serializers</h4> <div class="paragraph"> <p>Custom serializers/schemas for the Kryo/Protostuff marshallers must be registered via their respective service interfaces in order to store deserialized objects. To achieve this, it is necessary for a <strong>JAR</strong> that contains the service provider to be registered in the same directory or module as the marshaller bundle and custom classes.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>It is not necessary for the service provider implementation to be provided in the same <strong>JAR</strong> as the user&#8217;s custom classes. However, the <strong>JAR</strong> that contains the provider must be in the same directory/module as the marshaller and custom class <strong>JAR</strong> files.</p> </div> </td> </tr> </table> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_rolling_upgrade"><a class="anchor" href="#server_rolling_upgrade"></a>4. Performing Rolling Upgrades</h2> <div class="sectionbody"> <div class="paragraph"> <p>Upgrade Infinispan without downtime or data loss. You can perform rolling upgrades for Infinispan servers to start using a more recent version of Infinispan.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>This section explains how to upgrade Infinispan servers, see the appropriate documentation for your Hot Rod client for upgrade procedures.</p> </div> </td> </tr> </table> </div> <div class="sect2"> <h3 id="rolling_upgrades"><a class="anchor" href="#rolling_upgrades"></a>4.1. Rolling Upgrades</h3> <div class="paragraph"> <p>From a high-level, you do the following to perform rolling upgrades:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Set up a target cluster. The target cluster is the Infinispan version to which you want to migrate data. The source cluster is the Infinispan deployment that is currently in use. After the target cluster is running, you configure all clients to point to it instead of the source cluster.</p> </li> <li> <p>Synchronize data from the source cluster to the target cluster.</p> </li> </ol> </div> </div> <div class="sect2"> <h3 id="setting_up_target_clusters"><a class="anchor" href="#setting_up_target_clusters"></a>4.2. Setting Up Target Clusters</h3> <div class="olist arabic"> <ol class="arabic"> <li> <p>Start the target cluster with unique network properties or a different JGroups cluster name to keep it separate from the source cluster.</p> </li> <li> <p>Configure a <code>RemoteCacheStore</code> on the target cluster for each cache you want to migrate from the source cluster.</p> <div class="dlist"> <dl> <dt class="hdlist1"><code>RemoteCacheStore</code> settings</dt> <dd> <div class="ulist"> <ul> <li> <p><code>remote-server</code> must point to the source cluster via the <code>outbound-socket-binding</code> property.</p> </li> <li> <p><code>remoteCacheName</code> must match the cache name on the source cluster.</p> </li> <li> <p><code>hotrod-wrapping</code> must be <code>true</code> (enabled).</p> </li> <li> <p><code>shared</code> must be <code>true</code> (enabled).</p> </li> <li> <p><code>purge</code> must be <code>false</code> (disabled).</p> </li> <li> <p><code>passivation</code> must be <code>false</code> (disabled).</p> </li> <li> <p><code>protocol-version</code> matches the Hot Rod protocol version of the source cluster.</p> <div class="listingblock"> <div class="title">Example <code>RemoteCacheStore</code> Configuration</div> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;remote-store</span> <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyCache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tcp-no-delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">protocol-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">shared</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">hotrod-wrapping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">purge</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">passivation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;remote-server</span> <span class="attribute-name">outbound-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-store-hotrod-server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/remote-store&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span>
...
<span class="tag">&lt;socket-binding-group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">standard-sockets</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port-offset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.socket.binding.port-offset:0}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;outbound-socket-binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-store-hotrod-server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;remote-destination</span> <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">198.51.100.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11222</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/outbound-socket-binding&gt;</span>
  ...
<span class="tag">&lt;/socket-binding-group&gt;</span></code></pre> </div> </div> </li> </ul> </div> </dd> </dl> </div> </li> <li> <p>Configure the target cluster to handle all client requests instead of the source cluster:</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>Configure all clients to point to the target cluster instead of the source cluster.</p> </li> <li> <p>Restart each client node.</p> <div class="paragraph"> <p>The target cluster lazily loads data from the source cluster on demand via <code>RemoteCacheStore</code>.</p> </div> </li> </ol> </div> </li> </ol> </div> </div> <div class="sect2"> <h3 id="synchronizing_data_from_source_clusters"><a class="anchor" href="#synchronizing_data_from_source_clusters"></a>4.3. Synchronizing Data from Source Clusters</h3> <div class="olist arabic"> <ol class="arabic"> <li> <p>Call the <code>synchronizeData()</code> method in the <code>TargetMigrator</code> interface. Do one of the following on the target cluster for each cache that you want to migrate:</p> <div class="dlist"> <dl> <dt class="hdlist1">JMX</dt> <dd> <div class="paragraph"> <p>Invoke the <code>synchronizeData</code> operation and specify the <code>hotrod</code> parameter on the <code>RollingUpgradeManager</code> MBean.</p> </div> </dd> <dt class="hdlist1">CLI</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh --connect controller=127.0.0.1:9990 -c "/subsystem=datagrid-infinispan/cache-container=clustered/distributed-cache=MyCache:synchronize-data(migrator-name=hotrod)"</code></pre> </div> </div> <div class="paragraph"> <p>Data migrates to all nodes in the target cluster in parallel, with each node receiving a subset of the data.</p> </div> <div class="paragraph"> <p>Use the following parameters to tune the operation:</p> </div> <div class="ulist"> <ul> <li> <p><code>read-batch</code> configures the number of entries to read from the source cluster at a time. The default value is <code>10000</code>.</p> </li> <li> <p><code>write-threads</code> configures the number of threads used to write data. The default value is the number of processors available.</p> <div class="paragraph"> <p>For example:</p> </div> <div class="paragraph"> <p><code>synchronize-data(migrator-name=hotrod, read-batch=100000, write-threads=3)</code></p> </div> </li> </ul> </div> </dd> </dl> </div> </li> <li> <p>Disable the <code>RemoteCacheStore</code> on the target cluster. Do one of the following:</p> <div class="dlist"> <dl> <dt class="hdlist1">JMX</dt> <dd> <div class="paragraph"> <p>Invoke the <code>disconnectSource</code> operation and specify the <code>hotrod</code> parameter on the <code>RollingUpgradeManager</code> MBean.</p> </div> </dd> <dt class="hdlist1">CLI</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh --connect controller=127.0.0.1:9990 -c "/subsystem=datagrid-infinispan/cache-container=clustered/distributed-cache=MyCache:disconnect-source(migrator-name=hotrod)"</code></pre> </div> </div> </dd> </dl> </div> </li> <li> <p>Decommission the source cluster.</p> </li> </ol> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_scripts"><a class="anchor" href="#server_scripts"></a>5. Scripting</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="scripting"><a class="anchor" href="#scripting"></a>5.1. Scripting</h3> <div class="paragraph"> <p>Scripting is a feature of Infinispan Server which allows invoking server-side scripts from remote clients. Scripting leverages the JDK&#8217;s javax.script ScriptEngines, therefore allowing the use of any JVM languages which offer one. By default, the JDK comes with Nashorn, a ScriptEngine capable of running JavaScript.</p> </div> </div> <div class="sect2"> <h3 id="installing_scripts"><a class="anchor" href="#installing_scripts"></a>5.2. Installing Scripts</h3> <div class="paragraph"> <p>Scripts are stored in a special script cache, named '___script_cache'. Adding a script is therefore as simple as put+ting it into the cache itself. If the name of the script contains a filename extension, e.g. +myscript.js, then that extension determines the engine that will be used to execute it. Alternatively the script engine can be selected using script metadata (see below). Be aware that, when security is enabled, access to the script cache via the remote protocols requires that the user belongs to the '___script_manager' role.</p> </div> <div class="sect3"> <h4 id="script_metadata"><a class="anchor" href="#script_metadata"></a>5.2.1. Script Metadata</h4> <div class="paragraph"> <p>Script metadata is additional information about the script that the user can provide to the server to affect how a script is executed. It is contained in a specially-formatted comment on the first lines of the script.</p> </div> <div class="sect4"> <h5 id="script_metadata_comments"><a class="anchor" href="#script_metadata_comments"></a>Script Metadata Comments</h5> <div class="paragraph"> <p>Properties are specified as key=value pairs, separated by commas. You can use several different comment styles: The <code>//</code>, <code>;;</code>, <code>#</code> depending on the scripting language you use. You can split metadata over multiple lines if necessary, and you can use single (') or double (") quotes to delimit your values.</p> </div> <div class="paragraph"> <p>The following are examples of valid metadata comments:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// name=test, language=javascript</span>
<span class="comment">// mode=local, parameters=[a,b,c]</span></code></pre> </div> </div> </div> <div class="sect4"> <h5 id="metadata_properties"><a class="anchor" href="#metadata_properties"></a>Metadata Properties</h5> <div class="paragraph"> <p>The following metadata property keys are available</p> </div> <div class="ulist"> <ul> <li> <p>mode: defines the mode of execution of a script. Can be one of the following values:</p> <div class="ulist"> <ul> <li> <p>local: the script will be executed only by the node handling the request. The script itself however can invoke clustered operations</p> </li> <li> <p>distributed: runs the script using the Distributed Executor Service</p> </li> </ul> </div> </li> <li> <p>language: defines the script engine that will be used to execute the script, e.g. Javascript</p> </li> <li> <p>extension: an alternative method of specifying the script engine that will be used to execute the script, e.g. js</p> </li> <li> <p>role: a specific role which is required to execute the script</p> </li> <li> <p>parameters: an array of valid parameter names for this script. Invocations which specify parameter names not included in this list will cause an exception.</p> </li> <li> <p>datatype: optional property providing information, in the form of Media Types (also known as MIME) about the type of the data stored in the caches, as well as parameter and return values. Currently it only accepts a single value which is <code>text/plain; charset=utf-8</code>, indicating that data is String UTF-8 format. This metadata parameter is designed for remote clients that only support a particular type of data, making it easy for them to retrieve, store and work with parameters.</p> </li> </ul> </div> <div class="paragraph"> <p>Since the execution mode is a characteristic of the script, nothing special needs to be done on the client to invoke scripts in different modes.</p> </div> </div> <div class="sect4"> <h5 id="script_bindings"><a class="anchor" href="#script_bindings"></a>Script Bindings</h5> <div class="paragraph"> <p>The script engine within Infinispan exposes several internal objects as bindings in the scope of the script execution. These are:</p> </div> <div class="ulist"> <ul> <li> <p>cache: the cache against which the script is being executed</p> </li> <li> <p>marshaller: the marshaller to use for marshalling/unmarshalling data to the cache</p> </li> <li> <p>cacheManager: the cacheManager for the cache</p> </li> <li> <p>scriptingManager: the instance of the script manager which is being used to run the script. This can be used to run other scripts from a script.</p> </li> </ul> </div> </div> <div class="sect4"> <h5 id="script_parameters"><a class="anchor" href="#script_parameters"></a>Script Parameters</h5> <div class="paragraph"> <p>Aside from the standard bindings described above, when a script is executed it can be passed a set of named parameters which also appear as bindings. Parameters are passed as name,value pairs where name is a string and value can be any value that is understood by the marshaller in use.</p> </div> <div class="paragraph"> <p>The following is an example of a JavaScript script which takes two parameters, multiplicand and multiplier and multiplies them. Because the last operation is an expression evaluation, its result is returned to the invoker.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript</span>
multiplicand * multiplier</code></pre> </div> </div> <div class="paragraph"> <p>To store the script in the script cache, use the following Hot Rod code:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; scriptCache = cacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">___script_cache</span><span class="delimiter">&quot;</span></span>);
scriptCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>,
  <span class="string"><span class="delimiter">&quot;</span><span class="content">// mode=local,language=javascript</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
  <span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand * multiplier</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> </div> </div> </div> <div class="sect2"> <h3 id="running_scripts_with_the_hot_rod_java_client"><a class="anchor" href="#running_scripts_with_the_hot_rod_java_client"></a>5.3. Running Scripts with the Hot Rod Java Client</h3> <div class="paragraph"> <p>The following example shows how to invoke the above script by passing two named parameters.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; cache = cacheManager.getCache();
<span class="comment">// Create the parameters for script execution</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand</span><span class="delimiter">&quot;</span></span>, <span class="integer">10</span>);
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplier</span><span class="delimiter">&quot;</span></span>, <span class="integer">20</span>);
<span class="comment">// Run the script on the server, passing in the parameters</span>
<span class="predefined-type">Object</span> result = cache.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>, params);</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="distributed_script_execution"><a class="anchor" href="#distributed_script_execution"></a>5.4. Distributed Script Execution</h3> <div class="paragraph"> <p>The following is a script which runs on all nodes. Each node will return its address, and the results from all nodes will be collected in a List and returned to the client.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode:distributed,language=javascript</span>
cacheManager.getAddress().toString();</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_health"><a class="anchor" href="#server_health"></a>6. Monitoring Server Health</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="health_monitoring"><a class="anchor" href="#health_monitoring"></a>6.1. Health Monitoring</h3> <div class="paragraph"> <p>Infinispan server has special endpoints for monitoring cluster health. The API is exposed via:</p> </div> <div class="ulist"> <ul> <li> <p>Programmatically (using <code>embeddedCacheManager.getHealth()</code>)</p> </li> <li> <p>JMX</p> </li> <li> <p>CLI</p> </li> <li> <p>REST (using <a href="https://docs.jboss.org/author/display/WFLY10/The+HTTP+management+API">WildFly HTTP Management API</a>)</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="accessing_health_api_using_jmx"><a class="anchor" href="#accessing_health_api_using_jmx"></a>6.2. Accessing Health API using JMX</h3> <div class="paragraph"> <p>At first you need to connect to the Infinispan Server using JMX (use JConsole or other tool for this). Next, navigate to object name <code>jboss.datagrid-infinispan:type=CacheManager,name="clustered",component=CacheContainerHealth</code>.</p> </div> </div> <div class="sect2"> <h3 id="accessing_health_api_using_cli"><a class="anchor" href="#accessing_health_api_using_cli"></a>6.3. Accessing Health API using CLI</h3> <div class="paragraph"> <p>You can access the Health API from the Command Line Interface (CLI), as in the following examples:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">Standalone</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh -c "/subsystem=datagrid-infinispan/cache-container=clustered/health=HEALTH:read-resource(include-runtime=true)"</code></pre> </div> </div> </dd> <dt class="hdlist1">Domain Mode</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh -c "/host=master/server=${servername}/subsystem=datagrid-infinispan/cache-container=clustered/health=HEALTH:read-resource(include-runtime=true)"</code></pre> </div> </div> <div class="paragraph"> <p>Where <code>${servername}</code> is the name of the Infinispan server instance.</p> </div> </dd> </dl> </div> <div class="paragraph"> <p>The following is a sample result for the CLI invocation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "cache-health" =&gt; "HEALTHY",
        "cluster-health" =&gt; ["test"],
        "cluster-name" =&gt; "clustered",
        "free-memory" =&gt; 99958L,
        "log-tail" =&gt; [
            "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-5) DGENDPT10001: HotRodServer listening on 127.0.0.1:11222",
            "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-1) DGENDPT10001: MemcachedServer listening on 127.0.0.1:11211",
            "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___protobuf_metadata cache from clustered container",
            "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___script_cache cache from clustered container",
            "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-5) DGISPN0001: Started ___hotRodTopologyCache cache from clustered container",
            "&lt;time_stamp&gt; INFO  [org.infinispan.rest.NettyRestServer] (MSC service thread 1-6) ISPN012003: REST server starting, listening on 127.0.0.1:8080",
            "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-6) DGENDPT10002: REST mapped to /rest",
            "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management",
            "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990",
            "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: Infinispan Server &lt;build_version&gt; (WildFly Core &lt;build_version&gt;) started in 8681ms - Started 196 of 237 services (121 services are lazy, passive or on-demand)"
        ],
        "number-of-cpus" =&gt; 8,
        "number-of-nodes" =&gt; 1,
        "total-memory" =&gt; 235520L
    }
}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="accessing_health_api_using_rest"><a class="anchor" href="#accessing_health_api_using_rest"></a>6.4. Accessing Health API using REST</h3> <div class="paragraph"> <p>The REST interface lets you access the same set of resources as the CLI. However, the HTTP Management API requires authentication so you must first add credentials with the <code>add-user.sh</code> script.</p> </div> <div class="paragraph"> <p>After you set up credentials, access the Health API via REST as in the following examples:</p> </div> <div class="dlist"> <dl> <dt class="hdlist1">Standalone</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">$ curl --digest -L -D - &quot;http://localhost:9990/management/subsystem/datagrid-infinispan/cache-container/clustered/health/HEALTH?operation=resource&amp;include-runtime=true&amp;json.pretty=1&quot; --header &quot;Content-Type: application/json&quot; -u username:password</code></pre> </div> </div> </dd> <dt class="hdlist1">Domain Mode</dt> <dd> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">$ curl --digest -L -D - &quot;http://localhost:9990/management/host/master/server/${servername}/subsystem/datagrid-infinispan/cache-container/clustered/health/HEALTH?operation=resource&amp;include-runtime=true&amp;json.pretty=1&quot; --header &quot;Content-Type: application/json&quot; -u username:password</code></pre> </div> </div> <div class="paragraph"> <p>Where <code>${servername}</code> is the name of the Infinispan server instance.</p> </div> </dd> </dl> </div> <div class="paragraph"> <p>The following is a sample result for the REST invocation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code>HTTP/1.1 200 OK
Connection: keep-alive
Authentication-Info: nextnonce="AuZzFxz7uC4NMTQ3MDgyNTU1NTQ3OCfIJBHXVpPHPBdzGUy7Qts=",qop="auth",rspauth="b518c3170e627bd732055c382ce5d970",cnonce="NGViOWM0NDY5OGJmNjY0MjcyOWE4NDkyZDU3YzNhYjY=",nc=00000001
Content-Type: application/json; charset=utf-8
Content-Length: 1927
Date: &lt;time_stamp&gt;

{
    "cache-health" : "HEALTHY",
    "cluster-health" : ["test", "HEALTHY"],
    "cluster-name" : "clustered",
    "free-memory" : 96778,
    "log-tail" : [
        "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-5) DGENDPT10001: HotRodServer listening on 127.0.0.1:11222",
        "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-1) DGENDPT10001: MemcachedServer listening on 127.0.0.1:11211",
        "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___protobuf_metadata cache from clustered container",
        "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___script_cache cache from clustered container",
        "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-5) DGISPN0001: Started ___hotRodTopologyCache cache from clustered container",
        "&lt;time_stamp&gt; INFO  [org.infinispan.rest.NettyRestServer] (MSC service thread 1-6) ISPN012003: REST server starting, listening on 127.0.0.1:8080",
        "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-6) DGENDPT10002: REST mapped to /rest",
        "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management",
        "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990",
        "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: Infinispan Server &lt;build_version&gt; (WildFly Core &lt;build_version&gt;) started in 8681ms - Started 196 of 237 services (121 services are lazy, passive or on-demand)"
    ],
    "number-of-cpus" : 8,
    "number-of-nodes" : 1,
    "total-memory" : 235520
}%</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_multitenancy"><a class="anchor" href="#server_multitenancy"></a>7. Multitenancy</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="multi_tenancy"><a class="anchor" href="#multi_tenancy"></a>7.1. Multi-tenancy</h3> <div class="paragraph"> <p>Multi-tenancy allows accessing multiple containers as shown below:</p> </div> <div class="imageblock"> <div class="content"> <img src="./../../topics/images/multi-tenancy.png" alt="multi tenancy"> </div> </div> <div class="paragraph"> <p>Currently there are two supported protocols for accessing the data - using Hot Rod client and using REST interface.</p> </div> </div> <div class="sect2"> <h3 id="multi_tenancy_with_rest"><a class="anchor" href="#multi_tenancy_with_rest"></a>7.2. Multi-tenancy with REST</h3> <div class="paragraph"> <p>Multi-tenancy router uses URL prefixes to separate containers using the following template: <code><a href="https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/&lt;rest_connector_name&gt;/&lt;cache_name&gt;/&lt;key&gt" class="bare">https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/&lt;rest_connector_name&gt;/&lt;cache_name&gt;/&lt;key&gt</a>;</code>. All HTTP operations remain exactly the same as using standard <code>rest-connector</code>.</p> </div> <div class="paragraph"> <p>The REST connector by default support both HTTP/1.1 and HTTP/2 protocols. The switching from HTTP/1.1 to HTTP/2 procedure involves either using TLS/ALPN negotiation or HTTP/1.1 upgrade procedure. The former requires proper encryption to be enabled. The latter is always enabled.</p> </div> </div> <div class="sect2"> <h3 id="multi_tenancy_with_hot_rod"><a class="anchor" href="#multi_tenancy_with_hot_rod"></a>7.3. Multi-tenancy with Hot Rod</h3> <div class="paragraph"> <p>Multi-tenant routing for binary protocols requires using a standard, transport layer mechanism such as <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">SSL/TLS Server Name Indication</a>. The server needs to be configured to support encryption and additional SNI routing needs to be added to the <code>router-connector</code>.</p> </div> <div class="paragraph"> <p>In order to connect to a secured Hot Rod server, the client needs to use configuration similar to this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(hotrodServer.getPort())
     .security()
        .ssl()
           .enabled(sslClient)
           .sniHostName(<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span>) <span class="comment">// SNI Host Name</span>
           .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore.jks</span><span class="delimiter">&quot;</span></span>)
           .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray());
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="multi_tenant_router"><a class="anchor" href="#multi_tenant_router"></a>7.4. Multi-tenant router</h3> <div class="paragraph"> <p>The Multi-tenant router endpoint works as a facade for one or more REST/Hot Rod connectors. Its main purpose is to forward client requests into proper container.</p> </div> <div class="paragraph"> <p>In order to properly configure the routing, <code>socket-binding</code> attributes of other connectors must be disabled and additional attribute <code>name</code> must be used as shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The next step is to add a new <code>router-connector</code> endpoint and configure how other containers will be accessed. Note that Hot Rod connectors require using TLS/SNI and REST connectors require using prefix in the URL:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;router-connector</span> <span class="attribute-name">hotrod-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rest-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keep-alive</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tcp-nodelay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">receive-buffer-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">send-buffer-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLRealm1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hotrod&gt;</span>
    <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-2</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLRealm2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hotrod&gt;</span>
    <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;prefix</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-1</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest&gt;</span>
    <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;prefix</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest&gt;</span>
<span class="tag">&lt;/router-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>With the following configuration, Hot Rod clients will access <code>hotrod-1</code> connector when using SNI Host Name "hotrod-1". REST clients will need to use the following URL to access "rest-1" connector - <code><a href="https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/rest-1" class="bare">https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/rest-1</a></code>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="server_single_port"><a class="anchor" href="#server_single_port"></a>8. Single Port</h2> <div class="sectionbody"> <div class="paragraph"> <p>Single-Port is a special type of router connector which allows exposing multiple protocols over the same TCP port. This approach is very convenient because it reduces the number of ports required by a server, with advantages in security, configuration and management. Protocol switching is handled in three ways:</p> </div> <div class="ulist"> <ul> <li> <p><strong>HTTP/1.1 Upgrade header</strong>: initiate an HTTP/1.1 connection and send an <code>Upgrade: protocol</code> header where protocol is the name assigned to the desired endpoint.</p> </li> <li> <p><strong>TLS/ALPN</strong>: protocol selection is performed based on the SNI specified by the client.</p> </li> <li> <p><strong>Hot Rod header detection</strong>: if a Hot Rod endpoint is present in the router configuration, then any attempt to send a Hot Rod header will be detected and the protocol will be switched automatically.</p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>The initial implementation supports only HTTP/1.1, HTTP/2 and Hot Rod protocols. The Memcached protocol is not supported.</p> </div> </td> </tr> </table> </div> <div class="sect2"> <h3 id="single_port_router"><a class="anchor" href="#single_port_router"></a>8.1. Single-Port router</h3> <div class="paragraph"> <p>Internally, Single-Port is based on the same router component used to enable multi-tenancy, and therefore it shares the same configuration.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- TLS/ALPN negotiation --&gt;</span>
<span class="tag">&lt;router-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">router-ssl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">single-port-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-ssl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;single-port</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLRealm1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/single-port&gt;</span>
<span class="tag">&lt;/router-connector&gt;</span>
<span class="comment">&lt;!-- HTTP 1.1/Upgrade procedure --&gt;</span>
<span class="tag">&lt;router-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">router</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">single-port-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;single-port&gt;</span>
        <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/single-port&gt;</span>
<span class="tag">&lt;/router-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>With the configuration above, the Single-Port Router will operate on <code>rest</code> and <code>rest-ssl</code> socket bindings. The router named <code>router</code> should typically operate on port <code>8080</code> and will use HTTP/1.1 Upgrade (also known as <em>cleartext upgrade</em>) procedure. The other router instance (called <code>router-ssl</code>) should typically operate on port <code>8443</code> and will use TLS/ALPN.</p> </div> <div class="sect3"> <h4 id="testing_the_single_port_router"><a class="anchor" href="#testing_the_single_port_router"></a>8.1.1. Testing the Single-Port router</h4> <div class="paragraph"> <p>A tool such as <code>curl</code> can be used to access cache using both <em>cleartext upgrade</em> or TLS/ALPN. Here&#8217;s an example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">$ curl -v -k --http2-prior-knowledge https://127.0.0.1:8443/rest/default/test</code></pre> </div> </div> <div class="paragraph"> <p>The <code>--http2-prior-knowledge</code> can be exchanged with <code>--http2</code> switch allowing to control how the switch procedure is being done (via Plain-Text Upgrade or TLS/ALPN).</p> </div> </div> </div> <div class="sect2"> <h3 id="hot_rod_protocol_detection"><a class="anchor" href="#hot_rod_protocol_detection"></a>8.2. Hot Rod Protocol Detection</h3> <div class="paragraph"> <p>The single-port router has built-in automatic detection of Hot Rod messages which trigger a transparent "upgrade" to the Hot Rod protocol. This means that no changes are required on the client side to connect to a single-port endpoint. It also means that older clients will also be able to function seamlessly.</p> </div> <div class="sect3"> <h4 id="tlsalpn_protocol_selection"><a class="anchor" href="#tlsalpn_protocol_selection"></a>8.2.1. TLS/ALPN protocol selection</h4> <div class="paragraph"> <p>Another supported way to select the protocol is to use TLS/ALPN which uses the <a href="https://tools.ietf.org/html/rfc7301">Application-Layer Protocol Negotiation</a> spec. This feature requires that you have configured your endpoint to enable TLS.</p> </div> <div class="sect4"> <h5 id="enabling_alpn"><a class="anchor" href="#enabling_alpn"></a>Enabling ALPN</h5> <div class="paragraph"> <p>If you are using JDK 9 or greater, ALPN is supported by default. However, if you are using JDK 8, you will need to use <a href="https://netty.io/wiki/forked-tomcat-native.html">Netty&#8217;s BoringSSL</a> library, which leverages native libraries to enable ALPN.</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Add Netty dependencies.</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
      <span class="tag">&lt;dependency&gt;</span>
         <span class="tag">&lt;groupId&gt;</span>io.netty<span class="tag">&lt;/groupId&gt;</span>
         <span class="tag">&lt;artifactId&gt;</span>netty-bom<span class="tag">&lt;/artifactId&gt;</span>
         <span class="comment">&lt;!-- Pulled from Infinispan BOM --&gt;</span>
         <span class="tag">&lt;version&gt;</span>${version.netty}<span class="tag">&lt;/version&gt;</span>
         <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
         <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
      <span class="tag">&lt;/dependency&gt;</span>
   <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>io.netty<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>netty-tcnative-boringssl-static<span class="tag">&lt;/artifactId&gt;</span>
   <span class="comment">&lt;!-- The version is defined in Netty BOM --&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> </li> <li> <p>Configure your trust store accordingly:</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder()
      .addServers(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1:8443</span><span class="delimiter">&quot;</span></span>);

builder.security().ssl().enable()
      .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore.pkcs12</span><span class="delimiter">&quot;</span></span>)
      .trustStorePassword(DEFAULT_TRUSTSTORE_PASSWORD.toCharArray());

RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="string"><span class="delimiter">&quot;</span><span class="content">);</span></span></code></pre> </div> </div> </li> </ol> </div> </div> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2019-09-15 07:35:22 UTC </div> </div> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script> <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script> </body> </html>