<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Marshalling and Encoding Data</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Marshalling and Encoding Data</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#cache-encoding">1. Configuring cache encoding</a>
<ul class="sectlevel2">
<li><a href="#encoding">1.1. Cache encoding</a></li>
<li><a href="#protobuf-encoding_storage-formats">1.2. Protobuf cache encoding</a>
<ul class="sectlevel3">
<li><a href="#encoding-caches-protostream_storage-formats">1.2.1. Encoding caches as ProtoStream</a></li>
</ul>
</li>
<li><a href="#text-encoding_storage-formats">1.3. Text-based cache encoding</a>
<ul class="sectlevel3">
<li><a href="#clients-text-encoding_storage-formats">1.3.1. Clients and text-based encoding</a></li>
</ul>
</li>
<li><a href="#marshalled-object-encoding_storage-formats">1.4. Marshalled Java objects</a>
<ul class="sectlevel3">
<li><a href="#clients-marshalled-objects_storage-formats">1.4.1. Clients and marshalled objects</a></li>
</ul>
</li>
<li><a href="#unmarshalled-object-encoding_storage-formats">1.5. Plain Old Java Objects (POJO)</a>
<ul class="sectlevel3">
<li><a href="#clients-unmarshalled-objects_storage-formats">1.5.1. Clients and POJOs</a></li>
</ul>
</li>
<li><a href="#adding-jars-server-classpath_storage-formats">1.6. Adding JARs to Infinispan Server installations</a></li>
<li><a href="#memcached-encoding_storage-formats">1.7. Configuring cache encoding for Memcached clients</a></li>
</ul>
</li>
<li><a href="#marshalling_user_types">2. Marshalling custom objects with ProtoStream</a>
<ul class="sectlevel2">
<li><a href="#protostream_marshalling">2.1. ProtoStream marshalling</a>
<ul class="sectlevel3">
<li><a href="#protostream-types_marshalling">2.1.1. ProtoStream types</a></li>
<li><a href="#protostream-annotations_marshalling">2.1.2. ProtoStream annotations</a></li>
</ul>
</li>
<li><a href="#protostream-sci-implementations_marshalling">2.2. Creating serialization context initializers</a>
<ul class="sectlevel3">
<li><a href="#adding-protostream-processor_marshalling">2.2.1. Adding the ProtoStream processor</a></li>
<li><a href="#adding-protostream-annotations_marshalling">2.2.2. Adding ProtoStream annotations to Java classes</a></li>
<li><a href="#creating-protostream-adapter_marshalling">2.2.3. Creating ProtoStream adapter classes</a></li>
<li><a href="#annotating-autoprotoschemabuilder_marshalling">2.2.4. Generating serialization context initializers</a></li>
<li><a href="#registering-sci-embedded-caches_marshalling">2.2.5. Registering serialization context initializers</a></li>
<li><a href="#registering-sci-remote-caches_marshalling">2.2.6. Registering Protobuf schemas with Infinispan Server</a></li>
<li><a href="#protostream-sci-manual_marshalling">2.2.7. Manual serialization context initializer implementations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#alternative-marshallers">3. Using alternative and custom marshaller implementations</a>
<ul class="sectlevel2">
<li><a href="#adding-deserialization-allowlist_marshaller-implementations">3.1. Allowing deserialization of Java classes</a></li>
<li><a href="#using-jboss-marshaller_marshaller-implementations">3.2. Using JBoss Marshalling</a></li>
<li><a href="#using-java-serialization_marshaller-implementations">3.3. Using Java serialization</a></li>
<li><a href="#using-custom-marshallers_marshaller-implementations">3.4. Using custom marshallers</a></li>
</ul>
</li>
<li><a href="#data-conversion">4. Data conversion</a>
<ul class="sectlevel2">
<li><a href="#hotrod-data-format_transcoding">4.1. Hot Rod DataFormat API</a></li>
<li><a href="#converting-data-on-demand_transcoding">4.2. Converting data on demand with embedded caches</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan caches can store keys and values in different encodings.
This document describes how Infinispan encodes data for remote and embedded caches and explains how to use various media types with your applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cache-encoding"><a class="anchor" href="#cache-encoding"></a>1. Configuring cache encoding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Find out how to configure Infinispan caches with different media types and how encoding affects the ways you can use Infinispan.</p>
</div>
<div class="sect2">
<h3 id="encoding"><a class="anchor" href="#encoding"></a>1.1. Cache encoding</h3>
<div class="paragraph">
<p>Encoding is the format, identified by a media type, that Infinispan uses to store entries (key/value pairs) in caches.</p>
</div>
<h4 id="remote_caches" class="discrete">Remote caches</h4>
<div class="paragraph">
<p>Infinispan Server stores entries in remote caches with the encoding that is set in the cache configuration.</p>
</div>
<div class="paragraph">
<p>Hot Rod and REST clients include a media type with each request they make to Infinispan Server.
To handle multiple clients making read and write requests with different media types, Infinispan Server converts data on-demand to and from the media type that is set in the cache configuration.</p>
</div>
<div class="paragraph">
<p>If the remote cache does not have any encoding configuration, Infinispan Server stores keys and values as generic <code>byte[]</code> without any media type information, which can lead to unexpected results when converting data for clients request different formats.</p>
</div>
<div class="paragraph">
<div class="title">Use ProtoStream encoding</div>
<p>Infinispan Server returns an error when client requests include a media type that it cannot convert to or from the media type that is set in the cache configuration.</p>
</div>
<div class="paragraph">
<p>Infinispan recommends always configuring cache encoding with the <code>application/x-protostream</code> media type if you want to use multiple clients, such as Infinispan Console or CLI, Hot Rod, or REST.
ProtoStream encoding also lets you use server-side tasks and perform indexed queries on remote caches.</p>
</div>
<h4 id="embedded_caches" class="discrete">Embedded caches</h4>
<div class="paragraph">
<p>Infinispan stores entries in embedded caches as Plain Old Java Objects (POJOs) by default.</p>
</div>
<div class="paragraph">
<p>For clustered embedded caches, Infinispan needs to marshall any POJOs to a byte array that can be replicated between nodes and then unmarshalled back into POJOs.
This means you must ensure that Infinispan can serialize your POJOs with the ProtoStream marshaller if you do not configure another marshaller.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you store mutable POJOs in embedded caches, you should always update values using new POJO instances.
For example, if you store a <code>HashMap</code> as a key/value pair, the other members of the Infinispan cluster do not see any local modifications to the Map.
Additionally, it is possible that a <code>ConcurrentModificationException</code> could occur if the Map instance is updated at the same time that Infinispan is marshalling the object.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final">Infinispan ProtoStream API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="protobuf-encoding_storage-formats"><a class="anchor" href="#protobuf-encoding_storage-formats"></a>1.2. Protobuf cache encoding</h3>
<div class="paragraph">
<p>Protocol Buffers (Protobuf) is a lightweight binary media type for structured data.
As a cache encoding, Protobuf gives you excellent performance as well as interoperability between client applications in different programming languages for both Hot Rod and REST endpoints.</p>
</div>
<div class="paragraph">
<p>Infinispan uses a ProtoStream library to encode caches as Protobuf with the <code>application/x-protostream</code> media type.</p>
</div>
<div class="paragraph">
<p>The following example shows a Protobuf message that describes a <code>Person</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json"><span class="error">m</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">a</span><span class="error">g</span><span class="error">e</span> <span class="error">P</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">o</span><span class="error">n</span> {
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">i</span><span class="error">n</span><span class="error">t</span><span class="integer">32</span> <span class="error">i</span><span class="error">d</span> <span class="error">=</span> <span class="integer">1</span><span class="error">;</span>
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">=</span> <span class="integer">2</span><span class="error">;</span>
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">s</span><span class="error">u</span><span class="error">r</span><span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">=</span> <span class="integer">3</span><span class="error">;</span>
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">A</span><span class="error">d</span><span class="error">d</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">s</span> <span class="error">a</span><span class="error">d</span><span class="error">d</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">s</span> <span class="error">=</span> <span class="integer">4</span><span class="error">;</span>
    <span class="error">r</span><span class="error">e</span><span class="error">p</span><span class="error">e</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="error">d</span> <span class="error">P</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">N</span><span class="error">u</span><span class="error">m</span><span class="error">b</span><span class="error">e</span><span class="error">r</span> <span class="error">p</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">N</span><span class="error">u</span><span class="error">m</span><span class="error">b</span><span class="error">e</span><span class="error">r</span><span class="error">s</span> <span class="error">=</span> <span class="integer">5</span><span class="error">;</span>
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">u</span><span class="error">i</span><span class="error">n</span><span class="error">t</span><span class="integer">32</span> <span class="error">a</span><span class="error">g</span><span class="error">e</span> <span class="error">=</span> <span class="integer">6</span><span class="error">;</span>
    <span class="error">e</span><span class="error">n</span><span class="error">u</span><span class="error">m</span> <span class="error">G</span><span class="error">e</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">r</span> {
        <span class="error">M</span><span class="error">A</span><span class="error">L</span><span class="error">E</span> <span class="error">=</span> <span class="integer">0</span><span class="error">;</span>
        <span class="error">F</span><span class="error">E</span><span class="error">M</span><span class="error">A</span><span class="error">L</span><span class="error">E</span> <span class="error">=</span> <span class="integer">1</span><span class="error">;</span>
    }
}</code></pre>
</div>
</div>
<h4 id="interoperability" class="discrete">Interoperability</h4>
<div class="paragraph">
<p>Because it is language neutral, Protobuf encoding means Infinispan can handle requests from client applications written in Java, C++, C#, Python, Go, and more.</p>
</div>
<div class="paragraph">
<p>Protobuf also enables clients on different remote endpoints, Hot Rod or REST, to operate on the same data.
Because it uses the REST API, you can access and work with Protobuf-encoded caches through Infinispan Console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot use Infinispan Console with any binary encoding other than <code>application/x-protostream</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="queries" class="discrete">Queries</h4>
<div class="paragraph">
<p>Infinispan needs a structured representation of data in caches for fast and reliable queries.
To search caches with the Ickle query language, you register Protobuf schema that describe your objects.</p>
</div>
<h4 id="custom_types" class="discrete">Custom types</h4>
<div class="paragraph">
<p>Infinispan includes an implementation of the ProtoStream API with native support for frequently used types, including <code>String</code> and <code>Integer</code>.
If you want to store custom types in your caches, use ProtoStream marshalling to generate and register serialization contexts with Infinispan so that it can marshall your objects.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final">Infinispan ProtoStream API</a></p>
</li>
<li>
<p><a href="https://developers.google.com/protocol-buffers/">developers.google.com/protocol-buffers</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="encoding-caches-protostream_storage-formats"><a class="anchor" href="#encoding-caches-protostream_storage-formats"></a>1.2.1. Encoding caches as ProtoStream</h4>
<div class="paragraph">
<p>Configure Infinispan to use the ProtoStream library to store cache entries as Protocol Buffers (Protobuf).</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Specify the <code>application/x-protostream</code> media type for keys and values.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;encoding&gt;</span>
      <span class="tag">&lt;key</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;value</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/encoding&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">//Create cache configuration that encodes keys and values as ProtoStream</span>
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.clustering().cacheMode(CacheMode.DIST_SYNC)
       .encoding().key().mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span>)
       .encoding().value().mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can use the same encoding for keys and values:</p>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;encoding</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">.encoding().mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan Schema Reference</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/cache/ConfigurationBuilder.html">org.infinispan.configuration.cache.ConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="text-encoding_storage-formats"><a class="anchor" href="#text-encoding_storage-formats"></a>1.3. Text-based cache encoding</h3>
<div class="paragraph">
<p>Text-based encoding is human-readable content such as plain text.
The classic "Hello World" example entry could be stored in a cache as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="text">key=hello
value=world</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encode caches with the <code>text/plain</code> media type, Infinispan can convert to and from the following media types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application/xml</code></p>
</li>
<li>
<p><code>application/json</code></p>
</li>
<li>
<p><code>application/x-protostream</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example configuration encodes keys and values with the <code>text/plain; charset=UTF-8</code> media type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;encoding&gt;</span>
      <span class="tag">&lt;key</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain; charset=UTF-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;value</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain; charset=UTF-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/encoding&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="clients-text-encoding_storage-formats"><a class="anchor" href="#clients-text-encoding_storage-formats"></a>1.3.1. Clients and text-based encoding</h4>
<div class="paragraph">
<p>If you configure encoding to store keys and values with a text-based media type, then you also need to configure clients to operate on those caches.</p>
</div>
<h5 id="hot_rod_clients" class="discrete">Hot Rod clients</h5>
<div class="paragraph">
<p>Infinispan uses the ProtoStream library to handle <code>String</code> and <code>byte[]</code> types natively.
If you configure cache encoding with the <code>text/plain</code> media type, Hot Rod clients might not necessarily require any marshaller configuration to perform cache operations.</p>
</div>
<div class="paragraph">
<p>For other text-based media types, such as JSON or XML, Hot Rod clients can use the <code>org.infinispan.commons.marshall.UTF8StringMarshaller</code> marshaller that converts to and from the <code>text/plain</code> media type.</p>
</div>
<h5 id="rest_clients" class="discrete">REST clients</h5>
<div class="paragraph">
<p>REST clients must include the media type for caches in the request headers.</p>
</div>
<div class="paragraph">
<p>For example if you configure cache encoding as <code>text/plain; charset=UTF-8</code> then REST clients should send the following headers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Accept: text/plain; charset=UTF-8</code> for read operations.</p>
</li>
<li>
<p><code>Content-Type: text/plain; charset=UTF-8</code> or <code>Key-Content-Type: text/plain; charset=UTF-8</code> for write operations.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/commons/marshall/UTF8StringMarshaller.html">org.infinispan.commons.marshall.UTF8StringMarshaller</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="marshalled-object-encoding_storage-formats"><a class="anchor" href="#marshalled-object-encoding_storage-formats"></a>1.4. Marshalled Java objects</h3>
<div class="paragraph">
<p>Infinispan stores marshalled Java objects in caches as byte arrays.
For example, the following is a simple representation of a <code>Person</code> object stored as a value in memory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="text">value=[61 6c 61 6e 0a 70 61 72 74 72 69 64 67 65]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store marshalled objects in caches, you should use the ProtoStream marshaller unless a strict requirement exists.
For example, when migrating client applications from older versions of Infinispan, you might need to temporarily use JBoss marshalling with your Hot Rod Java clients.</p>
</div>
<div class="paragraph">
<p>Infinispan stores marshalled Java objects as byte arrays with the following media types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application/x-protostream</code></p>
</li>
<li>
<p><code>application/x-jboss-marshalling</code></p>
</li>
<li>
<p><code>application/x-java-serialized-object</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When storing unmarshalled Java objects, Infinispan uses the object implementation of <code>equals()</code> and <code>hashCode()</code>.
When storing marshalled objects, the marshalled bytes are compared for equality and hashed instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="clients-marshalled-objects_storage-formats"><a class="anchor" href="#clients-marshalled-objects_storage-formats"></a>1.4.1. Clients and marshalled objects</h4>
<div class="paragraph">
<p>When you configure Hot Rod Java clients to use a marshaller, you must configure your cache with the encoding for that marshaller.</p>
</div>
<div class="paragraph">
<p>Each marshaller uses a different media type to produce <code>byte[]</code> content that the client can transmit to Infinispan Server.
When reading from the server, the client marshaller performs the opposite operation, using the media type to produce data from <code>byte[]</code> content.</p>
</div>
<div class="paragraph">
<p>Your cache encoding must be compatible with the Hot Rod client marshaller.
For example, if you configure a cache encoding as <code>application/x-protostream</code>, you can use the ProtoStream marshaller with your clients to operate on that cache.
However if the client marshaller uses an encoding that Infinispan cannot convert to and from <code>application/x-protostream</code>, Infinispan throws an error message.</p>
</div>
<div class="paragraph">
<p>If you use <code>JavaSerializationMarshaller</code> or <code>GenericJBossMarshaller</code> you should encode caches with the <code>application/x-java-serialized-object</code> or <code>application/x-jboss-marshalling</code> media type, respectively.</p>
</div>
<div class="paragraph">
<div class="title">ProtoStream to JSON conversion</div>
<p>Infinispan converts keys and values encoded with the <code>application/x-protostream</code> media type to <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>This allows REST clients to include the JSON media type in request headers and perform operations on caches that use ProtoStream encoding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Accept: application/json</code> for read operations.</p>
</li>
<li>
<p><code>Content-Type: application/json</code> for write operations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unmarshalled-object-encoding_storage-formats"><a class="anchor" href="#unmarshalled-object-encoding_storage-formats"></a>1.5. Plain Old Java Objects (POJO)</h3>
<div class="paragraph">
<p>For best performance, Infinispan recommends storing unmarshalled POJOs in embedded caches only.
However, you can configure keys and values with the following media type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application/x-java-object</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="clients-unmarshalled-objects_storage-formats"><a class="anchor" href="#clients-unmarshalled-objects_storage-formats"></a>1.5.1. Clients and POJOs</h4>
<div class="paragraph">
<p>Even though Infinispan does not recommend doing so, clients can operate on caches that store unmarshalled POJOs with the <code>application/x-java-object</code> media type.</p>
</div>
<h5 id="hot_rod_clients_2" class="discrete">Hot Rod clients</h5>
<div class="paragraph">
<p>Hot Rod client marshallers must be available to Infinispan Server so it can deserialize your Java objects.
By default, the ProtoStream and Java Serialization marshallers are available on the server.</p>
</div>
<h5 id="rest_clients_2" class="discrete">REST clients</h5>
<div class="paragraph">
<p>REST clients must use either JSON or XML for keys and values so Infinispan can convert to and from POJOs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan requires you to add Java classes to the deserialization allowlist to convert XML to and from POJOs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-jars-server-classpath_storage-formats"><a class="anchor" href="#adding-jars-server-classpath_storage-formats"></a>1.6. Adding JARs to Infinispan Server installations</h3>
<div class="paragraph">
<p>Make custom JAR files available to Infinispan Server by adding them to the classpath.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Infinispan loads JAR files during startup only.</p>
<div class="paragraph">
<p>You should bring all nodes in the cluster down gracefully and make any JAR files available to each node before bringing the cluster back up.</p>
</div>
</li>
<li>
<p>You should add custom JAR files to the <code>$ISPN_HOME/server/lib</code> directory only.</p>
<div class="paragraph">
<p>The <code>$ISPN_HOME/lib</code> directory is reserved for Infinispan JAR files.</p>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Stop Infinispan Server if it is running.</p>
</li>
<li>
<p>Add JAR files to the <code>server/lib</code> directory, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>├── server
│   └── lib
│       └── UserObjects.jar</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="memcached-encoding_storage-formats"><a class="anchor" href="#memcached-encoding_storage-formats"></a>1.7. Configuring cache encoding for Memcached clients</h3>
<div class="paragraph">
<p>Infinispan Server disables the Memcached endpoint by default.
If you enable the Memcached endpoint, you should configure your Memcached cache with a suitable encoding.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Memcached endpoint does not support authentication. For security purposes
you should use dedicated caches for Memcached clients. You should not use REST
or Hot Rod clients to interact on the same data set as Memcached clients.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure cache encoding for keys and values as appropriate.</p>
</li>
<li>
<p>Specify any appropriate media type for values.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;encoding&gt;</span>
    <span class="tag">&lt;key</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;value</span> <span class="attribute-name">media-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/encoding&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Encoding</div>
<p>The Memcached endpoint includes a <code>client-encoding</code> attribute that converts the
encoding of values.</p>
</div>
<div class="paragraph">
<p>For example, as in the preceding configuration example, you store values
encoded as Protobuf. If you want Memcached clients to read and write values as
JSON, you can use the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;memcached-connector</span> <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcachedCache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">client-encoding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../memcached/memcached.html">Infinispan Memcached Client Guide</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="marshalling_user_types"><a class="anchor" href="#marshalling_user_types"></a>2. Marshalling custom objects with ProtoStream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Marshalling is a process that converts Java objects into a binary format that can be transferred across the network or stored to disk.
The reverse process, unmarshalling, transforms data from a binary format back into Java objects.</p>
</div>
<div class="paragraph">
<p>Infinispan performs marshalling and unmarshalling to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Send data to other Infinispan nodes in a cluster.</p>
</li>
<li>
<p>Store data in persistent cache stores.</p>
</li>
<li>
<p>Transmit objects between clients and remote caches.</p>
</li>
<li>
<p>Store objects in native memory outside the JVM heap.</p>
</li>
<li>
<p>Store objects in JVM heap memory when the cache encoding is not <code>application/x-java-object</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When storing custom objects in Infinispan caches, you should use Protobuf-based marshalling with the ProtoStream marshaller.</p>
</div>
<div class="sect2">
<h3 id="protostream_marshalling"><a class="anchor" href="#protostream_marshalling"></a>2.1. ProtoStream marshalling</h3>
<div class="paragraph">
<p>Infinispan provides the ProtoStream API so you can marshall Java objects as Protocol Buffers (Protobuf).</p>
</div>
<div class="paragraph">
<p>ProtoStream natively supports many different Java data types, which means you do not need to configure ProtoStream marshalling for those types.
For custom or user types, you need to provide some information so that Infinispan can marshall those objects to and from your caches.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>SerializationContext</code></dt>
<dd>
<p>A repository that contains Protobuf type definitions, loaded from Protobuf schemas (<code>.proto</code> files), and the accompanying marshallers.</p>
</dd>
<dt class="hdlist1"><code>SerializationContextInitializer</code></dt>
<dd>
<p>An interface that initializes a <code>SerializationContext</code>.</p>
</dd>
</dl>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/SerializationContext.html">org.infinispan.protostream.SerializationContext</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/SerializationContextInitializer.html">org.infinispan.protostream.SerializationContextInitializer</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="protostream-types_marshalling"><a class="anchor" href="#protostream-types_marshalling"></a>2.1.1. ProtoStream types</h4>
<div class="paragraph">
<p>Infinispan uses a ProtoStream library that can handle the following types for keys and values, as well as the unboxed equivalents in the case of primitive types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>byte[]</code></p>
</li>
<li>
<p><code>Byte</code></p>
</li>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>Integer</code></p>
</li>
<li>
<p><code>Long</code></p>
</li>
<li>
<p><code>Double</code></p>
</li>
<li>
<p><code>Float</code></p>
</li>
<li>
<p><code>Boolean</code></p>
</li>
<li>
<p><code>Short</code></p>
</li>
<li>
<p><code>Character</code></p>
</li>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.time.Instant</code></p>
</li>
</ul>
</div>
<h5 id="additional_type_collections" class="discrete">Additional type collections</h5>
<div class="paragraph">
<p>The ProtoStream library includes several adapter classes for common Java types, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
<li>
<p><code>java.util.UUID</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan provides all adapter classes for some common JDK classes in the <code>protostream-types</code> artifact, which is included in the <code>infinispan-core</code> and <code>infinispan-client-hotrod</code> dependencies.
You do not need any configuration to store adapter classes as keys or values.</p>
</div>
<div class="paragraph">
<p>However, if you want to use adapter classes as marshallable fields in ProtoStream-annotated POJOS, you can do so in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <code>CommonTypesSchema</code> and <code>CommonContainerTypesSchema</code> classes with the <code>dependsOn</code> element of the <code>AutoProtoSchemaBuilder</code> annotation.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@AutoProtoSchemaBuilder</span>(dependsOn = {org.infinispan.protostream.types.java.CommonTypes, org.infinispan.protostream.types.java.CommonContainerTypes}, schemaFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">library.proto</span><span class="delimiter">&quot;</span></span>, schemaFilePath = <span class="string"><span class="delimiter">&quot;</span><span class="content">proto</span><span class="delimiter">&quot;</span></span>, schemaPackageName = <span class="string"><span class="delimiter">&quot;</span><span class="content">example</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">LibraryInitalizer</span> <span class="directive">extends</span> SerializationContextInitializer {
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the required adapter classes with the <code>includeClasses</code> element of the <code>AutoProtoSchemaBuilder</code> annotation</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@AutoProtoSchemaBuilder</span>(includeClasses = { Author.class, <span class="predefined-type">Book</span>.class, UUIDAdaptor.class, java.math.BigInteger }, schemaFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">library.proto</span><span class="delimiter">&quot;</span></span>, schemaFilePath = <span class="string"><span class="delimiter">&quot;</span><span class="content">proto</span><span class="delimiter">&quot;</span></span>, schemaPackageName = <span class="string"><span class="delimiter">&quot;</span><span class="content">library</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">LibraryInitalizer</span> <span class="directive">extends</span> SerializationContextInitializer {

}</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final">Infinispan ProtoStream API</a></p>
</li>
<li>
<p><a href="https://github.com/infinispan/protostream">Infinispan ProtoStream library</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="protostream-annotations_marshalling"><a class="anchor" href="#protostream-annotations_marshalling"></a>2.1.2. ProtoStream annotations</h4>
<div class="paragraph">
<p>The ProtoStream API includes annotations that you can add to Java applications to define Protobuf schemas, which provide a structured format for your objects.</p>
</div>
<div class="paragraph">
<p>This topic provides additional details about ProtoStream annotations.
You should refer to the documentation in the <a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/annotations/package-summary.html">org.infinispan.protostream.annotations</a> package for complete information.</p>
</div>
<h5 id="protofield" class="discrete">ProtoField</h5>
<div class="paragraph">
<p><code>@ProtoField</code> defines a Protobuf message field.</p>
</div>
<div class="paragraph">
<p>This annotation is required and applies to fields as well as getter and setter methods.
A class must have at least one field annotated with <code>@ProtoField</code> before Infinispan can marshall it as Protobuf.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Optional or required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tag numbers must be unique within the class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the Protobuf type of the field. If you do not specify a type, it is inferred from the Java property.</p>
<p class="tableblock">You can use the <code>@ProtoField(type)</code> element to change the Protobuf type, similarly to changing Java <code>int</code> to <code>fixed32</code>. Any incompatible declarations for the Java property cause compiler errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collectionImplementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the actual collection type if the property type is an interface or abstract class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javaType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the actual Java type if the property type is an abstract class or interface.
The value must be an instantiable Java type assignable to the property type.</p>
<p class="tableblock">If you declare a type with the <code>javaType</code> parameter, then all user code must adhere to that type.
The generated marshaller for the entry uses that implementation if it is unmarshalled.
If the local client uses a different implementation than declared it causes ClassCastExceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a name for the Protobuf schema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the default value for fields if they are not available when reading from the cache. The value must follow the correct syntax for the Java field type.</p></td>
</tr>
</tbody>
</table>
<h5 id="protofactory" class="discrete">ProtoFactory</h5>
<div class="paragraph">
<p><code>@ProtoFactory</code> marks a single constructor or static factory method for creating instances of the message class.</p>
</div>
<div class="paragraph">
<p>You can use this annotation to support immutable message classes.
All fields annotated with <code>@ProtoField</code> must be included in the parameters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Field names and parameters of the <code>@ProtoFactory</code> constructor or method must match the corresponding Protobuf message, however, the order is not important.</p>
</li>
<li>
<p>If you do not add a <code>@ProtoFactory</code> annotated constructor to a class, that class must have a default no-argument constructor, otherwise errors occur during compilation.</p>
</li>
</ul>
</div>
<h5 id="autoprotoschemabuilder" class="discrete">AutoProtoSchemaBuilder</h5>
<div class="paragraph">
<p><code>@AutoProtoSchemaBuilder</code> generates an implementation of a class or interface that extends <code>SerializationContextInitializer</code>.</p>
</div>
<div class="paragraph">
<p>If active, the ProtoStream processor generates the implementation at compile time in the same package with the <code>Impl</code> suffix or a name that you specify with the <code>className</code> parameter.</p>
</div>
<div class="paragraph">
<p>The <code>includeClasses</code> or <code>basePackages</code> parameters reference classes that the ProtoStream processor should scan and include in the Protobuf schema and marshaller.
If you do not set either of these parameters, the ProtoStream processor scans the entire source path, which can lead to unexpected results and is not recommended.
You can also use the <code>excludeClasses</code> parameter with the <code>basePackages</code> parameter to exclude classes.</p>
</div>
<div class="paragraph">
<p>The <code>schemaFileName</code> and <code>schemaPackageName</code> parameters register the generated Protobuf schema under this name.
If you do not set these parameters, the annotated simple class name is used with the unnamed, or default, package.
Schema names must end with the <code>.proto</code> file extension.
You can also use the <code>marshallersOnly</code> to generate marshallers only and suppress the Protobuf schema generation.</p>
</div>
<div class="paragraph">
<p>The ProtoStream process automatically generates <code>META-INF/services</code> service metadata files, which you can use so that Infinispan Server automatically picks up the JAR to register the Protobuf schema.</p>
</div>
<div class="paragraph">
<p>The <code>dependsOn</code> parameter lists annotated classes that implement <code>SerializedContextInitializer</code> to execute first.
If the class does not implement <code>SerializedContextInitializer</code> or is not annotated with <code>AutoProtoSchemaBuilder</code>, a compile time error occurs.</p>
</div>
<h5 id="protoadapter" class="discrete">ProtoAdapter</h5>
<div class="paragraph">
<p><code>@ProtoAdapter</code> is a marshalling adapter for a class or enum that you cannot annotate directly.</p>
</div>
<div class="paragraph">
<p>If you use this annotation for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Classes, the annotated class must have one <code>@ProtoFactory</code> annotated factory method for the marshalled class and annotated accessor methods for each field. These methods can be instance or static methods and their first argument must be the marshalled class.</p>
</li>
<li>
<p>Enums, an identically named enum value must exist in the target enum.</p>
</li>
</ul>
</div>
<h5 id="protodoc_and_protodocs" class="discrete">ProtoDoc and ProtoDocs</h5>
<div class="paragraph">
<p><code>@ProtoDoc</code> and <code>@ProtoDocs</code> are human-readable text that document message types, enums, or fields for the generated schema.</p>
</div>
<div class="paragraph">
<p>You use these annotation to configure indexing for Ickle queries.</p>
</div>
<h5 id="protoname" class="discrete">ProtoName</h5>
<div class="paragraph">
<p><code>@ProtoName</code> is an optional annotation that specifies the Protobuf message or enum type name and replaces the <code>@ProtoMessage</code> annotation.</p>
</div>
<h5 id="protoenumvalue" class="discrete">ProtoEnumValue</h5>
<div class="paragraph">
<p><code>@ProtoEnumValue</code> defines a Protobuf enum value. You can apply this annotation to members of a Java enum only.</p>
</div>
<h5 id="protoreserved_and_protoreservedstatements" class="discrete">ProtoReserved and ProtoReservedStatements</h5>
<div class="paragraph">
<p><code>@ProtoReserved</code> and <code>@ProtoReservedStatements</code> add <code>reserved</code> statements to generated messages or enum definitions to prevent future usage of numbers, ranges, and names.</p>
</div>
<h5 id="prototypeid" class="discrete">ProtoTypeId</h5>
<div class="paragraph">
<p><code>@ProtoTypeId</code> optionally specifies a globally unique numeric type identifier for a Protobuf message or enum type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should not add this annotation to classes because Infinispan uses it internally and identifiers can change without notice.</p>
</div>
</td>
</tr>
</table>
</div>
<h5 id="protounknownfieldset" class="discrete">ProtoUnknownFieldSet</h5>
<div class="paragraph">
<p><code>@ProtoUnknownFieldSet</code> optionally indicates the field, or JavaBean property of type <code>{@link org.infinispan.protostream.UnknownFieldSet}</code>, which stores any unknown fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan does not recommend using this annotation because it is no longer supported by Google and is likely to be removed in future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/annotations/package-summary.html">org.infinispan.protostream.annotations</a></p>
</li>
<li>
<p><a href="../developing/developing.html#search_api">Querying values in caches</a></p>
</li>
<li>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto#reserved">Protocol Buffers Language Guide - Reserved Fields</a></p>
</li>
<li>
<p><a href="https://developers.google.com/protocol-buffers/docs/proto#reserved_values">Protocol Buffers Language Guide - Reserved Values</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="protostream-sci-implementations_marshalling"><a class="anchor" href="#protostream-sci-implementations_marshalling"></a>2.2. Creating serialization context initializers</h3>
<div class="paragraph">
<p>A serialization context initializer lets you register the following with Infinispan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Protobuf schemas that describe user types.</p>
</li>
<li>
<p>Marshallers that provide serialization and deserialization capabilities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From a high level, you should do the following to create a serialization context initializer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add ProtoStream annotations to your Java classes.</p>
</li>
<li>
<p>Use the ProtoStream processor that Infinispan provides to compile your <code>SerializationContextInitializer</code> implementation.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>org.infinispan.protostream.MessageMarshaller</code> interface is deprecated and planned for removal in a future version of ProtoStream.
You should ignore any code examples or documentation that show how to use <code>MessageMarshaller</code> until it is completely removed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="adding-protostream-processor_marshalling"><a class="anchor" href="#adding-protostream-processor_marshalling"></a>2.2.1. Adding the ProtoStream processor</h4>
<div class="paragraph">
<p>Infinispan provides a ProtoStream processor artifact that processes Java annotations in your classes at compile time to generate Protobuf schemas, accompanying marshallers, and a concrete implementation of the <code>SerializationContextInitializer</code> interface.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add the <code>protostream-processor</code> dependency to your <code>pom.xml</code> with the <code>provided</code> scope.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This dependency is required at compile-time only so you should use the <code>provided</code> scope or mark it as optional.
You should also ensure the <code>protostream-processor</code> is not propagated as a transitive dependency.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>infinispan-bom<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="tag">&lt;dependencies&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.infinispan.protostream<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>protostream-processor<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="adding-protostream-annotations_marshalling"><a class="anchor" href="#adding-protostream-annotations_marshalling"></a>2.2.2. Adding ProtoStream annotations to Java classes</h4>
<div class="paragraph">
<p>Declare ProtoStream metadata by adding annotations to a Java class and its members.
Infinispan then uses the ProtoStream processor to generate Protobuf schema and related marshallers from those annotations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Annotate the Java fields that you want to marshall with <code>@ProtoField</code>, either directly on the field or on the getter or setter method.</p>
<div class="paragraph">
<p>Any non-annotated fields in your Java class are transient.
For example, you have a Java class with 15 fields and annotate five of them.
The resulting schema contains only those five fields and only those five fields are marshalled when storing a class instance in Infinispan.</p>
</div>
</li>
<li>
<p>Use <code>@ProtoFactory</code> to annotate constructors for immutable objects. The annotated constructors must initialize all fields annotated with <code>@ProtoField</code>.</p>
</li>
<li>
<p>Annotate members of any Java enum with <code>@ProtoEnumValue</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following <code>Author.java</code> and <code>Book.java</code> examples show Java classes annotated with <code>@ProtoField</code> and <code>@ProtoFactory</code>:</p>
</div>
<div class="listingblock primary">
<div class="title">Author.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoField</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> {
   <span class="annotation">@ProtoField</span>(<span class="integer">1</span>)
   <span class="directive">final</span> <span class="predefined-type">String</span> name;

   <span class="annotation">@ProtoField</span>(<span class="integer">2</span>)
   <span class="directive">final</span> <span class="predefined-type">String</span> surname;

   <span class="annotation">@ProtoFactory</span>
   Author(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> surname) {
      <span class="local-variable">this</span>.name = name;
      <span class="local-variable">this</span>.surname = surname;
   }
   <span class="comment">// public Getter methods omitted for brevity</span>
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Book.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoField</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {
   <span class="annotation">@ProtoField</span>(number = <span class="integer">1</span>)
   <span class="directive">public</span> <span class="directive">final</span> <span class="predefined-type">UUID</span> id;

   <span class="annotation">@ProtoField</span>(number = <span class="integer">2</span>)
   <span class="directive">final</span> <span class="predefined-type">String</span> title;

   <span class="annotation">@ProtoField</span>(number = <span class="integer">3</span>)
   <span class="directive">final</span> <span class="predefined-type">String</span> description;

   <span class="annotation">@ProtoField</span>(number = <span class="integer">4</span>, defaultValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>)
   <span class="directive">final</span> <span class="type">int</span> publicationYear;

   <span class="annotation">@ProtoField</span>(number = <span class="integer">5</span>, collectionImplementation = <span class="predefined-type">ArrayList</span>.class)
   <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Author&gt; authors;

   <span class="annotation">@ProtoField</span>(number = <span class="integer">6</span>)
   <span class="directive">public</span> Language language;

   <span class="annotation">@ProtoFactory</span>
   <span class="predefined-type">Book</span>(<span class="predefined-type">UUID</span> id, <span class="predefined-type">String</span> title, <span class="predefined-type">String</span> description, <span class="type">int</span> publicationYear, <span class="predefined-type">List</span>&lt;Author&gt; authors, Language language) {
      <span class="local-variable">this</span>.id = id;
      <span class="local-variable">this</span>.title = title;
      <span class="local-variable">this</span>.description = description;
      <span class="local-variable">this</span>.publicationYear = publicationYear;
      <span class="local-variable">this</span>.authors = authors;
      <span class="local-variable">this</span>.language = language;
   }
   <span class="comment">// public Getter methods not included for brevity</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <code>Language.java</code> example shows a Java enum annotated with <code>@ProtoEnumValue</code> along with the corresponding Protobuf schema:</p>
</div>
<div class="listingblock primary">
<div class="title">Language.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoEnumValue</span>;

<span class="directive">public</span> <span class="type">enum</span> Language {
  <span class="annotation">@ProtoEnumValue</span>(number = <span class="integer">0</span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">EN</span><span class="delimiter">&quot;</span></span>)
  ENGLISH,
  <span class="annotation">@ProtoEnumValue</span>(number = <span class="integer">1</span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">DE</span><span class="delimiter">&quot;</span></span>)
  GERMAN,
  <span class="annotation">@ProtoEnumValue</span>(number = <span class="integer">2</span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">IT</span><span class="delimiter">&quot;</span></span>)
  ITALIAN,
  <span class="annotation">@ProtoEnumValue</span>(number = <span class="integer">3</span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ES</span><span class="delimiter">&quot;</span></span>)
  SPANISH,
  <span class="annotation">@ProtoEnumValue</span>(number = <span class="integer">4</span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">FR</span><span class="delimiter">&quot;</span></span>)
  FRENCH;

}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Language.proto</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="proto">enum Language {

   EN = 0;

   DE = 1;

   IT = 2;

   ES = 3;

   FR = 4;
}</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/annotations/ProtoField.html">org.infinispan.protostream.annotations.ProtoField</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/annotations/ProtoFactory.html">org.infinispan.protostream.annotations.ProtoFactory</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="creating-protostream-adapter_marshalling"><a class="anchor" href="#creating-protostream-adapter_marshalling"></a>2.2.3. Creating ProtoStream adapter classes</h4>
<div class="paragraph">
<p>ProtoStream provides a <code>@ProtoAdapter</code> annotation that you can use to marshall external, third-party Java object classes that you cannot annotate directly.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an <code>Adapter</code> class and add the <code>@ProtoAdapter</code> annotation, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util.UUID</span>;

<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoAdapter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoField</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.descriptors.Type</span>;

<span class="comment">/**
 * Human readable UUID adapter for UUID marshalling
 */</span>
<span class="annotation">@ProtoAdapter</span>(<span class="predefined-type">UUID</span>.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UUIDAdapter</span> {

  <span class="annotation">@ProtoFactory</span>
  <span class="predefined-type">UUID</span> create(<span class="predefined-type">String</span> stringUUID) {
    <span class="keyword">return</span> <span class="predefined-type">UUID</span>.fromString(stringUUID);
  }

  <span class="annotation">@ProtoField</span>(<span class="integer">1</span>)
  <span class="predefined-type">String</span> getStringUUID(<span class="predefined-type">UUID</span> uuid) {
    <span class="keyword">return</span> uuid.toString();
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/annotations/ProtoAdapter.html">org.infinispan.protostream.annotations.ProtoAdapter</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="annotating-autoprotoschemabuilder_marshalling"><a class="anchor" href="#annotating-autoprotoschemabuilder_marshalling"></a>2.2.4. Generating serialization context initializers</h4>
<div class="paragraph">
<p>After you add the ProtoStream processor and annotate your Java classes, you can add the <code>@AutoProtoSchemaBuilder</code> annotation to an interface so that Infinispan generates the Protobuf schema, accompanying marshallers, and a concrete implementation of the <code>SerializationContextInitializer</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, generated implementation names are the annotated class name with an "Impl" suffix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define an interface that extends <code>GeneratedSchema</code> or its super interface, <code>SerializationContextInitializer</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>GeneratedSchema</code> interface includes a method to access the Protobuf schema whereas the <code>SerializationContextInitializer</code> interface supports only registration methods.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Annotate the interface with <code>@AutoProtoSchemaBuilder</code>.</p>
</li>
<li>
<p>Ensure that <code>includeClasses</code> parameter includes all classes for the generated <code>SerializationContextInitializer</code> implementation.</p>
</li>
<li>
<p>Specify a name for the generated <code>.proto</code> schema with the <code>schemaFileName</code> parameter.</p>
</li>
<li>
<p>Set a path under <code>target/classes</code> where schema files are generated with the <code>schemaFilePath</code> parameter.</p>
</li>
<li>
<p>Specify a package name for the generated <code>.proto</code> schema with the <code>schemaPackageName</code> parameter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows a <code>GeneratedSchema</code> interface annotated with <code>@AutoProtoSchemaBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@AutoProtoSchemaBuilder</span>(
      includeClasses = {
            <span class="predefined-type">Book</span>.class,
            Author.class,
            UUIDAdapter.class,
            Language.class
      },
      schemaFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">library.proto</span><span class="delimiter">&quot;</span></span>,
      schemaFilePath = <span class="string"><span class="delimiter">&quot;</span><span class="content">proto/</span><span class="delimiter">&quot;</span></span>,
      schemaPackageName = <span class="string"><span class="delimiter">&quot;</span><span class="content">book_sample</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">LibraryInitializer</span> <span class="directive">extends</span> GeneratedSchema {
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>If you use embedded caches, Infinispan automatically registers your <code>SerializationContextInitializer</code> implementation.</p>
</div>
<div class="paragraph">
<p>If you use remote caches, you must register your <code>SerializationContextInitializer</code> implementation with Infinispan Server.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.javadoc.io/doc/org.infinispan.protostream/protostream/4.4.1.Final/org/infinispan/protostream/annotations/AutoProtoSchemaBuilder.html">org.infinispan.protostream.annotations.AutoProtoSchemaBuilder</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-sci-embedded-caches_marshalling"><a class="anchor" href="#registering-sci-embedded-caches_marshalling"></a>2.2.5. Registering serialization context initializers</h4>
<div class="paragraph">
<p>For embedded caches, Infinispan automatically registers serialization contexts and marshallers in your annotated <code>SerializationContextInitializer</code> implementation using the <code>java.util.ServiceLoader</code>.</p>
</div>
<div class="paragraph">
<p>If you prefer, you can disable automatic registration of <code>SerializationContextInitializer</code> implementations and then register them manually.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you manually register one <code>SerializationContextInitializer</code> implementation, it disables automatic registration.
You must then manually register all other implementations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set a value of <code>false</code> for the <code>AutoProtoSchemaBuilder.service</code> annotation.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AutoProtoSchemaBuilder</span>(
      includeClasses = SomeClass.class,
      ...
      service = <span class="predefined-constant">false</span>
)</code></pre>
</div>
</div>
</li>
<li>
<p>Manually register <code>SerializationContextInitializer</code> implementations either programmatically or declaratively, as in the following examples:</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;serialization&gt;</span>
    <span class="tag">&lt;context-initializer</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.LibraryInitializerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;context-initializer</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.another.SCIImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/serialization&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfigurationBuilder builder = <span class="keyword">new</span> GlobalConfigurationBuilder();
builder.serialization()
       .addContextInitializers(<span class="keyword">new</span> LibraryInitializerImpl(), <span class="keyword">new</span> SCIImpl());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registering-sci-remote-caches_marshalling"><a class="anchor" href="#registering-sci-remote-caches_marshalling"></a>2.2.6. Registering Protobuf schemas with Infinispan Server</h4>
<div class="paragraph">
<p>You must register Protobuf schemas with Infinispan Server if you want to perform Ickle queries or convert from <code>application/x-protostream</code> to other media types such as <code>application/json</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Generate a <code>SerializationContextInitializer</code> implementation with the ProtoStream processor.</p>
<div class="paragraph">
<p>After the build completes, you can find generated Protobuf schema in the <code>target/&lt;schemaFilePath&gt;/</code> directory.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following to register your generated Protobuf schema with Infinispan Server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the generated Protobuf schema to the dedicated <code>___protobuf_metadata</code> cache with the Infinispan command line interface (CLI), REST interface, or <code>ProtobufMetadataManager</code> JMX MBean.</p>
<div class="paragraph">
<p>This method ensures that Infinispan automatically distributes your schema across the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you enable security authorization for caches, users must have the <code>CREATE</code> permission to add schemas to the <code>___protobuf_metadata</code> cache.
Assign users the <code>deployer</code> role at minimum if you use default authorization settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the generated <code>SerializationContextInitializer</code> implementation with a Hot Rod client to register the Protobuf schema, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">/**
 * Register generated Protobuf schema with Infinispan Server.
 * This requires the RemoteCacheManager to be initialized.
 *
 * @param initializer The serialization context initializer for the schema.
 */</span>
<span class="directive">private</span> <span class="type">void</span> registerSchemas(SerializationContextInitializer initializer) {
  <span class="comment">// Store schemas in the '___protobuf_metadata' cache to register them.</span>
  <span class="comment">// Using ProtobufMetadataManagerConstants might require the query dependency.</span>
  <span class="directive">final</span> RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; protoMetadataCache = remoteCacheManager.getCache(ProtobufMetadataManagerConstants.PROTOBUF_METADATA_CACHE_NAME);
  <span class="comment">// Add the generated schema to the cache.</span>
  protoMetadataCache.put(initializer.getProtoFileName(), initializer.getProtoFile());

  <span class="comment">// Ensure the registered Protobuf schemas do not contain errors.</span>
  <span class="comment">// Throw an exception if errors exist.</span>
  <span class="predefined-type">String</span> errors = protoMetadataCache.get(ProtobufMetadataManagerConstants.ERRORS_KEY_SUFFIX);
  <span class="keyword">if</span> (errors != <span class="predefined-constant">null</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some Protobuf schema files contain errors: </span><span class="delimiter">&quot;</span></span> + errors + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Schema :</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> + initializer.getProtoFileName());
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Add a JAR file with the <code>SerializationContextInitializer</code> implementation and custom classes to the <code>$ISPN_HOME/server/lib</code> directory.</p>
<div class="paragraph">
<p>When you do this, Infinispan Server registers your Protobuf schema at startup. However, you must add the archive to each server installation because the schema are not saved in the <code>___protobuf_metadata</code> cache or automatically distributed across the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must do this if you require Infinispan Server to perform any <code>application/x-protostream</code> to <code>application/x-java-object</code> conversions, in which case you must also add any JAR files for your POJOs.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Register the <code>SerializationContextInitializer</code> with your Hot Rod clients, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder remoteBuilder = <span class="keyword">new</span> ConfigurationBuilder();
remoteBuilder.addServer().host(host).port(<span class="predefined-type">Integer</span>.parseInt(port));

<span class="comment">// Add your generated SerializationContextInitializer implementation.</span>
LibraryInitalizer initializer = <span class="keyword">new</span> LibraryInitalizerImpl();
remoteBuilder.addContextInitializer(initializer);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../cli/cli.html#registering_protobuf_schemas">CLI: Registering Protobuf schemas</a></p>
</li>
<li>
<p><a href="../rest/rest.html#rest_v2_create_protobuf">REST API: Creating Protobuf schemas</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="protostream-sci-manual_marshalling"><a class="anchor" href="#protostream-sci-manual_marshalling"></a>2.2.7. Manual serialization context initializer implementations</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan strongly recommends against manually implementing the <code>SerializationContextInitializer</code> or <code>GeneratedSchema</code> interfaces.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to manually implement <code>SerializationContextInitializer</code> or <code>GeneratedSchema</code> interfaces using <code>ProtobufTagMarshaller</code> and <code>RawProtobufMarshaller</code> annotations.</p>
</div>
<div class="paragraph">
<p>However, manual implementations require a lot of tedious overhead and are prone to error.
Implementations that you generate with the <code>protostream-processor</code> artifact are a much more efficient and reliable way to configure ProtoStream marshalling.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alternative-marshallers"><a class="anchor" href="#alternative-marshallers"></a>3. Using alternative and custom marshaller implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan recommends you use Protobuf-based marshalling with the ProtoStream marshaller so you can take advantage of Ickle queries and use the Infinispan CLI and Console.
However, if required, you can use alternative marshallers or a custom marshaller implementation.</p>
</div>
<div class="sect2">
<h3 id="adding-deserialization-allowlist_marshaller-implementations"><a class="anchor" href="#adding-deserialization-allowlist_marshaller-implementations"></a>3.1. Allowing deserialization of Java classes</h3>
<div class="paragraph">
<p>For security reasons Infinispan does not allow deserialization of arbitrary Java classes.
If you use <code>JavaSerializationMarshaller</code> or <code>GenericJBossMarshaller</code>, you must add your Java classes to a deserialization allow list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The deserialization allow list applies to the Cache Manager so your Java classes can be deserialized by all caches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add Java classes to the deserialization allow list in the Infinispan configuration or in system properties.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">&lt;infinispan&gt;
  &lt;cache-container&gt;
    &lt;serialization version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>
                   marshaller=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.marshall.TestObjectStreamMarshaller</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;allow-list&gt;
        &lt;<span class="type">class</span>&gt;<span class="class">org</span>.infinispan.test.data.Person&lt;/<span class="type">class</span>&gt;
        &lt;<span class="class">regex</span>&gt;org.infinispan.test.data.*&lt;/regex&gt;
      &lt;/allow-list&gt;
    &lt;/serialization&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">System properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>// Specify a comma-separated list of fully qualified class names
-Dinfinispan.deserialization.allowlist.classes=java.time.Instant,com.myclass.Entity

// Specify a regular expression to match classes
-Dinfinispan.deserialization.allowlist.regexps=.*</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jboss-marshaller_marshaller-implementations"><a class="anchor" href="#using-jboss-marshaller_marshaller-implementations"></a>3.2. Using JBoss Marshalling</h3>
<div class="paragraph">
<p>JBoss Marshalling is a serialization-based marshalling library and was the default marshaller in previous Infinispan versions but is now deprecated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JBoss Marshalling is deprecated.
You should use it only as a temporary measure while migrating your applications from an older version of Infinispan.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>infinispan-jboss-marshalling</code> dependency to your classpath.</p>
</li>
<li>
<p>Configure Infinispan to use the <code>GenericJBossMarshaller</code>.</p>
</li>
<li>
<p>Add your Java classes to the deserialization allowlist.</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;serialization</span> <span class="attribute-name">marshaller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.jboss.marshalling.commons.GenericJBossMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;allow-list&gt;</span>
    <span class="tag">&lt;class&gt;</span>org.infinispan.concrete.SomeClass<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;regex&gt;</span>org.infinispan.example.*<span class="tag">&lt;/regex&gt;</span>
  <span class="tag">&lt;/allow-list&gt;</span>
<span class="tag">&lt;/serialization&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfigurationBuilder builder = <span class="keyword">new</span> GlobalConfigurationBuilder();
builder.serialization()
       .marshaller(<span class="keyword">new</span> GenericJBossMarshaller())
       .allowList()
       .addRegexps(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.concrete.SomeClass</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/commons/marshall/AdvancedExternalizer.html">AdvancedExternalizer</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-java-serialization_marshaller-implementations"><a class="anchor" href="#using-java-serialization_marshaller-implementations"></a>3.3. Using Java serialization</h3>
<div class="paragraph">
<p>You can use Java serialization with Infinispan to marshall objects that implement the Java <code>Serializable</code> interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Java serialization offers worse performance than ProtoStream marshalling.
You should use Java serialization only if there is a strict requirement to do so.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure Infinispan to use <code>JavaSerializationMarshaller</code>.</p>
</li>
<li>
<p>Add your Java classes to the deserialization allowlist.</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;serialization</span> <span class="attribute-name">marshaller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.commons.marshall.JavaSerializationMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;allow-list&gt;</span>
    <span class="tag">&lt;class&gt;</span>org.infinispan.concrete.SomeClass<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;regex&gt;</span>org.infinispan.example.*<span class="tag">&lt;/regex&gt;</span>
  <span class="tag">&lt;/allow-list&gt;</span>
<span class="tag">&lt;/serialization&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfigurationBuilder builder = <span class="keyword">new</span> GlobalConfigurationBuilder();
builder.serialization()
       .marshaller(<span class="keyword">new</span> JavaSerializationMarshaller())
       .allowList()
       .addRegexps(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.concrete.SomeClass</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html">Serializable</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/commons/marshall/JavaSerializationMarshaller.html">org.infinispan.commons.marshall.JavaSerializationMarshaller</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-custom-marshallers_marshaller-implementations"><a class="anchor" href="#using-custom-marshallers_marshaller-implementations"></a>3.4. Using custom marshallers</h3>
<div class="paragraph">
<p>Infinispan provides a <code>Marshaller</code> interface that you can implement for custom marshallers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Custom marshaller implementations can access a configured access list via the
<a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/commons/marshall/Marshaller.html#initialize(org.infinispan.commons.configuration.ClassAllowList)">initialize()</a> method, which is called during startup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Implement the <code>Marshaller</code> interface.</p>
</li>
<li>
<p>Configure Infinispan to use your marshaller.</p>
</li>
<li>
<p>Add your Java classes to the deserialization allowlist.</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;serialization</span> <span class="attribute-name">marshaller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.marshall.CustomMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;allow-list&gt;</span>
    <span class="tag">&lt;class&gt;</span>org.infinispan.concrete.SomeClass<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;regex&gt;</span>org.infinispan.example.*<span class="tag">&lt;/regex&gt;</span>
  <span class="tag">&lt;/allow-list&gt;</span>
<span class="tag">&lt;/serialization&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfigurationBuilder builder = <span class="keyword">new</span> GlobalConfigurationBuilder();
builder.serialization()
      .marshaller(<span class="keyword">new</span> org.infinispan.example.marshall.CustomMarshaller())
      .allowList().addRegexp(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.*</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/commons/marshall/Marshaller.html">org.infinispan.commons.marshall.Marshaller</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-conversion"><a class="anchor" href="#data-conversion"></a>4. Data conversion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan uses transcoders to convert data between various encodings that are identified by media types.</p>
</div>
<div class="sect2">
<h3 id="hotrod-data-format_transcoding"><a class="anchor" href="#hotrod-data-format_transcoding"></a>4.1. Hot Rod DataFormat API</h3>
<div class="paragraph">
<p>Read and write operations on remote caches via the Hot Rod endpoint use the client marshaller by default.
Hot Rod provides a <code>DataFormat</code> API for Java clients that you can use to perform cache operations with different media type encodings and/or marshallers.</p>
</div>
<div class="paragraph">
<div class="title">Different marshallers for key and values</div>
<p>You can override marshallers for keys and values at run time.</p>
</div>
<div class="paragraph">
<p>For example, to bypass all serialization in the Hot Rod client and read the <code>byte[]</code> array stored in the remote cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Existing RemoteCache instance</span>
RemoteCache&lt;<span class="predefined-type">String</span>, Pojo&gt; remoteCache = ...

<span class="comment">// IdentityMarshaller is a no-op marshaller</span>
DataFormat rawKeyAndValues =
DataFormat.builder()
          .keyMarshaller(IdentityMarshaller.INSTANCE)
          .valueMarshaller(IdentityMarshaller.INSTANCE)
          .build();

<span class="comment">// Creates a new instance of RemoteCache with the supplied DataFormat</span>
RemoteCache&lt;<span class="type">byte</span><span class="type">[]</span>, <span class="type">byte</span><span class="type">[]</span>&gt; rawResultsCache =
remoteCache.withDataFormat(rawKeyAndValues);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using different marshallers and data formats for keys with <code>keyMarshaller()</code> and <code>keyType()</code> methods can interfere with client intelligence routing mechanisms, causing extra network hops within the Infinispan cluster.
If performance is critical, you should use the same encoding for keys on the client and on the server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Reading data in different encodings</div>
<p>Request and send data in different encodings specified by a <code>org.infinispan.commons.dataconversion.MediaType</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Existing remote cache using ProtostreamMarshaller</span>
RemoteCache&lt;<span class="predefined-type">String</span>, Pojo&gt; protobufCache = ...

<span class="comment">// Request values returned as JSON</span>
<span class="comment">// Use the UTF8StringMarshaller to convert UTF-8 to String</span>
DataFormat jsonString =
DataFormat.builder()
          .valueType(MediaType.APPLICATION_JSON)
          .valueMarshaller(<span class="keyword">new</span> UTF8StringMarshaller())
          .build();
RemoteCache&lt;<span class="type">byte</span><span class="type">[]</span>, <span class="type">byte</span><span class="type">[]</span>&gt; rawResultsCache =
protobufCache.withDataFormat(jsonString);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Using custom value marshallers</div>
<p>You can use custom marshallers for values, as in the following example that returns values as <code>org.codehaus.jackson.JsonNode</code> objects.</p>
</div>
<div class="paragraph">
<p>In this example, Infinispan Server handles the data conversion and throws an exception if it does not support the specified media type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DataFormat jsonNode =
DataFormat.builder()
          .valueType(MediaType.APPLICATION_JSON)
          .valueMarshaller(<span class="keyword">new</span> CustomJacksonMarshaller()
          .build();

RemoteCache&lt;<span class="predefined-type">String</span>, JsonNode&gt; jsonNodeCache =
remoteCache.withDataFormat(jsonNode);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Returning values as XML</div>
<p>The following code snippet returns values as XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> xmlValue = remoteCache
      .withDataFormat(DataFormat.builder()
      .valueType(MediaType.APPLICATION_XML)
      .valueMarshaller(<span class="keyword">new</span> UTF8StringMarshaller())
      .build())
      .get(key);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the preceding <code>get(key)</code> call returns values such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><span class="tag">&lt;string&gt;</span>Hello!<span class="tag">&lt;/string&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/DataFormat.html">org.infinispan.client.hotrod.DataFormat</a></p>
</div>
</div>
<div class="sect2">
<h3 id="converting-data-on-demand_transcoding"><a class="anchor" href="#converting-data-on-demand_transcoding"></a>4.2. Converting data on demand with embedded caches</h3>
<div class="paragraph">
<p>Embedded caches have a default request encoding of <code>application/x-java-object</code> and a storage encoding that corresponds to the media type that you configure for the cache.
This means that Infinispan marshalls POJOs from the application to the storage encoding for the cache and then returns POJOs back to the application.
In some complex scenarios you can use the <code>AdvancedCache</code> API to change the default conversion to and from POJOs to other encodings.</p>
</div>
<div class="paragraph">
<p>The following example uses the <code>withMediaType()</code> method to return values as <code>application/json</code> on demand.</p>
</div>
<div class="listingblock">
<div class="title">Advanced cache with MediaType</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">DefaultCacheManager cacheManager = <span class="keyword">new</span> DefaultCacheManager();

<span class="comment">// Encode keys and values as Protobuf</span>
ConfigurationBuilder cfg = <span class="keyword">new</span> ConfigurationBuilder();
cfg.encoding().key().mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span>);
cfg.encoding().value().mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span>);

cacheManager.defineConfiguration(<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span>, cfg.build());

Cache&lt;<span class="predefined-type">Integer</span>, Person&gt; cache = cacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span>);

cache.put(<span class="integer">1</span>, <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// Use Protobuf for keys and JSON for values</span>
Cache&lt;<span class="predefined-type">Integer</span>, <span class="type">byte</span><span class="type">[]</span>&gt; jsonValuesCache = (Cache&lt;<span class="predefined-type">Integer</span>, <span class="type">byte</span><span class="type">[]</span>&gt;) cache.getAdvancedCache().withMediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>);

<span class="type">byte</span><span class="type">[]</span> json = jsonValuesCache.get(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Value returned in JSON format</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.sample.Person</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/AdvancedCache.html">org.infinispan.AdvancedCache</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-08-30 10:09:57 +0100
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>