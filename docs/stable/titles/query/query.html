<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Querying Infinispan Caches</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Querying Infinispan Caches</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#indexing-caches">1. Indexing Infinispan caches</a>
<ul class="sectlevel2">
<li><a href="#indexing-caches_indexing-caches">1.1. Configuring Infinispan to index caches</a>
<ul class="sectlevel3">
<li><a href="#indexing-configuration_indexing-caches">1.1.1. Index configuration</a>
<ul class="sectlevel4">
<li><a href="#index_storage">Index storage</a></li>
<li><a href="#index_reader">Index reader</a></li>
<li><a href="#index_writer">Index writer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#indexing-annotations_indexing-caches">1.2. Indexing annotations</a></li>
<li><a href="#rebuilding-indexes_indexing-caches">1.3. Rebuilding indexes</a></li>
<li><a href="#non-indexed-queries_indexing-caches">1.4. Non-indexed queries</a></li>
</ul>
</li>
<li><a href="#ickle-query-language">2. Creating Ickle queries</a>
<ul class="sectlevel2">
<li><a href="#ickle-queries_ickle-query-language">2.1. Ickle queries</a>
<ul class="sectlevel3">
<li><a href="#pagination">2.1.1. Pagination</a></li>
<li><a href="#number_of_hits">2.1.2. Number of hits</a></li>
<li><a href="#iteration">2.1.3. Iteration</a></li>
<li><a href="#named_query_parameters">2.1.4. Named query parameters</a></li>
<li><a href="#query_execution">2.1.5. Query execution</a></li>
</ul>
</li>
<li><a href="#ickle-query-syntax_ickle-query-language">2.2. Ickle query language syntax</a>
<ul class="sectlevel3">
<li><a href="#filtering_operators">2.2.1. Filtering operators</a></li>
<li><a href="#boolean_conditions">2.2.2. Boolean conditions</a></li>
<li><a href="#nested_conditions">2.2.3. Nested conditions</a></li>
<li><a href="#projections_with_select_statements">2.2.4. Projections with SELECT statements</a></li>
<li><a href="#grouping_and_aggregation">2.2.5. Grouping and aggregation</a></li>
<li><a href="#delete_statements">2.2.6. DELETE statements</a></li>
</ul>
</li>
<li><a href="#full-text-search_ickle-query-language">2.3. Full-text queries</a>
<ul class="sectlevel3">
<li><a href="#fuzzy_queries">2.3.1. Fuzzy queries</a></li>
<li><a href="#range_queries">2.3.2. Range queries</a></li>
<li><a href="#phrase_queries">2.3.3. Phrase queries</a></li>
<li><a href="#proximity_queries">2.3.4. Proximity queries</a></li>
<li><a href="#wildcard_queries">2.3.5. Wildcard queries</a></li>
<li><a href="#regular_expression_queries">2.3.6. Regular expression queries</a></li>
<li><a href="#boosting_queries">2.3.7. Boosting queries</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#query-remote">3. Querying remote caches</a>
<ul class="sectlevel2">
<li><a href="#querying-hot-rod_query-remote">3.1. Querying caches from Hot Rod Java clients</a></li>
<li><a href="#querying-console_query-remote">3.2. Querying caches from Infinispan Console and CLI</a></li>
<li><a href="#using-analyzers_query-remote">3.3. Using analyzers with remote caches</a>
<ul class="sectlevel3">
<li><a href="#default-analyzers_query-remote">3.3.1. Default analyzer definitions</a></li>
<li><a href="#creating-analyzers_query-remote">3.3.2. Creating custom analyzer definitions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#query-embedded">4. Querying embedded caches</a>
<ul class="sectlevel2">
<li><a href="#querying-embedded-caches_query-embedded">4.1. Querying embedded caches</a></li>
<li><a href="#entity-mapping-annotations_query-embedded">4.2. Entity mapping annotations</a></li>
<li><a href="#programmatic-entity-mapping_query-embedded">4.3. Programmatically mapping entities</a></li>
</ul>
</li>
<li><a href="#query-continuous">5. Creating continuous queries</a>
<ul class="sectlevel2">
<li><a href="#continuous-queries_query-continuous">5.1. Continuous queries</a>
<ul class="sectlevel3">
<li><a href="#continuous-query-performance_query-continuous">5.1.1. Continuous queries and Infinispan performance</a></li>
</ul>
</li>
<li><a href="#creating-continuous-queries_query-continuous">5.2. Creating continuous queries</a></li>
</ul>
</li>
<li><a href="#query-monitoring-tuning">6. Monitoring and tuning Infinispan queries</a>
<ul class="sectlevel2">
<li><a href="#getting-query-statistics_query-monitoring-tuning">6.1. Getting query statistics</a></li>
<li><a href="#tuning-query-performance_query-monitoring-tuning">6.2. Tuning query performance</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan lets you perform queries with embedded and remote caches to efficiently and quickly look up values in your data set.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexing-caches"><a class="anchor" href="#indexing-caches"></a>1. Indexing Infinispan caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan can create indexes of values in your caches to improve query performance, providing faster results than non-indexed queries.
Indexing also lets you use full-text search capabilities in your queries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan uses <a href="http://lucene.apache.org/">Apache Lucene</a> technology to index values in caches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="indexing-caches_indexing-caches"><a class="anchor" href="#indexing-caches_indexing-caches"></a>1.1. Configuring Infinispan to index caches</h3>
<div class="paragraph">
<p>Enable indexing in your cache configuration and specify which entities Infinispan should include when creating indexes.</p>
</div>
<div class="paragraph">
<p>You should always configure Infinispan to index caches when using queries.
Indexing provides a significant performance boost to your queries, allowing you to get faster insights into your data.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable indexing in your cache configuration.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing&gt;</span>
    <span class="comment">&lt;!-- Indexing configuration goes here. --&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Adding an <code>indexing</code> element to your configuration enables indexing without the need to include the <code>enabled=true</code> attribute.</p>
</div>
<div class="paragraph">
<p>For remote caches adding this element also implicitly configures encoding as ProtoStream.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Specify the entities to index with the <code>indexed-entity</code> element.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing&gt;</span>
    <span class="tag">&lt;indexed-entities&gt;</span>
      <span class="tag">&lt;indexed-entity&gt;</span>...<span class="tag">&lt;/indexed-entity&gt;</span>
    <span class="tag">&lt;/indexed-entities&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="protobuf_messages" class="discrete">Protobuf messages</h4>
<div class="ulist">
<ul>
<li>
<p>Specify the message declared in the schema as the value of the <code>indexed-entity</code> element, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing&gt;</span>
    <span class="tag">&lt;indexed-entities&gt;</span>
      <span class="tag">&lt;indexed-entity&gt;</span>org.infinispan.sample.Car<span class="tag">&lt;/indexed-entity&gt;</span>
      <span class="tag">&lt;indexed-entity&gt;</span>org.infinispan.sample.Truck<span class="tag">&lt;/indexed-entity&gt;</span>
    <span class="tag">&lt;/indexed-entities&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration indexes the <code>Book</code> message in a schema with the <code>book_sample</code> package name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="proto">package book_sample;

/* @Indexed */
message Book {

    /* @Field(store = Store.YES, analyze = Analyze.YES) */
    optional string title = 1;

    /* @Field(store = Store.YES, analyze = Analyze.YES) */
    optional string description = 2;
    optional int32 publicationYear = 3; // no native Date type available in Protobuf

    repeated Author authors = 4;
}

message Author {
    optional string name = 1;
    optional string surname = 2;
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="java_objects" class="discrete">Java objects</h4>
<div class="ulist">
<ul>
<li>
<p>Specify the fully qualified name (FQN) of each class that includes the <code>@Indexed</code> annotation.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing&gt;</span>
    <span class="tag">&lt;indexed-entities&gt;</span>
      <span class="tag">&lt;indexed-entity&gt;</span>book_sample.Book<span class="tag">&lt;/indexed-entity&gt;</span>
    <span class="tag">&lt;/indexed-entities&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title"><code>ConfigurationBuilder</code></div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.configuration.cache</span>.*;

ConfigurationBuilder config=<span class="keyword">new</span> ConfigurationBuilder();
config.indexing().enable().storage(FILESYSTEM).path(<span class="string"><span class="delimiter">&quot;</span><span class="content">/some/folder</span><span class="delimiter">&quot;</span></span>).addIndexedEntity(<span class="predefined-type">Book</span>.class);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/cache/IndexingConfigurationBuilder.html"><code>org.infinispan.configuration.cache.IndexingConfigurationBuilder</code></a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="indexing-configuration_indexing-caches"><a class="anchor" href="#indexing-configuration_indexing-caches"></a>1.1.1. Index configuration</h4>
<div class="paragraph">
<p>Infinispan configuration controls how indexes are stored and constructed.</p>
</div>
<div class="sect4">
<h5 id="index_storage"><a class="anchor" href="#index_storage"></a>Index storage</h5>
<div class="paragraph">
<p>You can configure how Infinispan stores indexes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the host file system, which is the default and persists indexes between restarts.</p>
</li>
<li>
<p>In JVM heap memory, which means that indexes do not survive restarts.<br>
You should store indexes in JVM heap memory only for small datasets.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">File system</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing</span> <span class="attribute-name">storage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filesystem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${java.io.tmpdir}/baseDir</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Indexing configuration goes here. --&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JVM heap memory</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing</span> <span class="attribute-name">storage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-heap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Additional indexing configuration goes here. --&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="index_reader"><a class="anchor" href="#index_reader"></a>Index reader</h5>
<div class="paragraph">
<p>The index reader is an internal component that provides access to the indexes to perform queries. As the index content changes, Infinispan needs to refresh the reader so that search results are up to date.
You can configure the refresh interval for the index reader.
By default Infinispan reads the index before each query if the index changed since the last refresh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing</span> <span class="attribute-name">storage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filesystem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${java.io.tmpdir}/baseDir</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Sets an interval of one second for the index reader. --&gt;</span>
    <span class="tag">&lt;index-reader</span> <span class="attribute-name">refresh-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Additional indexing configuration goes here. --&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="index_writer"><a class="anchor" href="#index_writer"></a>Index writer</h5>
<div class="paragraph">
<p>The index writer is an internal component that constructs an index composed of one or more segments (sub-indexes) that can be merged over time to improve performance.
Fewer segments usually means less overhead during a query because index reader operations need to take into account all segments.</p>
</div>
<div class="paragraph">
<p>Infinispan uses Apache Lucene internally and indexes entries in two tiers: memory and storage.
New entries go to the memory index first and then, when a flush happens, to the configured index storage.
Periodic commit operations occur that create segments from the previously flushed data and make all the index changes permanent.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>index-writer</code> configuration is optional.
The defaults should work for most cases and custom configurations should only be used to tune performance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;indexing</span> <span class="attribute-name">storage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filesystem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${java.io.tmpdir}/baseDir</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;index-writer</span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">low-level-trace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">max-buffered-entries</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">32</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">queue-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">queue-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">ram-buffer-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">thread-pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;index-merge</span> <span class="attribute-name">calibrate-by-deletes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">factor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">max-entries</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">min-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">max-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/index-writer&gt;</span>
    <span class="comment">&lt;!-- Additional indexing configuration goes here. --&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Index writer configuration attributes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commit-interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time, in milliseconds, that index changes that are buffered in memory are flushed to the index storage and a commit is performed. Because operation is costly, small values should be avoided. The default is 1000 ms (1 second).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-buffered-entries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of entries that can be buffered in-memory before they are flushed to the index storage. Large values result in faster indexing but use more memory. When used in combination with the <code>ram-buffer-size</code> attribute, a flush occurs for whichever event happens first.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ram-buffer-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum amount of memory that can be used for buffering added entries and deletions before they are flushed to the index storage. Large values result in faster indexing but use more memory. For faster indexing performance you should set this attribute instead of <code>max-buffered-entries</code>. When used in combination with the <code>max-buffered-entries</code> attribute, a flush occurs for whichever event happens first.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thread-pool-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads that execute write operations to the index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queue-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of internal queues to use for each indexed type. Each queue holds a batch of modifications that is applied to the index and queues are processed in parallel. Increasing the number of queues will lead to an increase of indexing throughput, but only if the bottleneck is CPU. For optimum results, do not set a value for <code>queue-count</code> that is larger than the value for <code>thread-pool-size</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queue-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of elements each queue can hold. Increasing the <code>queue-size</code> value increases the amount of memory that is used during indexing operations. Setting a value that is too small can block indexing operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>low-level-trace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables low-level trace information for indexing operations. Enabling this attribute substantially degrades performance. You should use this low-level tracing only as a last resource for troubleshooting.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To configure how Infinispan merges index segments, you use the <code>index-merge</code> sub-element.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Index merge configuration attributes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-entries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of entries that an index segment can have before merging. Segments with more than this number of entries are not merged. Smaller values perform better on frequently changing indexes, larger values provide better search performance if the index does not change often.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>factor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of segments that are merged at once. With smaller values, merging happens more often, which uses more resources, but the total number of segments will be lower on average, increasing search performance. Larger values (greater than 10) are best for heavy writing scenarios.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum target size of segments, in MB, for background merges. Segments smaller than this size are merged more aggressively. Setting a value that is too large might result in expensive merge operations, even though they are less frequent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size of segments, in MB, for background merges. Segments larger than this size are never merged in the background. Settings this to a lower value helps reduce memory requirements and avoids some merging operations at the cost of optimal search speed. This attribute is ignored when forcefully merging an index and <code>max-forced-size</code> applies instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-forced-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size of segments, in MB, for forced merges and overrides the <code>max-size</code> attribute. Set this to the same value as <code>max-size</code> or lower. However setting the value too low degrades search performance because documents are deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>calibrate-by-deletes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the number of deleted entries in an index should be taken into account when counting the entries in the segment. Setting <code>false</code> will lead to more frequent merges caused by <code>max-entries</code>, but will more aggressively merge segments with many deleted documents, improving query performance.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="indexing-annotations_indexing-caches"><a class="anchor" href="#indexing-annotations_indexing-caches"></a>1.2. Indexing annotations</h3>
<div class="paragraph">
<p>When you enable indexing in caches, you configure Infinispan to create indexes.
You also need to provide Infinispan with a structured representation of the entities in your caches so it can actually index them.</p>
</div>
<div class="paragraph">
<p>There are two annotations that control the entities and fields that Infinispan indexes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@Indexed</code></dt>
<dd>
<p>Indicates entities, or Protobuf message types, that Infinispan indexes.</p>
</dd>
<dt class="hdlist1"><code>@Field</code></dt>
<dd>
<p>Indicates fields that Infinispan indexes and has the following attributes:</p>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls if Infinispan includes fields in indexes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Index.YES</code> or <code>Index.NO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows Infinispan to store fields in indexes so you can use them for projections.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Store.YES</code> or <code>Store.NO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>analyze</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes fields in full-text searches.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Analyze.NO</code> or specifies an analyzer definition</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<h4 id="remote_caches" class="discrete">Remote caches</h4>
<div class="paragraph">
<p>You can provide Infinispan with indexing annotations for remote caches in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotate your Java classes directly with <code>@ProtoDoc("@Indexed")</code> and <code>@ProtoDoc("@Field(&#8230;&#8203;)")</code>.<br>
You then generate Protobuf schema, <code>.proto</code> files, before uploading them to Infinispan Server.</p>
</li>
<li>
<p>Annotate Protobuf schema directly with <code>@Indexed</code> and <code>@Field(&#8230;&#8203;)</code>.<br>
You then upload your Protobuf schema to Infinispan Server.</p>
<div class="paragraph">
<p>For example, the following schema uses the <code>@Field</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">/**
   * @Field(analyze = Analyze.YES, store = Store.YES)
   */</span>
required string street = <span class="integer">1</span>;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="embedded_caches" class="discrete">Embedded caches</h4>
<div class="paragraph">
<p>For embedded caches, you add indexing annotations to your Java classes according to how Infinispan stores your entries.</p>
</div>
<div class="paragraph">
<p>Use the <code>@Indexed</code> and <code>@Field</code> annotations, along with other Hibernate Search annotations such as <code>@FullTextField</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="rebuilding-indexes_indexing-caches"><a class="anchor" href="#rebuilding-indexes_indexing-caches"></a>1.3. Rebuilding indexes</h3>
<div class="paragraph">
<p>Rebuilding an index reconstructs it from the data stored in the cache.
You should rebuild indexes when you change things like the definitions of indexed types or analyzers.
Likewise, you can rebuild indexes after you delete them for whatever reason.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rebuilding indexes can take a long time to complete because the process takes place for all data in the grid.
While the rebuild operation is in progress, queries might also return fewer results.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Rebuild indexes in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Call the <code>reindexCache()</code> method to programmatically rebuild an index from a Hot Rod Java client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remoteCacheManager.administration().reindexCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyCache</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For remote caches you can also rebuild indexes from Infinispan Console.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Call the <code>index.run()</code> method to rebuild indexes for embedded caches as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Indexer indexer = Search.getIndexer(cache);
CompletionStage&lt;<span class="predefined-type">Void</span>&gt; future = index.run();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="non-indexed-queries_indexing-caches"><a class="anchor" href="#non-indexed-queries_indexing-caches"></a>1.4. Non-indexed queries</h3>
<div class="paragraph">
<p>Infinispan recommends indexing caches for the best performance for queries.
However you can query caches that are non-indexed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For embedded caches, you can perform non-indexed queries on Plain Old Java Objects (POJOs).</p>
</li>
<li>
<p>For remote caches, you must use ProtoStream encoding with the <code>application/x-protostream</code> media type to perform non-indexed queries.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ickle-query-language"><a class="anchor" href="#ickle-query-language"></a>2. Creating Ickle queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides an Ickle query language that lets you create relational and full-text queries.</p>
</div>
<div class="sect2">
<h3 id="ickle-queries_ickle-query-language"><a class="anchor" href="#ickle-queries_ickle-query-language"></a>2.1. Ickle queries</h3>
<div class="paragraph">
<p>To use the API, first obtain a QueryFactory to the cache and then call the <code>.create()</code> method, passing in the string to use in the query.
Each <code>QueryFactory</code> instance is bound to the same <code>Cache</code> instance as the <code>Search</code>, but it is otherwise a stateless and thread-safe object that can be used for creating multiple queries in parallel.</p>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Remote Query, using protobuf</span>
QueryFactory qf = org.infinispan.client.hotrod.Search.getQueryFactory(remoteCache);
<span class="predefined-type">Query</span>&lt;Transaction&gt; q = qf.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">from sample_bank_account.Transaction where amount &gt; 20</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Embedded Query using Java Objects</span>
QueryFactory qf = org.infinispan.query.Search.getQueryFactory(cache);
<span class="predefined-type">Query</span>&lt;Transaction&gt; q = qf.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">from org.infinispan.sample.Book where price &gt; 20</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Execute the query</span>
QueryResult&lt;<span class="predefined-type">Book</span>&gt; queryResult = q.execute();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A query will always target a single entity type and is evaluated over the contents of a single cache. Running a query over multiple caches or creating queries that target several entity types (joins) is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Executing the query and fetching the results is as simple as invoking the <code>execute()</code> method of the <code>Query</code> object. Once
executed, calling <code>execute()</code> on the same instance will re-execute the query.</p>
</div>
<div class="sect3">
<h4 id="pagination"><a class="anchor" href="#pagination"></a>2.1.1. Pagination</h4>
<div class="paragraph">
<p>You can limit the number of returned results by using  the <code>Query.maxResults(int maxResults)</code>. This can be used in
conjunction with <code>Query.startOffset(long startOffset)</code> to achieve pagination of the result set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sorted by year and match all books that have &quot;clustering&quot; in their title</span>
<span class="comment">// and return the third page of 10 results</span>
<span class="predefined-type">Query</span>&lt;<span class="predefined-type">Book</span>&gt; query = queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM org.infinispan.sample.Book WHERE title like '%clustering%' ORDER BY year</span><span class="delimiter">&quot;</span></span>).startOffset(<span class="integer">20</span>).maxResults(<span class="integer">10</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="number_of_hits"><a class="anchor" href="#number_of_hits"></a>2.1.2. Number of hits</h4>
<div class="paragraph">
<p>The <code>QueryResult</code> object has the <code>.hitCount()</code> method to return the total number of results of the query, regardless
of any pagination parameter. The hit count is only available for indexed queries for performance reasons.</p>
</div>
</div>
<div class="sect3">
<h4 id="iteration"><a class="anchor" href="#iteration"></a>2.1.3. Iteration</h4>
<div class="paragraph">
<p>The <code>Query</code> object has the <code>.iterator()</code> method to obtain the results lazily. It returns an instance of <code>CloseableIterator</code> that must be closed after usage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The iteration support for Remote Queries is currently limited, as it will first fetch all entries to the client
before iterating.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="named_query_parameters"><a class="anchor" href="#named_query_parameters"></a>2.1.4. Named query parameters</h4>
<div class="paragraph">
<p>Instead of building a new Query object for every execution it is possible to include named parameters in the query which
can be substituted with actual values before execution. This allows a query to be defined once and be efficiently
executed many times. Parameters can only be used on the right-hand side of an operator and are defined when the query is
created by supplying an object produced by the <code>org.infinispan.query.dsl.Expression.param(String paramName)</code> method to
the operator instead of the usual constant value. Once the parameters have been defined they can be set by invoking either
<code>Query.setParameter(parameterName, value)</code> or <code>Query.setParameters(parameterMap)</code> as shown in the examples below.
⁠</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryFactory queryFactory = Search.getQueryFactory(cache);
<span class="comment">// Defining a query to search for various authors and publication years</span>
<span class="predefined-type">Query</span>&lt;<span class="predefined-type">Book</span>&gt; query = queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT title FROM org.infinispan.sample.Book WHERE author = :authorName AND publicationYear = :publicationYear</span><span class="delimiter">&quot;</span></span>).build();

<span class="comment">// Set actual parameter values</span>
query.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">authorName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>);
query.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>, <span class="integer">2010</span>);

<span class="comment">// Execute the query</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; found = query.execute().list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can supply a map of actual parameter values to set multiple parameters at once:
⁠</p>
</div>
<div class="listingblock">
<div class="title">Setting multiple named parameters at once</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; parameterMap = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
parameterMap.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">authorName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>);
parameterMap.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>, <span class="integer">2010</span>);

query.setParameters(parameterMap);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A significant portion of the query parsing, validation and execution planning effort is performed during the first
execution of a query with parameters. This effort is not repeated during subsequent executions leading to better
performance compared to a similar query using constant values instead of query parameters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="query_execution"><a class="anchor" href="#query_execution"></a>2.1.5. Query execution</h4>
<div class="paragraph">
<p>The <code>Query</code> API provides two methods for executing Ickle queries on a cache:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Query.execute()</code> runs a SELECT statement and returns a result.</p>
</li>
<li>
<p><code>Query.executeStatement()</code> runs a DELETE statement and modifies data.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should always invoke <code>executeStatement()</code> to modify data and invoke <code>execute()</code> to get the result of a query.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/query/dsl/Query.html#execute()">org.infinispan.query.dsl.Query.execute()</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/query/dsl/Query.html#executeStatement()">org.infinispan.query.dsl.Query.executeStatement()</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ickle-query-syntax_ickle-query-language"><a class="anchor" href="#ickle-query-syntax_ickle-query-language"></a>2.2. Ickle query language syntax</h3>
<div class="paragraph">
<p>The Ickle query language is subset of the <a href="https://en.wikipedia.org/wiki/Java_Persistence_Query_Language">JPQL</a> query language, with some extensions for full-text.</p>
</div>
<div class="paragraph">
<p>The parser syntax has some notable rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Whitespace is not significant.</p>
</li>
<li>
<p>Wildcards are not supported in field names.</p>
</li>
<li>
<p>A field name or path must always be specified, as there is no default field.</p>
</li>
<li>
<p><code>&amp;&amp;</code> and <code>||</code> are accepted instead of <code>AND</code> or <code>OR</code> in both full-text and JPA predicates.</p>
</li>
<li>
<p><code>!</code> may be used instead of <code>NOT</code>.</p>
</li>
<li>
<p>A missing boolean operator is interpreted as <code>OR</code>.</p>
</li>
<li>
<p>String terms must be enclosed with either single or double quotes.</p>
</li>
<li>
<p>Fuzziness and boosting are not accepted in arbitrary order; fuzziness always comes first.</p>
</li>
<li>
<p><code>!=</code> is accepted instead of <code>&lt;&gt;</code>.</p>
</li>
<li>
<p>Boosting cannot be applied to <code>&gt;</code>,<code>&gt;=</code>,<code>&lt;</code>,<code>&lt;=</code> operators. Ranges may be used to achieve the same result.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="filtering_operators"><a class="anchor" href="#filtering_operators"></a>2.2.1. Filtering operators</h4>
<div class="paragraph">
<p>Ickle support many filtering operators that can be used for both indexed and non-indexed fields.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left operand is equal to one of the elements from the Collection of values given as argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE isbn IN ('ZZ', 'X1234')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be a String) matches a wildcard pattern that follows the JPA rules.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE title LIKE '%Java%'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is an exact match of the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE name = 'Programming Java'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is different from the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE language != 'English'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is greater than the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE price &gt; 20</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is greater than or equal to the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE price &gt;= 20</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is less than the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE year &lt; 2020</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is less than or equal to the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE price  &#8656; 50</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is between the given range limits.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM Book WHERE price BETWEEN 50 AND 100</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="boolean_conditions"><a class="anchor" href="#boolean_conditions"></a>2.2.2. Boolean conditions</h4>
<div class="paragraph">
<p>Combining multiple attribute conditions with logical conjunction (<code>and</code>) and disjunction (<code>or</code>) operators in order to
create more complex conditions is demonstrated in the following example. The well known operator precedence rule for
boolean operators applies here, so the order of the operators is irrelevant. Here <code>and</code>
operator still has higher priority than <code>or</code> even though <code>or</code> was invoked first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="comment"># match all books that have &quot;Data Grid&quot; in their title</span>
<span class="comment"># or have an author named &quot;Manik&quot; and their description contains &quot;clustering&quot;</span>

<span class="keyword">FROM</span> org.infinispan.sample.Book <span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> <span class="string"><span class="delimiter">'</span><span class="content">%Data Grid%</span><span class="delimiter">'</span></span> <span class="keyword">OR</span> author.name = <span class="string"><span class="delimiter">'</span><span class="content">Manik</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> description <span class="keyword">like</span> <span class="string"><span class="delimiter">'</span><span class="content">%clustering%</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Boolean negation has highest precedence among logical operators and applies only to the next simple attribute condition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="comment"># match all books that do not have &quot;Data Grid&quot; in their title and are authored by &quot;Manik&quot;</span>
<span class="keyword">FROM</span> org.infinispan.sample.Book <span class="keyword">WHERE</span> title != <span class="string"><span class="delimiter">'</span><span class="content">Data Grid</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> author.name = <span class="string"><span class="delimiter">'</span><span class="content">Manik</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nested_conditions"><a class="anchor" href="#nested_conditions"></a>2.2.3. Nested conditions</h4>
<div class="paragraph">
<p>Changing the precedence of logical operators is achieved with parenthesis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="comment"># match all books that have an author named &quot;Manik&quot; and their title contains</span>
<span class="comment"># &quot;Data Grid&quot; or their description contains &quot;clustering&quot;</span>
<span class="keyword">FROM</span> org.infinispan.sample.Book <span class="keyword">WHERE</span> author.name = <span class="string"><span class="delimiter">'</span><span class="content">Manik</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> ( title <span class="keyword">like</span> <span class="string"><span class="delimiter">'</span><span class="content">%Data Grid%</span><span class="delimiter">'</span></span> <span class="keyword">OR</span> description <span class="keyword">like</span> <span class="string"><span class="delimiter">'</span><span class="content">% clustering%</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="projections_with_select_statements"><a class="anchor" href="#projections_with_select_statements"></a>2.2.4. Projections with SELECT statements</h4>
<div class="paragraph">
<p>In some use cases returning the whole domain object is overkill if only a small subset of the attributes are actually
used by the application, especially if the domain entity has embedded entities. The query language allows you to specify
a subset of attributes (or attribute paths) to return - the projection. If projections are used then the <code>QueryResult.list()</code>
will not return the whole domain entity but will return a <code>List</code> of <code>Object[]</code>, each slot in the array corresponding to
a projected attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="comment"># match all books that have &quot;Data Grid&quot; in their title or description</span>
<span class="comment"># and return only their title and publication year</span>
<span class="class">SELECT</span> title, publicationYear <span class="keyword">FROM</span> org.infinispan.sample.Book <span class="keyword">WHERE</span> title <span class="keyword">like</span> <span class="string"><span class="delimiter">'</span><span class="content">%Data Grid%</span><span class="delimiter">'</span></span> <span class="keyword">OR</span> description <span class="keyword">like</span> <span class="string"><span class="delimiter">'</span><span class="content">%Data Grid%</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<h4 id="sorting" class="discrete">Sorting</h4>
<div class="paragraph">
<p>Ordering the results based on one or more attributes or attribute paths is done with the <code>ORDER BY</code> clause. If multiple sorting criteria
are specified, then the order will dictate their precedence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="comment"># match all books that have &quot;Data Grid&quot; in their title or description</span>
<span class="comment"># and return them sorted by the publication year and title</span>
<span class="keyword">FROM</span> org.infinispan.sample.Book <span class="keyword">WHERE</span> title <span class="keyword">like</span> <span class="string"><span class="delimiter">'</span><span class="content">%Data Grid%</span><span class="delimiter">'</span></span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> publicationYear <span class="directive">DESC</span>, title <span class="directive">ASC</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="grouping_and_aggregation"><a class="anchor" href="#grouping_and_aggregation"></a>2.2.5. Grouping and aggregation</h4>
<div class="paragraph">
<p>Infinispan has the ability to group query results according to a set of grouping fields and construct aggregations of
the results from each group by applying an aggregation function to the set of values that fall into each group.
Grouping and aggregation can only be applied to projection queries (queries with one or more field in the SELECT clause).</p>
</div>
<div class="paragraph">
<p>The supported aggregations are: <code>avg</code>, <code>sum</code>, <code>count</code>, <code>max</code>, and <code>min</code>.</p>
</div>
<div class="paragraph">
<p>The set of grouping fields is specified with the <code>GROUP BY</code> clause and the order used for defining grouping fields is
not relevant. All fields selected in the projection must either be grouping fields
or else they must be aggregated using one of the grouping functions described below. A projection field can be
aggregated and used for grouping at the same time. A query that selects only grouping fields but no aggregation fields
is legal.
⁠
Example: Grouping Books by author and counting them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> author, <span class="predefined">COUNT</span>(title) <span class="keyword">FROM</span> org.infinispan.sample.Book <span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> <span class="string"><span class="delimiter">'</span><span class="content">%engine%</span><span class="delimiter">'</span></span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> author</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A projection query in which all selected fields have an aggregation function applied and no fields are used for
grouping is allowed. In this case the aggregations will be computed globally as if there was a single global group.</p>
</div>
</td>
</tr>
</table>
</div>
<h5 id="aggregations" class="discrete">Aggregations</h5>
<div class="paragraph">
<p>You can apply the following aggregation functions to a field:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Index merge attributes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aggregation function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>avg()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the average of a set of numbers. Accepted values are primitive numbers and instances of <code>java.lang.Number</code>. The result is represented as <code>java.lang.Double</code>. If there are no non-null values the result is <code>null</code> instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of non-null rows and returns a <code>java.lang.Long</code>. If there are no non-null values the result is <code>0</code> instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the greatest value found. Accepted values must be instances of <code>java.lang.Comparable</code>. If there are no non-null values the result is <code>null</code> instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the smallest value found. Accepted values must be instances of <code>java.lang.Comparable</code>. If there are no non-null values the result is <code>null</code> instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sum()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the sum of a set of Numbers. If there are no non-null values the result is <code>null</code> instead. The following table indicates the return type based on the specified field.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Table sum return type</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Type</th>
<th class="tableblock halign-left valign-top">Return Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integral (other than BigInteger)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float or Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
</tbody>
</table>
<h5 id="evaluation_of_queries_with_grouping_and_aggregation" class="discrete">Evaluation of queries with grouping and aggregation</h5>
<div class="paragraph">
<p>Aggregation queries can include filtering conditions, like usual queries. Filtering can be performed in two stages: before
and after the grouping operation. All filter conditions defined before invoking the <code>groupBy()</code> method will be applied
before the grouping operation is performed, directly to the cache entries (not to the final projection). These filter
conditions can reference any fields of the queried entity type, and are meant to restrict the data set that is going to
be the input for the grouping stage. All filter conditions defined after invoking the <code>groupBy()</code> method will be applied to
the projection that results from the projection and grouping operation. These filter conditions can either reference any
of the <code>groupBy()</code> fields or aggregated fields. Referencing aggregated fields that are not specified in the select clause
is allowed; however, referencing non-aggregated and non-grouping fields is forbidden. Filtering in this phase will
reduce the amount of groups based on their properties. Sorting can also be specified similar to usual queries. The
ordering operation is performed after the grouping operation and can reference any of the <code>groupBy()</code> fields or aggregated
fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="delete_statements"><a class="anchor" href="#delete_statements"></a>2.2.6. DELETE statements</h4>
<div class="paragraph">
<p>You can delete entities from Infinispan caches with the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">DELETE</span> <span class="keyword">FROM</span> &lt;entityName&gt; [<span class="keyword">WHERE</span> condition]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Reference only single entities with <code>&lt;entityName&gt;</code>. DELETE queries cannot use joins.</p>
</li>
<li>
<p>WHERE conditions are optional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DELETE queries cannot use any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Projections with SELECT statements</p>
</li>
<li>
<p>Grouping and aggregation</p>
</li>
<li>
<p>ORDER BY clauses</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Invoke the <code>Query.executeStatement()</code> method to execute DELETE statements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/query/dsl/Query.html#executeStatement()">org.infinispan.query.dsl.Query.executeStatement()</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="full-text-search_ickle-query-language"><a class="anchor" href="#full-text-search_ickle-query-language"></a>2.3. Full-text queries</h3>
<div class="paragraph">
<p>You can perform full-text searches with the Ickle query language.</p>
</div>
<div class="sect3">
<h4 id="fuzzy_queries"><a class="anchor" href="#fuzzy_queries"></a>2.3.1. Fuzzy queries</h4>
<div class="paragraph">
<p>To execute a fuzzy query add <code>~</code> along with an integer, representing the distance from the term used, after the term.
For instance</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_bank_account.Transaction <span class="keyword">WHERE</span> description : <span class="string"><span class="delimiter">'</span><span class="content">cofee</span><span class="delimiter">'</span></span>~<span class="integer">2</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="range_queries"><a class="anchor" href="#range_queries"></a>2.3.2. Range queries</h4>
<div class="paragraph">
<p>To execute a range query define the given boundaries within a pair of braces, as seen in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_bank_account.Transaction <span class="keyword">WHERE</span> amount : [<span class="integer">20</span> <span class="keyword">to</span> <span class="integer">50</span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="phrase_queries"><a class="anchor" href="#phrase_queries"></a>2.3.3. Phrase queries</h4>
<div class="paragraph">
<p>A group of words can be searched by surrounding them in quotation marks, as seen in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_bank_account.Transaction <span class="keyword">WHERE</span> description : <span class="string"><span class="delimiter">'</span><span class="content">bus fare</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proximity_queries"><a class="anchor" href="#proximity_queries"></a>2.3.4. Proximity queries</h4>
<div class="paragraph">
<p>To execute a proximity query, finding two terms within a specific distance, add a <code>~</code> along with the distance after the phrase.
For instance, the following example will find the words canceling and fee provided they are not more than 3 words apart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_bank_account.Transaction <span class="keyword">WHERE</span> description : <span class="string"><span class="delimiter">'</span><span class="content">canceling fee</span><span class="delimiter">'</span></span>~<span class="integer">3</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wildcard_queries"><a class="anchor" href="#wildcard_queries"></a>2.3.5. Wildcard queries</h4>
<div class="paragraph">
<p>To search for "text" or "test", use the <code>?</code> single-character wildcard search:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_bank_account.Transaction <span class="keyword">where</span> description : <span class="string"><span class="delimiter">'</span><span class="content">te?t</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To search for "test", "tests", or "tester", use the <code>*</code> multi-character wildcard search:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_bank_account.Transaction <span class="keyword">where</span> description : <span class="string"><span class="delimiter">'</span><span class="content">test*</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="regular_expression_queries"><a class="anchor" href="#regular_expression_queries"></a>2.3.6. Regular expression queries</h4>
<div class="paragraph">
<p>Regular expression queries can be performed by specifying a pattern between <code>/</code>. Ickle uses Lucene’s regular expression syntax, so to search for the words <code>moat</code> or <code>boat</code> the following could be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_library.Book  <span class="keyword">where</span> title : /[mb]oat/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boosting_queries"><a class="anchor" href="#boosting_queries"></a>2.3.7. Boosting queries</h4>
<div class="paragraph">
<p>Terms can be boosted by adding a <code>^</code> after the term to increase their relevance in a given query, the higher the boost factor the more relevant the term will be. For instance to search for titles containing beer and wine with a higher relevance on beer, by a factor of 3, the following could be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> sample_library.Book <span class="keyword">WHERE</span> title : beer^<span class="integer">3</span> <span class="keyword">OR</span> wine</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-remote"><a class="anchor" href="#query-remote"></a>3. Querying remote caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can index and query remote caches on Infinispan Server.</p>
</div>
<div class="sect2">
<h3 id="querying-hot-rod_query-remote"><a class="anchor" href="#querying-hot-rod_query-remote"></a>3.1. Querying caches from Hot Rod Java clients</h3>
<div class="paragraph">
<p>Infinispan lets you programmatically query remote caches from Java clients through the Hot Rod endpoint.
This procedure explains how to index query a remote cache that stores <code>Book</code> instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add the ProtoStream processor to your <code>pom.xml</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan provides this processor for the <code>@ProtoField</code> and <code>@ProtoDoc</code> annotations so you can generate Protobuf schemas and perform queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>infinispan-bom<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="tag">&lt;dependencies&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.infinispan.protostream<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>protostream-processor<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add indexing annotations to your class, as in the following example:</p>
<div class="listingblock">
<div class="title">Book.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoDoc</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.ProtoField</span>;

<span class="annotation">@ProtoDoc</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@Indexed</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {

   <span class="annotation">@ProtoDoc</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@Field(index=Index.YES, analyze = Analyze.YES, store = Store.NO)</span><span class="delimiter">&quot;</span></span>)
   <span class="annotation">@ProtoField</span>(number = <span class="integer">1</span>)
   <span class="directive">final</span> <span class="predefined-type">String</span> title;

   <span class="annotation">@ProtoDoc</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@Field(index=Index.YES, analyze = Analyze.YES, store = Store.NO)</span><span class="delimiter">&quot;</span></span>)
   <span class="annotation">@ProtoField</span>(number = <span class="integer">2</span>)
   <span class="directive">final</span> <span class="predefined-type">String</span> description;

   <span class="annotation">@ProtoDoc</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@Field(index=Index.YES, analyze = Analyze.YES, store = Store.NO)</span><span class="delimiter">&quot;</span></span>)
   <span class="annotation">@ProtoField</span>(number = <span class="integer">3</span>, defaultValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>)
   <span class="directive">final</span> <span class="type">int</span> publicationYear;


   <span class="annotation">@ProtoFactory</span>
   <span class="predefined-type">Book</span>(<span class="predefined-type">String</span> title, <span class="predefined-type">String</span> description, <span class="type">int</span> publicationYear) {
      <span class="local-variable">this</span>.title = title;
      <span class="local-variable">this</span>.description = description;
      <span class="local-variable">this</span>.publicationYear = publicationYear;
   }
   <span class="comment">// public Getter methods omitted for brevity</span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Implement the <code>SerializationContextInitializer</code> interface in a new class and then add the <code>@AutoProtoSchemaBuilder</code> annotation.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Reference the class that includes the <code>@ProtoField</code> and <code>@ProtoDoc</code> annotations with the <code>includeClasses</code> parameter.</p>
</li>
<li>
<p>Define a name for the Protobuf schema that you generate and filesystem path with the <code>schemaFileName</code> and <code>schemaFilePath</code> parameters.</p>
</li>
<li>
<p>Specify the package name for the Protobuf schema with the <code>schemaPackageName</code> parameter.</p>
<div class="listingblock">
<div class="title">RemoteQueryInitializer.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.SerializationContextInitializer</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.annotations.AutoProtoSchemaBuilder</span>;

<span class="annotation">@AutoProtoSchemaBuilder</span>(
      includeClasses = {
            <span class="predefined-type">Book</span>.class
      },
      schemaFileName = <span class="string"><span class="delimiter">&quot;</span><span class="content">book.proto</span><span class="delimiter">&quot;</span></span>,
      schemaFilePath = <span class="string"><span class="delimiter">&quot;</span><span class="content">proto/</span><span class="delimiter">&quot;</span></span>,
      schemaPackageName = <span class="string"><span class="delimiter">&quot;</span><span class="content">book_sample</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">RemoteQueryInitializer</span> <span class="directive">extends</span> SerializationContextInitializer {
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Compile your project.</p>
<div class="paragraph">
<p>The code examples in this procedure generate a <code>proto/book.proto</code> schema and an <code>RemoteQueryInitializerImpl.java</code> implementation of the annotated <code>Book</code> class.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Create a remote cache that configures Infinispan to index your entities.
For example, the following remote cache indexes the <code>Book</code> entity in the <code>book.proto</code> schema that you generated in the previous step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;indexing&gt;</span>
    <span class="tag">&lt;indexed-entities&gt;</span>
      <span class="tag">&lt;indexed-entity&gt;</span>book_sample.Book<span class="tag">&lt;/indexed-entity&gt;</span>
    <span class="tag">&lt;/indexed-entities&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <code>RemoteQuery</code> class does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Registers the <code>RemoteQueryInitializerImpl</code> serialization context with a Hot Rod Java client.</p>
</li>
<li>
<p>Registers the Protobuf schema, <code>book.proto</code>, with Infinispan Server.</p>
</li>
<li>
<p>Adds two <code>Book</code> instances to the remote cache.</p>
</li>
<li>
<p>Performs a full-text query that matches books by keywords in the title.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">RemoteQuery.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.infinispan</span>;

<span class="keyword">import</span> <span class="include">java.nio.file.Files</span>;
<span class="keyword">import</span> <span class="include">java.nio.file.Path</span>;
<span class="keyword">import</span> <span class="include">java.nio.file.Paths</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.RemoteCache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.RemoteCacheManager</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.Search</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.dsl.Query</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.dsl.QueryFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.remote.client.ProtobufMetadataManagerConstants</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">RemoteQuery</span> {

   <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
      ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
      <span class="comment">// RemoteQueryInitializerImpl is generated</span>
      clientBuilder.addServer().host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>).port(<span class="integer">11222</span>)
            .security().authentication().username(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>).password(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>)
            .addContextInitializers(<span class="keyword">new</span> RemoteQueryInitializerImpl());

      RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());

      <span class="comment">// Grab the generated protobuf schema and registers in the server.</span>
      Path proto = Paths.get(RemoteQuery.class.getClassLoader()
            .getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">proto/book.proto</span><span class="delimiter">&quot;</span></span>).toURI());
      <span class="predefined-type">String</span> protoBufCacheName = ProtobufMetadataManagerConstants.PROTOBUF_METADATA_CACHE_NAME;
      remoteCacheManager.getCache(protoBufCacheName).put(<span class="string"><span class="delimiter">&quot;</span><span class="content">book.proto</span><span class="delimiter">&quot;</span></span>, Files.readString(proto));

      <span class="comment">// Obtain the 'books' remote cache</span>
      RemoteCache&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; remoteCache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>);

      <span class="comment">// Add some Books</span>
      <span class="predefined-type">Book</span> book1 = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Infinispan in Action</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Learn Infinispan with using it</span><span class="delimiter">&quot;</span></span>, <span class="integer">2015</span>);
      <span class="predefined-type">Book</span> book2 = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cloud-Native Applications with Java and Quarkus</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Build robust and reliable cloud applications</span><span class="delimiter">&quot;</span></span>, <span class="integer">2019</span>);

      remoteCache.put(<span class="integer">1</span>, book1);
      remoteCache.put(<span class="integer">2</span>, book2);

      <span class="comment">// Execute a full-text query</span>
      QueryFactory queryFactory = Search.getQueryFactory(remoteCache);
      <span class="predefined-type">Query</span>&lt;<span class="predefined-type">Book</span>&gt; query = queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM book_sample.Book WHERE title:'java'</span><span class="delimiter">&quot;</span></span>);

      <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; list = query.execute().list(); <span class="comment">// Voila! We have our book back from the cache!</span>
   }
}</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../encoding/encoding.html">Marshalling and Encoding Data</a> for more information about creating serialization contexts and registering Protobuf schema.</p>
</li>
<li>
<p><a href="../encoding/encoding.html#protostream-annotations_marshalling">ProtoStream annotations</a> for more information about the <code>@ProtoField</code>, <code>@ProtoDoc</code>, and <code>@AutoProtoSchemaBuilder</code> annotations.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="querying-console_query-remote"><a class="anchor" href="#querying-console_query-remote"></a>3.2. Querying caches from Infinispan Console and CLI</h3>
<div class="paragraph">
<p>Infinispan Console and the Infinispan Command Line Interface (CLI) let you query indexed and non-indexed remote caches.
You can also use any HTTP client to index and query caches via the REST API.</p>
</div>
<div class="paragraph">
<p>This procedure explains how to index and query a remote cache that stores <code>Person</code> instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have at least one running Infinispan Server instance.</p>
</li>
<li>
<p>Have Infinispan credentials with create permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add indexing annotations to your Protobuf schema, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json"><span class="error">p</span><span class="error">a</span><span class="error">c</span><span class="error">k</span><span class="error">a</span><span class="error">g</span><span class="error">e</span> <span class="error">o</span><span class="error">r</span><span class="error">g</span><span class="error">.</span><span class="error">i</span><span class="error">n</span><span class="error">f</span><span class="error">i</span><span class="error">n</span><span class="error">i</span><span class="error">s</span><span class="error">p</span><span class="error">a</span><span class="error">n</span><span class="error">.</span><span class="error">e</span><span class="error">x</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">;</span>

<span class="error">/</span><span class="error">*</span> <span class="error">@</span><span class="error">I</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">e</span><span class="error">d</span> <span class="error">*</span><span class="error">/</span>
<span class="error">m</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">a</span><span class="error">g</span><span class="error">e</span> <span class="error">P</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">o</span><span class="error">n</span> {
    <span class="error">/</span><span class="error">*</span> <span class="error">@</span><span class="error">F</span><span class="error">i</span><span class="error">e</span><span class="error">l</span><span class="error">d</span><span class="error">(</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">=</span><span class="error">I</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">s</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span> <span class="error">=</span> <span class="error">S</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span><span class="error">.</span><span class="error">N</span><span class="error">O</span>, <span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span> <span class="error">=</span> <span class="error">A</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">.</span><span class="error">N</span><span class="error">O</span><span class="error">)</span> <span class="error">*</span><span class="error">/</span>
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">i</span><span class="error">n</span><span class="error">t</span><span class="integer">32</span> <span class="error">i</span><span class="error">d</span> <span class="error">=</span> <span class="integer">1</span><span class="error">;</span>

    <span class="error">/</span><span class="error">*</span> <span class="error">@</span><span class="error">F</span><span class="error">i</span><span class="error">e</span><span class="error">l</span><span class="error">d</span><span class="error">(</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">=</span><span class="error">I</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">s</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span> <span class="error">=</span> <span class="error">S</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span> <span class="error">=</span> <span class="error">A</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">.</span><span class="error">N</span><span class="error">O</span><span class="error">)</span> <span class="error">*</span><span class="error">/</span>
    <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">i</span><span class="error">r</span><span class="error">e</span><span class="error">d</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">=</span> <span class="integer">2</span><span class="error">;</span>

    <span class="error">/</span><span class="error">*</span> <span class="error">@</span><span class="error">F</span><span class="error">i</span><span class="error">e</span><span class="error">l</span><span class="error">d</span><span class="error">(</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">=</span><span class="error">I</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">s</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span> <span class="error">=</span> <span class="error">S</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span> <span class="error">=</span> <span class="error">A</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">.</span><span class="error">N</span><span class="error">O</span><span class="error">)</span> <span class="error">*</span><span class="error">/</span>
    <span class="error">r</span><span class="error">e</span><span class="error">q</span><span class="error">u</span><span class="error">i</span><span class="error">r</span><span class="error">e</span><span class="error">d</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">s</span><span class="error">u</span><span class="error">r</span><span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">=</span> <span class="integer">3</span><span class="error">;</span>

    <span class="error">/</span><span class="error">*</span> <span class="error">@</span><span class="error">F</span><span class="error">i</span><span class="error">e</span><span class="error">l</span><span class="error">d</span><span class="error">(</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">=</span><span class="error">I</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">s</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span> <span class="error">=</span> <span class="error">S</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span><span class="error">.</span><span class="error">Y</span><span class="error">E</span><span class="error">S</span>, <span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span> <span class="error">=</span> <span class="error">A</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">.</span><span class="error">N</span><span class="error">O</span><span class="error">)</span> <span class="error">*</span><span class="error">/</span>
    <span class="error">o</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span> <span class="error">i</span><span class="error">n</span><span class="error">t</span><span class="integer">32</span> <span class="error">a</span><span class="error">g</span><span class="error">e</span> <span class="error">=</span> <span class="integer">6</span><span class="error">;</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the Infinispan CLI, use the <code class="command">schema</code> command with the <code class="command">--upload=</code> argument as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; schema --upload=person.proto person.proto</code></pre>
</div>
</div>
</li>
<li>
<p>Create a cache named <strong>people</strong> that uses ProtoStream encoding and configures Infinispan to index entities declared in your Protobuf schema.</p>
<div class="paragraph">
<p>The following cache indexes the <code>Person</code> entity from the previous step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json"><span class="error">&lt;</span><span class="error">d</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">b</span><span class="error">u</span><span class="error">t</span><span class="error">e</span><span class="error">d</span><span class="error">-</span><span class="error">c</span><span class="error">a</span><span class="error">c</span><span class="error">h</span><span class="error">e</span> <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">people</span><span class="delimiter">&quot;</span></span><span class="error">&gt;</span>
  <span class="error">&lt;</span><span class="error">e</span><span class="error">n</span><span class="error">c</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">m</span><span class="error">e</span><span class="error">d</span><span class="error">i</span><span class="error">a</span><span class="error">-</span><span class="error">t</span><span class="error">y</span><span class="error">p</span><span class="error">e</span><span class="error">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-protostream</span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="error">&gt;</span>
  <span class="error">&lt;</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">&gt;</span>
    <span class="error">&lt;</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">e</span><span class="error">d</span><span class="error">-</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">i</span><span class="error">e</span><span class="error">s</span><span class="error">&gt;</span>
      <span class="error">&lt;</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">e</span><span class="error">d</span><span class="error">-</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">&gt;</span><span class="error">o</span><span class="error">r</span><span class="error">g</span><span class="error">.</span><span class="error">i</span><span class="error">n</span><span class="error">f</span><span class="error">i</span><span class="error">n</span><span class="error">i</span><span class="error">s</span><span class="error">p</span><span class="error">a</span><span class="error">n</span><span class="error">.</span><span class="error">e</span><span class="error">x</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">.</span><span class="error">P</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">o</span><span class="error">n</span><span class="error">&lt;</span><span class="error">/</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">e</span><span class="error">d</span><span class="error">-</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="error">&gt;</span>
    <span class="error">&lt;</span><span class="error">/</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">e</span><span class="error">d</span><span class="error">-</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">i</span><span class="error">e</span><span class="error">s</span><span class="error">&gt;</span>
  <span class="error">&lt;</span><span class="error">/</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">&gt;</span>
<span class="error">&lt;</span><span class="error">/</span><span class="error">d</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">b</span><span class="error">u</span><span class="error">t</span><span class="error">e</span><span class="error">d</span><span class="error">-</span><span class="error">c</span><span class="error">a</span><span class="error">c</span><span class="error">h</span><span class="error">e</span><span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From the CLI, use the <code class="command">create cache</code> command with the <code class="command">--file=</code> argument as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; create cache --file=people.xml people</code></pre>
</div>
</div>
</li>
<li>
<p>Add entries to the cache.</p>
<div class="paragraph">
<p>To query a remote cache, it needs to contain some data.
For this example procedure, create entries that use the following JSON values:</p>
</div>
<div class="listingblock">
<div class="title">PersonOne</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.Person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">One</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:<span class="integer">44</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PersonTwo</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.Person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Two</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:<span class="integer">27</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PersonThree</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.example.Person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Three</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:<span class="integer">35</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the CLI, use the <code class="command">put</code> command with the <code class="command">--file=</code> argument to add each entry, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default/caches/people]&gt; put --encoding=application/json --file=personone.json personone</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>From Infinispan Console, you must select <strong>Custom Type</strong> for the <strong>Value content type</strong> field when you add values in JSON format with custom types .</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Query your remote cache.</p>
<div class="paragraph">
<p>From the CLI, use the <code class="command">query</code> command from the context of the remote cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default/caches/people]&gt; query &quot;from org.infinispan.example.Person p WHERE p.name='Person' ORDER BY p.age ASC&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query returns all entries with a name that matches <code>Person</code> by age in ascending order.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../rest/rest.html">Infinispan REST API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-analyzers_query-remote"><a class="anchor" href="#using-analyzers_query-remote"></a>3.3. Using analyzers with remote caches</h3>
<div class="paragraph">
<p>Analyzers convert input data into terms that you can index and query.
You specify analyzer definitions with the <code>@Field</code> annotation in your Java classes or directly in Protobuf schema.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Include the <code>Analyze.YES</code> attribute to indicate that the property is analyzed.</p>
</li>
<li>
<p>Specify the analyzer definition with the <code>@Analyzer</code> annotation.</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">Protobuf schema</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="protobuf">/* @Indexed */
message TestEntity {

    /* @Field(store = Store.YES, analyze = Analyze.YES, analyzer = @Analyzer(definition = &quot;keyword&quot;)) */
    optional string id = 1;

    /* @Field(store = Store.YES, analyze = Analyze.YES, analyzer = @Analyzer(definition = &quot;simple&quot;)) */
    optional string name = 2;
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Java classes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@ProtoDoc</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@Field(store = Store.YES, analyze = Analyze.YES, analyzer = @Analyzer(definition = </span><span class="char">\&quot;</span><span class="content">keyword</span><span class="char">\&quot;</span><span class="content">))</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ProtoField</span>(<span class="integer">1</span>)
<span class="directive">final</span> <span class="predefined-type">String</span> id;

<span class="annotation">@ProtoDoc</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@Field(store = Store.YES, analyze = Analyze.YES, analyzer = @Analyzer(definition = </span><span class="char">\&quot;</span><span class="content">simple</span><span class="char">\&quot;</span><span class="content">))</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ProtoField</span>(<span class="integer">2</span>)
<span class="directive">final</span> <span class="predefined-type">String</span> description;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="default-analyzers_query-remote"><a class="anchor" href="#default-analyzers_query-remote"></a>3.3.1. Default analyzer definitions</h4>
<div class="paragraph">
<p>Infinispan provides a set of default analyzer definitions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Definition</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>standard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Splits text fields into tokens, treating whitespace and punctuation as delimiters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tokenizes input streams by delimiting at non-letters and then converting all letters to lowercase characters. Whitespace and non-letters are discarded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>whitespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Splits text streams on whitespace and returns sequences of non-whitespace characters as tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Treats entire text fields as single tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stemmer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stems English words using the Snowball Porter filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ngram</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates n-gram tokens that are 3 grams in size by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Splits text fields into larger size tokens than the <code>standard</code> analyzer, treating whitespace as a delimiter and converts all letters to lowercase characters.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These analyzer definitions are based on Apache Lucene and are provided "as-is".
For more information about tokenizers, filters, and CharFilters, see the
appropriate Lucene documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-analyzers_query-remote"><a class="anchor" href="#creating-analyzers_query-remote"></a>3.3.2. Creating custom analyzer definitions</h4>
<div class="paragraph">
<p>Create custom analyzer definitions and add them to your Infinispan Server installations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Stop Infinispan Server if it is running.</p>
<div class="paragraph">
<p>Infinispan Server loads classes at startup only.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Implement the <code>ProgrammaticSearchMappingProvider</code> API.</p>
</li>
<li>
<p>Package your implementation in a JAR with the fully qualified class (FQN) in the following file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>META-INF/services/org.infinispan.query.spi.ProgrammaticSearchMappingProvider</code></pre>
</div>
</div>
</li>
<li>
<p>Copy your JAR file to the <code>server/lib</code> directory of your Infinispan Server installation.</p>
</li>
<li>
<p>Start Infinispan Server.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title"><code>ProgrammaticSearchMappingProvider</code> example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.core.LowerCaseFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.core.StopFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.standard.StandardFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.standard.StandardTokenizerFactory</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.search.cfg.SearchMapping</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.Cache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.spi.ProgrammaticSearchMappingProvider</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">MyAnalyzerProvider</span> <span class="directive">implements</span> ProgrammaticSearchMappingProvider {

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> defineMappings(Cache cache, SearchMapping searchMapping) {
      searchMapping
            .analyzerDef(<span class="string"><span class="delimiter">&quot;</span><span class="content">standard-with-stop</span><span class="delimiter">&quot;</span></span>, StandardTokenizerFactory.class)
               .filter(StandardFilterFactory.class)
               .filter(LowerCaseFilterFactory.class)
               .filter(StopFilterFactory.class);
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-embedded"><a class="anchor" href="#query-embedded"></a>4. Querying embedded caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use embedded queries when you add Infinispan as a library to custom applications.</p>
</div>
<div class="paragraph">
<p>Protobuf mapping is not required with embedded queries.
Indexing and querying are both done on top of Java objects.</p>
</div>
<div class="sect2">
<h3 id="querying-embedded-caches_query-embedded"><a class="anchor" href="#querying-embedded-caches_query-embedded"></a>4.1. Querying embedded caches</h3>
<div class="paragraph">
<p>This section explains how to query an embedded cache using an example cache named "books" that stores indexed <code>Book</code> instances.</p>
</div>
<div class="paragraph">
<p>In this example, each <code>Book</code> instance defines which properties are indexed and specifies some advanced indexing options with Hibernate Search annotations as follows:</p>
</div>
<div class="listingblock">
<div class="title">Book.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.infinispan.sample</span>;

<span class="keyword">import</span> <span class="include">java.time.LocalDate</span>;
<span class="keyword">import</span> <span class="include">java.util.HashSet</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="keyword">import</span> <span class="include">org.hibernate.search.mapper.pojo.mapping.definition.annotation</span>.*;

<span class="comment">// Annotate values with @Indexed to add them to indexes</span>
<span class="comment">// Annotate each fields according to how you want to index it</span>
<span class="annotation">@Indexed</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {
   <span class="annotation">@FullTextField</span>
   <span class="predefined-type">String</span> title;

   <span class="annotation">@FullTextField</span>
   <span class="predefined-type">String</span> description;

   <span class="annotation">@KeywordField</span>
   <span class="predefined-type">String</span> isbn;

   <span class="annotation">@GenericField</span>
   LocalDate publicationDate;

   <span class="annotation">@IndexedEmbedded</span>
   <span class="predefined-type">Set</span>&lt;Author&gt; authors = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;Author&gt;();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Author.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.infinispan.sample</span>;

<span class="keyword">import</span> <span class="include">org.hibernate.search.mapper.pojo.mapping.definition.annotation.FullTextField</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> {
   <span class="annotation">@FullTextField</span>
   <span class="predefined-type">String</span> name;

   <span class="annotation">@FullTextField</span>
   <span class="predefined-type">String</span> surname;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure Infinispan to index the "books" cache and specify <code>org.infinispan.sample.Book</code> as the entity to index.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;indexing</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user.home}/index</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;indexed-entities&gt;</span>
      <span class="tag">&lt;indexed-entity&gt;</span>org.infinispan.sample.Book<span class="tag">&lt;/indexed-entity&gt;</span>
    <span class="tag">&lt;/indexed-entities&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Obtain the cache.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.Cache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.manager.DefaultCacheManager</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.manager.EmbeddedCacheManager</span>;

EmbeddedCacheManager manager = <span class="keyword">new</span> DefaultCacheManager(<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.xml</span><span class="delimiter">&quot;</span></span>);
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Book</span>&gt; cache = manager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>Perform queries for fields in the <code>Book</code> instances that are stored in the Infinispan cache, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Get the query factory from the cache</span>
QueryFactory queryFactory = org.infinispan.query.Search.getQueryFactory(cache);

<span class="comment">// Create an Ickle query that performs a full-text search using the ':' operator on the 'title' and 'authors.name' fields</span>
<span class="comment">// You can perform full-text search only on indexed caches</span>
<span class="predefined-type">Query</span>&lt;<span class="predefined-type">Book</span>&gt; fullTextQuery = queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM org.infinispan.sample.Book b WHERE b.title:'infinispan' AND b.authors.name:'sanne'</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Use the '=' operator to query fields in caches that are indexed or not</span>
<span class="comment">// Non full-text operators apply only to fields that are not analyzed</span>
<span class="predefined-type">Query</span>&lt;<span class="predefined-type">Book</span>&gt; exactMatchQuery=queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM org.infinispan.sample.Book b WHERE b.isbn = '12345678' AND b.authors.name : 'sanne'</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// You can use full-text and non-full text operators in the same query</span>
<span class="predefined-type">Query</span>&lt;<span class="predefined-type">Book</span>&gt; query=queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM org.infinispan.sample.Book b where b.authors.name : 'Stephen' and b.description : (+'dark' -'tower')</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Get the results</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; found=query.execute().list();</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="entity-mapping-annotations_query-embedded"><a class="anchor" href="#entity-mapping-annotations_query-embedded"></a>4.2. Entity mapping annotations</h3>
<div class="paragraph">
<p>Add annotations to your Java classes to map your entities to indexes.</p>
</div>
<div class="paragraph">
<div class="title">Hibernate Search API</div>
<p>Infinispan uses the <a href="http://hibernate.org/search/">Hibernate Search</a> API to define fine grained configuration for indexing at entity level.
This configuration includes which fields are annotated, which analyzers should be used, how to map nested objects, and so on.</p>
</div>
<div class="paragraph">
<p>The following sections provide information that applies to entity mapping annotations for use with Infinispan.</p>
</div>
<div class="paragraph">
<p>For complete detail about these annotations, you should refer to <a href="https://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#mapper-orm-mapping">the Hibernate Search manual</a>.</p>
</div>
<h4 id="documentid" class="discrete">@DocumentId</h4>
<div class="paragraph">
<p>Unlike Hibernate Search, using <code>@DocumentId</code> to mark a field as identifier does not apply to Infinispan values; in Infinispan the identifier for all <code>@Indexed</code> objects is the key used to store the value. You can still customize how the key is indexed using a combination of <code>@Transformable</code> , custom types and custom <code>FieldBridge</code> implementations.</p>
</div>
<h4 id="transformable_keys" class="discrete">@Transformable keys</h4>
<div class="paragraph">
<p>The key for each value needs to be indexed as well, and the key instance must be transformed in a <code>String</code>. Infinispan includes some default transformation routines to encode common primitives, but to use a custom key you must provide an implementation of <code>org.infinispan.query.Transformer</code> .</p>
</div>
<div class="paragraph">
<div class="title">Registering a key Transformer via annotations</div>
<p>You can annotate your key class with <code>org.infinispan.query.Transformable</code> and your custom transformer implementation
will be picked up automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transformable</span>(transformer = CustomTransformer.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomKey</span> {
   ...
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomTransformer</span> <span class="directive">implements</span> <span class="predefined-type">Transformer</span> {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Object</span> fromString(<span class="predefined-type">String</span> s) {
      ...
      return <span class="keyword">new</span> CustomKey(...);
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> toString(<span class="predefined-type">Object</span> customType) {
      CustomKey ck = (CustomKey) customType;
      <span class="keyword">return</span> ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Registering a key Transformer via the cache indexing configuration</div>
<p>Use the <code>key-transformers</code> xml element in both embedded and server config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;indexing</span> <span class="attribute-name">auto-config</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;key-transformers&gt;</span>
      <span class="tag">&lt;key-transformer</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.CustomKey</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">transformer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.CustomTransformer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/key-transformers&gt;</span>
  <span class="tag">&lt;/indexing&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use the Java configuration API (embedded mode):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   ConfigurationBuilder builder = ...
   builder.indexing().enable()
         .addKeyTransformer(CustomKey.class, CustomTransformer.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-entity-mapping_query-embedded"><a class="anchor" href="#programmatic-entity-mapping_query-embedded"></a>4.3. Programmatically mapping entities</h3>
<div class="paragraph">
<p>You can programmatically map entities to the index as an alternative to annotating Java classes.</p>
</div>
<div class="paragraph">
<p>In the following example we map an object <code>Author</code> which is to be stored in the grid and made searchable on two properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.apache.lucene.search.Query</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.search.cfg.Environment</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.search.cfg.SearchMapping</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.search.query.dsl.QueryBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.Cache</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.configuration.cache.Configuration</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.configuration.cache.ConfigurationBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.configuration.cache.Index</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.manager.DefaultCacheManager</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.CacheQuery</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.Search</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.SearchManager</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.ElementType</span>;
<span class="keyword">import</span> <span class="include">java.util.Properties</span>;

SearchMapping mapping = <span class="keyword">new</span> SearchMapping();
mapping.entity(Author.class).indexed()
       .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">ElementType</span>.METHOD).field()
       .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">ElementType</span>.METHOD).field();

<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put(Environment.MODEL_MAPPING, mapping);
properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.search.[other options]</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">[...]</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Configuration</span> infinispanConfiguration = <span class="keyword">new</span> ConfigurationBuilder()
        .indexing().index(Index.NONE)
        .withProperties(properties)
        .build();

DefaultCacheManager cacheManager = <span class="keyword">new</span> DefaultCacheManager(infinispanConfiguration);

Cache&lt;<span class="predefined-type">Long</span>, Author&gt; cache = cacheManager.getCache();
SearchManager sm = Search.getSearchManager(cache);

Author author = <span class="keyword">new</span> Author(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Surtani</span><span class="delimiter">&quot;</span></span>);
cache.put(author.getId(), author);

QueryBuilder qb = sm.buildQueryBuilderForClass(Author.class).get();
<span class="predefined-type">Query</span> q = qb.keyword().onField(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).matching(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>).createQuery();
CacheQuery cq = sm.getQuery(q, Author.class);
<span class="keyword">assert</span> cq.getResultSize() == <span class="integer">1</span>;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-continuous"><a class="anchor" href="#query-continuous"></a>5. Creating continuous queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications can register listeners to receive continual updates about cache entries that match query filters.</p>
</div>
<div class="sect2">
<h3 id="continuous-queries_query-continuous"><a class="anchor" href="#continuous-queries_query-continuous"></a>5.1. Continuous queries</h3>
<div class="paragraph">
<p>Continuous queries provide applications with real-time notifications about data in Infinispan caches that are filtered by queries.
When entries match the query Infinispan sends the updated data to any listeners, which provides a stream of events instead of applications having to execute the query.</p>
</div>
<div class="paragraph">
<p>Continuous queries can notify applications about incoming matches, for values that have joined the set; updated matches, for matching values that were modified and continue to match; and outgoing matches, for values that have left the set.</p>
</div>
<div class="paragraph">
<p>For example, continuous queries can notify applications about all:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persons with an age between 18 and 25, assuming the <code>Person</code> entity has an <code>age</code> property and is updated by the user application.</p>
</li>
<li>
<p>Transactions for dollar amounts larger than $2000.</p>
</li>
<li>
<p>Times where the lap speed of F1 racers were less than 1:45.00 seconds, assuming the cache contains Lap entries and that laps are entered during the race.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Continuous queries can use all query capabilities except for grouping, aggregation, and sorting operations.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="how_continuous_queries_work" class="discrete">How continuous queries work</h4>
<div class="paragraph">
<p>Continuous queries notify client listeners with the following events:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Join</code></dt>
<dd>
<p>A cache entry matches the query.</p>
</dd>
<dt class="hdlist1"><code>Update</code></dt>
<dd>
<p>A cache entry that matches the query is updated and still matches the query.</p>
</dd>
<dt class="hdlist1"><code>Leave</code></dt>
<dd>
<p>A cache entry no longer matches the query.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When a client registers a continuous query listener it immediately receives <code>Join</code> events for any entries that match the query.
Client listeners receive subsequent events each time a cache operation modifies entries that match the query.</p>
</div>
<div class="paragraph">
<p>Infinispan determines when to send <code>Join</code>, <code>Update</code>, or <code>Leave</code> events to client listeners as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the query on both the old and new value does not match, Infinispan does not sent an event.</p>
</li>
<li>
<p>If the query on the old value does not match but the new value does, Infinispan sends a <code>Join</code> event.</p>
</li>
<li>
<p>If the query on both the old and new values match, Infinispan sends an <code>Update</code> event.</p>
</li>
<li>
<p>If the query on the old value matches but the new value does not, Infinispan sends a <code>Leave</code> event.</p>
</li>
<li>
<p>If the query on the old value matches and the entry is then deleted or it expires, Infinispan sends a <code>Leave</code> event.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="continuous-query-performance_query-continuous"><a class="anchor" href="#continuous-query-performance_query-continuous"></a>5.1.1. Continuous queries and Infinispan performance</h4>
<div class="paragraph">
<p>Continuous queries provide a constant stream of updates to applications, which can generate a significant number of events.
Infinispan temporarily allocates memory for each event it generates, which can result in memory pressure and potentially lead to <code>OutOfMemoryError</code> exceptions, especially for remote caches.
For this reason, you should carefully design your continuous queries to avoid any performance impact.</p>
</div>
<div class="paragraph">
<p>Infinispan strongly recommends that you limit the scope of your continuous queries to the smallest amount of information that you need.
To achieve this, you can use projections and predicates.
For example, the following statement provides results about only a subset of fields that match the criteria rather than the entire entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sql"><span class="class">SELECT</span> field1, field2 <span class="keyword">FROM</span> Entity <span class="keyword">WHERE</span> x <span class="keyword">AND</span> y</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also important to ensure that each <code>ContinuousQueryListener</code> you create can quickly process all received events without blocking threads.
To achieve this, you should avoid any cache operations that generate events unnecessarily.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-continuous-queries_query-continuous"><a class="anchor" href="#creating-continuous-queries_query-continuous"></a>5.2. Creating continuous queries</h3>
<div class="paragraph">
<p>You can create continuous queries for remote and embedded caches.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Query</code> object.</p>
</li>
<li>
<p>Obtain the <code>ContinuousQuery</code> object of your cache by calling
the appropriate method:</p>
<div class="ulist">
<ul>
<li>
<p>Remote caches: <code>org.infinispan.client.hotrod.Search.getContinuousQuery(RemoteCache&lt;K, V&gt; cache)</code></p>
</li>
<li>
<p>Embedded caches: <code>org.infinispan.query.Search.getContinuousQuery(Cache&lt;K, V&gt; cache)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Register the query and a <code>ContinuousQueryListener</code> object as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">continuousQuery.addContinuousQueryListener(query, listener);</code></pre>
</div>
</div>
</li>
<li>
<p>When you no longer need the continuous query, remove the listener as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">continuousQuery.removeContinuousQueryListener(listener);</code></pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="continuous_query_example" class="discrete">Continuous query example</h4>
<div class="paragraph">
<p>The following code example demonstrates a simple continuous query with an embedded cache.</p>
</div>
<div class="paragraph">
<p>In this example, the listener receives notifications when any <code>Person</code> instances under the age of 21 are added to the cache.
Those <code>Person</code> instances are also added to the "matches" map.
When the entries are removed from the cache or their age becomes greater than or equal to 21, they are removed from "matches" map.
⁠</p>
</div>
<div class="listingblock">
<div class="title">Registering a Continuous Query</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.query.api.continuous.ContinuousQuery</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.api.continuous.ContinuousQueryListener</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.Search</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.dsl.QueryFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.query.dsl.Query</span>;

<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.ConcurrentHashMap</span>;

[...]

<span class="comment">// We have a cache of Person objects.</span>
Cache&lt;<span class="predefined-type">Integer</span>, Person&gt; cache = ...

<span class="comment">// Create a ContinuousQuery instance on the cache.</span>
ContinuousQuery&lt;<span class="predefined-type">Integer</span>, Person&gt; continuousQuery = Search.getContinuousQuery(cache);

<span class="comment">// Define a query.</span>
<span class="comment">// In this example, we search for Person instances under 21 years of age.</span>
QueryFactory queryFactory = Search.getQueryFactory(cache);
<span class="predefined-type">Query</span> query = queryFactory.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Person p WHERE p.age &lt; 21</span><span class="delimiter">&quot;</span></span>);

<span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, Person&gt; matches = <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;<span class="predefined-type">Integer</span>, Person&gt;();

<span class="comment">// Define the ContinuousQueryListener.</span>
ContinuousQueryListener&lt;<span class="predefined-type">Integer</span>, Person&gt; listener = <span class="keyword">new</span> ContinuousQueryListener&lt;<span class="predefined-type">Integer</span>, Person&gt;() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> resultJoining(<span class="predefined-type">Integer</span> key, Person value) {
        matches.put(key, value);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> resultUpdated(<span class="predefined-type">Integer</span> key, Person value) {
        <span class="comment">// We do not process this event.</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> resultLeaving(<span class="predefined-type">Integer</span> key) {
        matches.remove(key);
    }
};

<span class="comment">// Add the listener and the query.</span>
continuousQuery.addContinuousQueryListener(query, listener);

[...]

<span class="comment">// Remove the listener to stop receiving notifications.</span>
continuousQuery.removeContinuousQueryListener(listener);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-monitoring-tuning"><a class="anchor" href="#query-monitoring-tuning"></a>6. Monitoring and tuning Infinispan queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan exposes statistics for queries and provides attributes that you can adjust to improve query performance.</p>
</div>
<div class="sect2">
<h3 id="getting-query-statistics_query-monitoring-tuning"><a class="anchor" href="#getting-query-statistics_query-monitoring-tuning"></a>6.1. Getting query statistics</h3>
<div class="paragraph">
<p>Collect statistics to gather information about performance of your indexes and queries, including information such as the types of indexes and average time for queries to complete.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoke the <code>getSearchStatistics()</code> or <code>getClusteredSearchStatistics()</code> methods for embedded caches.</p>
</li>
<li>
<p>Use <code>GET</code> requests to obtain statistics for remote caches from the REST API.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Embedded caches</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Statistics for the local cluster member</span>
SearchStatistics statistics = Search.getSearchStatistics(cache);

<span class="comment">// Consolidated statistics for the whole cluster</span>
CompletionStage&lt;SearchStatisticsSnapshot&gt; statistics = Search.getClusteredSearchStatistics(cache)</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Remote caches</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/search/stats</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tuning-query-performance_query-monitoring-tuning"><a class="anchor" href="#tuning-query-performance_query-monitoring-tuning"></a>6.2. Tuning query performance</h3>
<div class="paragraph">
<p>Use the following guidelines to help you improve the performance of indexing operations and queries.</p>
</div>
<div class="paragraph">
<div class="title">Checking index usage statistics</div>
<p>Queries against partially indexed caches return slower results.
For instance, if some fields in a schema are not annotated then the resulting index does not include those fields.</p>
</div>
<div class="paragraph">
<p>Start tuning query performance by checking the time it takes for each type of query to run.
If your queries seem to be slow, you should make sure that queries are using the indexes for caches and that all entities and field mappings are indexed.</p>
</div>
<div class="paragraph">
<div class="title">Adjusting the commit interval for indexes</div>
<p>Indexing can degrade write throughput for Infinispan clusters.
The <code>commit-interval</code> attribute defines the interval, in milliseconds, between which index changes that are buffered in memory are flushed to the index storage and a commit is performed.</p>
</div>
<div class="paragraph">
<p>This operation is costly so you should avoid configuring an interval that is too small. The default is 1000 ms (1 second).</p>
</div>
<div class="paragraph">
<div class="title">Adjusting the refresh interval for queries</div>
<p>The <code>refresh-interval</code> attribute defines the interval, in milliseconds, between which the index reader is refreshed.</p>
</div>
<div class="paragraph">
<p>The default value is <code>0</code>, which returns data in queries as soon as it is written to a cache.</p>
</div>
<div class="paragraph">
<p>A value greater than <code>0</code> results in some stale query results but substantially increases throughput, especially in write-heavy scenarios.
If you do not need data returned in queries as soon as it is written, you should adjust the refresh interval to improve query performance.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-15 11:07:04 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>