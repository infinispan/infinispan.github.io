<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Hot Rod Java client</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPD7V946LB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GPD7V946LB');
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.17/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<link rel="stylesheet" href="/assets/css/clipboard.css">
<link rel="stylesheet" href="/assets/css/cookieconsent.css">
<link rel="shortcut icon" type="image/png" href="/favicon.ico" >
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.17/jstree.min.js"></script>
<script src="/assets/javascript/clipboard.min.js"></script>
<script src="/assets/javascript/copy.js"></script>
<script src="/assets/javascript/cookieconsent.umd.js"></script>
<script src="/assets/javascript/cookieconsent.config.js" type="module"></script>
<script src="../../js/js.js"></script>
<link rel="canonical" href="https://infinispan.org/docs/stable/titles/hotrod_java/hotrod_java.html">
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Hot Rod Java client</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#hotrod-client-usage_hot_rod">1. Basic Usage</a>
<ul class="sectlevel2">
<li><a href="#adding-hotrod-client-dependencies_hotrod-client-usage">1.1. Install Hot Rod Java client in your project</a></li>
<li><a href="#run-simplest-setup_hotrod-client-usage">1.2. Connect a client: simplest case</a></li>
<li><a href="#run-auth-setup_hotrod-client-usage">1.3. Connect a client: authentication</a></li>
<li><a href="#hotrod-client-multiple-clusters_hotrod-client-usage">1.4. Connect: multiple cluster</a></li>
<li><a href="#hotrod-client-properties_hotrod-client-usage">1.5. The hotrod-client.properties file</a></li>
<li><a href="#configuring-hotrod-encryption_hotrod-client-usage">1.6. Configuring Hot Rod client encryption</a></li>
</ul>
</li>
<li><a href="#hotrod-client-beyond_{context}">2. Beyond the Basics</a>
<ul class="sectlevel2">
<li><a href="#client-server-compatibility_hotrod-client-beyond">2.1. Hot Rod client compatibility with Infinispan Server</a></li>
<li><a href="#configuring-hotrod-authentication_hotrod-client-beyond">2.2. Configuring Authentication Mechanisms for Hot Rod Clients</a>
<ul class="sectlevel3">
<li><a href="#hotrod_auth_tgt">2.2.1. Creating GSSAPI Login Contexts</a></li>
<li><a href="#sasl-authentication-mechanisms_hotrod-client-beyond">2.2.2. SASL authentication mechanisms</a></li>
</ul>
</li>
<li><a href="#hotrod-client-intelligence_hotrod-client-beyond">2.3. Client Intelligence</a></li>
<li><a href="#request-balancing_hotrod-client-beyond">2.4. Request Balancing</a></li>
<li><a href="#hotrod_failover">2.5. Client Failover</a></li>
<li><a href="#near-caches-hotrod-client-beyond">2.6. Near Caches</a>
<ul class="sectlevel3">
<li><a href="#configuring-near-caching-hotrod-client-beyond">2.6.1. Configuring Near Caches</a></li>
</ul>
</li>
<li><a href="#forcing-return-values_hotrod-client-beyond">2.7. Forcing Return Values</a></li>
<li><a href="#creating-caches-hotrod_hotrod-client-beyond">2.8. Creating remote caches from Hot Rod clients</a></li>
</ul>
</li>
<li><a href="#hotrod-client-observability_{context}">3. Observability</a>
<ul class="sectlevel2">
<li><a href="#enabling-hotrod-client-statistics_hotrod-client-observability">3.1. Enabling Hot Rod client statistics</a></li>
<li><a href="#propagation-hotrod-client-tracing">3.2. Hot Rod client tracing propagation</a></li>
<li><a href="#configuring-hotrod-metrics_hotrod-client-observability">3.3. Configuring Hot Rod Client metrics</a></li>
</ul>
</li>
<li><a href="#hotrod-client-api_{context}">4. Hot Rod Client API</a>
<ul class="sectlevel2">
<li><a href="#remotecache_api">4.1. RemoteCache API</a>
<ul class="sectlevel3">
<li><a href="#hotrod_unsupported_methods">4.1.1. Unsupported Methods</a></li>
</ul>
</li>
<li><a href="#hr_remote_iterator">4.2. Remote Iterator API</a>
<ul class="sectlevel3">
<li><a href="#custom_filters">4.2.1. Deploying Custom Filters to Infinispan Server</a></li>
</ul>
</li>
<li><a href="#hr_versioned_api">4.3. MetadataValue API</a></li>
<li><a href="#hotrod_streaming">4.4. Streaming API</a></li>
<li><a href="#remotecache_countermanager-hotrod-client-api">4.5. Counter API</a></li>
<li><a href="#creating_event_listeners">4.6. Creating Event Listeners</a>
<ul class="sectlevel3">
<li><a href="#removing_event_listeners">4.6.1. Removing Event Listeners</a></li>
<li><a href="#filtering_events">4.6.2. Filtering Events</a></li>
<li><a href="#skipping_notifications">4.6.3. Skipping Notifications</a></li>
<li><a href="#customizing_events">4.6.4. Customizing Events</a></li>
<li><a href="#filter_and_custom_events">4.6.5. Filter and Custom Events</a></li>
<li><a href="#event_marshalling">4.6.6. Event Marshalling</a>
<ul class="sectlevel4">
<li><a href="#protostream_deployment">Deploying ProtoStream Marshallers</a></li>
</ul>
</li>
<li><a href="#listener_state_handling">4.6.7. Listener State Handling</a></li>
<li><a href="#listener_failure_handling">4.6.8. Listener Failure Handling</a></li>
</ul>
</li>
<li><a href="#hotrod_transactions">4.7. Hot Rod Java Client Transactions</a>
<ul class="sectlevel3">
<li><a href="#hr_transactions_config_server">4.7.1. Configuring the Server</a></li>
<li><a href="#hr_transactions_config_client">4.7.2. Configuring Hot Rod Clients</a>
<ul class="sectlevel4">
<li><a href="#hr_transactions_tmlookup">TransactionManagerLookup Interface</a></li>
</ul>
</li>
<li><a href="#hr_transactions_modes">4.7.3. Transaction Modes</a></li>
<li><a href="#hr_transactions_force_return_value">4.7.4. Detecting Conflicts with Transactions</a></li>
<li><a href="#hr_transactions_ex_use_config">4.7.5. Using the Configured Transaction Manager and Transaction Mode</a></li>
</ul>
</li>
<li><a href="#remotecache_multimapcachemanager-hotrod-client-api">4.8. Counter API</a></li>
</ul>
</li>
<li><a href="#junit-testing">5. JUnit testing</a>
<ul class="sectlevel2">
<li><a href="#testing_infinispan_with_test_containers">5.1. Testing Infinispan with test containers</a>
<ul class="sectlevel3">
<li><a href="#starting_the_infinispan_test_container">5.1.1. Starting the Infinispan test container</a></li>
<li><a href="#changing_credentials">5.1.2. Changing credentials</a></li>
<li><a href="#adding_the_test_container_to_your_project_dependencies">5.1.3. Adding the test container to your project dependencies</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Hot Rod Java Client provides advanced client/server connectivity based on the Hot Rod protocol. Hot Rod is a binary protocol that supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast access to data.</p>
</li>
<li>
<p>Automatic load balancing.</p>
</li>
<li>
<p>Failover.</p>
</li>
<li>
<p>Consistent hash techniques to efficiently locate cache entries.</p>
</li>
<li>
<p>A full set of API for sync, async, functional, reactive programming.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hotrod-client-usage_hot_rod"><a class="anchor" href="#hotrod-client-usage_hot_rod"></a>1. Basic Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="adding-hotrod-client-dependencies_hotrod-client-usage"><a class="anchor" href="#adding-hotrod-client-dependencies_hotrod-client-usage"></a>1.1. Install Hot Rod Java client in your project</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Java 17 or greater.</p>
</li>
<li>
<p><a href="../server/server.html#server_requirements">Infinispan Server Requirements</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add the Hot Rod Java client Maven artifact as a dependency to your project in the <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.infinispan&lt;/groupId&gt;
  &lt;artifactId&gt;infinispan-client-hotrod&lt;/artifactId&gt;
  &lt;version&gt;16.0.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run-simplest-setup_hotrod-client-usage"><a class="anchor" href="#run-simplest-setup_hotrod-client-usage"></a>1.2. Connect a client: simplest case</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan is a highly configurable data grid. It can be used out of the box with minimal setup or fully configured and tuned to meet the needs of different environments, performance goals, and architectures.
This flexibility also extends to the client side, where in real use cases the client must be appropriately configured for the target cluster.
Since this is a client manual, the approach here is somewhat reversed: for each runnable example, an appropriate server configuration is provided.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code connects a client to a local server started on the default port without authentication
and performs a put/get operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package org.infinispan.examples;

import org.infinispan.client.hotrod.RemoteCache;
import org.infinispan.client.hotrod.RemoteCacheManager;

public class HotRodClientSimplest {
    public static void main(String[] args) {
        try (RemoteCacheManager cacheManager = new RemoteCacheManager()) {
            RemoteCache&lt;String, String&gt; cache = cacheManager.getCache();

            cache.put("KEY", "VALUE");
            String value = cache.get("KEY");
            System.out.println("  KEY = " + value);

        } catch (Exception e) {
            System.err.println("Error connecting to Infinispan server: " + e.getMessage());
            e.printStackTrace();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instructions on setting up a server for this example, see <a href="server-setup/java_client_server_setup.html#simplest">Server Setup</a>.</p>
</div>
<div class="paragraph">
<p>This simple example lacks security. In fact, to encourage the development of secure code, the Infinispan Server default configuration starts with authentication enabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="run-auth-setup_hotrod-client-usage"><a class="anchor" href="#run-auth-setup_hotrod-client-usage"></a>1.3. Connect a client: authentication</h3>
<div class="paragraph">
<p>The following code connects with authentication and explicitly set host and port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package org.infinispan.examples;

import org.infinispan.client.hotrod.RemoteCache;
import org.infinispan.client.hotrod.RemoteCacheManager;
import org.infinispan.client.hotrod.configuration.ConfigurationBuilder;
import org.infinispan.client.hotrod.impl.ConfigurationProperties;

public class HotRodClientAuth {

    public static void main(String[] args) {
        // Create a RemoteCacheManager with default configuration
        ConfigurationBuilder builder = new ConfigurationBuilder();
        builder.addServer().host("127.0.0.1").port(ConfigurationProperties.DEFAULT_HOTROD_PORT)
                .security().authentication()
                .username("username").password("changeme");
        try (RemoteCacheManager cacheManager = new RemoteCacheManager(builder.build())) {
            RemoteCache&lt;String, String&gt; cache = cacheManager.getCache();

            cache.put("KEY", "VALUE");
            String value = cache.get("KEY");
            System.out.println("  KEY = " + value);
            
        } catch (Exception e) {
            System.err.println("Error connecting to Infinispan server: " + e.getMessage());
            e.printStackTrace();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To start a server see <a href="server-setup/java_client_server_setup.html#auth">Server Setup</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hotrod-client-multiple-clusters_hotrod-client-usage"><a class="anchor" href="#hotrod-client-multiple-clusters_hotrod-client-usage"></a>1.4. Connect: multiple cluster</h3>
<div class="paragraph">
<p>A client can be configured to connect to multiple Infinispan clusters to allow failover or for any user&#8217;s needs.
The following example show a client connected to two clusters.</p>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">infinispan.client.hotrod.cluster.cluster1=172.20.0.11:11222; 172.20.0.12:11222
infinispan.client.hotrod.cluster.cluster2=172.21.0.11:11222; 172.21.0.12:11222
infinispan.client.hotrod.auth_username=username
infinispan.client.hotrod.auth_password=changeme</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package org.infinispan.examples;

import org.infinispan.client.hotrod.RemoteCache;
import org.infinispan.client.hotrod.RemoteCacheManager;
import org.infinispan.client.hotrod.configuration.ConfigurationBuilder;

public class HotRodClientMultiCluster {

    public static void main(String[] args) {
        ConfigurationBuilder builder = new ConfigurationBuilder();
        builder.security().authentication().username("username").password("changeme");
        builder.addCluster("cluster1").addClusterNodes("172.20.0.11:11222; 172.20.0.12:11222");
        builder.addCluster("cluster2").addClusterNodes("172.21.0.11:11222; 172.21.0.12:11222");

        try (RemoteCacheManager cacheManager = new RemoteCacheManager(builder.build())) {
            RemoteCache&lt;String, String&gt; cache = cacheManager.getCache();

            cacheManager.switchToCluster("cluster1");
            cache.put("KEY", "VALUE ON CLUSTER 1");
            String value = cache.get("KEY");
            System.out.println("  KEY = " + value);

            cacheManager.switchToCluster("cluster2");
            value = cache.get("KEY");
            System.out.println("  KEY = " + value);

            cache.put("KEY", "VALUE_ON_CLUSTER_2");
            value = cache.get("KEY");
            System.out.println("  KEY = " + value);

        } catch (Exception e) {
            System.err.println("Error connecting to Infinispan server: " + e.getMessage());
            e.printStackTrace();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration sets up a cluster as default, so that clients always attempt to connect to it first.</p>
</div>
<div class="listingblock primary">
<div class="title">Declarative</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">infinispan.client.hotrod.server_list=172.20.0.11:11222
infinispan.client.hotrod.cluster.cluster2=172.21.0.11:11222; 172.21.0.12:11222
infinispan.client.hotrod.auth_username=username
infinispan.client.hotrod.auth_password=changeme</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Programmatic</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServers("172.20.0.11:11222; 172.20.0.12:11222")
             .addCluster("siteB")
               .addClusterNodes("172.21.0.11:11222; 172.21.0.12:11222");
RemoteCacheManager remoteCacheManager = new RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start a server for this example with <a href="server-setup/java_client_server_setup.html#multi">Server Setup</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hotrod-client-properties_hotrod-client-usage"><a class="anchor" href="#hotrod-client-properties_hotrod-client-usage"></a>1.5. The hotrod-client.properties file</h3>
<div class="paragraph">
<p>Client configuration can be performed declaratively via the <code>hotrod-client.properties</code> file.
By default, the RemoteCacheManager constructor looks for this file at startup and uses it for
the setup. The following example shows the declarative configuration for an authenticated client.</p>
</div>
<div class="listingblock">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.server_list=127.0.0.1:11222
infinispan.client.hotrod.auth_username = username
infinispan.client.hotrod.auth_password = changeme
infinispan.client.hotrod.auth_realm = default</code></pre>
</div>
</div>
<div class="paragraph">
<p>Provided that the <code>hotrod-client.properties</code> file is on the classpath, we can use the simplest client setup to connect to the server.</p>
</div>
<div class="paragraph">
<p>All the available properties are documented in the <a href="properties/ref_hotrod_client_configuration_properties.html">Properties Reference Page</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the configuration properties file is not on the classpath (e.g., external configuration, remote configuration hub),
the ConfigurationBuilder can build a configuration from a java.util.Properties instance as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
Properties p = new Properties();
try(Reader r = new FileReader("/path/to/hotrod-client.properties")) {
   p.load(r);
   builder.withProperties(p);
}
RemoteCacheManager cacheManager = new RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod Client Configuration</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html#RemoteCacheManager-java.net.URL-">org.infinispan.client.hotrod.RemoteCacheManager</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hotrod-encryption_hotrod-client-usage"><a class="anchor" href="#configuring-hotrod-encryption_hotrod-client-usage"></a>1.6. Configuring Hot Rod client encryption</h3>
<div class="paragraph">
<p>Infinispan Server can enforce SSL/TLS encryption and present Hot Rod clients with certificates to establish trust and negotiate secure connections.</p>
</div>
<div class="paragraph">
<p>To verify certificates issued to Infinispan Server, Hot Rod clients require either the full certificate chain or a partial chain that starts with the Root CA.
You provide server certificates to Hot Rod clients as trust stores.</p>
</div>
<div class="paragraph">
<p>By default, Hot Rod clients perform hostname validation by matching the <code>dNSName</code> or <code>iPAddress</code> values (or both) in the server certificate&#8217;s <code>subjectAltName</code> extension with the expected hostname.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As an alternative to providing trust stores, you can use shared system certificates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a trust store that Hot Rod clients can use to verify Infinispan Server identities.</p>
</li>
<li>
<p>If you configure Infinispan Server to validate or authenticate client certificates, create a keystore as appropriate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the trust store to the client configuration with the <code>trustStoreFileName()</code> and <code>trustStorePassword()</code> methods or corresponding properties.</p>
</li>
<li>
<p>If you also configure client verification, do the following:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the keystore to the client configuration with the <code>keyStoreFileName()</code> and <code>keyStorePassword()</code> methods or corresponding properties.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package org.infinispan.examples;

import org.infinispan.client.hotrod.RemoteCache;
import org.infinispan.client.hotrod.RemoteCacheManager;
import org.infinispan.client.hotrod.configuration.ConfigurationBuilder;

public class HotRodClientTLS {
    public static void main(String[] args) {
        ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
        clientBuilder.addServer().host("127.0.0.1").port(11222).security().ssl()
                // Clients use the trust store to verify Infinispan Server identities.
                .trustStoreFileName("/path/to/client.truststore")
                .trustStorePassword("changeme".toCharArray())
                // Clients present these certificates to Infinispan Server.
                .keyStoreFileName("/path/to/client.keystore")
                .keyStorePassword("keystorepassword".toCharArray());
        try (RemoteCacheManager cacheManager = new RemoteCacheManager()) {
            RemoteCache&lt;String, String&gt; cache = cacheManager.getCache();

            cache.put("KEY", "VALUE");
            String value = cache.get("KEY");
            System.out.println("  KEY = " + value);

        } catch (Exception e) {
            System.err.println("Error connecting to Infinispan server: " + e.getMessage());
            e.printStackTrace();
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.server_list=127.0.0.1:11222
infinispan.client.hotrod.use_ssl = true
infinispan.client.hotrod.sni_host_name=localhost
# Clients use the trust store to verify Infinispan Server identities.
infinispan.client.hotrod.trust_store_file_name=/path/to/client.truststore
infinispan.client.hotrod.trust_store_password=changeme
# Clients present these certificates to Infinispan Server.
infinispan.client.hotrod.key_store_file_name = /path/to/client.keystore
infinispan.client.hotrod.key_store_password = changeme</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="server-setup/java_client_server_setup.html#tls">Server Setup</a> to startup a server.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#endpoint-encryption">Encrypting Infinispan Server Connections</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/SslConfigurationBuilder.html">SslConfigurationBuilder</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod client configuration properties</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/securing_networks/using-shared-system-certificates_securing-networks">Using Shared System Certificates</a> (Red Hat Enterprise Linux 9 Securing Networks)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hotrod-client-beyond_{context}"><a class="anchor" href="#hotrod-client-beyond_{context}"></a>2. Beyond the Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beyond basic configurations, Hot Rod clients support advanced features for specific use cases.
This chapter covers authentication, failover, near caching, and other configurations that improve
security, performance, and reliability.</p>
</div>
<div class="sect2">
<h3 id="client-server-compatibility_hotrod-client-beyond"><a class="anchor" href="#client-server-compatibility_hotrod-client-beyond"></a>2.1. Hot Rod client compatibility with Infinispan Server</h3>
<div class="paragraph">
<p>Before diving into advanced configuration, here is a quick note on version compatibility.
Infinispan Server allows you to connect Hot Rod clients with different versions.
For instance, during a migration or upgrade to your Infinispan cluster, the Hot Rod client version might be lower than the Infinispan Server version.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan recommends using the latest Hot Rod client version to benefit from the most recent capabilities and security enhancements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Infinispan 10 and later</div>
<p>Hot Rod protocol version 3.x automatically negotiates the highest version possible for clients with Infinispan Server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Infinispan 9.4 and earlier</div>
<div class="paragraph">
<p>The client no longer supports Hot Rod protocol versions older than 3.0. As such, you must use an older client or the <code>hotrod-client-legacy</code> module.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Clients that use a Hot Rod protocol version that is higher than the Infinispan Server version must set the <code>infinispan.client.hotrod.protocol_version</code> property.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://infinispan.org/docs/stable/titles/hotrod_protocol/hotrod_protocol.html">Hot Rod protocol reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hotrod-authentication_hotrod-client-beyond"><a class="anchor" href="#configuring-hotrod-authentication_hotrod-client-beyond"></a>2.2. Configuring Authentication Mechanisms for Hot Rod Clients</h3>
<div class="paragraph">
<p>Infinispan Server uses different mechanisms to authenticate Hot Rod client connections.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Specify authentication mechanisms with the <code>saslMechanism()</code> method from the <code>AuthenticationConfigurationBuilder</code> class or with the <code>infinispan.client.hotrod.sasl_mechanism</code> property.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">SCRAM</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security()
               .authentication()
                 .saslMechanism("SCRAM-SHA-512")
                 .username("myuser")
                 .password("qwer1234!");</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">DIGEST</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security()
               .authentication()
                 .saslMechanism("DIGEST-MD5")
                 .username("myuser")
                 .password("qwer1234!");</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">PLAIN</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security()
               .authentication()
                 .saslMechanism("PLAIN")
                 .username("myuser")
                 .password("qwer1234!");</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">OAUTHBEARER</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String token = "..."; // Obtain the token from your OAuth2 provider
ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security()
               .authentication()
                 .saslMechanism("OAUTHBEARER")
                 .token(token);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">EXTERNAL</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder
   .addServer()
      .host("127.0.0.1")
      .port(11222)
   .security()
      .ssl()
         // TrustStore stores trusted CA certificates for the server.
         .trustStoreFileName("/path/to/truststore")
         .trustStorePassword("truststorepassword".toCharArray())
         .trustStoreType("PKCS12")
         // KeyStore stores valid client certificates.
         .keyStoreFileName("/path/to/keystore")
         .keyStorePassword("keystorepassword".toCharArray())
         .keyStoreType("PKCS12")
      .authentication()
         .saslMechanism("EXTERNAL");
remoteCacheManager = new RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;String, String&gt; cache = remoteCacheManager.getCache("secured");</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">GSSAPI</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">LoginContext lc = new LoginContext("GssExample", new BasicCallbackHandler("krb_user", "krb_password".toCharArray()));
lc.login();
Subject clientSubject = lc.getSubject();

ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security()
               .authentication()
                 .saslMechanism("GSSAPI")
                 .clientSubject(clientSubject)
                 .callbackHandler(new BasicCallbackHandler());</code></pre>
</div>
</div>
<h4 id="basic_callback_handler" class="discrete">Basic Callback Handler</h4>
<div class="paragraph">
<p>The <code>BasicCallbackHandler</code>, as shown in the GSSAPI example, invokes the following callbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NameCallback</code> and <code>PasswordCallback</code> construct the client subject.</p>
</li>
<li>
<p><code>AuthorizeCallback</code> is called during SASL authentication.</p>
</li>
</ul>
</div>
<h4 id="oauthbearer_with_token_callback_handler" class="discrete">OAUTHBEARER with Token Callback Handler</h4>
<div class="paragraph">
<p>Use a <code>TokenCallbackHandler</code> to refresh OAuth2 tokens before they expire, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String token = "..."; // Obtain the token from your OAuth2 provider
TokenCallbackHandler tokenHandler = new TokenCallbackHandler(token);
ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security()
               .authentication()
               .saslMechanism("OAUTHBEARER")
               .callbackHandler(tokenHandler);
remoteCacheManager = new RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;String, String&gt; cache = remoteCacheManager.getCache("secured");
// Refresh the token
tokenHandler.setToken("newToken");</code></pre>
</div>
</div>
<h4 id="custom_callbackhandler" class="discrete">Custom <code>CallbackHandler</code></h4>
<div class="paragraph">
<p>Hot Rod clients set up a default <code>CallbackHandler</code> to pass credentials to SASL
mechanisms. In some cases you might need to provide a custom <code>CallbackHandler</code>, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">public class MyCallbackHandler implements CallbackHandler {
   private final String username;
   private final char[] password;
   private final String realm;

   public MyCallbackHandler(String username, String realm, char[] password) {
      this.username = username;
      this.password = password;
      this.realm = realm;
   }

   @Override
   public void handle(Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      for (Callback callback : callbacks) {
         if (callback instanceof NameCallback) {
            NameCallback nameCallback = (NameCallback) callback;
            nameCallback.setName(username);
         } else if (callback instanceof PasswordCallback) {
            PasswordCallback passwordCallback = (PasswordCallback) callback;
            passwordCallback.setPassword(password);
         } else if (callback instanceof AuthorizeCallback) {
            AuthorizeCallback authorizeCallback = (AuthorizeCallback) callback;
            authorizeCallback.setAuthorized(authorizeCallback.getAuthenticationID().equals(
                  authorizeCallback.getAuthorizationID()));
         } else if (callback instanceof RealmCallback) {
            RealmCallback realmCallback = (RealmCallback) callback;
            realmCallback.setText(realm);
         } else {
            throw new UnsupportedCallbackException(callback);
         }
      }
   }
}

ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .security().authentication()
               .serverName("myhotrodserver")
               .saslMechanism("DIGEST-MD5")
               .callbackHandler(new MyCallbackHandler("myuser","default","qwer1234!".toCharArray()));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A custom <code>CallbackHandler</code> needs to handle callbacks that are specific to the
authentication mechanism that you use. However, it is beyond the scope of this
document to provide examples for each possible callback type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="hotrod_auth_tgt"><a class="anchor" href="#hotrod_auth_tgt"></a>2.2.1. Creating GSSAPI Login Contexts</h4>
<div class="paragraph">
<p>To use the GSSAPI mechanism, you must create a <em>LoginContext</em> so your Hot Rod client can obtain a Ticket Granting Ticket (TGT).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define a login module in a login configuration file.</p>
<div class="listingblock">
<div class="title">gss.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">GssExample {
    com.sun.security.auth.module.Krb5LoginModule required client=TRUE;
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the IBM JDK:</p>
</div>
<div class="listingblock">
<div class="title">gss-ibm.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">GssExample {
    com.ibm.security.auth.module.Krb5LoginModule required client=TRUE;
};</code></pre>
</div>
</div>
</li>
<li>
<p>Set the following system properties:</p>
<div class="listingblock">
<div class="content">
<pre>java.security.auth.login.config=gss.conf

java.security.krb5.conf=/etc/krb5.conf</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>krb5.conf</code> provides the location of your KDC. Use the <em>kinit</em> command to
authenticate with Kerberos and verify <code>krb5.conf</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sasl-authentication-mechanisms_hotrod-client-beyond"><a class="anchor" href="#sasl-authentication-mechanisms_hotrod-client-beyond"></a>2.2.2. SASL authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan Server supports the following SASL authentications mechanisms with Hot Rod and Memcached binary protocol endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Security realm type</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>PLAIN</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BASIC</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. Hot Rod connectors support <code>DIGEST-MD5</code>, <code>DIGEST-SHA</code>, <code>DIGEST-SHA-256</code>, <code>DIGEST-SHA-384</code>, and <code>DIGEST-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>salt</em> values in addition to hashing algorithms and nonce values. Hot Rod connectors support <code>SCRAM-SHA</code>, <code>SCRAM-SHA-256</code>, <code>SCRAM-SHA-384</code>, and <code>SCRAM-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GS2-KRB5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>CLIENT_CERT</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BEARER_TOKEN</code> HTTP mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="hotrod-client-intelligence_hotrod-client-beyond"><a class="anchor" href="#hotrod-client-intelligence_hotrod-client-beyond"></a>2.3. Client Intelligence</h3>
<div class="paragraph">
<p>Hot Rod clients use intelligence mechanisms to efficiently send requests to Infinispan Server clusters.
By default, the Hot Rod protocol has the <code>HASH_DISTRIBUTION_AWARE</code> intelligence mechanism enabled. This mechanism
allows the client to self-discover the nodes of a cluster. In this case, there is no need during the configuration
phase to pass the full list of cluster nodes.</p>
</div>
<div class="paragraph">
<div class="title"><code>BASIC</code> intelligence</div>
<p>Clients do not receive topology change events for Infinispan clusters, such as nodes joining or leaving, and use only the list of Infinispan Server network locations that you add to the client configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enable <code>BASIC</code> intelligence to use the Hot Rod client configuration when a Infinispan Server does not send internal and hidden cluster topology to the Hot Rod client.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title"><code>TOPOLOGY_AWARE</code> intelligence</div>
<p>Clients receive and store topology change events for Infinispan clusters to dynamically keep track of Infinispan Servers on the network.</p>
</div>
<div class="paragraph">
<p>To receive cluster topology, clients need the network location, either IP address or host name, of at least one Hot Rod server at startup.
After the client connects, Infinispan Server transmits the topology to the client.
When Infinispan Server nodes join or leave the cluster, Infinispan transmits an updated topology to the client.</p>
</div>
<div class="paragraph">
<div class="title"><code>HASH_DISTRIBUTION_AWARE</code> intelligence</div>
<p>Clients receive and store topology change events for Infinispan clusters in addition to hashing information that enables clients to identify which nodes store specific keys.</p>
</div>
<div class="paragraph">
<p>For example, consider a <code>put(k,v)</code> operation. The client calculates the hash value for the key so it can locate the exact Infinispan Server node on which the data resides.
Clients can then connect directly to that node to perform read and write operations.</p>
</div>
<div class="paragraph">
<p>The benefit of <code>HASH_DISTRIBUTION_AWARE</code> intelligence is that Infinispan Server does not need to look up values based on key hashes, which uses less server-side resources.
Another benefit is that Infinispan Server responds to client requests more quickly because they do not need to make additional network roundtrips.</p>
</div>
<h4 id="configuration" class="discrete">Configuration</h4>
<div class="paragraph">
<p>By default, the Hot Rod client uses the intelligence that you configure globally for all Infinispan clusters.</p>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
builder.clientIntelligence(ClientIntelligence.BASIC);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.client_intelligence=BASIC</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you configure the Hot Rod client to use multiple Infinispan clusters, you can use different intelligence for each cluster.</p>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
builder.addCluster("NYC").clusterClientIntelligence(ClientIntelligence.BASIC);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.cluster.intelligence.NYC=BASIC</code></pre>
</div>
</div>
<h4 id="failed_server_timeout" class="discrete">Failed Server Timeout</h4>
<div class="paragraph">
<p>If a server does not report the topology as BASIC, or the client is unable to connect to a server due to network issues, the client will mark the server as failed.
A client does not attempt to connect to a server marked as failed until the client receives an updated topology.
Because BASIC topology never sends an update, the client will not re-attempt connection.</p>
</div>
<div class="paragraph">
<p>To avoid such a situation, you can use the <code>serverFailureTimeout</code> setting that clears the failed server status after a defined period of time.
Infinispan will try to reconnect to the server after the defined timeout. If the server is still unreachable, it is marked as failed again and the connection will be re-attempted after the defined timeout.
You can disable reconnection attempts by setting the <code>serverFailureTimeout</code> value to <code>-1</code>.</p>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
builder.serverFailureTimeout(5000).clusterClientIntelligence(ClientIntelligence.BASIC);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.server_failure_timeout=5000
infinispan.client.hotrod.client_intelligence=BASIC</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/ClientIntelligence.html">org.infinispan.client.hotrod.configuration.ClientIntelligence</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="request-balancing_hotrod-client-beyond"><a class="anchor" href="#request-balancing_hotrod-client-beyond"></a>2.4. Request Balancing</h3>
<div class="paragraph">
<p>Hot Rod Java clients balance requests to Infinispan Server clusters so that read and write operations are spread across nodes.</p>
</div>
<div class="paragraph">
<p>Clients that use <code>BASIC</code> or <code>TOPOLOGY_AWARE</code> intelligence use request balancing for all requests.
Clients that use <code>HASH_DISTRIBUTION_AWARE</code> intelligence send requests directly to the node that stores the desired key.
If the node does not respond, the clients then fall back to request balancing.</p>
</div>
<div class="paragraph">
<p>The default balancing strategy is round-robin, so Hot Rod clients perform request balancing as in the following example where <code>s1</code>, <code>s2</code>, <code>s3</code> are nodes in a Infinispan cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">// Connect to the Infinispan cluster
RemoteCacheManager cacheManager = new RemoteCacheManager(builder.build());
// Obtain the remote cache
RemoteCache&lt;String, String&gt; cache = cacheManager.getCache("test");

//Hot Rod client sends a request to the "s1" node
cache.put("key1", "aValue");
//Hot Rod client sends a request to the "s2" node
cache.put("key2", "aValue");
//Hot Rod client sends a request to the "s3" node
String value = cache.get("key1");
//Hot Rod client sends the next request to the "s1" node again
cache.remove("key2");</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Custom balancing policies</div>
<p>You can use custom <code>FailoverRequestBalancingStrategy</code> implementations if you add your class in the Hot Rod client configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
builder.addServer()
         .host("127.0.0.1")
         .port(11222)
         .balancingStrategy(new MyCustomBalancingStrategy());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.request_balancing_strategy=my.package.MyCustomBalancingStrategy</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/FailoverRequestBalancingStrategy.html">org.infinispan.client.hotrod.FailoverRequestBalancingStrategy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hotrod_failover"><a class="anchor" href="#hotrod_failover"></a>2.5. Client Failover</h3>
<div class="paragraph">
<p>Hot Rod clients can automatically failover when Infinispan cluster topologies
change. For instance, Hot Rod clients that are topology-aware can detect when
one or more Infinispan servers fail.</p>
</div>
<div class="paragraph">
<p>In addition to failover between clustered Infinispan servers, Hot Rod clients
can failover between Infinispan clusters.</p>
</div>
<div class="paragraph">
<p>For example, you have a Infinispan cluster running in New York (<strong>NYC</strong>) and
another cluster running in London (<strong>LON</strong>). Clients sending requests to
<strong>NYC</strong> detect that no nodes are available so they switch to the cluster in
<strong>LON</strong>. Clients then maintain connections to <strong>LON</strong> until you manually switch
clusters or failover happens again.</p>
</div>
<div class="paragraph">
<div class="title">Transactional Caches with Failover</div>
<p>Conditional operations, such as <code>putIfAbsent()</code>, <code>replace()</code>, <code>remove()</code>, have
strict method return guarantees. Likewise, some operations can require previous
values to be returned.</p>
</div>
<div class="paragraph">
<p>Even though Hot Rod clients can failover, you should use transactional caches
to ensure that operations do not partially complete and leave conflicting
entries on different nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="near-caches-hotrod-client-beyond"><a class="anchor" href="#near-caches-hotrod-client-beyond"></a>2.6. Near Caches</h3>
<div class="paragraph">
<p>Near caches are local to Hot Rod clients and store recently used data so that every read operation does not need to traverse the network, which significantly increases performance.</p>
</div>
<div class="paragraph">
<p>Near caches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are populated with read operations, calls to <code>get()</code> or <code>getVersioned()</code> methods.<br>
In the following example the <code>put()</code> call does not populate the near cache and only has the effect of invalidating the entry if it already exists:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">cache.put("k1", "v1");
cache.get("k1");</code></pre>
</div>
</div>
</li>
<li>
<p>Register a client listener to invalidate entries when they are updated or removed in remote caches on Infinispan Server.<br>
If entries are requested after they are invalidated, clients must retrieve them from the remote caches again.</p>
</li>
<li>
<p>Are cleared when clients fail over to different servers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Bounded near caches</div>
<p>You should always use bounded near caches by specifying the maximum number of entries they can contain.
When near caches reach the maximum number of entries, eviction automatically takes place to remove older entries.
This means you do not need to manually keep the cache size within the boundaries of the client JVM.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use maximum idle expiration with near caches because near-cache reads do not propagate the last access time for entries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Bloom filters</div>
<p>Bloom filters optimize performance for write operations by reducing the total number of invalidation messages.</p>
</div>
<div class="paragraph">
<p>Bloom filters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reside on Infinispan Server and keep track of the entries that the client has requested.</p>
</li>
<li>
<p>Cannot be used with unbounded near caches.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-near-caching-hotrod-client-beyond"><a class="anchor" href="#configuring-near-caching-hotrod-client-beyond"></a>2.6.1. Configuring Near Caches</h4>
<div class="paragraph">
<p>Configure Hot Rod Java clients with near caches to store recently used data locally in the client JVM.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Hot Rod Java client configuration.</p>
</li>
<li>
<p>Configure each cache to perform near caching with the <code>nearCacheMode(NearCacheMode.INVALIDATED)</code> method.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan provides global near cache configuration properties.
However, those properties are deprecated and you should not use them but configure near caching on a per-cache basis instead.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Specify the maximum number of entries that the near cache can hold before eviction occurs with the <code>nearCacheMaxEntries()</code> method.</p>
</li>
<li>
<p>Enable bloom filters for near caches with the <code>nearCacheUseBloomFilter()</code> method.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.client.hotrod.configuration.ConfigurationBuilder;
import org.infinispan.client.hotrod.configuration.NearCacheMode;
import org.infinispan.client.hotrod.configuration.ExhaustedAction;

ConfigurationBuilder builder = new ConfigurationBuilder();
builder.addServer()
    .host("127.0.0.1")
    .port(ConfigurationProperties.DEFAULT_HOTROD_PORT)
  .security().authentication()
    .username("username")
    .password("password")
    .realm("default")
    .saslMechanism("SCRAM-SHA-512")
  // Configure the connection pool for bloom filters.
  .connectionPool()
    .maxActive(1)
    .exhaustedAction(ExhaustedAction.WAIT);
// Configure near caching for specific caches
builder.remoteCache("books")
    .nearCacheMode(NearCacheMode.INVALIDATED)
    .nearCacheMaxEntries(100)
    .nearCacheUseBloomFilter(false);
builder.remoteCache("authors")
    .nearCacheMode(NearCacheMode.INVALIDATED)
    .nearCacheMaxEntries(200)
    .nearCacheUseBloomFilter(true);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/NearCacheConfiguration.html">org.infinispan.client.hotrod.configuration.NearCacheConfiguration</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/ExhaustedAction.html">org.infinispan.client.hotrod.configuration.ExhaustedAction</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="forcing-return-values_hotrod-client-beyond"><a class="anchor" href="#forcing-return-values_hotrod-client-beyond"></a>2.7. Forcing Return Values</h3>
<div class="paragraph">
<p>To avoid sending data unnecessarily, write operations on remote caches return <code>null</code> instead of previous values.</p>
</div>
<div class="paragraph">
<p>For example, the following method calls do not return previous values for keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">V remove(Object key);
V put(K key, V value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can, however, change the default behavior so your invocations return previous values for keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure Hot Rod clients so method calls return previous values for keys in one of the following ways:</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">FORCE_RETURN_VALUE flag</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">cache.withFlags(Flag.FORCE_RETURN_VALUE).put("aKey", "newValue")</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Per-cache</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
// Return previous values for keys for invocations for a specific cache.
builder.remoteCache("mycache")
       .forceReturnValues(true);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs"># Use the "*" wildcard in the cache name to return previous values
# for all caches that start with the "somecaches" string.

infinispan.client.hotrod.cache.somecaches*.force_return_values = true</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/Flag.html#FORCE_RETURN_VALUE">org.infinispan.client.hotrod.Flag</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-hotrod_hotrod-client-beyond"><a class="anchor" href="#creating-caches-hotrod_hotrod-client-beyond"></a>2.8. Creating remote caches from Hot Rod clients</h3>
<div class="paragraph">
<p>Use the Infinispan Hot Rod API to create remote caches on Infinispan Server from Java, C++, .NET/C#, JS clients and more.</p>
</div>
<div class="paragraph">
<p>This procedure shows you how to use Hot Rod Java clients that create remote caches on first access.
You can find code examples for other Hot Rod clients in the <a href="https://infinispan.org/tutorials/simple/simple_tutorials.html">Infinispan Tutorials</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke the <code>remoteCache()</code> method as part of your the <code>ConfigurationBuilder</code>.</p>
</li>
<li>
<p>Set the <code>configuration</code> or <code>configuration_uri</code> properties in the <code>hotrod-client.properties</code> file on your classpath.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">File file = new File("path/to/infinispan.xml")
ConfigurationBuilder builder = new ConfigurationBuilder();
builder.remoteCache("another-cache")
       .configuration("&lt;distributed-cache name=\"another-cache\"/&gt;");
builder.remoteCache("my.other.cache")
       .configurationURI(file.toURI());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">infinispan.client.hotrod.cache.another-cache.configuration=&lt;distributed-cache name=\"another-cache\"/&gt;
infinispan.client.hotrod.cache.[my.other.cache].configuration_uri=file:///path/to/infinispan.xml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the name of your remote cache contains the <code>.</code> character, you must enclose it in square brackets when using <code>hotrod-client.properties</code> files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod Client Configuration</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/RemoteCacheConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.RemoteCacheConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hotrod-client-observability_{context}"><a class="anchor" href="#hotrod-client-observability_{context}"></a>3. Observability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers observability features including metrics, distributed tracing, and statistics that enable monitoring and troubleshooting of Hot Rod client operations in production environments.</p>
</div>
<div class="sect2">
<h3 id="enabling-hotrod-client-statistics_hotrod-client-observability"><a class="anchor" href="#enabling-hotrod-client-statistics_hotrod-client-observability"></a>3.1. Enabling Hot Rod client statistics</h3>
<div class="paragraph">
<p>Hot Rod Java clients can provide statistics that include remote cache and near-cache hits and misses.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Hot Rod Java client configuration for editing.</p>
</li>
<li>
<p>Set <code>true</code> as the value for the <code>statistics</code> property or invoke the <code>statistics().enable()</code> methods.</p>
</li>
<li>
<p>Export JMX MBeans for your Hot Rod client with the <code>jmx</code> and <code>jmx_domain</code> properties or invoke the <code>jmxEnable()</code> and <code>jmxDomain()</code> methods.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="hot_rod_java_client_statistics" class="discrete">Hot Rod Java client statistics</h4>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
builder.statistics().enable()
         .jmxEnable()
         .jmxDomain("my.domain.org")
       .addServer()
         .host("127.0.0.1")
         .port(11222);
RemoteCacheManager remoteCacheManager = new RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">infinispan.client.hotrod.statistics = true
infinispan.client.hotrod.jmx = true
infinispan.client.hotrod.jmx_domain = my.domain.org</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="propagation-hotrod-client-tracing"><a class="anchor" href="#propagation-hotrod-client-tracing"></a>3.2. Hot Rod client tracing propagation</h3>
<div class="paragraph">
<p>When you configure OpenTelemetry tracing on both the client VM and the Infinispan Server, the Hot Rod client enables automatic correlation of tracing spans between the client application and the Infinispan Server.</p>
</div>
<h4 id="disabling_tracing_propagation_from_the_client_to_the_infinispan_server" class="discrete">Disabling tracing propagation from the client to the Infinispan Server</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have OpenTelemetry tracing enabled on The Infinispan Server and the client side.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>disableTracingPropagation()</code> method to disable OpenTelemetry tracing propagation.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.client.hotrod.configuration.ConfigurationBuilder;

ConfigurationBuilder builder = new ConfigurationBuilder();
builder.addServer()
   .host("127.0.0.1")
   .port(ConfigurationProperties.DEFAULT_HOTROD_PORT)
   .disableTracingPropagation();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Hot Rod client stops sending tracing to the Infinispan Server.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#opentelemetry-tracing">Enabling Infinispan tracing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hotrod-metrics_hotrod-client-observability"><a class="anchor" href="#configuring-hotrod-metrics_hotrod-client-observability"></a>3.3. Configuring Hot Rod Client metrics</h3>
<div class="paragraph">
<p>Hot Rod Java clients collect and expose metrics related to the cache requests.
Implement the SPI <code>RemoteCacheManagerMetricsRegistry</code> to register metrics in the collector of your choice.
Infinispan provides an implementation using Micrometer.</p>
</div>
<div class="paragraph">
<p>You can configure generic implementation of Hot Rod client metrics or the provided Micrometer implementation as shown in the following examples.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure a generic implementation.</p>
<div class="listingblock">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">RemoteCacheManagerMetricsRegistry registry = ...;
ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder.addServer()
               .host("127.0.0.1")
               .port(11222)
             .withMetricRegistry(registry);
RemoteCacheManager remoteCacheManager = new RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Micrometer implementation.</p>
<div class="paragraph">
<p>Infinispan provides a Micrometer implementation to collect the metrics.
This implementation has some configuration options used by Micrometer.</p>
</div>
<div class="listingblock">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ConfigurationBuilder clientBuilder = ...; <i class="conum" data-value="1"></i><b>(1)</b>
MeterRegistry registry = ...; <i class="conum" data-value="2"></i><b>(2)</b>
MicrometerRemoteCacheManagerMetricsRegistry.Builder metricsBuilder = new MicrometerRemoteCacheManagerMetricsRegistry.Builder(registry) <i class="conum" data-value="3"></i><b>(3)</b>
   .withHistograms(histograms) <i class="conum" data-value="4"></i><b>(4)</b>
   .withPrefix(prefix) <i class="conum" data-value="5"></i><b>(5)</b>
   .withTag("my-tag", "my-value"); <i class="conum" data-value="6"></i><b>(6)</b>
HotRodMetricRegistry registry = metricsBuilder.build();
clientBuilder.withMetricRegistry(registry);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Hot Rod client configuration builder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Micrometer <code>MeterRegistry</code> implementation used by the application.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the <code>MeterRegistry</code> implementation in the <code>Builder</code> constructor. Must be non-null.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enables histograms.
Micrometer will expose the histogram percentiles when enabled.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Metrics name are in the format <code>vendor.&lt;prefix&gt;.&lt;name&gt;</code>.
The <code>&lt;prefix&gt;</code> is configured here and, by default, is <code>client.hotrod</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Adds Micrometer tags to all metrics (for example, an application ID).
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Histograms can affect resources consumption and may degrade performance.</p>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hotrod-client-api_{context}"><a class="anchor" href="#hotrod-client-api_{context}"></a>4. Hot Rod Client API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Hot Rod client API provides interfaces for creating caches
remotely, manipulating data, monitoring the topology of clustered caches, and
more.</p>
</div>
<div class="sect2">
<h3 id="remotecache_api"><a class="anchor" href="#remotecache_api"></a>4.1. RemoteCache API</h3>
<div class="paragraph">
<p>The collection methods <code>keySet</code>, <code>entrySet</code> and <code>values</code> are backed by the
remote cache. That is that every method is called back into the <code>RemoteCache</code>.
This is useful as it allows for the various keys, entries or values to be
retrieved lazily, and not requiring them all be stored in the client memory at
once if the user does not want.</p>
</div>
<div class="paragraph">
<p>These collections adhere to the <code>Map</code> specification being that <code>add</code> and
<code>addAll</code> are not supported but all other methods are supported.</p>
</div>
<div class="paragraph">
<p>One thing to note is the <code>Iterator.remove</code> and <code>Set.remove</code> or
<code>Collection.remove</code> methods require more than 1 round trip to the server to
operate. You can check out the
<a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a>
Javadoc to see more details about these and the other methods.</p>
</div>
<div class="paragraph">
<div class="title">Iterator Usage</div>
<p>The iterator method of these collections uses <code>retrieveEntries</code> internally,
which is described below. If you notice <code>retrieveEntries</code> takes an argument for
the batch size. There is no way to provide this to the iterator. As such the
batch size can be configured via system property
<code>infinispan.client.hotrod.batch_size</code> or through the <a href="../../apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html#batchSize-int-">ConfigurationBuilder</a> when configuring the
<code>RemoteCacheManager</code>.</p>
</div>
<div class="paragraph">
<p>Also the <code>retrieveEntries</code> iterator returned is <code>Closeable</code> as such the
iterators from <code>keySet</code>, <code>entrySet</code> and <code>values</code> return an <code>AutoCloseable</code>
variant. Therefore you should always close these `Iterator`s when you are done
with them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (CloseableIterator&lt;Map.Entry&lt;K, V&gt;&gt; iterator = remoteCache.entrySet().iterator()) {

      }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>What if I want a deep copy and not a backing collection?</strong></p>
</div>
<div class="paragraph">
<p>Previous version of <code>RemoteCache</code> allowed for the retrieval of a deep copy
of the <code>keySet</code>. This is still possible with the new backing map, you just
have to copy the contents yourself. Also you can do this with <code>entrySet</code> and
<code>values</code>, which we didn&#8217;t support before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Set&lt;K&gt; keysCopy = remoteCache.keySet().stream().collect(Collectors.toSet());</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="hotrod_unsupported_methods"><a class="anchor" href="#hotrod_unsupported_methods"></a>4.1.1. Unsupported Methods</h4>
<div class="paragraph">
<p>The Infinispan <code>RemoteCache</code> API does not support all methods available in the
<code>Cache</code> API and throws <code>UnsupportedOperationException</code> when unsupported methods
are invoked.</p>
</div>
<div class="paragraph">
<p>Most of these methods do not make sense on the remote cache (e.g. listener management operations), or correspond to methods that are not supported by local cache as well (e.g. containsValue).</p>
</div>
<div class="paragraph">
<p>Certain atomic operations inherited from <code>ConcurrentMap</code> are also not supported
with the <code>RemoteCache</code> API, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">boolean remove(Object key, Object value);
boolean replace(Object key, Object value);
boolean replace(Object key, Object oldValue, Object value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, <code>RemoteCache</code> offers alternative versioned methods for these atomic
operations that send version identifiers over the network instead of whole
value objects.</p>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/Cache.html">Cache</a></p>
</li>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java/lang/UnsupportedOperationException.html">UnsupportedOperationException</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hr_remote_iterator"><a class="anchor" href="#hr_remote_iterator"></a>4.2. Remote Iterator API</h3>
<div class="paragraph">
<p>Infinispan provides a remote iterator API to retrieve entries where memory
resources are constrained or if you plan to do server-side filtering or
conversion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Retrieve all entries in batches of 1000
int batchSize = 1000;
try (CloseableIterator&lt;Entry&lt;Object, Object&gt;&gt; iterator = remoteCache.retrieveEntries(null, batchSize)) {
     while(iterator.hasNext()) {
        // Do something
     }
}

// Filter by segment
Set&lt;Integer&gt; segments = ...
try (CloseableIterator&lt;Entry&lt;Object, Object&gt;&gt; iterator = remoteCache.retrieveEntries(null, segments, batchSize)) {
     while(iterator.hasNext()) {
        // Do something
     }
}

// Filter by custom filter
try (CloseableIterator&lt;Entry&lt;Object, Object&gt;&gt; iterator = remoteCache.retrieveEntries("myFilterConverterFactory", segments, batchSize)) {
     while(iterator.hasNext()) {
        // Do something
     }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="custom_filters"><a class="anchor" href="#custom_filters"></a>4.2.1. Deploying Custom Filters to Infinispan Server</h4>
<div class="paragraph">
<p>Deploy custom filters to Infinispan server instances.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a factory that extends <code>KeyValueFilterConverterFactory</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.io.Serializable;

import org.infinispan.filter.AbstractKeyValueFilterConverter;
import org.infinispan.filter.KeyValueFilterConverter;
import org.infinispan.filter.KeyValueFilterConverterFactory;
import org.infinispan.filter.NamedFactory;
import org.infinispan.metadata.Metadata;

//@NamedFactory annotation defines the factory name
@NamedFactory(name = "myFilterConverterFactory")
public class MyKeyValueFilterConverterFactory implements KeyValueFilterConverterFactory {

   @Override
   public KeyValueFilterConverter&lt;String, SampleEntity1, SampleEntity2&gt; getFilterConverter() {
      return new MyKeyValueFilterConverter();
   }
   // Filter implementation. Should be serializable or externalizable for DIST caches
   static class MyKeyValueFilterConverter extends AbstractKeyValueFilterConverter&lt;String, SampleEntity1, SampleEntity2&gt; implements Serializable {
      @Override
      public SampleEntity2 filterAndConvert(String key, SampleEntity1 entity, Metadata metadata) {
         // returning null will case the entry to be filtered out
         // return SampleEntity2 will convert from the cache type SampleEntity1
      }

      @Override
      public MediaType format() {
         // returns the MediaType that data should be presented to this converter.
         // When omitted, the server will use "application/x-java-object".
         // Returning null will cause the filter/converter to be done in the storage format.
      }
   }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a JAR that contains a
<code>META-INF/services/org.infinispan.filter.KeyValueFilterConverterFactory</code> file.
This file should include the fully qualified class name of the filter factory
class implementation.</p>
<div class="paragraph">
<p>If the filter uses custom key/value classes, you must include them in your JAR file so that the filter can correctly unmarshall key and/or value instances.</p>
</div>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/filter/KeyValueFilterConverterFactory.html">KeyValueFilterConverterFactory</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hr_versioned_api"><a class="anchor" href="#hr_versioned_api"></a>4.3. MetadataValue API</h3>
<div class="paragraph">
<p>Use the <code>MetadataValue</code> interface for versioned operations.</p>
</div>
<div class="paragraph">
<p>The following example shows a remove operation that occurs only if the version
of the value for the entry is unchanged:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCacheManager remoteCacheManager = new RemoteCacheManager();
      RemoteCache&lt;String, String&gt; remoteCache = remoteCacheManager.getCache();

      remoteCache.put("car", "ferrari");
      VersionedValue valueBinary = remoteCache.getWithMetadata("car");

      assert remoteCache.remove("car", valueBinary.getVersion());
      assert !remoteCache.containsKey("car");</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/MetadataValue.html">org.infinispan.client.hotrod.MetadataValue</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hotrod_streaming"><a class="anchor" href="#hotrod_streaming"></a>4.4. Streaming API</h3>
<div class="paragraph">
<p>Infinispan provides a Streaming API that implements methods that return
instances of <code>InputStream</code> and <code>OutputStream</code> so you can stream large objects
between Hot Rod clients and Infinispan servers.</p>
</div>
<div class="paragraph">
<p>Consider the following example of a large object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StreamingRemoteCache&lt;String&gt; streamingCache = remoteCache.streaming();
OutputStream os = streamingCache.put("a_large_object");
os.write(...);
os.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could read the object through streaming as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StreamingRemoteCache&lt;String&gt; streamingCache = remoteCache.streaming();
InputStream is = streamingCache.get("a_large_object");
for(int b = is.read(); b &gt;= 0; b = is.read()) {
   // iterate
}
is.close();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Streaming API does <strong>not</strong> marshall values, which means you cannot access the
same entries using both the Streaming and Non-Streaming API at the same time.
You can, however, implement a custom marshaller to handle this case.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>InputStream</code> returned by the <code>RemoteStreamingCache.get(K key)</code> method
implements the <code>VersionedMetadata</code> interface, so you can retrieve version and
expiration information as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StreamingRemoteCache&lt;String&gt; streamingCache = remoteCache.streaming();
InputStream is = streamingCache.get("a_large_object");
long version = ((VersionedMetadata) is).getVersion();
for(int b = is.read(); b &gt;= 0; b = is.read()) {
   // iterate
}
is.close();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Conditional write methods (<code>putIfAbsent()</code>, <code>replace()</code>) perform the actual
condition check after the value is completely sent to the server. In other
words, when the <code>close()</code> method is invoked on the <code>OutputStream</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../../apidocs/org/infinispan/client/hotrod/StreamingRemoteCache.html">org.iinfinispan.client.hotrod.StreamingRemoteCache</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="remotecache_countermanager-hotrod-client-api"><a class="anchor" href="#remotecache_countermanager-hotrod-client-api"></a>4.5. Counter API</h3>
<div class="paragraph">
<p>The <code>CounterManager</code> interface is the entry point to define, retrieve and remove counters.</p>
</div>
<div class="paragraph">
<p>Hot Rod clients can retrieve the <code>CounterManager</code> interface as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// create or obtain your RemoteCacheManager
RemoteCacheManager manager = ...;

// retrieve the CounterManager
CounterManager counterManager = RemoteCounterManagerFactory.asCounterManager(manager);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating_event_listeners"><a class="anchor" href="#creating_event_listeners"></a>4.6. Creating Event Listeners</h3>
<div class="paragraph">
<p>Java Hot Rod clients can register listeners to receive cache-entry level events.
Cache entry created, modified and removed events are supported.</p>
</div>
<div class="paragraph">
<p>Creating a client listener is very similar to embedded listeners, except that
different annotations and event classes are used. Here&#8217;s an example of a
client listener that prints out each event received:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.client.hotrod.annotation.*;
import org.infinispan.client.hotrod.event.*;

@ClientListener(converterFactoryName = "static-converter")
public class EventPrintListener {

   @ClientCacheEntryCreated
   public void handleCreatedEvent(ClientCacheEntryCreatedEvent e) {
      System.out.println(e);
   }

   @ClientCacheEntryModified
   public void handleModifiedEvent(ClientCacheEntryModifiedEvent e) {
      System.out.println(e);
   }

   @ClientCacheEntryRemoved
   public void handleRemovedEvent(ClientCacheEntryRemovedEvent e) {
      System.out.println(e);
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClientCacheEntryCreatedEvent</code> and <code>ClientCacheEntryModifiedEvent</code> instances
provide information on the affected key, and the version of the entry. This
version can be used to invoke conditional operations on the server, such as
<code>replaceWithVersion</code> or <code>removeWithVersion</code>.</p>
</div>
<div class="paragraph">
<p><code>ClientCacheEntryRemovedEvent</code> events are only sent when the remove operation
succeeds. In other words, if a remove operation is invoked but no entry is
found or no entry should be removed, no event is generated. Users interested
in removed events, even when no entry was removed, can develop event
customization logic to generate such events. More information can be found
in the <a href="#customizing_events">customizing client events section</a>.</p>
</div>
<div class="paragraph">
<p>All <code>ClientCacheEntryCreatedEvent</code>, <code>ClientCacheEntryModifiedEvent</code> and
<code>ClientCacheEntryRemovedEvent</code> event instances also provide a <code>boolean isCommandRetried()</code>
method that will return true if the write command that caused this had to be retried
again due to a topology change.  This could be a sign that this event
has been duplicated or another event was dropped and replaced
(eg: ClientCacheEntryModifiedEvent replaced ClientCacheEntryCreatedEvent).</p>
</div>
<div class="paragraph">
<p>Once the client listener implementation has been created, it needs to be
registered with the server. To do so, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(new EventPrintListener());</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="removing_event_listeners"><a class="anchor" href="#removing_event_listeners"></a>4.6.1. Removing Event Listeners</h4>
<div class="paragraph">
<p>When an client event listener is not needed any more, it can be removed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">EventPrintListener listener = ...
cache.removeClientListener(listener);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="filtering_events"><a class="anchor" href="#filtering_events"></a>4.6.2. Filtering Events</h4>
<div class="paragraph">
<p>In order to avoid inundating clients with events, users can provide filtering
functionality to limit the number of events fired by the server for a
particular client listener. To enable filtering, a cache event filter factory
needs to be created that produces filter instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory;
import org.infinispan.filter.NamedFactory;

@NamedFactory(name = "static-filter")
public static class StaticCacheEventFilterFactory implements CacheEventFilterFactory {

   @Override
   public StaticCacheEventFilter getFilter(Object[] params) {
      return new StaticCacheEventFilter();
   }
}


// Class needs to be marshallable when running in a cluster
@Proto
class StaticCacheEventFilter implements CacheEventFilter&lt;Integer, String&gt;, Serializable {
   @Override
   public boolean accept(Integer key, String oldValue, Metadata oldMetadata,
         String newValue, Metadata newMetadata, EventType eventType) {
      if (key.equals(1)) // static key
         return true;

      return false;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cache event filter factory instance defined above creates filter instances
which statically filter out all entries except the one whose key is <code>1</code>.</p>
</div>
<div class="paragraph">
<p>To be able to register a listener with this cache event filter factory,
the factory has to be given a unique name, and the Hot Rod server needs to be
plugged with the name and the cache event filter factory instance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file that contains the filter implementation.</p>
<div class="paragraph">
<p>If the cache uses custom key/value classes, these must be
included in the JAR so that the callbacks can be executed with the correctly
unmarshalled key and/or value instances. If the client listener has <code>useRawData</code>
enabled, this is not necessary since the callback key/value instances will be
provided in binary format.</p>
</div>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</code> file
within the JAR file and within it, write the fully qualified class name of the
filter class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
<li>
<p>Link the client listener with this cache event filter factory by adding the
factory name to the <code>@ClientListener</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ClientListener(filterFactoryName = "static-filter")
public class EventPrintListener { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Register the listener with the server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(new EventPrintListener());</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also register dynamic filter instances that filter based on parameters
provided when the listener is registered are also possible. Filters use the
parameters received by the filter factories to enable this option, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Arrays;import org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory;
import org.infinispan.notifications.cachelistener.filter.CacheEventFilter;

class DynamicCacheEventFilterFactory implements CacheEventFilterFactory {
   @Override
   public CacheEventFilter&lt;Integer, String&gt; getFilter(Object[] params) {
      return new DynamicCacheEventFilter(params);
   }
}

// Class needs to be marshallable when running in a cluster
class DynamicCacheEventFilter implements CacheEventFilter&lt;Integer, String&gt;, Serializable {
   final Object[] params;

   DynamicCacheEventFilter(Object[] params) {
      this.params = params;
   }

   @ProtoFactory
   DynamicCacheEventFilter(Stream&lt;WrappedMessage&gt; wrappedParams) {
      this.params = wrappedParams.toArray();
   }

   @ProtoField(1)
   Stream&lt;WrappedMessage&gt; getParams() {
      // We must wrap the parameter in a WrappedMessage as the type is not known until runtime
      return Arrays.stream(params).map(WrappedMessage::new);
   }

   @Override
   public boolean accept(Integer key, String oldValue, Metadata oldMetadata,
         String newValue, Metadata newMetadata, EventType eventType) {
      if (key.equals(params[0])) // dynamic key
         return true;

      return false;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic parameters required to do the filtering are provided when the
listener is registered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(new EventPrintListener(), new Object[]{1}, null);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Filter instances have to marshallable when they are deployed in a
cluster so that the filtering can happen right where the event is generated,
even if the even is generated in a different node to where the listener is
registered.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="skipping_notifications"><a class="anchor" href="#skipping_notifications"></a>4.6.3. Skipping Notifications</h4>
<div class="paragraph">
<p>Include the <code>SKIP_LISTENER_NOTIFICATION</code> flag when calling remote API methods to
perform operations without getting event notifications from the server.
For example, to prevent listener notifications when creating or modifying values,
set the flag as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">remoteCache.withFlags(Flag.SKIP_LISTENER_NOTIFICATION).put(1, "one");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customizing_events"><a class="anchor" href="#customizing_events"></a>4.6.4. Customizing Events</h4>
<div class="paragraph">
<p>The events generated by default contain just enough information to make the
event relevant but they avoid cramming too much information in order to reduce
the cost of sending them. Optionally, the information shipped in the events
can be customised in order to contain more information, such as values, or to
contain even less information. This customization is done with <code>CacheEventConverter</code>
instances generated by a <code>CacheEventConverterFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory;
import org.infinispan.notifications.cachelistener.filter.CacheEventConverter;
import org.infinispan.filter.NamedFactory;

@NamedFactory(name = "static-converter")
class StaticConverterFactory implements CacheEventConverterFactory {
   final CacheEventConverter&lt;Integer, String, CustomEvent&gt; staticConverter = new StaticCacheEventConverter();
   public CacheEventConverter&lt;Integer, String, CustomEvent&gt; getConverter(final Object[] params) {
      return staticConverter;
   }
}

class StaticCacheEventConverter implements CacheEventConverter&lt;Integer, String, CustomEvent&gt;, Serializable {
   public CustomEvent convert(Integer key, String oldValue, Metadata oldMetadata, String newValue, Metadata newMetadata, EventType eventType) {
      return new CustomEvent(key, newValue);
   }
}

// Class needs to be marshallable when running in a cluster
@Proto
static record CustomEvent(Integer key, String value) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the converter generates a new custom event which
includes the value as well as the key in the event. This will result in bigger
event payloads compared with default events, but if combined with filtering,
it can reduce its network bandwidth cost.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The target type of the converter needs to be marshallable when running in a cluster
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Handling custom events requires a slightly different client listener
implementation to the one demonstrated previously. To be more precise, it
needs to handle <code>ClientCacheEntryCustomEvent</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.client.hotrod.annotation.*;
import org.infinispan.client.hotrod.event.*;

@ClientListener
public class CustomEventPrintListener {

   @ClientCacheEntryCreated
   @ClientCacheEntryModified
   @ClientCacheEntryRemoved
   public void handleCustomEvent(ClientCacheEntryCustomEvent&lt;CustomEvent&gt; e) {
      System.out.println(e);
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ClientCacheEntryCustomEvent</code> received in the callback exposes the custom
event via <code>getEventData</code> method, and the <code>getType</code> method provides information
on whether the event generated was as a result of cache entry creation,
modification or removal.</p>
</div>
<div class="paragraph">
<p>Similar to filtering, to be able to register a listener with this converter factory,
the factory has to be given a unique name, and the Hot Rod server needs to be
plugged with the name and the cache event converter factory instance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file with the converter implementation within it.</p>
<div class="paragraph">
<p>If the cache uses custom key/value classes, these must be
included in the JAR so that the callbacks can be executed with the correctly
unmarshalled key and/or value instances. If the client listener has <code>useRawData</code>
enabled, this is not necessary since the callback key/value instances will be
provided in binary format.</p>
</div>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</code> file
within the JAR file and within it, write the fully qualified class name of the
converter class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
<li>
<p>Link the client listener with this converter factory by adding the factory
name to the <code>@ClientListener</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ClientListener(converterFactoryName = "static-converter")
public class CustomEventPrintListener { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Register the listener with the server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(new CustomEventPrintListener());</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dynamic converter instances that convert based on parameters provided when the
listener is registered are also possible. Converters use the parameters received
by the converter factories to enable this option. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory;
import org.infinispan.notifications.cachelistener.filter.CacheEventConverter;

@NamedFactory(name = "dynamic-converter")
class DynamicCacheEventConverterFactory implements CacheEventConverterFactory {
   public CacheEventConverter&lt;Integer, String, CustomEvent&gt; getConverter(final Object[] params) {
      return new DynamicCacheEventConverter(params);
   }
}

// Class needs to be marshallable when running in a cluster
class DynamicCacheEventConverter implements CacheEventConverter&lt;Integer, String, CustomEvent&gt;, Serializable {
   final Object[] params;

   DynamicCacheEventConverter(Object[] params) {
      this.params = params;
   }

   @ProtoFactory
   DynamicCacheEventFilter(Stream&lt;WrappedMessage&gt; wrappedParams) {
      this.params = wrappedParams.toArray();
   }

   @ProtoField(1)
   Stream&lt;WrappedMessage&gt; getParams() {
      // We must wrap the parameter in a WrappedMessage as the type is not known until runtime
      return Arrays.stream(params).map(WrappedMessage::new);
   }

   public CustomEvent convert(Integer key, String oldValue, Metadata oldMetadata,
         String newValue, Metadata newMetadata, EventType eventType) {
      // If the key matches a key given via parameter, only send the key information
      if (params[0].equals(key))
         return new CustomEvent(key, null);

      return new CustomEvent(key, newValue);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic parameters required to do the conversion are provided when the
listener is registered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(new EventPrintListener(), null, new Object[]{1});</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Converter instances have to marshallable when they are deployed in a
cluster, so that the conversion can happen right where the event is generated,
even if the event is generated in a different node to where the listener is
registered.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="filter_and_custom_events"><a class="anchor" href="#filter_and_custom_events"></a>4.6.5. Filter and Custom Events</h4>
<div class="paragraph">
<p>If you want to do both event filtering and customization, it&#8217;s easier to
implement <code>org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverter</code>
which allows both filter and customization to happen in a single step.
For convenience, it&#8217;s recommended to extend
<code>org.infinispan.notifications.cachelistener.filter.AbstractCacheEventFilterConverter</code>
instead of implementing <code>org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverter</code>
directly. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory;
import org.infinispan.notifications.cachelistener.filter.CacheEventConverter;

@NamedFactory(name = "dynamic-filter-converter")
class DynamicCacheEventFilterConverterFactory implements CacheEventFilterConverterFactory {
   public CacheEventFilterConverter&lt;Integer, String, CustomEvent&gt; getFilterConverter(final Object[] params) {
      return new DynamicCacheEventFilterConverter(params);
   }
}

// Class needs to be marshallable when running in a cluster
class DynamicCacheEventFilterConverter extends AbstractCacheEventFilterConverter&lt;Integer, String, CustomEvent&gt;, Serializable {
   final Object[] params;

   DynamicCacheEventFilterConverter(Object[] params) {
      this.params = params;
   }

   @ProtoFactory
   DynamicCacheEventFilterConverter(Stream&lt;WrappedMessage&gt; wrappedParams) {
      this.params = wrappedParams.toArray();
   }

   @ProtoField(1)
   Stream&lt;WrappedMessage&gt; getParams() {
      // We must wrap the parameter in a WrappedMessage as the type is not known until runtime
      return Arrays.stream(params).map(WrappedMessage::new);
   }

   public CustomEvent filterAndConvert(Integer key, String oldValue, Metadata oldMetadata,
         String newValue, Metadata newMetadata, EventType eventType) {
      // If the key matches a key given via parameter, only send the key information
      if (params[0].equals(key))
         return new CustomEvent(key, null);

      return new CustomEvent(key, newValue);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to filters and converters, to be able to register a listener with this
combined filter/converter factory, the factory has to be given a unique name via the
<code>@NamedFactory</code> annotation, and the Hot Rod server needs to be plugged with the
name and the cache event converter factory instance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file with the converter implementation within it.</p>
<div class="paragraph">
<p>If the cache uses custom key/value classes, these must be included in the JAR
so that the callbacks can be executed with the correctly unmarshalled key
and/or value instances. If the client listener has <code>useRawData</code> enabled, this
is not necessary since the callback key/value instances will be provided in
binary format.</p>
</div>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverterFactory</code> file
within the JAR file and within it, write the fully qualified class name of the
converter class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From a client perspective, to be able to use the combined filter and
converter class, the client listener must define the same filter factory and
converter factory names, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ClientListener(filterFactoryName = "dynamic-filter-converter", converterFactoryName = "dynamic-filter-converter")
public class CustomEventPrintListener { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic parameters required in the example above are provided when the
listener is registered via either filter or converter parameters. If filter
parameters are non-empty, those are used, otherwise, the converter parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(new CustomEventPrintListener(), new Object[]{1}, null);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="event_marshalling"><a class="anchor" href="#event_marshalling"></a>4.6.6. Event Marshalling</h4>
<div class="paragraph">
<p>Hot Rod servers can store data in different formats, but in spite of that,
Java Hot Rod client users can still develop <code>CacheEventConverter</code> or <code>CacheEventFilter</code>
instances that work on typed objects. By default, filters and converter will use data as POJO
(application/x-java-object) but it is possible to override the desired format by overriding the
method <code>format()</code> from the filter/converter. If the format returns <code>null</code>, the filter/converter will receive
data as it&#8217;s stored.</p>
</div>
<div class="paragraph">
<p>Hot Rod Java clients can be configured to use different <code>org.infinispan.commons.marshall.Marshaller</code> instances.
If doing this and deploying <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances,
to be able to present filters/converter with Java Objects rather than marshalled content,
the server needs to be able to convert between objects and the binary format produced
by the marshaller.</p>
</div>
<div class="paragraph">
<p>To deploy a Marshaller instance server-side, follow a similar method to the one
used to deploy <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file with the converter implementation within it.</p>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.commons.marshall.Marshaller</code> file
within the JAR file and within it, write the fully qualified class name of the
marshaller class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the Marshaller could be deployed in either a separate jar, or in the
same jar as the <code>CacheEventConverter</code> and/or <code>CacheEventFilter</code> instances.</p>
</div>
<div class="sect4">
<h5 id="protostream_deployment"><a class="anchor" href="#protostream_deployment"></a>Deploying ProtoStream Marshallers</h5>
<div class="paragraph">
<p>If a cache stores Protobuf content, as it happens when using ProtoStream marshaller in the Hot Rod client,
it&#8217;s not necessary to deploy a custom marshaller since the format is already support by the server: there are
transcoders from Protobuf format to most common formats like JSON and POJO.</p>
</div>
<div class="paragraph">
<p>When using filters/converters with those caches, and it&#8217;s desirable to use filter/converters with Java Objects rather
binary Protobuf data, it&#8217;s necessary to configure the extra ProtoStream marshallers so that the server can unmarshall
the data before filtering/converting. To do so, you must configure the required <code>SerializationContextInitializer(s)</code>
as part of the Infinispan server configuration.</p>
</div>
<div class="paragraph">
<p>See <a href="../encoding/encoding.html">Cache Encoding and Marshalling</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listener_state_handling"><a class="anchor" href="#listener_state_handling"></a>4.6.7. Listener State Handling</h4>
<div class="paragraph">
<p>Client listener annotation has an optional <code>includeCurrentState</code> attribute
that specifies whether state will be sent to the client when the listener is
added or when there&#8217;s a failover of the listener.</p>
</div>
<div class="paragraph">
<p>By default, <code>includeCurrentState</code> is false, but if set to true and a client
listener is added in a cache already containing data, the server iterates over
the cache contents and sends an event for each entry to the client as a
<code>ClientCacheEntryCreated</code> (or custom event if configured). This allows clients
to build some local data structures based on the existing content. Once the
content has been iterated over, events are received as normal, as cache
updates are received.  If the cache is clustered, the entire cluster wide
contents are iterated over.</p>
</div>
</div>
<div class="sect3">
<h4 id="listener_failure_handling"><a class="anchor" href="#listener_failure_handling"></a>4.6.8. Listener Failure Handling</h4>
<div class="paragraph">
<p>When a Hot Rod client registers a client listener, it does so in a single
node in a cluster. If that node fails, the Java Hot Rod client detects that
transparently and fails over all listeners registered in the node that failed
to another node.</p>
</div>
<div class="paragraph">
<p>During this fail over the client might miss some events. To avoid missing
these events, the client listener annotation contains an optional parameter
called <code>includeCurrentState</code> which if set to true, when the failover happens,
the cache contents can iterated over and <code>ClientCacheEntryCreated</code> events
(or custom events if configured) are generated. By default,
<code>includeCurrentState</code> is set to false.</p>
</div>
<div class="paragraph">
<p>Use callbacks to handle failover events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ClientCacheFailover
public void handleFailover(ClientCacheFailoverEvent e) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is very useful in use cases where the client has cached some data, and
as a result of the fail over, taking in account that some events could be
missed, it could decide to clear any locally cached data when the fail over
event is received, with the knowledge that after the fail over event, it will
receive events for the contents of the entire cache.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hotrod_transactions"><a class="anchor" href="#hotrod_transactions"></a>4.7. Hot Rod Java Client Transactions</h3>
<div class="paragraph">
<p>You can configure and use Hot Rod clients in JTA <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/Transaction.html">Transaction</a>s.</p>
</div>
<div class="paragraph">
<p>To participate in a transaction, the Hot Rod client requires the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> with which it interacts and whether it participates in the transaction through the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/Synchronization.html">Synchronization</a> or <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/xa/XAResource.html">XAResource</a> interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Transactions are optimistic in that clients acquire write locks on entries during the prepare phase.
To avoid data inconsistency, be sure to read about <a href="#hr_transactions_force_return_value">Detecting Conflicts with Transactions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="hr_transactions_config_server"><a class="anchor" href="#hr_transactions_config_server"></a>4.7.1. Configuring the Server</h4>
<div class="paragraph">
<p>Caches in the server must also be transactional for clients to participate in JTA <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/Transaction.html">Transaction</a>s.</p>
</div>
<div class="paragraph">
<p>The following server configuration is required, otherwise transactions rollback only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Isolation level must be <code>REPEATABLE_READ</code>.</p>
</li>
<li>
<p><code>PESSIMISTIC</code> locking mode is recommended but <code>OPTIMISTIC</code> can be used.</p>
</li>
<li>
<p>Transaction mode should be <code>NON_XA</code> or <code>NON_DURABLE_XA</code>.
Hot Rod transactions should not use <code>FULL_XA</code> because it degrades performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;replicated-cache name="hotrodReplTx"&gt;
  &lt;locking isolation="REPEATABLE_READ"/&gt;
  &lt;transaction mode="NON_XA" locking="PESSIMISTIC"/&gt;
&lt;/replicated-cache&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hot Rod transactions have their own recovery mechanism.</p>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_config_client"><a class="anchor" href="#hr_transactions_config_client"></a>4.7.2. Configuring Hot Rod Clients</h4>
<div class="paragraph">
<p>Transactional <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> are configured per-cache basis.
The exception is the transaction&#8217;s <code>timeout</code> which is global, because a single transaction can interact with multiple <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a>s.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Embedded Infinispan supports pessimistic locks but Hot Rod clients do not. Therefore, the transaction result obtained from using pessimistic locks in Infinispan server might differ from the result obtained from Hot Rod client.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to configure a transactional <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> for cache <code>my-cache</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">org.infinispan.client.hotrod.configuration.ConfigurationBuilder cb = new org.infinispan.client.hotrod.configuration.ConfigurationBuilder();
//other client configuration parameters
cb.transactionTimeout(1, TimeUnit.MINUTES);
cb.remoteCache("my-cache")
   .transactionManagerLookup(GenericTransactionManagerLookup.getInstance())
   .transactionMode(TransactionMode.NON_XA);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="../../apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">ConfigurationBuilder</a> and <a href="../../apidocs/org/infinispan/client/hotrod/configuration/RemoteCacheConfigurationBuilder.html">RemoteCacheConfigurationBuilder</a> Javadoc for documentation on configuration parameters.</p>
</div>
<div class="paragraph">
<p>You can also configure the Java Hot Rod client with a properties file, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">infinispan.client.hotrod.cache.my-cache.transaction.transaction_manager_lookup = org.infinispan.client.hotrod.transaction.lookup.GenericTransactionManagerLookup
infinispan.client.hotrod.cache.my-cache.transaction.transaction_mode = NON_XA
infinispan.client.hotrod.transaction.timeout = 60000</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="hr_transactions_tmlookup"><a class="anchor" href="#hr_transactions_tmlookup"></a>TransactionManagerLookup Interface</h5>
<div class="paragraph">
<p><code>TransactionManagerLookup</code> provides an entry point to fetch a <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a>.</p>
</div>
<div class="paragraph">
<p>Available implementations of <code>TransactionManagerLookup</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../../apidocs/org/infinispan/client/hotrod/transaction/lookup/GenericTransactionManagerLookup.html">GenericTransactionManagerLookup</a></dt>
<dd>
<p>A lookup class that locates <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a>s running in Java EE application servers.
Defaults to the <a href="../../apidocs/org/infinispan/client/hotrod/transaction/manager/RemoteTransactionManager.html">RemoteTransactionManager</a> if it cannot find a <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a>.
This is the default for Hot Rod Java clients.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In most cases, <a href="../../apidocs/org/infinispan/client/hotrod/transaction/lookup/GenericTransactionManagerLookup.html">GenericTransactionManagerLookup</a> is suitable.
However, you can implement the <code>TransactionManagerLookup</code> interface if you need to integrate a custom <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../../apidocs/org/infinispan/client/hotrod/transaction/lookup/RemoteTransactionManagerLookup.html">RemoteTransactionManagerLookup</a></dt>
<dd>
<p>A basic, and volatile, <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> if no other implementation is available.
Note that this implementation has significant limitations when handling concurrent transactions and recovery.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_modes"><a class="anchor" href="#hr_transactions_modes"></a>4.7.3. Transaction Modes</h4>
<div class="paragraph">
<p><a href="../../apidocs/org/infinispan/client/hotrod/configuration/TransactionMode.html">TransactionMode</a> controls how a <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Configure transaction modes on both the Infinispan server and your client application.
If clients attempt to perform transactional operations on non-transactional caches, runtime exceptions can occur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Transaction modes are the same in both the Infinispan configuration and client settings.
Use the following modes with your client, see the Infinispan configuration schema for the server:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NONE</code></dt>
<dd>
<p>The <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> does not interact with the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a>.
This is the default mode and is non-transactional.</p>
</dd>
<dt class="hdlist1"><code>NON_XA</code></dt>
<dd>
<p>The <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> via <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/Synchronization.html">Synchronization</a>.</p>
</dd>
<dt class="hdlist1"><code>NON_DURABLE_XA</code></dt>
<dd>
<p>The <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> via <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/xa/XAResource.html">XAResource</a>.
Recovery capabilities are disabled.</p>
</dd>
<dt class="hdlist1"><code>FULL_XA</code></dt>
<dd>
<p>The <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> via <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/xa/XAResource.html">XAResource</a>.
Recovery capabilities are enabled.
Invoke the <code>XaResource.recover()</code> method to retrieve transactions to recover.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_force_return_value"><a class="anchor" href="#hr_transactions_force_return_value"></a>4.7.4. Detecting Conflicts with Transactions</h4>
<div class="paragraph">
<p>Transactions use the initial values of keys to detect conflicts.</p>
</div>
<div class="paragraph">
<p>For example, "k" has a value of "v" when a transaction begins.
During the prepare phase, the transaction fetches "k" from the server to read the value.
If the value has changed, the transaction rolls back to avoid a conflict.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Transactions use versions to detect changes instead of checking value equality.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>forceReturnValue</code> parameter controls write operations to the <a href="../../apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> and helps avoid conflicts.
It has the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>true</code>, the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> fetches the most recent value from the server before performing write operations.
However, the <code>forceReturnValue</code> parameter applies only to write operations that access the key for the first time.</p>
</li>
<li>
<p>If <code>false</code>, the <a href="https://jakarta.ee/specifications/platform/9/apidocs/javax/transaction/TransactionManager.html">TransactionManager</a> does not fetch the most recent value from the server before performing write operations.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This parameter does not affect <em>conditional</em> write operations such as <code>replace</code> or <code>putIfAbsent</code>
because they require the most recent value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following transactions provide an example where the <code>forceReturnValue</code> parameter can prevent conflicting write operations:</p>
</div>
<div class="listingblock">
<div class="title">Transaction 1 (TX1)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;String, String&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.put("k", "v1");
tm.commit();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Transaction 2 (TX2)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;String, String&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.put("k", "v2");
tm.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, TX1 and TX2 are executed in parallel.
The initial value of "k" is "v".</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>forceReturnValue = true</code>, the <code>cache.put()</code> operation fetches the value for "k" from the server in both TX1 and TX2.
The transaction that acquires the lock for "k" first then commits.
The other transaction rolls back during the commit phase because the transaction can detect that "k" has a value other than "v".</p>
</li>
<li>
<p>If <code>forceReturnValue = false</code>, the <code>cache.put()</code> operation does not fetch the value for "k" from the server and returns null.
Both TX1 and TX2 can successfully commit, which results in a conflict.
This occurs because neither transaction can detect that the initial value of "k" changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following transactions include <code>cache.get()</code> operations to read the value for "k" before doing the <code>cache.put()</code> operations:</p>
</div>
<div class="listingblock">
<div class="title">Transaction 1 (TX1)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;String, String&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.get("k");
cache.put("k", "v1");
tm.commit();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Transaction 2 (TX2)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteCache&lt;String, String&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.get("k");
cache.put("k", "v2");
tm.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding examples, TX1 and TX2 both read the key so the <code>forceReturnValue</code> parameter does not take effect.
One transaction commits, the other rolls back.
However, the <code>cache.get()</code> operation requires an additional server request.
If you do not need the return value for the <code>cache.put()</code> operation that server request is inefficient.</p>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_ex_use_config"><a class="anchor" href="#hr_transactions_ex_use_config"></a>4.7.5. Using the Configured Transaction Manager and Transaction Mode</h4>
<div class="paragraph">
<p>The following example shows how to use the <code>TransactionManager</code> and <code>TransactionMode</code> that you configure in the <code>RemoteCacheManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//Configure the transaction manager and transaction mode.
org.infinispan.client.hotrod.configuration.ConfigurationBuilder cb = new org.infinispan.client.hotrod.configuration.ConfigurationBuilder();
cb.remoteCache("my-cache")
    .transactionManagerLookup(RemoteTransactionManagerLookup.getInstance())
    .transactionMode(TransactionMode.NON_XA);

RemoteCacheManager rcm = new RemoteCacheManager(cb.build());

//The my-cache instance uses the RemoteCacheManager configuration.
RemoteCache&lt;String, String&gt; cache = rcm.getCache("my-cache");

//Return the transaction manager that the cache uses.
TransactionManager tm = cache.getTransactionManager();

//Perform a simple transaction.
tm.begin();
cache.put("k1", "v1");
System.out.println("K1 value is " + cache.get("k1"));
tm.commit();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remotecache_multimapcachemanager-hotrod-client-api"><a class="anchor" href="#remotecache_multimapcachemanager-hotrod-client-api"></a>4.8. Counter API</h3>
<div class="paragraph">
<p>The <code>MultimapCacheManager</code> interface is the entry point to get a <code>RemoteMultimapCache</code>.</p>
</div>
<div class="paragraph">
<p>Hot Rod clients can retrieve the <code>MultimapCacheManager</code> interface as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// create or obtain your RemoteCacheManager
RemoteCacheManager manager = ...;

// retrieve the MultimapCacheManager
MultimapCacheManager multimapCacheManager = RemoteMultimapCacheManagerFactory.from(manager);

// retrieve the RemoteMultimapCache
RemoteMultimapCache&lt;Integer, String&gt; people = multimapCacheManager.get("people");

// add key - values
people.put("coders", "Will");
people.put("coders", "Auri");
people.put("coders", "Pedro");

// retrieve single key with multiple values
Collection&lt;String&gt; coders = people.get("coders").join();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="junit-testing"><a class="anchor" href="#junit-testing"></a>5. JUnit testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run JUnit tests for Infinispan.</p>
</div>
<div class="sect2">
<h3 id="testing_infinispan_with_test_containers"><a class="anchor" href="#testing_infinispan_with_test_containers"></a>5.1. Testing Infinispan with test containers</h3>
<div class="paragraph">
<p>Run <a href="https://infinispan.org">Infinispan Server</a> instances using <a href="https://www.testcontainers.org">Testcontainers</a> for faster, simpler JUnit tests.</p>
</div>
<div class="paragraph">
<p>The Infinispan Server test container is based on the <a href="https://github.com/infinispan/infinispan-images/">official container image</a> provided by Infinispan.</p>
</div>
<div class="sect3">
<h4 id="starting_the_infinispan_test_container"><a class="anchor" href="#starting_the_infinispan_test_container"></a>5.1.1. Starting the Infinispan test container</h4>
<div class="paragraph">
<p>You can start the Infinispan Server container instance from any Java application as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (InfinispanContainer container = new InfinispanContainer()) {
   container.start();
   try (RemoteCacheManager cacheManager = new RemoteCacheManager(container.getConnectionURI()))) {
      // Use the RemoteCacheManager
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changing_credentials"><a class="anchor" href="#changing_credentials"></a>5.1.2. Changing credentials</h4>
<div class="paragraph">
<p>Infinispan Server is configured with the following default credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username: <code>admin</code></p>
</li>
<li>
<p>Password: <code>secret</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add custom credentials with the <code>withUser()</code> and <code>withPassword()</code> methods before starting the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">InfinispanContainer container = new InfinispanContainer();
container.withUser("admin").withPassword("secret");
container.start();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding_the_test_container_to_your_project_dependencies"><a class="anchor" href="#adding_the_test_container_to_your_project_dependencies"></a>5.1.3. Adding the test container to your project dependencies</h4>
<div class="paragraph">
<p>Add the following dependency to your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.infinispan&lt;/groupId&gt;
    &lt;artifactId&gt;testcontainers-infinispan&lt;/artifactId&gt;
    &lt;version&gt;{{latest_version}}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-12-17 13:44:02 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>