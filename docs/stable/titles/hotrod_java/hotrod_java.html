<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Hot Rod Java Client Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Hot Rod Java Client Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#hotrod-java-client">1. Hot Rod Java Clients</a>
<ul class="sectlevel2">
<li><a href="#hotrod_hotrod-java-client">1.1. Hot Rod Protocol</a>
<ul class="sectlevel3">
<li><a href="#hotrod-client-intelligence_hotrod-java-client">1.1.1. Client Intelligence</a></li>
<li><a href="#request-balancing_hotrod-java-client">1.1.2. Request Balancing</a></li>
<li><a href="#hotrod_failover">1.1.3. Client Failover</a></li>
</ul>
</li>
<li><a href="#configuring-maven-repository">1.2. Configuring the Infinispan Maven repository</a>
<ul class="sectlevel3">
<li><a href="#configuring-pom-xml_configuring-maven-repository">1.2.1. Configuring your Infinispan POM</a></li>
</ul>
</li>
<li><a href="#adding-hotrod-client-dependencies_hotrod-java-client">1.3. Adding Hot Rod Java Client Dependencies</a></li>
</ul>
</li>
<li><a href="#hotrod-client-configuration_hotrod-java-client">2. Hot Rod Java Client Configuration</a>
<ul class="sectlevel2">
<li><a href="#configuring-hotrod-java-clients_hotrod-client-configuration">2.1. Configuring Hot Rod Client Connections</a>
<ul class="sectlevel3">
<li><a href="#configuring-hotrod-clusters_hotrod-client-configuration">2.1.1. Defining Infinispan Clusters in Client Configuration</a></li>
<li><a href="#switching-hotrod-clusters_hotrod-client-configuration">2.1.2. Manually Switching Infinispan Clusters</a></li>
<li><a href="#configuring-hotrod-connection-pools_hotrod-client-configuration">2.1.3. Configuring Connection Pools</a></li>
</ul>
</li>
<li><a href="#hot-rod-authentication-mechanisms_hotrod-client-configuration">2.2. Hot Rod authentication mechanisms</a>
<ul class="sectlevel3">
<li><a href="#configuring-hotrod-authentication_hotrod-client-configuration">2.2.1. Configuring Authentication Mechanisms for Hot Rod Clients</a></li>
<li><a href="#hotrod_auth_tgt">2.2.2. Creating GSSAPI Login Contexts</a></li>
</ul>
</li>
<li><a href="#configuring-hotrod-encryption_hotrod-client-configuration">2.3. Configuring Hot Rod client encryption</a></li>
<li><a href="#enabling-hotrod-client-statistics_hotrod-client-configuration">2.4. Enabling Hot Rod client statistics</a></li>
<li><a href="#near-caches-hotrod-client-configuration">2.5. Near Caches</a>
<ul class="sectlevel3">
<li><a href="#configuring-near-caching-hotrod-client-configuration">2.5.1. Configuring Near Caches</a></li>
</ul>
</li>
<li><a href="#forcing-return-values_hotrod-client-configuration">2.6. Forcing Return Values</a></li>
<li><a href="#creating-caches-hotrod_hotrod-client-configuration">2.7. Creating remote caches from Hot Rod clients</a></li>
</ul>
</li>
<li><a href="#hotrod-client-api_hotrod-java-client">3. Hot Rod Client API</a>
<ul class="sectlevel2">
<li><a href="#remotecache_api">3.1. RemoteCache API</a>
<ul class="sectlevel3">
<li><a href="#hotrod_unsupported_methods">3.1.1. Unsupported Methods</a></li>
</ul>
</li>
<li><a href="#hr_remote_iterator">3.2. Remote Iterator API</a>
<ul class="sectlevel3">
<li><a href="#custom_filters">3.2.1. Deploying Custom Filters to Infinispan Server</a></li>
</ul>
</li>
<li><a href="#hr_versioned_api">3.3. MetadataValue API</a></li>
<li><a href="#hotrod_streaming">3.4. Streaming API</a></li>
<li><a href="#remotecache_countermanager-hotrod-client-api">3.5. Counter API</a></li>
<li><a href="#creating_event_listeners">3.6. Creating Event Listeners</a>
<ul class="sectlevel3">
<li><a href="#removing_event_listeners">3.6.1. Removing Event Listeners</a></li>
<li><a href="#filtering_events">3.6.2. Filtering Events</a></li>
<li><a href="#skipping_notifications">3.6.3. Skipping Notifications</a></li>
<li><a href="#customizing_events">3.6.4. Customizing Events</a></li>
<li><a href="#filter_and_custom_events">3.6.5. Filter and Custom Events</a></li>
<li><a href="#event_marshalling">3.6.6. Event Marshalling</a>
<ul class="sectlevel4">
<li><a href="#protostream_deployment">Deploying Protostream Marshallers</a></li>
</ul>
</li>
<li><a href="#listener_state_handling">3.6.7. Listener State Handling</a></li>
<li><a href="#listener_failure_handling">3.6.8. Listener Failure Handling</a></li>
</ul>
</li>
<li><a href="#hotrod_transactions">3.7. Hot Rod Java Client Transactions</a>
<ul class="sectlevel3">
<li><a href="#hr_transactions_config_server">3.7.1. Configuring the Server</a></li>
<li><a href="#hr_transactions_config_client">3.7.2. Configuring Hot Rod Clients</a>
<ul class="sectlevel4">
<li><a href="#hr_transactions_tmlookup">TransactionManagerLookup Interface</a></li>
</ul>
</li>
<li><a href="#hr_transactions_modes">3.7.3. Transaction Modes</a></li>
<li><a href="#hr_transactions_force_return_value">3.7.4. Detecting Conflicts with Transactions</a></li>
<li><a href="#hr_transactions_ex_use_config">3.7.5. Using the Configured Transaction Manager and Transaction Mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#junit-testing">4. JUnit testing</a>
<ul class="sectlevel2">
<li><a href="#testing_infinispan_with_test_containers">4.1. Testing Infinispan with test containers</a>
<ul class="sectlevel3">
<li><a href="#starting_the_infinispan_test_container">4.1.1. Starting the Infinispan test container</a></li>
<li><a href="#changing_credentials">4.1.2. Changing credentials</a></li>
<li><a href="#adding_the_test_container_to_your_project_dependencies">4.1.3. Adding the test container to your project dependencies</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="hotrod-java-client"><a class="anchor" href="#hotrod-java-client"></a>1. Hot Rod Java Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Access Infinispan remotely through the Hot Rod Java client API.</p>
</div>
<div class="sect2">
<h3 id="hotrod_hotrod-java-client"><a class="anchor" href="#hotrod_hotrod-java-client"></a>1.1. Hot Rod Protocol</h3>
<div class="paragraph">
<p>Hot Rod is a binary TCP protocol that Infinispan offers high-performance client-server interactions with the following capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Load balancing. Hot Rod clients can send requests across Infinispan clusters
using different strategies.</p>
</li>
<li>
<p>Failover. Hot Rod clients can monitor Infinispan cluster topology changes
and automatically switch to available nodes.</p>
</li>
<li>
<p>Efficient data location. Hot Rod clients can find key owners and make
requests directly to those nodes, which reduces latency.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="hotrod-client-intelligence_hotrod-java-client"><a class="anchor" href="#hotrod-client-intelligence_hotrod-java-client"></a>1.1.1. Client Intelligence</h4>
<div class="paragraph">
<p>Hot Rod clients use intelligence mechanisms to efficiently send requests to Infinispan Server clusters.</p>
</div>
<div class="paragraph">
<div class="title"><code>BASIC</code> intelligence</div>
<p>Clients do not receive topology change events for Infinispan clusters, such as nodes joining or leaving, and use only the list of Infinispan Server network locations that you add to the client configuration.</p>
</div>
<div class="paragraph">
<div class="title"><code>TOPOLOGY_AWARE</code> intelligence</div>
<p>Clients receive and store topology change events for Infinispan clusters to dynamically keep track of Infinispan Servers on the network.</p>
</div>
<div class="paragraph">
<p>To receive cluster topology, clients need the network location, either IP address or host name, of at least one Hot Rod server at startup.
After the client connects, Infinispan Server transmits the topology to the client.
When Infinispan Server nodes join or leave the cluster, Infinispan transmits an updated topology to the client.</p>
</div>
<div class="paragraph">
<div class="title"><code>HASH_DISTRIBUTION_AWARE</code> intelligence</div>
<p>Clients receive and store topology change events for Infinispan clusters in addition to hashing information that enables clients to identify which nodes store specific keys.</p>
</div>
<div class="paragraph">
<p>For example, consider a <code>put(k,v)</code> operation. The client calculates the hash value for the key so it can locate the exact Infinispan Server node on which the data resides.
Clients can then connect directly to that node to perform read and write operations.</p>
</div>
<div class="paragraph">
<p>The benefit of <code>HASH_DISTRIBUTION_AWARE</code> intelligence is that Infinispan Server does not need to look up values based on key hashes, which uses less server-side resources.
Another benefit is that Infinispan Server responds to client requests more quickly because they do not need to make additional network roundtrips.</p>
</div>
<h5 id="configuration" class="discrete">Configuration</h5>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.clientIntelligence(ClientIntelligence.BASIC);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.client_intelligence=BASIC</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/ClientIntelligence.html">org.infinispan.client.hotrod.configuration.ClientIntelligence</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="request-balancing_hotrod-java-client"><a class="anchor" href="#request-balancing_hotrod-java-client"></a>1.1.2. Request Balancing</h4>
<div class="paragraph">
<p>Hot Rod Java clients balance requests to Infinispan Server clusters so that read and write operations are spread across nodes.</p>
</div>
<div class="paragraph">
<p>Clients that use <code>BASIC</code> or <code>TOPOLOGY_AWARE</code> intelligence use request balancing for all requests.
Clients that use <code>HASH_DISTRIBUTION_AWARE</code> intelligence send requests directly to the node that stores the desired key.
If the node does not respond, the clients then fall back to request balancing.</p>
</div>
<div class="paragraph">
<p>The default balancing strategy is round-robin, so Hot Rod clients perform request balancing as in the following example where <code>s1</code>, <code>s2</code>, <code>s3</code> are nodes in a Infinispan cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Connect to the Infinispan cluster</span>
RemoteCacheManager cacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());
<span class="comment">// Obtain the remote cache</span>
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

<span class="comment">//Hot Rod client sends a request to the &quot;s1&quot; node</span>
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>);
<span class="comment">//Hot Rod client sends a request to the &quot;s2&quot; node</span>
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>);
<span class="comment">//Hot Rod client sends a request to the &quot;s3&quot; node</span>
<span class="predefined-type">String</span> value = cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>);
<span class="comment">//Hot Rod client sends the next request to the &quot;s1&quot; node again</span>
cache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Custom balancing policies</div>
<p>You can use custom <code>FailoverRequestBalancingStrategy</code> implementations if you add your class in the Hot Rod client configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServer()
         .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
         .port(<span class="integer">11222</span>)
         .balancingStrategy(<span class="keyword">new</span> MyCustomBalancingStrategy());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.request_balancing_strategy=my.package.MyCustomBalancingStrategy</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/FailoverRequestBalancingStrategy.html">org.infinispan.client.hotrod.FailoverRequestBalancingStrategy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="hotrod_failover"><a class="anchor" href="#hotrod_failover"></a>1.1.3. Client Failover</h4>
<div class="paragraph">
<p>Hot Rod clients can automatically failover when Infinispan cluster topologies
change. For instance, Hot Rod clients that are topology-aware can detect when
one or more Infinispan servers fail.</p>
</div>
<div class="paragraph">
<p>In addition to failover between clustered Infinispan servers, Hot Rod clients
can failover between Infinispan clusters.</p>
</div>
<div class="paragraph">
<p>For example, you have a Infinispan cluster running in New York (<strong>NYC</strong>) and
another cluster running in London (<strong>LON</strong>). Clients sending requests to
<strong>NYC</strong> detect that no nodes are available so they switch to the cluster in
<strong>LON</strong>. Clients then maintain connections to <strong>LON</strong> until you manually switch
clusters or failover happens again.</p>
</div>
<div class="paragraph">
<div class="title">Transactional Caches with Failover</div>
<p>Conditional operations, such as <code>putIfAbsent()</code>, <code>replace()</code>, <code>remove()</code>, have
strict method return guarantees. Likewise, some operations can require previous
values to be returned.</p>
</div>
<div class="paragraph">
<p>Even though Hot Rod clients can failover, you should use transactional caches
to ensure that operations do not partially complete and leave conflicting
entries on different nodes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-maven-repository"><a class="anchor" href="#configuring-maven-repository"></a>1.2. Configuring the Infinispan Maven repository</h3>
<div class="paragraph">
<p>Infinispan Java distributions are available from Maven.</p>
</div>
<div class="paragraph">
<p>Infinispan artifacts are available from Maven central. See the <a href="https://search.maven.org/search?q=g:org.infinispan">org.infinispan</a> group for available Infinispan artifacts.</p>
</div>
<div class="sect3">
<h4 id="configuring-pom-xml_configuring-maven-repository"><a class="anchor" href="#configuring-pom-xml_configuring-maven-repository"></a>1.2.1. Configuring your Infinispan POM</h4>
<div class="paragraph">
<p>Maven uses configuration files called Project Object Model (POM) files to
define projects and manage builds. POM files are in XML format and describe the
module and component dependencies, build order, and targets for the resulting
project packaging and output.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your project <code>pom.xml</code> for editing.</p>
</li>
<li>
<p>Define the <code>version.infinispan</code> property with the correct Infinispan version.</p>
</li>
<li>
<p>Include the <code>infinispan-bom</code> in a <code>dependencyManagement</code> section.</p>
<div class="paragraph">
<p>The Bill Of Materials (BOM) controls dependency versions, which avoids version
conflicts and means you do not need to set the version for each Infinispan
artifact you add as a dependency to your project.</p>
</div>
</li>
<li>
<p>Save and close <code>pom.xml</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows the Infinispan version and BOM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
  <span class="tag">&lt;version.infinispan&gt;</span>13.0.4.Final<span class="tag">&lt;/version.infinispan&gt;</span>
<span class="tag">&lt;/properties&gt;</span>

<span class="tag">&lt;dependencyManagement&gt;</span>
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>infinispan-bom<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
      <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Next Steps</div>
<p>Add Infinispan artifacts as dependencies to your <code>pom.xml</code> as required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-hotrod-client-dependencies_hotrod-java-client"><a class="anchor" href="#adding-hotrod-client-dependencies_hotrod-java-client"></a>1.3. Adding Hot Rod Java Client Dependencies</h3>
<div class="paragraph">
<p>Add Hot Rod Java client dependencies to include it in your project.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Java 8 or Java 11</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add the <code>infinispan-client-hotrod</code> artifact as a dependency in your <code>pom.xml</code>
as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-client-hotrod<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="../server/server.html#server_requirements">Infinispan Server Requirements</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hotrod-client-configuration_hotrod-java-client"><a class="anchor" href="#hotrod-client-configuration_hotrod-java-client"></a>2. Hot Rod Java Client Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides a Hot Rod Java client configuration API that exposes configuration properties.</p>
</div>
<div class="sect2">
<h3 id="configuring-hotrod-java-clients_hotrod-client-configuration"><a class="anchor" href="#configuring-hotrod-java-clients_hotrod-client-configuration"></a>2.1. Configuring Hot Rod Client Connections</h3>
<div class="paragraph">
<p>Configure Hot Rod Java client connections to Infinispan Server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>ConfigurationBuilder</code> class to generate immutable configuration
objects that you can pass to <code>RemoteCacheManager</code> or use a <code>hotrod-client.properties</code> file on the application classpath.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServer()
         .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
         .port(ConfigurationProperties.DEFAULT_HOTROD_PORT)
       .addServer()
         .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.0.2.0</span><span class="delimiter">&quot;</span></span>)
         .port(ConfigurationProperties.DEFAULT_HOTROD_PORT)
       .security().authentication()
         .username(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>)
         .password(<span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>)
         .realm(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>)
         .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">SCRAM-SHA-512</span><span class="delimiter">&quot;</span></span>);
RemoteCacheManager cacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.server_list = 127.0.0.1:11222,192.0.2.0:11222
infinispan.client.hotrod.auth_username = username
infinispan.client.hotrod.auth_password = changeme
infinispan.client.hotrod.auth_realm = default
infinispan.client.hotrod.sasl_mechanism = SCRAM-SHA-512</code></pre>
</div>
</div>
<h4 id="configuring_hot_rod_uris" class="discrete">Configuring Hot Rod URIs</h4>
<div class="paragraph">
<p>You can also configure Hot Rod client connections with URIs as follows:</p>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod://username:changeme@127.0.0.1:11222,192.0.2.0:11222?auth_realm=default&amp;sasl_mechanism=SCRAM-SHA-512</span><span class="delimiter">&quot;</span></span>);
RemoteCacheManager cacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.uri = hotrod://username:changeme@127.0.0.1:11222,192.0.2.0:11222?auth_realm=default&amp;sasl_mechanism=SCRAM-SHA-512</code></pre>
</div>
</div>
<h4 id="adding_properties_outside_the_classpath" class="discrete">Adding properties outside the classpath</h4>
<div class="paragraph">
<p>If the <code>hotrod-client.properties</code> file is not on the application classpath then you need to specify the location, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
<span class="predefined-type">Properties</span> p = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="keyword">try</span>(<span class="predefined-type">Reader</span> r = <span class="keyword">new</span> <span class="predefined-type">FileReader</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/hotrod-client.properties</span><span class="delimiter">&quot;</span></span>)) {
   p.load(r);
   builder.withProperties(p);
}
RemoteCacheManager cacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod Client Configuration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html#RemoteCacheManager-java.net.URL-">org.infinispan.client.hotrod.RemoteCacheManager</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-hotrod-clusters_hotrod-client-configuration"><a class="anchor" href="#configuring-hotrod-clusters_hotrod-client-configuration"></a>2.1.1. Defining Infinispan Clusters in Client Configuration</h4>
<div class="paragraph">
<p>Provide the locations of Infinispan clusters in Hot Rod client configuration.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Provide at least one Infinispan cluster name along with a host name and port for at least one node with the <code>ClusterConfigurationBuilder</code> class.</p>
<div class="paragraph">
<p>If you want to define a cluster as default, so that clients always attempt to connect to it first, then define a server list with the <code>addServers("&lt;host_name&gt;:&lt;port&gt;; &lt;host_name&gt;:&lt;port&gt;")</code> method.</p>
</div>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Multiple cluster connections</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addCluster(<span class="string"><span class="delimiter">&quot;</span><span class="content">siteA</span><span class="delimiter">&quot;</span></span>)
               .addClusterNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostA1</span><span class="delimiter">&quot;</span></span>, <span class="integer">11222</span>)
               .addClusterNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostA2</span><span class="delimiter">&quot;</span></span>, <span class="integer">11222</span>)
             .addCluster(<span class="string"><span class="delimiter">&quot;</span><span class="content">siteB</span><span class="delimiter">&quot;</span></span>)
               .addClusterNodes(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostB1:11222; hostB2:11222</span><span class="delimiter">&quot;</span></span>);
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Default server list with a failover cluster</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServers(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostA1:11222; hostA2:11222</span><span class="delimiter">&quot;</span></span>)
             .addCluster(<span class="string"><span class="delimiter">&quot;</span><span class="content">siteB</span><span class="delimiter">&quot;</span></span>)
               .addClusterNodes(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostB1:11222; hostB2:11223</span><span class="delimiter">&quot;</span></span>);
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="switching-hotrod-clusters_hotrod-client-configuration"><a class="anchor" href="#switching-hotrod-clusters_hotrod-client-configuration"></a>2.1.2. Manually Switching Infinispan Clusters</h4>
<div class="paragraph">
<p>Manually switch Hot Rod Java client connections between Infinispan clusters.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Call one of the following methods in the <code>RemoteCacheManager</code> class:</p>
<div class="paragraph">
<p><code>switchToCluster(clusterName)</code> switches to a specific cluster defined in the
client configuration.</p>
</div>
<div class="paragraph">
<p><code>switchToDefaultCluster()</code> switches to the default cluster in the client
configuration, which is defined as a list of Infinispan servers.</p>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hotrod-connection-pools_hotrod-client-configuration"><a class="anchor" href="#configuring-hotrod-connection-pools_hotrod-client-configuration"></a>2.1.3. Configuring Connection Pools</h4>
<div class="paragraph">
<p>Hot Rod Java clients keep pools of persistent connections to Infinispan servers to reuse TCP connections instead of creating them on each request.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure Hot Rod client connection pool settings as in the following examples:</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .connectionPool()
               .maxActive(<span class="integer">10</span>)
               exhaustedAction(ExhaustedAction.valueOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">WAIT</span><span class="delimiter">&quot;</span></span>))
               .maxWait(<span class="integer">1</span>)
               .minIdle(<span class="integer">20</span>)
               .minEvictableIdleTime(<span class="integer">300000</span>)
               .maxPendingRequests(<span class="integer">20</span>);
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.server_list = 127.0.0.1:11222
infinispan.client.hotrod.connection_pool.max_active = 10
infinispan.client.hotrod.connection_pool.exhausted_action = WAIT
infinispan.client.hotrod.connection_pool.max_wait = 1
infinispan.client.hotrod.connection_pool.min_idle = 20
infinispan.client.hotrod.connection_pool.min_evictable_idle_time = 300000
infinispan.client.hotrod.connection_pool.max_pending_requests = 20</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hot-rod-authentication-mechanisms_hotrod-client-configuration"><a class="anchor" href="#hot-rod-authentication-mechanisms_hotrod-client-configuration"></a>2.2. Hot Rod authentication mechanisms</h3>
<div class="paragraph">
<p>Infinispan supports the following SASL authentications mechanisms with the Hot
Rod connector:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>PLAIN</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Basic</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. Hot Rod connectors support <code>DIGEST-MD5</code>, <code>DIGEST-SHA</code>, <code>DIGEST-SHA-256</code>, <code>DIGEST-SHA-384</code>, and <code>DIGEST-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>salt</em> values in addition to hashing algorithms and nonce values. Hot Rod connectors support <code>SCRAM-SHA</code>, <code>SCRAM-SHA-256</code>, <code>SCRAM-SHA-384</code>, and <code>SCRAM-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GS2-KRB5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>CLIENT_CERT</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BEARER_TOKEN</code> HTTP mechanism.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="configuring-hotrod-authentication_hotrod-client-configuration"><a class="anchor" href="#configuring-hotrod-authentication_hotrod-client-configuration"></a>2.2.1. Configuring Authentication Mechanisms for Hot Rod Clients</h4>
<div class="paragraph">
<p>Infinispan Server uses different mechanisms to authenticate Hot Rod client connections.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Specify authentication mechanisms with the <code>saslMechanism()</code> method from the <code>AuthenticationConfigurationBuilder</code> class or with the <code>infinispan.client.hotrod.sasl_mechanism</code> property.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">SCRAM</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security()
               .authentication()
                 .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">SCRAM-SHA-512</span><span class="delimiter">&quot;</span></span>)
                 .username(<span class="string"><span class="delimiter">&quot;</span><span class="content">myuser</span><span class="delimiter">&quot;</span></span>)
                 .password(<span class="string"><span class="delimiter">&quot;</span><span class="content">qwer1234!</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">DIGEST</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security()
               .authentication()
                 .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>)
                 .username(<span class="string"><span class="delimiter">&quot;</span><span class="content">myuser</span><span class="delimiter">&quot;</span></span>)
                 .password(<span class="string"><span class="delimiter">&quot;</span><span class="content">qwer1234!</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">PLAIN</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security()
               .authentication()
                 .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAIN</span><span class="delimiter">&quot;</span></span>)
                 .username(<span class="string"><span class="delimiter">&quot;</span><span class="content">myuser</span><span class="delimiter">&quot;</span></span>)
                 .password(<span class="string"><span class="delimiter">&quot;</span><span class="content">qwer1234!</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">OAUTHBEARER</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">String</span> token = <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>; <span class="comment">// Obtain the token from your OAuth2 provider</span>
ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security()
               .authentication()
                 .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">OAUTHBEARER</span><span class="delimiter">&quot;</span></span>)
                 .token(token);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">EXTERNAL</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
   .addServer()
      .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
      .port(<span class="integer">11222</span>)
   .security()
      .ssl()
         <span class="comment">// TrustStore stores trusted CA certificates for the server.</span>
         .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/truststore</span><span class="delimiter">&quot;</span></span>)
         .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststorepassword</span><span class="delimiter">&quot;</span></span>.toCharArray())
         .trustStoreType(<span class="string"><span class="delimiter">&quot;</span><span class="content">PCKS12</span><span class="delimiter">&quot;</span></span>)
         <span class="comment">// KeyStore stores valid client certificates.</span>
         .keyStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/keystore</span><span class="delimiter">&quot;</span></span>)
         .keyStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">keystorepassword</span><span class="delimiter">&quot;</span></span>.toCharArray())
         .keyStoreType(<span class="string"><span class="delimiter">&quot;</span><span class="content">PCKS12</span><span class="delimiter">&quot;</span></span>)
      .authentication()
         .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">EXTERNAL</span><span class="delimiter">&quot;</span></span>);
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">GSSAPI</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">LoginContext</span> lc = <span class="keyword">new</span> <span class="predefined-type">LoginContext</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">GssExample</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> BasicCallbackHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">krb_user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">krb_password</span><span class="delimiter">&quot;</span></span>.toCharArray()));
lc.login();
<span class="predefined-type">Subject</span> clientSubject = lc.getSubject();

ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security()
               .authentication()
                 .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">GSSAPI</span><span class="delimiter">&quot;</span></span>)
                 .clientSubject(clientSubject)
                 .callbackHandler(<span class="keyword">new</span> BasicCallbackHandler());</code></pre>
</div>
</div>
<h5 id="basic_callback_handler" class="discrete">Basic Callback Handler</h5>
<div class="paragraph">
<p>The <code>BasicCallbackHandler</code>, as shown in the GSSAPI example, invokes the following callbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NameCallback</code> and <code>PasswordCallback</code> construct the client subject.</p>
</li>
<li>
<p><code>AuthorizeCallback</code> is called during SASL authentication.</p>
</li>
</ul>
</div>
<h5 id="oauthbearer_with_token_callback_handler" class="discrete">OAUTHBEARER with Token Callback Handler</h5>
<div class="paragraph">
<p>Use a <code>TokenCallbackHandler</code> to refresh OAuth2 tokens before they expire, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">String</span> token = <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>; <span class="comment">// Obtain the token from your OAuth2 provider</span>
TokenCallbackHandler tokenHandler = <span class="keyword">new</span> TokenCallbackHandler(token);
ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security()
               .authentication()
               .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">OAUTHBEARER</span><span class="delimiter">&quot;</span></span>)
               .callbackHandler(tokenHandler);
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Refresh the token</span>
tokenHandler.setToken(<span class="string"><span class="delimiter">&quot;</span><span class="content">newToken</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<h5 id="custom_callbackhandler" class="discrete">Custom <code>CallbackHandler</code></h5>
<div class="paragraph">
<p>Hot Rod clients set up a default <code>CallbackHandler</code> to pass credentials to SASL
mechanisms. In some cases you might need to provide a custom <code>CallbackHandler</code>, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCallbackHandler</span> <span class="directive">implements</span> <span class="predefined-type">CallbackHandler</span> {
   <span class="directive">final</span> <span class="directive">private</span> <span class="predefined-type">String</span> username;
   <span class="directive">final</span> <span class="directive">private</span> <span class="type">char</span><span class="type">[]</span> password;
   <span class="directive">final</span> <span class="directive">private</span> <span class="predefined-type">String</span> realm;

   <span class="directive">public</span> MyCallbackHandler(<span class="predefined-type">String</span> username, <span class="predefined-type">String</span> realm, <span class="type">char</span><span class="type">[]</span> password) {
      <span class="local-variable">this</span>.username = username;
      <span class="local-variable">this</span>.password = password;
      <span class="local-variable">this</span>.realm = realm;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> handle(<span class="predefined-type">Callback</span><span class="type">[]</span> callbacks) <span class="directive">throws</span> <span class="exception">IOException</span>, <span class="exception">UnsupportedCallbackException</span> {
      <span class="keyword">for</span> (<span class="predefined-type">Callback</span> callback : callbacks) {
         <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">NameCallback</span>) {
            <span class="predefined-type">NameCallback</span> nameCallback = (<span class="predefined-type">NameCallback</span>) callback;
            nameCallback.setName(username);
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">PasswordCallback</span>) {
            <span class="predefined-type">PasswordCallback</span> passwordCallback = (<span class="predefined-type">PasswordCallback</span>) callback;
            passwordCallback.setPassword(password);
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">AuthorizeCallback</span>) {
            <span class="predefined-type">AuthorizeCallback</span> authorizeCallback = (<span class="predefined-type">AuthorizeCallback</span>) callback;
            authorizeCallback.setAuthorized(authorizeCallback.getAuthenticationID().equals(
                  authorizeCallback.getAuthorizationID()));
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">RealmCallback</span>) {
            <span class="predefined-type">RealmCallback</span> realmCallback = (<span class="predefined-type">RealmCallback</span>) callback;
            realmCallback.setText(realm);
         } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedCallbackException</span>(callback);
         }
      }
   }
}

ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
               .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
               .port(<span class="integer">11222</span>)
             .security().authentication()
               .serverName(<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span>)
               .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>)
               .callbackHandler(<span class="keyword">new</span> MyCallbackHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">myuser</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">qwer1234!</span><span class="delimiter">&quot;</span></span>.toCharArray()));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A custom <code>CallbackHandler</code> needs to handle callbacks that are specific to the
authentication mechanism that you use. However, it is beyond the scope of this
document to provide examples for each possible callback type.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hotrod_auth_tgt"><a class="anchor" href="#hotrod_auth_tgt"></a>2.2.2. Creating GSSAPI Login Contexts</h4>
<div class="paragraph">
<p>To use the GSSAPI mechanism, you must create a <em>LoginContext</em> so your Hot Rod client can obtain a Ticket Granting Ticket (TGT).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define a login module in a login configuration file.</p>
<div class="listingblock">
<div class="title">gss.conf</div>
<div class="content">
<pre class="CodeRay highlight"><code>GssExample {
    com.sun.security.auth.module.Krb5LoginModule required client=TRUE;
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the IBM JDK:</p>
</div>
<div class="listingblock">
<div class="title">gss-ibm.conf</div>
<div class="content">
<pre class="CodeRay highlight"><code>GssExample {
    com.ibm.security.auth.module.Krb5LoginModule required client=TRUE;
};</code></pre>
</div>
</div>
</li>
<li>
<p>Set the following system properties:</p>
<div class="listingblock">
<div class="content">
<pre>java.security.auth.login.config=gss.conf

java.security.krb5.conf=/etc/krb5.conf</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>krb5.conf</code> provides the location of your KDC. Use the <em>kinit</em> command to
authenticate with Kerberos and verify <code>krb5.conf</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hotrod-encryption_hotrod-client-configuration"><a class="anchor" href="#configuring-hotrod-encryption_hotrod-client-configuration"></a>2.3. Configuring Hot Rod client encryption</h3>
<div class="paragraph">
<p>Infinispan Server can enforce SSL/TLS encryption and present Hot Rod clients with certificates to establish trust and negotiate secure connections.</p>
</div>
<div class="paragraph">
<p>To verify certificates issued to Infinispan Server, Hot Rod clients require either the full certificate chain or a partial chain that starts with the Root CA.
You provide server certificates to Hot Rod clients as trust stores.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively to providing trust stores you can use shared system certificates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a trust store that Hot Rod clients can use to verify Infinispan Server identities.</p>
</li>
<li>
<p>If you configure Infinispan Server to validate or authenticate client certificates, create a keystore as appropriate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the trust store to the client configuration with the <code>trustStoreFileName()</code> and <code>trustStorePassword()</code> methods or corresponding properties.</p>
</li>
<li>
<p>If you configure client certificate authentication, do the following:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the keystore to the client configuration with the <code>keyStoreFileName()</code> and <code>keyStorePassword()</code> methods or corresponding properties.</p>
</li>
<li>
<p>Configure clients to use the <code>EXTERNAL</code> authentication mechanism.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
   .addServer()
      .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
      .port(<span class="integer">11222</span>)
   .security()
      .ssl()
         <span class="comment">// Server SNI hostname.</span>
         .sniHostName(<span class="string"><span class="delimiter">&quot;</span><span class="content">myservername</span><span class="delimiter">&quot;</span></span>)
         <span class="comment">// Keystore that contains the public keys for Infinispan Server.</span>
         <span class="comment">// Clients use the trust store to verify Infinispan Server identities.</span>
         .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/server/truststore</span><span class="delimiter">&quot;</span></span>)
         .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststorepassword</span><span class="delimiter">&quot;</span></span>.toCharArray())
         .trustStoreType(<span class="string"><span class="delimiter">&quot;</span><span class="content">PCKS12</span><span class="delimiter">&quot;</span></span>)
         <span class="comment">// Keystore that contains client certificates.</span>
         <span class="comment">// Clients present these certificates to Infinispan Server.</span>
         .keyStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/client/keystore</span><span class="delimiter">&quot;</span></span>)
         .keyStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">keystorepassword</span><span class="delimiter">&quot;</span></span>.toCharArray())
         .keyStoreType(<span class="string"><span class="delimiter">&quot;</span><span class="content">PCKS12</span><span class="delimiter">&quot;</span></span>)
      .authentication()
         <span class="comment">// Clients must use the EXTERNAL mechanism for certificate authentication.</span>
         .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">EXTERNAL</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.server_list = 127.0.0.1:11222
infinispan.client.hotrod.use_ssl = true
infinispan.client.hotrod.sni_host_name = myservername
# Keystore that contains the public keys for Infinispan Server.
# Clients use the trust store to verify Infinispan Server identities.
infinispan.client.hotrod.trust_store_file_name = server_truststore.pkcs12
infinispan.client.hotrod.trust_store_password = changeme
infinispan.client.hotrod.trust_store_type = PCKS12
# Keystore that contains client certificates.
# Clients present these certificates to Infinispan Server.
infinispan.client.hotrod.key_store_file_name = client_keystore.pkcs12
infinispan.client.hotrod.key_store_password = changeme
infinispan.client.hotrod.key_store_type = PCKS12
# Clients must use the EXTERNAL mechanism for certificate authentication.
infinispan.client.hotrod.sasl_mechanism = EXTERNAL</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Add a client trust store to the <code>$ISPN_HOME/server/conf</code> directory and configure Infinispan Server to use it, if necessary.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#endpoint-encryption">Encrypting Infinispan Server Connections</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/SslConfigurationBuilder.html">SslConfigurationBuilder</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod client configuration properties</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-shared-system-certificates">Using Shared System Certificates</a> (Red Hat Enterprise Linux 7 Security Guide)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-hotrod-client-statistics_hotrod-client-configuration"><a class="anchor" href="#enabling-hotrod-client-statistics_hotrod-client-configuration"></a>2.4. Enabling Hot Rod client statistics</h3>
<div class="paragraph">
<p>Hot Rod Java clients can provide statistics that include remote cache and near-cache hits and misses as well as connection pool usage.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Hot Rod Java client configuration for editing.</p>
</li>
<li>
<p>Set <code>true</code> as the value for the <code>statistics</code> property or invoke the <code>statistics().enable()</code> methods.</p>
</li>
<li>
<p>Export JMX MBeans for your Hot Rod client with the <code>jmx</code> and <code>jmx_domain</code> properties or invoke the <code>jmxEnable()</code> and <code>jmxDomain()</code> methods.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="hot_rod_java_client_statistics" class="discrete">Hot Rod Java client statistics</h4>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.statistics().enable()
         .jmxEnable()
         .jmxDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.domain.org</span><span class="delimiter">&quot;</span></span>)
       .addServer()
         .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
         .port(<span class="integer">11222</span>);
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">infinispan.client.hotrod.statistics = <span class="predefined-constant">true</span>
infinispan.client.hotrod.jmx = <span class="predefined-constant">true</span>
infinispan.client.hotrod.jmx_domain = my.domain.org</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="near-caches-hotrod-client-configuration"><a class="anchor" href="#near-caches-hotrod-client-configuration"></a>2.5. Near Caches</h3>
<div class="paragraph">
<p>Near caches are local to Hot Rod clients and store recently used data so that every read operation does not need to traverse the network, which significantly increases performance.</p>
</div>
<div class="paragraph">
<p>Near caches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are populated with read operations, calls to <code>get()</code> or <code>getVersioned()</code> methods.<br>
In the following example the <code>put()</code> call does not populate the near cache and only has the effect of invalidating the entry if it already exists:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">k1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>);
cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">k1</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>Register a client listener to invalidate entries when they are updated or removed in remote caches on Infinispan Server.<br>
If entries are requested after they are invalidated, clients must retrieve them from the remote caches again.</p>
</li>
<li>
<p>Are cleared when clients fail over to different servers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Bounded near caches</div>
<p>You should always use bounded near caches by specifying the maximum number of entries they can contain.
When near caches reach the maximum number of entries, eviction automatically takes place to remove older entries.
This means you do not need to manually keep the cache size within the boundaries of the client JVM.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use maximum idle expiration with near caches because near-cache reads do not propagate the last access time for entries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Bloom filters</div>
<p>Bloom filters optimize performance for write operations by reducing the total number of invalidation messages.</p>
</div>
<div class="paragraph">
<p>Bloom filters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reside on Infinispan Server and keep track of the entries that the client has requested.</p>
</li>
<li>
<p>Require a connection pool configuration that has a maximum of one active connection per server and uses the <code>WAIT</code> exhausted action.</p>
</li>
<li>
<p>Cannot be used with unbounded near caches.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-near-caching-hotrod-client-configuration"><a class="anchor" href="#configuring-near-caching-hotrod-client-configuration"></a>2.5.1. Configuring Near Caches</h4>
<div class="paragraph">
<p>Configure Hot Rod Java clients with near caches to store recently used data locally in the client JVM.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Hot Rod Java client configuration.</p>
</li>
<li>
<p>Configure each cache to perform near caching with the <code>nearCacheMode(NearCacheMode.INVALIDATED)</code> method.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan provides global near cache configuration properties.
However, those properties are deprecated and you should not use them but configure near caching on a per-cache basis instead.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Specify the maximum number of entries that the near cache can hold before eviction occurs with the <code>nearCacheMaxEntries()</code> method.</p>
</li>
<li>
<p>Enable bloom filters for near caches with the <code>nearCacheUseBloomFilter()</code> method.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.NearCacheMode</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.ExhaustedAction</span>;

ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServer()
    .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
    .port(ConfigurationProperties.DEFAULT_HOTROD_PORT)
  .security().authentication()
    .username(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>)
    .password(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)
    .realm(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>)
    .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">SCRAM-SHA-512</span><span class="delimiter">&quot;</span></span>)
  <span class="comment">// Configure the connection pool for bloom filters.</span>
  .connectionPool()
    .maxActive(<span class="integer">1</span>)
    .exhaustedAction(ExhaustedAction.WAIT);
<span class="comment">// Configure near caching for specific caches</span>
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>)
    .nearCacheMode(NearCacheMode.INVALIDATED)
    .nearCacheMaxEntries(<span class="integer">100</span>)
    .nearCacheUseBloomFilter(<span class="predefined-constant">false</span>);
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">authors</span><span class="delimiter">&quot;</span></span>)
    .nearCacheMode(NearCacheMode.INVALIDATED)
    .nearCacheMaxEntries(<span class="integer">200</span>)
    .nearCacheUseBloomFilter(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/NearCacheConfiguration.html">org.infinispan.client.hotrod.configuration.NearCacheConfiguration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/ExhaustedAction.html">org.infinispan.client.hotrod.configuration.ExhaustedAction</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="forcing-return-values_hotrod-client-configuration"><a class="anchor" href="#forcing-return-values_hotrod-client-configuration"></a>2.6. Forcing Return Values</h3>
<div class="paragraph">
<p>To avoid sending data unnecessarily, write operations on remote caches return <code>null</code> instead of previous values.</p>
</div>
<div class="paragraph">
<p>For example, the following method calls do not return previous values for keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">V remove(<span class="predefined-type">Object</span> key);
V put(K key, V value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can, however, change the default behavior so your invocations return previous values for keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure Hot Rod clients so method calls return previous values for keys in one of the following ways:</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">FORCE_RETURN_VALUE flag</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">cache.withFlags(Flag.FORCE_RETURN_VALUE).put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">newValue</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Per-cache</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
<span class="comment">// Return previous values for keys for invocations for a specific cache.</span>
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span>)
       .forceReturnValues(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code># Use the &quot;*&quot; wildcard in the cache name to return previous values
# for all caches that start with the &quot;somecaches&quot; string.

infinispan.client.hotrod.cache.somecaches*.force_return_values = true</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/Flag.html#FORCE_RETURN_VALUE">org.infinispan.client.hotrod.Flag</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-hotrod_hotrod-client-configuration"><a class="anchor" href="#creating-caches-hotrod_hotrod-client-configuration"></a>2.7. Creating remote caches from Hot Rod clients</h3>
<div class="paragraph">
<p>Use the Infinispan Hot Rod API to create remote caches on Infinispan Server from Java, C++, .NET/C#, JS clients and more.</p>
</div>
<div class="paragraph">
<p>This procedure shows you how to use Hot Rod Java clients that create remote caches on first access.
You can find code examples for other Hot Rod clients in the <a href="https://infinispan.org/tutorials/simple/simple_tutorials.html">Infinispan Tutorials</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke the <code>remoteCache()</code> method as part of your the <code>ConfigurationBuilder</code>.</p>
</li>
<li>
<p>Set the <code>configuration</code> or <code>configuration_uri</code> properties in the <code>hotrod-client.properties</code> file on your classpath.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">File</span> file = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/infinispan.xml</span><span class="delimiter">&quot;</span></span>)
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">another-cache</span><span class="delimiter">&quot;</span></span>)
       .configuration(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;distributed-cache name=</span><span class="char">\&quot;</span><span class="content">another-cache</span><span class="char">\&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span>);
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.other.cache</span><span class="delimiter">&quot;</span></span>)
       .configurationURI(file.toURI());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.cache.another-cache.configuration=&lt;distributed-cache name=\&quot;another-cache\&quot;/&gt;
infinispan.client.hotrod.cache.[my.other.cache].configuration_uri=file:///path/to/infinispan.xml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the name of your remote cache contains the <code>.</code> character, you must enclose it in square brackets when using <code>hotrod-client.properties</code> files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod Client Configuration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/RemoteCacheConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.RemoteCacheConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hotrod-client-api_hotrod-java-client"><a class="anchor" href="#hotrod-client-api_hotrod-java-client"></a>3. Hot Rod Client API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Hot Rod client API provides interfaces for creating caches
remotely, manipulating data, monitoring the topology of clustered caches, and
more.</p>
</div>
<div class="sect2">
<h3 id="remotecache_api"><a class="anchor" href="#remotecache_api"></a>3.1. RemoteCache API</h3>
<div class="paragraph">
<p>The collection methods <code>keySet</code>, <code>entrySet</code> and <code>values</code> are backed by the
remote cache. That is that every method is called back into the <code>RemoteCache</code>.
This is useful as it allows for the various keys, entries or values to be
retrieved lazily, and not requiring them all be stored in the client memory at
once if the user does not want.</p>
</div>
<div class="paragraph">
<p>These collections adhere to the <code>Map</code> specification being that <code>add</code> and
<code>addAll</code> are not supported but all other methods are supported.</p>
</div>
<div class="paragraph">
<p>One thing to note is the <code>Iterator.remove</code> and <code>Set.remove</code> or
<code>Collection.remove</code> methods require more than 1 round trip to the server to
operate. You can check out the
<a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a>
Javadoc to see more details about these and the other methods.</p>
</div>
<div class="paragraph">
<div class="title">Iterator Usage</div>
<p>The iterator method of these collections uses <code>retrieveEntries</code> internally,
which is described below. If you notice <code>retrieveEntries</code> takes an argument for
the batch size. There is no way to provide this to the iterator. As such the
batch size can be configured via system property
<code>infinispan.client.hotrod.batch_size</code> or through the <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html#batchSize-int-">ConfigurationBuilder</a> when configuring the
<code>RemoteCacheManager</code>.</p>
</div>
<div class="paragraph">
<p>Also the <code>retrieveEntries</code> iterator returned is <code>Closeable</code> as such the
iterators from <code>keySet</code>, <code>entrySet</code> and <code>values</code> return an <code>AutoCloseable</code>
variant. Therefore you should always close these `Iterator`s when you are done
with them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (CloseableIterator&lt;<span class="predefined-type">Map</span>.Entry&lt;K, V&gt;&gt; iterator = remoteCache.entrySet().iterator()) {

      }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>What if I want a deep copy and not a backing collection?</strong></p>
</div>
<div class="paragraph">
<p>Previous version of <code>RemoteCache</code> allowed for the retrieval of a deep copy
of the <code>keySet</code>. This is still possible with the new backing map, you just
have to copy the contents yourself. Also you can do this with <code>entrySet</code> and
<code>values</code>, which we didn&#8217;t support before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span>&lt;K&gt; keysCopy = remoteCache.keySet().stream().collect(Collectors.toSet());</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="hotrod_unsupported_methods"><a class="anchor" href="#hotrod_unsupported_methods"></a>3.1.1. Unsupported Methods</h4>
<div class="paragraph">
<p>The Infinispan <code>RemoteCache</code> API does not support all methods available in the
<code>Cache</code> API and throws <code>UnsupportedOperationException</code> when unsupported methods
are invoked.</p>
</div>
<div class="paragraph">
<p>Most of these methods do not make sense on the remote cache (e.g. listener management operations), or correspond to methods that are not supported by local cache as well (e.g. containsValue).</p>
</div>
<div class="paragraph">
<p>Certain atomic operations inherited from <code>ConcurrentMap</code> are also not supported
with the <code>RemoteCache</code> API, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> remove(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value);
<span class="type">boolean</span> replace(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value);
<span class="type">boolean</span> replace(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> oldValue, <span class="predefined-type">Object</span> value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, <code>RemoteCache</code> offers alternative versioned methods for these atomic
operations that send version identifiers over the network instead of whole
value objects.</p>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/Cache.html">Cache</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html">UnsupportedOperationException</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hr_remote_iterator"><a class="anchor" href="#hr_remote_iterator"></a>3.2. Remote Iterator API</h3>
<div class="paragraph">
<p>Infinispan provides a remote iterator API to retrieve entries where memory
resources are constrained or if you plan to do server-side filtering or
conversion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Retrieve all entries in batches of 1000</span>
<span class="type">int</span> batchSize = <span class="integer">1000</span>;
<span class="keyword">try</span> (CloseableIterator&lt;Entry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;&gt; iterator = remoteCache.retrieveEntries(<span class="predefined-constant">null</span>, batchSize)) {
     <span class="keyword">while</span>(iterator.hasNext()) {
        <span class="comment">// Do something</span>
     }
}

<span class="comment">// Filter by segment</span>
<span class="predefined-type">Set</span>&lt;<span class="predefined-type">Integer</span>&gt; segments = ...
try (CloseableIterator&lt;Entry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;&gt; iterator = remoteCache.retrieveEntries(<span class="predefined-constant">null</span>, segments, batchSize)) {
     <span class="keyword">while</span>(iterator.hasNext()) {
        <span class="comment">// Do something</span>
     }
}

<span class="comment">// Filter by custom filter</span>
<span class="keyword">try</span> (CloseableIterator&lt;Entry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;&gt; iterator = remoteCache.retrieveEntries(<span class="string"><span class="delimiter">&quot;</span><span class="content">myFilterConverterFactory</span><span class="delimiter">&quot;</span></span>, segments, batchSize)) {
     <span class="keyword">while</span>(iterator.hasNext()) {
        <span class="comment">// Do something</span>
     }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="custom_filters"><a class="anchor" href="#custom_filters"></a>3.2.1. Deploying Custom Filters to Infinispan Server</h4>
<div class="paragraph">
<p>Deploy custom filters to Infinispan server instances.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a factory that extends <code>KeyValueFilterConverterFactory</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.Serializable</span>;

<span class="keyword">import</span> <span class="include">org.infinispan.filter.AbstractKeyValueFilterConverter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.KeyValueFilterConverter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.KeyValueFilterConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.NamedFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.metadata.Metadata</span>;

<span class="comment">//@NamedFactory annotation defines the factory name</span>
<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">myFilterConverterFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyKeyValueFilterConverterFactory</span> <span class="directive">implements</span> KeyValueFilterConverterFactory {

   <span class="annotation">@Override</span>
   <span class="directive">public</span> KeyValueFilterConverter&lt;<span class="predefined-type">String</span>, SampleEntity1, SampleEntity2&gt; getFilterConverter() {
      <span class="keyword">return</span> <span class="keyword">new</span> MyKeyValueFilterConverter();
   }
   <span class="comment">// Filter implementation. Should be serializable or externalizable for DIST caches</span>
   <span class="directive">static</span> <span class="type">class</span> <span class="class">MyKeyValueFilterConverter</span> <span class="directive">extends</span> AbstractKeyValueFilterConverter&lt;<span class="predefined-type">String</span>, SampleEntity1, SampleEntity2&gt; <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
      <span class="annotation">@Override</span>
      <span class="directive">public</span> SampleEntity2 filterAndConvert(<span class="predefined-type">String</span> key, SampleEntity1 entity, Metadata metadata) {
         <span class="comment">// returning null will case the entry to be filtered out</span>
         <span class="comment">// return SampleEntity2 will convert from the cache type SampleEntity1</span>
      }

      <span class="annotation">@Override</span>
      <span class="directive">public</span> MediaType format() {
         <span class="comment">// returns the MediaType that data should be presented to this converter.</span>
         <span class="comment">// When omitted, the server will use &quot;application/x-java-object&quot;.</span>
         <span class="comment">// Returning null will cause the filter/converter to be done in the storage format.</span>
      }
   }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a JAR that contains a
<code>META-INF/services/org.infinispan.filter.KeyValueFilterConverterFactory</code> file.
This file should include the fully qualified class name of the filter factory
class implementation.</p>
<div class="paragraph">
<p>If the filter uses custom key/value classes, you must include them in your JAR file so that the filter can correctly unmarshall key and/or value instances.</p>
</div>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/filter/KeyValueFilterConverterFactory.html">KeyValueFilterConverterFactory</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hr_versioned_api"><a class="anchor" href="#hr_versioned_api"></a>3.3. MetadataValue API</h3>
<div class="paragraph">
<p>Use the <code>MetadataValue</code> interface for versioned operations.</p>
</div>
<div class="paragraph">
<p>The following example shows a remove operation that occurs only if the version
of the value for the entry is unchanged:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager();
      RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; remoteCache = remoteCacheManager.getCache();

      remoteCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
      VersionedValue valueBinary = remoteCache.getWithMetadata(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);

      <span class="keyword">assert</span> remoteCache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, valueBinary.getVersion());
      <span class="keyword">assert</span> !remoteCache.containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/MetadataValue.html">org.infinispan.client.hotrod.MetadataValue</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hotrod_streaming"><a class="anchor" href="#hotrod_streaming"></a>3.4. Streaming API</h3>
<div class="paragraph">
<p>Infinispan provides a Streaming API that implements methods that return
instances of <code>InputStream</code> and <code>OutputStream</code> so you can stream large objects
between Hot Rod clients and Infinispan servers.</p>
</div>
<div class="paragraph">
<p>Consider the following example of a large object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">StreamingRemoteCache&lt;<span class="predefined-type">String</span>&gt; streamingCache = remoteCache.streaming();
<span class="predefined-type">OutputStream</span> os = streamingCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">a_large_object</span><span class="delimiter">&quot;</span></span>);
os.write(...);
os.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could read the object through streaming as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">StreamingRemoteCache&lt;<span class="predefined-type">String</span>&gt; streamingCache = remoteCache.streaming();
<span class="predefined-type">InputStream</span> is = streamingCache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">a_large_object</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">for</span>(<span class="type">int</span> b = is.read(); b &gt;= <span class="integer">0</span>; b = is.read()) {
   <span class="comment">// iterate</span>
}
is.close();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Streaming API does <strong>not</strong> marshall values, which means you cannot access the
same entries using both the Streaming and Non-Streaming API at the same time.
You can, however, implement a custom marshaller to handle this case.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>InputStream</code> returned by the <code>RemoteStreamingCache.get(K key)</code> method
implements the <code>VersionedMetadata</code> interface, so you can retrieve version and
expiration information as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">StreamingRemoteCache&lt;<span class="predefined-type">String</span>&gt; streamingCache = remoteCache.streaming();
<span class="predefined-type">InputStream</span> is = streamingCache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">a_large_object</span><span class="delimiter">&quot;</span></span>);
<span class="type">long</span> version = ((VersionedMetadata) is).getVersion();
<span class="keyword">for</span>(<span class="type">int</span> b = is.read(); b &gt;= <span class="integer">0</span>; b = is.read()) {
   <span class="comment">// iterate</span>
}
is.close();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Conditional write methods (<code>putIfAbsent()</code>, <code>replace()</code>) perform the actual
condition check after the value is completely sent to the server. In other
words, when the <code>close()</code> method is invoked on the <code>OutputStream</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/StreamingRemoteCache.html">org.iinfinispan.client.hotrod.StreamingRemoteCache</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="remotecache_countermanager-hotrod-client-api"><a class="anchor" href="#remotecache_countermanager-hotrod-client-api"></a>3.5. Counter API</h3>
<div class="paragraph">
<p>The <code>CounterManager</code> interface is the entry point to define, retrieve and remove counters.</p>
</div>
<div class="paragraph">
<p>Hot Rod clients can retrieve the <code>CounterManager</code> interface as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create or obtain your RemoteCacheManager</span>
RemoteCacheManager manager = ...;

<span class="comment">// retrieve the CounterManager</span>
CounterManager counterManager = RemoteCounterManagerFactory.asCounterManager(manager);</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../developing/developing.html#clustered_counters">Clustered Counters</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating_event_listeners"><a class="anchor" href="#creating_event_listeners"></a>3.6. Creating Event Listeners</h3>
<div class="paragraph">
<p>Java Hot Rod clients can register listeners to receive cache-entry level events.
Cache entry created, modified and removed events are supported.</p>
</div>
<div class="paragraph">
<p>Creating a client listener is very similar to embedded listeners, except that
different annotations and event classes are used. Here&#8217;s an example of a
client listener that prints out each event received:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.annotation</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.event</span>.*;

<span class="annotation">@ClientListener</span>(converterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-converter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EventPrintListener</span> {

   <span class="annotation">@ClientCacheEntryCreated</span>
   <span class="directive">public</span> <span class="type">void</span> handleCreatedEvent(ClientCacheEntryCreatedEvent e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

   <span class="annotation">@ClientCacheEntryModified</span>
   <span class="directive">public</span> <span class="type">void</span> handleModifiedEvent(ClientCacheEntryModifiedEvent e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

   <span class="annotation">@ClientCacheEntryRemoved</span>
   <span class="directive">public</span> <span class="type">void</span> handleRemovedEvent(ClientCacheEntryRemovedEvent e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClientCacheEntryCreatedEvent</code> and <code>ClientCacheEntryModifiedEvent</code> instances
provide information on the affected key, and the version of the entry. This
version can be used to invoke conditional operations on the server, such as
<code>replaceWithVersion</code> or <code>removeWithVersion</code>.</p>
</div>
<div class="paragraph">
<p><code>ClientCacheEntryRemovedEvent</code> events are only sent when the remove operation
succeeds. In other words, if a remove operation is invoked but no entry is
found or no entry should be removed, no event is generated. Users interested
in removed events, even when no entry was removed, can develop event
customization logic to generate such events. More information can be found
in the <a href="#customizing_events">customizing client events section</a>.</p>
</div>
<div class="paragraph">
<p>All <code>ClientCacheEntryCreatedEvent</code>, <code>ClientCacheEntryModifiedEvent</code> and
<code>ClientCacheEntryRemovedEvent</code> event instances also provide a <code>boolean isCommandRetried()</code>
method that will return true if the write command that caused this had to be retried
again due to a topology change.  This could be a sign that this event
has been duplicated or another event was dropped and replaced
(eg: ClientCacheEntryModifiedEvent replaced ClientCacheEntryCreatedEvent).</p>
</div>
<div class="paragraph">
<p>Once the client listener implementation has been created, it needs to be
registered with the server. To do so, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener());</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="removing_event_listeners"><a class="anchor" href="#removing_event_listeners"></a>3.6.1. Removing Event Listeners</h4>
<div class="paragraph">
<p>When an client event listener is not needed any more, it can be removed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EventPrintListener listener = ...
cache.removeClientListener(listener);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="filtering_events"><a class="anchor" href="#filtering_events"></a>3.6.2. Filtering Events</h4>
<div class="paragraph">
<p>In order to avoid inundating clients with events, users can provide filtering
functionality to limit the number of events fired by the server for a
particular client listener. To enable filtering, a cache event filter factory
needs to be created that produces filter instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.NamedFactory</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-filter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">StaticCacheEventFilterFactory</span> <span class="directive">implements</span> CacheEventFilterFactory {

   <span class="annotation">@Override</span>
   <span class="directive">public</span> StaticCacheEventFilter getFilter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> StaticCacheEventFilter();
   }
}


<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// needed when running in a cluster</span>
<span class="type">class</span> <span class="class">StaticCacheEventFilter</span> <span class="directive">implements</span> CacheEventFilter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;, <span class="predefined-type">Serializable</span> {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> accept(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="keyword">if</span> (key.equals(<span class="integer">1</span>)) <span class="comment">// static key</span>
         <span class="keyword">return</span> <span class="predefined-constant">true</span>;

      <span class="keyword">return</span> <span class="predefined-constant">false</span>;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cache event filter factory instance defined above creates filter instances
which statically filter out all entries except the one whose key is <code>1</code>.</p>
</div>
<div class="paragraph">
<p>To be able to register a listener with this cache event filter factory,
the factory has to be given a unique name, and the Hot Rod server needs to be
plugged with the name and the cache event filter factory instance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file that contains the filter implementation.</p>
<div class="paragraph">
<p>If the cache uses custom key/value classes, these must be
included in the JAR so that the callbacks can be executed with the correctly
unmarshalled key and/or value instances. If the client listener has <code>useRawData</code>
enabled, this is not necessary since the callback key/value instances will be
provided in binary format.</p>
</div>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</code> file
within the JAR file and within it, write the fully qualified class name of the
filter class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
<li>
<p>Link the client listener with this cache event filter factory by adding the
factory name to the <code>@ClientListener</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientListener</span>(filterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-filter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EventPrintListener</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Register the listener with the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener());</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also register dynamic filter instances that filter based on parameters
provided when the listener is registered are also possible. Filters use the
parameters received by the filter factories to enable this option, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventFilter</span>;

<span class="type">class</span> <span class="class">DynamicCacheEventFilterFactory</span> <span class="directive">implements</span> CacheEventFilterFactory {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> CacheEventFilter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; getFilter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> DynamicCacheEventFilter(params);
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// needed when running in a cluster</span>
<span class="type">class</span> <span class="class">DynamicCacheEventFilter</span> <span class="directive">implements</span> CacheEventFilter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params;

   DynamicCacheEventFilter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="local-variable">this</span>.params = params;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> accept(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="keyword">if</span> (key.equals(params[<span class="integer">0</span>])) <span class="comment">// dynamic key</span>
         <span class="keyword">return</span> <span class="predefined-constant">true</span>;

      <span class="keyword">return</span> <span class="predefined-constant">false</span>;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic parameters required to do the filtering are provided when the
listener is registered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener(), <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="integer">1</span>}, <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Filter instances have to marshallable when they are deployed in a
cluster so that the filtering can happen right where the event is generated,
even if the even is generated in a different node to where the listener is
registered. To make them marshallable, either make them extend <code>Serializable</code>,
<code>Externalizable</code>, or provide a custom <code>Externalizer</code> for them.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="skipping_notifications"><a class="anchor" href="#skipping_notifications"></a>3.6.3. Skipping Notifications</h4>
<div class="paragraph">
<p>Include the <code>SKIP_LISTENER_NOTIFICATION</code> flag when calling remote API methods to
perform operations without getting event notifications from the server.
For example, to prevent listener notifications when creating or modifying values,
set the flag as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remoteCache.withFlags(Flag.SKIP_LISTENER_NOTIFICATION).put(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customizing_events"><a class="anchor" href="#customizing_events"></a>3.6.4. Customizing Events</h4>
<div class="paragraph">
<p>The events generated by default contain just enough information to make the
event relevant but they avoid cramming too much information in order to reduce
the cost of sending them. Optionally, the information shipped in the events
can be customised in order to contain more information, such as values, or to
contain even less information. This customization is done with <code>CacheEventConverter</code>
instances generated by a <code>CacheEventConverterFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.NamedFactory</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-converter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">StaticConverterFactory</span> <span class="directive">implements</span> CacheEventConverterFactory {
   <span class="directive">final</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; staticConverter = <span class="keyword">new</span> StaticCacheEventConverter();
   <span class="directive">public</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; getConverter(<span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> staticConverter;
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// needed when running in a cluster</span>
<span class="type">class</span> <span class="class">StaticCacheEventConverter</span> <span class="directive">implements</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">public</span> CustomEvent convert(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata, <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, newValue);
   }
}

<span class="comment">// Needs to be Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// regardless of cluster or local caches</span>
<span class="directive">static</span> <span class="type">class</span> <span class="class">CustomEvent</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Integer</span> key;
   <span class="directive">final</span> <span class="predefined-type">String</span> value;
   CustomEvent(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> value) {
      <span class="local-variable">this</span>.key = key;
      <span class="local-variable">this</span>.value = value;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the converter generates a new custom event which
includes the value as well as the key in the event. This will result in bigger
event payloads compared with default events, but if combined with filtering,
it can reduce its network bandwidth cost.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The target type of the converter must be either <code>Serializable</code> or
<code>Externalizable</code>. In this particular case of converters, providing an
Externalizer will not work by default since the default Hot Rod client
marshaller does not support them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Handling custom events requires a slightly different client listener
implementation to the one demonstrated previously. To be more precise, it
needs to handle <code>ClientCacheEntryCustomEvent</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.annotation</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.event</span>.*;

<span class="annotation">@ClientListener</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomEventPrintListener</span> {

   <span class="annotation">@ClientCacheEntryCreated</span>
   <span class="annotation">@ClientCacheEntryModified</span>
   <span class="annotation">@ClientCacheEntryRemoved</span>
   <span class="directive">public</span> <span class="type">void</span> handleCustomEvent(ClientCacheEntryCustomEvent&lt;CustomEvent&gt; e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ClientCacheEntryCustomEvent</code> received in the callback exposes the custom
event via <code>getEventData</code> method, and the <code>getType</code> method provides information
on whether the event generated was as a result of cache entry creation,
modification or removal.</p>
</div>
<div class="paragraph">
<p>Similar to filtering, to be able to register a listener with this converter factory,
the factory has to be given a unique name, and the Hot Rod server needs to be
plugged with the name and the cache event converter factory instance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file with the converter implementation within it.</p>
<div class="paragraph">
<p>If the cache uses custom key/value classes, these must be
included in the JAR so that the callbacks can be executed with the correctly
unmarshalled key and/or value instances. If the client listener has <code>useRawData</code>
enabled, this is not necessary since the callback key/value instances will be
provided in binary format.</p>
</div>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</code> file
within the JAR file and within it, write the fully qualified class name of the
converter class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
<li>
<p>Link the client listener with this converter factory by adding the factory
name to the <code>@ClientListener</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientListener</span>(converterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-converter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomEventPrintListener</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Register the listener with the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> CustomEventPrintListener());</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dynamic converter instances that convert based on parameters provided when the
listener is registered are also possible. Converters use the parameters received
by the converter factories to enable this option. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverter</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-converter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">DynamicCacheEventConverterFactory</span> <span class="directive">implements</span> CacheEventConverterFactory {
   <span class="directive">public</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; getConverter(<span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> DynamicCacheEventConverter(params);
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers needed when running in a cluster</span>
<span class="type">class</span> <span class="class">DynamicCacheEventConverter</span> <span class="directive">implements</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params;

   DynamicCacheEventConverter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="local-variable">this</span>.params = params;
   }

   <span class="directive">public</span> CustomEvent convert(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="comment">// If the key matches a key given via parameter, only send the key information</span>
      <span class="keyword">if</span> (params[<span class="integer">0</span>].equals(key))
         <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, <span class="predefined-constant">null</span>);

      <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, newValue);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic parameters required to do the conversion are provided when the
listener is registered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener(), <span class="predefined-constant">null</span>, <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="integer">1</span>});</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Converter instances have to marshallable when they are deployed in a
cluster, so that the conversion can happen right where the event is generated,
even if the event is generated in a different node to where the listener is
registered. To make them marshallable, either make them extend <code>Serializable</code>,
<code>Externalizable</code>, or provide a custom <code>Externalizer</code> for them.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="filter_and_custom_events"><a class="anchor" href="#filter_and_custom_events"></a>3.6.5. Filter and Custom Events</h4>
<div class="paragraph">
<p>If you want to do both event filtering and customization, it&#8217;s easier to
implement <code>org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverter</code>
which allows both filter and customization to happen in a single step.
For convenience, it&#8217;s recommended to extend
<code>org.infinispan.notifications.cachelistener.filter.AbstractCacheEventFilterConverter</code>
instead of implementing <code>org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverter</code>
directly. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverter</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-filter-converter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">DynamicCacheEventFilterConverterFactory</span> <span class="directive">implements</span> CacheEventFilterConverterFactory {
   <span class="directive">public</span> CacheEventFilterConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; getFilterConverter(<span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> DynamicCacheEventFilterConverter(params);
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers needed when running in a cluster</span>
<span class="comment">//</span>
<span class="type">class</span> <span class="class">DynamicCacheEventFilterConverter</span> <span class="directive">extends</span> AbstractCacheEventFilterConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params;

   DynamicCacheEventFilterConverter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="local-variable">this</span>.params = params;
   }

   <span class="directive">public</span> CustomEvent filterAndConvert(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="comment">// If the key matches a key given via parameter, only send the key information</span>
      <span class="keyword">if</span> (params[<span class="integer">0</span>].equals(key))
         <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, <span class="predefined-constant">null</span>);

      <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, newValue);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to filters and converters, to be able to register a listener with this
combined filter/converter factory, the factory has to be given a unique name via the
<code>@NamedFactory</code> annotation, and the Hot Rod server needs to be plugged with the
name and the cache event converter factory instance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file with the converter implementation within it.</p>
<div class="paragraph">
<p>If the cache uses custom key/value classes, these must be included in the JAR
so that the callbacks can be executed with the correctly unmarshalled key
and/or value instances. If the client listener has <code>useRawData</code> enabled, this
is not necessary since the callback key/value instances will be provided in
binary format.</p>
</div>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverterFactory</code> file
within the JAR file and within it, write the fully qualified class name of the
converter class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From a client perspective, to be able to use the combined filter and
converter class, the client listener must define the same filter factory and
converter factory names, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientListener</span>(filterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-filter-converter</span><span class="delimiter">&quot;</span></span>, converterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-filter-converter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomEventPrintListener</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dynamic parameters required in the example above are provided when the
listener is registered via either filter or converter parameters. If filter
parameters are non-empty, those are used, otherwise, the converter parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> CustomEventPrintListener(), <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="integer">1</span>}, <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="event_marshalling"><a class="anchor" href="#event_marshalling"></a>3.6.6. Event Marshalling</h4>
<div class="paragraph">
<p>Hot Rod servers can store data in different formats, but in spite of that,
Java Hot Rod client users can still develop <code>CacheEventConverter</code> or <code>CacheEventFilter</code>
instances that work on typed objects. By default, filters and converter will use data as POJO
(application/x-java-object) but it is possible to override the desired format by overriding the
method <code>format()</code> from the filter/converter. If the format returns <code>null</code>, the filter/converter will receive
data as it&#8217;s stored.</p>
</div>
<div class="paragraph">
<p>Hot Rod Java clients can be configured to use different <code>org.infinispan.commons.marshall.Marshaller</code> instances.
If doing this and deploying <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances,
to be able to present filters/converter with Java Objects rather than marshalled content,
the server needs to be able to convert between objects and the binary format produced
by the marshaller.</p>
</div>
<div class="paragraph">
<p>To deploy a Marshaller instance server-side, follow a similar method to the one
used to deploy <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JAR file with the converter implementation within it.</p>
</li>
<li>
<p>Create a <code>META-INF/services/org.infinispan.commons.marshall.Marshaller</code> file
within the JAR file and within it, write the fully qualified class name of the
marshaller class implementation.</p>
</li>
<li>
<p>Add the JAR file to the <code>server/lib</code> directory of your Infinispan server
installation directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the Marshaller could be deployed in either a separate jar, or in the
same jar as the <code>CacheEventConverter</code> and/or <code>CacheEventFilter</code> instances.</p>
</div>
<div class="sect4">
<h5 id="protostream_deployment"><a class="anchor" href="#protostream_deployment"></a>Deploying Protostream Marshallers</h5>
<div class="paragraph">
<p>If a cache stores Protobuf content, as it happens when using ProtoStream marshaller in the Hot Rod client,
it&#8217;s not necessary to deploy a custom marshaller since the format is already support by the server: there are
transcoders from Protobuf format to most common formats like JSON and POJO.</p>
</div>
<div class="paragraph">
<p>When using filters/converters with those caches, and it&#8217;s desirable to use filter/converters with Java Objects rather
binary Protobuf data, it&#8217;s necessary to configure the extra ProtoStream marshallers so that the server can unmarshall
the data before filtering/converting. To do so, you must configure the required <code>SerializationContextInitializer(s)</code>
as part of the Infinispan server configuration.</p>
</div>
<div class="paragraph">
<p>See <a href="../encoding/encoding.html">Cache Encoding and Marshalling</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listener_state_handling"><a class="anchor" href="#listener_state_handling"></a>3.6.7. Listener State Handling</h4>
<div class="paragraph">
<p>Client listener annotation has an optional <code>includeCurrentState</code> attribute
that specifies whether state will be sent to the client when the listener is
added or when there&#8217;s a failover of the listener.</p>
</div>
<div class="paragraph">
<p>By default, <code>includeCurrentState</code> is false, but if set to true and a client
listener is added in a cache already containing data, the server iterates over
the cache contents and sends an event for each entry to the client as a
<code>ClientCacheEntryCreated</code> (or custom event if configured). This allows clients
to build some local data structures based on the existing content. Once the
content has been iterated over, events are received as normal, as cache
updates are received.  If the cache is clustered, the entire cluster wide
contents are iterated over.</p>
</div>
</div>
<div class="sect3">
<h4 id="listener_failure_handling"><a class="anchor" href="#listener_failure_handling"></a>3.6.8. Listener Failure Handling</h4>
<div class="paragraph">
<p>When a Hot Rod client registers a client listener, it does so in a single
node in a cluster. If that node fails, the Java Hot Rod client detects that
transparently and fails over all listeners registered in the node that failed
to another node.</p>
</div>
<div class="paragraph">
<p>During this fail over the client might miss some events. To avoid missing
these events, the client listener annotation contains an optional parameter
called <code>includeCurrentState</code> which if set to true, when the failover happens,
the cache contents can iterated over and <code>ClientCacheEntryCreated</code> events
(or custom events if configured) are generated. By default,
<code>includeCurrentState</code> is set to false.</p>
</div>
<div class="paragraph">
<p>Use callbacks to handle failover events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientCacheFailover</span>
<span class="directive">public</span> <span class="type">void</span> handleFailover(ClientCacheFailoverEvent e) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is very useful in use cases where the client has cached some data, and
as a result of the fail over, taking in account that some events could be
missed, it could decide to clear any locally cached data when the fail over
event is received, with the knowledge that after the fail over event, it will
receive events for the contents of the entire cache.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hotrod_transactions"><a class="anchor" href="#hotrod_transactions"></a>3.7. Hot Rod Java Client Transactions</h3>
<div class="paragraph">
<p>You can configure and use Hot Rod clients in JTA <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Transaction.html">Transaction</a>s.</p>
</div>
<div class="paragraph">
<p>To participate in a transaction, the Hot Rod client requires the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> with which it interacts and whether it participates in the transaction through the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Synchronization.html">Synchronization</a> or <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/xa/XAResource.html">XAResource</a> interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Transactions are optimistic in that clients acquire write locks on entries during the prepare phase.
To avoid data inconsistency, be sure to read about <a href="#hr_transactions_force_return_value">Detecting Conflicts with Transactions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="hr_transactions_config_server"><a class="anchor" href="#hr_transactions_config_server"></a>3.7.1. Configuring the Server</h4>
<div class="paragraph">
<p>Caches in the server must also be transactional for clients to participate in JTA <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Transaction.html">Transaction</a>s.</p>
</div>
<div class="paragraph">
<p>The following server configuration is required, otherwise transactions rollback only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Isolation level must be <code>REPEATABLE_READ</code>.</p>
</li>
<li>
<p><code>PESSIMISTIC</code> locking mode is recommended but <code>OPTIMISTIC</code> can be used.</p>
</li>
<li>
<p>Transaction mode should be <code>NON_XA</code> or <code>NON_DURABLE_XA</code>.
Hot Rod transactions should not use <code>FULL_XA</code> because it degrades performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrodReplTx</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;locking</span> <span class="attribute-name">isolation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPEATABLE_READ</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;transaction</span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NON_XA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">locking</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PESSIMISTIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hot Rod transactions have their own recovery mechanism.</p>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_config_client"><a class="anchor" href="#hr_transactions_config_client"></a>3.7.2. Configuring Hot Rod Clients</h4>
<div class="paragraph">
<p>Transactional <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> are configured per-cache basis.
The exception is the transaction&#8217;s <code>timeout</code> which is global, because a single transaction can interact with multiple <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a>s.</p>
</div>
<div class="paragraph">
<p>The following example shows how to configure a transactional <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> for cache <code>my-cache</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.infinispan.client.hotrod.configuration.ConfigurationBuilder cb = <span class="keyword">new</span> org.infinispan.client.hotrod.configuration.ConfigurationBuilder();
<span class="comment">//other client configuration parameters</span>
cb.transactionTimeout(<span class="integer">1</span>, <span class="predefined-type">TimeUnit</span>.MINUTES);
cb.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache</span><span class="delimiter">&quot;</span></span>)
   .transactionManagerLookup(GenericTransactionManagerLookup.getInstance())
   .transactionMode(TransactionMode.NON_XA);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">ConfigurationBuilder</a> and <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/RemoteCacheConfigurationBuilder.html">RemoteCacheConfigurationBuilder</a> Javadoc for documentation on configuration parameters.</p>
</div>
<div class="paragraph">
<p>You can also configure the Java Hot Rod client with a properties file, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>infinispan.client.hotrod.cache.my-cache.transaction.transaction_manager_lookup = org.infinispan.client.hotrod.transaction.lookup.GenericTransactionManagerLookup
infinispan.client.hotrod.cache.my-cache.transaction.transaction_mode = NON_XA
infinispan.client.hotrod.transaction.timeout = 60000</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="hr_transactions_tmlookup"><a class="anchor" href="#hr_transactions_tmlookup"></a>TransactionManagerLookup Interface</h5>
<div class="paragraph">
<p><code>TransactionManagerLookup</code> provides an entry point to fetch a <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a>.</p>
</div>
<div class="paragraph">
<p>Available implementations of <code>TransactionManagerLookup</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/transaction/lookup/GenericTransactionManagerLookup.html">GenericTransactionManagerLookup</a></dt>
<dd>
<p>A lookup class that locates <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a>s running in Java EE application servers.
Defaults to the <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/transaction/manager/RemoteTransactionManager.html">RemoteTransactionManager</a> if it cannot find a <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a>.
This is the default for Hot Rod Java clients.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In most cases, <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/transaction/lookup/GenericTransactionManagerLookup.html">GenericTransactionManagerLookup</a> is suitable.
However, you can implement the <code>TransactionManagerLookup</code> interface if you need to integrate a custom <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/transaction/lookup/RemoteTransactionManagerLookup.html">RemoteTransactionManagerLookup</a></dt>
<dd>
<p>A basic, and volatile, <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> if no other implementation is available.
Note that this implementation has significant limitations when handling concurrent transactions and recovery.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_modes"><a class="anchor" href="#hr_transactions_modes"></a>3.7.3. Transaction Modes</h4>
<div class="paragraph">
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/TransactionMode.html">TransactionMode</a> controls how a <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Configure transaction modes on both the Infinispan server and your client application.
If clients attempt to perform transactional operations on non-transactional caches, runtime exceptions can occur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Transaction modes are the same in both the Infinispan configuration and client settings.
Use the following modes with your client, see the Infinispan configuration schema for the server:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NONE</code></dt>
<dd>
<p>The <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> does not interact with the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a>.
This is the default mode and is non-transactional.</p>
</dd>
<dt class="hdlist1"><code>NON_XA</code></dt>
<dd>
<p>The <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> via <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Synchronization.html">Synchronization</a>.</p>
</dd>
<dt class="hdlist1"><code>NON_DURABLE_XA</code></dt>
<dd>
<p>The <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> via <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/xa/XAResource.html">XAResource</a>.
Recovery capabilities are disabled.</p>
</dd>
<dt class="hdlist1"><code>FULL_XA</code></dt>
<dd>
<p>The <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interacts with the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> via <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/xa/XAResource.html">XAResource</a>.
Recovery capabilities are enabled.
Invoke the <code>XaResource.recover()</code> method to retrieve transactions to recover.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_force_return_value"><a class="anchor" href="#hr_transactions_force_return_value"></a>3.7.4. Detecting Conflicts with Transactions</h4>
<div class="paragraph">
<p>Transactions use the initial values of keys to detect conflicts.</p>
</div>
<div class="paragraph">
<p>For example, "k" has a value of "v" when a transaction begins.
During the prepare phase, the transaction fetches "k" from the server to read the value.
If the value has changed, the transaction rolls back to avoid a conflict.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Transactions use versions to detect changes instead of checking value equality.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>forceReturnValue</code> parameter controls write operations to the <a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> and helps avoid conflicts.
It has the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>true</code>, the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> fetches the most recent value from the server before performing write operations.
However, the <code>forceReturnValue</code> parameter applies only to write operations that access the key for the first time.</p>
</li>
<li>
<p>If <code>false</code>, the <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/TransactionManager.html">TransactionManager</a> does not fetch the most recent value from the server before performing write operations.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This parameter does not affect <em>conditional</em> write operations such as <code>replace</code> or <code>putIfAbsent</code>
because they require the most recent value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following transactions provide an example where the <code>forceReturnValue</code> parameter can prevent conflicting write operations:</p>
</div>
<div class="listingblock">
<div class="title">Transaction 1 (TX1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">k</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>);
tm.commit();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Transaction 2 (TX2)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">k</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v2</span><span class="delimiter">&quot;</span></span>);
tm.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, TX1 and TX2 are executed in parallel.
The initial value of "k" is "v".</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>forceReturnValue = true</code>, the <code>cache.put()</code> operation fetches the value for "k" from the server in both TX1 and TX2.
The transaction that acquires the lock for "k" first then commits.
The other transaction rolls back during the commit phase because the transaction can detect that "k" has a value other than "v".</p>
</li>
<li>
<p>If <code>forceReturnValue = false</code>, the <code>cache.put()</code> operation does not fetch the value for "k" from the server and returns null.
Both TX1 and TX2 can successfully commit, which results in a conflict.
This occurs because neither transaction can detect that the initial value of "k" changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following transactions include <code>cache.get()</code> operations to read the value for "k" before doing the <code>cache.put()</code> operations:</p>
</div>
<div class="listingblock">
<div class="title">Transaction 1 (TX1)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">k</span><span class="delimiter">&quot;</span></span>);
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">k</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>);
tm.commit();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Transaction 2 (TX2)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = ...
TransactionManager tm = ...

tm.begin();
cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">k</span><span class="delimiter">&quot;</span></span>);
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">k</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v2</span><span class="delimiter">&quot;</span></span>);
tm.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding examples, TX1 and TX2 both read the key so the <code>forceReturnValue</code> parameter does not take effect.
One transaction commits, the other rolls back.
However, the <code>cache.get()</code> operation requires an additional server request.
If you do not need the return value for the <code>cache.put()</code> operation that server request is inefficient.</p>
</div>
</div>
<div class="sect3">
<h4 id="hr_transactions_ex_use_config"><a class="anchor" href="#hr_transactions_ex_use_config"></a>3.7.5. Using the Configured Transaction Manager and Transaction Mode</h4>
<div class="paragraph">
<p>The following example shows how to use the <code>TransactionManager</code> and <code>TransactionMode</code> that you configure in the <code>RemoteCacheManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//Configure the transaction manager and transaction mode.</span>
org.infinispan.client.hotrod.configuration.ConfigurationBuilder cb = <span class="keyword">new</span> org.infinispan.client.hotrod.configuration.ConfigurationBuilder();
cb.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache</span><span class="delimiter">&quot;</span></span>)
    .transactionManagerLookup(RemoteTransactionManagerLookup.getInstance())
    .transactionMode(TransactionMode.NON_XA);

RemoteCacheManager rcm = <span class="keyword">new</span> RemoteCacheManager(cb.build());

<span class="comment">//The my-cache instance uses the RemoteCacheManager configuration.</span>
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = rcm.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache</span><span class="delimiter">&quot;</span></span>);

<span class="comment">//Return the transaction manager that the cache uses.</span>
TransactionManager tm = cache.getTransactionManager();

<span class="comment">//Perform a simple transaction.</span>
tm.begin();
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">k1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">K1 value is </span><span class="delimiter">&quot;</span></span> + cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">k1</span><span class="delimiter">&quot;</span></span>));
tm.commit();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="junit-testing"><a class="anchor" href="#junit-testing"></a>4. JUnit testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run JUnit tests for Infinispan.</p>
</div>
<div class="sect2">
<h3 id="testing_infinispan_with_test_containers"><a class="anchor" href="#testing_infinispan_with_test_containers"></a>4.1. Testing Infinispan with test containers</h3>
<div class="paragraph">
<p>Run <a href="https://infinispan.org">Infinispan Server</a> instances using <a href="https://www.testcontainers.org">Testcontainers</a> for faster, simpler JUnit tests.</p>
</div>
<div class="paragraph">
<p>The Infinispan Server test container is based on the <a href="https://github.com/infinispan/infinispan-images/">official container image</a> provided by Infinispan.</p>
</div>
<div class="sect3">
<h4 id="starting_the_infinispan_test_container"><a class="anchor" href="#starting_the_infinispan_test_container"></a>4.1.1. Starting the Infinispan test container</h4>
<div class="paragraph">
<p>You can start the Infinispan Server container instance from any Java application as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (InfinispanContainer container = <span class="keyword">new</span> InfinispanContainer()) {
   container.start();
   <span class="keyword">try</span> (RemoteCacheManager cacheManager = container.getRemoteCacheManager()) {
      <span class="comment">// Use the RemoteCacheManager</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changing_credentials"><a class="anchor" href="#changing_credentials"></a>4.1.2. Changing credentials</h4>
<div class="paragraph">
<p>Infinispan Server is configured with the following default credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username: <code>admin</code></p>
</li>
<li>
<p>Password: <code>secret</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add custom credentials with the <code>withUser()</code> and <code>withPassword()</code> methods before starting the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">InfinispanContainer container = <span class="keyword">new</span> InfinispanContainer();
container.withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>).withPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>);
container.start();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding_the_test_container_to_your_project_dependencies"><a class="anchor" href="#adding_the_test_container_to_your_project_dependencies"></a>4.1.3. Adding the test container to your project dependencies</h4>
<div class="paragraph">
<p>Add the following dependency to your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>infinispan-server-testdriver-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>{{latest_version}}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-17 14:46:55 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>