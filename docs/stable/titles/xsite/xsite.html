<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Infinispan Guide to Cross-Site Replication</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="http://infinispan.org/docs/stable/user_guide/user_guide.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Infinispan Guide to Cross-Site Replication</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#xsite_replication">1. Infinispan Cross-Site Replication</a>
<ul class="sectlevel2">
<li><a href="#xsite_replication-xsite">1.1. Cross-Site Replication</a>
<ul class="sectlevel3">
<li><a href="#xsite_masters-xsite">1.1.1. Site Masters</a></li>
</ul>
</li>
<li><a href="#xsite_backups-xsite">1.2. Adding Backups to Caches</a></li>
<li><a href="#xsite_backup_strategies-xsite">1.3. Backup Strategies</a>
<ul class="sectlevel3">
<li><a href="#xsite_sync_backups-xsite">1.3.1. Synchronous Backups</a></li>
<li><a href="#xsite_async_backups-xsite">1.3.2. Asynchronous Backups</a></li>
<li><a href="#xsite_compare_backups-xsite">1.3.3. Synchronous vs Asynchronous Backups</a></li>
</ul>
</li>
<li><a href="#xsite_auto_offline-xsite">1.4. Automatically Taking Backups Offline</a></li>
<li><a href="#xsite_state_transfer-xsite">1.5. State Transfer</a></li>
<li><a href="#xsite_active_passive-xsite">1.6. Client Connections Across Sites</a>
<ul class="sectlevel3">
<li><a href="#conflict_resolution-xsite">1.6.1. Concurrent Writes and Conflicting Entries</a></li>
</ul>
</li>
<li><a href="#xsite_expiration-xsite">1.7. Expiration and Cross-Site Replication</a></li>
</ul>
</li>
<li><a href="#xsite_configure">2. Configuring Infinispan for Cross-Site Replication</a>
<ul class="sectlevel2">
<li><a href="#configure_relay-xsite">2.1. Configuring Cluster Transport for Cross-Site Replication</a>
<ul class="sectlevel3">
<li><a href="#ref_relay-xsite">2.1.1. JGroups RELAY2 Stacks</a></li>
<li><a href="#ref_relay_custom-xsite">2.1.2. Custom JGroups RELAY2 Stacks</a></li>
</ul>
</li>
<li><a href="#configure_backups-xsite">2.2. Adding Backup Locations to Caches</a></li>
<li><a href="#configure_backupfor-xsite">2.3. Backing Up to Caches with Different Names</a></li>
<li><a href="#verify_xsite_view-xsite">2.4. Verifying Cross-Site Views</a></li>
<li><a href="#configure_clients-xsite">2.5. Configuring Hot Rod Clients for Cross-Site Replication</a></li>
</ul>
</li>
<li><a href="#xsite_manage">3. Performing Cross-Site Replication Operations</a>
<ul class="sectlevel2">
<li><a href="#xsite_operations_cli">3.1. Performing Cross-Site Operations with the CLI</a>
<ul class="sectlevel3">
<li><a href="#manage_sites-cli-ops">3.1.1. Bringing Backup Locations Offline and Online</a></li>
<li><a href="#cli_xsite_push-cli-ops">3.1.2. Pushing State to Backup Locations</a></li>
</ul>
</li>
<li><a href="#xsite_operations_rest">3.2. Performing Cross-Site Operations with the REST API</a>
<ul class="sectlevel3">
<li><a href="#rest_v2_xsite_sites_status">3.2.1. Getting Status of All Backup Locations</a></li>
<li><a href="#rest_v2_xsite_site_status">3.2.2. Getting Status of Specific Backup Locations</a></li>
<li><a href="#rest_v2_xsite_take_site_offline">3.2.3. Taking Backup Locations Offline</a></li>
<li><a href="#rest_v2_xsite_bring_backup_online">3.2.4. Bringing Backup Locations Online</a></li>
<li><a href="#rest_v2_xsite_start_push">3.2.5. Pushing State to Backup Locations</a></li>
<li><a href="#rest_v2_xsite_cancel_state_push">3.2.6. Canceling State Transfer</a></li>
<li><a href="#rest_v2_xsite_state_push">3.2.7. Getting State Transfer Status</a></li>
<li><a href="#rest_v2_xsite_clear_transfer_status">3.2.8. Clearing State Transfer Status</a></li>
<li><a href="#rest_v2_xsite_tuning_takeoffline">3.2.9. Modifying Take Offline Conditions</a></li>
<li><a href="#rest_v2_xsite_cancel_receive_state">3.2.10. Canceling State Transfer from Receiving Sites</a></li>
<li><a href="#rest_v2_cache_manager_site_status">3.2.11. Getting Status of Backup Locations</a></li>
<li><a href="#rest_v2_cache_manager_take_offline">3.2.12. Taking Backup Locations Offline</a></li>
<li><a href="#rest_v2_cache_manager_bring_online">3.2.13. Bringing Backup Locations Online</a></li>
<li><a href="#rest_v2_cache_manager_start_push">3.2.14. Starting State Transfer</a></li>
<li><a href="#rest_v2_cache_manager_cancel_push">3.2.15. Canceling State Transfer</a></li>
</ul>
</li>
<li><a href="#xsite_operations_jmx">3.3. Performing Cross-Site Operations with JMX</a>
<ul class="sectlevel3">
<li><a href="#enable_jmx-jmx-ops">3.3.1. Configuring Infinispan to Register JMX MBeans</a></li>
<li><a href="#performing_jmx_operations-jmx-ops">3.3.2. Performing Cross-Site Operations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xsite_monitoring">4. Monitoring and Troubleshooting Global Infinispan Clusters</a>
<ul class="sectlevel2">
<li><a href="#enable_statistics-xsite">4.1. Enabling Infinispan Statistics</a></li>
<li><a href="#configure_metrics-xsite">4.2. Enabling Infinispan Metrics</a>
<ul class="sectlevel3">
<li><a href="#collect_metrics">4.2.1. Collecting Infinispan Metrics</a></li>
</ul>
</li>
<li><a href="#enable_jmx-xsite">4.3. Configuring Infinispan to Register JMX MBeans</a>
<ul class="sectlevel3">
<li><a href="#jmx_xsite-xsite">4.3.1. JMX MBeans for Cross-Site Replication</a></li>
</ul>
</li>
<li><a href="#xsite_tshoot-xsite">4.4. Collecting Logs and Troubleshooting Cross-Site Replication</a>
<ul class="sectlevel3">
<li><a href="#xsite_logs-xsite">4.4.1. Cross-Site Log Messages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Find out how Infinispan performs cross-site replication so you can get optimal
performance and avoid issues. Learn how to configure Infinispan to back up
data to remote clusters. Follow procedures to transfer state from one cluster
to another, take sites offline, and so on.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xsite_replication"><a class="anchor" href="#xsite_replication"></a>1. Infinispan Cross-Site Replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cross-site replication allows you to back up data from one Infinispan cluster
to another. Learn the concepts to understand how Infinispan cross-site
replication works before you configure your clusters.</p>
</div>
<div class="sect2">
<h3 id="xsite_replication-xsite"><a class="anchor" href="#xsite_replication-xsite"></a>1.1. Cross-Site Replication</h3>
<div class="paragraph">
<p>Infinispan clusters running in different locations can discover and
communicate with each other.</p>
</div>
<div class="paragraph">
<p>Sites are typically data centers in various geographic locations. Cross-site
replication bridges Infinispan clusters in sites to form global clusters, as
in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite.svg" alt="xsite">
</div>
</div>
<div class="paragraph">
<p><strong>LON</strong> is a datacenter in London, England.<br>
<strong>NYC</strong> is a datacenter in New York City, USA.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan can form global clusters across two or more sites.</p>
</div>
<div class="paragraph">
<p>For example, configure a third Infinispan cluster running in San Francisco,
<strong>SFO</strong>, as backup location for <strong>LON</strong> and <strong>NYC</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="xsite_masters-xsite"><a class="anchor" href="#xsite_masters-xsite"></a>1.1.1. Site Masters</h4>
<div class="paragraph">
<p>Site masters are the nodes in Infinispan clusters that are responsible for
sending and receiving requests from backup locations.</p>
</div>
<div class="paragraph">
<p>If a node is not a site master, it must forward backup requests to a local site
master. Only site masters can send requests to backup locations.</p>
</div>
<div class="paragraph">
<p>For optimal performance, you should configure all nodes as site masters. This
increases the speed of backup requests because each node in the cluster can
backup to remote sites directly without having to forward backup requests to
site masters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Diagrams in this document illustrate Infinispan clusters with one site master
because this is the default for the JGroups RELAY2 protocol. Likewise, a single
site master is easier to illustrate because each site master in a cluster
communicates with each site master in the remote cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xsite_backups-xsite"><a class="anchor" href="#xsite_backups-xsite"></a>1.2. Adding Backups to Caches</h3>
<div class="paragraph">
<p>Name remote sites as backup locations in your cache definitions.</p>
</div>
<div class="paragraph">
<p>For example, the following diagram shows three caches, "customers", "eu-orders", and "us-orders":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite-caches.svg" alt="xsite caches">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In <strong>LON</strong>, "customers" names <strong>NYC</strong> as a backup location.</p>
</li>
<li>
<p>In <strong>NYC</strong>, "customers" names <strong>LON</strong> as a backup location.</p>
</li>
<li>
<p>"eu-orders" and "us-orders" do not have backups and are local to the respective cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="xsite_backup_strategies-xsite"><a class="anchor" href="#xsite_backup_strategies-xsite"></a>1.3. Backup Strategies</h3>
<div class="paragraph">
<p>Infinispan clusters can use different strategies for backing up data to remote sites.</p>
</div>
<div class="paragraph">
<p>Infinispan replicates across sites at the same time that writes to local caches occur. For example, if a client writes "k1" to <strong>LON</strong>, Infinispan backs up "k1" to <strong>NYC</strong> at the same time.</p>
</div>
<div class="sect3">
<h4 id="xsite_sync_backups-xsite"><a class="anchor" href="#xsite_sync_backups-xsite"></a>1.3.1. Synchronous Backups</h4>
<div class="paragraph">
<p>When Infinispan replicates data to backup locations, it waits until the
operation completes before writing to the local cache.</p>
</div>
<div class="paragraph">
<p>You can control how Infinispan handles writes to the local cache if backup
operations fail. For example, you can configure Infinispan to attempt to abort
local writes and throw exceptions if backups to remote sites fail.</p>
</div>
<div class="paragraph">
<p>Synchronous backups also support two-phase commits with caches that participate
in optimistic transactions. The first phase of the backup acquires a lock. The
second phase commits the modification.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Two-phase commit with cross-site replication has a significant performance
impact because it requires two round-trips across the network.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="xsite_async_backups-xsite"><a class="anchor" href="#xsite_async_backups-xsite"></a>1.3.2. Asynchronous Backups</h4>
<div class="paragraph">
<p>When Infinispan replicates data to backup locations, it does not wait until the
operation completes before writing to the local cache.</p>
</div>
<div class="paragraph">
<p>Asynchronous backup operations and writes to the local cache are independent of
each other. If backup operations fail, write operations to the local cache
continue and no exceptions occur.</p>
</div>
</div>
<div class="sect3">
<h4 id="xsite_compare_backups-xsite"><a class="anchor" href="#xsite_compare_backups-xsite"></a>1.3.3. Synchronous vs Asynchronous Backups</h4>
<div class="paragraph">
<p>Synchronous backups offer the strongest guarantee of data consistency across
sites. If <code>strategy=sync</code>, when <code>cache.put()</code> calls return you know the value
is up to date in the local cache and in the backup locations.</p>
</div>
<div class="paragraph">
<p>The trade-off for this consistency is performance. Synchronous backups have
much greater latency in comparison to asynchronous backups.</p>
</div>
<div class="paragraph">
<p>Asynchronous backups, on the other hand, do not add latency to client requests
so they have no performance impact. However, if <code>strategy=async</code>, when
<code>cache.put()</code> calls return you cannot be sure of the value in the backup
locations is the same as in the local cache.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xsite_auto_offline-xsite"><a class="anchor" href="#xsite_auto_offline-xsite"></a>1.4. Automatically Taking Backups Offline</h3>
<div class="paragraph">
<p>You can configure backup locations to go offline automatically when the remote
sites become unavailable. This prevents Infinispan nodes from continuously
attempting to replicate data to offline backup locations, which results in
error messages and consumes resources.</p>
</div>
<div class="paragraph">
<div class="title">Timeout for backup operations</div>
<p>Backup configurations include timeout values for operations to replicate data.
If operations do not complete before the timeout occurs, Infinispan records
them as failures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        ...
<span class="tag">&lt;/backup&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Operations to replicate data to <strong>NYC</strong> are recorded as failures if they do
not complete after 10 seconds.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Number of failures</div>
<p>You can specify the number of <strong>consecutive</strong> failures that can occur before
backup locations go offline.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration for <strong>NYC</strong> sets five as the number of
failed operations before it goes offline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;take-offline</span> <span class="attribute-name">after-failures</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/backup&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If a cluster attempts to replicate data to <strong>NYC</strong> and five consecutive
operations fail, Infinispan automatically takes the backup offline.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Time to wait</div>
<p>You can also specify how long to wait before taking sites offline when backup
operations fail. If a backup request succeeds before the wait time runs out,
Infinispan does not take the site offline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;take-offline</span> <span class="attribute-name">after-failures</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">min-wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">15000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/backup&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If a cluster attempts to replicate data to <strong>NYC</strong> and there are five
consecutive failures and 15 seconds elapse after the first failed operation,
Infinispan automatically takes the backup offline.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Set a negative or zero value for the <code>after-failures</code> attribute if you want to
use only a minimum time to wait to take sites offline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;take-offline</span> <span class="attribute-name">after-failures</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min-wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="xsite_state_transfer-xsite"><a class="anchor" href="#xsite_state_transfer-xsite"></a>1.5. State Transfer</h3>
<div class="paragraph">
<p>State transfer is an administrative operation that synchronizes data between
sites.</p>
</div>
<div class="paragraph">
<p>For example, <strong>LON</strong> goes offline and <strong>NYC</strong> starts handling client requests.
When you bring <strong>LON</strong> back online, the Infinispan cluster in <strong>LON</strong> does not
have the same data as the cluster in <strong>NYC</strong>.</p>
</div>
<div class="paragraph">
<p>To ensure the data is consistent between <strong>LON</strong> and <strong>NYC</strong>, you can push
state from <strong>NYC</strong> to <strong>LON</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>State transfer is bidirectional. For example, you can push state from <strong>NYC</strong>
to <strong>LON</strong> or from <strong>LON</strong> to <strong>NYC</strong>.</p>
</li>
<li>
<p>Pushing state to offline sites brings them back online.</p>
</li>
<li>
<p>State transfer overwrites only data that exists on both sites, the originating site and the receiving site. Infinispan does not delete data.</p>
<div class="paragraph">
<p>For example, "k2" exists on <strong>LON</strong> and <strong>NYC</strong>. "k2" is removed from <strong>NYC</strong>
while <strong>LON</strong> is offline. When you bring <strong>LON</strong> back online, "k2" still exists
at that location. If you push state from <strong>NYC</strong> to <strong>LON</strong>, the transfer does
not affect "k2" on <strong>LON</strong>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To ensure contents of the cache are identical after state transfer, remove all
data from the cache on the receiving site before pushing state. Use the
<code>clear()</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>State transfer does not overwrite updates to data that occur after you
initiate the push.</p>
<div class="paragraph">
<p>For example, "k1,v1" exists on <strong>LON</strong> and <strong>NYC</strong>. <strong>LON</strong> goes offline so you
push state transfer to <strong>LON</strong> from <strong>NYC</strong>, which brings <strong>LON</strong> back online.
Before state transfer completes, a client puts "k1,v2" on <strong>LON</strong>.</p>
</div>
<div class="paragraph">
<p>In this case the state transfer from <strong>NYC</strong> does not overwrite "k1,v2" because
that modification happened after you initiated the push.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/Cache.html#clear()">org.infinispan.Cache.clear()</a></p>
</li>
<li>
<p><a href="../cli/cli.html#deleting_cache_entries">Clearing Caches with the CLI</a></p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code>help clearcache</code> from the CLI for command details and examples.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><a href="../rest/rest.html#rest_v2_clear_cache">Clearing Caches with the REST API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="xsite_active_passive-xsite"><a class="anchor" href="#xsite_active_passive-xsite"></a>1.6. Client Connections Across Sites</h3>
<div class="paragraph">
<p>Clients can write to Infinispan clusters in either an Active/Passive or
Active/Active configuration.</p>
</div>
<div class="paragraph">
<div class="title">Active/Passive</div>
<p>The following diagram illustrates Active/Passive where Infinispan handles
client requests from one site only:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite-active-passive.svg" alt="xsite active passive">
</div>
</div>
<div class="paragraph">
<p>In the preceding image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client connects to the Infinispan cluster at <strong>LON</strong>.</p>
</li>
<li>
<p>Client writes "k1" to the cache.</p>
</li>
<li>
<p>The site master at <strong>LON</strong>, "n1", sends the request to replicate "k1" to the site master at <strong>NYC</strong>, "nA".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With Active/Passive, <strong>NYC</strong> provides data redundancy. If the Infinispan
cluster at <strong>LON</strong> goes offline for any reason, clients can start sending
requests to <strong>NYC</strong>. When you bring <strong>LON</strong> back online you can synchronize
data with <strong>NYC</strong> and then switch clients back to <strong>LON</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Active/Active</div>
<p>The following diagram illustrates Active/Active where Infinispan handles
client requests at two sites:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite-active-active.svg" alt="xsite active active">
</div>
</div>
<div class="paragraph">
<p>In the preceding image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client A connects to the Infinispan cluster at <strong>LON</strong>.</p>
</li>
<li>
<p>Client A writes "k1" to the cache.</p>
</li>
<li>
<p>Client B connects to the Infinispan cluster at <strong>NYC</strong>.</p>
</li>
<li>
<p>Client B writes "k2" to the cache.</p>
</li>
<li>
<p>Site masters at <strong>LON</strong> and <strong>NYC</strong> send requests so that "k1" is replicated to <strong>NYC</strong> and "k2" is replicated to <strong>LON</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With Active/Active both <strong>NYC</strong> and <strong>LON</strong> replicate data to remote caches
while handling client requests. If either <strong>NYC</strong> or <strong>LON</strong> go offline,
clients can start sending requests to the online site. You can then bring
offline sites back online, push state to synchronize data, and switch clients
as required.</p>
</div>
<div class="sect3">
<h4 id="conflict_resolution-xsite"><a class="anchor" href="#conflict_resolution-xsite"></a>1.6.1. Concurrent Writes and Conflicting Entries</h4>
<div class="paragraph">
<p>Conflicting entries can occur with Active/Active site configurations if clients
write to the same entries at the same time but at different sites.</p>
</div>
<div class="paragraph">
<p>For example, client A writes to "k1" in <strong>LON</strong> at the same time that client B
writes to "k1" in <strong>NYC</strong>. In this case, "k1" has a different value in <strong>LON</strong>
than in <strong>NYC</strong>. After replication occurs, there is no guarantee which value
for "k1" exists at which site.</p>
</div>
<div class="paragraph">
<p>To ensure data consistency, Infinispan uses a vector clock algorithm to detect
conflicting entries during backup operations, as in the following illustration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>            LON       NYC

k1=(n/a)    0,0       0,0

k1=2        1,0  --&gt;  1,0   k1=2

k1=3        1,1  &lt;--  1,1   k1=3

k1=5        2,1       1,2   k1=8

                 --&gt;  2,1 (conflict)
(conflict)  1,2  &lt;--</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vector clocks are timestamp metadata that increment with each write to an
entry. In the preceding example, <code>0,0</code> represents the initial value for the
vector clock on "k1".</p>
</div>
<div class="paragraph">
<p>A client puts "k1=2" in <strong>LON</strong> and the vector clock is <code>1,0</code>, which
Infinispan replicates to <strong>NYC</strong>. A client then puts "k1=3" in <strong>NYC</strong> and the
vector clock updates to <code>1,1</code>, which Infinispan replicates to <strong>LON</strong>.</p>
</div>
<div class="paragraph">
<p>However if a client puts "k1=5" in <strong>LON</strong> at the same time that a client puts
"k1=8" in <strong>NYC</strong>, Infinispan detects a conflicting entry because the vector
value for "k1" is not strictly greater or less between <strong>LON</strong> and <strong>NYC</strong>.</p>
</div>
<div class="paragraph">
<p>When it finds conflicting entries, Infinispan uses the Java <code>compareTo(String
anotherString)</code> method to compare site names. To determine which key takes
priority, Infinispan selects the site name that is lexicographically less
than the other. Keys from a site named <strong>AAA</strong> take priority over keys from a
site named <strong>AAB</strong> and so on.</p>
</div>
<div class="paragraph">
<p>Following the same example, to resolve the conflict for "k1", Infinispan uses
the value for "k1" that originates from <strong>LON</strong>. This results in "k1=5" in both
<strong>LON</strong> and <strong>NYC</strong> after Infinispan resolves the conflict and replicates the
value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prepend site names with numbers as a simple way to represent the order of
priority for resolving conflicting entries; for example, <strong>1LON</strong> and <strong>2NYC</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#compareTo-java.lang.String-">java.lang.String#compareTo()</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xsite_expiration-xsite"><a class="anchor" href="#xsite_expiration-xsite"></a>1.7. Expiration and Cross-Site Replication</h3>
<div class="paragraph">
<p>Infinispan expiration controls how long entries remain in the cache.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>lifespan</code> expiration is suitable for cross-site replication. When entries reach the maximum lifespan, Infinispan expires them independently of the remote sites.</p>
</li>
<li>
<p><code>max-idle</code> expiration does not work with cross-site replication. Infinispan cannot determine when cache entries reach the idle timeout in remote sites.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xsite_configure"><a class="anchor" href="#xsite_configure"></a>2. Configuring Infinispan for Cross-Site Replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuring Infinispan to replicate data across sites, you first set up cluster transport so Infinispan clusters can discover each other and site masters can communicate. You then add backup locations to cache definitions in your Infinispan configuration.</p>
</div>
<div class="sect2">
<h3 id="configure_relay-xsite"><a class="anchor" href="#configure_relay-xsite"></a>2.1. Configuring Cluster Transport for Cross-Site Replication</h3>
<div class="paragraph">
<p>Add JGroups RELAY2 to your transport layer so that Infinispan clusters can
communicate with backup locations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>infinispan.xml</code> for editing.</p>
</li>
<li>
<p>Add the RELAY2 protocol to a JGroups stack, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;jgroups&gt;</span>
   <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;relay.RELAY2</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max_site_masters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;remote-sites</span> <span class="attribute-name">default-stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/remote-sites&gt;</span>
   <span class="tag">&lt;/stack&gt;</span>
<span class="tag">&lt;/jgroups&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configure Infinispan cluster transport to use the stack, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${cluster.name}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save and close <code>infinispan.xml</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="#ref_relay-xsite">JGroups RELAY2 Stacks</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/configdocs/">Infinispan Configuration Schema</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ref_relay-xsite"><a class="anchor" href="#ref_relay-xsite"></a>2.1.1. JGroups RELAY2 Stacks</h4>
<div class="paragraph">
<p>Infinispan clusters use JGroups RELAY2 for inter-cluster discovery and communication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;jgroups&gt;</span>
   <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;relay.RELAY2</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
                    <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
                    <span class="attribute-name">max_site_masters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="tag">&lt;remote-sites</span> <span class="attribute-name">default-stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
         <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
         <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/remote-sites&gt;</span>
   <span class="tag">&lt;/stack&gt;</span>
<span class="tag">&lt;/jgroups&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a stack named "xsite" that declares which protocols to use for your Infinispan cluster transport.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the default JGroups UDP stack for intra-cluster traffic.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adds <code>RELAY2</code> to the stack for inter-cluster transport.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Names the local site. Infinispan replicates data in caches from this site to backup locations.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Configures a maximum of 1000 site masters for the local cluster. You should set <code>max_site_masters</code> &gt;= the number of nodes in the Infinispan cluster for optimal performance with backup requests.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specifies all site names and uses the default JGroups TCP stack for inter-cluster transport.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Names each remote site as a backup location.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ref_relay_custom-xsite"><a class="anchor" href="#ref_relay_custom-xsite"></a>2.1.2. Custom JGroups RELAY2 Stacks</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;jgroups&gt;</span>
   <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relay-global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
         <span class="tag">&lt;MPING</span> <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;TCPPING</span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">192.0.2.0[7800]</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCP</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
   <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;relay.RELAY2</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">max_site_masters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="attribute-name">can_become_site_master</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;remote-sites</span> <span class="attribute-name">default-stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relay-global</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/remote-sites&gt;</span>
   <span class="tag">&lt;/stack&gt;</span>
<span class="tag">&lt;/jgroups&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds a custom RELAY2 stack that extends the TCP stack and uses TCPPING instead of MPING for discovery.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the maximum number of site masters and optionally specifies additional RELAY2 properties. See JGroups RELAY2 documentation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also reference externally defined JGroups stack files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;stack-file</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relay-global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-relay.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding configuration <code>jgroups-relay.xml</code> provides a JGroups stack
such as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;config</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups http://www.jgroups.org/schema/jgroups-4.2.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- Use TCP for inter-cluster transport. --&gt;</span>
    <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7200</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>

         <span class="attribute-name">thread_pool.min_threads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_pool.max_threads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_pool.keep_alive_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span>
    <span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- Use TCPPING for inter-cluster discovery. --&gt;</span>
    <span class="tag">&lt;TCPPING</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1[7200]</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">ergonomics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- Provide other JGroups stack configuration as required. --&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../configuring/configuring.html#cluster_transport">Cluster Transport Configuration</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#RELAY2">JGroups RELAY2</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#Relay2Advanced">Relaying between multiple sites (RELAY2)</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure_backups-xsite"><a class="anchor" href="#configure_backups-xsite"></a>2.2. Adding Backup Locations to Caches</h3>
<div class="paragraph">
<p>Specify the names of remote sites so Infinispan can back up data to those locations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>backups</code> element to your cache definition.</p>
</li>
<li>
<p>Specify the name of each remote site with the <code>backup</code> element.</p>
<div class="paragraph">
<p>As an example, in the <strong>LON</strong> configuration, specify <strong>NYC</strong> as the remote site.</p>
</div>
</li>
<li>
<p>Repeat the preceding steps so that each site is a backup for all other sites. For example, you cannot add <strong>LON</strong> as a backup for <strong>NYC</strong> without adding <strong>NYC</strong> as a backup for <strong>LON</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cache configurations can be different across sites and use different backup
strategies. Infinispan replicates data based on cache names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example "customers" configuration in <strong>LON</strong></div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example "customers" configuration in <strong>NYC</strong></div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/configdocs/">Infinispan Configuration Schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configure_backupfor-xsite"><a class="anchor" href="#configure_backupfor-xsite"></a>2.3. Backing Up to Caches with Different Names</h3>
<div class="paragraph">
<p>By default, Infinispan replicates data between caches that have the same name.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use <code>backup-for</code> to replicate data from a remote site into a cache with a
different name on the local site.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following configuration backs up the "customers" cache on
<strong>LON</strong> to the "eu-customers" cache on <strong>NYC</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
  <span class="tag">&lt;backup-for</span> <span class="attribute-name">remote-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verify_xsite_view-xsite"><a class="anchor" href="#verify_xsite_view-xsite"></a>2.4. Verifying Cross-Site Views</h3>
<div class="paragraph">
<p>After you configure Infinispan for cross-site replication, you should verify
that Infinispan clusters successfully form cross-site views.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Check log messages for <code>ISPN000439: Received new x-site view</code> messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if the Infinispan cluster in <strong>LON</strong> has formed a cross-site view
with the Infinispan cluster in <strong>NYC</strong>, it provides the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  [org.infinispan.XSITE] (jgroups-5,${server.hostname}) ISPN000439: Received new x-site view: [NYC]
INFO  [org.infinispan.XSITE] (jgroups-7,${server.hostname}) ISPN000439: Received new x-site view: [NYC, LON]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure_clients-xsite"><a class="anchor" href="#configure_clients-xsite"></a>2.5. Configuring Hot Rod Clients for Cross-Site Replication</h3>
<div class="paragraph">
<p>Configure Hot Rod clients to use Infinispan clusters at different sites.</p>
</div>
<div class="listingblock">
<div class="title"><code>hotrod-client.properties</code></div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code># Servers at the active site
infinispan.client.hotrod.server_list = LON_host1:11222,LON_host2:11222,LON_host3:11222

# Servers at the backup site
infinispan.client.hotrod.cluster.NYC = NYC_hostA:11222,NYC_hostB:11222,NYC_hostC:11222,NYC_hostD:11222</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>ConfigurationBuilder</code></div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServers(<span class="string"><span class="delimiter">&quot;</span><span class="content">LON_host1:11222;LON_host2:11222;LON_host3:11222</span><span class="delimiter">&quot;</span></span>)
       .addCluster(<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>)
       .addClusterNodes(<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC_hostA:11222;NYC_hostB:11222;NYC_hostC:11222;NYC_hostD:11222</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the following methods to switch Hot Rod clients to the default cluster or
to a cluster at a different site:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RemoteCacheManager.switchToDefaultCluster()</code></p>
</li>
<li>
<p><code>RemoteCacheManager.switchToCluster(${site.name})</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html#package.description">org.infinispan.client.hotrod.configuration package description</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html#RemoteCacheManager-java.net.URL-">org.infinispan.client.hotrod.RemoteCacheManager</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xsite_manage"><a class="anchor" href="#xsite_manage"></a>3. Performing Cross-Site Replication Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Bring sites online and offline. Transfer cache state to remote sites.</p>
</div>
<div class="sect2">
<h3 id="xsite_operations_cli"><a class="anchor" href="#xsite_operations_cli"></a>3.1. Performing Cross-Site Operations with the CLI</h3>
<div class="paragraph">
<p>The Infinispan command line interface lets you remotely connect to Infinispan
servers, manage sites, and push state transfer to backup locations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Start the Infinispan CLI.</p>
</li>
<li>
<p>Connect to a running Infinispan cluster.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="manage_sites-cli-ops"><a class="anchor" href="#manage_sites-cli-ops"></a>3.1.1. Bringing Backup Locations Offline and Online</h4>
<div class="paragraph">
<p>Take backup locations offline manually and bring them back online.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Check if backup locations are online or offline with the <code class="command">site status</code> command:</p>
<div class="listingblock">
<div class="content">
<pre>//containers/default]&gt; site status --cache=cacheName --site=NYC</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>--site</code> is an optional argument. If not set, the CLI returns all backup
locations.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Manage backup locations as follows:</p>
<div class="ulist">
<ul>
<li>
<p>Bring backup locations online with the <code class="command">bring-online</code> command:</p>
<div class="listingblock">
<div class="content">
<pre>//containers/default]&gt; site bring-online --cache=customers --site=NYC</pre>
</div>
</div>
</li>
<li>
<p>Take backup locations offline with the <code class="command">take-offline</code> command:</p>
<div class="listingblock">
<div class="content">
<pre>//containers/default]&gt; site take-offline --cache=customers --site=NYC</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information and examples, run the <code class="command">help site</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="cli_xsite_push-cli-ops"><a class="anchor" href="#cli_xsite_push-cli-ops"></a>3.1.2. Pushing State to Backup Locations</h4>
<div class="paragraph">
<p>Transfer cache state to remote backup locations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">site</code> command to push state transfer, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre>//containers/default]&gt; site push-site-state --cache=cacheName --site=NYC</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information and examples, run the <code class="command">help site</code> command.</p>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="../cli/cli.html">Infinispan Command Line Interface</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xsite_operations_rest"><a class="anchor" href="#xsite_operations_rest"></a>3.2. Performing Cross-Site Operations with the REST API</h3>
<div class="paragraph">
<p>Infinispan servers provide a REST API that allows you to perform cross-site
operations.</p>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_sites_status"><a class="anchor" href="#rest_v2_xsite_sites_status"></a>3.2.1. Getting Status of All Backup Locations</h4>
<div class="paragraph">
<p>Retrieve the status of all backup locations with <code>GET</code> requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with the status of each backup location in JSON format, as
in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">offline</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Returned Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>online</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mixed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some nodes in the local cluster have a cross-site view with the backup location, other nodes in the local cluster do not have a cross-site view. The response indicates status for each node.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_site_status"><a class="anchor" href="#rest_v2_xsite_site_status"></a>3.2.2. Getting Status of Specific Backup Locations</h4>
<div class="paragraph">
<p>Retrieve the status of a backup location with <code>GET</code> requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups/{siteName}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with the status of each node in the site in JSON
format, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">NodeA</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">offline</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">NodeB</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Returned Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>online</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node is online.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node is offline.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not possible to retrieve status. The remote cache could be shutting down or a network error occurred during the request.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_take_site_offline"><a class="anchor" href="#rest_v2_xsite_take_site_offline"></a>3.2.3. Taking Backup Locations Offline</h4>
<div class="paragraph">
<p>Take backup locations offline with <code>POST</code> requests and the
<code>?action=take-offline</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=take-offline</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_bring_backup_online"><a class="anchor" href="#rest_v2_xsite_bring_backup_online"></a>3.2.4. Bringing Backup Locations Online</h4>
<div class="paragraph">
<p>Bring backup locations online with the <code>?action=bring-online</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=bring-online</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_start_push"><a class="anchor" href="#rest_v2_xsite_start_push"></a>3.2.5. Pushing State to Backup Locations</h4>
<div class="paragraph">
<p>Push cache state to a backup location with the <code>?action=start-push-state</code>
parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=start-push-state</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_cancel_state_push"><a class="anchor" href="#rest_v2_xsite_cancel_state_push"></a>3.2.6. Canceling State Transfer</h4>
<div class="paragraph">
<p>Cancel state transfer operations with the <code>?action=cancel-push-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=cancel-push-state</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_state_push"><a class="anchor" href="#rest_v2_xsite_state_push"></a>3.2.7. Getting State Transfer Status</h4>
<div class="paragraph">
<p>Retrieve status of state transfer operations with the
<code>?action=push-state-status</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups?action=push-state-status</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with the status of state transfer for each backup location
in JSON format, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CANCELED</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Returned Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SENDING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State transfer to the backup location is in progress.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State transfer completed successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An error occurred with state transfer. Check log files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CANCELLING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State transfer cancellation is in progress.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_clear_transfer_status"><a class="anchor" href="#rest_v2_xsite_clear_transfer_status"></a>3.2.8. Clearing State Transfer Status</h4>
<div class="paragraph">
<p>Clear state transfer status for sending sites with the
<code>?action=clear-push-state-status</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/local?action=clear-push-state-status</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_tuning_takeoffline"><a class="anchor" href="#rest_v2_xsite_tuning_takeoffline"></a>3.2.9. Modifying Take Offline Conditions</h4>
<div class="paragraph">
<p>Sites go offline if certain conditions are met. Modify the take offline
parameters to control when backup locations automatically go offline.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check configured take offline parameters with <code>GET</code> requests and the
<code>take-offline-config</code> parameter.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups/{siteName}/take-offline-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Infinispan response includes <code>after_failures</code> and <code>min_wait</code> fields as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">after_failures</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">min_wait</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Modify take offline parameters in the body of <code>PUT</code> requests.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>PUT /v2/caches/{cacheName}/x-site/backups/{siteName}/take-offline-config</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_xsite_cancel_receive_state"><a class="anchor" href="#rest_v2_xsite_cancel_receive_state"></a>3.2.10. Canceling State Transfer from Receiving Sites</h4>
<div class="paragraph">
<p>If the connection between two backup locations breaks, you can cancel state
transfer on the site that is receiving the push.</p>
</div>
<div class="paragraph">
<p>Cancel state transfer from a remote site and keep the current state of the
local cache with the <code>?action=cancel-receive-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=cancel-receive-state</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_cache_manager_site_status"><a class="anchor" href="#rest_v2_cache_manager_site_status"></a>3.2.11. Getting Status of Backup Locations</h4>
<div class="paragraph">
<p>Retrieve the status of all backup locations from Cache Managers with <code>GET</code>
requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with status in JSON format, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">SFO-3</span><span class="delimiter">&quot;</span></span>:{
      <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>
   },
   <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC-2</span><span class="delimiter">&quot;</span></span>:{
      <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">mixed</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>:[
         <span class="string"><span class="delimiter">&quot;</span><span class="content">CACHE_1</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">offline</span><span class="delimiter">&quot;</span></span>:[
         <span class="string"><span class="delimiter">&quot;</span><span class="content">CACHE_2</span><span class="delimiter">&quot;</span></span>
      ]
   }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Returned Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>online</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mixed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some nodes in the local cluster have a cross-site view with the backup location, other nodes in the local cluster do not have a cross-site view. The response indicates status for each node.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="rest_v2_cache_manager_take_offline"><a class="anchor" href="#rest_v2_cache_manager_take_offline"></a>3.2.12. Taking Backup Locations Offline</h4>
<div class="paragraph">
<p>Take backup locations offline with the <code>?action=take-offline</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=take-offline</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_cache_manager_bring_online"><a class="anchor" href="#rest_v2_cache_manager_bring_online"></a>3.2.13. Bringing Backup Locations Online</h4>
<div class="paragraph">
<p>Bring backup locations online with the <code>?action=bring-online</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=bring-online</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_cache_manager_start_push"><a class="anchor" href="#rest_v2_cache_manager_start_push"></a>3.2.14. Starting State Transfer</h4>
<div class="paragraph">
<p>Push state of all caches to remote sites with the <code>?action=start-push-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=start-push-state</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest_v2_cache_manager_cancel_push"><a class="anchor" href="#rest_v2_cache_manager_cancel_push"></a>3.2.15. Canceling State Transfer</h4>
<div class="paragraph">
<p>Cancel ongoing state transfer operations with the <code>?action=cancel-push-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=cancel-push-state</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xsite_operations_jmx"><a class="anchor" href="#xsite_operations_jmx"></a>3.3. Performing Cross-Site Operations with JMX</h3>
<div class="paragraph">
<p>Infinispan provides JMX tooling to perfrom cross-site operations such as
pushing state transfer and bringing sites online.</p>
</div>
<div class="sect3">
<h4 id="enable_jmx-jmx-ops"><a class="anchor" href="#enable_jmx-jmx-ops"></a>3.3.1. Configuring Infinispan to Register JMX MBeans</h4>
<div class="paragraph">
<p>Infinispan can register JMX MBeans that you can use to collect statistics and
perform administrative operations. However, you must enable statistics
separately to JMX otherwise Infinispan provides <code>0</code> values for all statistic
attributes.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable JMX declaratively or programmatically.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Declaratively</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container&gt;</span>
  <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers Infinispan JMX MBeans.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Programmatically</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
  .jmx().enable() <i class="conum" data-value="1"></i><b>(1)</b>
  .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers Infinispan JMX MBeans.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="performing_jmx_operations-jmx-ops"><a class="anchor" href="#performing_jmx_operations-jmx-ops"></a>3.3.2. Performing Cross-Site Operations</h4>
<div class="paragraph">
<p>Perform cross-site operations via JMX clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure Infinispan to register JMX MBeans</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to Infinispan with any JMX client.</p>
</li>
<li>
<p>Invoke operations from the following MBeans:</p>
<div class="ulist">
<ul>
<li>
<p><code>XSiteAdmin</code> provides cross-site operations for caches.</p>
</li>
<li>
<p><code>GlobalXSiteAdminOperations</code> provides cross-site operations for Cache Managers.</p>
<div class="paragraph">
<p>For example, to bring sites back online, invoke <code>bringSiteOnline(siteName)</code>.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>See the <em>Infinispan JMX Components</em> documentation for details about available
cross-site operations.</p>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/jmxComponents.html#XSiteAdmin">XSiteAdmin MBean</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/jmxComponents.html#XSiteAdmin">GlobalXSiteAdminOperations MBean</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xsite_monitoring"><a class="anchor" href="#xsite_monitoring"></a>4. Monitoring and Troubleshooting Global Infinispan Clusters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides statistics for cross-site replication operations via JMX
or the <code>/metrics</code> endpoint for Infinispan server.</p>
</div>
<div class="paragraph">
<p>Cross-site replication statistics are available at cache level so you must
explicitly enable statistics for your caches. Likewise, if you want to collect
statistics via JMX you must configure Infinispan to register MBeans.</p>
</div>
<div class="paragraph">
<p>Infinispan also includes an <code>org.infinispan.XSITE</code> logging category so you can
monitor and troubleshoot common issues with networking and state transfer
operations.</p>
</div>
<div class="sect2">
<h3 id="enable_statistics-xsite"><a class="anchor" href="#enable_statistics-xsite"></a>4.1. Enabling Infinispan Statistics</h3>
<div class="paragraph">
<p>Infinispan lets you enable statistics for Cache Managers and caches. However,
enabling statistics for a Cache Manager does not enable statistics for the
caches that it controls. You must explicitly enable statistics for your caches.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan server enables statistics for Cache Managers by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable statistics declaratively or programmatically.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Declaratively</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables statistics for the Cache Manager.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables statistics for the named cache.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Programmatically</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
  .cacheContainer().statistics(<span class="predefined-constant">true</span>) <i class="conum" data-value="1"></i><b>(1)</b>
  .build();

 ...

Configuration config = <span class="keyword">new</span> ConfigurationBuilder()
<span class="error"></span> .statistics().enable() <i class="conum" data-value="2"></i><b>(2)</b>
  .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables statistics for the Cache Manager.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables statistics for the named cache.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configure_metrics-xsite"><a class="anchor" href="#configure_metrics-xsite"></a>4.2. Enabling Infinispan Metrics</h3>
<div class="paragraph">
<p>Configure Infinispan to export gauges and histograms.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure metrics declaratively or programmatically.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Declaratively</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;metrics</span> <span class="attribute-name">gauges</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">histograms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Computes and collects statistics about the Cache Manager.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Exports collected statistics as gauge and histogram metrics.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Programmatically</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
  .statistics().enable() <i class="conum" data-value="1"></i><b>(1)</b>
  .metrics().gauges(<span class="predefined-constant">true</span>).histograms(<span class="predefined-constant">true</span>) <i class="conum" data-value="2"></i><b>(2)</b>
  .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Computes and collects statistics about the Cache Manager.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Exports collected statistics as gauge and histogram metrics.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="collect_metrics"><a class="anchor" href="#collect_metrics"></a>4.2.1. Collecting Infinispan Metrics</h4>
<div class="paragraph">
<p>Collect Infinispan metrics with monitoring tools such as Prometheus.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Enable statistics. If you do not enable statistics, Infinispan provides <code>0</code>
and <code>-1</code> values for metrics.</p>
</li>
<li>
<p>Optionally enable histograms. By default Infinispan generates gauges but not histograms.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Get metrics in Prometheus (OpenMetrics) format:</p>
<div class="listingblock">
<div class="content">
<pre>$ curl -v http://localhost:11222/metrics</pre>
</div>
</div>
</li>
<li>
<p>Get metrics in MicroProfile JSON format:</p>
<div class="listingblock">
<div class="content">
<pre>$ curl --header "Accept: application/json" http://localhost:11222/metrics</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Configure monitoring applications to collect Infinispan metrics. For example,
add the following to <code>prometheus.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>static_configs:
    - targets: ['localhost:11222']</pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Prometheus Configuration</a></p>
</li>
<li>
<p><a href="#enable_statistics">Enabling Infinispan Statistics</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable_jmx-xsite"><a class="anchor" href="#enable_jmx-xsite"></a>4.3. Configuring Infinispan to Register JMX MBeans</h3>
<div class="paragraph">
<p>Infinispan can register JMX MBeans that you can use to collect statistics and
perform administrative operations. However, you must enable statistics
separately to JMX otherwise Infinispan provides <code>0</code> values for all statistic
attributes.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable JMX declaratively or programmatically.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Declaratively</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container&gt;</span>
  <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers Infinispan JMX MBeans.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Programmatically</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
  .jmx().enable() <i class="conum" data-value="1"></i><b>(1)</b>
  .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers Infinispan JMX MBeans.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="jmx_xsite-xsite"><a class="anchor" href="#jmx_xsite-xsite"></a>4.3.1. JMX MBeans for Cross-Site Replication</h4>
<div class="paragraph">
<p>Infinispan provides JMX MBeans for cross-site replication that let you gather
statistics and perform remote operations.</p>
</div>
<div class="paragraph">
<p>The <code>org.infinispan:type=Cache</code> component provides the following JMX MBeans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>XSiteAdmin</code> exposes cross-site operations that apply to specific cache instances.</p>
</li>
<li>
<p><code>StateTransferManager</code> provides statistics for state transfer operations.</p>
</li>
<li>
<p><code>InboundInvocationHandler</code> provides statistics and operations for asynchronous and synchronous cross-site requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>org.infinispan:type=CacheManager</code> component includes the following JMX MBean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GlobalXSiteAdminOperations</code> exposes cross-site operations that apply to all caches in a cache container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details about JMX MBeans along with descriptions of available operations
and statistics, see the <em>Infinispan JMX Components</em> documentation.</p>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/11.0/apidocs/jmxComponents.html">Infinispan JMX Components</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xsite_tshoot-xsite"><a class="anchor" href="#xsite_tshoot-xsite"></a>4.4. Collecting Logs and Troubleshooting Cross-Site Replication</h3>
<div class="paragraph">
<p>Diagnose and resolve issues related to Infinispan cross-site replication. Use
the Infinispan Command Line Interface (CLI) to adjust log levels at run-time
and perform cross-site troubleshooting.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Create a Infinispan CLI connection.</p>
</li>
<li>
<p>Adjust run-time logging levels to capture DEBUG messages if necessary.</p>
<div class="paragraph">
<p>For example, the following command enables DEBUG log messages for the org.infinispan.XSITE category:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; logging set --level=DEBUG org.infinispan.XSITE</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then check the Infinispan log files for cross-site messages in the <code>${infinispan.server.root}/log</code> directory.</p>
</div>
</li>
<li>
<p>Use the <code class="command">site</code> command to view status for backup locations and perform troubleshooting.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, check the status of the "customers" cache that uses "LON" as a
backup location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; site status --cache=customers
{
  &quot;LON&quot; : &quot;online&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another scenario for using the Infinispan CLI to troubleshoot is when the
network connection between backup locations is broken during a state transfer
operation.</p>
</div>
<div class="paragraph">
<p>If this occurs, Infinispan clusters that receive state transfer continually
wait for the operation to complete. In this case you should cancel the state
transfer to the receiving site to return it to a normal operational state.</p>
</div>
<div class="paragraph">
<p>For example, cancel state transfer for "NYC" as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; site cancel-receive-state --cache=mycache --site=NYC`</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../server/server.html#tshoot_server">Infinispan Server Troubleshooting</a></p>
</li>
<li>
<p><a href="../server/server.html#logs">Working with Infinispan Server Logs</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="xsite_logs-xsite"><a class="anchor" href="#xsite_logs-xsite"></a>4.4.1. Cross-Site Log Messages</h4>
<div class="paragraph">
<p>Find user actions for log messages related to cross-site replication.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log level</th>
<th class="tableblock halign-left valign-top">Identifier</th>
<th class="tableblock halign-left valign-top">Message</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node null was suspected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when it cannot reach backup locations. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000439</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received new x-site view: ${site.name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when sites join and leave the global cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN100005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site ${site.name} is online.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when a site comes online.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN100006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site ${site.name} is offline.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when a site goes offline.
If you did not take the site offline manually, this message could indicate a failure has occurred. Check network status and try to bring the site back online.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Problems backing up data for cache ${cache.name} to site ${site.name}:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when issues occur with state transfer operations along with the exception. If necessary adjust Infinispan logging to get more fine-grained logging messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000289</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to send X-Site state chunk to ${site.name}.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot transfer a batch of cache entries during a state transfer operation. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000291</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to apply X-Site state chunk.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot apply a batch of cache entries during a state transfer operation. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to re-start x-site state transfer to site ${site.name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot resume a state transfer operation to a backup location. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000477</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to perform operation ${operation.name} for site ${site.name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot successfully complete an operation on a backup location. If necessary adjust Infinispan logging to get more fine-grained logging messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000449</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XSite state transfer timeout must be higher or equals than 1 (one).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Results when the value of the <code>timeout</code> attribute is <code>0</code> or a negative number. Specify a value of at least <code>1</code> for the <code>timeout</code> attribute in the state transfer configuration for your cache definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000450</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XSite state transfer waiting time between retries must be higher or equals than 1 (one).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Results when the value of the <code>wait-time</code> attribute is <code>0</code> or a negative number. Specify a value of at least <code>1</code> for the <code>wait-time</code> attribute in the state transfer configuration for your cache definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site Replication not available for local cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site replication does not work with the local cache mode. Either remove the backup configuration from the local cache definition or use a distributed or replicated cache mode.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-11-30 02:47:11 -0500
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>