<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Embedding Infinispan in Java Applications</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Embedding Infinispan in Java Applications</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#configuring-maven-repository">1. Configuring the Infinispan Maven repository</a>
<ul class="sectlevel2">
<li><a href="#configuring-pom-xml_configuring-maven-repository">1.1. Configuring your Infinispan POM</a></li>
</ul>
</li>
<li><a href="#creating-embedded-caches">2. Creating embedded caches</a>
<ul class="sectlevel2">
<li><a href="#installing-embedded_creating-embedded-caches">2.1. Adding Infinispan to your project</a></li>
<li><a href="#configuring-embedded-caches_creating-embedded-caches">2.2. Configuring embedded caches</a></li>
</ul>
</li>
<li><a href="#statistics-jmx">3. Enabling and configuring Infinispan statistics and JMX monitoring</a>
<ul class="sectlevel2">
<li><a href="#enabling-statistics-embedded_statistics-jmx">3.1. Enabling statistics in embedded caches</a></li>
<li><a href="#configuring-metrics_statistics-jmx">3.2. Configuring Infinispan metrics</a></li>
<li><a href="#enabling-jmx_statistics-jmx">3.3. Registering JMX MBeans</a>
<ul class="sectlevel3">
<li><a href="#enabling-jmx-port_statistics-jmx">3.3.1. Enabling JMX remote ports</a></li>
<li><a href="#jmx-mbeans_statistics-jmx">3.3.2. Infinispan MBeans</a></li>
<li><a href="#registering-jmx-mbean-servers-statistics-jmx">3.3.3. Registering MBeans in custom MBean servers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cluster-transport">4. Setting up Infinispan cluster transport</a>
<ul class="sectlevel2">
<li><a href="#default-jgroups-stacks_cluster-transport">4.1. Default JGroups stacks</a></li>
<li><a href="#cluster-discovery-protocols_cluster-transport">4.2. Cluster discovery protocols</a>
<ul class="sectlevel3">
<li><a href="#discovery-ping_cluster-transport">4.2.1. PING</a></li>
<li><a href="#discovery-tcpping_cluster-transport">4.2.2. TCPPING</a></li>
<li><a href="#discovery-mping_cluster-transport">4.2.3. MPING</a></li>
<li><a href="#discovery-tcp-gossip_cluster-transport">4.2.4. TCPGOSSIP</a></li>
<li><a href="#discovery-jdbcping_cluster-transport">4.2.5. JDBC_PING</a></li>
<li><a href="#discovery-dns-ping_cluster-transport">4.2.6. DNS_PING</a></li>
<li><a href="#jgroups-cloud-discovery-protocols_cluster-transport">4.2.7. Cloud discovery protocols</a></li>
</ul>
</li>
<li><a href="#using-jgroups-default-stacks_cluster-transport">4.3. Using the default JGroups stacks</a></li>
<li><a href="#customizing-jgroups-stacks_cluster-transport">4.4. Customizing JGroups stacks</a>
<ul class="sectlevel3">
<li><a href="#jgroups-inheritance-attributes_cluster-transport">4.4.1. Inheritance attributes</a></li>
</ul>
</li>
<li><a href="#using-jgroups-system-properties_cluster-transport">4.5. Using JGroups system properties</a>
<ul class="sectlevel3">
<li><a href="#jgroups-system-properties_cluster-transport">4.5.1. Cluster transport properties</a></li>
<li><a href="#jgroups-extras-properties_cluster-transport">4.5.2. System properties for cloud discovery protocols</a>
<ul class="sectlevel4">
<li><a href="#amazon_ec2">Amazon EC2</a></li>
<li><a href="#google_cloud_platform">Google Cloud Platform</a></li>
<li><a href="#azure">Azure</a></li>
<li><a href="#kubernetes">Kubernetes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-inline-jgroups-stacks_cluster-transport">4.6. Using inline JGroups stacks</a></li>
<li><a href="#using-external-jgroups-stacks_cluster-transport">4.7. Using external JGroups stacks</a></li>
<li><a href="#using-custom-jchannels_cluster-transport">4.8. Using custom JChannels</a></li>
<li><a href="#secure-cluster-transport">4.9. Encrypting cluster transport</a>
<ul class="sectlevel3">
<li><a href="#jgroups-encryption-protocols_secure-cluster-transport">4.9.1. JGroups encryption protocols</a></li>
<li><a href="#configuring-jgroups-asym-encrypt_secure-cluster-transport">4.9.2. Securing cluster transport with asymmetric encryption</a></li>
<li><a href="#configuring-jgroups-sym-encrypt_secure-cluster-transport">4.9.3. Securing cluster transport with symmetric encryption</a></li>
</ul>
</li>
<li><a href="#jgroups-ports_cluster-transport">4.10. TCP and UDP ports for cluster traffic</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="configuring-maven-repository"><a class="anchor" href="#configuring-maven-repository"></a>1. Configuring the Infinispan Maven repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Java distributions are available from Maven.</p>
</div>
<div class="paragraph">
<p>Infinispan artifacts are available from Maven central. See the <a href="https://search.maven.org/search?q=g:org.infinispan">org.infinispan</a> group for available Infinispan artifacts.</p>
</div>
<div class="sect2">
<h3 id="configuring-pom-xml_configuring-maven-repository"><a class="anchor" href="#configuring-pom-xml_configuring-maven-repository"></a>1.1. Configuring your Infinispan POM</h3>
<div class="paragraph">
<p>Maven uses configuration files called Project Object Model (POM) files to
define projects and manage builds. POM files are in XML format and describe the
module and component dependencies, build order, and targets for the resulting
project packaging and output.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your project <code>pom.xml</code> for editing.</p>
</li>
<li>
<p>Define the <code>version.infinispan</code> property with the correct Infinispan version.</p>
</li>
<li>
<p>Include the <code>infinispan-bom</code> in a <code>dependencyManagement</code> section.</p>
<div class="paragraph">
<p>The Bill Of Materials (BOM) controls dependency versions, which avoids version
conflicts and means you do not need to set the version for each Infinispan
artifact you add as a dependency to your project.</p>
</div>
</li>
<li>
<p>Save and close <code>pom.xml</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example shows the Infinispan version and BOM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
  <span class="tag">&lt;version.infinispan&gt;</span>13.0.4.Final<span class="tag">&lt;/version.infinispan&gt;</span>
<span class="tag">&lt;/properties&gt;</span>

<span class="tag">&lt;dependencyManagement&gt;</span>
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>infinispan-bom<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>${version.infinispan}<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
      <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Next Steps</div>
<p>Add Infinispan artifacts as dependencies to your <code>pom.xml</code> as required.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-embedded-caches"><a class="anchor" href="#creating-embedded-caches"></a>2. Creating embedded caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides an <code>EmbeddedCacheManager</code> API that lets you control both the Cache Manager and embedded cache lifecycles programmatically.</p>
</div>
<div class="sect2">
<h3 id="installing-embedded_creating-embedded-caches"><a class="anchor" href="#installing-embedded_creating-embedded-caches"></a>2.1. Adding Infinispan to your project</h3>
<div class="paragraph">
<p>Add Infinispan to your project to create embedded caches in your applications.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure your project to get Infinispan artifacts from the Maven repository.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add the <code>infinispan-core</code> artifact as a dependency in your <code>pom.xml</code> as
follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>infinispan-core<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-embedded-caches_creating-embedded-caches"><a class="anchor" href="#configuring-embedded-caches_creating-embedded-caches"></a>2.2. Configuring embedded caches</h3>
<div class="paragraph">
<p>Infinispan provides a <code>GlobalConfigurationBuilder</code> API that controls the cache manager and a <code>ConfigurationBuilder</code> API that configures embedded caches.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add the <code>infinispan-core</code> artifact as a dependency in your <code>pom.xml</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Initialize the default cache manager so you can add embedded caches.</p>
</li>
<li>
<p>Add at least one embedded cache with the <code>ConfigurationBuilder</code> API.</p>
</li>
<li>
<p>Invoke the <code>getOrCreateCache()</code> method that either creates embedded caches on all nodes in the cluster or returns caches that already exist.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Set up a clustered cache manager.</span>
GlobalConfigurationBuilder global = GlobalConfigurationBuilder.defaultClusteredBuilder();
<span class="comment">// Initialize the default cache manager.</span>
DefaultCacheManager cacheManager = <span class="keyword">new</span> DefaultCacheManager(global.build());
<span class="comment">// Create a distributed cache with synchronous replication.</span>
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
                     builder.clustering().cacheMode(CacheMode.DIST_SYNC);
<span class="comment">// Obtain a volatile cache.</span>
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheManager.administration().withFlags(CacheContainerAdmin.AdminFlag.VOLATILE).getOrCreateCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">myCache</span><span class="delimiter">&quot;</span></span>, builder.build());</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/manager/EmbeddedCacheManager.html">EmbeddedCacheManager</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/global/package-summary.html">EmbeddedCacheManager Configuration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/global/GlobalConfiguration.html">org.infinispan.configuration.global.GlobalConfiguration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/cache/ConfigurationBuilder.html">org.infinispan.configuration.cache.ConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="statistics-jmx"><a class="anchor" href="#statistics-jmx"></a>3. Enabling and configuring Infinispan statistics and JMX monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan can provide Cache Manager and cache statistics as well as export JMX MBeans.</p>
</div>
<div class="sect2">
<h3 id="enabling-statistics-embedded_statistics-jmx"><a class="anchor" href="#enabling-statistics-embedded_statistics-jmx"></a>3.1. Enabling statistics in embedded caches</h3>
<div class="paragraph">
<p>Configure Infinispan to export statistics for the cache manager and embedded caches.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>statistics="true"</code> attribute or the <code>.statistics(true)</code> method.</p>
</li>
<li>
<p>Save and close your Infinispan configuration.</p>
</li>
</ol>
</div>
<h4 id="embedded_cache_statistics" class="discrete">Embedded cache statistics</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;replicated-cache</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">GlobalConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfigurationBuilder global = GlobalConfigurationBuilder.defaultClusteredBuilder().cacheContainer().statistics(<span class="predefined-constant">true</span>);
DefaultCacheManager cacheManager = <span class="keyword">new</span> DefaultCacheManager(global.build());

<span class="predefined-type">Configuration</span> builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.statistics().enable();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-metrics_statistics-jmx"><a class="anchor" href="#configuring-metrics_statistics-jmx"></a>3.2. Configuring Infinispan metrics</h3>
<div class="paragraph">
<p>Infinispan generates metrics that are compatible with the MicroProfile Metrics API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gauges provide values such as the average number of nanoseconds for write operations or JVM uptime.</p>
</li>
<li>
<p>Histograms provide details about operation execution times such as read,
write, and remove times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Infinispan generates gauges when you enable statistics but you can also configure it to generate histograms.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>metrics</code> element or object to the cache container.</p>
</li>
<li>
<p>Enable or disable gauges with the <code>gauges</code> attribute or field.</p>
</li>
<li>
<p>Enable or disable histograms with the <code>histograms</code> attribute or field.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="metrics_configuration" class="discrete">Metrics configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;metrics</span> <span class="attribute-name">gauges</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">histograms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">metrics</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">gauges</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">histograms</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">metrics</span>:
      <span class="key">gauges</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">histograms</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">GlobalConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder()
  <span class="comment">//Computes and collects statistics for the Cache Manager.</span>
  .statistics().enable()
  <span class="comment">//Exports collected statistics as gauge and histogram metrics.</span>
  .metrics().gauges(<span class="predefined-constant">true</span>).histograms(<span class="predefined-constant">true</span>)
  .build();</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>For embedded caches, you must add the necessary MicroProfile API and provider JARs to your classpath to export Infinispan metrics.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/eclipse/microprofile-metrics/blob/master/README.adoc">Eclipse MicroProfile Metrics</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jmx_statistics-jmx"><a class="anchor" href="#enabling-jmx_statistics-jmx"></a>3.3. Registering JMX MBeans</h3>
<div class="paragraph">
<p>Infinispan can register JMX MBeans that you can use to collect statistics and
perform administrative operations.
You must also enable statistics otherwise Infinispan provides <code>0</code> values for all statistic attributes in JMX MBeans.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>jmx</code> element or object to the cache container and specify <code>true</code> as the value for the <code>enabled</code> attribute or field.</p>
</li>
<li>
<p>Add the <code>domain</code> attribute or field and specify the domain where JMX MBeans are exposed, if required.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="jmx_configuration" class="discrete">JMX configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jmx</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">domain</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">jmx</span>:
      <span class="key">enabled</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">domain</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">GlobalConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfiguration global = GlobalConfigurationBuilder.defaultClusteredBuilder()
   .jmx().enable()
   .domain(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mydomain</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="enabling-jmx-port_statistics-jmx"><a class="anchor" href="#enabling-jmx-port_statistics-jmx"></a>3.3.1. Enabling JMX remote ports</h4>
<div class="paragraph">
<p>Provide unique remote JMX ports to expose Infinispan MBeans through connections in JMXServiceURL format.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pass the following system properties to Infinispan at startup:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=9999
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jmx-mbeans_statistics-jmx"><a class="anchor" href="#jmx-mbeans_statistics-jmx"></a>3.3.2. Infinispan MBeans</h4>
<div class="paragraph">
<p>Infinispan exposes JMX MBeans that represent manageable resources.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan:type=Cache</code></dt>
<dd>
<p>Attributes and operations available for cache instances.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan:type=CacheManager</code></dt>
<dd>
<p>Attributes and operations available for cache managers, including Infinispan cache and cluster health statistics.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For a complete list of available JMX MBeans along with descriptions and
available operations and attributes, see the <em>Infinispan JMX Components</em>
documentation.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/jmxComponents.html">Infinispan JMX Components</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-jmx-mbean-servers-statistics-jmx"><a class="anchor" href="#registering-jmx-mbean-servers-statistics-jmx"></a>3.3.3. Registering MBeans in custom MBean servers</h4>
<div class="paragraph">
<p>Infinispan includes an <code>MBeanServerLookup</code> interface that you can use to
register MBeans in custom MBeanServer instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an implementation of <code>MBeanServerLookup</code> so that the <code>getMBeanServer()</code> method returns the custom MBeanServer instance.</p>
</li>
<li>
<p>Configure Infinispan to register JMX MBeans.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>mbean-server-lookup</code> attribute or field to the JMX configuration for the cache manager.</p>
</li>
<li>
<p>Specify fully qualified name (FQN) of your <code>MBeanServerLookup</code> implementation.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h5 id="jmx_mbean_server_lookup_configuration" class="discrete">JMX MBean server lookup configuration</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">mbean-server-lookup</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jmx</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">domain</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">mbean-server-lookup</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">jmx</span>:
      <span class="key">enabled</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">domain</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
      <span class="key">mbeanServerLookup</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">GlobalConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">GlobalConfiguration global = GlobalConfigurationBuilder.defaultClusteredBuilder()
   .jmx().enable()
   .domain(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mydomain</span><span class="delimiter">&quot;</span></span>)
   .mBeanServerLookup(<span class="keyword">new</span> com.acme.MyMBeanServerLookup());</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster-transport"><a class="anchor" href="#cluster-transport"></a>4. Setting up Infinispan cluster transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan requires a transport layer so nodes can automatically join and leave clusters.
The transport layer also enables Infinispan nodes to replicate or distribute data across the network and perform operations such as re-balancing and state transfer.</p>
</div>
<div class="sect2">
<h3 id="default-jgroups-stacks_cluster-transport"><a class="anchor" href="#default-jgroups-stacks_cluster-transport"></a>4.1. Default JGroups stacks</h3>
<div class="paragraph">
<p>Infinispan provides default JGroups stack files, <code>default-jgroups-*.xml</code>, in the <code>default-configs</code> directory inside the <code>infinispan-core-13.0.4.Final.jar</code> file.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File name</th>
<th class="tableblock halign-left valign-top">Stack name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-udp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>udp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses UDP for transport and UDP multicast for discovery. Suitable for larger clusters (over 100 nodes) or if you are using replicated caches or invalidation mode. Minimizes the number of open sockets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-tcp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and the <code>MPING</code> protocol for discovery, which uses
<code>UDP</code> multicast. Suitable for smaller clusters (under 100 nodes) <em>only if</em> you are using distributed caches because TCP is more efficient than UDP as a point-to-point protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-kubernetes.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>DNS_PING</code> for discovery. Suitable for Kubernetes and Red Hat OpenShift nodes where UDP multicast is not always available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ec2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>NATIVE_S3_PING</code> for discovery. Suitable for Amazon EC2 nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>GOOGLE_PING2</code> for discovery. Suitable for Google Cloud Platform nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>AZURE_PING</code> for discovery. Suitable for Microsoft Azure nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#protlist">JGroups Protocols</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cluster-discovery-protocols_cluster-transport"><a class="anchor" href="#cluster-discovery-protocols_cluster-transport"></a>4.2. Cluster discovery protocols</h3>
<div class="paragraph">
<p>Infinispan supports different protocols that allow nodes to automatically find each other on the network and form clusters.</p>
</div>
<div class="paragraph">
<p>There are two types of discovery mechanisms that Infinispan can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generic discovery protocols that work on most networks and do not rely on external services.</p>
</li>
<li>
<p>Discovery protocols that rely on external services to store and retrieve topology information for Infinispan clusters.<br>
For instance the DNS_PING protocol performs discovery through DNS server records.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Running Infinispan on hosted platforms requires using discovery mechanisms that are adapted to network constraints that individual cloud providers impose.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#DiscoveryProtocols">JGroups Discovery Protocols</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="discovery-ping_cluster-transport"><a class="anchor" href="#discovery-ping_cluster-transport"></a>4.2.1. PING</h4>
<div class="paragraph">
<p>PING, or UDPPING is a generic JGroups discovery mechanism that uses dynamic multicasting with the UDP protocol.</p>
</div>
<div class="paragraph">
<p>When joining, nodes send PING requests to an IP multicast address to discover other nodes already in the Infinispan cluster.
Each node responds to the PING request with a packet that contains the address of the coordinator node and its own address. C=coordinator’s address and A=own address.
If no nodes respond to the PING request, the joining node becomes the coordinator node in a new cluster.</p>
</div>
<div class="listingblock">
<div class="title">PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;PING</span> <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#PING">JGroups PING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-tcpping_cluster-transport"><a class="anchor" href="#discovery-tcpping_cluster-transport"></a>4.2.2. TCPPING</h4>
<div class="paragraph">
<p>TCPPING is a generic JGroups discovery mechanism that uses a list of static addresses for cluster members.</p>
</div>
<div class="paragraph">
<p>With TCPPING, you manually specify the IP address or hostname of each node in the Infinispan cluster as part of the JGroups stack, rather than letting nodes discover each other dynamically.</p>
</div>
<div class="listingblock">
<div class="title">TCPPING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;TCPPING</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.tcpping.initial_hosts:hostname1[port1],hostname2[port2]}</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="attribute-name">num_initial_members</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#TCPPING_Prot">JGroups TCPPING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-mping_cluster-transport"><a class="anchor" href="#discovery-mping_cluster-transport"></a>4.2.3. MPING</h4>
<div class="paragraph">
<p>MPING uses IP multicast to discover the initial membership of Infinispan clusters.</p>
</div>
<div class="paragraph">
<p>You can use MPING to replace TCPPING discovery with TCP stacks and use multicasing for discovery instead of static lists of initial hosts.
However, you can also use MPING with UDP stacks.</p>
</div>
<div class="listingblock">
<div class="title">MPING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;MPING</span> <span class="attribute-name">mcast_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mcast_addr:228.6.7.8}</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">mcast_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mcast_port:46655}</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">ip_ttl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.ip_ttl:2}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#MPING">JGroups MPING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-tcp-gossip_cluster-transport"><a class="anchor" href="#discovery-tcp-gossip_cluster-transport"></a>4.2.4. TCPGOSSIP</h4>
<div class="paragraph">
<p>Gossip routers provide a centralized location on the network from which your
Infinispan cluster can retrieve addresses of other nodes.</p>
</div>
<div class="paragraph">
<p>You inject the address (<code>IP:PORT</code>) of the Gossip router into Infinispan nodes as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass the address as a system property to the JVM; for example, <code>-DGossipRouterAddress="10.10.2.4[12001]"</code>.</p>
</li>
<li>
<p>Reference that system property in the JGroups configuration file.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Gossip router configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;TCPGOSSIP</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${GossipRouterAddress}</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">num_initial_members</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#TCPGOSSIP_Prot">JGroups Gossip Router</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-jdbcping_cluster-transport"><a class="anchor" href="#discovery-jdbcping_cluster-transport"></a>4.2.5. JDBC_PING</h4>
<div class="paragraph">
<p>JDBC_PING uses shared databases to store information about Infinispan clusters.
This protocol supports any database that can use a JDBC connection.</p>
</div>
<div class="paragraph">
<p>Nodes write their IP addresses to the shared database so joining nodes can find the Infinispan cluster on the network.
When nodes leave Infinispan clusters, they delete their IP addresses from the shared database.</p>
</div>
<div class="listingblock">
<div class="title">JDBC_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;JDBC_PING</span> <span class="attribute-name">connection_url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/database_name</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connection_username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connection_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connection_driver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Add the appropriate JDBC driver to the classpath so Infinispan can use JDBC_PING.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#_jdbc_ping">JDBC_PING</a></p>
</li>
<li>
<p><a href="http://community.jboss.org/wiki/JDBCPING">JDBC_PING Wiki</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-dns-ping_cluster-transport"><a class="anchor" href="#discovery-dns-ping_cluster-transport"></a>4.2.6. DNS_PING</h4>
<div class="paragraph">
<p>JGroups DNS_PING queries DNS servers to discover Infinispan cluster members
in Kubernetes environments such as OKD and Red Hat OpenShift.</p>
</div>
<div class="listingblock">
<div class="title">DNS_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dns.DNS_PING</span> <span class="attribute-name">dns_query</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myservice.myproject.svc.cluster.local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#_dns_ping">JGroups DNS_PING</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a> (Kubernetes documentation for adding DNS entries)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-cloud-discovery-protocols_cluster-transport"><a class="anchor" href="#jgroups-cloud-discovery-protocols_cluster-transport"></a>4.2.7. Cloud discovery protocols</h4>
<div class="paragraph">
<p>Infinispan includes default JGroups stacks that use discovery protocol implementations that are specific to cloud providers.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Discovery protocol</th>
<th class="tableblock halign-left valign-top">Default stack file</th>
<th class="tableblock halign-left valign-top">Artifact</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NATIVE_S3_PING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.aws.s3:native-s3-ping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0.0.Final</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GOOGLE_PING2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.google:jgroups-google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0.0.Final</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AZURE_PING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.azure:jgroups-azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.0.Final</code></p></td>
</tr>
</tbody>
</table>
<h5 id="providing_dependencies_for_cloud_discovery_protocols" class="discrete">Providing dependencies for cloud discovery protocols</h5>
<div class="paragraph">
<p>To use <code>NATIVE_S3_PING</code>, <code>GOOGLE_PING2</code>, or <code>AZURE_PING</code> cloud discovery protocols, you need to provide dependent libraries to Infinispan.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add the artifact dependencies to your project <code>pom.xml</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can then configure the cloud discovery protocol as part of a JGroups stack file or with system properties.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/jgroups-extras/native-s3-ping">JGroups NATIVE_S3_PING</a></p>
</li>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-google">JGroups GOOGLE_PING2</a></p>
</li>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-azure">JGroups AZURE_PING</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jgroups-default-stacks_cluster-transport"><a class="anchor" href="#using-jgroups-default-stacks_cluster-transport"></a>4.3. Using the default JGroups stacks</h3>
<div class="paragraph">
<p>Infinispan uses JGroups protocol stacks so nodes can send each other messages on dedicated cluster channels.</p>
</div>
<div class="paragraph">
<p>Infinispan provides preconfigured JGroups stacks for <code>UDP</code> and <code>TCP</code> protocols.
You can use these default stacks as a starting point for building custom cluster transport configuration that is optimized for your network requirements.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following to use one of the default JGroups stacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>stack</code> attribute in your <code>infinispan.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Use the default UDP stack for cluster transport. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>addProperty()</code> method to set the JGroups stack file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder().transport()
        .defaultTransport()
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> .clusterName(<span class="string"><span class="delimiter">&quot;</span><span class="content">qa-cluster</span><span class="delimiter">&quot;</span></span>)
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">//Uses the default-jgroups-udp.xml stack for cluster transport.</span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> .addProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">configurationFile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">default-jgroups-udp.xml</span><span class="delimiter">&quot;</span></span>)
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> .build();</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan logs the following message to indicate which stack it uses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack udp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-jgroups-stacks_cluster-transport"><a class="anchor" href="#customizing-jgroups-stacks_cluster-transport"></a>4.4. Customizing JGroups stacks</h3>
<div class="paragraph">
<p>Adjust and tune properties to create a cluster transport configuration that works for your network requirements.</p>
</div>
<div class="paragraph">
<p>Infinispan provides attributes that let you extend the default JGroups stacks for easier configuration.
You can inherit properties from the default stacks while combining, removing, and replacing other properties.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new JGroups stack declaration in your <code>infinispan.xml</code> file.</p>
</li>
<li>
<p>Add the <code>extends</code> attribute and specify a JGroups stack to inherit properties from.</p>
</li>
<li>
<p>Use the <code>stack.combine</code> attribute to modify properties for protocols configured in the inherited stack.</p>
</li>
<li>
<p>Use the <code>stack.position</code> attribute to define the location for your custom stack.</p>
</li>
<li>
<p>Specify the stack name as the value for the <code>stack</code> attribute in the <code>transport</code> configuration.</p>
<div class="paragraph">
<p>For example, you might evaluate using a Gossip router and symmetric encryption with the default TCP stack as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a custom JGroups stack named &quot;my-stack&quot;. --&gt;</span>
    <span class="comment">&lt;!-- Inherits properties from the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-stack</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Uses TCPGOSSIP as the discovery mechanism instead of MPING --&gt;</span>
      <span class="tag">&lt;TCPGOSSIP</span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.tunnel.gossip_router_hosts:localhost[12001]}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPLACE</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Removes the FD_SOCK protocol from the stack. --&gt;</span>
      <span class="tag">&lt;FD_SOCK</span> <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Modifies the timeout value for the VERIFY_SUSPECT protocol. --&gt;</span>
      <span class="tag">&lt;VERIFY_SUSPECT</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Adds SYM_ENCRYPT to the stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SYM_ENCRYPT</span> <span class="attribute-name">sym_algorithm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AES</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mykeystore.p12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">store_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">key_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
    <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Uses &quot;my-stack&quot; for cluster transport. --&gt;</span>
      <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-stack</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Check Infinispan logs to ensure it uses the stack.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack my-stack</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="jgroups-inheritance-attributes_cluster-transport"><a class="anchor" href="#jgroups-inheritance-attributes_cluster-transport"></a>4.4.1. Inheritance attributes</h4>
<div class="paragraph">
<p>When you extend a JGroups stack, inheritance attributes let you adjust protocols and properties in the stack you are extending.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>stack.position</code> specifies protocols to modify.</p>
</li>
<li>
<p><code>stack.combine</code> uses the following values to extend JGroups stacks:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMBINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides protocol properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPLACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaces protocols.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a protocol into the stack after another protocol.
Does not affect the protocol that you specify as the insertion point.</p>
<p class="tableblock">Protocols in JGroups stacks affect each other based on their location in the stack.
For example, you should put a protocol such as <code>NAKACK2</code> after the <code>SYM_ENCRYPT</code> or <code>ASYM_ENCRYPT</code> protocol so that <code>NAKACK2</code> is secured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a protocols into the stack before another protocol.
Affects the protocol that you specify as the insertion point.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REMOVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes protocols from the stack.</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jgroups-system-properties_cluster-transport"><a class="anchor" href="#using-jgroups-system-properties_cluster-transport"></a>4.5. Using JGroups system properties</h3>
<div class="paragraph">
<p>Pass system properties to Infinispan at startup to tune cluster transport.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use <code>-D&lt;property-name&gt;=&lt;property-value&gt;</code> arguments to set JGroups system properties as required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, set a custom bind port and IP address as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ java -cp ... -Djgroups.bind.port=1234 -Djgroups.bind.address=192.0.2.0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you embed Infinispan clusters in clustered WildFly applications, JGroups system properties can clash or override each other.</p>
</div>
<div class="paragraph">
<p>For example, you do not set a unique bind address for either your Infinispan cluster or your WildFly application.
In this case both Infinispan and your WildFly application use the JGroups default property and attempt to form clusters using the same bind address.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="jgroups-system-properties_cluster-transport"><a class="anchor" href="#jgroups-system-properties_cluster-transport"></a>4.5.1. Cluster transport properties</h4>
<div class="paragraph">
<p>Use the following properties to customize JGroups cluster transport.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.bind.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind address for cluster transport.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SITE_LOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.bind.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind port for the socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.mcast_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for multicast, both discovery and inter-cluster communication. The IP address must be a valid "class D" address that is suitable for IP multicast.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>228.6.7.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.mcast_port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the multicast socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.ip_ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time-to-live (TTL) for IP multicast packets. The value defines the number of network hops a packet can make before it is dropped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_pool.min_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of threads for the thread pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_pool.max_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of threads for the thread pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.join_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of milliseconds to wait for join requests to succeed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_dumps_threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times a thread pool needs to be full before a thread dump is logged.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#SystemProperties">JGroups system properties</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#protlist">JGroups protocol list</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-extras-properties_cluster-transport"><a class="anchor" href="#jgroups-extras-properties_cluster-transport"></a>4.5.2. System properties for cloud discovery protocols</h4>
<div class="paragraph">
<p>Use the following properties to configure JGroups discovery protocols for hosted platforms.</p>
</div>
<div class="sect4">
<h5 id="amazon_ec2"><a class="anchor" href="#amazon_ec2"></a>Amazon EC2</h5>
<div class="paragraph">
<p>System properties for configuring <code>NATIVE_S3_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.region_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 region.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.bucket_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 bucket. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="google_cloud_platform"><a class="anchor" href="#google_cloud_platform"></a>Google Cloud Platform</h5>
<div class="paragraph">
<p>System properties for configuring <code>GOOGLE_PING2</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.google.bucket_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Google Compute Engine bucket. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="azure"><a class="anchor" href="#azure"></a>Azure</h5>
<div class="paragraph">
<p>System properties for <code>AZURE_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.storage_account_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure storage account. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.storage_access_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure storage access key.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.container</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid DNS name of the container that stores ping information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="kubernetes"><a class="anchor" href="#kubernetes"></a>Kubernetes</h5>
<div class="paragraph">
<p>System properties for <code>DNS_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.dns.query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DNS record that returns cluster members.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-inline-jgroups-stacks_cluster-transport"><a class="anchor" href="#using-inline-jgroups-stacks_cluster-transport"></a>4.6. Using inline JGroups stacks</h3>
<div class="paragraph">
<p>You can insert complete JGroups stack definitions into <code>infinispan.xml</code> files.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Embed a custom JGroups stack declaration in your <code>infinispan.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="comment">&lt;!-- Contains one or more JGroups stack definitions. --&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Defines a custom JGroups stack named &quot;prod&quot;. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">recv_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">send_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">640000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;MPING</span> <span class="attribute-name">break_on_coord_rsp</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">mcast_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mping.mcast_addr:228.2.4.6}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">mcast_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mping.mcast_port:43366}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">ip_ttl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.ip_ttl:2}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;MERGE3</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FD_SOCK</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FD_ALL</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout_check_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;VERIFY_SUSPECT</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.NAKACK2</span> <span class="attribute-name">use_mcast_xmit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_num_rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">xmit_table_msgs_per_row</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_max_compaction_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;UNICAST3</span> <span class="attribute-name">xmit_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_num_rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_msgs_per_row</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmit_table_max_compaction_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.STABLE</span> <span class="attribute-name">desired_avg_gossip</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max_bytes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1M</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.GMS</span> <span class="attribute-name">print_local_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">join_timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.join_timeout:2000}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;UFC</span> <span class="attribute-name">max_credits</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4m</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min_threshold</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;MFC</span> <span class="attribute-name">max_credits</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4m</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min_threshold</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FRAG3</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Uses &quot;prod&quot; for cluster transport. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-external-jgroups-stacks_cluster-transport"><a class="anchor" href="#using-external-jgroups-stacks_cluster-transport"></a>4.7. Using external JGroups stacks</h3>
<div class="paragraph">
<p>Reference external files that define custom JGroups stacks in <code>infinispan.xml</code> files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Put custom JGroups stack files on the application classpath.</p>
<div class="paragraph">
<p>Alternatively you can specify an absolute path when you declare the external stack file.</p>
</div>
</li>
<li>
<p>Reference the external stack file with the <code>stack-file</code> element.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
     <span class="comment">&lt;!-- Creates a &quot;prod-tcp&quot; stack that references an external file. --&gt;</span>
     <span class="tag">&lt;stack-file</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-jgroups-tcp.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Use the &quot;prod-tcp&quot; stack for cluster transport. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-tcp</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
  <span class="comment">&lt;!-- Cache configuration goes here. --&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also use the <code>addProperty()</code> method in the <code>TransportConfigurationBuilder</code> class to specify a custom JGroups stack file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfiguration globalConfig = <span class="keyword">new</span> GlobalConfigurationBuilder().transport()
        .defaultTransport()
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> .clusterName(<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-cluster</span><span class="delimiter">&quot;</span></span>)
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">//Uses a custom JGroups stack for cluster transport.</span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> .addProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">configurationFile</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">my-jgroups-udp.xml</span><span class="delimiter">&quot;</span></span>)
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>my-jgroups-udp.xml</code> references a UDP stack with custom properties such as the following:</p>
</div>
<div class="listingblock">
<div class="title">Custom UDP stack example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;config</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups http://www.jgroups.org/schema/jgroups-4.2.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;UDP</span> <span class="attribute-name">bind_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.bind_addr:127.0.0.1}</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">mcast_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.mcast_addr:192.0.2.0}</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">mcast_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.mcast_port:46655}</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">tos</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">ucast_recv_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20000000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">ucast_send_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">640000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">mcast_recv_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25000000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">mcast_send_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">640000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">max_bundle_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">64000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">ip_ttl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.ip_ttl:2}</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">enable_diagnostics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_naming_pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_pool.enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_pool.min_threads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_pool.max_threads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">thread_pool.keep_alive_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Other JGroups stack configuration goes here. --&gt;</span>
<span class="tag">&lt;/config&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/global/TransportConfigurationBuilder.html">org.infinispan.configuration.global.TransportConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-custom-jchannels_cluster-transport"><a class="anchor" href="#using-custom-jchannels_cluster-transport"></a>4.8. Using custom JChannels</h3>
<div class="paragraph">
<p>Construct custom JGroups JChannels as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfigurationBuilder global = <span class="keyword">new</span> GlobalConfigurationBuilder();
JChannel jchannel = <span class="keyword">new</span> JChannel();
<span class="comment">// Configure the jchannel as needed.</span>
JGroupsTransport transport = <span class="keyword">new</span> JGroupsTransport(jchannel);
global.transport().transport(transport);
<span class="keyword">new</span> DefaultCacheManager(global.build());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan cannot use custom JChannels that are already connected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#JChannel">JGroups JChannel</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="secure-cluster-transport"><a class="anchor" href="#secure-cluster-transport"></a>4.9. Encrypting cluster transport</h3>
<div class="paragraph">
<p>Secure cluster transport so that nodes communicate with encrypted messages.
You can also configure Infinispan clusters to perform certificate authentication so that only nodes with valid identities can join.</p>
</div>
<div class="sect3">
<h4 id="jgroups-encryption-protocols_secure-cluster-transport"><a class="anchor" href="#jgroups-encryption-protocols_secure-cluster-transport"></a>4.9.1. JGroups encryption protocols</h4>
<div class="paragraph">
<p>To secure cluster traffic, you can configure Infinispan nodes to encrypt JGroups message payloads with secret keys.</p>
</div>
<div class="paragraph">
<p>Infinispan nodes can obtain secret keys from either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The coordinator node (asymmetric encryption).</p>
</li>
<li>
<p>A shared keystore (symmetric encryption).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from coordinator nodes</div>
<p>You configure asymmetric encryption by adding the <code>ASYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to generate and distribute secret keys.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.
This protects your cluster from man-in-the-middle (MitM) attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Asymmetric encryption secures cluster traffic as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first node in the Infinispan cluster, the coordinator node, generates a secret key.</p>
</li>
<li>
<p>A joining node performs certificate authentication with the coordinator to mutually verify identity.</p>
</li>
<li>
<p>The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.</p>
</li>
<li>
<p>The coordinator node encrypts the secret key with the public key and returns it to the joining node.</p>
</li>
<li>
<p>The joining node decrypts and installs the secret key.</p>
</li>
<li>
<p>The node joins the cluster, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from shared keystores</div>
<p>You configure symmetric encryption by adding the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to obtain secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Nodes install the secret key from a keystore on the Infinispan classpath at startup.</p>
</li>
<li>
<p>Node join clusters, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Comparison of asymmetric and symmetric encryption</div>
<p><code>ASYM_ENCRYPT</code> with certificate authentication provides an additional layer of encryption in comparison with <code>SYM_ENCRYPT</code>.
You provide keystores that encrypt the requests to coordinator nodes for the secret key.
Infinispan automatically generates that secret key and handles cluster traffic, while letting you specify when to generate secret keys.
For example, you can configure clusters to generate new secret keys when nodes leave.
This ensures that nodes cannot bypass certificate authentication and join with old keys.</p>
</div>
<div class="paragraph">
<p><code>SYM_ENCRYPT</code>, on the other hand, is faster than <code>ASYM_ENCRYPT</code> because nodes do not need to exchange keys with the cluster coordinator.
A potential drawback to <code>SYM_ENCRYPT</code> is that there is no configuration to automatically generate new secret keys when cluster membership changes.
Users are responsible for generating and distributing the secret keys that nodes use to encrypt cluster traffic.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jgroups-asym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-asym-encrypt_secure-cluster-transport"></a>4.9.2. Securing cluster transport with asymmetric encryption</h4>
<div class="paragraph">
<p>Configure Infinispan clusters to generate and distribute secret keys that encrypt JGroups messages.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore with certificate chains that enables Infinispan to verify node identity.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SSL_KEY_EXCHANGE</code> and <code>ASYM_ENCRYPT</code> protocols to a JGroups stack in your Infinispan configuration, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a secure JGroups stack named &quot;encrypt-tcp&quot; that extends the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Adds a keystore that nodes use to perform certificate authentication. --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert SSL_KEY_EXCHANGE into the default TCP stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SSL_KEY_EXCHANGE</span> <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mykeystore.jks</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">keystore_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Configures ASYM_ENCRYPT --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert ASYM_ENCRYPT into the default TCP stack before pbcast.NAKACK2. --&gt;</span>
      <span class="comment">&lt;!-- The use_external_key_exchange = &quot;true&quot; attribute configures nodes to use the `SSL_KEY_EXCHANGE` protocol for certificate authentication. --&gt;</span>
      <span class="tag">&lt;ASYM_ENCRYPT</span> <span class="attribute-name">asym_keylength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2048</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">asym_algorithm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RSA</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">change_key_on_coord_leave</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">change_key_on_leave</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">use_external_key_exchange</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_BEFORE</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Configures the cluster to use the JGroups stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>ASYM_ENCRYPT</code> and can obtain the secret key from the coordinator node.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.jgroups.protocols.ASYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html">JGroups 4 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-4.2.xsd">JGroups 4.2 Schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jgroups-sym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-sym-encrypt_secure-cluster-transport"></a>4.9.3. Securing cluster transport with symmetric encryption</h4>
<div class="paragraph">
<p>Configure Infinispan clusters to encrypt JGroups messages with secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore that contains a secret key.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a secure JGroups stack named &quot;encrypt-tcp&quot; that extends the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Adds a keystore from which nodes obtain secret keys. --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert SYM_ENCRYPT into the default TCP stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SYM_ENCRYPT</span> <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKeystore.p12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">store_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">key_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Configures the cluster to use the JGroups stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>SYM_ENCRYPT</code> and can obtain the secret key from the shared keystore.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[org.jgroups.protocols.SYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html">JGroups 4 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-4.2.xsd">JGroups 4.2 Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-ports_cluster-transport"><a class="anchor" href="#jgroups-ports_cluster-transport"></a>4.10. TCP and UDP ports for cluster traffic</h3>
<div class="paragraph">
<p>Infinispan uses the following ports for cluster transport messages:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP/UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster bind port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups multicast</p></td>
</tr>
</tbody>
</table>
<h4 id="cross_site_replication" class="discrete">Cross-site replication</h4>
<div class="paragraph">
<p>Infinispan uses the following ports for the JGroups RELAY2 protocol:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>7900</code></dt>
<dd>
<p>For Infinispan clusters running on Kubernetes.</p>
</dd>
<dt class="hdlist1"><code>7800</code></dt>
<dd>
<p>If using UDP for traffic between nodes and TCP for traffic between clusters.</p>
</dd>
<dt class="hdlist1"><code>7801</code></dt>
<dd>
<p>If using TCP for traffic between nodes and TCP for traffic between clusters.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-17 14:46:55 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>