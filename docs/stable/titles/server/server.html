<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Guide to Infinispan Server</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPD7V946LB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GPD7V946LB');
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<link rel="stylesheet" href="/assets/css/clipboard.css">
<link rel="stylesheet" href="/assets/css/cookieconsent.css">
<link rel="shortcut icon" type="image/png" href="/favicon.ico" >
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
<script src="/assets/javascript/copy.js" type="text/javascript"></script>
<script src="/assets/javascript/cookieconsent.umd.js" type="text/javascript"></script>
<script src="/assets/javascript/cookieconsent.config.js" type="module"></script>
<script src="../../js/js.js"></script>
<link rel="canonical" href="https://infinispan.org/docs/stable/titles/server/server.html">
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Guide to Infinispan Server</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#server-getting-started">1. Getting started with Infinispan Server</a>
<ul class="sectlevel2">
<li><a href="#server-requirements_server-getting-started">1.1. Infinispan Server requirements</a></li>
<li><a href="#downloading-server-distributions_server-getting-started">1.2. Downloading Infinispan Server distributions</a></li>
<li><a href="#installing-servers_server-getting-started">1.3. Installing Infinispan Server</a></li>
<li><a href="#jvm-settings-for-server_server-getting-started">1.4. JVM settings for Infinispan</a></li>
<li><a href="#starting-servers_server-getting-started">1.5. Starting Infinispan Server</a></li>
<li><a href="#passing-server-configuration-startup_server-getting-started">1.6. Passing Infinispan Server configuration at startup</a></li>
<li><a href="#creating-users_server-getting-started">1.7. Creating Infinispan users</a>
<ul class="sectlevel3">
<li><a href="#granting-roles-to-users_server-getting-started">1.7.1. Granting roles to users</a>
<ul class="sectlevel4">
<li><a href="#adding-users-to-groups_server-getting-started">Adding users to groups</a></li>
</ul>
</li>
<li><a href="#default-user-roles_server-getting-started">1.7.2. Infinispan user roles and permissions</a></li>
</ul>
</li>
<li><a href="#verifying-cluster-views_server-getting-started">1.8. Verifying cluster views</a></li>
<li><a href="#shutting-down-servers_server-getting-started">1.9. Shutting down Infinispan Server</a>
<ul class="sectlevel3">
<li><a href="#cluster-restarts_server-getting-started">1.9.1. Shutdown and restart of Infinispan clusters</a></li>
</ul>
</li>
<li><a href="#server-directory-structure_server-getting-started">1.10. Infinispan Server installation directory structure</a>
<ul class="sectlevel3">
<li><a href="#server_root_directory">1.10.1. Server root directory</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server-interfaces">2. Network interfaces and socket bindings</a>
<ul class="sectlevel2">
<li><a href="#network-interfaces_server-interfaces">2.1. Network interfaces</a>
<ul class="sectlevel3">
<li><a href="#match-fallback-strategies_server-interfaces">2.1.1. Match and fallback strategies</a></li>
</ul>
</li>
<li><a href="#socket-bindings_server-interfaces">2.2. Socket bindings</a></li>
<li><a href="#changing-bind-address_server-interfaces">2.3. Changing the bind address for Infinispan Server</a>
<ul class="sectlevel3">
<li><a href="#listening-on-all-addresses_server-interfaces">2.3.1. Listening on all addresses</a></li>
</ul>
</li>
<li><a href="#server-ports-protocols_server-interfaces">2.4. Infinispan Server ports and protocols</a>
<ul class="sectlevel3">
<li><a href="#configuring-firewalls_server-interfaces">2.4.1. Configuring network firewalls for Infinispan traffic</a></li>
</ul>
</li>
<li><a href="#specifying-port-offsets_server-interfaces">2.5. Specifying port offsets</a></li>
</ul>
</li>
<li><a href="#server-endpoints">3. Infinispan Server endpoints</a>
<ul class="sectlevel2">
<li><a href="#server-endpoints_server-endpoints">3.1. Infinispan Server endpoints</a>
<ul class="sectlevel3">
<li><a href="#hot_rod">3.1.1. Hot Rod</a></li>
<li><a href="#rest">3.1.2. REST</a></li>
<li><a href="#resp">3.1.3. RESP</a></li>
<li><a href="#memcached">3.1.4. Memcached</a></li>
<li><a href="#endpoint-protocol-comparison_server-endpoints">3.1.5. Comparison of endpoint protocols</a></li>
<li><a href="#client-server-compatibility_server-endpoints">3.1.6. Hot Rod client compatibility with Infinispan Server</a></li>
</ul>
</li>
<li><a href="#configuring-server-endpoints_server-endpoints">3.2. Configuring Infinispan Server endpoints</a></li>
<li><a href="#endpoint-connectors_server-endpoints">3.3. Endpoint connectors</a></li>
<li><a href="#endpoint-ip-address-filters_server-endpoints">3.4. Endpoint IP address filtering rules</a></li>
<li><a href="#user_tool-server-endpoints">3.5. Inspecting and modifying rules for filtering IP addresses</a></li>
</ul>
</li>
<li><a href="#authentication-mechanisms">4. Endpoint authentication mechanisms</a>
<ul class="sectlevel2">
<li><a href="#server-authentication_endpoint-authentication">4.1. Infinispan Server authentication</a></li>
<li><a href="#configuring-server-authentication_endpoint-authentication">4.2. Configuring Infinispan Server authentication mechanisms</a>
<ul class="sectlevel3">
<li><a href="#disabling-authentication_endpoint-authentication">4.2.1. Disabling authentication</a></li>
</ul>
</li>
<li><a href="#server-endpoint-authentication-mechanisms_endpoint-authentication">4.3. Infinispan Server authentication mechanisms</a>
<ul class="sectlevel3">
<li><a href="#sasl-authentication-mechanisms_endpoint-authentication">4.3.1. SASL authentication mechanisms</a></li>
<li><a href="#sasl-quality-of-protection_endpoint-authentication">4.3.2. SASL quality of protection (QoP)</a></li>
<li><a href="#sasl-policies-hot-rod-authentication_endpoint-authentication">4.3.3. SASL policies</a></li>
<li><a href="#rest-authentication-mechanisms_endpoint-authentication">4.3.4. HTTP authentication mechanisms</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security-realms">5. Security realms</a>
<ul class="sectlevel2">
<li><a href="#creating-security-realms_security-realms">5.1. Creating security realms</a></li>
<li><a href="#setting-up-kerberos-identities_security-realms">5.2. Setting up Kerberos identities</a></li>
<li><a href="#property-security-realms_security-realms">5.3. Property realms</a>
<ul class="sectlevel3">
<li><a href="#property_realm_file_structure">5.3.1. Property realm file structure</a></li>
</ul>
</li>
<li><a href="#ldap-security-realms_security-realms">5.4. LDAP realms</a>
<ul class="sectlevel3">
<li><a href="#ldap_connection_properties">5.4.1. LDAP connection properties</a></li>
<li><a href="#ldap_realm_user_authentication_methods">5.4.2. LDAP realm user authentication methods</a></li>
<li><a href="#mapping_user_entries_to_their_associated_groups">5.4.3. Mapping user entries to their associated groups</a></li>
<li><a href="#ldap_realm_configuration_reference">5.4.4. LDAP realm configuration reference</a>
<ul class="sectlevel4">
<li><a href="#ldap-realm-principal-rewriting_security-realms">LDAP realm principal rewriting</a></li>
<li><a href="#ldap_principal_rewriting_configuration_reference">LDAP principal rewriting configuration reference</a></li>
<li><a href="#ldap_user_and_group_mapping_process_with_infinispan">LDAP user and group mapping process with Infinispan</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#token-security-realms_security-realms">5.5. Token realms</a></li>
<li><a href="#trust-store-security-realms_security-realms">5.6. Trust store realms</a></li>
<li><a href="#distributed-security-realms_security-realms">5.7. Distributed security realms</a></li>
<li><a href="#aggregate-security-realms_security-realms">5.8. Aggregate security realms</a>
<ul class="sectlevel3">
<li><a href="#name_rewriters">5.8.1. Name rewriters</a>
<ul class="sectlevel4">
<li><a href="#case_principal_transformer_2">Case Principal Transformer</a></li>
<li><a href="#common_name_principal_transformer_2">Common Name Principal Transformer</a></li>
<li><a href="#regex_principal_transformer_2">Regex Principal Transformer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#caching-security-realms_security-realms">5.9. Security realm caching</a>
<ul class="sectlevel3">
<li><a href="#flushing_realm_caches">5.9.1. Flushing realm caches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuring-encryption">6. Configuring TLS/SSL encryption</a>
<ul class="sectlevel2">
<li><a href="#configuring-server-keystores_endpoint-security">6.1. Configuring Infinispan Server keystores</a>
<ul class="sectlevel3">
<li><a href="#ssltls_certificate_rotation">6.1.1. SSL/TLS Certificate rotation</a></li>
<li><a href="#generating-server-keystores_endpoint-security">6.1.2. Generating Infinispan Server keystores</a></li>
<li><a href="#configuring-ssl-engine_endpoint-security">6.1.3. Configuring TLS versions and cipher suites</a></li>
</ul>
</li>
<li><a href="#configuring-server-fips_endpoint-security">6.2. Configuring Infinispan Server on a system with FIPS 140-2 compliant cryptography</a>
<ul class="sectlevel3">
<li><a href="#configuring_the_pkcs11_cryptographic_provider">6.2.1. Configuring the PKCS11 cryptographic provider</a></li>
<li><a href="#configuring_the_bouncy_castle_fips_cryptographic_provider">6.2.2. Configuring the Bouncy Castle FIPS cryptographic provider</a></li>
</ul>
</li>
<li><a href="#configuring-client-certificate-authentication_endpoint-security">6.3. Configuring client certificate authentication</a></li>
<li><a href="#configuring-client-certificate-authorization_endpoint-security">6.4. Configuring authorization with client certificates</a></li>
</ul>
</li>
<li><a href="#credential-keystores">7. Storing Infinispan Server credentials in keystores</a>
<ul class="sectlevel2">
<li><a href="#setting-up-credential-keystores_credential-keystores">7.1. Setting up credential keystores</a></li>
<li><a href="#securing-passwords-credential-keystores_credential-keystores">7.2. Securing passwords for credential keystores</a></li>
<li><a href="#credential-keystore-configuration_credential-keystores">7.3. Credential keystore configuration</a></li>
<li><a href="#credential-keystore-references_credential-keystores">7.4. Credential keystore references</a></li>
</ul>
</li>
<li><a href="#rbac-remote">8. Configuring user roles and permissions</a>
<ul class="sectlevel2">
<li><a href="#default-user-roles_rbac-remote">8.1. Infinispan user roles and permissions</a>
<ul class="sectlevel3">
<li><a href="#user-permissions_rbac-remote">8.1.1. Permissions</a></li>
<li><a href="#role-mappers_rbac-remote">8.1.2. Role and permission mappers</a>
<ul class="sectlevel4">
<li><a href="#mapping_users_to_roles_and_permissions_in_infinispan">Mapping users to roles and permissions in Infinispan</a></li>
</ul>
</li>
<li><a href="#configuring-role-mappers_rbac-remote">8.1.3. Configuring role mappers</a></li>
</ul>
</li>
<li><a href="#granting-roles-to-users_rbac-remote">8.2. Granting roles to users</a>
<ul class="sectlevel3">
<li><a href="#adding-users-to-groups_rbac-remote">8.2.1. Adding users to groups</a></li>
</ul>
</li>
<li><a href="#creating-custom-roles-dynamically_rbac-remote">8.3. Creating custom roles at runtime</a></li>
<li><a href="#creating-custom-roles-statically_rbac-remote">8.4. Adding custom roles to Cache Manager configuration</a></li>
<li><a href="#configuring-cache-authorization_rbac-remote">8.5. Configuring caches with security authorization</a></li>
<li><a href="#disabling-authorization_rbac-remote">8.6. Disabling security authorization</a></li>
<li><a href="#configuring-acl-cache_rbac-remote">8.7. Configuring the access control list (ACL) cache</a>
<ul class="sectlevel3">
<li><a href="#flushing_acl_caches">8.7.1. Flushing ACL caches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#statistics-jmx">9. Enabling and configuring Infinispan statistics and JMX monitoring</a>
<ul class="sectlevel2">
<li><a href="#enabling-statistics-remote_statistics-jmx">9.1. Enabling statistics in remote caches</a></li>
<li><a href="#enabling-hotrod-client-statistics_statistics-jmx">9.2. Enabling Hot Rod client statistics</a></li>
<li><a href="#configuring-metrics_statistics-jmx">9.3. Configuring Infinispan metrics</a></li>
<li><a href="#enabling-jmx_statistics-jmx">9.4. Registering JMX MBeans</a>
<ul class="sectlevel3">
<li><a href="#enabling-jmx-port_statistics-jmx">9.4.1. Enabling JMX remote ports</a></li>
<li><a href="#jmx-mbeans_statistics-jmx">9.4.2. Infinispan MBeans</a></li>
<li><a href="#registering-jmx-mbean-servers-statistics-jmx">9.4.3. Registering MBeans in custom MBean servers</a></li>
</ul>
</li>
<li><a href="#displaying-metrics-state-transfer_statistics-jmx">9.5. Exporting metrics during a state transfer operation</a></li>
<li><a href="#monitor-xsite-replication">9.6. Monitoring the status of cross-site replication</a></li>
</ul>
</li>
<li><a href="#opentelemetry-tracing">10. Enabling and configuring Infinispan OpenTelemetry tracing</a>
<ul class="sectlevel2">
<li><a href="#configuring-tracing_opentelemetry-tracing">10.1. Configuring Infinispan tracing</a>
<ul class="sectlevel3">
<li><a href="#further_tracing_options">10.1.1. Further Tracing Options</a></li>
</ul>
</li>
<li><a href="#tracing_cache">10.2. Configure tracing at cache level</a></li>
</ul>
</li>
<li><a href="#managed-datasources">11. Adding managed datasources to Infinispan Server</a>
<ul class="sectlevel2">
<li><a href="#configuring-server-datasources_managed-datasources">11.1. Configuring managed datasources</a></li>
<li><a href="#configuring-caches-with-jndi-names_managed-datasources">11.2. Configuring caches with JNDI names</a></li>
<li><a href="#server-connection-pool-properties_managed-datasources">11.3. Connection pool tuning properties</a></li>
</ul>
</li>
<li><a href="#cluster-transport">12. Setting up Infinispan cluster transport</a>
<ul class="sectlevel2">
<li><a href="#default-jgroups-stacks_cluster-transport">12.1. Default JGroups stacks</a></li>
<li><a href="#cluster-discovery-protocols_cluster-transport">12.2. Cluster discovery protocols</a>
<ul class="sectlevel3">
<li><a href="#discovery-ping_cluster-transport">12.2.1. PING</a></li>
<li><a href="#discovery-tcpping_cluster-transport">12.2.2. TCPPING</a></li>
<li><a href="#discovery-mping_cluster-transport">12.2.3. MPING</a></li>
<li><a href="#discovery-tcp-gossip_cluster-transport">12.2.4. TCPGOSSIP</a></li>
<li><a href="#discovery-jdbcping_cluster-transport">12.2.5. JDBC_PING2</a>
<ul class="sectlevel4">
<li><a href="#discovery-jdbcping-datasource_cluster-transport">Using a server datasource for JDBC_PING2 discovery</a></li>
</ul>
</li>
<li><a href="#discovery-dns-ping_cluster-transport">12.2.6. DNS_PING</a></li>
<li><a href="#jgroups-cloud-discovery-protocols_cluster-transport">12.2.7. Cloud discovery protocols</a></li>
</ul>
</li>
<li><a href="#using-jgroups-default-stacks_cluster-transport">12.3. Using the default JGroups stacks</a></li>
<li><a href="#customizing-jgroups-stacks_cluster-transport">12.4. Customizing JGroups stacks</a>
<ul class="sectlevel3">
<li><a href="#jgroups-inheritance-attributes_cluster-transport">12.4.1. Inheritance attributes</a></li>
</ul>
</li>
<li><a href="#using-jgroups-system-properties_cluster-transport">12.5. Using JGroups system properties</a>
<ul class="sectlevel3">
<li><a href="#jgroups-system-properties_cluster-transport">12.5.1. Cluster transport properties</a></li>
<li><a href="#jgroups-extras-properties_cluster-transport">12.5.2. System properties for cloud discovery protocols</a>
<ul class="sectlevel4">
<li><a href="#amazon_ec2">Amazon EC2</a></li>
<li><a href="#google_cloud_platform">Google Cloud Platform</a></li>
<li><a href="#azure">Azure</a></li>
<li><a href="#kubernetes">Kubernetes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-inline-jgroups-stacks_cluster-transport">12.6. Using inline JGroups stacks</a></li>
<li><a href="#using-external-jgroups-stacks_cluster-transport">12.7. Using external JGroups stacks</a></li>
<li><a href="#secure-cluster-transport">12.8. Encrypting cluster transport</a>
<ul class="sectlevel3">
<li><a href="#securing-cluster-transport-tls-identities_secure-cluster-transport">12.8.1. Securing cluster transport with TLS identities</a></li>
<li><a href="#jgroups-encryption-protocols_secure-cluster-transport">12.8.2. JGroups encryption protocols</a></li>
<li><a href="#configuring-jgroups-asym-encrypt_secure-cluster-transport">12.8.3. Securing cluster transport with asymmetric encryption</a></li>
<li><a href="#configuring-jgroups-sym-encrypt_secure-cluster-transport">12.8.4. Securing cluster transport with symmetric encryption</a></li>
</ul>
</li>
<li><a href="#jgroups-ports_cluster-transport">12.9. TCP and UDP ports for cluster traffic</a></li>
</ul>
</li>
<li><a href="#creating-remote-caches">13. Creating remote caches</a>
<ul class="sectlevel2">
<li><a href="#default-cache-manager-creating-remote-caches">13.1. Default Cache Manager</a></li>
<li><a href="#creating-caches-console_creating-remote-caches">13.2. Creating caches with Infinispan Console</a></li>
<li><a href="#creating-caches-cli_creating-remote-caches">13.3. Creating remote caches with the Infinispan CLI</a></li>
<li><a href="#creating-caches-hotrod_creating-remote-caches">13.4. Creating remote caches from Hot Rod clients</a></li>
<li><a href="#creating-caches-rest_creating-remote-caches">13.5. Creating remote caches with the REST API</a></li>
</ul>
</li>
<li><a href="#remote-execution">14. Running scripts and tasks on Infinispan Server</a>
<ul class="sectlevel2">
<li><a href="#adding-server-tasks_remote-execution">14.1. Adding tasks to Infinispan Server deployments</a>
<ul class="sectlevel3">
<li><a href="#server-tasks_remote-execution">14.1.1. Infinispan Server tasks</a></li>
</ul>
</li>
<li><a href="#adding-scripts_remote-execution">14.2. Adding scripts to Infinispan Server deployments</a>
<ul class="sectlevel3">
<li><a href="#server-scripts_remote-execution">14.2.1. Infinispan Server scripts</a>
<ul class="sectlevel4">
<li><a href="#server-script-metdata_remote-execution">Script metadata</a></li>
<li><a href="#server-script-bindings_remote-execution">Script bindings</a></li>
<li><a href="#server-script-parameters_remote-execution">Script parameters</a></li>
</ul>
</li>
<li><a href="#add_script_hotrod">14.2.2. Programmatically Creating Scripts</a></li>
</ul>
</li>
<li><a href="#running-scripts-tasks_remote-execution">14.3. Running scripts and tasks</a></li>
</ul>
</li>
<li><a href="#configuring-server-logging">15. Configuring Infinispan Server logging</a>
<ul class="sectlevel2">
<li><a href="#server-log-files_server-logging">15.1. Infinispan Server log files</a>
<ul class="sectlevel3">
<li><a href="#configuring-server-logs_server-logging">15.1.1. Configuring Infinispan Server logs</a></li>
<li><a href="#log-levels_server-logging">15.1.2. Log levels</a></li>
<li><a href="#logging-categories_server-logging">15.1.3. Infinispan logging categories</a></li>
<li><a href="#log-appenders_server-logging">15.1.4. Log appenders</a></li>
<li><a href="#log-pattern-formatters_server-logging">15.1.5. Log pattern formatters</a></li>
<li><a href="#enabling-json-logging_server-logging">15.1.6. Enabling the JSON log handler</a></li>
</ul>
</li>
<li><a href="#access-logs_server-logging">15.2. Access logs</a>
<ul class="sectlevel3">
<li><a href="#enabling-access-logs_server-logging">15.2.1. Enabling access logs</a></li>
<li><a href="#access-log-properties_server-logging">15.2.2. Access log properties</a></li>
</ul>
</li>
<li><a href="#audit-logs_server-logging">15.3. Audit logs</a>
<ul class="sectlevel3">
<li><a href="#enabling-audit-logs-server-logging">15.3.1. Enabling audit logging</a></li>
<li><a href="#configuring-audit-logs_server-logging">15.3.2. Configuring audit logging appenders</a></li>
<li><a href="#customizing-audit-logs_server-logging">15.3.3. Using custom audit logging implementations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rolling-upgrades">16. Performing rolling upgrades for Infinispan Server clusters</a>
<ul class="sectlevel2">
<li><a href="#setting-up-target-clusters_rolling-upgrades">16.1. Setting up target Infinispan clusters</a></li>
<li><a href="#synchronizing-data-target-clusters_rolling-upgrades">16.2. Synchronizing data to target clusters</a></li>
</ul>
</li>
<li><a href="#patching-servers">17. Patching Infinispan Server installations</a>
<ul class="sectlevel2">
<li><a href="#patches-patching-servers">17.1. Infinispan Server patches</a></li>
<li><a href="#creating-server-patches_patching-servers">17.2. Creating Infinispan Server patches</a></li>
<li><a href="#applying-server-patches_patching-servers">17.3. Applying patches to Infinispan Server installations</a></li>
<li><a href="#rolling-back-server-patches_patching-servers">17.4. Rolling back patches</a></li>
</ul>
</li>
<li><a href="#tshoot_server">18. Troubleshooting Infinispan Server deployments</a>
<ul class="sectlevel2">
<li><a href="#getting-server-reports_server">18.1. Getting diagnostic reports from Infinispan Server</a></li>
<li><a href="#configuring-server-logs-cli_server">18.2. Changing Infinispan Server logging configuration at runtime</a></li>
<li><a href="#gathering-cli-statistics_server">18.3. Gathering resource statistics from the CLI</a></li>
<li><a href="#accessing-health-rest_server">18.4. Accessing cluster health via REST</a></li>
<li><a href="#accessing-health-jmx_server">18.5. Accessing cluster health via JMX</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server runs in a dedicated Java Virtual Machine (JVM) and provides client access to remote caches through Hot Rod or REST endpoints.
Infinispan Server speeds time to deployment by separating caches from application logic and offers built-in capabilities for monitoring and administration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-getting-started"><a class="anchor" href="#server-getting-started"></a>1. Getting started with Infinispan Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install the server distribution, create a user, and start your first Infinispan cluster.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://infinispan.org/assets/images/documentation/icon-get-started.png" alt="Get started icon" height="32"></span>
<a href="https://infinispan.org/get-started/">Start running Infinispan in 4 easy steps</a></p>
</div>
<h3 id="ansible_collection" class="discrete">Ansible collection</h3>
<div class="paragraph">
<p>Automate installation of Infinispan clusters with our Ansible collection that optionally includes Keycloak caches and cross-site replication configuration.
The Ansible collection also lets you inject Infinispan caches into the static configuration for each server instance during installation.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/ansible-middleware/infinispan">Ansible collection for Infinispan</a> is available from Ansible Galaxy.</p>
</div>
<div class="sect2">
<h3 id="server-requirements_server-getting-started"><a class="anchor" href="#server-requirements_server-getting-started"></a>1.1. Infinispan Server requirements</h3>
<div class="paragraph">
<p>Infinispan Server requires a Java Virtual Machine and works with Java 17 and later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan Server does not support versions prior to Java 17. However, you can use Hot Rod clients from older versions
of Infinispan which still work fine with more recent servers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="downloading-server-distributions_server-getting-started"><a class="anchor" href="#downloading-server-distributions_server-getting-started"></a>1.2. Downloading Infinispan Server distributions</h3>
<div class="paragraph">
<p>The Infinispan Server distribution is an archive of Java libraries (<code>JAR</code> files) and configuration files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download Infinispan 15.0 Server from <a href="https://infinispan.org/download/">Infinispan downloads</a>.</p>
</li>
<li>
<p>Run the <code>sha1sum</code> command with the server download archive as the argument, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>sha1sum infinispan-server-${version}.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Compare with the <code>SHA-1</code> checksum value on the Infinispan downloads page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p>The Infinispan Server README, available in the distribution, provides example commands for running the server, describes folders in the <code>$ISPN_HOME</code> directory, and lists system properties you can use to customize the filesystem.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-servers_server-getting-started"><a class="anchor" href="#installing-servers_server-getting-started"></a>1.3. Installing Infinispan Server</h3>
<div class="paragraph">
<p>Install the Infinispan Server distribution on a host system.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Download a Infinispan Server distribution archive.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use any appropriate tool to extract the Infinispan Server archive to the host filesystem.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>unzip infinispan-server-15.0.13.Final.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting directory is your <code>$ISPN_HOME</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jvm-settings-for-server_server-getting-started"><a class="anchor" href="#jvm-settings-for-server_server-getting-started"></a>1.4. JVM settings for Infinispan</h3>
<div class="paragraph">
<p>You can define Java Virtual Machine (JVM) settings for Infinispan either by editing the <code>server.conf</code> configuration file, or by setting the <code>JAVA_OPTS</code> environment variable .</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running Infinispan in a container do not set <code>Xmx</code> or <code>Xms</code>  because the values are automatically calculated from the container settings to be 50% of the container size.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="editing_the_configuration_file" class="discrete">Editing the configuration file</h4>
<div class="paragraph">
<p>You can edit the required values in the <code>server.conf</code> configuration file. For example, to set the options to pass to the JVM, edit the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS="-Xms64m -Xmx512m -XX:MetaspaceSize=64M -Djava.net.preferIPv4Stack=true"
JAVA_OPTS="$JAVA_OPTS -Djava.awt.headless=true"</pre>
</div>
</div>
<div class="paragraph">
<p>You can uncomment the existing example settings as well. For example, to configure Java Platform Debugger Architecture (JPDA) settings for remote socket debugging, update the file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Sample JPDA settings for remote socket debugging
JAVA_OPTS="$JAVA_OPTS -agentlib:jdwp=transport=dt_socket,address=8787,server=y,suspend=n"</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, you can add more settings to <code>JAVA_OPTS</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS="$JAVA_OPTS &lt;key_1&gt;=&lt;value_1&gt;, ..., &lt;key_N&gt;=&lt;value_N&gt; "</pre>
</div>
</div>
<h4 id="setting_an_environment_variable" class="discrete">Setting an environment variable</h4>
<div class="paragraph">
<p>You can override the settings in <code>server.conf</code> configuration file by setting the <code>JAVA_OPTS</code> environment variable. For example:</p>
</div>
<div class="listingblock">
<div class="title">Linux</div>
<div class="content">
<pre>export JAVA_OPTS="-Xmx1024M"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Microsoft Windows</div>
<div class="content">
<pre>set JAVA_OPTS="-Xmx1024M"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-servers_server-getting-started"><a class="anchor" href="#starting-servers_server-getting-started"></a>1.5. Starting Infinispan Server</h3>
<div class="paragraph">
<p>Run Infinispan Server instances in a Java Virtual Machine (JVM).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Download and install the server distribution.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Start Infinispan Server instances with the <code>server</code> script.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin\server.bat</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Infinispan Server is running successfully when it logs the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ISPN080004: Protocol SINGLE_PORT listening on 127.0.0.1:11222
ISPN080034: Server '...' listening on http://127.0.0.1:11222
ISPN080001: Infinispan Server &lt;version&gt; started in &lt;mm&gt;ms</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Open <a href="http://127.0.0.1:11222/console/"><code>127.0.0.1:11222/console/</code></a> in any browser.</p>
</li>
<li>
<p>Enter your credentials at the prompt and continue to Infinispan Console.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="passing-server-configuration-startup_server-getting-started"><a class="anchor" href="#passing-server-configuration-startup_server-getting-started"></a>1.6. Passing Infinispan Server configuration at startup</h3>
<div class="paragraph">
<p>Specify custom configuration when you start Infinispan Server.</p>
</div>
<div class="paragraph">
<p>Infinispan Server can parse multiple configuration files that you overlay on startup with the <code>--server-config</code> argument.
You can use as many configuration overlay files as required, in any order.
Configuration overlay files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Must be valid Infinispan configuration and contain the root <code>server</code> element or field.</p>
</li>
<li>
<p>Do not need to be full configuration as long as your combination of overlay files results in a full configuration.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan Server does not detect conflicting configuration between overlay files.
Each overlay file overwrites any conflicting configuration in the preceding configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you pass cache configuration to Infinispan Server on startup it does not dynamically create those cache across the cluster.
You must manually propagate caches to each node.</p>
</div>
<div class="paragraph">
<p>Additionally, cache configuration that you pass to Infinispan Server on startup must include the <code>infinispan</code> and <code>cache-container</code> elements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Download and install the server distribution.</p>
</li>
<li>
<p>Add custom server configuration to the <code>server/conf</code> directory of your Infinispan Server installation.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Specify one or more configuration files with the <code>--server-config=</code> or <code>-c</code> argument, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -c infinispan.xml -c datasources.yaml -c security-realms.json</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-users_server-getting-started"><a class="anchor" href="#creating-users_server-getting-started"></a>1.7. Creating Infinispan users</h3>
<div class="paragraph">
<p>Add credentials to authenticate with Infinispan Server deployments through Hot Rod and REST endpoints.
Before you can access the Infinispan Console or perform cache operations you must create at least one user with the Infinispan command line interface (CLI).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan enforces security authorization with role-based access control (RBAC).
Create an <code>admin</code> user the first time you add credentials to gain full <code>ADMIN</code> permissions to your Infinispan deployment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Download and install Infinispan Server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Create an <code>admin</code> user, belonging to the <code>admin</code> group with the <code class="command">user create</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-sh" data-lang="sh">bin/cli.sh user create admin -p changeme -g admin</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code class="command">help user</code> from a CLI session to get complete command details.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Open <code>user.properties</code> and confirm the user exists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>cat server/conf/users.properties

admin=scram-sha-1\:BYGcIAwvf6b...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Adding credentials to a properties realm with the CLI creates the user only on the server instance to which you are connected.
You must manually synchronize credentials in a properties realm to each node in the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="granting-roles-to-users_server-getting-started"><a class="anchor" href="#granting-roles-to-users_server-getting-started"></a>1.7.1. Granting roles to users</h4>
<div class="paragraph">
<p>Assign roles to users and grant them permissions to perform cache operations and interact with Infinispan resources.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grant roles to groups instead of users if you want to assign the same role to multiple users and centrally maintain their permissions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Create Infinispan users.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Assign roles to users with the <code class="command">user roles grant</code> command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles grant --roles=deployer katie</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>List roles that you grant to users with the <code class="command">user roles ls</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles ls katie
["deployer"]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="adding-users-to-groups_server-getting-started"><a class="anchor" href="#adding-users-to-groups_server-getting-started"></a>Adding users to groups</h5>
<div class="paragraph">
<p>Groups let you change permissions for multiple users.
You assign a role to a group and then add users to that group.
Users inherit permissions from the group role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You use groups as part of a property realm in the Infinispan Server configuration.
Each group is a special type of user that also requires a username and password.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Create Infinispan users.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">user create</code> command to create a group.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify a group name with the <code>--groups</code> argument.</p>
</li>
<li>
<p>Set a username and password for the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user create --groups=developers developers -p changeme</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>List groups.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user ls --groups</code></pre>
</div>
</div>
</li>
<li>
<p>Grant a role to the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles grant --roles=application developers</code></pre>
</div>
</div>
</li>
<li>
<p>List roles for the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles ls developers</code></pre>
</div>
</div>
</li>
<li>
<p>Add users to the group one at a time.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user groups john --groups=developers</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Open <code>groups.properties</code> and confirm the group exists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>cat server/conf/groups.properties</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-user-roles_server-getting-started"><a class="anchor" href="#default-user-roles_server-getting-started"></a>1.7.2. Infinispan user roles and permissions</h4>
<div class="paragraph">
<p>Infinispan includes several roles that provide users with permissions to access caches and Infinispan resources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superuser with all permissions including control of the Cache Manager lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR, CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and delete Infinispan resources in addition to <code>application</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read and write access to Infinispan resources in addition to <code>observer</code> permissions. Can also listen to events and execute server tasks and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>observer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read access to Infinispan resources in addition to <code>monitor</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view statistics via JMX and the <code>metrics</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/AuthorizationPermission.html">org.infinispan.security.AuthorizationPermission Enum</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying-cluster-views_server-getting-started"><a class="anchor" href="#verifying-cluster-views_server-getting-started"></a>1.8. Verifying cluster views</h3>
<div class="paragraph">
<p>Infinispan Server instances on the same network automatically discover each other and form clusters.</p>
</div>
<div class="paragraph">
<p>Complete this procedure to observe cluster discovery with the <code>MPING</code> protocol in the default <code>TCP</code> stack with locally running Infinispan Server instances.
If you want to adjust cluster transport for custom network requirements, see the documentation for setting up Infinispan clusters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is intended to demonstrate the principle of cluster discovery and is not intended for production environments.
Doing things like specifying a port offset on the command line is not a reliable way to configure cluster transport for production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Have one instance of Infinispan Server running.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Copy the root directory to <code>server2</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>cp -r server server2</code></pre>
</div>
</div>
</li>
<li>
<p>Specify a port offset and the <code>server2</code> directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -o 100 -s server2</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can view cluster membership in the console at <a href="http://127.0.0.1:11222/console/cluster-membership"><code>127.0.0.1:11222/console/cluster-membership</code></a>.</p>
</div>
<div class="paragraph">
<p>Infinispan also logs the following messages when nodes join clusters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN000094: Received new cluster view for channel cluster:
[&lt;server_hostname&gt;|3] (2) [&lt;server_hostname&gt;, &lt;server2_hostname&gt;]

INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN100000: Node &lt;server2_hostname&gt; joined the cluster</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shutting-down-servers_server-getting-started"><a class="anchor" href="#shutting-down-servers_server-getting-started"></a>1.9. Shutting down Infinispan Server</h3>
<div class="paragraph">
<p>Stop individually running servers or bring down clusters gracefully.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Shut down Infinispan Server in one of the following ways:</p>
<div class="ulist">
<ul>
<li>
<p>Stop all nodes in a cluster with the <code class="command">shutdown cluster</code> command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>shutdown cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command saves cluster state to the <code>data</code> folder for each node in the cluster.
If you use a cache store, the <code class="command">shutdown cluster</code> command also persists all data in the cache.</p>
</div>
</li>
<li>
<p>Stop individual server instances with the <code class="command">shutdown server</code> command and the server hostname, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>shutdown server &lt;my_server01&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code class="command">shutdown server</code> command does not wait for rebalancing operations to complete, which can lead to data loss if you specify multiple hostnames at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code class="command">help shutdown</code> for more details about using the command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan logs the following messages when you shut down servers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ISPN080002: Infinispan Server stopping
ISPN000080: Disconnecting JGroups channel cluster
ISPN000390: Persisted state, version=&lt;$version&gt; timestamp=YYYY-MM-DDTHH:MM:SS
ISPN080003: Infinispan Server stopped</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="cluster-restarts_server-getting-started"><a class="anchor" href="#cluster-restarts_server-getting-started"></a>1.9.1. Shutdown and restart of Infinispan clusters</h4>
<div class="paragraph">
<p>Prevent data loss and ensure consistency of your cluster by properly shutting down and restarting nodes.</p>
</div>
<h5 id="cluster_shutdown" class="discrete">Cluster shutdown</h5>
<div class="paragraph">
<p>Infinispan recommends using the <code>shutdown cluster</code> command to stop all nodes in a cluster while saving cluster state and persisting all data in the cache.
You can use the <code>shutdown cluster</code> command also for clusters with a single node.</p>
</div>
<div class="paragraph">
<p>When you bring Infinispan clusters back online, all nodes and caches in the cluster will be unavailable until all nodes rejoin.
To prevent inconsistencies or data loss, Infinispan restricts access to the data stored in the cluster and modifications of the cluster state until the cluster is fully operational again.
Additionally, Infinispan disables cluster rebalancing and prevents local cache stores purging on startup.</p>
</div>
<div class="paragraph">
<p>During the cluster recovery process, the coordinator node logs messages for each new node joining, indicating which nodes are available and which are still missing.
Other nodes in the Infinispan cluster have the view from the time they join. You can monitor availability of caches using the Infinispan Console or REST API.</p>
</div>
<div class="paragraph">
<p>However, in cases where waiting for all nodes is not necessary nor desired, it is possible to set a cache available with the current topology.
This approach is possible through the CLI, see below, or the REST API.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Manually installing a topology can lead to data loss, only perform this operation if the initial topology cannot be recreated.</p>
</div>
</td>
</tr>
</table>
</div>
<h5 id="server_shutdown" class="discrete">Server shutdown</h5>
<div class="paragraph">
<p>After using the <code>shutdown server</code> command to bring nodes down, the first node to come back online will be available immediately without waiting for other members.
The remaining nodes join the cluster immediately, triggering state transfer but loading the local persistence first, which might lead to stale entries.
Local cache stores configured to purge on startup will be emptied when the server starts.
Local cache stores marked as <code>purge=false</code> will be available after a server restarts but might contain stale entries.</p>
</div>
<div class="paragraph">
<p>If you shutdown clustered nodes with the <code class="command">shutdown server</code> command, you must restart each server in reverse order to avoid potential issues related to data loss and stale entries in the cache.<br>
For example, if you shutdown <code>server1</code> and then shutdown <code>server2</code>, you should first start <code>server2</code> and then start <code>server1</code>.
However, restarting clustered nodes in reverse order does not completely prevent data loss and stale entries.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-directory-structure_server-getting-started"><a class="anchor" href="#server-directory-structure_server-getting-started"></a>1.10. Infinispan Server installation directory structure</h3>
<div class="paragraph">
<p>Infinispan Server uses the following folders on the host filesystem under <code>$ISPN_HOME</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code> bin
 boot
 docs
 lib
 server
 static</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See the Infinispan Server README, available in the distribution, for descriptions of the each folder in your <code>$ISPN_HOME</code> directory as well as system properties you can use to customize the filesystem.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="server_root_directory"><a class="anchor" href="#server_root_directory"></a>1.10.1. Server root directory</h4>
<div class="paragraph">
<p>Apart from resources in the <code>bin</code> and <code>docs</code> folders, the only folder under <code>$ISPN_HOME</code> that you should interact with is the server root directory, which is named <code>server</code> by default.</p>
</div>
<div class="paragraph">
<p>You can create multiple nodes under the same <code>$ISPN_HOME</code> directory or in different directories, but each Infinispan Server instance must have its own server root directory.
For example, a cluster of 5 nodes could have the following server root directories on the filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code> server
 server1
 server2
 server3
 server4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each server root directory should contain the following folders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code> server
  conf
  data
  lib
  log</code></pre>
</div>
</div>
<h4 id="serverconf" class="discrete"><code>server/conf</code></h4>
<div class="paragraph">
<p>Holds <code>infinispan.xml</code> configuration files for a Infinispan Server instance.</p>
</div>
<div class="paragraph">
<p>Infinispan separates configuration into two layers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dynamic</dt>
<dd>
<p>Create mutable cache configurations for data scalability.<br>
Infinispan Server permanently saves the caches you create at runtime along with the cluster state that is distributed across nodes.
Each joining node receives a complete cluster state that Infinispan Server synchronizes across all nodes whenever changes occur.</p>
</dd>
<dt class="hdlist1">Static</dt>
<dd>
<p>Add configuration to <code>infinispan.xml</code> for underlying server mechanisms such as cluster transport, security, and shared datasources.</p>
</dd>
</dl>
</div>
<h4 id="serverdata" class="discrete"><code>server/data</code></h4>
<div class="paragraph">
<p>Provides internal storage that Infinispan Server uses to maintain cluster state.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Never directly delete or modify content in <code>server/data</code>.</p>
</div>
<div class="paragraph">
<p>Modifying files such as <code>caches.xml</code> while the server is running can cause corruption.
Deleting content can result in an incorrect state, which means clusters cannot restart after shutdown.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="serverlib" class="discrete"><code>server/lib</code></h4>
<div class="paragraph">
<p>Contains extension <code>JAR</code> files for custom filters, custom event listeners, JDBC drivers, custom <code>ServerTask</code> implementations, and so on.</p>
</div>
<h4 id="serverlog" class="discrete"><code>server/log</code></h4>
<div class="paragraph">
<p>Holds Infinispan Server log files.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-interfaces"><a class="anchor" href="#server-interfaces"></a>2. Network interfaces and socket bindings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Expose Infinispan Server through a network interface by binding it to an IP address.
You can then configure endpoints to use the interface so Infinispan Server can handle requests from remote client applications.</p>
</div>
<div class="sect2">
<h3 id="network-interfaces_server-interfaces"><a class="anchor" href="#network-interfaces_server-interfaces"></a>2.1. Network interfaces</h3>
<div class="paragraph">
<p>Infinispan Server multiplexes endpoints to a single TCP/IP port and automatically detects protocols of inbound client requests.
You can configure how Infinispan Server binds to network interfaces to listen for client requests.</p>
</div>
<h4 id="internet_protocol_ip_address" class="discrete">Internet Protocol (IP) address</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects a specific IPv4 address, which can be public, private, or loopback. This is the default network interface for Infinispan Server. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;inet-address value="${infinispan.bind.address:127.0.0.1}"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "inet-address": {
        "value": "127.0.0.1"
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      inetAddress:
        value: "127.0.0.1"</code></pre>
</div>
</div>
<h4 id="loopback_address" class="discrete">Loopback address</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects an IP address in an IPv4 or IPv6 loopback address block. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;loopback/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "loopback": null
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      loopback: ~</code></pre>
</div>
</div>
<h4 id="non_loopback_address" class="discrete">Non-loopback address</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects an IP address in an IPv4 or IPv6 non-loopback address block. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;non-loopback/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "non_loopback": null
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      nonLoopback: ~</code></pre>
</div>
</div>
<h4 id="any_address" class="discrete">Any address</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Uses the `INADDR_ANY` wildcard address which means Infinispan Server listens for inbound client requests on all interfaces. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;any-address/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "any_address": null
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      anyAddress: ~</code></pre>
</div>
</div>
<h4 id="link_local" class="discrete">Link local</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects a link-local IP address in an IPv4 or IPv6 address block. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;link-local/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "link_local": null
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      linkLocal: ~</code></pre>
</div>
</div>
<h4 id="site_local" class="discrete">Site local</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects a site-local (private) IP address in an IPv4 or IPv6 address block. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;site-local/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "site_local": null
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      siteLocal: ~</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="match-fallback-strategies_server-interfaces"><a class="anchor" href="#match-fallback-strategies_server-interfaces"></a>2.1.1. Match and fallback strategies</h4>
<div class="paragraph">
<p>Infinispan Server can enumerate all network interfaces on the host system and bind to an interface, host, or IP address that matches a value, which can include regular expressions for additional flexibility.</p>
</div>
<h5 id="match_host" class="discrete">Match host</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects an IP address that is assigned to a matching host name. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;match-host value="my_host_name"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "match-host": {
        "value": "my_host_name"
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      matchHost:
        value: "my_host_name"</code></pre>
</div>
</div>
<h5 id="match_interface" class="discrete">Match interface</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!--Selects an IP address assigned to a matching network interface. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;match-interface value="eth0"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "match-interface": {
        "value": "eth0"
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      matchInterface:
        value: "eth0"</code></pre>
</div>
</div>
<h5 id="match_address" class="discrete">Match address</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Selects an IP address that matches a regular expression. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;match-address value="132\..*"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "match-address": {
        "value": "132\\..*"
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      matchAddress:
        value: "127\\..*"</code></pre>
</div>
</div>
<h5 id="fallback" class="discrete">Fallback</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;!-- Includes multiple strategies that Infinispan Server tries in the declared order until it finds a match. --&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;match-host value="my_host_name"/&gt;
      &lt;match-address value="132\..*"/&gt;
      &lt;any-address/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "interfaces": [{
      "name": "public",
      "match-host": {
        "value": "my_host_name"
      },
      "match-address": {
        "value": "132\\..*"
      },
      "any_address": null
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "public"
      matchHost:
        value: "my_host_name"
      matchAddress:
        value: "132\\..*"
      anyAddress: ~</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="socket-bindings_server-interfaces"><a class="anchor" href="#socket-bindings_server-interfaces"></a>2.2. Socket bindings</h3>
<div class="paragraph">
<p>Socket bindings map endpoint connectors to network interfaces and ports.
By default, Infinispan Server includes a socket binding configuration that listens on the localhost interface, <code>127.0.0.1</code>, at port <code>11222</code> for the REST and Hot Rod endpoints.
If you enable the Memcached endpoint, the default socket bindings configure Infinispan Server to bind to port <code>11221</code>.</p>
</div>
<div class="listingblock">
<div class="title">Default socket bindings</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;socket-bindings default-interface="public"
                   port-offset="${infinispan.socket.binding.port-offset:0}"&gt;
    &lt;socket-binding name="default"
                    port="${infinispan.bind.port:11222}"/&gt;
    &lt;socket-binding name="memcached"
                    port="11221"/&gt;
  &lt;/socket-bindings&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration element or attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>socket-bindings</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root element that contains all network interfaces and ports to which Infinispan Server endpoints can bind and listen for client connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-interface</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare the network interface that Infinispan Server listens on by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port-offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the offset that Infinispan Server applies to port declarations for socket bindings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>socket-binding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures Infinispan Server to bind to a port on a network interface.</p></td>
</tr>
</tbody>
</table>
<h4 id="custom_socket_binding_declarations" class="discrete">Custom socket binding declarations</h4>
<div class="paragraph">
<p>The following example configuration adds an <code>interface</code> declaration named "private" and a <code>socket-binding</code> declaration that binds Infinispan Server to the private IP address:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;interfaces&gt;
    &lt;interface name="public"&gt;
      &lt;inet-address value="${infinispan.bind.address:127.0.0.1}"/&gt;
    &lt;/interface&gt;
    &lt;interface name="private"&gt;
      &lt;inet-address value="10.1.2.3"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;

  &lt;socket-bindings default-interface="public"
                   port-offset="${infinispan.socket.binding.port-offset:0}"&gt;
    &lt;socket-binding name="private_binding"
                    interface="private"
                    port="49152"/&gt;
  &lt;/socket-bindings&gt;

  &lt;endpoints socket-binding="private_binding"
             security-realm="default"/&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
	"server": {
		"interfaces": [{
			"name": "private",
			"inet-address": {
				"value": "10.1.2.3"
			}
		}, {
			"name": "public",
			"inet-address": {
				"value": "127.0.0.1"
			}
		}],
		"socket-bindings": {
			"port-offset": "0",
			"default-interface": "public",
			"socket-binding": [{
				"name": "private_binding",
				"port": "1234",
				"interface": "private"
			}]
		},
		"endpoints": {
			"endpoint": {
				"socket-binding": "private_binding",
				"security-realm": "default"
			}
		}
	}
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  interfaces:
    - name: "private"
      inetAddress:
        value: "10.1.2.3"
    - name: "public"
      inetAddress:
        value: "127.0.0.1"
  socketBindings:
    portOffset: "0"
    defaultInterface: "public"
    socketBinding:
      - name: "private_binding"
        port: "49152"
        interface: "private"
  endpoints:
    endpoint:
      socketBinding: "private_binding"
      securityRealm: "default"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changing-bind-address_server-interfaces"><a class="anchor" href="#changing-bind-address_server-interfaces"></a>2.3. Changing the bind address for Infinispan Server</h3>
<div class="paragraph">
<p>Infinispan Server binds to a network IP address to listen for inbound client connections on the Hot Rod and REST endpoints.
You can specify that IP address directly in your Infinispan Server configuration or when starting server instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have at least one Infinispan Server installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Specify the IP address to which Infinispan Server binds in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open your Infinispan Server configuration and set the value for the <code>inet-address</code> element, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;interfaces&gt;
    &lt;interface name="custom"&gt;
      &lt;inet-address value="${infinispan.bind.address:192.0.2.0}"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>-b</code> option or the <code>infinispan.bind.address</code> system property.</p>
<div class="listingblock">
<div class="title">Linux</div>
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -b 192.0.2.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Windows</div>
<div class="content">
<pre class="highlight nowrap"><code>bin\server.bat -b 192.0.2.0</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="listening-on-all-addresses_server-interfaces"><a class="anchor" href="#listening-on-all-addresses_server-interfaces"></a>2.3.1. Listening on all addresses</h4>
<div class="paragraph">
<p>If you specify the <code>0.0.0.0</code> meta-address, or <code>INADDR_ANY</code>, as the bind address in your Infinispan Server configuration, it listens for incoming client connections on all available network interfaces.</p>
</div>
<div class="paragraph">
<div class="title">Client intelligence</div>
<p>Configuring Infinispan to listen on all addresses affects how it provides Hot Rod clients with cluster topology.
If there are multiple interfaces to which Infinispan Server binds, then it sends a list of IP addresses for each interface.</p>
</div>
<div class="paragraph">
<p>For example, a cluster where each server node binds to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>10.0.0.0/8</code> subnet</p>
</li>
<li>
<p><code>192.168.0.0/16</code> subnet</p>
</li>
<li>
<p><code>127.0.0.1</code> loopback</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hot Rod clients receive IP addresses for server nodes that belong to the interface through which the clients connect.
If a client connects to <code>192.168.0.0</code>, for example, it does not receive any cluster topology details for nodes that listen on <code>10.0.0.0</code>.</p>
</div>
<div class="paragraph">
<div class="title">Netmask override</div>
<p>Kubernetes, and some other environments, divide the IP address space into subnets and use those different subnets as a single network.
For example, <code>10.129.2.100/23</code> and <code>10.129.4.100/23</code> are in different subnets but belong to the <code>10.0.0.0/8</code> network.</p>
</div>
<div class="paragraph">
<p>For this reason, Infinispan Server overrides netmasks that the host system provides with netmasks that follow IANA conventions for private and reserved networks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IPv4: <code>10.0.0.0/8</code>, <code>100.64.0.0/10</code>, 192.168.0.0/16`, <code>172.16.0.0/12</code>, <code>169.254.0.0/16</code> and <code>240.0.0.0/4</code></p>
</li>
<li>
<p>IPv6: <code>fc00::/7</code> and <code>fe80::/10</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <code>RFC 1112</code>, <code>RFC 1918</code>, <code>RFC 3927</code>, <code>RFC 6598</code> for IPv4 or <code>RFC 4193</code>, <code>RFC 3513</code> for IPv6.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can optionally configure the Hot Rod connector to use the netmask that the host system provides for interfaces with the <code>network-prefix-override</code> attribute in your Infinispan Server configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/infinispan-server-15.0.html">Infinispan Server schema reference</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc1112">RFC 1112</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc1918">RFC 1918</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc3513">RFC 3513</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc3927">RFC 3927</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc4193">RFC 4193</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc6598">RFC 6598</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-ports-protocols_server-interfaces"><a class="anchor" href="#server-ports-protocols_server-interfaces"></a>2.4. Infinispan Server ports and protocols</h3>
<div class="paragraph">
<p>Infinispan Server provides network endpoints that allow client access with different protocols.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11222</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hot Rod and REST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11221</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memcached (disabled by default)</p></td>
</tr>
</tbody>
</table>
<h4 id="single_port" class="discrete">Single port</h4>
<div class="paragraph">
<p>Infinispan Server exposes multiple protocols through a single TCP port, <code>11222</code>.
Handling multiple protocols with a single port simplifies configuration and reduces management complexity when deploying Infinispan clusters.
Using a single port also enhances security by minimizing the attack surface on the network.</p>
</div>
<div class="paragraph">
<p>Infinispan Server handles HTTP/1.1, HTTP/2, and Hot Rod protocol requests from clients via the single port in different ways.</p>
</div>
<div class="paragraph">
<div class="title">HTTP/1.1 upgrade headers</div>
<p>Client requests can include the <code>HTTP/1.1 upgrade</code> header field to initiate
HTTP/1.1 connections with Infinispan Server.
Client applications can then send the <code>Upgrade: protocol</code> header field, where <code>protocol</code> is a server endpoint.</p>
</div>
<div class="paragraph">
<div class="title">Application-Layer Protocol Negotiation (ALPN)/Transport Layer Security (TLS)</div>
<p>Client requests include Server Name Indication (SNI) mappings for Infinispan Server endpoints to negotiate protocols over a TLS connection.</p>
</div>
<div class="paragraph">
<div class="title">Automatic Hot Rod detection</div>
<p>Client requests that include Hot Rod headers automatically route to Hot Rod endpoints.</p>
</div>
<div class="sect3">
<h4 id="configuring-firewalls_server-interfaces"><a class="anchor" href="#configuring-firewalls_server-interfaces"></a>2.4.1. Configuring network firewalls for Infinispan traffic</h4>
<div class="paragraph">
<p>Adjust firewall rules to allow traffic between Infinispan Server and client applications.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On Red Hat Enterprise Linux (RHEL) workstations, for example, you can allow
traffic to port <code>11222</code> with firewalld as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code># firewall-cmd --add-port=11222/tcp --permanent
success
# firewall-cmd --list-ports | grep 11222
11222/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure firewall rules that apply across a network, you can use the
nftables utility.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specifying-port-offsets_server-interfaces"><a class="anchor" href="#specifying-port-offsets_server-interfaces"></a>2.5. Specifying port offsets</h3>
<div class="paragraph">
<p>Configure port offsets for multiple Infinispan Server instances on the same host.
The default port offset is <code>0</code>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Use the <code>-o</code> switch with the Infinispan CLI or the
<code>infinispan.socket.binding.port-offset</code> system property to set port offsets.</p>
</div>
<div class="paragraph">
<p>For example, start a server instance with an offset of <code>100</code> as follows. With the default configuration, this results in the Infinispan server listening on port <code>11322</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -o 100</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin\server.bat -o 100</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-endpoints"><a class="anchor" href="#server-endpoints"></a>3. Infinispan Server endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server endpoints provide client access to the cache manager over Hot Rod and REST protocols.</p>
</div>
<div class="sect2">
<h3 id="server-endpoints_server-endpoints"><a class="anchor" href="#server-endpoints_server-endpoints"></a>3.1. Infinispan Server endpoints</h3>
<div class="sect3">
<h4 id="hot_rod"><a class="anchor" href="#hot_rod"></a>3.1.1. Hot Rod</h4>
<div class="paragraph">
<p>Hot Rod is a binary TCP client-server protocol designed to provide faster data
access and improved performance in comparison to text-based protocols.</p>
</div>
<div class="paragraph">
<p>Infinispan provides Hot Rod client libraries in Java, C++, C#, Node.js and other programming languages.</p>
</div>
<div class="paragraph">
<div class="title">Topology caches</div>
<p>Infinispan uses topology caches to provide clients with cluster views.
Topology caches contain entries that map internal JGroups transport addresses
to exposed Hot Rod endpoints.</p>
</div>
<div class="paragraph">
<p>When client send requests, Infinispan servers compare the topology ID in
request headers with the topology ID from the cache. Infinispan servers send
new topology views if client have older topology IDs.</p>
</div>
<div class="paragraph">
<p>Cluster topology views allow Hot Rod clients to immediately detect when nodes
join and leave, which enables dynamic load balancing and failover.</p>
</div>
<div class="paragraph">
<p>In distributed cache modes, the consistent hashing algorithm also makes it
possible to route Hot Rod client requests directly to primary owners.</p>
</div>
</div>
<div class="sect3">
<h4 id="rest"><a class="anchor" href="#rest"></a>3.1.2. REST</h4>
<div class="paragraph">
<p>Infinispan exposes a RESTful interface that allows HTTP clients to access
data, monitor and maintain clusters, and perform administrative operations.</p>
</div>
<div class="paragraph">
<p>You can use standard HTTP load balancers to provide clients with load
balancing and failover capabilities. However, HTTP load balancers maintain
static cluster views and require manual updates when cluster topology changes
occur.</p>
</div>
</div>
<div class="sect3">
<h4 id="resp"><a class="anchor" href="#resp"></a>3.1.3. RESP</h4>
<div class="paragraph">
<p>Infinispan provides an implementation of the <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md">RESP3</a> protocol.</p>
</div>
<div class="paragraph">
<p>The RESP connector supports a subset of the Redis commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="memcached"><a class="anchor" href="#memcached"></a>3.1.4. Memcached</h4>
<div class="paragraph">
<p>Infinispan provides an implementation of the Memcached text and binary protocols for
remote client access.</p>
</div>
<div class="paragraph">
<p>The Infinispan Memcached endpoint supports clustering with replicated and
distributed cache modes.</p>
</div>
<div class="paragraph">
<p>There are some Memcached client implementations, such as the Cache::Memcached
Perl client, that can offer load balancing and failover detection capabilities
with static lists of Infinispan server addresses that require manual updates
when cluster topology changes occur.</p>
</div>
</div>
<div class="sect3">
<h4 id="endpoint-protocol-comparison_server-endpoints"><a class="anchor" href="#endpoint-protocol-comparison_server-endpoints"></a>3.1.5. Comparison of endpoint protocols</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">Hot Rod</th>
<th class="tableblock halign-center valign-top">HTTP / REST</th>
<th class="tableblock halign-center valign-top">Memcached</th>
<th class="tableblock halign-center valign-top">RESP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Topology-aware</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash-aware</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditional ops</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bulk ops</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactions</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listeners</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site failover</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="client-server-compatibility_server-endpoints"><a class="anchor" href="#client-server-compatibility_server-endpoints"></a>3.1.6. Hot Rod client compatibility with Infinispan Server</h4>
<div class="paragraph">
<p>Infinispan Server allows you to connect Hot Rod clients with different versions.
For instance during a migration or upgrade to your Infinispan cluster, the Hot Rod client version might be a lower Infinispan version than Infinispan Server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan recommends using the latest Hot Rod client version to benefit from the most recent capabilities and security enhancements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Infinispan 10 and later</div>
<p>Hot Rod protocol version 3.x automatically negotiates the highest version possible for clients with Infinispan Server.</p>
</div>
<div class="paragraph">
<div class="title">Infinispan 9.4 and earlier</div>
<p>Clients that use a Hot Rod protocol version that is higher than the Infinispan Server version must set the <code>infinispan.client.hotrod.protocol_version</code> property.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://infinispan.org/docs/stable/titles/hotrod_protocol/hotrod_protocol.html">Hot Rod protocol reference</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-endpoints_server-endpoints"><a class="anchor" href="#configuring-server-endpoints_server-endpoints"></a>3.2. Configuring Infinispan Server endpoints</h3>
<div class="paragraph">
<p>Control how the different protocol endpoints bind to sockets and use security realm configuration.
You can also configure multiple endpoints and disable administrative capabilities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each unique endpoint configuration must include both a Hot Rod connector and a REST connector.
Infinispan Server implicitly includes the <code>hotrod-connector</code> and <code>rest-connector</code> elements, or fields, in an <code>endpoint</code> configuration.
You should only add these elements to custom configuration to specify authentication mechanisms for endpoints.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add socket bindings and security realms to your Infinispan Server configuration.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Wrap multiple <code>endpoint</code> configurations with the <code>endpoints</code> element.</p>
</li>
<li>
<p>Specify the socket binding that the endpoint uses with the <code>socket-binding</code> attribute.</p>
</li>
<li>
<p>Specify the security realm that the endpoint uses with the <code>security-realm</code> attribute.</p>
</li>
<li>
<p>Disable administrator access with the <code>admin="false"</code> attribute, if required.</p>
<div class="paragraph">
<p>With this configuration users cannot access Infinispan Console or the Command Line Interface (CLI) from the endpoint.</p>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="multiple_endpoint_configuration" class="discrete">Multiple endpoint configuration</h4>
<div class="paragraph">
<p>The following Infinispan Server configuration creates endpoints on separate socket bindings with dedicated security realms:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="public"
              security-realm="application-realm"
              admin="false"&gt;
    &lt;/endpoint&gt;
    &lt;endpoint socket-binding="private"
              security-realm="management-realm"&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "endpoints": [{
      "socket-binding": "private",
      "security-realm": "private-realm"
    }, {
      "socket-binding": "public",
      "security-realm": "default",
      "admin": "false"
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  endpoints:
   - socketBinding: public
     securityRealm: application-realm
     admin: false
   - socketBinding: private
     securityRealm: management-realm</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#server-interfaces">Network interfaces and socket bindings</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="endpoint-connectors_server-endpoints"><a class="anchor" href="#endpoint-connectors_server-endpoints"></a>3.3. Endpoint connectors</h3>
<div class="paragraph">
<p>Connectors configure Hot Rod and REST endpoints to use socket bindings and security realms.</p>
</div>
<div class="listingblock">
<div class="title">Default endpoint configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;endpoints socket-binding="default" security-realm="default"/&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration element or attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endpoints</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wraps endpoint connector configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares a Infinispan Server endpoint that configures Hot Rod and REST connectors to use a socket binding and security realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hotrod-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes the Hot Rod endpoint in the <code>endpoint</code> configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rest-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes the REST endpoint in the <code>endpoint</code> configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resp-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes the RESP endpoint in the <code>endpoint</code> configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memcached-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes the Memcached endpoint in the <code>endpoint</code> configuration.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/">Infinispan schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="endpoint-ip-address-filters_server-endpoints"><a class="anchor" href="#endpoint-ip-address-filters_server-endpoints"></a>3.4. Endpoint IP address filtering rules</h3>
<div class="paragraph">
<p>Infinispan Server endpoints can use filtering rules that control whether clients can connect based on their IP addresses.
Infinispan Server applies filtering rules in order until it finds a match for the client IP address.</p>
</div>
<div class="paragraph">
<p>A CIDR block is a compact representation of an IP address and its associated network mask.
CIDR notation specifies an IP address, a slash ('/') character, and a decimal number.
The decimal number is the count of leading 1 bits in the network mask.
The number can also be thought of as the width, in bits, of the network prefix.
The IP address in CIDR notation is always represented according to the standards for IPv4 or IPv6.</p>
</div>
<div class="paragraph">
<p>The address can denote a specific interface address, including a host identifier, such as <code>10.0.0.1/8</code>, or it can be the beginning address of an entire network interface range using a host identifier of 0, as in <code>10.0.0.0/8</code> or <code>10/8</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>192.168.100.14/24</code> represents the IPv4 address <code>192.168.100.14</code> and its associated network prefix <code>192.168.100.0</code>,
or equivalently, its subnet mask <code>255.255.255.0</code>, which has 24 leading 1-bits.</p>
</li>
<li>
<p>the IPv4 block <code>192.168.100.0/22</code> represents the 1024 IPv4 addresses from <code>192.168.100.0</code> to <code>192.168.103.255</code>.</p>
</li>
<li>
<p>the IPv6 block <code>2001:db8::/48</code> represents the block of IPv6 addresses from <code>2001:db8:0:0:0:0:0:0</code> to
<code>2001:db8:0:ffff:ffff:ffff:ffff:ffff</code>.</p>
</li>
<li>
<p><code>::1/128</code> represents the IPv6 loopback address. Its prefix length is 128 which is the number of bits in the address.</p>
</li>
</ul>
</div>
<h4 id="ip_address_filter_configuration" class="discrete">IP address filter configuration</h4>
<div class="paragraph">
<p>In the following configuration, Infinispan Server accepts connections only from addresses in the <code>192.168.0.0/16</code> and <code>10.0.0.0/8</code> CIDR blocks.
Infinispan Server rejects all other connections.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default" security-realm="default"&gt;
      &lt;ip-filter&gt;
        &lt;accept from="192.168.0.0/16"/&gt;
        &lt;accept from="10.0.0.0/8"/&gt;
        &lt;reject from="/0"/&gt;
      &lt;/ip-filter&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "endpoints": {
      "endpoint": {
        "socket-binding": "default",
        "security-realm": "default",
        "ip-filter": {
          "accept-from": ["192.168.0.0/16", "10.0.0.0/8"],
          "reject-from": "/0"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "default"
      ipFilter:
        acceptFrom: ["192.168.0.0/16","10.0.0.0/8"]
        rejectFrom: "/0"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user_tool-server-endpoints"><a class="anchor" href="#user_tool-server-endpoints"></a>3.5. Inspecting and modifying rules for filtering IP addresses</h3>
<div class="paragraph">
<p>Configure IP address filtering rules on Infinispan Server endpoints to accept or reject connections based on client address.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install Infinispan Command Line Interface (CLI).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan Server.</p>
</li>
<li>
<p>Inspect and modify the IP filter rules <code class="command">server connector ipfilter</code> command as required.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>List all IP filtering rules active on a connector across the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server connector ipfilter ls endpoint-default</code></pre>
</div>
</div>
</li>
<li>
<p>Set IP filtering rules across the cluster.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This command replaces any existing rules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server connector ipfilter set endpoint-default --rules=ACCEPT/192.168.0.0/16,REJECT/10.0.0.0/8`</code></pre>
</div>
</div>
</li>
<li>
<p>Remove all IP filtering rules on a connector across the cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server connector ipfilter clear endpoint-default</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication-mechanisms"><a class="anchor" href="#authentication-mechanisms"></a>4. Endpoint authentication mechanisms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server can use custom SASL and HTTP authentication mechanisms for Hot Rod and REST endpoints.</p>
</div>
<div class="sect2">
<h3 id="server-authentication_endpoint-authentication"><a class="anchor" href="#server-authentication_endpoint-authentication"></a>4.1. Infinispan Server authentication</h3>
<div class="paragraph">
<p>Authentication restricts user access to endpoints as well as the Infinispan Console and Command Line Interface (CLI).</p>
</div>
<div class="paragraph">
<p>Infinispan Server includes a "default" security realm that enforces user authentication.
Default authentication uses a property realm with user credentials stored in the <code>server/conf/users.properties</code> file.
Infinispan Server also enables security authorization by default so you must assign users with permissions stored in the <code>server/conf/groups.properties</code> file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code class="command">user create</code> command with the Command Line Interface (CLI) to add users and assign permissions.
Run <code class="command">user create --help</code> for examples and more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-authentication_endpoint-authentication"><a class="anchor" href="#configuring-server-authentication_endpoint-authentication"></a>4.2. Configuring Infinispan Server authentication mechanisms</h3>
<div class="paragraph">
<p>You can explicitly configure Hot Rod and REST endpoints to use specific authentication mechanisms.
Configuring authentication mechanisms is required only if you need to explicitly override the default mechanisms for a security realm.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each <code>endpoint</code> section in your configuration must include <code>hotrod-connector</code> and <code>rest-connector</code> elements or fields.
For example, if you explicitly declare a <code>hotrod-connector</code> you must also declare a <code>rest-connector</code> even if it does not configure an authentication mechanism.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add security realms to your Infinispan Server configuration as required.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add an <code>endpoint</code> element or field and specify the security realm that it uses with the <code>security-realm</code> attribute.</p>
</li>
<li>
<p>Add a <code>hotrod-connector</code> element or field to configure the Hot Rod endpoint.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add an <code>authentication</code> element or field.</p>
</li>
<li>
<p>Specify SASL authentication mechanisms for the Hot Rod endpoint to use with the <code>sasl mechanisms</code> attribute.</p>
</li>
<li>
<p>If applicable, specify SASL quality of protection settings with the <code>qop</code> attribute.</p>
</li>
<li>
<p>Specify the Infinispan Server identity with the <code>server-name</code> attribute if necessary.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Add a <code>rest-connector</code> element or field to configure the REST endpoint.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add an <code>authentication</code> element or field.</p>
</li>
<li>
<p>Specify HTTP authentication mechanisms for the REST endpoint to use with the <code>mechanisms</code> attribute.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="authentication_mechanism_configuration" class="discrete">Authentication mechanism configuration</h4>
<div class="paragraph">
<p>The following configuration specifies SASL mechanisms for the Hot Rod endpoint to use for authentication:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="my-realm"&gt;
      &lt;hotrod-connector&gt;
        &lt;authentication&gt;
           &lt;sasl mechanisms="SCRAM-SHA-512 SCRAM-SHA-384 SCRAM-SHA-256
                             SCRAM-SHA-1 DIGEST-SHA-512 DIGEST-SHA-384
                             DIGEST-SHA-256 DIGEST-SHA DIGEST-MD5 PLAIN"
                 server-name="infinispan"
                 qop="auth"/&gt;
        &lt;/authentication&gt;
      &lt;/hotrod-connector&gt;
      &lt;rest-connector&gt;
        &lt;authentication mechanisms="DIGEST BASIC"/&gt;
      &lt;/rest-connector&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "endpoints": {
      "endpoint": {
        "socket-binding": "default",
        "security-realm": "my-realm",
        "hotrod-connector": {
          "authentication": {
            "security-realm": "default",
            "sasl": {
              "server-name": "infinispan",
              "mechanisms": ["SCRAM-SHA-512", "SCRAM-SHA-384", "SCRAM-SHA-256", "SCRAM-SHA-1", "DIGEST-SHA-512", "DIGEST-SHA-384", "DIGEST-SHA-256", "DIGEST-SHA", "DIGEST-MD5", "PLAIN"],
              "qop": ["auth"]
            }
          }
        },
        "rest-connector": {
          "authentication": {
            "mechanisms": ["DIGEST", "BASIC"],
            "security-realm": "default"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">server:
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "my-realm"
      hotrodConnector:
        authentication:
          securityRealm: "default"
          sasl:
            serverName: "infinispan"
            mechanisms:
              - "SCRAM-SHA-512"
              - "SCRAM-SHA-384"
              - "SCRAM-SHA-256"
              - "SCRAM-SHA-1"
              - "DIGEST-SHA-512"
              - "DIGEST-SHA-384"
              - "DIGEST-SHA-256"
              - "DIGEST-SHA"
              - "DIGEST-MD5"
              - "PLAIN"
            qop:
              - "auth"
      restConnector:
        authentication:
          mechanisms:
            - "DIGEST"
            - "BASIC"
          securityRealm: "default"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="disabling-authentication_endpoint-authentication"><a class="anchor" href="#disabling-authentication_endpoint-authentication"></a>4.2.1. Disabling authentication</h4>
<div class="paragraph">
<p>In local development environments or on isolated networks you can configure Infinispan to allow unauthenticated client requests.
When you disable user authentication you should also disable authorization in your Infinispan security configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Remove the <code>security-realm</code> attribute from the <code>endpoints</code> element or field.</p>
</li>
<li>
<p>Remove any <code>authorization</code> elements from the <code>security</code> configuration for the <code>cache-container</code> and each cache configuration.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;endpoints socket-binding="default"/&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "endpoints": {
      "endpoint": {
        "socket-binding": "default"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">server:
  endpoints:
    endpoint:
      socketBinding: "default"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-endpoint-authentication-mechanisms_endpoint-authentication"><a class="anchor" href="#server-endpoint-authentication-mechanisms_endpoint-authentication"></a>4.3. Infinispan Server authentication mechanisms</h3>
<div class="paragraph">
<p>Infinispan Server automatically configures endpoints with authentication mechanisms that match your security realm configuration.
For example, if you add a Kerberos security realm then Infinispan Server enables the <code>GSSAPI</code> and <code>GS2-KRB5</code> authentication mechanisms for the Hot Rod endpoint.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, you cannot use the Lightweight Directory Access Protocol (LDAP) protocol with the <code>DIGEST</code> or <code>SCRAM</code> authentication mechanisms, because these mechanisms require access to specific hashed passwords.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Hot Rod endpoints</div>
<p>Infinispan Server enables the following SASL authentication mechanisms for Hot Rod endpoints when your configuration includes the corresponding security realm:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">SASL authentication mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM</code>, <code>DIGEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code>, <code>GS2-KRB5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">REST endpoints</div>
<p>Infinispan Server enables the following HTTP authentication mechanisms for REST endpoints when your configuration includes the corresponding security realm:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">HTTP authentication mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEARER_TOKEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_CERT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPNEGO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BASIC</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Memcached endpoints</div>
<p>Infinispan Server enables the following SASL authentication mechanisms for Memcached binary protocol endpoints when your configuration includes the corresponding security realm:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">SASL authentication mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM</code>, <code>DIGEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI, GS2-KRB5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Infinispan Server enables authentication on Memcached text protocol endpoints only with security realms which support password-based authentication:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">Memcached text authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">RESP endpoints</div>
<p>Infinispan Server enables authentication on RESP endpoints only with security realms which support password-based authentication:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security realm</th>
<th class="tableblock halign-left valign-top">RESP authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="sasl-authentication-mechanisms_endpoint-authentication"><a class="anchor" href="#sasl-authentication-mechanisms_endpoint-authentication"></a>4.3.1. SASL authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan Server supports the following SASL authentications mechanisms with Hot Rod and Memcached binary protocol endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Security realm type</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>PLAIN</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BASIC</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. Hot Rod connectors support <code>DIGEST-MD5</code>, <code>DIGEST-SHA</code>, <code>DIGEST-SHA-256</code>, <code>DIGEST-SHA-384</code>, and <code>DIGEST-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>salt</em> values in addition to hashing algorithms and nonce values. Hot Rod connectors support <code>SCRAM-SHA</code>, <code>SCRAM-SHA-256</code>, <code>SCRAM-SHA-384</code>, and <code>SCRAM-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GS2-KRB5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>CLIENT_CERT</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BEARER_TOKEN</code> HTTP mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sasl-quality-of-protection_endpoint-authentication"><a class="anchor" href="#sasl-quality-of-protection_endpoint-authentication"></a>4.3.2. SASL quality of protection (QoP)</h4>
<div class="paragraph">
<p>If SASL mechanisms support integrity and privacy protection (QoP) settings, you can add them to your Hot Rod and Memcached endpoint configuration with the <code>qop</code> attribute.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">QoP setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity protection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity and privacy protection.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sasl-policies-hot-rod-authentication_endpoint-authentication"><a class="anchor" href="#sasl-policies-hot-rod-authentication_endpoint-authentication"></a>4.3.3. SASL policies</h4>
<div class="paragraph">
<p>SASL policies provide fine-grain control over Hot Rod and Memcached authentication mechanisms.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan cache authorization restricts access to caches based on roles and
permissions.
Configure cache authorization and then set <code>&lt;no-anonymous value=false /&gt;</code> to allow anonymous login and delegate access logic to cache authorization.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forward-secrecy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use only SASL mechanisms that support forward secrecy between sessions. This means that breaking into one session does not automatically provide information for breaking into future sessions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pass-credentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use only SASL mechanisms that require client credentials.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-plain-text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to simple plain passive attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to active, non-dictionary, attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-dictionary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to passive dictionary attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-anonymous</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that accept anonymous logins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<h5 id="sasl_policy_configuration" class="discrete">SASL policy configuration</h5>
<div class="paragraph">
<p>In the following configuration the Hot Rod endpoint uses the <code>GSSAPI</code> mechanism for authentication because it is the only mechanism that complies with all SASL policies:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="default"&gt;
      &lt;hotrod-connector&gt;
        &lt;authentication&gt;
          &lt;sasl mechanisms="PLAIN DIGEST-MD5 GSSAPI EXTERNAL"
                server-name="infinispan"
                qop="auth"
                policy="no-active no-plain-text"/&gt;
        &lt;/authentication&gt;
      &lt;/hotrod-connector&gt;
      &lt;rest-connector/&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "endpoints" : {
      "endpoint" : {
        "socket-binding" : "default",
        "security-realm" : "default",
        "hotrod-connector" : {
          "authentication" : {
            "sasl" : {
              "server-name" : "infinispan",
              "mechanisms" : [ "PLAIN","DIGEST-MD5","GSSAPI","EXTERNAL" ],
              "qop" : [ "auth" ],
              "policy" : [ "no-active","no-plain-text" ]
            }
          }
        },
        "rest-connector" : ""
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "default"
      hotrodConnector:
        authentication:
          sasl:
            serverName: "infinispan"
            mechanisms:
              - "PLAIN"
              - "DIGEST-MD5"
              - "GSSAPI"
              - "EXTERNAL"
            qop:
              - "auth"
            policy:
              - "no-active"
              - "no-plain-text"
      restConnector: ~</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest-authentication-mechanisms_endpoint-authentication"><a class="anchor" href="#rest-authentication-mechanisms_endpoint-authentication"></a>4.3.4. HTTP authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan Server supports the following HTTP authentication mechanisms with REST endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Security realm type</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BASIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>BASIC</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Basic</code> HTTP authentication scheme and is similar to the <code>PLAIN</code> SASL mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. REST connectors support <code>SHA-512</code>, <code>SHA-256</code> and <code>MD5</code> hashing algorithms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property realms and LDAP realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Digest</code> HTTP authentication scheme and is similar to <code>DIGEST-*</code> SASL mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPNEGO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Negotiate</code> HTTP authentication scheme and is similar to the <code>GSSAPI</code> and <code>GS2-KRB5</code> SASL mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEARER_TOKEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Bearer</code> HTTP authentication scheme and is similar to <code>OAUTHBEARER</code> SASL mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_CERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>EXTERNAL</code> SASL mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-realms"><a class="anchor" href="#security-realms"></a>5. Security realms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security realms integrate Infinispan Server deployments with the network protocols and infrastructure in your environment that control access and verify user identities.</p>
</div>
<div class="sect2">
<h3 id="creating-security-realms_security-realms"><a class="anchor" href="#creating-security-realms_security-realms"></a>5.1. Creating security realms</h3>
<div class="paragraph">
<p>Add security realms to Infinispan Server configuration to control access to deployments.
You can add one or more security realm to your configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you add security realms to your configuration, Infinispan Server automatically enables the matching authentication mechanisms for the Hot Rod and REST endpoints.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add socket bindings to your Infinispan Server configuration as required.</p>
</li>
<li>
<p>Create keystores, or have a PEM file, to configure the security realm with TLS/SSL encryption.</p>
<div class="paragraph">
<p>Infinispan Server can also generate keystores at startup.</p>
</div>
</li>
<li>
<p>Provision the resources or services that the security realm configuration relies on.<br>
For example, if you add a token realm, you need to provision OAuth services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure demonstrates how to configure multiple property realms.
Before you begin, you need to create properties files that add users and assign permissions with the Command Line Interface (CLI).
Use the <code class="command">user create</code> commands as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user create &lt;username&gt; -p &lt;changeme&gt; -g &lt;role&gt; \
     --users-file=application-users.properties \
     --groups-file=application-groups.properties

user create &lt;username&gt; -p &lt;changeme&gt; -g &lt;role&gt; \
     --users-file=management-users.properties \
     --groups-file=management-groups.properties</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code class="command">user create --help</code> for examples and more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Adding credentials to a properties realm with the CLI creates the user only on the server instance to which you are connected.
You must manually synchronize credentials in a properties realm to each node in the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Use the <code>security-realms</code> element in the <code>security</code> configuration to contain create multiple security realms.</p>
</li>
<li>
<p>Add a security realm with the <code>security-realm</code> element and give it a unique name with the <code>name</code> attribute.</p>
<div class="paragraph">
<p>To follow the example, create one security realm named <code>application-realm</code> and another named <code>management-realm</code>.</p>
</div>
</li>
<li>
<p>Provide the TLS/SSL identify for Infinispan Server with the <code>server-identities</code> element and configure a keystore as required.</p>
</li>
<li>
<p>Specify the type of security realm by adding one the following elements or fields:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties-realm</code></p>
</li>
<li>
<p><code>ldap-realm</code></p>
</li>
<li>
<p><code>token-realm</code></p>
</li>
<li>
<p><code>truststore-realm</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Specify properties for the type of security realm you are configuring as appropriate.</p>
<div class="paragraph">
<p>To follow the example, specify the <code>*.properties</code> files you created with the CLI using the <code>path</code> attribute on the <code>user-properties</code> and <code>group-properties</code> elements or fields.</p>
</div>
</li>
<li>
<p>If you add multiple different types of security realm to your configuration, include the <code>distributed-realm</code> element or field so that Infinispan Server uses the realms in combination with each other.</p>
</li>
<li>
<p>Configure Infinispan Server endpoints to use the security realm with the with the <code>security-realm</code> attribute.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="multiple_property_realms" class="discrete">Multiple property realms</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="application-realm"&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="application-users.properties"/&gt;
          &lt;group-properties path="application-groups.properties"/&gt;
        &lt;/properties-realm&gt;
      &lt;/security-realm&gt;
      &lt;security-realm name="management-realm"&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="management-users.properties"/&gt;
          &lt;group-properties path="management-groups.properties"/&gt;
        &lt;/properties-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "management-realm",
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "management-realm",
            "path": "management-users.properties"
          },
          "group-properties": {
            "path": "management-groups.properties"
          }
        }
      }, {
        "name": "application-realm",
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "application-realm",
            "path": "application-users.properties"
          },
          "group-properties": {
            "path": "application-groups.properties"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "management-realm"
        propertiesRealm:
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "management-realm"
            path: "management-users.properties"
          groupProperties:
            path: "management-groups.properties"
      - name: "application-realm"
        propertiesRealm:
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "application-realm"
            path: "application-users.properties"
          groupProperties:
            path: "application-groups.properties"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-kerberos-identities_security-realms"><a class="anchor" href="#setting-up-kerberos-identities_security-realms"></a>5.2. Setting up Kerberos identities</h3>
<div class="paragraph">
<p>Add Kerberos identities to a security realm in your Infinispan Server configuration to use <em>keytab</em> files that contain service principal names and encrypted keys, derived from Kerberos passwords.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have Kerberos service account principals.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>keytab</em> files can contain both user and service account principals.
However, Infinispan Server uses service account principals only which means it can provide identity to clients and allow clients to authenticate with Kerberos servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In most cases, you create unique principals for the Hot Rod and REST endpoints.
For example, if you have a "datagrid" server in the "INFINISPAN.ORG" domain you should create the following service principals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hotrod/datagrid@INFINISPAN.ORG</code> identifies the Hot Rod service.</p>
</li>
<li>
<p><code>HTTP/datagrid@INFINISPAN.ORG</code> identifies the REST service.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create keytab files for the Hot Rod and REST services.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ktutil
ktutil:  addent -password -p datagrid@INFINISPAN.ORG -k 1 -e aes256-cts
Password for datagrid@INFINISPAN.ORG: [enter your password]
ktutil:  wkt http.keytab
ktutil:  quit</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ktpass -princ HTTP/datagrid@INFINISPAN.ORG -pass * -mapuser INFINISPAN\USER_NAME
ktab -k http.keytab -a HTTP/datagrid@INFINISPAN.ORG</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Copy the keytab files to the <code>server/conf</code> directory of your Infinispan Server installation.</p>
</li>
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan server security realm.</p>
</li>
<li>
<p>Specify the location of keytab files that provide service principals to Hot Rod and REST connectors.</p>
</li>
<li>
<p>Name the Kerberos service principals.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="kerberos_identity_configuration" class="discrete">Kerberos identity configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="kerberos-realm"&gt;
        &lt;server-identities&gt;
          &lt;!-- Specifies a keytab file that provides a Kerberos identity. --&gt;
          &lt;!-- Names the Kerberos service principal for the Hot Rod endpoint. --&gt;
          &lt;!-- The required="true" attribute specifies that the keytab file must be present when the server starts. --&gt;
          &lt;kerberos keytab-path="hotrod.keytab"
                    principal="hotrod/datagrid@INFINISPAN.ORG"
                    required="true"/&gt;
          &lt;!-- Specifies a keytab file and names the Kerberos service principal for the REST endpoint. --&gt;
          &lt;kerberos keytab-path="http.keytab"
                    principal="HTTP/localhost@INFINISPAN.ORG"
                    required="true"/&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="kerberos-realm"&gt;
     &lt;hotrod-connector&gt;
        &lt;authentication&gt;
           &lt;sasl server-name="datagrid"
                 server-principal="hotrod/datagrid@INFINISPAN.ORG"/&gt;
        &lt;/authentication&gt;
     &lt;/hotrod-connector&gt;
     &lt;rest-connector&gt;
       &lt;authentication server-principal="HTTP/localhost@INFINISPAN.ORG"/&gt;
     &lt;/rest-connector&gt;
   &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "kerberos-realm",
        "server-identities": [{
          "kerberos": {
            "principal": "hotrod/datagrid@INFINISPAN.ORG",
            "keytab-path": "hotrod.keytab",
            "required": true
          },
          "kerberos": {
            "principal": "HTTP/localhost@INFINISPAN.ORG",
            "keytab-path": "http.keytab",
            "required": true
          }
        }]
      }]
    },
    "endpoints": {
      "endpoint": {
        "socket-binding": "default",
        "security-realm": "kerberos-realm",
        "hotrod-connector": {
          "authentication": {
            "security-realm": "kerberos-realm",
            "sasl": {
              "server-name": "datagrid",
              "server-principal": "hotrod/datagrid@INFINISPAN.ORG"
            }
          }
        },
        "rest-connector": {
          "authentication": {
            "server-principal": "HTTP/localhost@INFINISPAN.ORG"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "kerberos-realm"
        serverIdentities:
          - kerberos:
              principal: "hotrod/datagrid@INFINISPAN.ORG"
              keytabPath: "hotrod.keytab"
              required: "true"
          - kerberos:
              principal: "HTTP/localhost@INFINISPAN.ORG"
              keytabPath: "http.keytab"
              required: "true"
  endpoints:
    endpoint:
      socketBinding: "default"
      securityRealm: "kerberos-realm"
      hotrodConnector:
        authentication:
          sasl:
            serverName: "datagrid"
            serverPrincipal: "hotrod/datagrid@INFINISPAN.ORG"
      restConnector:
        authentication:
          securityRealm: "kerberos-realm"
          serverPrincipal" : "HTTP/localhost@INFINISPAN.ORG"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="property-security-realms_security-realms"><a class="anchor" href="#property-security-realms_security-realms"></a>5.3. Property realms</h3>
<div class="paragraph">
<p>Property realms use property files to define users and groups.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>users.properties</code> contains Infinispan user credentials.
Passwords can be pre-digested with the <code>DIGEST-MD5</code> and <code>DIGEST</code> authentication mechanisms.</p>
</li>
<li>
<p><code>groups.properties</code> associates users with roles and permissions.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">users.properties</div>
<div class="content">
<pre class="highlight nowrap"><code>myuser=a_password
user2=another_password</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">groups.properties</div>
<div class="content">
<pre class="highlight nowrap"><code>myuser=supervisor,reader,writer
user2=supervisor</code></pre>
</div>
</div>
<h4 id="property_realm_configuration" class="discrete">Property realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;!-- groups-attribute configures the "groups.properties" file to contain security authorization roles. --&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="users.properties"
                           relative-to="infinispan.server.config.path"
                           plain-text="true"/&gt;
          &lt;group-properties path="groups.properties"
                            relative-to="infinispan.server.config.path"/&gt;
        &lt;/properties-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "default",
            "path": "users.properties",
            "relative-to": "infinispan.server.config.path",
            "plain-text": true
          },
          "group-properties": {
            "path": "groups.properties",
            "relative-to": "infinispan.server.config.path"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        propertiesRealm:
          # groupsAttribute configures the "groups.properties" file
          # to contain security authorization roles.
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "default"
            path: "users.properties"
            relative-to: 'infinispan.server.config.path'
            plainText: "true"
          groupProperties:
            path: "groups.properties"
            relative-to: 'infinispan.server.config.path'</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="property_realm_file_structure"><a class="anchor" href="#property_realm_file_structure"></a>5.3.1. Property realm file structure</h4>
<div class="paragraph">
<p>User properties files are structured as follows:</p>
</div>
<div class="listingblock">
<div class="title">users.properties structure</div>
<div class="content">
<pre class="highlight nowrap"><code>#$REALM_NAME=default$
#$ALGORITHM=encrypted$
#Wed Jul 31 08:32:08 CEST 2024
admin=algorithm-1\:hash-1;algorithm-2\:hash-2;...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first three lines are special comments that define the name of the realm (<code>$REALM_NAME</code>), whether the passwords are
stored in <code>clear</code> or <code>encrypted</code> format (<code>$ALGORITHM</code>) and the timestamp of the last update.</p>
</div>
<div class="paragraph">
<p>User credentials are stored in traditional key/value format: the key corresponds to the username and the value
corresponds to the password. Encrypted passwords are represented as semi-colon-separated algorithm/hash pairs, with the
hash encoded in Base64.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Credentials are encrypted using the realm name. Changing a realm&#8217;s name requires re-encrypting all the passwords.
Use the Infinispan CLI to enter the correct security realm name to the file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap-security-realms_security-realms"><a class="anchor" href="#ldap-security-realms_security-realms"></a>5.4. LDAP realms</h3>
<div class="paragraph">
<p>LDAP realms connect to LDAP servers, such as OpenLDAP, Red Hat Directory
Server, Apache Directory Server, or Microsoft Active Directory, to authenticate
users and obtain membership information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LDAP servers can have different entry layouts, depending on the type of server and deployment.
It is beyond the scope of this document to provide examples for all possible configurations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ldap_connection_properties"><a class="anchor" href="#ldap_connection_properties"></a>5.4.1. LDAP connection properties</h4>
<div class="paragraph">
<p>Specify the LDAP connection properties in the LDAP realm configuration.</p>
</div>
<div class="paragraph">
<p>The following properties are required:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
url
</td>
<td class="hdlist2">
<p>Specifies the URL of the LDAP server. The URL should be in format <code>ldap://hostname:port</code> or <code>ldaps://hostname:port</code> for secure connections using TLS.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
principal
</td>
<td class="hdlist2">
<p>Specifies a distinguished name (DN) of a valid user in the LDAp server. The DN uniquely identifies the user within the LDAP directory structure.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
credential
</td>
<td class="hdlist2">
<p>Corresponds to the password associated with the principal mentioned above.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The principal for LDAP connections must have necessary privileges to perform LDAP queries and access specific attributes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enabling <code>connection-pooling</code> significantly improves the performance of authentication to LDAP servers.
The connection pooling mechanism is provided by the JDK. For more information see <a href="https://docs.oracle.com/javase/jndi/tutorial/ldap/connect/config.html">Connection Pooling Configuration</a> and <a href="https://docs.oracle.com/javase/tutorial/jndi/ldap/pool.html">Java Tutorials: Pooling</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ldap_realm_user_authentication_methods"><a class="anchor" href="#ldap_realm_user_authentication_methods"></a>5.4.2. LDAP realm user authentication methods</h4>
<div class="paragraph">
<p>Configure the user authentication method in the LDAP realm.</p>
</div>
<div class="paragraph">
<p>The LDAP realm can authenticate users in two ways:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Hashed password comparison
</td>
<td class="hdlist2">
<p>by comparing the hashed password stored in a user&#8217;s password attribute (usually <code>userPassword</code>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Direct verification
</td>
<td class="hdlist2">
<p>by authenticating against the LDAP server using the supplied credentials</p>
<div class="paragraph">
<p>Direct verification is the only approach that works with Active Directory, because access to the <code>password</code> attribute is forbidden.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot use endpoint authentication mechanisms that performs hashing with the <code>direct-verification</code> attribute, since this method requires having the password in clear text.
As a result you must use the <code>BASIC</code> authentication mechanism with the REST endpoint and <code>PLAIN</code> with the Hot Rod endpoint to integrate with Active Directory Server.
A more secure alternative is to use Kerberos, which allows the <code>SPNEGO</code>, <code>GSSAPI</code>, and <code>GS2-KRB5</code> authentication mechanisms.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The LDAP realm searches the directory to find the entry which corresponds to the authenticated user.
The <code>rdn-identifier</code> attribute specifies an LDAP attribute that finds the user entry based on a provided identifier, which is typically a username; for example, the <code>uid</code> or <code>sAMAccountName</code> attribute.
Add <code>search-recursive="true"</code> to the configuration to search the directory recursively.
By default, the search for the user entry uses the <code>(rdn_identifier={0})</code> filter.
You can specify a different filter using the <code>filter-name</code> attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping_user_entries_to_their_associated_groups"><a class="anchor" href="#mapping_user_entries_to_their_associated_groups"></a>5.4.3. Mapping user entries to their associated groups</h4>
<div class="paragraph">
<p>In the LDAP realm configuration, specify the <code>attribute-mapping</code> element to retrieve and associate all groups that a user is a member of.</p>
</div>
<div class="paragraph">
<p>The membership information is stored typically in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under group entries that usually have class <code>groupOfNames</code> or <code>groupOfUniqueNames</code> in the <code>member</code> attribute. This is the default behavior in most LDAP installations, except for Active Directory. In this case, you can use an attribute filter. This filter searches for entries that match the supplied filter, which locates groups with a <code>member</code> attribute equal to the user&#8217;s DN. The filter then extracts the group entry&#8217;s CN as specified by <code>from</code>, and adds it to the user&#8217;s <code>Roles</code>.</p>
</li>
<li>
<p>In the user entry in the <code>memberOf</code> attribute. This is typically the case for Active Directory. In this case you should use an attribute reference such as the following:</p>
<div class="paragraph">
<p><code>&lt;attribute-reference reference="memberOf" from="cn" to="Roles" /&gt;</code></p>
</div>
<div class="paragraph">
<p>This reference gets all <code>memberOf</code> attributes from the user&#8217;s entry, extracts the CN as specified by <code>from</code>, and adds them to the user&#8217;s groups (<code>Roles</code> is the internal name used to map the groups).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ldap_realm_configuration_reference"><a class="anchor" href="#ldap_realm_configuration_reference"></a>5.4.4. LDAP realm configuration reference</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;!-- Specifies connection properties. --&gt;
        &lt;ldap-realm url="ldap://my-ldap-server:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"
                    connection-timeout="3000"
                    read-timeout="30000"
                    connection-pooling="true"
                    referral-mode="ignore"
                    page-size="30"
                    direct-verification="true"&gt;
          &lt;!-- Defines how principals are mapped to LDAP entries. --&gt;
          &lt;identity-mapping rdn-identifier="uid"
                            search-dn="ou=People,dc=infinispan,dc=org"
                            search-recursive="false"&gt;
            &lt;!-- Retrieves all the groups of which the user is a member. --&gt;
            &lt;attribute-mapping&gt;
              &lt;attribute from="cn" to="Roles"
                         filter="(&amp;amp;(objectClass=groupOfNames)(member={1}))"
                         filter-dn="ou=Roles,dc=infinispan,dc=org"/&gt;
            &lt;/attribute-mapping&gt;
          &lt;/identity-mapping&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "url": "ldap://my-ldap-server:10389",
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "credential": "strongPassword",
          "connection-timeout": "3000",
          "read-timeout": "30000",
          "connection-pooling": "true",
          "referral-mode": "ignore",
          "page-size": "30",
          "direct-verification": "true",
          "identity-mapping": {
            "rdn-identifier": "uid",
            "search-dn": "ou=People,dc=infinispan,dc=org",
            "search-recursive": "false",
            "attribute-mapping": [{
              "from": "cn",
              "to": "Roles",
              "filter": "(&amp;(objectClass=groupOfNames)(member={1}))",
              "filter-dn": "ou=Roles,dc=infinispan,dc=org"
            }]
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: ldap-realm
        ldapRealm:
          url: 'ldap://my-ldap-server:10389'
          principal: 'uid=admin,ou=People,dc=infinispan,dc=org'
          credential: strongPassword
          connectionTimeout: '3000'
          readTimeout: '30000'
          connectionPooling: true
          referralMode: ignore
          pageSize: '30'
          directVerification: true
          identityMapping:
            rdnIdentifier: uid
            searchDn: 'ou=People,dc=infinispan,dc=org'
            searchRecursive: false
            attributeMapping:
              - filter: '(&amp;(objectClass=groupOfNames)(member={1}))'
                filterDn: 'ou=Roles,dc=infinispan,dc=org'
                from: cn
                to: Roles</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="ldap-realm-principal-rewriting_security-realms"><a class="anchor" href="#ldap-realm-principal-rewriting_security-realms"></a>LDAP realm principal rewriting</h5>
<div class="paragraph">
<p>Principals obtained by SASL authentication mechanisms such as <code>GSSAPI</code>, <code>GS2-KRB5</code> and <code>Negotiate</code> usually include the domain name, for example <code>myuser@INFINISPAN.ORG</code>.
Before using these principals in LDAP queries, it is necessary to transform them to ensure their compatibility.
This process is called rewriting.</p>
</div>
<div class="paragraph">
<p>Infinispan includes the following transformers:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
case-principal-transformer
</td>
<td class="hdlist2">
<p>rewrites the principal to either all uppercase or all lowercase. For example <code>MyUser</code> would be rewritten as <code>MYUSER</code> in uppercase mode and <code>myuser</code> in lowercase mode.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
common-name-principal-transformer
</td>
<td class="hdlist2">
<p>rewrites principals in the LDAP Distinguished Name format (as defined by <a href="https://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a>). It extracts the first attribute of type <code>CN</code> (commonName). For example, <code>DN=CN=myuser,OU=myorg,DC=mydomain</code> would be rewritten as <code>myuser</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
regex-principal-transformer
</td>
<td class="hdlist2">
<p>rewrites principals using a regular expression with capturing groups, allowing, for example, for extractions of any substring.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="ldap_principal_rewriting_configuration_reference"><a class="anchor" href="#ldap_principal_rewriting_configuration_reference"></a>LDAP principal rewriting configuration reference</h5>
<h5 id="case_principal_transformer" class="discrete">Case principal transformer</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;ldap-realm url="ldap://${org.infinispan.test.host.address}:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;name-rewriter&gt;
            &lt;!-- Defines a rewriter that transforms usernames to lowercase --&gt;
            &lt;case-principal-transformer uppercase="false"/&gt;
          &lt;/name-rewriter&gt;
          &lt;!-- further configuration omitted --&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://${org.infinispan.test.host.address}:10389",
          "credential": "strongPassword",
          "name-rewriter": {
            "case-principal-transformer": {
              "uppercase": false
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "ldap-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://${org.infinispan.test.host.address}:10389"
          credential: "strongPassword"
          nameRewriter:
            casePrincipalTransformer:
              uppercase: false
          # further configuration omitted</code></pre>
</div>
</div>
<h5 id="common_name_principal_transformer" class="discrete">Common name principal transformer</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;ldap-realm url="ldap://${org.infinispan.test.host.address}:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;name-rewriter&gt;
            &lt;!-- Defines a rewriter that obtains the first CN from a DN --&gt;
            &lt;common-name-principal-transformer /&gt;
          &lt;/name-rewriter&gt;
          &lt;!-- further configuration omitted --&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://${org.infinispan.test.host.address}:10389",
          "credential": "strongPassword",
          "name-rewriter": {
            "common-name-principal-transformer": {}
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "ldap-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://${org.infinispan.test.host.address}:10389"
          credential: "strongPassword"
          nameRewriter:
            commonNamePrincipalTransformer: ~
          # further configuration omitted</code></pre>
</div>
</div>
<h5 id="regex_principal_transformer" class="discrete">Regex principal transformer</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ldap-realm"&gt;
        &lt;ldap-realm url="ldap://${org.infinispan.test.host.address}:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;name-rewriter&gt;
            &lt;!-- Defines a rewriter that extracts the username from the principal using a regular expression. --&gt;
            &lt;regex-principal-transformer pattern="(.*)@INFINISPAN\.ORG"
                                         replacement="$1"/&gt;
          &lt;/name-rewriter&gt;
          &lt;!-- further configuration omitted --&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "ldap-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://${org.infinispan.test.host.address}:10389",
          "credential": "strongPassword",
          "name-rewriter": {
            "regex-principal-transformer": {
              "pattern": "(.*)@INFINISPAN\\.ORG",
              "replacement": "$1"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "ldap-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://${org.infinispan.test.host.address}:10389"
          credential: "strongPassword"
          nameRewriter:
            regexPrincipalTransformer:
              pattern: (.*)@INFINISPAN\.ORG
              replacement: "$1"
          # further configuration omitted</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ldap_user_and_group_mapping_process_with_infinispan"><a class="anchor" href="#ldap_user_and_group_mapping_process_with_infinispan"></a>LDAP user and group mapping process with Infinispan</h5>
<div class="paragraph">
<p>This example illustrates the process of loading and internally mapping LDAP users and groups to Infinispan subjects.
The following is a LDIF (LDAP Data Interchange Format) file, which describes multiple LDAP entries:</p>
</div>
<div class="listingblock">
<div class="title">LDIF</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-ldif" data-lang="ldif"># Users

dn: uid=root,ou=People,dc=infinispan,dc=org
objectclass: top
objectclass: uidObject
objectclass: person
uid: root
cn: root
sn: root
userPassword: strongPassword

# Groups

dn: cn=admin,ou=Roles,dc=infinispan,dc=org
objectClass: top
objectClass: groupOfNames
cn: admin
description: the Infinispan admin group
member: uid=root,ou=People,dc=infinispan,dc=org

dn: cn=monitor,ou=Roles,dc=infinispan,dc=org
objectClass: top
objectClass: groupOfNames
cn: monitor
description: the Infinispan monitor group
member: uid=root,ou=People,dc=infinispan,dc=org</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>root</code> user is a member of the <code>admin</code> and <code>monitor</code> groups.</p>
</div>
<div class="paragraph">
<p>When a request to authenticate the user <code>root</code> with the password <code>strongPassword</code> is made on one of the endpoints, the following operations are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The username is optionally rewritten using the chosen principal transformer.</p>
</li>
<li>
<p>The realm searches within the <code>ou=People,dc=infinispan,dc=org</code> tree for an entry whose <code>uid</code> attribute is equal to <code>root</code> and finds the entry with DN <code>uid=root,ou=People,dc=infinispan,dc=org</code>, which becomes the user principal.</p>
</li>
<li>
<p>The realm searches within the <code>u=Roles,dc=infinispan,dc=org</code> tree for entries of <code>objectClass=groupOfNames</code> that include <code>uid=root,ou=People,dc=infinispan,dc=org</code> in the <code>member</code> attribute. In this case it finds two entries:
<code>cn=admin,ou=Roles,dc=infinispan,dc=org</code> and <code>cn=monitor,ou=Roles,dc=infinispan,dc=org</code>. From these entries, it extracts the <code>cn</code> attributes which become the group principals.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resulting subject will therefore look like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NamePrincipal: <code>uid=root,ou=People,dc=infinispan,dc=org</code></p>
</li>
<li>
<p>RolePrincipal: <code>admin</code></p>
</li>
<li>
<p>RolePrincipal: <code>monitor</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, the global authorization mappers are applied on the above subject to convert the principals into roles.
The roles are then expanded into a set of permissions, which are validated against the requested cache and operation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token-security-realms_security-realms"><a class="anchor" href="#token-security-realms_security-realms"></a>5.5. Token realms</h3>
<div class="paragraph">
<p>Token realms use external services to validate tokens and require providers
that are compatible with RFC-7662 (OAuth2 Token Introspection), such as
KeyCloak.</p>
</div>
<h4 id="token_realm_configuration" class="discrete">Token realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="token-realm"&gt;
        &lt;!-- Specifies the URL of the authentication server. --&gt;
        &lt;token-realm name="token"
                     auth-server-url="https://oauth-server/auth/"&gt;
          &lt;!-- Specifies the URL of the token introspection endpoint. --&gt;
          &lt;oauth2-introspection introspection-url="https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect"
                                client-id="infinispan-server"
                                client-secret="1fdca4ec-c416-47e0-867a-3d471af7050f"/&gt;
        &lt;/token-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "token-realm",
        "token-realm": {
          "auth-server-url": "https://oauth-server/auth/",
          "oauth2-introspection": {
            "client-id": "infinispan-server",
            "client-secret": "1fdca4ec-c416-47e0-867a-3d471af7050f",
            "introspection-url": "https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: token-realm
        tokenRealm:
          authServerUrl: 'https://oauth-server/auth/'
          oauth2Introspection:
            clientId: infinispan-server
            clientSecret: '1fdca4ec-c416-47e0-867a-3d471af7050f'
            introspectionUrl: 'https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trust-store-security-realms_security-realms"><a class="anchor" href="#trust-store-security-realms_security-realms"></a>5.6. Trust store realms</h3>
<div class="paragraph">
<p>Trust store realms use certificates, or certificates chains, that verify Infinispan Server and client identities when they negotiate connections.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Keystores</dt>
<dd>
<p>Contain server certificates that provide a Infinispan Server identity to clients. If you configure a keystore with server certificates, Infinispan Server encrypts traffic using industry standard SSL/TLS protocols.</p>
</dd>
<dt class="hdlist1">Trust stores</dt>
<dd>
<p>Contain client certificates, or certificate chains, that clients present to Infinispan Server. Client trust stores are optional and allow Infinispan Server to perform client certificate authentication.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Client certificate authentication</div>
<p>You must add the <code>require-ssl-client-auth="true"</code> attribute to the endpoint configuration if you want Infinispan Server to validate or authenticate client certificates.</p>
</div>
<h4 id="trust_store_realm_configuration" class="discrete">Trust store realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="trust-store-realm"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Provides an SSL/TLS identity with a keystore that contains server certificates. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      keystore-password="secret"
                      alias="server"/&gt;
            &lt;!-- Configures a trust store that contains client certificates or part of a certificate chain. --&gt;
            &lt;truststore path="trust.p12"
                        relative-to="infinispan.server.config.path"
                        password="secret"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
        &lt;!-- Authenticates client certificates against the trust store. If you configure this, the trust store must contain the public certificates for all clients. --&gt;
        &lt;truststore-realm/&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "trust-store-realm",
        "server-identities": {
          "ssl": {
            "keystore": {
              "path": "server.p12",
              "relative-to": "infinispan.server.config.path",
              "keystore-password": "secret",
              "alias": "server"
            },
            "truststore": {
              "path": "trust.p12",
              "relative-to": "infinispan.server.config.path",
              "password": "secret"
            }
          }
        },
        "truststore-realm": {}
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "trust-store-realm"
        serverIdentities:
          ssl:
            keystore:
              path: "server.p12"
              relative-to: "infinispan.server.config.path"
              keystore-password: "secret"
              alias: "server"
            truststore:
              path: "trust.p12"
              relative-to: "infinispan.server.config.path"
              password: "secret"
        truststoreRealm: ~</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distributed-security-realms_security-realms"><a class="anchor" href="#distributed-security-realms_security-realms"></a>5.7. Distributed security realms</h3>
<div class="paragraph">
<p>Distributed realms combine multiple different types of security realms.
When users attempt to access the Hot Rod or REST endpoints, Infinispan Server uses each security realm in turn until it finds one that can perform the authentication.</p>
</div>
<h4 id="distributed_realm_configuration" class="discrete">Distributed realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="distributed-realm"&gt;
        &lt;ldap-realm url="ldap://my-ldap-server:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"
                    credential="strongPassword"&gt;
          &lt;identity-mapping rdn-identifier="uid"
                            search-dn="ou=People,dc=infinispan,dc=org"
                            search-recursive="false"&gt;
            &lt;attribute-mapping&gt;
              &lt;attribute from="cn" to="Roles"
                         filter="(&amp;amp;(objectClass=groupOfNames)(member={1}))"
                         filter-dn="ou=Roles,dc=infinispan,dc=org"/&gt;
            &lt;/attribute-mapping&gt;
          &lt;/identity-mapping&gt;
        &lt;/ldap-realm&gt;
        &lt;properties-realm groups-attribute="Roles"&gt;
          &lt;user-properties path="users.properties"
                           relative-to="infinispan.server.config.path"/&gt;
          &lt;group-properties path="groups.properties"
                            relative-to="infinispan.server.config.path"/&gt;
        &lt;/properties-realm&gt;
        &lt;distributed-realm/&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "distributed-realm",
        "ldap-realm": {
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "url": "ldap://my-ldap-server:10389",
          "credential": "strongPassword",
          "identity-mapping": {
            "rdn-identifier": "uid",
            "search-dn": "ou=People,dc=infinispan,dc=org",
            "search-recursive": false,
            "attribute-mapping": {
              "attribute": {
                "filter": "(&amp;(objectClass=groupOfNames)(member={1}))",
                "filter-dn": "ou=Roles,dc=infinispan,dc=org",
                "from": "cn",
                "to": "Roles"
              }
            }
          }
        },
        "properties-realm": {
          "groups-attribute": "Roles",
          "user-properties": {
            "digest-realm-name": "distributed-realm",
            "path": "users.properties"
          },
          "group-properties": {
            "path": "groups.properties"
          }
        },
        "distributed-realm": {}
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "distributed-realm"
        ldapRealm:
          principal: "uid=admin,ou=People,dc=infinispan,dc=org"
          url: "ldap://my-ldap-server:10389"
          credential: "strongPassword"
          identityMapping:
            rdnIdentifier: "uid"
            searchDn: "ou=People,dc=infinispan,dc=org"
            searchRecursive: "false"
            attributeMapping:
              attribute:
                filter: "(&amp;(objectClass=groupOfNames)(member={1}))"
                filterDn: "ou=Roles,dc=infinispan,dc=org"
                from: "cn"
                to: "Roles"
        propertiesRealm:
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "distributed-realm"
            path: "users.properties"
          groupProperties:
            path: "groups.properties"
        distributedRealm: ~</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aggregate-security-realms_security-realms"><a class="anchor" href="#aggregate-security-realms_security-realms"></a>5.8. Aggregate security realms</h3>
<div class="paragraph">
<p>Aggregate realms combine multiple realms: the first one for the authentication steps and the others for loading the identity for the authorization steps.
For example, this can be used to authenticate users via a client certificate, and retrieve identity from a properties or LDAP realm.</p>
</div>
<h4 id="aggregate_realm_configuration" class="discrete">Aggregate realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="default" default-realm="aggregate"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;keystore path="server.pfx" password="secret" alias="server"/&gt;
                  &lt;truststore path="trust.pfx" password="secret"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
            &lt;properties-realm name="properties" groups-attribute="Roles"&gt;
               &lt;user-properties path="users.properties" relative-to="infinispan.server.config.path"/&gt;
               &lt;group-properties path="groups.properties" relative-to="infinispan.server.config.path"/&gt;
            &lt;/properties-realm&gt;
            &lt;truststore-realm name="trust"/&gt;
            &lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
               &lt;name-rewriter&gt;
                  &lt;common-name-principal-transformer/&gt;
               &lt;/name-rewriter&gt;
            &lt;/aggregate-realm&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [
        {
          "name": "aggregate-realm",
          "default-realm": "aggregate",
          "server-identities": {
            "ssl": {
              "keystore": {
                "path": "server.p12",
                "relative-to": "infinispan.server.config.path",
                "keystore-password": "secret",
                "alias": "server"
              },
              "truststore": {
                "path": "trust.p12",
                "relative-to": "infinispan.server.config.path",
                "password": "secret"
              }
            }
          },
          "properties-realm": {
            "name": "properties",
            "groups-attribute": "Roles",
            "user-properties": {
              "digest-realm-name": "distributed-realm",
              "path": "users.properties"
            },
            "group-properties": {
              "path": "groups.properties"
            }
          },
          "truststore-realm": {
            "name": "trust"
          },
          "aggregate-realm": {
            "authentication-realm": "trust",
            "authorization-realms": ["properties"],
            "name-rewriter": {
              "common-name-principal-transformer": {}
            }
          }
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "aggregate-realm"
        defaultRealm: "aggregate"
        serverIdentities:
          ssl:
            keystore:
              path: "server.p12"
              relative-to: "infinispan.server.config.path"
              keystore-password: "secret"
              alias: "server"
            truststore:
              path: "trust.p12"
              relative-to: "infinispan.server.config.path"
              password: "secret"
        truststoreRealm:
          name: "trust"
        propertiesRealm:
          name: "properties"
          groupsAttribute: "Roles"
          userProperties:
            digestRealmName: "distributed-realm"
            path: "users.properties"
          groupProperties:
            path: "groups.properties"
        aggregateRealm:
          authenticationRealm: "trust"
          authorizationRealms:
            - "properties"
          nameRewriter:
            common-name-principal-transformer: ~</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="name_rewriters"><a class="anchor" href="#name_rewriters"></a>5.8.1. Name rewriters</h4>
<div class="paragraph">
<p>Principal names may have different forms, depending on the security realm type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties and Token realms may return simple strings</p>
</li>
<li>
<p>Trust and LDAP realms may return X.500-style distinguished names</p>
</li>
<li>
<p>Kerberos realms may return <code>user@domain</code>-style names</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Names must be normalized to a common form when using the aggregate realm using one of the following transformers.</p>
</div>
<div class="sect4">
<h5 id="case_principal_transformer_2"><a class="anchor" href="#case_principal_transformer_2"></a>Case Principal Transformer</h5>
<div class="paragraph">
<p>The <code>case-principal-transformer</code> transforms a name to all uppercase or all lowercase letters.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
   &lt;name-rewriter&gt;
      &lt;case-principal-transformer uppercase="false"/&gt;
   &lt;/name-rewriter&gt;
&lt;/aggregate-realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "aggregate-realm": {
    "authentication-realm": "trust",
    "authorization-realms": [
      "properties"
    ],
    "name-rewriter": {
      "case-principal-transformer": {
        "uppercase": "false"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">aggregateRealm:
  authenticationRealm: "trust"
  authorizationRealms:
    - "properties"
  nameRewriter:
    casePrincipalTransformer:
      uppercase: false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="common_name_principal_transformer_2"><a class="anchor" href="#common_name_principal_transformer_2"></a>Common Name Principal Transformer</h5>
<div class="paragraph">
<p>The <code>common-name-principal-transformer</code> extracts the first <code>CN</code> element from a <code>DN</code> used by LDAP or Certificates.
For example, given a principal in the form <code>CN=app1,CN=serviceA,OU=applications,DC=infinispan,DC=org</code>, the following
configuration will extract <code>app1</code> as the principal.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
   &lt;name-rewriter&gt;
      &lt;common-name-principal-transformer/&gt;
   &lt;/name-rewriter&gt;
&lt;/aggregate-realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "aggregate-realm": {
    "authentication-realm": "trust",
    "authorization-realms": [
      "properties"
    ],
    "name-rewriter": {
      "common-name-principal-transformer": {}
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">aggregateRealm:
  authenticationRealm: "trust"
  authorizationRealms:
    - "properties"
  nameRewriter:
    commonNamePrincipalTransformer: ~</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="regex_principal_transformer_2"><a class="anchor" href="#regex_principal_transformer_2"></a>Regex Principal Transformer</h5>
<div class="paragraph">
<p>The <code>regex-principal-transformer</code> can perform find and replace using a regular expression.
The example shows how to extract the local-part from a <code>user@domain.com</code> identifier.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;aggregate-realm authentication-realm="trust" authorization-realms="properties"&gt;
   &lt;name-rewriter&gt;
      &lt;regex-principal-transformer pattern="([^@]+)@.*" replacement="$1" replace-all="false"/&gt;
   &lt;/name-rewriter&gt;
&lt;/aggregate-realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "aggregate-realm": {
    "authentication-realm": "trust",
    "authorization-realms": [
      "properties"
    ],
    "name-rewriter": {
      "regex-principal-transformer": {
        "pattern" : "([^@]+)@.*",
        "replacement": "$1",
        "replace-all": false
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">aggregateRealm:
  authenticationRealm: "trust"
  authorizationRealms:
    - "properties"
  nameRewriter:
    regexPrincipalTransformer:
      pattern: "([^@]+)@.*"
      replacement: "$1"
      replaceAll: false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-security-realms_security-realms"><a class="anchor" href="#caching-security-realms_security-realms"></a>5.9. Security realm caching</h3>
<div class="paragraph">
<p>Security realms implement caching to avoid having to repeatedly retrieve data which usually changes very infrequently.
By default</p>
</div>
<h4 id="realm_caching_realm_configuration" class="discrete">Realm caching realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
    &lt;security&gt;
        &lt;security-realms&gt;
            &lt;security-realm name="default" cache-max-size="1024" cache-lifespan="120000"&gt;
            &lt;/security-realm&gt;
        &lt;/security-realms&gt;
    &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "cache-max-size": 1024,
        "cache-lifespan": 120000
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        cache-max-size: 1024
        cache-lifespan: 120000</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="flushing_realm_caches"><a class="anchor" href="#flushing_realm_caches"></a>5.9.1. Flushing realm caches</h4>
<div class="paragraph">
<p>Use the CLI to flush security realm caches across the whole cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[node-1@mycluster//containers/default]&gt; server aclcache flush</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-encryption"><a class="anchor" href="#configuring-encryption"></a>6. Configuring TLS/SSL encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can secure Infinispan Server connections using SSL/TLS encryption by configuring a keystore that contains public and private keys for Infinispan.
You can also configure client certificate authentication if you require mutual TLS.</p>
</div>
<div class="sect2">
<h3 id="configuring-server-keystores_endpoint-security"><a class="anchor" href="#configuring-server-keystores_endpoint-security"></a>6.1. Configuring Infinispan Server keystores</h3>
<div class="paragraph">
<p>Add keystores to Infinispan Server and configure it to present SSL/TLS certificates that verify its identity to clients.
If a security realm contains TLS/SSL identities, it encrypts any connections to Infinispan Server endpoints that use that security realm.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a keystore that contains certificates, or certificate chains, for Infinispan Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan Server supports the following keystore formats: JKS, JCEKS, PKCS12/PFX and PEM.
BKS, BCFKS, and UBER are also supported if the <a href="https://www.bouncycastle.org/">Bouncy Castle</a> library is present.</p>
</div>
<div class="paragraph">
<p>Certificates should include the <code>subjectAltName</code> extension of type <code>dNSName</code> and/or <code>iPAddress</code> so that clients can correctly perform
hostname validation, according to the rules defined by the <a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC 2818</a> specification.
The server will issue a warning if it is started with a certificate which does not include such an extension.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In production environments, server certificates should be signed by a trusted Certificate Authority, either Root or Intermediate CA.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use PEM files as keystores if they contain both of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A private key in PKCS#1 or PKCS#8 format.</p>
</li>
<li>
<p>One or more certificates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should also configure PEM file keystores with an empty password (<code>password=""</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add the keystore that contains SSL/TLS identities for Infinispan Server to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the keystore file name with the <code>path</code> attribute.</p>
</li>
<li>
<p>Provide the keystore password and certificate alias with the <code>keystore-password</code> and <code>alias</code> attributes.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Configure clients with a trust store so they can verify SSL/TLS identities for Infinispan Server.</p>
</div>
<h4 id="keystore_configuration" class="discrete">Keystore configuration</h4>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Adds a keystore that contains server certificates that provide SSL/TLS identities to clients. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="my-server"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "alias": "my-server",
              "path": "server.p12",
              "password": "secret"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              alias: "my-server"
              path: "server.p12"
              password: "secret"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="ssltls_certificate_rotation"><a class="anchor" href="#ssltls_certificate_rotation"></a>6.1.1. SSL/TLS Certificate rotation</h4>
<div class="paragraph">
<p>SSL/TLS certificates have an expiration date, after which they are no longer valid.
The process of renewing a certificate is also known as "rotation".
Infinispan monitors the keystore files for changes and automatically reloads them without requiring a server or client
restart.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To ensure seamless operations during certificate rotation, use certificates signed by a Certificate Authority (CA) and
configure both server and client trust stores with the CA certificate. Using self-signed certificates will cause
temporary handshake failures until all clients and servers have been updated.
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html#configuring-hotrod-encryption_hotrod-client-configuration">Configuring Hot Rod client encryption</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="generating-server-keystores_endpoint-security"><a class="anchor" href="#generating-server-keystores_endpoint-security"></a>6.1.2. Generating Infinispan Server keystores</h4>
<div class="paragraph">
<p>Configure Infinispan Server to automatically generate keystores at startup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatically generated keystores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Should not be used in production environments.</p>
</li>
<li>
<p>Are generated whenever necessary; for example, while obtaining the first connection from a client.</p>
</li>
<li>
<p>Contain certificates that you can use directly in Hot Rod clients.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Include the <code>generate-self-signed-certificate-host</code> attribute for the <code>keystore</code> element in the server configuration.</p>
</li>
<li>
<p>Specify a hostname for the server certificate as the value.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="generated_keystore_configuration" class="discrete">Generated keystore configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="generated-keystore"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Generates a keystore that includes a self-signed certificate with the specified hostname. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="server"
                      generate-self-signed-certificate-host="localhost"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "generated-keystore",
        "server-identities": {
          "ssl": {
            "keystore": {
              "alias": "server",
              "generate-self-signed-certificate-host": "localhost",
              "path": "server.p12",
              "password": "secret"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "generated-keystore"
        serverIdentities:
          ssl:
            keystore:
              alias: "server"
              generateSelfSignedCertificateHost: "localhost"
              path: "server.p12"
              password: "secret"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ssl-engine_endpoint-security"><a class="anchor" href="#configuring-ssl-engine_endpoint-security"></a>6.1.3. Configuring TLS versions and cipher suites</h4>
<div class="paragraph">
<p>When using SSL/TLS encryption to secure your deployment, you can configure Infinispan Server to use specific versions of the TLS protocol as well as specific cipher suites within the protocol.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add the <code>engine</code> element to the SSL configuration for Infinispan Server.</p>
</li>
<li>
<p>Configure Infinispan to use one or more TLS versions with the <code>enabled-protocols</code> attribute.</p>
<div class="paragraph">
<p>Infinispan Server supports TLS version 1.2 and 1.3 by default.
If appropriate you can set <code>TLSv1.3</code> only to restrict the security protocol for client connections.
Infinispan does not recommend enabling <code>TLSv1.1</code> because it is an older protocol with limited support and provides weak security.
You should never enable any version of TLS older than 1.1.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you modify the SSL <code>engine</code> configuration for Infinispan Server you must explicitly configure TLS versions with the <code>enabled-protocols</code> attribute.
Omitting the <code>enabled-protocols</code> attribute allows any TLS version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;engine enabled-protocols="TLSv1.3 TLSv1.2" /&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure Infinispan to use one or more cipher suites with the <code>enabled-ciphersuites</code> attribute (for TLSv1.2 and below) and the <code>enabled-ciphersuites-tls13</code> attribute (for TLSv1.3).</p>
<div class="paragraph">
<p>You must ensure that you set a cipher suite that supports any protocol features you plan to use; for example <code>HTTP/2 ALPN</code>.</p>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="ssl_engine_configuration" class="discrete">SSL engine configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="server"/&gt;
            &lt;!-- Configures Infinispan Server to use specific TLS versions and cipher suites. --&gt;
            &lt;engine enabled-protocols="TLSv1.3 TLSv1.2"
                    enabled-ciphersuites="TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256"
                    enabled-ciphersuites-tls13="TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "alias": "server",
              "path": "server.p12",
              "password": "secret"
            },
            "engine": {
              "enabled-protocols": ["TLSv1.3"],
              "enabled-ciphersuites": "TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256",
              "enabled-ciphersuites-tls13": "TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              alias: "server"
              path: "server.p12"
              password: "secret"
            engine:
              enabledProtocols:
                - "TLSv1.3"
              enabledCiphersuites: "TLS_AES_256_GCM_SHA384,TLS_AES_128_GCM_SHA256"
              enabledCiphersuitesTls13: "TLS_AES_256_GCM_SHA384"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-fips_endpoint-security"><a class="anchor" href="#configuring-server-fips_endpoint-security"></a>6.2. Configuring Infinispan Server on a system with FIPS 140-2 compliant cryptography</h3>
<div class="paragraph">
<p>FIPS (Federal Information Processing Standards) are standards and guidelines for US federal computer systems.
Although FIPS are developed for use by the US federal government, many in the private sector voluntarily use these standards.</p>
</div>
<div class="paragraph">
<p>FIPS 140-2 defines security requirements for cryptographic modules.
You can configure your Infinispan Server to use encryption ciphers that adhere to the FIPS 140-2 specification by using alternative JDK security providers.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/security/pkcs11-reference-guide1.html">Java PKCS#11 cryptographic provider</a></p>
</li>
<li>
<p><a href="https://www.bouncycastle.org/fips_faq.html">The Legion of the Bouncy Castle cryptographic provider</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring_the_pkcs11_cryptographic_provider"><a class="anchor" href="#configuring_the_pkcs11_cryptographic_provider"></a>6.2.1. Configuring the PKCS11 cryptographic provider</h4>
<div class="paragraph">
<p>You can configure the PKCS11 cryptographic provider by specifying the PKCS11 keystore with the <code>SunPKCS11-NSS-FIPS</code> provider.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure your system for FIPS mode. You can check if your system has FIPS Mode enabled by issuing the <code>fips-mode-setup --check</code> command in your Infinispan command-line Interface (CLI)</p>
</li>
<li>
<p>Initialize the system-wide NSS database by using the <code>certutil</code> tool.</p>
</li>
<li>
<p>Install the JDK with the <code>java.security</code> file configured to enable the <code>SunPKCS11</code> provider. This provider points to the NSS database and the SSL provider.</p>
</li>
<li>
<p>Install a certificate in the NSS database.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the PKCS11 keystore with the <code>SunPKCS11-NSS-FIPS</code> provider.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="keystore_configuration_2" class="discrete">Keystore configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="default"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;!-- Adds a keystore that reads certificates from the NSS database. --&gt;
                  &lt;keystore provider="SunPKCS11-NSS-FIPS" type="PKCS11"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "provider": "SunPKCS11-NSS-FIPS",
              "type": "PKCS11"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              provider: "SunPKCS11-NSS-FIPS"
              type: "PKCS11"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring_the_bouncy_castle_fips_cryptographic_provider"><a class="anchor" href="#configuring_the_bouncy_castle_fips_cryptographic_provider"></a>6.2.2. Configuring the Bouncy Castle FIPS cryptographic provider</h4>
<div class="paragraph">
<p>You can configure the Bouncy Castle FIPS (Federal Information Processing Standards) cryptographic provider in your Infinispan server&#8217;s configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure your system for FIPS mode. You can check if your system has FIPS Mode enabled by issuing the <code>fips-mode-setup --check</code> command in your Infinispan command-line Interface (CLI).</p>
</li>
<li>
<p>Create a keystore in BCFKS format that contains a certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the Bouncy Castle FIPS JAR file, and add the file to the <code>server/lib</code> directory of your Infinispan Server installation.</p>
</li>
<li>
<p>To install Bouncy Castle, issue the <code>install</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[disconnected]&gt; install org.bouncycastle:bc-fips:1.0.2.3</code></pre>
</div>
</div>
</li>
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the BCFKS keystore with the <code>BCFIPS</code> provider.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="keystore_configuration_3" class="discrete">Keystore configuration</h5>
<div class="listingblock">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
   &lt;security&gt;
      &lt;security-realms&gt;
         &lt;security-realm name="default"&gt;
            &lt;server-identities&gt;
               &lt;ssl&gt;
                  &lt;!-- Adds a keystore that reads certificates from the BCFKS keystore. --&gt;
                  &lt;keystore path="server.bcfks" password="secret" alias="server" provider="BCFIPS" type="BCFKS"/&gt;
               &lt;/ssl&gt;
            &lt;/server-identities&gt;
         &lt;/security-realm&gt;
      &lt;/security-realms&gt;
   &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "default",
        "server-identities": {
          "ssl": {
            "keystore": {
              "path": "server.bcfks",
              "password": "secret",
              "alias": "server",
              "provider": "BCFIPS",
              "type": "BCFKS"
            }
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "default"
        serverIdentities:
          ssl:
            keystore:
              path: "server.bcfks"
              password: "secret"
              alias: "server"
              provider: "BCFIPS"
              type: "BCFKS"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authentication_endpoint-security"><a class="anchor" href="#configuring-client-certificate-authentication_endpoint-security"></a>6.3. Configuring client certificate authentication</h3>
<div class="paragraph">
<p>Configure Infinispan Server to use mutual TLS to secure client connections.</p>
</div>
<div class="paragraph">
<p>You can configure Infinispan to verify client identities from certificates in a trust store in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Require a trust store that contains only the signing certificate, which is typically a Certificate Authority (CA). Any client that presents a certificate signed by the CA can connect to Infinispan.</p>
</li>
<li>
<p>Require a trust store that contains all client certificates in addition to the signing certificate. Only clients that present a signed certificate that is present in the trust store can connect to Infinispan.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively to providing trust stores you can use shared system certificates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a client trust store that contains either the CA certificate or all public certificates.</p>
</li>
<li>
<p>Create a keystore for Infinispan Server and configure an SSL/TLS identity.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PEM files can be used as trust stores provided they contain one or more certificates.
These trust stores should be configured with an empty password: <code>password=""</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add the <code>require-ssl-client-auth="true"</code> parameter to your <code>endpoints</code> configuration.</p>
</li>
<li>
<p>Add the client trust store to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Specify the <code>path</code> and <code>password</code> attributes for the <code>truststore</code> element in the Infinispan Server security realm configuration.</p>
</li>
<li>
<p>Add the <code>&lt;truststore-realm/&gt;</code> element to the security realm if you want Infinispan Server to authenticate each client certificate.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Set up authorization with client certificates in the Infinispan Server configuration if you control access with security roles and permissions.</p>
</li>
<li>
<p>Configure clients to negotiate SSL/TLS connections with Infinispan Server.</p>
</li>
</ul>
</div>
<h4 id="client_certificate_authentication_configuration" class="discrete">Client certificate authentication configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="trust-store-realm"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Provides an SSL/TLS identity with a keystore that
                 contains server certificates. --&gt;
            &lt;keystore path="server.p12"
                      relative-to="infinispan.server.config.path"
                      keystore-password="secret"
                      alias="server"/&gt;
            &lt;!-- Configures a trust store that contains client certificates
                 or part of a certificate chain. --&gt;
            &lt;truststore path="trust.p12"
                        relative-to="infinispan.server.config.path"
                        password="secret"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
        &lt;!-- Authenticates client certificates against the trust store. If you configure this, the trust store must contain the public certificates for all clients. --&gt;
        &lt;truststore-realm/&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
  &lt;endpoints&gt;
    &lt;endpoint socket-binding="default"
              security-realm="trust-store-realm"
              require-ssl-client-auth="true"&gt;
      &lt;hotrod-connector&gt;
        &lt;authentication&gt;
          &lt;sasl mechanisms="EXTERNAL"
                server-name="infinispan"
                qop="auth"/&gt;
        &lt;/authentication&gt;
      &lt;/hotrod-connector&gt;
      &lt;rest-connector&gt;
        &lt;authentication mechanisms="CLIENT_CERT"/&gt;
      &lt;/rest-connector&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "security-realms": [{
        "name": "trust-store-realm",
        "server-identities": {
          "ssl": {
            "keystore": {
              "path": "server.p12",
              "relative-to": "infinispan.server.config.path",
              "keystore-password": "secret",
              "alias": "server"
            },
            "truststore": {
              "path": "trust.p12",
              "relative-to": "infinispan.server.config.path",
              "password": "secret"
            }
          }
        },
        "truststore-realm": {}
      }]
    },
    "endpoints": [{
      "socket-binding": "default",
      "security-realm": "trust-store-realm",
      "require-ssl-client-auth": "true",
      "connectors": {
        "hotrod": {
          "hotrod-connector": {
            "authentication": {
              "sasl": {
                "mechanisms": "EXTERNAL",
                "server-name": "infinispan",
                "qop": "auth"
              }
            }
          },
          "rest": {
            "rest-connector": {
              "authentication": {
                "mechanisms": "CLIENT_CERT"
              }
            }
          }
        }
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    securityRealms:
      - name: "trust-store-realm"
        serverIdentities:
          ssl:
            keystore:
              path: "server.p12"
              relative-to: "infinispan.server.config.path"
              keystore-password: "secret"
              alias: "server"
            truststore:
              path: "trust.p12"
              relative-to: "infinispan.server.config.path"
              password: "secret"
        truststoreRealm: ~
  endpoints:
    socketBinding: "default"
    securityRealm: "trust-store-realm"
    requireSslClientAuth: "true"
    connectors:
      - hotrod:
          hotrodConnector:
            authentication:
              sasl:
                mechanisms: "EXTERNAL"
                serverName: "infinispan"
                qop: "auth"
      - rest:
          restConnector:
            authentication:
              mechanisms: "CLIENT_CERT"</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html#configuring-hotrod-encryption_hotrod-client-configuration">Configuring Hot Rod client encryption</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-shared-system-certificates">Using Shared System Certificates</a> (Red Hat Enterprise Linux 7 Security Guide)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authorization_endpoint-security"><a class="anchor" href="#configuring-client-certificate-authorization_endpoint-security"></a>6.4. Configuring authorization with client certificates</h3>
<div class="paragraph">
<p>Enabling client certificate authentication means you do not need to specify Infinispan user credentials in client configuration, which means you must associate roles with the Common Name (CN) field in the client certificate(s).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide clients with a Java keystore that contains either their public certificates or part of the certificate chain, typically a public CA certificate.</p>
</li>
<li>
<p>Configure Infinispan Server to perform client certificate authentication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Enable the <code>common-name-role-mapper</code> in the security authorization configuration.</p>
</li>
<li>
<p>Assign the Common Name (<code>CN</code>) from the client certificate a role with the appropriate permissions.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Infinispan creates the identity of the client by extracting the certificate principal. Any other Subject
Alternative Names (SANs) which may be present in the certificate are currently ignored. For this reason, the
<code>authorization.group-only-mapping</code> attribute below must be set to <code>false</code>.
</td>
</tr>
</table>
</div>
<h4 id="client_certificate_authorization_configuration" class="discrete">Client certificate authorization configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container name="certificate-authentication" statistics="true"&gt;
    &lt;security&gt;
      &lt;authorization group-only-mapping="false"&gt;
        &lt;!-- Declare a role mapper that associates the common name (CN) field in client certificate trust stores with authorization roles. --&gt;
        &lt;common-name-role-mapper/&gt;
        &lt;!-- In this example, if a client certificate contains `CN=Client1` then clients with matching certificates get ALL permissions. --&gt;
        &lt;role name="Client1" permissions="ALL"/&gt;
      &lt;/authorization&gt;
    &lt;/security&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan": {
    "cache-container": {
      "name": "certificate-authentication",
      "security": {
        "authorization": {
          "group-only-mapping": false,
          "common-name-role-mapper": null,
          "roles": {
            "Client1": {
              "role": {
                "permissions": "ALL"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    name: "certificate-authentication"
    security:
      authorization:
        groupOnlyMapping: false
        commonNameRoleMapper: ~
        roles:
          Client1:
            role:
              permissions:
                - "ALL"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="credential-keystores"><a class="anchor" href="#credential-keystores"></a>7. Storing Infinispan Server credentials in keystores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External services require credentials to authenticate with Infinispan Server.
To protect sensitive text strings such as passwords, add them to a credential keystore rather than directly in Infinispan Server configuration files.</p>
</div>
<div class="paragraph">
<p>You can then configure Infinispan Server to decrypt passwords for establishing connections with services such as databases or LDAP directories.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Plain-text passwords in <code>$ISPN_HOME/server/conf</code> are unencrypted.
Any user account with read access to the host filesystem can view plain-text passwords.</p>
</div>
<div class="paragraph">
<p>While credential keystores are password-protected store encrypted passwords, any user account with write access to the host filesystem can tamper with the keystore itself.</p>
</div>
<div class="paragraph">
<p>To completely secure Infinispan Server credentials, you should grant read-write access only to user accounts that can configure and run Infinispan Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="setting-up-credential-keystores_credential-keystores"><a class="anchor" href="#setting-up-credential-keystores_credential-keystores"></a>7.1. Setting up credential keystores</h3>
<div class="paragraph">
<p>Create keystores that encrypt credential for Infinispan Server access.</p>
</div>
<div class="paragraph">
<p>A credential keystore contains at least one alias that is associated with an encrypted password.
After you create a keystore, you specify the alias in a connection configuration such as a database connection pool.
Infinispan Server then decrypts the password for that alias from the keystore when the service attempts authentication.</p>
</div>
<div class="paragraph">
<p>You can create as many credential keystores with as many aliases as required.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a security best practice, keystores should be readable only by the user who runs the process for Infinispan Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Create a keystore and add credentials to it with the <code class="command">credentials</code> command.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, keystores are of type PKCS12.
Run <code class="command">help credentials</code> for details on changing keystore defaults.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to create a keystore that contains an alias of "dbpassword" for the password "changeme".
When you create a keystore you also specify a password to access the keystore with the <code>-p</code> argument.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh credentials add dbpassword -c changeme -p "secret1234!"</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin\cli.bat credentials add dbpassword -c changeme -p "secret1234!"</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Check that the alias is added to the keystore.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh credentials ls -p "secret1234!"
dbpassword</code></pre>
</div>
</div>
</li>
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Configure Infinispan to use the credential keystore.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add a <code>credential-stores</code> section to the <code>security</code> configuration.</p>
</li>
<li>
<p>Specify the name and location of the credential keystore.</p>
</li>
<li>
<p>Specify the password to access the credential keystore with the <code>clear-text-credential</code> configuration.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of adding a clear-text password for the credential keystore to your Infinispan Server configuration you can use an external command or masked password for additional security.</p>
</div>
<div class="paragraph">
<p>You can also use a password in one credential store as the master password for another credential store.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Reference the credential keystore in configuration that Infinispan Server uses to connect with an external system such as a datasource or LDAP server.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add a <code>credential-reference</code> section.</p>
</li>
<li>
<p>Specify the name of the credential keystore with the <code>store</code> attribute.</p>
</li>
<li>
<p>Specify the password alias with the <code>alias</code> attribute.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Attributes in the <code>credential-reference</code> configuration are optional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>store</code> is required only if you have multiple keystores.</p>
</li>
<li>
<p><code>alias</code> is required only if the keystore contains multiple password aliases.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="securing-passwords-credential-keystores_credential-keystores"><a class="anchor" href="#securing-passwords-credential-keystores_credential-keystores"></a>7.2. Securing passwords for credential keystores</h3>
<div class="paragraph">
<p>Infinispan Server requires a password to access credential keystores.
You can add that password to Infinispan Server configuration in clear text or, as an added layer of security, you can use an external command for the password or you can mask the password.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Set up a credential keystore for Infinispan Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code class="command">credentials mask</code> command to obscure the password, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh credentials mask -i 100 -s pepper99 "secret1234!"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Masked passwords use Password Based Encryption (PBE) and must be in the following format in your Infinispan Server configuration: &lt;MASKED_VALUE;SALT;ITERATION&gt;.</p>
</div>
</li>
<li>
<p>Use an external command that provides the password as standard output.</p>
<div class="paragraph">
<p>An external command can be any executable, such as a shell script or binary, that uses <code>java.lang.Runtime#exec(java.lang.String)</code>.<br>
If the command requires parameters, provide them as a space-separated list of strings.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="credential-keystore-configuration_credential-keystores"><a class="anchor" href="#credential-keystore-configuration_credential-keystores"></a>7.3. Credential keystore configuration</h3>
<div class="paragraph">
<p>You can add credential keystores to Infinispan Server configuration and use clear-text passwords, masked passwords, or external commands that supply passwords.</p>
</div>
<h4 id="credential_keystore_with_a_clear_text_password" class="discrete">Credential keystore with a clear text password</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials" path="credentials.pfx"&gt;
        &lt;clear-text-credential clear-text="secret1234!"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "clear-text-credential": {
          "clear-text": "secret1234!"
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        clearTextCredential:
          clearText: "secret1234!"</code></pre>
</div>
</div>
<h4 id="credential_keystore_with_a_masked_password" class="discrete">Credential keystore with a masked password</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;masked-credential masked="1oTMDZ5JQj6DVepJviXMnX;pepper99;100"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "masked-credential": {
          "masked": "1oTMDZ5JQj6DVepJviXMnX;pepper99;100"
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        maskedCredential:
          masked: "1oTMDZ5JQj6DVepJviXMnX;pepper99;100"</code></pre>
</div>
</div>
<h4 id="external_command_passwords" class="discrete">External command passwords</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;command-credential command="/path/to/executable.sh arg1 arg2"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "command-credential": {
          "command": "/path/to/executable.sh arg1 arg2"
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        commandCredential:
          command: "/path/to/executable.sh arg1 arg2"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="credential-keystore-references_credential-keystores"><a class="anchor" href="#credential-keystore-references_credential-keystores"></a>7.4. Credential keystore references</h3>
<div class="paragraph">
<p>After you add credential keystores to Infinispan Server you can reference them in connection configurations.</p>
</div>
<h4 id="datasource_connections" class="discrete">Datasource connections</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;clear-text-credential clear-text="secret1234!"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
  &lt;/security&gt;
  &lt;data-sources&gt;
    &lt;data-source name="postgres"
                 jndi-name="jdbc/postgres"&gt;
      &lt;!-- Specifies the database username in the connection factory. --&gt;
      &lt;connection-factory driver="org.postgresql.Driver"
                          username="dbuser"
                          url="${org.infinispan.server.test.postgres.jdbcUrl}"&gt;
        &lt;!-- Specifies the credential keystore that contains an encrypted password and the alias for it. --&gt;
        &lt;credential-reference store="credentials"
                              alias="dbpassword"/&gt;
      &lt;/connection-factory&gt;
      &lt;connection-pool max-size="10"
                       min-size="1"
                       background-validation="1000"
                       idle-removal="1"
                       initial-size="1"
                       leak-detection="10000"/&gt;
    &lt;/data-source&gt;
  &lt;/data-sources&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "clear-text-credential": {
          "clear-text": "secret1234!"
        }
      }],
      "data-sources": [{
        "name": "postgres",
        "jndi-name": "jdbc/postgres",
        "connection-factory": {
          "driver": "org.postgresql.Driver",
          "username": "dbuser",
          "url": "${org.infinispan.server.test.postgres.jdbcUrl}",
          "credential-reference": {
            "store": "credentials",
            "alias": "dbpassword"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        clearTextCredential:
          clearText: "secret1234!"
  dataSources:
    - name: postgres
      jndiName: jdbc/postgres
      connectionFactory:
        driver: org.postgresql.Driver
        username: dbuser
        url: '${org.infinispan.server.test.postgres.jdbcUrl}'
        credentialReference:
          store: credentials
          alias: dbpassword</code></pre>
</div>
</div>
<h4 id="ldap_connections" class="discrete">LDAP connections</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;credential-stores&gt;
      &lt;credential-store name="credentials"
                        path="credentials.pfx"&gt;
        &lt;clear-text-credential clear-text="secret1234!"/&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="default"&gt;
        &lt;!-- Specifies the LDAP principal in the connection factory. --&gt;
        &lt;ldap-realm name="ldap"
                    url="ldap://my-ldap-server:10389"
                    principal="uid=admin,ou=People,dc=infinispan,dc=org"&gt;
          &lt;!-- Specifies the credential keystore that contains an encrypted password and the alias for it. --&gt;
          &lt;credential-reference store="credentials"
                                alias="ldappassword"/&gt;
        &lt;/ldap-realm&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "security": {
      "credential-stores": [{
        "name": "credentials",
        "path": "credentials.pfx",
        "clear-text-credential": {
          "clear-text": "secret1234!"
        }
      }],
      "security-realms": [{
        "name": "default",
        "ldap-realm": {
          "name": "ldap",
          "url": "ldap://my-ldap-server:10389",
          "principal": "uid=admin,ou=People,dc=infinispan,dc=org",
          "credential-reference": {
            "store": "credentials",
            "alias": "ldappassword"
          }
        }
      }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  security:
    credentialStores:
      - name: credentials
        path: credentials.pfx
        clearTextCredential:
          clearText: "secret1234!"
    securityRealms:
      - name: "default"
        ldapRealm:
          name: ldap
          url: 'ldap://my-ldap-server:10389'
          principal: 'uid=admin,ou=People,dc=infinispan,dc=org'
          credentialReference:
            store: credentials
            alias: ldappassword</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rbac-remote"><a class="anchor" href="#rbac-remote"></a>8. Configuring user roles and permissions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure security authorization to control access to cache and Infinispan resources.</p>
</div>
<div class="sect2">
<h3 id="default-user-roles_rbac-remote"><a class="anchor" href="#default-user-roles_rbac-remote"></a>8.1. Infinispan user roles and permissions</h3>
<div class="paragraph">
<p>Infinispan includes several roles that provide users with permissions to access caches and Infinispan resources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superuser with all permissions including control of the Cache Manager lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR, CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and delete Infinispan resources in addition to <code>application</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read and write access to Infinispan resources in addition to <code>observer</code> permissions. Can also listen to events and execute server tasks and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>observer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read access to Infinispan resources in addition to <code>monitor</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view statistics via JMX and the <code>metrics</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/AuthorizationPermission.html">org.infinispan.security.AuthorizationPermission Enum</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="user-permissions_rbac-remote"><a class="anchor" href="#user-permissions_rbac-remote"></a>8.1.1. Permissions</h4>
<div class="paragraph">
<p>User roles are sets of permissions with different access levels.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<caption class="title">Table 1. Cache Manager permissions</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIGURATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defineConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines new cache configurations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stops the Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCache</code>, <code>removeCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and remove container resources  such as caches, counters, schemas, and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all Cache Manager permissions.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<caption class="title">Table 2. Cache permissions</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>contains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves entries from a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put</code>, <code>putIfAbsent</code>, <code>replace</code>, <code>remove</code>, <code>evict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes, replaces, removes, evicts data in a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distexec</code>, <code>streams</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows code execution against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keySet</code>, <code>values</code>, <code>entrySet</code>, <code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk retrieve operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clear</code>, <code>putAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk write operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code>, <code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts and stops a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getVersion</code>, <code>addInterceptor*</code>, <code>removeInterceptor</code>, <code>getInterceptorChain</code>, <code>getEvictionManager</code>, <code>getComponentRegistry</code>, <code>getDistributionManager</code>, <code>getAuthorizationManager</code>, <code>evict</code>, <code>getRpcManager</code>, <code>getCacheConfiguration</code>, <code>getCacheManager</code>, <code>getInvocationContextContainer</code>, <code>setAvailability</code>, <code>getDataContainer</code>, <code>getStats</code>, <code>getXAResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to underlying components and internal structures.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all cache permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the READ and BULK_READ permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the WRITE and BULK_WRITE permissions.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="role-mappers_rbac-remote"><a class="anchor" href="#role-mappers_rbac-remote"></a>8.1.2. Role and permission mappers</h4>
<div class="paragraph">
<p>Infinispan implements users as a collection of principals.
Principals represent either an individual user identity, such as a username, or a group to which the users belong. Internally, these are implemented with the <code>javax.security.auth.Subject</code> class.</p>
</div>
<div class="paragraph">
<p>To enable authorization, the principals must be mapped to role names, which are then expanded into a set of permissions.</p>
</div>
<div class="paragraph">
<p>Infinispan includes the <code>PrincipalRoleMapper</code> API for associating security principals to roles, and the <code>RolePermissionMapper</code> API for associating roles with specific permissions.</p>
</div>
<div class="paragraph">
<p>Infinispan provides the following role and permission mapper implementations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cluster role mapper</dt>
<dd>
<p>Stores principal to role mappings in the cluster registry.</p>
</dd>
<dt class="hdlist1">Cluster permission mapper</dt>
<dd>
<p>Stores role to permission mappings in the cluster registry. Allows you to dynamically modify user roles and permissions.</p>
</dd>
<dt class="hdlist1">Identity role mapper</dt>
<dd>
<p>Uses the principal name as the role name. The type or format of the principal name depends on the source. For example, in an LDAP directory the principal name could be a Distinguished Name (DN).</p>
</dd>
<dt class="hdlist1">Common name role mapper</dt>
<dd>
<p>Uses the Common Name (CN) as the role name. You can use this role mapper with an LDAP directory or with client certificates that contain Distinguished Names (DN); for example <code>cn=managers,ou=people,dc=example,dc=com</code> maps to the <code>managers</code> role.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, principal-to-role mapping is only applied to principals which represent groups.
It is possible to configure Infinispan to also perform the mapping for user principals by setting the
<code>authorization.group-only-mapping</code> configuration attribute to <code>false</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="mapping_users_to_roles_and_permissions_in_infinispan"><a class="anchor" href="#mapping_users_to_roles_and_permissions_in_infinispan"></a>Mapping users to roles and permissions in Infinispan</h5>
<div class="paragraph">
<p>Consider the following user retrieved from an LDAP server, as a collection of DNs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CN=myapplication,OU=applications,DC=mycompany
CN=dataprocessors,OU=groups,DC=mycompany
CN=finance,OU=groups,DC=mycompany</pre>
</div>
</div>
<div class="paragraph">
<p>Using the <strong>Common name role mapper</strong>, the user would be mapped to the following roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataprocessors
finance</pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan has the following role definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dataprocessors: ALL_WRITE ALL_READ
finance: LISTEN</pre>
</div>
</div>
<div class="paragraph">
<p>The user would have the following permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ALL_WRITE ALL_READ LISTEN</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/PrincipalRoleMapper.html">org.infinispan.security.PrincipalRoleMapper</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/RolePermissionMapper.html">org.infinispan.security.RolePermissionMapper</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/mappers/IdentityRoleMapper.html">org.infinispan.security.mappers.IdentityRoleMapper</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/mappers/CommonNameRoleMapper.html">org.infinispan.security.mappers.CommonNameRoleMapper</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-role-mappers_rbac-remote"><a class="anchor" href="#configuring-role-mappers_rbac-remote"></a>8.1.3. Configuring role mappers</h4>
<div class="paragraph">
<p>Infinispan enables the cluster role mapper and cluster permission mapper by default.
To use a different implementation for role mapping, you must configure the role mappers.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Declare the role mapper as part of the security authorization in the Cache Manager configuration.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h5 id="role_mapper_configuration" class="discrete">Role mapper configuration</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;cache-container&gt;
  &lt;security&gt;
    &lt;authorization&gt;
      &lt;common-name-role-mapper /&gt;
    &lt;/authorization&gt;
  &lt;/security&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "security" : {
        "authorization" : {
          "common-name-role-mapper": {}
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    security:
      authorization:
        commonNameRoleMapper: ~</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="granting-roles-to-users_rbac-remote"><a class="anchor" href="#granting-roles-to-users_rbac-remote"></a>8.2. Granting roles to users</h3>
<div class="paragraph">
<p>Assign roles to users and grant them permissions to perform cache operations and interact with Infinispan resources.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grant roles to groups instead of users if you want to assign the same role to multiple users and centrally maintain their permissions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Create Infinispan users.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Assign roles to users with the <code class="command">user roles grant</code> command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles grant --roles=deployer katie</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>List roles that you grant to users with the <code class="command">user roles ls</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles ls katie
["deployer"]</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="adding-users-to-groups_rbac-remote"><a class="anchor" href="#adding-users-to-groups_rbac-remote"></a>8.2.1. Adding users to groups</h4>
<div class="paragraph">
<p>Groups let you change permissions for multiple users.
You assign a role to a group and then add users to that group.
Users inherit permissions from the group role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You use groups as part of a property realm in the Infinispan Server configuration.
Each group is a special type of user that also requires a username and password.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Create Infinispan users.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">user create</code> command to create a group.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify a group name with the <code>--groups</code> argument.</p>
</li>
<li>
<p>Set a username and password for the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user create --groups=developers developers -p changeme</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>List groups.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user ls --groups</code></pre>
</div>
</div>
</li>
<li>
<p>Grant a role to the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles grant --roles=application developers</code></pre>
</div>
</div>
</li>
<li>
<p>List roles for the group.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles ls developers</code></pre>
</div>
</div>
</li>
<li>
<p>Add users to the group one at a time.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user groups john --groups=developers</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Open <code>groups.properties</code> and confirm the group exists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>cat server/conf/groups.properties</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-custom-roles-dynamically_rbac-remote"><a class="anchor" href="#creating-custom-roles-dynamically_rbac-remote"></a>8.3. Creating custom roles at runtime</h3>
<div class="paragraph">
<p>Add roles with custom permission mappings while your Infinispan cluster is running.
Infinispan stores any roles that you create dynamically in the <code>server/data</code> directory of your Infinispan Server installation so they are available after cluster restarts.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Dynamically creating and removing roles can have a performance impact because Infinispan recomputes user permissions each time you add or remove a role.
You should avoid frequently or repeatedly adding roles at runtime in any production environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have <code>ADMIN</code> permissions for Infinispan.</p>
</li>
<li>
<p>Have access to the command line interface (CLI) for a running Infinispan cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Define a role with set of permissions with the <code class="command">user roles create</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles create --permissions=ALL_WRITE,LISTEN temprole</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles create --permissions=READ,WRITE myrole</code></pre>
</div>
</div>
</li>
<li>
<p>Assign those roles to user with the <code class="command">user roles grant</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles grant --roles=temprole myrole username</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>List roles for users with the <code class="command">user roles ls</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles ls username
["temprole,myrole"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To confirm user permissions, log in to the CLI or Infinispan Console with those credentials and try performing an operation.
If the user does not have permission for an operation, Infinispan denies the request.</p>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>If you are temporarily assigning roles to users, you should remove them when you are done.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user roles deny --roles=temprole username</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>user remove roles temprole</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-custom-roles-statically_rbac-remote"><a class="anchor" href="#creating-custom-roles-statically_rbac-remote"></a>8.4. Adding custom roles to Cache Manager configuration</h3>
<div class="paragraph">
<p>Add roles with custom permission mappings to your Cache Manager configuration before you start your Infinispan cluster.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add a security authorization section to your Cache Manager configuration.</p>
</li>
<li>
<p>Declare each custom role and permission mapping in a <code>role</code> element or field.</p>
</li>
<li>
<p>Specify a unique name for each custom role with the <code>name</code> attribute.</p>
</li>
<li>
<p>Specify the permissions for the role with the <code>permissions</code> attribute.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Assign roles to Infinispan users with the <code class="command">user roles grant</code> command.</p>
</div>
<h4 id="custom_roles_and_permissions_configuration" class="discrete">Custom roles and permissions configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container name="custom-authorization"&gt;
    &lt;security&gt;
      &lt;authorization&gt;
        &lt;role name="temprole" description="temprole description" permissions="ALL_WRITE,LISTEN" /&gt;
        &lt;role name="myrole" permissions="READ,WRITE"/&gt;
      &lt;/authorization&gt;
    &lt;/security&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "name" : "custom-authorization",
      "security" : {
         "authorization" : {
          "roles" : {
            "temprole" : {
              "role" : {
                "permissions" : "ALL_WRITE LISTEN"
              }
            },
            "myrole" : {
              "role" : {
                "permissions" : "READ WRITE"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    name: "custom-authorization"
    security:
      authorization:
        roles:
          temprole:
            role:
              permissions:
                - "ALL_WRITE"
                - "LISTEN"
          myrole:
            role:
              permissions:
                - "READ"
                - "WRITE"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-cache-authorization_rbac-remote"><a class="anchor" href="#configuring-cache-authorization_rbac-remote"></a>8.5. Configuring caches with security authorization</h3>
<div class="paragraph">
<p>Add security authorization to caches to enforce role-based access control (RBAC).
This requires Infinispan users to have a role with a sufficient level of permission to perform cache operations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create Infinispan users and either grant them with roles or assign them to groups.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add a <code>security</code> section to the configuration.</p>
</li>
<li>
<p>Specify roles that users must have to perform cache operations with the <code>authorization</code> element.</p>
<div class="paragraph">
<p>You can implicitly add all roles defined in the Cache Manager or explicitly define a subset of roles.</p>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="implicit_role_configuration" class="discrete">Implicit role configuration</h4>
<div class="paragraph">
<p>The following configuration implicitly adds every role defined in the Cache Manager:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;distributed-cache&gt;
  &lt;security&gt;
    &lt;authorization/&gt;
  &lt;/security&gt;
&lt;/distributed-cache&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "distributed-cache": {
    "security": {
      "authorization": {
        "enabled": true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">distributedCache:
  security:
    authorization:
      enabled: true</code></pre>
</div>
</div>
<h4 id="explicit_role_configuration" class="discrete">Explicit role configuration</h4>
<div class="paragraph">
<p>The following configuration explicitly adds a subset of roles defined in the Cache Manager.
In this case Infinispan denies cache operations for any users that do not have one of the configured roles.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;distributed-cache&gt;
  &lt;security&gt;
    &lt;authorization roles="admin supervisor"/&gt;
  &lt;/security&gt;
&lt;/distributed-cache&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "distributed-cache": {
    "security": {
      "authorization": {
        "enabled": true,
        "roles": ["admin","supervisor"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">distributedCache:
  security:
    authorization:
      enabled: true
      roles: ["admin","supervisor"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disabling-authorization_rbac-remote"><a class="anchor" href="#disabling-authorization_rbac-remote"></a>8.6. Disabling security authorization</h3>
<div class="paragraph">
<p>In local development environments you can disable authorization so that users do not need roles and permissions.
Disabling security authorization means that any user can access data and interact with Infinispan resources.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Remove any <code>authorization</code> elements from the <code>security</code> configuration for the Cache Manager.</p>
</li>
<li>
<p>Remove any <code>authorization</code> configuration from your caches.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-acl-cache_rbac-remote"><a class="anchor" href="#configuring-acl-cache_rbac-remote"></a>8.7. Configuring the access control list (ACL) cache</h3>
<div class="paragraph">
<p>When you grant or deny roles to users, Infinispan stores details about which users can access your caches internally.
This ACL cache improves performance for security authorization by avoiding the need for Infinispan to calculate if users have the appropriate permissions to perform read and write operations for every request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever you grant or deny roles to users, Infinispan flushes the ACL cache to ensure it applies user permissions correctly.
This means that Infinispan must recalculate cache permissions for all users each time you grant or deny roles.
For best performance you should not frequently or repeatedly grant and deny roles in production environments.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Specify the maximum number of entries for the ACL cache with the <code>cache-size</code> attribute.</p>
<div class="paragraph">
<p>Entries in the ACL cache have a cardinality of <code>caches * users</code>. You should set the maximum number of entries to a value that can hold information for all your caches and users. For example, the default size of <code>1000</code> is appropriate for deployments with up to 100 caches and 10 users.</p>
</div>
</li>
<li>
<p>Set the timeout value, in milliseconds, with the <code>cache-timeout</code> attribute.</p>
<div class="paragraph">
<p>If Infinispan does not access an entry in the ACL cache within the timeout period that entry is evicted. When the user subsequently attempts cache operations then Infinispan recalculates their cache permissions and adds an entry to the ACL cache.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Specifying a value of <code>0</code> for either the <code>cache-size</code> or <code>cache-timeout</code> attribute disables the ACL cache.
You should disable the ACL cache only if you disable authorization.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="acl_cache_configuration" class="discrete">ACL cache configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container name="acl-cache-configuration"&gt;
    &lt;security cache-size="1000"
              cache-timeout="300000"&gt;
      &lt;authorization/&gt;
    &lt;/security&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "name" : "acl-cache-configuration",
      "security" : {
        "cache-size" : "1000",
        "cache-timeout" : "300000",
        "authorization" : {}
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    name: "acl-cache-configuration"
    security:
      cache-size: "1000"
      cache-timeout: "300000"
      authorization: ~</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="flushing_acl_caches"><a class="anchor" href="#flushing_acl_caches"></a>8.7.1. Flushing ACL caches</h4>
<div class="paragraph">
<p>It is possible to flush the ACL cache using the <code>GlobalSecurityManager</code> MBean, accessible over JMX.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="statistics-jmx"><a class="anchor" href="#statistics-jmx"></a>9. Enabling and configuring Infinispan statistics and JMX monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan can provide Cache Manager and cache statistics as well as export JMX MBeans.</p>
</div>
<div class="sect2">
<h3 id="enabling-statistics-remote_statistics-jmx"><a class="anchor" href="#enabling-statistics-remote_statistics-jmx"></a>9.1. Enabling statistics in remote caches</h3>
<div class="paragraph">
<p>Infinispan Server automatically enables statistics for the default Cache Manager.
However, you must explicitly enable statistics for your caches.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>statistics</code> attribute or field and specify <code>true</code> as the value.</p>
</li>
<li>
<p>Save and close your Infinispan configuration.</p>
</li>
</ol>
</div>
<h4 id="remote_cache_statistics" class="discrete">Remote cache statistics</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;distributed-cache statistics="true" /&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "distributed-cache": {
    "statistics": "true"
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">distributedCache:
  statistics: true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-hotrod-client-statistics_statistics-jmx"><a class="anchor" href="#enabling-hotrod-client-statistics_statistics-jmx"></a>9.2. Enabling Hot Rod client statistics</h3>
<div class="paragraph">
<p>Hot Rod Java clients can provide statistics that include remote cache and near-cache hits and misses as well as connection pool usage.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Hot Rod Java client configuration for editing.</p>
</li>
<li>
<p>Set <code>true</code> as the value for the <code>statistics</code> property or invoke the <code>statistics().enable()</code> methods.</p>
</li>
<li>
<p>Export JMX MBeans for your Hot Rod client with the <code>jmx</code> and <code>jmx_domain</code> properties or invoke the <code>jmxEnable()</code> and <code>jmxDomain()</code> methods.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="hot_rod_java_client_statistics" class="discrete">Hot Rod Java client statistics</h4>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder();
builder.statistics().enable()
         .jmxEnable()
         .jmxDomain("my.domain.org")
       .addServer()
         .host("127.0.0.1")
         .port(11222);
RemoteCacheManager remoteCacheManager = new RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">infinispan.client.hotrod.statistics = true
infinispan.client.hotrod.jmx = true
infinispan.client.hotrod.jmx_domain = my.domain.org</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-metrics_statistics-jmx"><a class="anchor" href="#configuring-metrics_statistics-jmx"></a>9.3. Configuring Infinispan metrics</h3>
<div class="paragraph">
<p>Infinispan generates metrics that are compatible with any monitoring system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gauges provide values such as the average number of nanoseconds for write operations or JVM uptime.</p>
</li>
<li>
<p>Histograms provide details about operation execution times such as read,
write, and remove times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Infinispan generates gauges when you enable statistics but you can also configure it to generate histograms.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan metrics are provided at the <code>vendor</code> scope.
Metrics related to the JVM are provided in the <code>base</code> scope.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>metrics</code> element or object to the cache container.</p>
</li>
<li>
<p>Enable or disable gauges with the <code>gauges</code> attribute or field.</p>
</li>
<li>
<p>Enable or disable histograms with the <code>histograms</code> attribute or field.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="metrics_configuration" class="discrete">Metrics configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container statistics="true"&gt;
    &lt;metrics gauges="true"
             histograms="true" /&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "statistics" : "true",
      "metrics" : {
        "gauges" : "true",
        "histograms" : "true"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    statistics: "true"
    metrics:
      gauges: "true"
      histograms: "true"</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan Server exposes statistics through the <code>metrics</code> endpoint that you can collect with monitoring tools such as Prometheus.
To verify that statistics are exported to the <code>metrics</code> endpoint, you can do the following:</p>
</div>
<div class="listingblock primary">
<div class="title">Prometheus format</div>
<div class="content">
<pre class="highlight nowrap"><code>curl -v http://localhost:11222/metrics \
--digest -u username:password</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">OpenMetrics format</div>
<div class="content">
<pre class="highlight nowrap"><code>curl -v http://localhost:11222/metrics \
--digest -u username:password \
-H "Accept: application/openmetrics-text"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan no longer provides metrics in MicroProfile JSON format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://micrometer.io/docs/registry/prometheus">Micrometer Prometheus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jmx_statistics-jmx"><a class="anchor" href="#enabling-jmx_statistics-jmx"></a>9.4. Registering JMX MBeans</h3>
<div class="paragraph">
<p>Infinispan can register JMX MBeans that you can use to collect statistics and
perform administrative operations.
You must also enable statistics otherwise Infinispan provides <code>0</code> values for all statistic attributes in JMX MBeans.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use JMX Mbeans for collecting statistics only when Infinispan is embedded in applications and not with a remote Infinispan server.</p>
</div>
<div class="paragraph">
<p>When you use JMX Mbeans for collecting statistics from a remote Infinispan server, the data received from JMX Mbeans might differ from the data received from other APIs such as REST. In such cases the data received from the other APIs is more accurate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>jmx</code> element or object to the cache container and specify <code>true</code> as the value for the <code>enabled</code> attribute or field.</p>
</li>
<li>
<p>Add the <code>domain</code> attribute or field and specify the domain where JMX MBeans are exposed, if required.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="jmx_configuration" class="discrete">JMX configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container statistics="true"&gt;
    &lt;jmx enabled="true"
         domain="example.com"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "statistics" : "true",
      "jmx" : {
        "enabled" : "true",
        "domain" : "example.com"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    statistics: "true"
    jmx:
      enabled: "true"
      domain: "example.com"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="enabling-jmx-port_statistics-jmx"><a class="anchor" href="#enabling-jmx-port_statistics-jmx"></a>9.4.1. Enabling JMX remote ports</h4>
<div class="paragraph">
<p>Provide unique remote JMX ports to expose Infinispan MBeans through connections in JMXServiceURL format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan Server does not expose JMX remotely via the single port endpoint.
If you want to remotely access Infinispan Server via JMX you must enable a remote port.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can enable remote JMX ports using one of the following approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable remote JMX ports that require authentication to one of the Infinispan Server security realms.</p>
</li>
<li>
<p>Enable remote JMX ports manually using the standard Java management configuration options.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>For remote JMX with authentication, define JMX specific user roles using the default security realm.
Users must have <code>controlRole</code> with read/write access or the <code>monitorRole</code> with read-only access to access any JMX resources.
Infinispan automatically maps global <code>ADMIN</code> and <code>MONITOR</code> permissions to the JMX <code>controlRole</code> and <code>monitorRole</code> roles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Start Infinispan Server with a remote JMX port enabled using one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable remote JMX through port <code>9999</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh --jmx 9999</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using remote JMX with SSL disabled is not intended for production environments.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pass the following system properties to Infinispan Server at startup.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enabling remote JMX with no authentication or SSL is not secure and not recommended in any environment.
Disabling authentication and SSL allows unauthorized users to connect to your server and access the data hosted there.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#creating-security-realms_security-realms">Creating security realms</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jmx-mbeans_statistics-jmx"><a class="anchor" href="#jmx-mbeans_statistics-jmx"></a>9.4.2. Infinispan MBeans</h4>
<div class="paragraph">
<p>Infinispan exposes JMX MBeans that represent manageable resources.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan:type=Cache</code></dt>
<dd>
<p>Attributes and operations available for cache instances.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan:type=CacheManager</code></dt>
<dd>
<p>Attributes and operations available for Cache Managers, including Infinispan cache and cluster health statistics.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For a complete list of available JMX MBeans along with descriptions and
available operations and attributes, see the <em>Infinispan JMX Components</em>
documentation.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/jmxComponents.html">Infinispan JMX Components</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-jmx-mbean-servers-statistics-jmx"><a class="anchor" href="#registering-jmx-mbean-servers-statistics-jmx"></a>9.4.3. Registering MBeans in custom MBean servers</h4>
<div class="paragraph">
<p>Infinispan includes an <code>MBeanServerLookup</code> interface that you can use to
register MBeans in custom MBeanServer instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an implementation of <code>MBeanServerLookup</code> so that the <code>getMBeanServer()</code> method returns the custom MBeanServer instance.</p>
</li>
<li>
<p>Configure Infinispan to register JMX MBeans.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>mbean-server-lookup</code> attribute or field to the JMX configuration for the Cache Manager.</p>
</li>
<li>
<p>Specify fully qualified name (FQN) of your <code>MBeanServerLookup</code> implementation.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h5 id="jmx_mbean_server_lookup_configuration" class="discrete">JMX MBean server lookup configuration</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container statistics="true"&gt;
    &lt;jmx enabled="true"
         domain="example.com"
         mbean-server-lookup="com.example.MyMBeanServerLookup"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "statistics" : "true",
      "jmx" : {
        "enabled" : "true",
        "domain" : "example.com",
        "mbean-server-lookup" : "com.example.MyMBeanServerLookup"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    statistics: "true"
    jmx:
      enabled: "true"
      domain: "example.com"
      mbeanServerLookup: "com.example.MyMBeanServerLookup"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="displaying-metrics-state-transfer_statistics-jmx"><a class="anchor" href="#displaying-metrics-state-transfer_statistics-jmx"></a>9.5. Exporting metrics during a state transfer operation</h3>
<div class="paragraph">
<p>You can export time metrics for clustered caches that Infinispan redistributes across nodes.</p>
</div>
<div class="paragraph">
<p>A state transfer operation occurs when a clustered cache topology changes, such as a node joining or leaving a cluster.
During a state transfer operation, Infinispan exports metrics from each cache, so that you can determine a cache&#8217;s status.
A state transfer exposes attributes as properties, so that Infinispan can export metrics from each cache.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot perform a state transfer operation in invalidation mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Infinispan generates time metrics that are compatible with the REST API and the JMX API.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure Infinispan metrics.</p>
</li>
<li>
<p>Enable metrics for your cache type, such as embedded cache or remote cache.</p>
</li>
<li>
<p>Initiate a state transfer operation by changing your clustered cache topology.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Choose one of the following methods:</p>
<div class="ulist">
<ul>
<li>
<p>Configure Infinispan to use the REST API to collect metrics.</p>
</li>
<li>
<p>Configure Infinispan to use the JMX API to collect metrics.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../configuring/configuring.html#statistics-jmx">Enabling and configuring Infinispan statistics and JMX monitoring (Infinispan caches)</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocsjmxComponents.html#StateTransferManager"><code>StateTransferManager</code> (Infinispan 15.0 API)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="monitor-xsite-replication"><a class="anchor" href="#monitor-xsite-replication"></a>9.6. Monitoring the status of cross-site replication</h3>
<div class="paragraph">
<p>Monitor the site status of your backup locations to detect interruptions in the communication between the sites.
When a remote site status changes to <code>offline</code>, Infinispan stops replicating your data to the backup location.
Your data become out of sync and you must fix the inconsistencies before bringing the clusters back online.</p>
</div>
<div class="paragraph">
<p>Monitoring cross-site events is necessary for early problem detection.
Use one of the following monitoring strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#monitoring-cross-site-rest">Monitoring cross-site replication with the REST API</a></p>
</li>
<li>
<p><a href="#monitoring-cross-site-prometheus">Monitoring cross-site replication with the Prometheus metrics</a> or any other monitoring system</p>
</li>
</ul>
</div>
<h4 id="monitoring-cross-site-rest" class="discrete">Monitoring cross-site replication with the REST API</h4>
<div class="paragraph">
<p>Monitor the status of cross-site replication for all caches using the REST endpoint.
You can implement a custom script to poll the REST endpoint or use the following example.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Enable cross-site replication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Implement a script to poll the REST endpoint.</p>
<div class="paragraph">
<p>The following example demonstrates how you can use a Python script to poll the site status every five seconds.</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-python" data-lang="python">#!/usr/bin/python3
import time
import requests
from requests.auth import HTTPDigestAuth


class InfinispanConnection:

    def __init__(self, server: str = 'http://localhost:11222', cache_manager: str = 'default',
                 auth: tuple = ('admin', 'change_me')) -&gt; None:
        super().__init__()
        self.__url = f'{server}/rest/v2/container/x-site/backups/'
        self.__auth = auth
        self.__headers = {
            'accept': 'application/json'
        }

    def get_sites_status(self):
        try:
            rsp = requests.get(self.__url, headers=self.__headers, auth=HTTPDigestAuth(self.__auth[0], self.__auth[1]))
            if rsp.status_code != 200:
                return None
            return rsp.json()
        except:
            return None


# Specify credentials for Infinispan user with permission to access the REST endpoint
USERNAME = 'admin'
PASSWORD = 'change_me'
# Set an interval between cross-site status checks
POLL_INTERVAL_SEC = 5
# Provide a list of servers
SERVERS = [
    InfinispanConnection('http://127.0.0.1:11222', auth=(USERNAME, PASSWORD)),
    InfinispanConnection('http://127.0.0.1:12222', auth=(USERNAME, PASSWORD))
]
#Specify the names of remote sites
REMOTE_SITES = [
    'nyc'
]
#Provide a list of caches to monitor
CACHES = [
    'work',
    'sessions'
]


def on_event(site: str, cache: str, old_status: str, new_status: str):
    # TODO implement your handling code here
    print(f'site={site} cache={cache} Status changed {old_status} -&gt; {new_status}')


def __handle_mixed_state(state: dict, site: str, site_status: dict):
    if site not in state:
        state[site] = {c: 'online' if c in site_status['online'] else 'offline' for c in CACHES}
        return

    for cache in CACHES:
        __update_cache_state(state, site, cache, 'online' if cache in site_status['online'] else 'offline')


def __handle_online_or_offline_state(state: dict, site: str, new_status: str):
    if site not in state:
        state[site] = {c: new_status for c in CACHES}
        return

    for cache in CACHES:
        __update_cache_state(state, site, cache, new_status)


def __update_cache_state(state: dict, site: str, cache: str, new_status: str):
    old_status = state[site].get(cache)
    if old_status != new_status:
        on_event(site, cache, old_status, new_status)
        state[site][cache] = new_status


def update_state(state: dict):
    rsp = None
    for conn in SERVERS:
        rsp = conn.get_sites_status()
        if rsp:
            break
    if rsp is None:
        print('Unable to fetch site status from any server')
        return

    for site in REMOTE_SITES:
        site_status = rsp.get(site, {})
        new_status = site_status.get('status')
        if new_status == 'mixed':
            __handle_mixed_state(state, site, site_status)
        else:
            __handle_online_or_offline_state(state, site, new_status)


if __name__ == '__main__':
    _state = {}
    while True:
        update_state(_state)
        time.sleep(POLL_INTERVAL_SEC)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a site status changes from <code>online</code> to <code>offline</code> or vice-versa, the function <code>on_event</code> is invoked.</p>
</div>
<div class="paragraph">
<p>If you want to use this script, you must specify the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>USERNAME</code> and <code>PASSWORD</code>: The username and password of Infinispan user with permission to access the REST endpoint.</p>
</li>
<li>
<p><code>POLL_INTERVAL_SEC</code>: The number of seconds between polls.</p>
</li>
<li>
<p><code>SERVERS</code>: The list of Infinispan Servers at this site.
The script only requires a single valid response but the list is provided to allow fail over.</p>
</li>
<li>
<p><code>REMOTE_SITES</code>: The list of remote sites to monitor on these servers.</p>
</li>
<li>
<p><code>CACHES</code>: The list of cache names to monitor.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../rest/rest.html#rest_v2_cache_manager_site_status_rest">REST API: Getting status of backup locations</a></p>
</li>
</ul>
</div>
<h4 id="monitoring-cross-site-prometheus" class="discrete">Monitoring cross-site replication with the Prometheus metrics</h4>
<div class="paragraph">
<p>Prometheus, and other monitoring systems, let you configure alerts to detect when a site status changes to <code>offline</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Monitoring cross-site latency metrics can help you to discover potential issues.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Enable cross-site replication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure Infinispan metrics.</p>
</li>
<li>
<p>Configure alerting rules using the Prometheus metrics format.</p>
<div class="ulist">
<ul>
<li>
<p>For the site status, use <code>1</code> for <code>online</code> and <code>0</code> for <code>offline</code>.</p>
</li>
<li>
<p>For the <code>expr</code> filed, use the following format:<br>
<code>vendor_cache_manager_default_cache_&lt;cache name&gt;_x_site_admin_&lt;site name&gt;_status</code>.</p>
<div class="paragraph">
<p>In the following example, Prometheus alerts you when the <strong>NYC</strong> site gets <code>offline</code> for cache named <code>work</code> or <code>sessions</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">groups:
- name: Cross Site Rules
  rules:
  - alert: Cache Work and Site NYC
    expr: vendor_cache_manager_default_cache_work_x_site_admin_nyc_status == 0
  - alert: Cache Sessions and Site NYC
    expr: vendor_cache_manager_default_cache_sessions_x_site_admin_nyc_status == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following image shows an alert that the <strong>NYC</strong> site is <code>offline</code> for cache <code>work</code>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../../topics/images/prometheus_xsite_alert.png" alt="prometheus xsite alert">
</div>
<div class="title">Figure 1. Prometheus Alert</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#configuring-metrics_statistics-jmx">Configuring Infinispan metrics</a></p>
</li>
<li>
<p><a href="https://prometheus.io/docs/alerting/latest/overview/">Prometheus Alerting Overview</a></p>
</li>
<li>
<p><a href="https://grafana.com/docs/grafana/latest/alerting/">Grafana Alerting Documentation</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/monitoring/managing-alerts.html#creating-alerting-rules-for-user-defined-projects_managing-alerts">Openshift Managing Alerts</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="opentelemetry-tracing"><a class="anchor" href="#opentelemetry-tracing"></a>10. Enabling and configuring Infinispan OpenTelemetry tracing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan generates tracing spans compatible with the OpenTelemetry standard, allowing you to export, visualize, and analyze tracing data related to the most important cache operations.</p>
</div>
<div class="sect2">
<h3 id="configuring-tracing_opentelemetry-tracing"><a class="anchor" href="#configuring-tracing_opentelemetry-tracing"></a>10.1. Configuring Infinispan tracing</h3>
<div class="paragraph">
<p>Configure OpenTelemetry tracing, to enable monitoring and tracing of cache operations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>tracing</code> element or object to the cache container.</p>
</li>
<li>
<p>Define the endpoint URL of the OpenTelemetry collector with the <code>collector_endpoint</code> attribute or field. It is mandatory to enable tracing. <code>4318</code> is typically the <code>http/protobuf</code> OTLP standard port.</p>
</li>
<li>
<p>Enable or disable tracing globally with the <code>enable</code> attribute or field.</p>
</li>
<li>
<p>Enable or disable security event tracing with the <code>security</code> attribute or field.</p>
</li>
<li>
<p>Optionally change the tracing exporter protocol changing the <code>exporter_protocol</code> attribute or field. By default, it is <code>otlp</code> (OpenTelemetry protocol).</p>
</li>
<li>
<p>Optionally change the tracing service name associated with the generated tracing span changing the <code>service_name</code> attribute or field. By default, it is <code>infinispan-server</code>.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>To apply any global tracing configuration changes, stop the server and repeat the procedure.</p>
</div>
<h4 id="tracing_configuration" class="discrete">Tracing configuration</h4>
<div class="paragraph">
<p>Infinispan applies the tracing configuration globally to all caches.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container statistics="true"&gt;
    &lt;tracing collector-endpoint="http://localhost:4318"
             enabled="true"
             exporter-protocol="OTLP"
             service-name="infinispan-server"
             security="false" /&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "cache-container" : {
      "statistics" : true,
      "tracing" : {
        "collector-endpoint" : "http://localhost:4318",
        "enabled" : true,
        "exporter-protocol" : "OTLP",
        "service-name" : "infinispan-server",
        "security" : false
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  cacheContainer:
    statistics: true
    tracing:
      collector-endpoint: "http://localhost:4318"
      enabled: true
      exporter-protocol: "OTLP"
      service-name: "infinispan-server"
      security: false</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="further_tracing_options"><a class="anchor" href="#further_tracing_options"></a>10.1.1. Further Tracing Options</h4>
<div class="paragraph">
<p>To configure further tracing options it is possible to pass system properties or to set environment variables to the Infinispan server at startup
to configure directly the <a href="https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk-extensions/autoconfigure/README.md">OpenTelemetry SDK Autoconfigure</a>
that is used by the Infinispan server to configure the OpenTelemetry tracing.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pass the system properties to Infinispan Server at startup.</p>
<div class="paragraph">
<p>Use <code>-D&lt;property-name&gt;=&lt;property-value&gt;</code> arguments like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -Dotel.exporter.otlp.timeout=10000</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk-extensions/autoconfigure/README.md">OpenTelemetry SDK Autoconfigure</a></p>
</li>
</ul>
</div>
<h4 id="tracing_data_format" class="discrete">Tracing data format</h4>
<div class="paragraph">
<p>The Infinispan Server, by default, exports tracing data using the OTLP <code>http/protobuf</code> protocol.</p>
</div>
<div class="listingblock">
<div class="title">tracing.properties</div>
<div class="content">
<pre class="highlight nowrap"><code>otel.exporter.otlp.protocol = http/protobuf</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a different protocol, you must copy  JAR files or dependencies to the <code>$ISPN_HOME/server/lib</code> directory of your Infinispan Server installation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tracing_cache"><a class="anchor" href="#tracing_cache"></a>10.2. Configure tracing at cache level</h3>
<div class="paragraph">
<p>Once the tracing is <a href="#configuring-tracing_opentelemetry-tracing">configured at server level</a>,
it will be automatically enabled by default for all caches.
A cache configuration level of tracing allows on the other hand to enable or disable it at cache level and at runtime.</p>
</div>
<h4 id="tracing_categories" class="discrete">Tracing categories</h4>
<div class="paragraph">
<p>Several categories are potentially traced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container. That are all the main cache operations, such as replace, put, clear, getForReplace, remove operations and size. With the exception of all the getting operation.</p>
</li>
<li>
<p>Cluster. Operations that are replicated to another node in the same cluster.</p>
</li>
<li>
<p>X-Site. Operations that are replicated to another external site.</p>
</li>
<li>
<p>Persistence. All the operations involving persistence via a cache store and/or cache loader.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of category can be enabled/disabled at start time or runtime listing them in the <code>categories</code> list attribute.
By default only the container category is enabled.</p>
</div>
<div class="paragraph">
<p>There is also the <code>Security</code> category, to trace security audit events.
This category is configured globally, not only at cache level, since their events can have different scopes (cache, container or server),
not only cache scope.</p>
</div>
<h4 id="enabledisable_tracing_for_a_given_cache" class="discrete">Enable/disable tracing for a given cache</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;replicated-cache&gt;
    &lt;tracing enabled="true" categories="container cluster x-site persistence" /&gt;
&lt;/replicated-cache&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "distributed-cache": {
    "tracing": {
      "enabled" : true,
      "categories": [
        "container",
        "cluster",
        "x-site",
        "persistence"
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">distributedCache:
  tracing:
    enabled: true
    categories:
      - "container"
      - "cluster"
      - "x-site"
      - "persistence"</code></pre>
</div>
</div>
<h4 id="enabledisable_tracing_at_runtime" class="discrete">Enable/disable tracing at runtime</h4>
<div class="paragraph">
<p>The cache-level tracing attribute <code>enable</code> is a mutable attribute,
it means it can be changed at runtime without the need to restart the Infinispan cluster.</p>
</div>
<div class="paragraph">
<p>To change a mutable attribute both HotRod and REST APIs can be used.</p>
</div>
<div class="listingblock primary">
<div class="title">HotRod</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">remoteCacheManager.administration()
   .updateConfigurationAttribute(CACHE_A, "tracing.enabled", "false");</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">REST</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">restClient.cache(CACHE_A)
   .updateConfigurationAttribute("tracing.enabled", "false");</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../rest/rest.html#rest_v2_cache_mutable_attribute_set">Updating cache configuration attributes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managed-datasources"><a class="anchor" href="#managed-datasources"></a>11. Adding managed datasources to Infinispan Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Optimize connection pooling and performance for JDBC database connections by adding managed datasources to your Infinispan Server configuration.</p>
</div>
<div class="sect2">
<h3 id="configuring-server-datasources_managed-datasources"><a class="anchor" href="#configuring-server-datasources_managed-datasources"></a>11.1. Configuring managed datasources</h3>
<div class="paragraph">
<p>Create managed datasources as part of your Infinispan Server configuration to optimize connection pooling and performance for JDBC database connections.
You can then specify the JDNI name of the managed datasources in your caches, which centralizes JDBC connection configuration for your deployment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Copy database drivers to the <code>server/lib</code> directory in your Infinispan Server installation.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code class="command">install</code> command with the Infinispan Command Line Interface (CLI) to download the required drivers to the <code>server/lib</code> directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>install org.postgresql:postgresql:42.7.3</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a new <code>data-source</code> to the <code>data-sources</code> section.</p>
</li>
<li>
<p>Uniquely identify the datasource with the <code>name</code> attribute or field.</p>
</li>
<li>
<p>Specify a JNDI name for the datasource with the <code>jndi-name</code> attribute or field.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You use the JNDI name to specify the datasource in your JDBC cache store
configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set <code>true</code> as the value of the <code>statistics</code> attribute or field to enable statistics for the datasource through the <code>/metrics</code> endpoint.</p>
</li>
<li>
<p>Provide JDBC driver details that define how to connect to the datasource in the <code>connection-factory</code> section.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify the name of the database driver with the <code>driver</code> attribute or field.</p>
</li>
<li>
<p>Specify the JDBC connection url with the <code>url</code> attribute or field.</p>
</li>
<li>
<p>Specify credentials with the <code>username</code> and <code>password</code> attributes or fields.</p>
</li>
<li>
<p>Provide any other configuration as appropriate.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Define how Infinispan Server nodes pool and reuse connections with connection pool tuning properties in the <code>connection-pool</code> section.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Use the Infinispan Command Line Interface (CLI) to test the datasource connection, as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a CLI session.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>List all datasources and confirm the one you created is available.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server datasource ls</code></pre>
</div>
</div>
</li>
<li>
<p>Test a datasource connection.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server datasource test my-datasource</code></pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="managed_datasource_configuration" class="discrete">Managed datasource configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;data-sources&gt;
     &lt;!-- Defines a unique name for the datasource and JNDI name that you
          reference in JDBC cache store configuration.
          Enables statistics for the datasource, if required. --&gt;
     &lt;data-source name="ds"
                  jndi-name="jdbc/postgres"
                  statistics="true"&gt;
        &lt;!-- Specifies the JDBC driver that creates connections. --&gt;
        &lt;connection-factory driver="org.postgresql.Driver"
                            url="jdbc:postgresql://localhost:5432/postgres"
                            username="postgres"
                            password="changeme"&gt;
           &lt;!-- Sets optional JDBC driver-specific connection properties. --&gt;
           &lt;connection-property name="name"&gt;value&lt;/connection-property&gt;
        &lt;/connection-factory&gt;
        &lt;!-- Defines connection pool tuning properties. --&gt;
        &lt;connection-pool initial-size="1"
                         max-size="10"
                         min-size="3"
                         background-validation="1000"
                         idle-removal="1"
                         blocking-timeout="1000"
                         leak-detection="10000"/&gt;
     &lt;/data-source&gt;
  &lt;/data-sources&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "server": {
    "data-sources": [{
      "name": "ds",
      "jndi-name": "jdbc/postgres",
      "statistics": true,
      "connection-factory": {
        "driver": "org.postgresql.Driver",
        "url": "jdbc:postgresql://localhost:5432/postgres",
        "username": "postgres",
        "password": "changeme",
        "connection-properties": {
          "name": "value"
        }
      },
      "connection-pool": {
        "initial-size": 1,
        "max-size": 10,
        "min-size": 3,
        "background-validation": 1000,
        "idle-removal": 1,
        "blocking-timeout": 1000,
        "leak-detection": 10000
      }
    }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">server:
  dataSources:
    - name: ds
      jndiName: 'jdbc/postgres'
      statistics: true
      connectionFactory:
        driver: "org.postgresql.Driver"
        url: "jdbc:postgresql://localhost:5432/postgres"
        username: "postgres"
        password: "changeme"
        connectionProperties:
          name: value
      connectionPool:
        initialSize: 1
        maxSize: 10
        minSize: 3
        backgroundValidation: 1000
        idleRemoval: 1
        blockingTimeout: 1000
        leakDetection: 10000</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-caches-with-jndi-names_managed-datasources"><a class="anchor" href="#configuring-caches-with-jndi-names_managed-datasources"></a>11.2. Configuring caches with JNDI names</h3>
<div class="paragraph">
<p>When you add a managed datasource to Infinispan Server you can add the JNDI name to a JDBC-based cache store configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure Infinispan Server with a managed datasource.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your cache configuration for editing.</p>
</li>
<li>
<p>Add the <code>data-source</code> element or field to the JDBC-based cache store configuration.</p>
</li>
<li>
<p>Specify the JNDI name of the managed datasource as the value of the <code>jndi-url</code> attribute.</p>
</li>
<li>
<p>Configure the JDBC-based cache stores as appropriate.</p>
</li>
<li>
<p>Save the changes to your configuration.</p>
</li>
</ol>
</div>
<h4 id="jndi_name_in_cache_configuration" class="discrete">JNDI name in cache configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;distributed-cache&gt;
  &lt;persistence&gt;
    &lt;jdbc:string-keyed-jdbc-store&gt;
      &lt;!-- Specifies the JNDI name of a managed datasource on Infinispan Server. --&gt;
      &lt;jdbc:data-source jndi-url="jdbc/postgres"/&gt;
      &lt;jdbc:string-keyed-table drop-on-exit="true" create-on-start="true" prefix="TBL"&gt;
        &lt;jdbc:id-column name="ID" type="VARCHAR(255)"/&gt;
        &lt;jdbc:data-column name="DATA" type="BYTEA"/&gt;
        &lt;jdbc:timestamp-column name="TS" type="BIGINT"/&gt;
        &lt;jdbc:segment-column name="S" type="INT"/&gt;
      &lt;/jdbc:string-keyed-table&gt;
    &lt;/jdbc:string-keyed-jdbc-store&gt;
  &lt;/persistence&gt;
&lt;/distributed-cache&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "distributed-cache": {
    "persistence": {
      "string-keyed-jdbc-store": {
        "data-source": {
          "jndi-url": "jdbc/postgres"
          },
        "string-keyed-table": {
          "prefix": "TBL",
          "drop-on-exit": true,
          "create-on-start": true,
          "id-column": {
            "name": "ID",
            "type": "VARCHAR(255)"
          },
          "data-column": {
            "name": "DATA",
            "type": "BYTEA"
          },
          "timestamp-column": {
            "name": "TS",
            "type": "BIGINT"
          },
          "segment-column": {
            "name": "S",
            "type": "INT"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">distributedCache:
  persistence:
    stringKeyedJdbcStore:
      dataSource:
        jndi-url: "jdbc/postgres"
      stringKeyedTable:
        prefix: "TBL"
        dropOnExit: true
        createOnStart: true
        idColumn:
          name: "ID"
          type: "VARCHAR(255)"
        dataColumn:
          name: "DATA"
          type: "BYTEA"
        timestampColumn:
          name: "TS"
          type: "BIGINT"
        segmentColumn:
          name: "S"
          type: "INT"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-connection-pool-properties_managed-datasources"><a class="anchor" href="#server-connection-pool-properties_managed-datasources"></a>11.3. Connection pool tuning properties</h3>
<div class="paragraph">
<p>You can tune JDBC connection pools for managed datasources in your Infinispan Server configuration.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial number of connections the pool should hold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of connections in the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of connections the pool should hold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>blocking-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum time in milliseconds to block while waiting for a connection before throwing an exception.
This will never throw an exception if creating a new connection takes an inordinately long period of time.
Default is <code>0</code> meaning that a call will wait indefinitely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>background-validation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between background validation runs. A duration of <code>0</code> means that this feature is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validate-on-acquisition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connections idle for longer than this time, specified in milliseconds, are validated before being acquired (foreground validation). A duration of <code>0</code> means that this feature is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>idle-removal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in minutes a connection has to be idle before it can be removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>leak-detection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds a connection has to be held before a leak warning.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster-transport"><a class="anchor" href="#cluster-transport"></a>12. Setting up Infinispan cluster transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan requires a transport layer so nodes can automatically join and leave clusters.
The transport layer also enables Infinispan nodes to replicate or distribute data across the network and perform operations such as re-balancing and state transfer.</p>
</div>
<div class="sect2">
<h3 id="default-jgroups-stacks_cluster-transport"><a class="anchor" href="#default-jgroups-stacks_cluster-transport"></a>12.1. Default JGroups stacks</h3>
<div class="paragraph">
<p>Infinispan provides default JGroups stack files, <code>default-jgroups-*.xml</code>, in the <code>default-configs</code> directory inside the <code>infinispan-core-15.0.13.Final.jar</code> file.</p>
</div>
<div class="paragraph">
<p>You can find this JAR file in the <code>$ISPN_HOME/lib</code> directory.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File name</th>
<th class="tableblock halign-left valign-top">Stack name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-udp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>udp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses UDP for transport and UDP multicast for discovery. Suitable for larger clusters (over 100 nodes) or if you are using replicated caches or invalidation mode. Minimizes the number of open sockets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-tcp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and the <code>MPING</code> protocol for discovery, which uses
<code>UDP</code> multicast. Suitable for smaller clusters (under 100 nodes) <em>only if</em> you are using distributed caches because TCP is more efficient than UDP as a point-to-point protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-kubernetes.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>DNS_PING</code> for discovery. Suitable for Kubernetes and Red Hat OpenShift nodes where UDP multicast is not always available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ec2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>aws.S3_PING</code> for discovery. Suitable for Amazon EC2 nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>GOOGLE_PING2</code> for discovery. Suitable for Google Cloud Platform nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>AZURE_PING</code> for discovery. Suitable for Microsoft Azure nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-tunnel.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tunnel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <code>TUNNEL</code> for transport.
Suitable for environments where the Infinispan is behind a firewall and direct connection between Infinispan nodes is impossible.
It requires an external and accessible service (<a href="http://jgroups.org/manual5/index.html#TUNNEL_Advanced">Gossip Router</a>) to redirect the traffic.
It requires <code>jgroups.tunnel.hosts</code> property to be set in the format <code>host1[port],host2[port],&#8230;&#8203;</code> with the Gossip Router(s) hosts and ports.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#protlist">JGroups Protocols</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cluster-discovery-protocols_cluster-transport"><a class="anchor" href="#cluster-discovery-protocols_cluster-transport"></a>12.2. Cluster discovery protocols</h3>
<div class="paragraph">
<p>Infinispan supports different protocols that allow nodes to automatically find each other on the network and form clusters.</p>
</div>
<div class="paragraph">
<p>There are two types of discovery mechanisms that Infinispan can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generic discovery protocols that work on most networks and do not rely on external services.</p>
</li>
<li>
<p>Discovery protocols that rely on external services to store and retrieve topology information for Infinispan clusters.<br>
For instance the DNS_PING protocol performs discovery through DNS server records.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Running Infinispan on hosted platforms requires using discovery mechanisms that are adapted to network constraints that individual cloud providers impose.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#DiscoveryProtocols">JGroups Discovery Protocols</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="discovery-ping_cluster-transport"><a class="anchor" href="#discovery-ping_cluster-transport"></a>12.2.1. PING</h4>
<div class="paragraph">
<p>PING, or UDPPING is a generic JGroups discovery mechanism that uses dynamic multicasting with the UDP protocol.</p>
</div>
<div class="paragraph">
<p>When joining, nodes send PING requests to an IP multicast address to discover other nodes already in the Infinispan cluster.
Each node responds to the PING request with a packet that contains the address of the coordinator node and its own address. C=coordinators address and A=own address.
If no nodes respond to the PING request, the joining node becomes the coordinator node in a new cluster.</p>
</div>
<div class="listingblock">
<div class="title">PING configuration example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;PING num_discovery_runs="3"/&gt;</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#PING">JGroups PING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-tcpping_cluster-transport"><a class="anchor" href="#discovery-tcpping_cluster-transport"></a>12.2.2. TCPPING</h4>
<div class="paragraph">
<p>TCPPING is a generic JGroups discovery mechanism that uses a list of static addresses for cluster members.</p>
</div>
<div class="paragraph">
<p>With TCPPING, you manually specify the IP address or hostname of each node in the Infinispan cluster as part of the JGroups stack, rather than letting nodes discover each other dynamically.</p>
</div>
<div class="listingblock">
<div class="title">TCPPING configuration example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;TCP bind_port="7800" /&gt;
&lt;TCPPING timeout="3000"
         initial_hosts="${jgroups.tcpping.initial_hosts:hostname1[port1],hostname2[port2]}"
         port_range="0"
         num_initial_members="3"/&gt;</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#TCPPING_Prot">JGroups TCPPING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-mping_cluster-transport"><a class="anchor" href="#discovery-mping_cluster-transport"></a>12.2.3. MPING</h4>
<div class="paragraph">
<p>MPING uses IP multicast to discover the initial membership of Infinispan clusters.</p>
</div>
<div class="paragraph">
<p>You can use MPING to replace TCPPING discovery with TCP stacks and use multicasing for discovery instead of static lists of initial hosts.
However, you can also use MPING with UDP stacks.</p>
</div>
<div class="listingblock">
<div class="title">MPING configuration example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;MPING mcast_addr="${jgroups.mcast_addr:239.6.7.8}"
       mcast_port="${jgroups.mcast_port:46655}"
       num_discovery_runs="3"
       ip_ttl="${jgroups.udp.ip_ttl:2}"/&gt;</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#MPING">JGroups MPING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-tcp-gossip_cluster-transport"><a class="anchor" href="#discovery-tcp-gossip_cluster-transport"></a>12.2.4. TCPGOSSIP</h4>
<div class="paragraph">
<p>Gossip routers provide a centralized location on the network from which your
Infinispan cluster can retrieve addresses of other nodes.</p>
</div>
<div class="paragraph">
<p>You inject the address (<code>IP:PORT</code>) of the Gossip router into Infinispan nodes as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass the address as a system property to the JVM; for example, <code>-DGossipRouterAddress="10.10.2.4[12001]"</code>.</p>
</li>
<li>
<p>Reference that system property in the JGroups configuration file.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Gossip router configuration example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;TCP bind_port="7800" /&gt;
&lt;TCPGOSSIP timeout="3000"
           initial_hosts="${GossipRouterAddress}"
           num_initial_members="3" /&gt;</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#TCPGOSSIP_Prot">JGroups Gossip Router</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-jdbcping_cluster-transport"><a class="anchor" href="#discovery-jdbcping_cluster-transport"></a>12.2.5. JDBC_PING2</h4>
<div class="paragraph">
<p>JDBC_PING2 uses shared databases to store information about Infinispan clusters.
This protocol supports any database that can use a JDBC connection.</p>
</div>
<div class="paragraph">
<p>Nodes write their IP addresses to the shared database so joining nodes can find the Infinispan cluster on the network.
When nodes leave Infinispan clusters, they delete their IP addresses from the shared database.</p>
</div>
<div class="listingblock">
<div class="title">JDBC_PING2 configuration example</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;JDBC_PING2 connection_url="jdbc:mysql://localhost:3306/database_name"
           connection_username="user"
           connection_password="password"
           connection_driver="com.mysql.jdbc.Driver"/&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Add the appropriate JDBC driver to the classpath so Infinispan can use JDBC_PING2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="discovery-jdbcping-datasource_cluster-transport"><a class="anchor" href="#discovery-jdbcping-datasource_cluster-transport"></a>Using a server datasource for JDBC_PING2 discovery</h5>
<div class="paragraph">
<p>Add a managed datasource to a Infinispan Server and use it to provide database connections for the cluster transport JDBC_PING2 discovery protocol.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install a Infinispan Server cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy a JDBC driver JAR to your Infinispan Server <code>server/lib</code> directory</p>
</li>
<li>
<p>Create a datasource for your database.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;data-sources&gt;
     &lt;!-- Defines a unique name for the datasource and JNDI name that you
          reference in JDBC cache store configuration.
          Enables statistics for the datasource, if required. --&gt;
     &lt;data-source name="ds"
                  jndi-name="jdbc/postgres"
                  statistics="true"&gt;
        &lt;!-- Specifies the JDBC driver that creates connections. --&gt;
        &lt;connection-factory driver="org.postgresql.Driver"
                            url="jdbc:postgresql://localhost:5432/postgres"
                            username="postgres"
                            password="changeme"&gt;
           &lt;!-- Sets optional JDBC driver-specific connection properties. --&gt;
           &lt;connection-property name="name"&gt;value&lt;/connection-property&gt;
        &lt;/connection-factory&gt;
        &lt;!-- Defines connection pool tuning properties. --&gt;
        &lt;connection-pool initial-size="1"
                         max-size="10"
                         min-size="3"
                         background-validation="1000"
                         idle-removal="1"
                         blocking-timeout="1000"
                         leak-detection="10000"/&gt;
     &lt;/data-source&gt;
  &lt;/data-sources&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a JGroups stack which uses the <code>JDBC_PING2</code> protocol for discovery.</p>
</li>
<li>
<p>Configure cluster transport to use the datasource by specifying the name of the datasource with the <code>server:data-source</code> attribute.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
    &lt;jgroups&gt;
        &lt;stack name="jdbc" extends="tcp"&gt;
            &lt;JDBC_PING2 stack.combine="REPLACE" stack.position="MPING" /&gt;
        &lt;/stack&gt;
    &lt;/jgroups&gt;
    &lt;cache-container&gt;
        &lt;transport stack="jdbc" server:data-source="ds" /&gt;
    &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#JDBC_PING2">JDBC_PING2 documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-dns-ping_cluster-transport"><a class="anchor" href="#discovery-dns-ping_cluster-transport"></a>12.2.6. DNS_PING</h4>
<div class="paragraph">
<p>JGroups DNS_PING queries DNS servers to discover Infinispan cluster members
in Kubernetes environments such as OKD and Red Hat OpenShift.</p>
</div>
<div class="listingblock">
<div class="title">DNS_PING configuration example</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dns.DNS_PING dns_query="myservice.myproject.svc.cluster.local" /&gt;</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#_dns_ping">JGroups DNS_PING</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a> (Kubernetes documentation for adding DNS entries)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-cloud-discovery-protocols_cluster-transport"><a class="anchor" href="#jgroups-cloud-discovery-protocols_cluster-transport"></a>12.2.7. Cloud discovery protocols</h4>
<div class="paragraph">
<p>Infinispan includes default JGroups stacks that use discovery protocol implementations that are specific to cloud providers.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Discovery protocol</th>
<th class="tableblock halign-left valign-top">Default stack file</th>
<th class="tableblock halign-left valign-top">Artifact</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.S3_PING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.aws:jgroups-aws</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.0.0.Final</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GOOGLE_PING2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.google:jgroups-google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.0.0.Final</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure.AZURE_PING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.azure:jgroups-azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.0.2.Final</code></p></td>
</tr>
</tbody>
</table>
<h5 id="providing_dependencies_for_cloud_discovery_protocols" class="discrete">Providing dependencies for cloud discovery protocols</h5>
<div class="paragraph">
<p>To use <code>aws.S3_PING</code>, <code>GOOGLE_PING2</code>, or <code>azure.AZURE_PING</code> cloud discovery protocols, you need to provide dependent libraries to Infinispan.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the artifact JAR file and all dependencies.</p>
</li>
<li>
<p>Add the artifact JAR file and all dependencies to the <code>$ISPN_HOME/server/lib</code> directory of your Infinispan Server installation.</p>
<div class="paragraph">
<p>For more details see the <a href="https://access.redhat.com/solutions/6048651">Downloading artifacts for JGroups cloud discover protocols for Data Grid Server</a> ({RedHat} knowledgebase article)</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can then configure the cloud discovery protocol as part of a JGroups stack file or with system properties.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-aws">JGroups aws.S3_PING</a></p>
</li>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-google">JGroups GOOGLE_PING2</a></p>
</li>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-azure">JGroups azure.AZURE_PING</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jgroups-default-stacks_cluster-transport"><a class="anchor" href="#using-jgroups-default-stacks_cluster-transport"></a>12.3. Using the default JGroups stacks</h3>
<div class="paragraph">
<p>Infinispan uses JGroups protocol stacks so nodes can send each other messages on dedicated cluster channels.</p>
</div>
<div class="paragraph">
<p>Infinispan provides preconfigured JGroups stacks for <code>UDP</code> and <code>TCP</code> protocols.
You can use these default stacks as a starting point for building custom cluster transport configuration that is optimized for your network requirements.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following to use one of the default JGroups stacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>stack</code> attribute in your <code>infinispan.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
 &lt;cache-container default-cache="replicatedCache"&gt;
    &lt;!-- Use the default UDP stack for cluster transport. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
               stack="udp"
               node-name="${infinispan.node.name:}"/&gt;
 &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>cluster-stack</code> argument to set the JGroups stack file when Infinispan Server starts:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh --cluster-stack=udp</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan logs the following message to indicate which stack it uses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack udp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-jgroups-stacks_cluster-transport"><a class="anchor" href="#customizing-jgroups-stacks_cluster-transport"></a>12.4. Customizing JGroups stacks</h3>
<div class="paragraph">
<p>Adjust and tune properties to create a cluster transport configuration that works for your network requirements.</p>
</div>
<div class="paragraph">
<p>Infinispan provides attributes that let you extend the default JGroups stacks for easier configuration.
You can inherit properties from the default stacks while combining, removing, and replacing other properties.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new JGroups stack declaration in your <code>infinispan.xml</code> file.</p>
</li>
<li>
<p>Add the <code>extends</code> attribute and specify a JGroups stack to inherit properties from.</p>
</li>
<li>
<p>Use the <code>stack.combine</code> attribute to modify properties for protocols configured in the inherited stack.</p>
</li>
<li>
<p>Use the <code>stack.position</code> attribute to define the location for your custom stack.</p>
</li>
<li>
<p>Specify the stack name as the value for the <code>stack</code> attribute in the <code>transport</code> configuration.</p>
<div class="paragraph">
<p>For example, you might evaluate using a Gossip router and symmetric encryption with the default TCP stack as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;jgroups&gt;
    &lt;!-- Creates a custom JGroups stack named "my-stack". --&gt;
    &lt;!-- Inherits properties from the default TCP stack. --&gt;
    &lt;stack name="my-stack" extends="tcp"&gt;
      &lt;!-- Uses TCPGOSSIP as the discovery mechanism instead of MPING --&gt;
      &lt;TCPGOSSIP initial_hosts="${jgroups.tunnel.gossip_router_hosts:localhost[12001]}"
             stack.combine="REPLACE"
             stack.position="MPING" /&gt;
      &lt;!-- Removes the FD_SOCK2 protocol from the stack. --&gt;
      &lt;FD_SOCK2 stack.combine="REMOVE"/&gt;
      &lt;!-- Modifies the timeout value for the VERIFY_SUSPECT2 protocol. --&gt;
      &lt;VERIFY_SUSPECT2 timeout="2000"/&gt;
      &lt;!-- Adds SYM_ENCRYPT to the stack after VERIFY_SUSPECT2. --&gt;
      &lt;SYM_ENCRYPT sym_algorithm="AES"
                   keystore_name="mykeystore.p12"
                   keystore_type="PKCS12"
                   store_password="changeit"
                   key_password="changeit"
                   alias="myKey"
                   stack.combine="INSERT_AFTER"
                   stack.position="VERIFY_SUSPECT2" /&gt;
    &lt;/stack&gt;
  &lt;/jgroups&gt;
  &lt;cache-container name="default" statistics="true"&gt;
    &lt;!-- Uses "my-stack" for cluster transport. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
               stack="my-stack"
               node-name="${infinispan.node.name:}"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Check Infinispan logs to ensure it uses the stack.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack my-stack</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="jgroups-inheritance-attributes_cluster-transport"><a class="anchor" href="#jgroups-inheritance-attributes_cluster-transport"></a>12.4.1. Inheritance attributes</h4>
<div class="paragraph">
<p>When you extend a JGroups stack, inheritance attributes let you adjust protocols and properties in the stack you are extending.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>stack.position</code> specifies protocols to modify.</p>
</li>
<li>
<p><code>stack.combine</code> uses the following values to extend JGroups stacks:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMBINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides protocol properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPLACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaces protocols.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a protocol into the stack after another protocol.
Does not affect the protocol that you specify as the insertion point.</p>
<p class="tableblock">Protocols in JGroups stacks affect each other based on their location in the stack.
For example, you should put a protocol such as <code>NAKACK2</code> after the <code>SYM_ENCRYPT</code> or <code>ASYM_ENCRYPT</code> protocol so that <code>NAKACK2</code> is secured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a protocols into the stack before another protocol.
Affects the protocol that you specify as the insertion point.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REMOVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes protocols from the stack.</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jgroups-system-properties_cluster-transport"><a class="anchor" href="#using-jgroups-system-properties_cluster-transport"></a>12.5. Using JGroups system properties</h3>
<div class="paragraph">
<p>Pass system properties to Infinispan at startup to tune cluster transport.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use <code>-D&lt;property-name&gt;=&lt;property-value&gt;</code> arguments to set JGroups system properties as required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, set a custom bind port and IP address as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh -Djgroups.bind.port=1234 -Djgroups.bind.address=192.0.2.0</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-system-properties_cluster-transport"><a class="anchor" href="#jgroups-system-properties_cluster-transport"></a>12.5.1. Cluster transport properties</h4>
<div class="paragraph">
<p>Use the following properties to customize JGroups cluster transport.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.bind.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind address for cluster transport.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SITE_LOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.bind.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind port for the socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.mcast_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for multicast, both discovery and inter-cluster communication. The IP address must be a valid "class D" address that is suitable for IP multicast.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>239.6.7.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.mcast_port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the multicast socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.ip_ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time-to-live (TTL) for IP multicast packets. The value defines the number of network hops a packet can make before it is dropped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_pool.min_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of threads for the thread pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_pool.max_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of threads for the thread pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.join_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of milliseconds to wait for join requests to succeed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_dumps_enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dump threads when the thread pool is full.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.fd.port-offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offset from <code>jgroups.bind.port</code> port for the FD (failure detection protocol) socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50000</code> (port <code>57800</code> )</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.frag_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of bytes in a message. Messages larger than that are fragmented.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.diag.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables JGroups diagnostic probing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#SystemProperties">JGroups system properties</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html#protlist">JGroups protocol list</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-extras-properties_cluster-transport"><a class="anchor" href="#jgroups-extras-properties_cluster-transport"></a>12.5.2. System properties for cloud discovery protocols</h4>
<div class="paragraph">
<p>Use the following properties to configure JGroups discovery protocols for hosted platforms.</p>
</div>
<div class="sect4">
<h5 id="amazon_ec2"><a class="anchor" href="#amazon_ec2"></a>Amazon EC2</h5>
<div class="paragraph">
<p>System properties for configuring <code>aws.S3_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.region_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 region.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.bucket_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 bucket. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="google_cloud_platform"><a class="anchor" href="#google_cloud_platform"></a>Google Cloud Platform</h5>
<div class="paragraph">
<p>System properties for configuring <code>GOOGLE_PING2</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.google.bucket_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Google Compute Engine bucket. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="azure"><a class="anchor" href="#azure"></a>Azure</h5>
<div class="paragraph">
<p>System properties for azure.AZURE_PING`.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.storage_account_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure storage account. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.storage_access_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure storage access key.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.container</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid DNS name of the container that stores ping information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="kubernetes"><a class="anchor" href="#kubernetes"></a>Kubernetes</h5>
<div class="paragraph">
<p>System properties for <code>DNS_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.dns.query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DNS record that returns cluster members.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.dns.record</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DNS record type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-inline-jgroups-stacks_cluster-transport"><a class="anchor" href="#using-inline-jgroups-stacks_cluster-transport"></a>12.6. Using inline JGroups stacks</h3>
<div class="paragraph">
<p>You can insert complete JGroups stack definitions into <code>infinispan.xml</code> files.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Embed a custom JGroups stack declaration in your <code>infinispan.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;!-- Contains one or more JGroups stack definitions. --&gt;
  &lt;jgroups&gt;
    &lt;!-- Defines a custom JGroups stack named "prod". --&gt;
    &lt;stack name="prod"&gt;
      &lt;TCP bind_port="7800" port_range="30" recv_buf_size="20000000" send_buf_size="640000"/&gt;
      &lt;RED/&gt;
      &lt;MPING break_on_coord_rsp="true"
             mcast_addr="${jgroups.mping.mcast_addr:239.2.4.6}"
             mcast_port="${jgroups.mping.mcast_port:43366}"
             num_discovery_runs="3"
             ip_ttl="${jgroups.udp.ip_ttl:2}"/&gt;
      &lt;MERGE3 /&gt;
      &lt;FD_SOCK2 /&gt;
      &lt;FD_ALL3 timeout="3000" interval="1000" timeout_check_interval="1000" /&gt;
      &lt;VERIFY_SUSPECT2 timeout="1000" /&gt;
      &lt;pbcast.NAKACK2 use_mcast_xmit="false" xmit_interval="200" xmit_table_num_rows="50"
                      xmit_table_msgs_per_row="1024" xmit_table_max_compaction_time="30000" /&gt;
      &lt;UNICAST3 conn_close_timeout="5000" xmit_interval="200" xmit_table_num_rows="50"
                xmit_table_msgs_per_row="1024" xmit_table_max_compaction_time="30000" /&gt;
      &lt;pbcast.STABLE desired_avg_gossip="2000" max_bytes="1M" /&gt;
      &lt;pbcast.GMS print_local_addr="false" join_timeout="${jgroups.join_timeout:2000}" /&gt;
      &lt;UFC max_credits="4m" min_threshold="0.40" /&gt;
      &lt;MFC max_credits="4m" min_threshold="0.40" /&gt;
      &lt;FRAG4 /&gt;
    &lt;/stack&gt;
  &lt;/jgroups&gt;
  &lt;cache-container default-cache="replicatedCache"&gt;
    &lt;!-- Uses "prod" for cluster transport. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
           stack="prod"
           node-name="${infinispan.node.name:}"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-external-jgroups-stacks_cluster-transport"><a class="anchor" href="#using-external-jgroups-stacks_cluster-transport"></a>12.7. Using external JGroups stacks</h3>
<div class="paragraph">
<p>Reference external files that define custom JGroups stacks in <code>infinispan.xml</code> files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add custom JGroups stack files to the <code>$ISPN_HOME/server/conf</code> directory.</p>
<div class="paragraph">
<p>Alternatively you can specify an absolute path when you declare the external stack file.</p>
</div>
</li>
<li>
<p>Reference the external stack file with the <code>stack-file</code> element.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;jgroups&gt;
     &lt;!-- Creates a "prod-tcp" stack that references an external file. --&gt;
     &lt;stack-file name="prod-tcp" path="prod-jgroups-tcp.xml"/&gt;
  &lt;/jgroups&gt;
 &lt;cache-container default-cache="replicatedCache"&gt;
    &lt;!-- Use the "prod-tcp" stack for cluster transport. --&gt;
 &lt;transport stack="prod-tcp" /&gt;
    &lt;replicated-cache name="replicatedCache"/&gt;
 &lt;/cache-container&gt;
 &lt;!-- Cache configuration goes here. --&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="secure-cluster-transport"><a class="anchor" href="#secure-cluster-transport"></a>12.8. Encrypting cluster transport</h3>
<div class="paragraph">
<p>Secure cluster transport so that nodes communicate with encrypted messages.
You can also configure Infinispan clusters to perform certificate authentication so that only nodes with valid identities can join.</p>
</div>
<div class="sect3">
<h4 id="securing-cluster-transport-tls-identities_secure-cluster-transport"><a class="anchor" href="#securing-cluster-transport-tls-identities_secure-cluster-transport"></a>12.8.1. Securing cluster transport with TLS identities</h4>
<div class="paragraph">
<p>Add SSL/TLS identities to a Infinispan Server security realm and use them to secure cluster transport.
Nodes in the Infinispan Server cluster then exchange SSL/TLS certificates to encrypt JGroups messages, including RELAY messages if you configure cross-site replication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install a Infinispan Server cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a TLS keystore that contains a single certificate to identify Infinispan Server.</p>
<div class="paragraph">
<p>You can also use a PEM file if it contains a private key in PKCS#1 or PKCS#8 format, a certificate, and has an empty password: <code>password=""</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the certificate in the keystore is not signed by a public certificate authority (CA) then you must also create a trust store that contains either the signing certificate or the public key.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the keystore to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add the keystore to a new security realm in your Infinispan Server configuration.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should create dedicated keystores and security realms so that Infinispan Server endpoints do not use the same security realm as cluster transport.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:infinispan:server:15.0"&gt;
  &lt;security&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="cluster-transport"&gt;
        &lt;server-identities&gt;
          &lt;ssl&gt;
            &lt;!-- Adds a keystore that contains a certificate that provides SSL/TLS identity to encrypt cluster transport. --&gt;
            &lt;keystore path="server.pfx"
                      relative-to="infinispan.server.config.path"
                      password="secret"
                      alias="server"/&gt;
          &lt;/ssl&gt;
        &lt;/server-identities&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
  &lt;/security&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure cluster transport to use the security realm by specifying the name of the security realm with the <code>server:security-realm</code> attribute.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;cache-container&gt;
    &lt;transport server:security-realm="cluster-transport"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start Infinispan Server, the following log message indicates that the cluster is using the security realm for cluster transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[org.infinispan.SERVER] ISPN080060: SSL Transport using realm &lt;security_realm_name&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-encryption-protocols_secure-cluster-transport"><a class="anchor" href="#jgroups-encryption-protocols_secure-cluster-transport"></a>12.8.2. JGroups encryption protocols</h4>
<div class="paragraph">
<p>To secure cluster traffic, you can configure Infinispan nodes to encrypt JGroups message payloads with secret keys.</p>
</div>
<div class="paragraph">
<p>Infinispan nodes can obtain secret keys from either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The coordinator node (asymmetric encryption).</p>
</li>
<li>
<p>A shared keystore (symmetric encryption).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from coordinator nodes</div>
<p>You configure asymmetric encryption by adding the <code>ASYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to generate and distribute secret keys.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.
This protects your cluster from man-in-the-middle (MitM) attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Asymmetric encryption secures cluster traffic as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first node in the Infinispan cluster, the coordinator node, generates a secret key.</p>
</li>
<li>
<p>A joining node performs certificate authentication with the coordinator to mutually verify identity.</p>
</li>
<li>
<p>The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.</p>
</li>
<li>
<p>The coordinator node encrypts the secret key with the public key and returns it to the joining node.</p>
</li>
<li>
<p>The joining node decrypts and installs the secret key.</p>
</li>
<li>
<p>The node joins the cluster, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from shared keystores</div>
<p>You configure symmetric encryption by adding the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to obtain secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Nodes install the secret key from a keystore on the Infinispan classpath at startup.</p>
</li>
<li>
<p>Node join clusters, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Comparison of asymmetric and symmetric encryption</div>
<p><code>ASYM_ENCRYPT</code> with certificate authentication provides an additional layer of encryption in comparison with <code>SYM_ENCRYPT</code>.
You provide keystores that encrypt the requests to coordinator nodes for the secret key.
Infinispan automatically generates that secret key and handles cluster traffic, while letting you specify when to generate secret keys.
For example, you can configure clusters to generate new secret keys when nodes leave.
This ensures that nodes cannot bypass certificate authentication and join with old keys.</p>
</div>
<div class="paragraph">
<p><code>SYM_ENCRYPT</code>, on the other hand, is faster than <code>ASYM_ENCRYPT</code> because nodes do not need to exchange keys with the cluster coordinator.
A potential drawback to <code>SYM_ENCRYPT</code> is that there is no configuration to automatically generate new secret keys when cluster membership changes.
Users are responsible for generating and distributing the secret keys that nodes use to encrypt cluster traffic.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jgroups-asym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-asym-encrypt_secure-cluster-transport"></a>12.8.3. Securing cluster transport with asymmetric encryption</h4>
<div class="paragraph">
<p>Configure Infinispan clusters to generate and distribute secret keys that encrypt JGroups messages.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore with certificate chains that enables Infinispan to verify node identity.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SSL_KEY_EXCHANGE</code> and <code>ASYM_ENCRYPT</code> protocols to a JGroups stack in your Infinispan configuration, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;jgroups&gt;
    &lt;!-- Creates a secure JGroups stack named "encrypt-tcp" that extends the default TCP stack. --&gt;
    &lt;stack name="encrypt-tcp" extends="tcp"&gt;
      &lt;!-- Adds a keystore that nodes use to perform certificate authentication. --&gt;
      &lt;!-- Uses the stack.combine and stack.position attributes to insert SSL_KEY_EXCHANGE into the default TCP stack after VERIFY_SUSPECT2. --&gt;
      &lt;SSL_KEY_EXCHANGE keystore_name="mykeystore.jks"
                        keystore_password="changeit"
                        stack.combine="INSERT_AFTER"
                        stack.position="VERIFY_SUSPECT2"/&gt;
      &lt;!-- Configures ASYM_ENCRYPT --&gt;
      &lt;!-- Uses the stack.combine and stack.position attributes to insert ASYM_ENCRYPT into the default TCP stack before pbcast.NAKACK2. --&gt;
      &lt;!-- The use_external_key_exchange = "true" attribute configures nodes to use the `SSL_KEY_EXCHANGE` protocol for certificate authentication. --&gt;
      &lt;ASYM_ENCRYPT asym_keylength="2048"
                    asym_algorithm="RSA"
                    change_key_on_coord_leave = "false"
                    change_key_on_leave = "false"
                    use_external_key_exchange = "true"
                    stack.combine="INSERT_BEFORE"
                    stack.position="pbcast.NAKACK2"/&gt;
    &lt;/stack&gt;
  &lt;/jgroups&gt;
  &lt;cache-container name="default" statistics="true"&gt;
    &lt;!-- Configures the cluster to use the JGroups stack. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
               stack="encrypt-tcp"
               node-name="${infinispan.node.name:}"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>ASYM_ENCRYPT</code> and can obtain the secret key from the coordinator node.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[org.jgroups.protocols.ASYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html">JGroups 5 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-5.3.xsd">JGroups 5.3 Schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jgroups-sym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-sym-encrypt_secure-cluster-transport"></a>12.8.4. Securing cluster transport with symmetric encryption</h4>
<div class="paragraph">
<p>Configure Infinispan clusters to encrypt JGroups messages with secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore that contains a secret key.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;jgroups&gt;
    &lt;!-- Creates a secure JGroups stack named "encrypt-tcp" that extends the default TCP stack. --&gt;
    &lt;stack name="encrypt-tcp" extends="tcp"&gt;
      &lt;!-- Adds a keystore from which nodes obtain secret keys. --&gt;
      &lt;!-- Uses the stack.combine and stack.position attributes to insert SYM_ENCRYPT into the default TCP stack after VERIFY_SUSPECT2. --&gt;
      &lt;SYM_ENCRYPT keystore_name="myKeystore.p12"
                   keystore_type="PKCS12"
                   store_password="changeit"
                   key_password="changeit"
                   alias="myKey"
                   stack.combine="INSERT_AFTER"
                   stack.position="VERIFY_SUSPECT2"/&gt;
    &lt;/stack&gt;
  &lt;/jgroups&gt;
  &lt;cache-container name="default" statistics="true"&gt;
    &lt;!-- Configures the cluster to use the JGroups stack. --&gt;
    &lt;transport cluster="${infinispan.cluster.name}"
               stack="encrypt-tcp"
               node-name="${infinispan.node.name:}"/&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>SYM_ENCRYPT</code> and can obtain the secret key from the shared keystore.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[org.jgroups.protocols.SYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual5/index.html">JGroups 5 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-5.3.xsd">JGroups 5.3 Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-ports_cluster-transport"><a class="anchor" href="#jgroups-ports_cluster-transport"></a>12.9. TCP and UDP ports for cluster traffic</h3>
<div class="paragraph">
<p>Infinispan uses the following ports for cluster transport messages:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP/UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster bind port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups multicast</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>57800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failure detection is provided by <code>FD_SOCK2</code>.</p></td>
</tr>
</tbody>
</table>
<h4 id="cross_site_replication" class="discrete">Cross-site replication</h4>
<div class="paragraph">
<p>Infinispan uses the following ports for the JGroups RELAY2 protocol:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>7900</code></dt>
<dd>
<p>For Infinispan clusters running on Kubernetes.</p>
</dd>
<dt class="hdlist1"><code>7801</code></dt>
<dd>
<p>For other deployments.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-remote-caches"><a class="anchor" href="#creating-remote-caches"></a>13. Creating remote caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you create remote caches at runtime, Infinispan Server synchronizes your configuration across the cluster so that all nodes have a copy.
For this reason you should always create remote caches dynamically with the following mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infinispan Console</p>
</li>
<li>
<p>Infinispan Command Line Interface (CLI)</p>
</li>
<li>
<p>Hot Rod or HTTP clients</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="default-cache-manager-creating-remote-caches"><a class="anchor" href="#default-cache-manager-creating-remote-caches"></a>13.1. Default Cache Manager</h3>
<div class="paragraph">
<p>Infinispan Server provides a default Cache Manager that controls the lifecycle of remote caches.
Starting Infinispan Server automatically instantiates the Cache Manager so you can create and delete remote caches and other resources like Protobuf schema.</p>
</div>
<div class="paragraph">
<p>After you start Infinispan Server and add user credentials, you can view details about the Cache Manager and get cluster information from Infinispan Console.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open <code>127.0.0.1:11222</code> in any browser.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also get information about the Cache Manager through the Command Line Interface (CLI) or REST API:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CLI</dt>
<dd>
<p>Run the <code class="command">describe</code> command in the default container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default]&gt; describe</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">REST</dt>
<dd>
<p>Open <code>127.0.0.1:11222/rest/v2/container/</code> in any browser.</p>
</dd>
</dl>
</div>
<h4 id="default_cache_manager_configuration" class="discrete">Default Cache Manager configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
  &lt;!-- Creates a Cache Manager named "default" and enables metrics. --&gt;
  &lt;cache-container name="default"
                   statistics="true"&gt;
     &lt;!-- Adds cluster transport that uses the default JGroups TCP stack. --&gt;
     &lt;transport cluster="${infinispan.cluster.name:cluster}"
                stack="${infinispan.cluster.stack:tcp}"
                node-name="${infinispan.node.name:}"/&gt;
     &lt;!-- Requires user permission to access caches and perform operations. --&gt;
     &lt;security&gt;
        &lt;authorization/&gt;
     &lt;/security&gt;
  &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "infinispan" : {
    "jgroups" : {
      "transport" : "org.infinispan.remoting.transport.jgroups.JGroupsTransport"
    },
    "cache-container" : {
      "name" : "default",
      "statistics" : "true",
      "transport" : {
        "cluster" : "cluster",
        "node-name" : "",
        "stack" : "tcp"
      },
      "security" : {
        "authorization" : {}
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">infinispan:
  jgroups:
    transport: "org.infinispan.remoting.transport.jgroups.JGroupsTransport"
  cacheContainer:
    name: "default"
    statistics: "true"
    transport:
      cluster: "cluster"
      nodeName: ""
      stack: "tcp"
    security:
      authorization: ~</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-console_creating-remote-caches"><a class="anchor" href="#creating-caches-console_creating-remote-caches"></a>13.2. Creating caches with Infinispan Console</h3>
<div class="paragraph">
<p>Use Infinispan Console to create remote caches in an intuitive visual interface from any web browser.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>127.0.0.1:11222/console/</code> in any browser.</p>
</li>
<li>
<p>Select <strong>Create Cache</strong> and follow the steps as Infinispan Console guides you through the process.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-cli_creating-remote-caches"><a class="anchor" href="#creating-caches-cli_creating-remote-caches"></a>13.3. Creating remote caches with the Infinispan CLI</h3>
<div class="paragraph">
<p>Use the Infinispan Command Line Interface (CLI) to add remote caches on Infinispan Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>connect</code> command and enter your username and password when prompted.</p>
</li>
<li>
<p>Use the <code class="command">create cache</code> command to create remote caches.</p>
<div class="paragraph">
<p>For example, create a cache named "mycache" from a file named <code>mycache.xml</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>create cache --file=mycache.xml mycache</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>List all remote caches with the <code class="command">ls</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ls caches
mycache</code></pre>
</div>
</div>
</li>
<li>
<p>View cache configuration with the <code class="command">describe</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>describe caches/mycache</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-hotrod_creating-remote-caches"><a class="anchor" href="#creating-caches-hotrod_creating-remote-caches"></a>13.4. Creating remote caches from Hot Rod clients</h3>
<div class="paragraph">
<p>Use the Infinispan Hot Rod API to create remote caches on Infinispan Server from Java, C++, .NET/C#, JS clients and more.</p>
</div>
<div class="paragraph">
<p>This procedure shows you how to use Hot Rod Java clients that create remote caches on first access.
You can find code examples for other Hot Rod clients in the <a href="https://infinispan.org/tutorials/simple/simple_tutorials.html">Infinispan Tutorials</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke the <code>remoteCache()</code> method as part of your the <code>ConfigurationBuilder</code>.</p>
</li>
<li>
<p>Set the <code>configuration</code> or <code>configuration_uri</code> properties in the <code>hotrod-client.properties</code> file on your classpath.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">File file = new File("path/to/infinispan.xml")
ConfigurationBuilder builder = new ConfigurationBuilder();
builder.remoteCache("another-cache")
       .configuration("&lt;distributed-cache name=\"another-cache\"/&gt;");
builder.remoteCache("my.other.cache")
       .configurationURI(file.toURI());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="highlight nowrap"><code>infinispan.client.hotrod.cache.another-cache.configuration=&lt;distributed-cache name=\"another-cache\"/&gt;
infinispan.client.hotrod.cache.[my.other.cache].configuration_uri=file:///path/to/infinispan.xml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the name of your remote cache contains the <code>.</code> character, you must enclose it in square brackets when using <code>hotrod-client.properties</code> files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod Client Configuration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/client/hotrod/configuration/RemoteCacheConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.RemoteCacheConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-rest_creating-remote-caches"><a class="anchor" href="#creating-caches-rest_creating-remote-caches"></a>13.5. Creating remote caches with the REST API</h3>
<div class="paragraph">
<p>Use the Infinispan REST API to create remote caches on Infinispan Server from any suitable HTTP client.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke <code>POST</code> requests to <code>/rest/v2/caches/&lt;cache_name&gt;</code> with cache configuration in the payload.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../rest/rest.html#rest_v2_cache_operations">Creating and Managing Caches with the REST API</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remote-execution"><a class="anchor" href="#remote-execution"></a>14. Running scripts and tasks on Infinispan Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add tasks and scripts to Infinispan Server deployments for remote execution from the Command Line Interface (CLI) and Hot Rod or REST clients.
You can implement tasks as custom Java classes or define scripts in languages
such as JavaScript.</p>
</div>
<div class="sect2">
<h3 id="adding-server-tasks_remote-execution"><a class="anchor" href="#adding-server-tasks_remote-execution"></a>14.1. Adding tasks to Infinispan Server deployments</h3>
<div class="paragraph">
<p>Add your custom server task classes to Infinispan Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Stop Infinispan Server if it is running.</p>
<div class="paragraph">
<p>Infinispan Server does not support runtime deployment of custom classes.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a <code>META-INF/services/org.infinispan.tasks.ServerTask</code> file that contains
the fully qualified names of server tasks, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>example.HelloTask</code></pre>
</div>
</div>
</li>
<li>
<p>Package your server task implementation in a JAR file.</p>
</li>
<li>
<p>Copy the JAR file to the <code>$ISPN_HOME/server/lib</code> directory of your Infinispan Server installation.</p>
</li>
<li>
<p>Add your classes to the deserialization allow list in your Infinispan
configuration. Alternatively set the allow list using system properties.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../encoding/encoding.html#adding-deserialization-allowlist_marshaller-implementations">Adding Java Classes to Deserialization Allow Lists</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/">Infinispan Configuration Schema</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="server-tasks_remote-execution"><a class="anchor" href="#server-tasks_remote-execution"></a>14.1.1. Infinispan Server tasks</h4>
<div class="paragraph">
<p>Infinispan Server tasks are classes that extend the
<code>org.infinispan.tasks.ServerTask</code> interface and generally include the following
method calls:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>setTaskContext()</code></dt>
<dd>
<p>Allows access to execution context information including task parameters, cache references on which tasks are executed, and so on. In most cases, implementations store this information locally and use it when tasks are actually executed. When using <code>SHARED</code> instantiation mode, the task should use a <code>ThreadLocal</code> to store the <code>TaskContext</code> for concurrent invocations.</p>
</dd>
<dt class="hdlist1"><code>getName()</code></dt>
<dd>
<p>Returns unique names for tasks. Clients invoke tasks with these names.</p>
</dd>
<dt class="hdlist1"><code>getExecutionMode()</code></dt>
<dd>
<p>Returns the execution mode for tasks.</p>
<div class="ulist">
<ul>
<li>
<p><code>TaskExecutionMode.ONE_NODE</code> only the node that handles the request executes the script. Although scripts can still invoke clustered operations. This is the default.</p>
</li>
<li>
<p><code>TaskExecutionMode.ALL_NODES</code> Infinispan uses clustered executors to run scripts across nodes. For example, server tasks that invoke stream processing need to be executed on a single node because stream processing is distributed to all nodes.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>getInstantiationMode()</code></dt>
<dd>
<p>Returns the instantiation mode for tasks.</p>
<div class="ulist">
<ul>
<li>
<p><code>TaskInstantiationMode.SHARED</code> creates a single instance that is reused for every task execution on the same server. This is the default.</p>
</li>
<li>
<p><code>TaskInstantiationMode.ISOLATED</code> creates a new instance for every invocation.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>call()</code></dt>
<dd>
<p>Computes a result. This method is defined in the
<code>java.util.concurrent.Callable</code> interface and is invoked with server tasks.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server task implementations must adhere to service loader pattern requirements.
For example, implementations must have a zero-argument constructors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following <code>HelloTask</code> class implementation provides an example task that
has one parameter. It also illustrates the use of a <code>ThreadLocal</code> to store the <code>TaskContext</code> for concurrent invocations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package example;

import org.infinispan.tasks.ServerTask;
import org.infinispan.tasks.TaskContext;

public class HelloTask implements ServerTask&lt;String&gt; {

   private static final ThreadLocal&lt;TaskContext&gt; taskContext = new ThreadLocal&lt;&gt;();

   @Override
   public void setTaskContext(TaskContext ctx) {
      taskContext.set(ctx);
   }

   @Override
   public String call() throws Exception {
      TaskContext ctx = taskContext.get();
      String name = (String) ctx.getParameters().get().get("name");
      return "Hello " + name;
   }

   @Override
   public String getName() {
      return "hello-task";
   }

}</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/tasks/ServerTask.html"><code>org.infinispan.tasks.ServerTask</code></a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html?is-external=true#call--"><code>java.util.concurrent.Callable.call()</code></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html"><code>java.util.ServiceLoader</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-scripts_remote-execution"><a class="anchor" href="#adding-scripts_remote-execution"></a>14.2. Adding scripts to Infinispan Server deployments</h3>
<div class="paragraph">
<p>Use the command line interface to add scripts to Infinispan Server.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Infinispan Server stores scripts in the <code>___script_cache</code> cache. If you enable cache authorization, users must have <code>CREATE</code> permissions to add to <code>___script_cache</code>.</p>
</div>
<div class="paragraph">
<p>Assign users the <code>deployer</code> role at minimum if you use default authorization settings.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define scripts as required.</p>
<div class="paragraph">
<p>For example, create a file named <code>multiplication.js</code> that runs on a single
Infinispan server, has two parameters, and uses JavaScript to multiply a given
value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">// mode=local,language=javascript
multiplicand * multiplier</code></pre>
</div>
</div>
</li>
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">task</code> command to upload scripts, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>task upload --file=multiplication.js multiplication</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that your scripts are available.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ls tasks
multiplication</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="server-scripts_remote-execution"><a class="anchor" href="#server-scripts_remote-execution"></a>14.2.1. Infinispan Server scripts</h4>
<div class="paragraph">
<p>Infinispan Server scripting is based on the <code>javax.script</code> API and is
compatible with any JVM-based ScriptEngine implementation.</p>
</div>
<div class="paragraph">
<div class="title">Hello world</div>
<p>The following is a simple example that runs on a single Infinispan server, has
one parameter, and uses JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// mode=local,language=javascript,parameters=[greetee]
"Hello " + greetee</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run the preceding script, you pass a value for the <code>greetee</code> parameter
and Infinispan returns <code>"Hello ${value}"</code>.</p>
</div>
<div class="sect4">
<h5 id="server-script-metdata_remote-execution"><a class="anchor" href="#server-script-metdata_remote-execution"></a>Script metadata</h5>
<div class="paragraph">
<p>Metadata provides additional information about scripts that Infinispan Server uses when running scripts.</p>
</div>
<div class="paragraph">
<p>Script metadata are <code>property=value</code> pairs that you add to comments in the
first lines of scripts, such as the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// name=test, language=javascript
// mode=local, parameters=[a,b,c]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use comment styles that match the scripting language (<code>//</code>, <code>;;</code>, <code>#</code>).</p>
</li>
<li>
<p>Separate <code>property=value</code> pairs with commas.</p>
</li>
<li>
<p>Separate values with single (') or double (") quote characters.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Metadata Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the execution mode and has the following values:</p>
<p class="tableblock"><code>local</code> only the node that handles the request executes the script. Although
scripts can still invoke clustered operations.</p>
<p class="tableblock"><code>distributed</code> Infinispan uses clustered executors to run scripts across nodes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the ScriptEngine that executes the script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extension</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies filename extensions as an alternative method to set the ScriptEngine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies roles that users must have to execute scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an array of valid parameter names for this script. Invocations which specify parameters not included in this list cause exceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datatype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optionally sets the MediaType (MIME type) for storing data as well as
parameter and return values. This property is useful for remote clients that
support particular data formats only.</p>
<p class="tableblock">Currently you can set only <code>text/plain; charset=utf-8</code> to use the String UTF-8
format for data.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="server-script-bindings_remote-execution"><a class="anchor" href="#server-script-bindings_remote-execution"></a>Script bindings</h5>
<div class="paragraph">
<p>Infinispan exposes internal objects as bindings for script execution.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Binding</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the cache against which the script is run.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>marshaller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the marshaller to use for serializing data to the cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the <code>cacheManager</code> for the cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scriptingManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the instance of the script manager that runs the script. You can use
this binding to run other scripts from a script.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="server-script-parameters_remote-execution"><a class="anchor" href="#server-script-parameters_remote-execution"></a>Script parameters</h5>
<div class="paragraph">
<p>Infinispan lets you pass named parameters as bindings for running scripts.</p>
</div>
<div class="paragraph">
<p>Parameters are <code>name,value</code> pairs, where <code>name</code> is a string and <code>value</code> is any
value that the marshaller can interpret.</p>
</div>
<div class="paragraph">
<p>The following example script has two parameters, <code>multiplicand</code> and
<code>multiplier</code>. The script takes the value of <code>multiplicand</code> and multiplies it
with the value of <code>multiplier</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// mode=local,language=javascript
multiplicand * multiplier</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run the preceding script, Infinispan responds with the result of the
expression evaluation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add_script_hotrod"><a class="anchor" href="#add_script_hotrod"></a>14.2.2. Programmatically Creating Scripts</h4>
<div class="paragraph">
<p>Add scripts with the Hot Rod <code>RemoteCache</code> interface as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RemoteCache&lt;String, String&gt; scriptCache = cacheManager.getCache("___script_cache");
scriptCache.put("multiplication.js",
  "// mode=local,language=javascript\n" +
  "multiplicand * multiplier\n");</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-scripts-tasks_remote-execution"><a class="anchor" href="#running-scripts-tasks_remote-execution"></a>14.3. Running scripts and tasks</h3>
<div class="paragraph">
<p>Use the command line interface to run tasks and scripts on Infinispan Server deployments.
Alternatively you can execute scripts and tasks from Hot Rod clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Add scripts or tasks to Infinispan Server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">task</code> command to run tasks and scripts, as in the following examples:</p>
<div class="ulist">
<ul>
<li>
<p>Execute a script named <code>multiplier.js</code> and specify two parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>task exec multiplier.js -Pmultiplicand=10 -Pmultiplier=20
200.0</code></pre>
</div>
</div>
</li>
<li>
<p>Execute a task named <code>@@cache@names</code> to retrieve a list of all available caches:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>task exec @@cache@names
["___protobuf_metadata","mycache","___script_cache"]</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h4 id="programmatic_execution" class="discrete">Programmatic execution</h4>
<div class="ulist">
<ul>
<li>
<p>Call the <code>execute()</code> method to run scripts with the Hot Rod <code>RemoteCache</code>
interface, as in the following examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Script execution</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RemoteCache&lt;String, Integer&gt; cache = cacheManager.getCache();
// Create parameters for script execution.
Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();
params.put("multiplicand", 10);
params.put("multiplier", 20);
// Run the script with the parameters.
Object result = cache.execute("multiplication.js", params);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Task execution</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Add configuration for a locally running server.
ConfigurationBuilder builder = new ConfigurationBuilder();
builder.addServer().host("127.0.0.1").port(11222);

// Connect to the server.
RemoteCacheManager cacheManager = new RemoteCacheManager(builder.build());

// Retrieve the remote cache.
RemoteCache&lt;String, String&gt; cache = cacheManager.getCache();

// Create task parameters.
Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
parameters.put("name", "developer");

// Run the server task.
String greet = cache.execute("hello-task", parameters);
System.out.println(greet);</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-server-logging"><a class="anchor" href="#configuring-server-logging"></a>15. Configuring Infinispan Server logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server uses Apache Log4j 2 to provide configurable logging mechanisms that capture details about the environment and record cache operations for troubleshooting purposes and root cause analysis.</p>
</div>
<div class="sect2">
<h3 id="server-log-files_server-logging"><a class="anchor" href="#server-log-files_server-logging"></a>15.1. Infinispan Server log files</h3>
<div class="paragraph">
<p>Infinispan writes server logs to the following files in the <code>$ISPN_HOME/server/log</code> directory:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>server.log</code></dt>
<dd>
<p>Messages in human readable format, including boot logs that relate to the server startup.<br>
 Infinispan creates this file when you start the server.</p>
</dd>
<dt class="hdlist1"><code>server.log.json</code></dt>
<dd>
<p>Messages in JSON format that let you parse and analyze Infinispan logs.<br>
Infinispan creates this file when you enable the <code>JSON-FILE</code> appender.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="configuring-server-logs_server-logging"><a class="anchor" href="#configuring-server-logs_server-logging"></a>15.1.1. Configuring Infinispan Server logs</h4>
<div class="paragraph">
<p>Infinispan uses Apache Log4j technology to write server log messages.
You can configure server logs in the <code>log4j2.xml</code> file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Change server logging as appropriate.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual">Apache Log4j manual</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="log-levels_server-logging"><a class="anchor" href="#log-levels_server-logging"></a>15.1.2. Log levels</h4>
<div class="paragraph">
<p>Log levels indicate the nature and severity of messages.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Log level</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TRACE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Fine-grained debug messages, capturing the flow of individual requests through the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DEBUG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Messages for general debugging, not related to an individual request.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Messages about the overall progress of applications, including lifecycle events.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>WARN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Events that can lead to error or degrade performance.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ERROR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Error conditions that might prevent operations or activities from being successful but do not prevent applications from running.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>FATAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Events that could cause critical service failure and application shutdown.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the levels of individual messages presented above, the configuration allows two more values: <code>ALL</code> to include all messages, and <code>OFF</code> to exclude all messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="logging-categories_server-logging"><a class="anchor" href="#logging-categories_server-logging"></a>15.1.3. Infinispan logging categories</h4>
<div class="paragraph">
<p>Infinispan provides categories for <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code> level messages that organize logs by functional area.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan.CLUSTER</code></dt>
<dd>
<p>Messages specific to Infinispan clustering that include state transfer operations, rebalancing events, partitioning, and so on.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.CONFIG</code></dt>
<dd>
<p>Messages specific to Infinispan configuration.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.CONTAINER</code></dt>
<dd>
<p>Messages specific to the data container that include expiration and eviction operations, cache listener notifications, transactions, and so on.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.PERSISTENCE</code></dt>
<dd>
<p>Messages specific to cache loaders and stores.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.SECURITY</code></dt>
<dd>
<p>Messages specific to Infinispan security.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.SERVER</code></dt>
<dd>
<p>Messages specific to Infinispan servers.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.XSITE</code></dt>
<dd>
<p>Messages specific to cross-site replication operations.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="log-appenders_server-logging"><a class="anchor" href="#log-appenders_server-logging"></a>15.1.4. Log appenders</h4>
<div class="paragraph">
<p>Log appenders define how Infinispan Server records log messages.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CONSOLE</dt>
<dd>
<p>Write log messages to the host standard out (<code>stdout</code>) or standard error (<code>stderr</code>) stream.<br>
Uses the <code>org.apache.logging.log4j.core.appender.ConsoleAppender</code> class by default.</p>
</dd>
<dt class="hdlist1">FILE</dt>
<dd>
<p>Write log messages to a file.<br>
Uses the <code>org.apache.logging.log4j.core.appender.RollingFileAppender</code> class by default.</p>
</dd>
<dt class="hdlist1">JSON-FILE</dt>
<dd>
<p>Write log messages to a file in JSON format.<br>
Uses the <code>org.apache.logging.log4j.core.appender.RollingFileAppender</code> class by default.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="log-pattern-formatters_server-logging"><a class="anchor" href="#log-pattern-formatters_server-logging"></a>15.1.5. Log pattern formatters</h4>
<div class="paragraph">
<p>The <code>CONSOLE</code> and <code>FILE</code> appenders use a
<a href="https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout"><code>PatternLayout</code></a>
to format the log messages according to a <strong>pattern</strong>.</p>
</div>
<div class="paragraph">
<p>An example is the default pattern in the FILE appender:<br>
<code>%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p (%t) [%c{1}] %m%throwable%n</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>%d{yyyy-MM-dd HH:mm:ss,SSS}</code> adds the current time and date.</p>
</li>
<li>
<p><code>%-5p</code> specifies the log level, aligned to the right.</p>
</li>
<li>
<p><code>%t</code> adds the name of the current thread.</p>
</li>
<li>
<p><code>%c{1}</code> adds the short name of the logging category.</p>
</li>
<li>
<p><code>%m</code> adds the log message.</p>
</li>
<li>
<p><code>%throwable</code> adds the exception stack trace.</p>
</li>
<li>
<p><code>%n</code> adds a new line.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Patterns are fully described in
<a href="https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout">the <code>PatternLayout</code> documentation</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-json-logging_server-logging"><a class="anchor" href="#enabling-json-logging_server-logging"></a>15.1.6. Enabling the JSON log handler</h4>
<div class="paragraph">
<p>Infinispan Server provides a log handler to write messages in JSON format.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Stop Infinispan Server if it is running.<br>
You cannot dynamically enable log handlers.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Uncomment the <code>JSON-FILE</code> appender and comment out the <code>FILE</code> appender:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;!--&lt;AppenderRef ref="FILE"/&gt;--&gt;
&lt;AppenderRef ref="JSON-FILE"/&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Optionally configure the JSON appender and JSON layout as required.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you start Infinispan, it writes each log message as a JSON map in the following file:<br>
<code>$ISPN_HOME/server/log/server.log.json</code></p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual/appenders.html#RollingFileAppender">RollingFileAppender</a></p>
</li>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual/layouts.html#JSONLayout"> JSONLayout</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="access-logs_server-logging"><a class="anchor" href="#access-logs_server-logging"></a>15.2. Access logs</h3>
<div class="paragraph">
<p>Access logs record all inbound client requests for Hot Rod and REST endpoints to files in the <code>$ISPN_HOME/server/log</code> directory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan.HOTROD_ACCESS_LOG</code></dt>
<dd>
<p>Logging category that writes Hot Rod access messages to a <code>hotrod-access.log</code> file.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.REST_ACCESS_LOG</code></dt>
<dd>
<p>Logging category that writes REST access messages to a <code>rest-access.log</code> file.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="enabling-access-logs_server-logging"><a class="anchor" href="#enabling-access-logs_server-logging"></a>15.2.1. Enabling access logs</h4>
<div class="paragraph">
<p>To record Hot Rod, REST and Memcached endpoint access messages, you need to enable the logging categories in <code>log4j2.xml</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Change the level for the <code>org.infinispan.HOTROD_ACCESS_LOG</code>, <code>org.infinispan.REST_ACCESS_LOG</code> and <code>org.infinispan.MEMCACHED_ACCESS_LOG</code> logging categories to <code>TRACE</code>.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;Logger name="org.infinispan.HOTROD_ACCESS_LOG" additivity="false" level="TRACE"&gt;
   &lt;AppenderRef ref="HR-ACCESS-FILE"/&gt;
&lt;/Logger&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="access-log-properties_server-logging"><a class="anchor" href="#access-log-properties_server-logging"></a>15.2.2. Access log properties</h4>
<div class="paragraph">
<p>The default format for access logs is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>%X{address} %X{user} [%d{dd/MMM/yyyy:HH:mm:ss Z}] &amp;quot;%X{method} %m
%X{protocol}&amp;quot; %X{status} %X{requestSize} %X{responseSize} %X{duration}%n</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding format creates log entries such as the following:</p>
</div>
<div class="paragraph">
<p><code>127.0.0.1 - [DD/MM/YYYY:HH:MM:SS +0000] "PUT /rest/v2/caches/default/key HTTP/1.1" 404 5 77 10</code></p>
</div>
<div class="paragraph">
<p>Logging properties use the <code>%X{name}</code> notation and let you modify the format of access logs. The following are the default logging properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the <code>X-Forwarded-For</code> header or the client IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal name, if using authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The protocol-specific method used. <code>PUT</code>, <code>GET</code>, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol used. <code>HTTP/1.1</code>, <code>HTTP/2</code>, <code>HOTROD/2.9</code>, <code>MCTXT</code>, <code>MCBIN</code> and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP status code for the REST endpoint. <code>OK</code> or an exception for the Hot Rod endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds that the server took to handle the request.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the header name prefixed with <code>h:</code> to log headers that were included in requests; for example, <code>%X{h:User-Agent}</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="audit-logs_server-logging"><a class="anchor" href="#audit-logs_server-logging"></a>15.3. Audit logs</h3>
<div class="paragraph">
<p>Audit logs let you track changes to your Infinispan Server deployment so you know when changes occur and which users make them.
Enable and configure audit logging to record server configuration events and administrative operations.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan.AUDIT</code></dt>
<dd>
<p>Logging category that writes security audit messages to an <code>audit.log</code> file in the <code>$ISPN_HOME/server/log</code> directory.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="enabling-audit-logs-server-logging"><a class="anchor" href="#enabling-audit-logs-server-logging"></a>15.3.1. Enabling audit logging</h4>
<div class="paragraph">
<p>To record security audit messages, you need to enable the logging category in <code>log4j2.xml</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Change the level for the <code>org.infinispan.AUDIT</code> logging category to <code>INFO</code>.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;!-- Set to INFO to enable audit logging --&gt;
&lt;Logger name="org.infinispan.AUDIT" additivity="false" level="INFO"&gt;
   &lt;AppenderRef ref="AUDIT-FILE"/&gt;
&lt;/Logger&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-audit-logs_server-logging"><a class="anchor" href="#configuring-audit-logs_server-logging"></a>15.3.2. Configuring audit logging appenders</h4>
<div class="paragraph">
<p>Apache Log4j provides different appenders that you can use to send audit messages to a destination other than the default log file.
For instance, if you want to send audit logs to a syslog daemon, JDBC database, or Apache Kafka server, you can configure an appender in <code>log4j2.xml</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Comment or remove the default <code>AUDIT-FILE</code> rolling file appender.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;!--RollingFile name="AUDIT-FILE"
  ...
&lt;/RollingFile--&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the desired logging appender for audit messages.</p>
<div class="paragraph">
<p>For example, you could add a logging appender for a Kafka server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;Kafka name="AUDIT-KAFKA" topic="audit"&gt;
  &lt;PatternLayout pattern="%date %message"/&gt;
  &lt;Property name="bootstrap.servers"&gt;localhost:9092&lt;/Property&gt;
&lt;/Kafka&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual/appenders.html">Log4j Appenders</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="customizing-audit-logs_server-logging"><a class="anchor" href="#customizing-audit-logs_server-logging"></a>15.3.3. Using custom audit logging implementations</h4>
<div class="paragraph">
<p>You can create custom implementations of the <code>org.infinispan.security.AuditLogger</code> API if configuring Log4j appenders does not meet your needs.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Implement <code>org.infinispan.security.AuditLogger</code> as required and package it in a JAR file.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add your JAR to the <code>server/lib</code> directory in your Infinispan Server installation.</p>
</li>
<li>
<p>Specify the fully qualified class name of your custom audit logger as the value for the <code>audit-logger</code> attribute on the <code>authorization</code> element in your cache container security configuration.</p>
<div class="paragraph">
<p>For example, the following configuration defines <code>my.package.CustomAuditLogger</code> as the class for logging audit messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
   &lt;cache-container&gt;
      &lt;security&gt;
         &lt;authorization audit-logger="my.package.CustomAuditLogger"/&gt;
      &lt;/security&gt;
   &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/apidocs/org/infinispan/security/AuditLogger.html"><code>org.infinispan.security.AuditLogger</code></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rolling-upgrades"><a class="anchor" href="#rolling-upgrades"></a>16. Performing rolling upgrades for Infinispan Server clusters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Perform rolling upgrades of your Infinispan clusters to change between
versions without downtime or data loss and migrate data over the Hot Rod protocol.</p>
</div>
<div class="sect2">
<h3 id="setting-up-target-clusters_rolling-upgrades"><a class="anchor" href="#setting-up-target-clusters_rolling-upgrades"></a>16.1. Setting up target Infinispan clusters</h3>
<div class="paragraph">
<p>Create a cluster that uses the Infinispan version to which you plan to upgrade and then connect the source cluster to the target cluster using a remote cache store.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install Infinispan Server nodes with the desired version for your target cluster.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the network properties for the target cluster do not overlap with those
for the source cluster.
You should specify unique names for the target and source clusters in the JGroups transport configuration.
Depending on your environment you can also use different network interfaces and port offsets to separate the target and source clusters.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a remote cache store configuration, in JSON format, that allows the target cluster to connect to the source cluster.</p>
<div class="paragraph">
<p>Remote cache stores on the target cluster use the Hot Rod protocol to retrieve data from the source cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "remote-store": {
    "cache": "myCache",
    "shared": true,
    "raw-values": true,
    "security": {
      "authentication": {
        "digest": {
          "username": "username",
          "password": "changeme",
          "realm": "default"
        }
      }
    },
    "remote-server": [
      {
        "host": "127.0.0.1",
        "port": 12222
      }
    ]
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Use the Infinispan Command Line Interface (CLI) or REST API to add the remote cache store configuration to the target cluster so it can connect to the source cluster.</p>
<div class="ulist">
<ul>
<li>
<p>CLI: Use the <code class="command">migrate cluster connect</code> command on the target cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default]&gt; migrate cluster connect -c myCache --file=remote-store.json</code></pre>
</div>
</div>
</li>
<li>
<p>REST API: Invoke a POST request that includes the remote store configuration in the payload with the <code>rolling-upgrade/source-connection</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>POST /rest/v2/caches/myCache/rolling-upgrade/source-connection</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Repeat the preceding step for each cache that you want to migrate.</p>
</li>
<li>
<p>Switch clients over to the target cluster, so it starts handling all requests.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update client configuration with the location of the target cluster.</p>
</li>
<li>
<p>Restart clients.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you need to migrate Indexed caches you must first migrate the internal <code>___protobuf_metadata</code> cache so that the .proto
schemas defined on the source cluster will also be present on the target cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/15.0/configdocs/infinispan-cachestore-remote-config-15.0.html">Remote cache store configuration schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-data-target-clusters_rolling-upgrades"><a class="anchor" href="#synchronizing-data-target-clusters_rolling-upgrades"></a>16.2. Synchronizing data to target clusters</h3>
<div class="paragraph">
<p>When you set up a target Infinispan cluster and connect it to a source cluster, the target cluster can handle client requests using a remote cache store and load data on demand.
To completely migrate data to the target cluster, so you can decommission the source cluster, you can synchronize data.
This operation reads data from the source cluster and writes it to the target cluster.
Data migrates to all nodes in the target cluster in parallel, with each node receiving a subset of the data.
You must perform the synchronization for each cache that you want to migrate to the target cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Set up a target cluster with the appropriate Infinispan version.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start synchronizing each cache that you want to migrate to the target cluster with the Infinispan Command Line Interface (CLI) or REST API.</p>
<div class="ulist">
<ul>
<li>
<p>CLI: Use the <code class="command">migrate cluster synchronize</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>migrate cluster synchronize -c myCache</code></pre>
</div>
</div>
</li>
<li>
<p>REST API: Use the <code>?action=sync-data</code> parameter with a POST request.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>POST /rest/v2/caches/myCache?action=sync-data</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the operation completes, Infinispan responds with the total number of
entries copied to the target cluster.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Disconnect each node in the target cluster from the source cluster.</p>
<div class="ulist">
<ul>
<li>
<p>CLI: Use the <code class="command">migrate cluster disconnect</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>migrate cluster disconnect -c myCache</code></pre>
</div>
</div>
</li>
<li>
<p>REST API: Invoke a DELETE request.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>DELETE /rest/v2/caches/myCache/rolling-upgrade/source-connection</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>After you synchronize all data from the source cluster, the rolling upgrade
process is complete.
You can now decommission the source cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="patching-servers"><a class="anchor" href="#patching-servers"></a>17. Patching Infinispan Server installations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install and manage patches for Infinispan Server installations.</p>
</div>
<div class="paragraph">
<p>You can apply patches to multiple Infinispan Server installations with different versions to upgrade to a desired target version.
However, patches do not take effect if Infinispan Server is running.
If you want to upgrade Infinispan clusters without downtime, create a new cluster with the target version and perform a rolling upgrade to that version instead of patching.</p>
</div>
<div class="sect2">
<h3 id="patches-patching-servers"><a class="anchor" href="#patches-patching-servers"></a>17.1. Infinispan Server patches</h3>
<div class="paragraph">
<p>Infinispan Server patches are <code>.zip</code> archives that contain artifacts that you can apply to your <code>$ISPN_HOME</code> directory to fix issues and add new features.</p>
</div>
<div class="paragraph">
<p>Patches also provide a set of rules for Infinispan Server to modify your installation.
When you apply patches, Infinispan overwrites some files and removes others, depending on if they are required for the target version.</p>
</div>
<div class="paragraph">
<p>However, Infinispan does not make any changes to configuration files that you have created or modified when applying a patch.
Server patches do not modify or replace any custom configuration or data.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-server-patches_patching-servers"><a class="anchor" href="#creating-server-patches_patching-servers"></a>17.2. Creating Infinispan Server patches</h3>
<div class="paragraph">
<p>You can create patches for Infinispan Server from an existing installation.</p>
</div>
<div class="paragraph">
<p>You can create patches for Infinispan Server starting from version 10.1.7.
You can patch any 10.1 or later server installation.
However you cannot patch 9.4.x or earlier servers with 10.1.7 or later.</p>
</div>
<div class="paragraph">
<p>You can also create patches that either upgrade or downgrade the Infinispan
Server version.
For example, you can create a patch from version 10.1.7 and use
it to upgrade version 10.1.5 or downgrade version 11.0.0.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for a Infinispan Server installation that has
the target version for the patch you want to create.</p>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>patch create</code> command to generate a patch archive and include the <code>-q</code> option with a meaningful qualifier to describe the patch.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch create -q "this is my test patch" path/to/mypatch.zip \
path/to/target/server/home path/to/source/server/home</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding command generates a <code>.zip</code> archive in the specified directory.
Paths are relative to <code>$ISPN_HOME</code> for the target server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Create single patches for multiple different Infinispan versions, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch create -q "this is my test patch" path/to/mypatch.zip \
path/to/target/server/home \
path/to/source/server1/home path/to/source/server2/home</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>server1</code> and <code>server2</code> are different Infinispan versions where you can
install "mypatch.zip".</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Describe the generated patch archive.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch describe path/to/mypatch.zip</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>Infinispan patch target=$target_version(my test patch)  source=$source_version created=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> is the Infinispan version from which the patch was created.</p>
</li>
<li>
<p><code>$source_version</code> is one or more Infinispan versions to which you can apply the patch.</p>
<div class="paragraph">
<p>You can apply patches to Infinispan Server installations that match the <code>$source_version</code> only.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="applying-server-patches_patching-servers"><a class="anchor" href="#applying-server-patches_patching-servers"></a>17.3. Applying patches to Infinispan Server installations</h3>
<div class="paragraph">
<p>Upgrade or downgrade Infinispan Server installation to a Infinispan version by installing patches.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a server patch for the target version.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for the Infinispan Server installation you want to patch.</p>
</li>
<li>
<p>Stop the Infinispan Server if it is running.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you patch a server while it is running, the version changes take effect
after restart. If you do not want to stop the server, create a new cluster with
the target version and perform a rolling upgrade to that version instead of
patching.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Install the patch.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[disconnected]&gt; patch install path/to/patch.zip

Infinispan patch target=$target_version source=$source_version \
created=$timestamp installed=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> displays the Infinispan version that the patch installed.</p>
</li>
<li>
<p><code>$source_version</code> displays the Infinispan version before you installed the patch.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Start the server to verify the patch is installed.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh
...
ISPN080001: Infinispan Server $version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the patch is installed successfully <code>$version</code> matches <code>$target_version</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--server</code> option to install patches in a different <code>$ISPN_HOME</code>
directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch install path/to/patch.zip --server=path/to/server/home</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="rolling-back-server-patches_patching-servers"><a class="anchor" href="#rolling-back-server-patches_patching-servers"></a>17.4. Rolling back patches</h3>
<div class="paragraph">
<p>Remove patches from Infinispan Server by rolling them back and restoring the previous Infinispan version.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a server has multiple patches installed, you can roll back the last installed patch only.</p>
</div>
<div class="paragraph">
<p>Rolling back patches does not revert configuration changes you make to
Infinispan Server.
Before you roll back patches, you should ensure that your configuration is compatible with the version to which you are rolling back.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for the Infinispan Server installation you want to roll back.</p>
</li>
<li>
<p>Stop the server if it is running.</p>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>List the installed patches.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch ls</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>Infinispan patch target=$target_version source=$source_version
created=$timestamp installed=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> is the Infinispan server version after the patch was applied.</p>
</li>
<li>
<p><code>$source_version</code> is the version for Infinispan server before the patch was applied. Rolling back the patch restores the server to this version.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Roll back the last installed patch.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch rollback</code></pre>
</div>
</div>
</li>
<li>
<p>Quit the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>quit</code></pre>
</div>
</div>
</li>
<li>
<p>Start the server to verify the patch is rolled back to the previous version.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin/server.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>ISPN080001: Infinispan Server $version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the patch is rolled back successfully <code>$version</code> matches <code>$source_version</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--server</code> option to rollback patches in a different <code>$ISPN_HOME</code>
directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>patch rollback --server=path/to/server/home</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tshoot_server"><a class="anchor" href="#tshoot_server"></a>18. Troubleshooting Infinispan Server deployments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gather diagnostic information about Infinispan Server deployments and perform
troubleshooting steps to resolve issues.</p>
</div>
<div class="sect2">
<h3 id="getting-server-reports_server"><a class="anchor" href="#getting-server-reports_server"></a>18.1. Getting diagnostic reports from Infinispan Server</h3>
<div class="paragraph">
<p>Infinispan Server provides aggregated reports in <code>tar.gz</code> archives that
contain diagnostic information about server instances and host systems.
The report provides details about CPU, memory, open files, network sockets and
routing, threads, in addition to configuration and log files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan Server.</p>
</li>
<li>
<p>Use the <code class="command">server report</code> command to download a <code>tar.gz</code> archive:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server report
Downloaded report 'infinispan-&lt;hostname&gt;-&lt;timestamp&gt;-report.tar.gz'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command responds with the name of the report, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>Downloaded report 'infinispan-&lt;hostname&gt;-&lt;timestamp&gt;-report.tar.gz'</code></pre>
</div>
</div>
</li>
<li>
<p>Move the <code>tar.gz</code> file to a suitable location on your filesystem.</p>
</li>
<li>
<p>Extract the <code>tar.gz</code> file with any archiving tool.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-logs-cli_server"><a class="anchor" href="#configuring-server-logs-cli_server"></a>18.2. Changing Infinispan Server logging configuration at runtime</h3>
<div class="paragraph">
<p>Modify the logging configuration for Infinispan Server at runtime to
temporarily adjust logging to troubleshoot issues and perform root cause
analysis.</p>
</div>
<div class="paragraph">
<p>Modifying the logging configuration through the CLI is a runtime-only
operation, which means that changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are not saved to the <code>log4j2.xml</code> file. Restarting server nodes or the entire cluster resets the logging configuration to the default properties in the <code>log4j2.xml</code> file.</p>
</li>
<li>
<p>Apply only to the nodes in the cluster when you invoke the CLI. Nodes that join the cluster after you change the logging configuration use the default properties.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan Server.</p>
</li>
<li>
<p>Use the <code class="command">logging</code> to make the required adjustments.</p>
<div class="ulist">
<ul>
<li>
<p>List all appenders defined on the server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>logging list-appenders</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command provides a JSON response such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "STDOUT" : {
    "name" : "STDOUT"
  },
  "JSON-FILE" : {
    "name" : "JSON-FILE"
  },
  "HR-ACCESS-FILE" : {
    "name" : "HR-ACCESS-FILE"
  },
  "FILE" : {
    "name" : "FILE"
  },
  "REST-ACCESS-FILE" : {
    "name" : "REST-ACCESS-FILE"
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>List all logger configurations defined on the server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>logging list-loggers</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command provides a JSON response such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">[ {
  "name" : "",
  "level" : "INFO",
  "appenders" : [ "STDOUT", "FILE" ]
}, {
  "name" : "org.infinispan.HOTROD_ACCESS_LOG",
  "level" : "INFO",
  "appenders" : [ "HR-ACCESS-FILE" ]
}, {
  "name" : "com.arjuna",
  "level" : "WARN",
  "appenders" : [ ]
}, {
  "name" : "org.infinispan.REST_ACCESS_LOG",
  "level" : "INFO",
  "appenders" : [ "REST-ACCESS-FILE" ]
} ]</code></pre>
</div>
</div>
</li>
<li>
<p>Add and modify logger configurations with the <code class="command">set</code> subcommand</p>
<div class="paragraph">
<p>For example, the following command sets the logging level for the
<code>org.infinispan</code> package to <code>DEBUG</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>logging set --level=DEBUG org.infinispan</code></pre>
</div>
</div>
</li>
<li>
<p>Remove existing logger configurations with the <code class="command">remove</code> subcommand.</p>
<div class="paragraph">
<p>For example, the following command removes the <code>org.infinispan</code> logger
configuration, which means the root configuration is used instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>logging remove org.infinispan</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="gathering-cli-statistics_server"><a class="anchor" href="#gathering-cli-statistics_server"></a>18.3. Gathering resource statistics from the CLI</h3>
<div class="paragraph">
<p>You can inspect server-collected statistics for some Infinispan Server resources with the <code class="command">stats</code> command.</p>
</div>
<div class="paragraph">
<p>Use the <code class="command">stats</code> command either from the context of a resource that provides statistics (containers, caches) or with a path to such a resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>stats</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "statistics_enabled" : true,
  "number_of_entries" : 0,
  "hit_ratio" : 0.0,
  "read_write_ratio" : 0.0,
  "time_since_start" : 0,
  "time_since_reset" : 49,
  "current_number_of_entries" : 0,
  "current_number_of_entries_in_memory" : 0,
  "off_heap_memory_used" : 0,
  "data_memory_used" : 0,
  "stores" : 0,
  "retrievals" : 0,
  "hits" : 0,
  "misses" : 0,
  "remove_hits" : 0,
  "remove_misses" : 0,
  "evictions" : 0,
  "average_read_time" : 0,
  "average_read_time_nanos" : 0,
  "average_write_time" : 0,
  "average_write_time_nanos" : 0,
  "average_remove_time" : 0,
  "average_remove_time_nanos" : 0,
  "required_minimum_number_of_nodes" : -1
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>stats /containers/default/caches/mycache</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "time_since_start" : -1,
  "time_since_reset" : -1,
  "current_number_of_entries" : -1,
  "current_number_of_entries_in_memory" : -1,
  "off_heap_memory_used" : -1,
  "data_memory_used" : -1,
  "stores" : -1,
  "retrievals" : -1,
  "hits" : -1,
  "misses" : -1,
  "remove_hits" : -1,
  "remove_misses" : -1,
  "evictions" : -1,
  "average_read_time" : -1,
  "average_read_time_nanos" : -1,
  "average_write_time" : -1,
  "average_write_time_nanos" : -1,
  "average_remove_time" : -1,
  "average_remove_time_nanos" : -1,
  "required_minimum_number_of_nodes" : -1
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-health-rest_server"><a class="anchor" href="#accessing-health-rest_server"></a>18.4. Accessing cluster health via REST</h3>
<div class="paragraph">
<p>Get Infinispan cluster health via the REST API.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke a <code>GET</code> request to retrieve cluster health.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>GET /rest/v2/container/health</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan responds with a <code>JSON</code> document such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
    "cluster_health":{
        "cluster_name":"ISPN",
        "health_status":"HEALTHY",
        "number_of_nodes":2,
        "node_names":[
            "NodeA-36229",
            "NodeB-28703"
        ]
    },
    "cache_health":[
        {
            "status":"HEALTHY",
            "cache_name":"___protobuf_metadata"
        },
        {
            "status":"HEALTHY",
            "cache_name":"cache2"
        },
        {
            "status":"HEALTHY",
            "cache_name":"mycache"
        },
        {
            "status":"HEALTHY",
            "cache_name":"cache1"
        }
    ]

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Get Cache Manager status as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>GET /rest/v2/container/health/status</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p>See the <em>REST v2 (version 2) API</em> documentation for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="accessing-health-jmx_server"><a class="anchor" href="#accessing-health-jmx_server"></a>18.5. Accessing cluster health via JMX</h3>
<div class="paragraph">
<p>Retrieve Infinispan cluster health statistics via JMX.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to Infinispan server using any JMX capable tool such as JConsole and navigate to the following object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>org.infinispan:type=CacheManager,name="default",component=CacheContainerHealth</code></pre>
</div>
</div>
</li>
<li>
<p>Select available MBeans to retrieve cluster health statistics.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-02-26 11:04:32 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>