<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Infinispan 13.0 Server Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Infinispan 13.0 Server Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#server-getting-started">1. Getting started with Infinispan Server</a>
<ul class="sectlevel2">
<li><a href="#server-requirements_server-getting-started">1.1. Infinispan Server requirements</a></li>
<li><a href="#downloading-server-distributions_server-getting-started">1.2. Downloading Infinispan Server distributions</a></li>
<li><a href="#installing-servers_server-getting-started">1.3. Installing Infinispan Server</a></li>
<li><a href="#starting-servers_server-getting-started">1.4. Starting Infinispan Server</a></li>
<li><a href="#creating-users_server-getting-started">1.5. Creating and modifying Infinispan users</a>
<ul class="sectlevel3">
<li><a href="#adding_credentials">1.5.1. Adding credentials</a></li>
<li><a href="#assigning_roles_to_users">1.5.2. Assigning roles to users</a></li>
<li><a href="#adding_users_to_groups">1.5.3. Adding users to groups</a></li>
<li><a href="#user-roles-permissions_server-getting-started">1.5.4. User roles and permissions</a></li>
</ul>
</li>
<li><a href="#verifying-cluster-views_server-getting-started">1.6. Verifying cluster views</a></li>
<li><a href="#shutting-down-servers_server-getting-started">1.7. Shutting down Infinispan Server</a>
<ul class="sectlevel3">
<li><a href="#cluster-restarts_server-getting-started">1.7.1. Infinispan cluster restarts</a></li>
</ul>
</li>
<li><a href="#server-directory-structure_server-getting-started">1.8. Infinispan Server installation directory structure</a>
<ul class="sectlevel3">
<li><a href="#server_root_directory">1.8.1. Server root directory</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#creating-remote-caches">2. Creating remote caches</a>
<ul class="sectlevel2">
<li><a href="#default-cache-manager-creating-remote-caches">2.1. Default cache manager</a></li>
<li><a href="#creating-caches-console_creating-remote-caches">2.2. Creating caches with Infinispan Console</a></li>
<li><a href="#creating-caches-cli_creating-remote-caches">2.3. Creating remote caches with the Infinispan CLI</a></li>
<li><a href="#creating-caches-hotrod_creating-remote-caches">2.4. Creating remote caches from Hot Rod clients</a></li>
<li><a href="#creating-caches-rest_creating-remote-caches">2.5. Creating remote caches with the REST API</a></li>
</ul>
</li>
<li><a href="#server-interfaces">3. Network interfaces and socket bindings</a>
<ul class="sectlevel2">
<li><a href="#network-interfaces_server-interfaces">3.1. Network interfaces</a></li>
<li><a href="#socket-bindings_server-interfaces">3.2. Socket bindings</a></li>
<li><a href="#changing-bind-address_server-interfaces">3.3. Changing the bind address for Infinispan Server</a>
<ul class="sectlevel3">
<li><a href="#listening-on-all-addresses_server-interfaces">3.3.1. Listening on all addresses</a></li>
</ul>
</li>
<li><a href="#server-ports-protocols_server-interfaces">3.4. Infinispan Server ports and protocols</a>
<ul class="sectlevel3">
<li><a href="#configuring-firewalls_server-interfaces">3.4.1. Configuring network firewalls for Infinispan traffic</a></li>
</ul>
</li>
<li><a href="#specifying-port-offsets_server-interfaces">3.5. Specifying port offsets</a></li>
</ul>
</li>
<li><a href="#server-endpoints">4. Server endpoints</a>
<ul class="sectlevel2">
<li><a href="#endpoints-hot-rod_server-endpoints">4.1. Hot Rod</a></li>
<li><a href="#endpoints-rest_server-endpoints">4.2. REST</a></li>
<li><a href="#endpoints-memcached_server-endpoints">4.3. Memcached</a></li>
<li><a href="#endpoint-protocol-comparison_server-endpoints">4.4. Comparison of endpoint protocols</a></li>
<li><a href="#endpoint-connectors_server-endpoints">4.5. Endpoint connectors</a></li>
<li><a href="#configuring-multiple-endpoints_server-endpoints">4.6. Configuring multiple endpoints</a></li>
<li><a href="#endpoint-ip-address-filters_server-endpoints">4.7. Infinispan Server endpoint IP address filters</a></li>
<li><a href="#user_tool-server-endpoints">4.8. Inspecting and modifying rules for filtering IP addresses</a></li>
</ul>
</li>
<li><a href="#security-realms">5. Security realms</a>
<ul class="sectlevel2">
<li><a href="#property-security-realms_security-realms">5.1. Property security realms</a></li>
<li><a href="#ldap-security-realms_security-realms">5.2. LDAP security realms</a>
<ul class="sectlevel3">
<li><a href="#ldap-realm-principal-rewriting_security-realms">5.2.1. LDAP realm principal re-writing</a></li>
</ul>
</li>
<li><a href="#token-security-realms_security-realms">5.3. Token security realms</a></li>
<li><a href="#trust-store-security-realms_security-realms">5.4. Trust store security realms</a></li>
<li><a href="#distributed-security-realms_security-realms">5.5. Distributed security realms</a></li>
</ul>
</li>
<li><a href="#endpoint-authentication">6. Configuring Endpoint Authentication Mechanisms</a>
<ul class="sectlevel2">
<li><a href="#server_endpoint_auth-server">6.1. Infinispan Server Authentication</a></li>
<li><a href="#configure_hotrod_authentication-server">6.2. Manually Configuring Hot Rod Authentication</a>
<ul class="sectlevel3">
<li><a href="#hot-rod-authentication_server">6.2.1. Hot Rod authentication</a></li>
<li><a href="#hot-rod-authentication-mechanisms_server">6.2.2. Hot Rod authentication mechanisms</a></li>
<li><a href="#sasl-quality-of-protection_server">6.2.3. SASL quality of protection (QoP)</a></li>
<li><a href="#sasl-policies-hot-rod-authentication_server">6.2.4. SASL policies for Hot Rod authentication</a></li>
</ul>
</li>
<li><a href="#configure_rest_endpoint_auth-server">6.3. Manually Configuring REST Authentication</a>
<ul class="sectlevel3">
<li><a href="#rest-authentication_server">6.3.1. REST authentication</a></li>
<li><a href="#rest-authentication-mechanisms_server">6.3.2. REST authentication mechanisms</a></li>
</ul>
</li>
<li><a href="#disabling-authentication_server">6.4. Disabling Authentication</a></li>
</ul>
</li>
<li><a href="#endpoint-encryption">7. Encrypting Infinispan Server Connections</a>
<ul class="sectlevel2">
<li><a href="#configuring-server-keystores_server">7.1. Configuring Infinispan Server Keystores</a>
<ul class="sectlevel3">
<li><a href="#generate_keystores-server">7.1.1. Automatically Generating Keystores</a></li>
<li><a href="#configuring-ssl-engine_server">7.1.2. Configuring TLS versions and cipher suites</a></li>
</ul>
</li>
<li><a href="#configuring-client-certificate-authentication_server">7.2. Configuring Client Certificate Authentication</a></li>
<li><a href="#configuring-client-certificate-authorization_server">7.3. Configuring Authorization with Client Certificates</a></li>
</ul>
</li>
<li><a href="#kerberos-identity">8. Configuring Kerberos Identities for Infinispan Server</a>
<ul class="sectlevel2">
<li><a href="#kerberos_identity-kerberos-identity">8.1. Setting Up Kerberos Identities</a></li>
<li><a href="#kerberos_identity_config-kerberos-identity">8.2. Kerberos Identity Configuration</a></li>
</ul>
</li>
<li><a href="#server_credentials">9. Storing Infinispan Server Credentials in Keystores</a>
<ul class="sectlevel2">
<li><a href="#ssl_identity-credential-keystore">9.1. Setting Up Credential Keystores</a></li>
<li><a href="#server_credentials-credential-keystore">9.2. Credential Keystore Configuration</a></li>
</ul>
</li>
<li><a href="#authorization">10. Configuring User Authorization</a>
<ul class="sectlevel2">
<li><a href="#enabling-authz-authz">10.1. Enabling Authorization in Cache Configuration</a></li>
<li><a href="#user-roles-permissions_authz">10.2. User roles and permissions</a></li>
<li><a href="#con_authz-authz">10.3. How Security Authorization Works</a>
<ul class="sectlevel3">
<li><a href="#user-permissions_authz">10.3.1. Permissions</a>
<ul class="sectlevel4">
<li><a href="#cache_manager_permissions">Cache Manager permissions</a></li>
<li><a href="#cache_permissions">Cache permissions</a></li>
</ul>
</li>
<li><a href="#role-mappers_authz">10.3.2. Role Mappers</a>
<ul class="sectlevel4">
<li><a href="#cluster_role_mappers">Cluster role mappers</a></li>
<li><a href="#identity_role_mappers">Identity role mappers</a></li>
<li><a href="#commonname_role_mappers">CommonName role mappers</a></li>
<li><a href="#custom_role_mappers">Custom role mappers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#acl-cache_authz">10.4. Access Control List (ACL) Cache</a></li>
<li><a href="#customizing-authorization_authz">10.5. Customizing Roles and Permissions</a></li>
<li><a href="#disabling-authorization_authz">10.6. Disabling Security Authorization</a></li>
<li><a href="#configuring-client-certificate-authorization_authz">10.7. Configuring Authorization with Client Certificates</a></li>
</ul>
</li>
<li><a href="#cluster-transport">11. Setting up Infinispan cluster transport</a>
<ul class="sectlevel2">
<li><a href="#default-jgroups-stacks_cluster-transport">11.1. Default JGroups stacks</a></li>
<li><a href="#cluster-discovery-protocols_cluster-transport">11.2. Cluster discovery protocols</a>
<ul class="sectlevel3">
<li><a href="#discovery-ping_cluster-transport">11.2.1. PING</a></li>
<li><a href="#discovery-tcpping_cluster-transport">11.2.2. TCPPING</a></li>
<li><a href="#discovery-mping_cluster-transport">11.2.3. MPING</a></li>
<li><a href="#discovery-tcp-gossip_cluster-transport">11.2.4. TCPGOSSIP</a></li>
<li><a href="#discovery-jdbcping_cluster-transport">11.2.5. JDBC_PING</a></li>
<li><a href="#discovery-dns-ping_cluster-transport">11.2.6. DNS_PING</a></li>
<li><a href="#jgroups-cloud-discovery-protocols_cluster-transport">11.2.7. Cloud discovery protocols</a></li>
</ul>
</li>
<li><a href="#using-jgroups-default-stacks_cluster-transport">11.3. Using the default JGroups stacks</a></li>
<li><a href="#customizing-jgroups-stacks_cluster-transport">11.4. Customizing JGroups stacks</a>
<ul class="sectlevel3">
<li><a href="#jgroups-inheritance-attributes_cluster-transport">11.4.1. Inheritance attributes</a></li>
</ul>
</li>
<li><a href="#using-jgroups-system-properties_cluster-transport">11.5. Using JGroups system properties</a>
<ul class="sectlevel3">
<li><a href="#jgroups-system-properties_cluster-transport">11.5.1. Cluster transport properties</a></li>
<li><a href="#jgroups-extras-properties_cluster-transport">11.5.2. System properties for cloud discovery protocols</a>
<ul class="sectlevel4">
<li><a href="#amazon_ec2">Amazon EC2</a></li>
<li><a href="#google_cloud_platform">Google Cloud Platform</a></li>
<li><a href="#azure">Azure</a></li>
<li><a href="#kubernetes">Kubernetes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-inline-jgroups-stacks_cluster-transport">11.6. Using inline JGroups stacks</a></li>
<li><a href="#using-external-jgroups-stacks_cluster-transport">11.7. Using external JGroups stacks</a></li>
<li><a href="#secure-cluster-transport">11.8. Encrypting cluster transport</a>
<ul class="sectlevel3">
<li><a href="#securing-cluster-transport-tls-identities_secure-cluster-transport">11.8.1. Securing cluster transport with TLS identities</a></li>
<li><a href="#jgroups-encryption-protocols_secure-cluster-transport">11.8.2. JGroups encryption protocols</a></li>
<li><a href="#configuring-jgroups-asym-encrypt_secure-cluster-transport">11.8.3. Securing cluster transport with asymmetric encryption</a></li>
<li><a href="#configuring-jgroups-sym-encrypt_secure-cluster-transport">11.8.4. Securing cluster transport with symmetric encryption</a></li>
</ul>
</li>
<li><a href="#jgroups-ports_cluster-transport">11.9. TCP and UDP ports for cluster traffic</a></li>
</ul>
</li>
<li><a href="#datasources">12. Configuring Infinispan Server with managed datasources</a>
<ul class="sectlevel2">
<li><a href="#configuring-server-datasources_server">12.1. Configuring Infinispan Server with managed datasources</a></li>
<li><a href="#server-datasources_server">12.2. Managed datasources for JDBC connections</a></li>
</ul>
</li>
<li><a href="#remote_server_execution">13. Remotely Executing Server-Side Tasks</a>
<ul class="sectlevel2">
<li><a href="#server_tasks">13.1. Creating Server Tasks</a>
<ul class="sectlevel3">
<li><a href="#tasks">13.1.1. Server Tasks</a></li>
<li><a href="#server-tasks_server">13.1.2. Deploying Server Tasks to Infinispan Servers</a></li>
</ul>
</li>
<li><a href="#server-scripts">13.2. Creating Server Scripts</a>
<ul class="sectlevel3">
<li><a href="#scripts">13.2.1. Server Scripts</a>
<ul class="sectlevel4">
<li><a href="#server_script_metdata">Script Metadata</a></li>
<li><a href="#server_script_bindings">Script Bindings</a></li>
<li><a href="#server_script_parameters">Script Parameters</a></li>
</ul>
</li>
<li><a href="#adding-scripts_server">13.2.2. Adding Scripts to Infinispan Servers</a></li>
<li><a href="#add_script_hotrod">13.2.3. Programmatically Creating Scripts</a></li>
</ul>
</li>
<li><a href="#running_tasks_scripts">13.3. Running Server-Side Tasks and Scripts</a>
<ul class="sectlevel3">
<li><a href="#running_scripts_cli">13.3.1. Running Tasks and Scripts</a></li>
<li><a href="#running_scripts_hotrod">13.3.2. Programmatically Running Scripts</a></li>
<li><a href="#running_tasks_hotrod">13.3.3. Programmatically Running Tasks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#logs">14. Enabling and Customizing Logging</a>
<ul class="sectlevel2">
<li><a href="#server-logs_logging">14.1. Server Logs</a>
<ul class="sectlevel3">
<li><a href="#configuring_log_properties-logging">14.1.1. Configuring Server Logs</a></li>
<li><a href="#log_levels-logging">14.1.2. Log Levels</a></li>
<li><a href="#log_categories-logging">14.1.3. Infinispan Log Categories</a></li>
<li><a href="#log_appenders-logging">14.1.4. Log Appenders</a></li>
<li><a href="#log_pattern_formatters-logging">14.1.5. Log Patterns</a></li>
<li><a href="#enabling_json_logging-logging">14.1.6. Enabling and Configuring the JSON Log Handler</a></li>
</ul>
</li>
<li><a href="#access-logs_logging">14.2. Access Logs</a>
<ul class="sectlevel3">
<li><a href="#enabling-access-logs_logging">14.2.1. Enabling Access Logs</a></li>
<li><a href="#access_log_properties-logging">14.2.2. Access Log Properties</a></li>
</ul>
</li>
<li><a href="#audit-logs_logging">14.3. Audit Logs</a>
<ul class="sectlevel3">
<li><a href="#enabling-audit-logs-logging">14.3.1. Enabling Audit Logging</a></li>
<li><a href="#configuring-audit-logs_logging">14.3.2. Configuring Audit Logging Appenders</a></li>
<li><a href="#customizing-audit-logs_logging">14.3.3. Using Custom Audit Logging Implementations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#statistics-jmx">15. Enabling and configuring Infinispan statistics and JMX monitoring</a>
<ul class="sectlevel2">
<li><a href="#enabling-statistics-remote_statistics-jmx">15.1. Enabling statistics in remote caches</a></li>
<li><a href="#enabling-hotrod-client-statistics_statistics-jmx">15.2. Enabling Hot Rod client statistics</a></li>
<li><a href="#configuring-metrics_statistics-jmx">15.3. Configuring Infinispan metrics</a></li>
<li><a href="#enabling-jmx_statistics-jmx">15.4. Registering JMX MBeans</a>
<ul class="sectlevel3">
<li><a href="#enabling-jmx-port_statistics-jmx">15.4.1. Enabling JMX remote ports</a></li>
<li><a href="#jmx-mbeans_statistics-jmx">15.4.2. Infinispan MBeans</a></li>
<li><a href="#registering-jmx-mbean-servers-statistics-jmx">15.4.3. Registering MBeans in custom MBean servers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server-health">16. Retrieving Health Statistics</a>
<ul class="sectlevel2">
<li><a href="#accessing_the_health_api_via_jmx">16.1. Accessing the Health API via JMX</a></li>
<li><a href="#accessing_the_health_api_via_rest">16.2. Accessing the Health API via REST</a></li>
</ul>
</li>
<li><a href="#rolling-upgrades">17. Performing rolling upgrades for Infinispan Server clusters</a>
<ul class="sectlevel2">
<li><a href="#setting-up-target-clusters_rolling-upgrades">17.1. Setting up target Infinispan clusters</a></li>
<li><a href="#synchronizing-data-target-clusters_rolling-upgrades">17.2. Synchronizing data to target clusters</a></li>
</ul>
</li>
<li><a href="#patching">18. Patching Infinispan Server Installations</a>
<ul class="sectlevel2">
<li><a href="#patches-server">18.1. Infinispan Server Patches</a></li>
<li><a href="#patching_create-server">18.2. Creating Server Patches</a></li>
<li><a href="#patching_install-server">18.3. Installing Server Patches</a></li>
<li><a href="#patching_rollback-server">18.4. Rolling Back Server Patches</a></li>
</ul>
</li>
<li><a href="#tshoot_server">19. Troubleshooting Infinispan Servers</a>
<ul class="sectlevel2">
<li><a href="#server_reports-server">19.1. Getting Diagnostic Reports for Infinispan Servers</a></li>
<li><a href="#configuring_server_logs_cli-server">19.2. Changing Infinispan Server Logging Configuration at Runtime</a></li>
<li><a href="#resource_statistics">19.3. Resource Statistics</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server deployments offer distributed remote caches with elastic scalability and high performance access.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-getting-started"><a class="anchor" href="#server-getting-started"></a>1. Getting started with Infinispan Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quickly set up Infinispan Server and learn the basics.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://infinispan.org/assets/images/documentation/icon-get-started.png" alt="Get started icon" height="32"></span>
You can also visit our <a href="https://infinispan.org/get-started/">Get Started with Infinispan</a> tutorial and run the server image in 4 easy steps.</p>
</div>
<div class="sect2">
<h3 id="server-requirements_server-getting-started"><a class="anchor" href="#server-requirements_server-getting-started"></a>1.1. Infinispan Server requirements</h3>
<div class="paragraph">
<p>Infinispan Server requires a Java Virtual Machine and works with Java 11 and later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan Server does not support Java 8. However, you can use Java 8 with
Hot Rod Java clients.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="downloading-server-distributions_server-getting-started"><a class="anchor" href="#downloading-server-distributions_server-getting-started"></a>1.2. Downloading Infinispan Server distributions</h3>
<div class="paragraph">
<p>The Infinispan Server distribution is an archive of Java libraries (<code>JAR</code> files) and configuration files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download Infinispan 13.0 Server from <a href="https://infinispan.org/download/">Infinispan downloads</a>.</p>
</li>
<li>
<p>Run the <code>sha1sum</code> command with the server download archive as the argument, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ sha1sum infinispan-server-${version}.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Compare with the <code>SHA-1</code> checksum value on the Infinispan downloads page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p>The Infinispan Server README, available in the distribution, provides example commands for running the server, describes folders in the <code>$ISPN_HOME</code> directory, and lists system properties you can use to customize the filesystem.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-servers_server-getting-started"><a class="anchor" href="#installing-servers_server-getting-started"></a>1.3. Installing Infinispan Server</h3>
<div class="paragraph">
<p>Install the Infinispan Server distribution on a host system.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Download a Infinispan Server distribution archive.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use any appropriate tool to extract the Infinispan Server archive to the host filesystem.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ unzip infinispan-server-13.0.4.Final.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting directory is your <code>$ISPN_HOME</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-servers_server-getting-started"><a class="anchor" href="#starting-servers_server-getting-started"></a>1.4. Starting Infinispan Server</h3>
<div class="paragraph">
<p>Run Infinispan Server instances in a Java Virtual Machine (JVM).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Download and install the server distribution.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Start Infinispan Server instances with the <code>server</code> script.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>bin\server.bat</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Infinispan Server is running successfully when it logs the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>ISPN080004: Protocol SINGLE_PORT listening on 127.0.0.1:11222
ISPN080034: Server '...' listening on http://127.0.0.1:11222
ISPN080001: Infinispan Server &lt;version&gt; started in &lt;mm&gt;ms</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Open <a href="http://127.0.0.1:11222/console/"><code>127.0.0.1:11222/console/</code></a> in any browser.</p>
</li>
<li>
<p>Enter your credentials at the prompt and continue to Infinispan Console.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-users_server-getting-started"><a class="anchor" href="#creating-users_server-getting-started"></a>1.5. Creating and modifying Infinispan users</h3>
<div class="paragraph">
<p>Add Infinispan user credentials and assign permissions to control access to data.</p>
</div>
<div class="paragraph">
<p>Infinispan server installations use a property realm to authenticate users for the Hot Rod and REST endpoints.
This means you need to create at least one user before you can access Infinispan.</p>
</div>
<div class="paragraph">
<p>By default, users also need roles with permissions to access caches and interact with Infinispan resources.
You can assign roles to users individually or add users to groups that have role permissions.</p>
</div>
<div class="paragraph">
<p>You create users and assign roles with the <code class="command">user</code> command in the Infinispan command line interface (CLI).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code class="command">help user</code> from a CLI session to get complete command details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="adding_credentials"><a class="anchor" href="#adding_credentials"></a>1.5.1. Adding credentials</h4>
<div class="paragraph">
<p>You need an <code>admin</code> user for the Infinispan Console and full control over your Infinispan environment.
For this reason you should create a user with <code>admin</code> permissions the first time you add credentials.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Create an <code>admin</code> user with the <code class="command">user create</code> command.</p>
<div class="ulist">
<ul>
<li>
<p>Add a user assigned to the <code>admin</code> group.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">$ bin/cli.sh user create myuser -p changeme -g admin</code></pre>
</div>
</div>
</li>
<li>
<p>Use implicit authorization to gain <code>admin</code> permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">$ bin/cli.sh user create admin -p changeme</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Open <code>user.properties</code> and <code>groups.properties</code> with any text editor to verify users and groups.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ cat server/conf/users.properties

#$REALM_NAME=default$
#$ALGORITHM=encrypted$
myuser=scram-sha-1\:BYGcIAwvf6b...

$ cat server/conf/groups.properties

myuser=admin</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="assigning_roles_to_users"><a class="anchor" href="#assigning_roles_to_users"></a>1.5.2. Assigning roles to users</h4>
<div class="paragraph">
<p>Assign roles to users so they have the correct permissions to access data and modify Infinispan resources.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start a CLI session with an <code>admin</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">$ bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>deployer</code> role to "katie".</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user roles grant --roles=deployer katie</code></pre>
</div>
</div>
</li>
<li>
<p>List roles for "katie".</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user roles ls katie
[&quot;deployer&quot;]</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="adding_users_to_groups"><a class="anchor" href="#adding_users_to_groups"></a>1.5.3. Adding users to groups</h4>
<div class="paragraph">
<p>Groups let you change permissions for multiple users.
You assign a role to a group and then add users to that group.
Users inherit permissions from the group role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start a CLI session with an <code>admin</code> user.</p>
</li>
<li>
<p>Use the <code class="command">user create</code> command to create a group.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify "developers" as the group name with the <code>--groups</code> argument.</p>
</li>
<li>
<p>Set a username and password for the group.</p>
<div class="paragraph">
<p>In a property realm, a group is a special type of user that also requires a username and password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user create --groups=developers developers -p changeme</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>List groups.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user ls --groups
[&quot;developers&quot;]</code></pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>application</code> role to the "developers" group.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user roles grant --roles=application developers</code></pre>
</div>
</div>
</li>
<li>
<p>List roles for the "developers" group.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user roles ls developers
[&quot;application&quot;]</code></pre>
</div>
</div>
</li>
<li>
<p>Add existing users, one at a time, to the group as required.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; user groups john --groups=developers</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="user-roles-permissions_server-getting-started"><a class="anchor" href="#user-roles-permissions_server-getting-started"></a>1.5.4. User roles and permissions</h4>
<div class="paragraph">
<p>Infinispan includes a default set of roles that grant users with permissions to access data and interact with Infinispan resources.</p>
</div>
<div class="paragraph">
<p><code>ClusterRoleMapper</code> is the default mechanism that Infinispan uses to associate security principals to authorization roles.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>ClusterRoleMapper</code> matches principal names to role names.
A user named <code>admin</code> gets <code>admin</code> permissions automatically, a user named <code>deployer</code> gets <code>deployer</code> permissions, and so on.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superuser with all permissions including control of the Cache Manager lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR, CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and delete Infinispan resources in addition to <code>application</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read and write access to Infinispan resources in addition to <code>observer</code> permissions. Can also listen to events and execute server tasks and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>observer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read access to Infinispan resources in addition to <code>monitor</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view statistics via JMX and the <code>metrics</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs">org.infinispan.security.AuthorizationPermission Enumeration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying-cluster-views_server-getting-started"><a class="anchor" href="#verifying-cluster-views_server-getting-started"></a>1.6. Verifying cluster views</h3>
<div class="paragraph">
<p>Infinispan Server instances on the same network automatically discover each other and form clusters.</p>
</div>
<div class="paragraph">
<p>Complete this procedure to observe cluster discovery with the <code>MPING</code> protocol in the default <code>TCP</code> stack with locally running Infinispan Server instances.
If you want to adjust cluster transport for custom network requirements, see the documentation for setting up Infinispan clusters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is intended to demonstrate the principle of cluster discovery and is not intended for production environments.
Doing things like specifying a port offset on the command line is not a reliable way to configure cluster transport for production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Have one instance of Infinispan Server running.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Copy the root directory to <code>server2</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ cp -r server server2</code></pre>
</div>
</div>
</li>
<li>
<p>Specify a port offset and the <code>server2</code> directory.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh -o 100 -s server2</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can view cluster membership in the console at <a href="http://127.0.0.1:11222/console/cluster-membership"><code>127.0.0.1:11222/console/cluster-membership</code></a>.</p>
</div>
<div class="paragraph">
<p>Infinispan also logs the following messages when nodes join clusters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN000094: Received new cluster view for channel cluster:
[&lt;server_hostname&gt;|3] (2) [&lt;server_hostname&gt;, &lt;server2_hostname&gt;]

INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN100000: Node &lt;server2_hostname&gt; joined the cluster</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shutting-down-servers_server-getting-started"><a class="anchor" href="#shutting-down-servers_server-getting-started"></a>1.7. Shutting down Infinispan Server</h3>
<div class="paragraph">
<p>Stop individually running servers or bring down clusters gracefully.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Shut down Infinispan Server in one of the following ways:</p>
<div class="ulist">
<ul>
<li>
<p>Stop all nodes in a cluster with the <code class="command">shutdown cluster</code> command, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; shutdown cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command saves cluster state to the <code>data</code> folder for each node in the cluster.
If you use a cache store, the <code class="command">shutdown cluster</code> command also persists all data in the cache.</p>
</div>
</li>
<li>
<p>Stop individual server instances with the <code class="command">shutdown server</code> command and the server hostname, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; shutdown server &lt;my_server01&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code class="command">shutdown server</code> command does not wait for rebalancing operations to complete, which can lead to data loss if you specify multiple hostnames at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run <code class="command">help shutdown</code> for more details about using the command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan logs the following messages when you shut down servers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>ISPN080002: Infinispan Server stopping
ISPN000080: Disconnecting JGroups channel cluster
ISPN000390: Persisted state, version=&lt;$version&gt; timestamp=YYYY-MM-DDTHH:MM:SS
ISPN080003: Infinispan Server stopped</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="cluster-restarts_server-getting-started"><a class="anchor" href="#cluster-restarts_server-getting-started"></a>1.7.1. Infinispan cluster restarts</h4>
<div class="paragraph">
<p>When you bring Infinispan clusters back online after shutting them down, you should wait for the cluster to be available before adding or removing nodes or modifying cluster state.</p>
</div>
<div class="paragraph">
<p>If you shutdown clustered nodes with the <code class="command">shutdown server</code> command, you must restart each server in reverse order.<br>
For example, if you shutdown <code>server1</code> and then shutdown <code>server2</code>, you should first start <code>server2</code> and then start <code>server1</code>.</p>
</div>
<div class="paragraph">
<p>If you shutdown a cluster with the <code class="command">shutdown cluster</code> command, clusters become fully operational only after all nodes rejoin.<br>
You can restart nodes in any order but the cluster remains in DEGRADED state until all nodes that were joined before shutdown are running.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-directory-structure_server-getting-started"><a class="anchor" href="#server-directory-structure_server-getting-started"></a>1.8. Infinispan Server installation directory structure</h3>
<div class="paragraph">
<p>Infinispan Server uses the following folders on the host filesystem under <code>$ISPN_HOME</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>├── bin
├── boot
├── docs
├── lib
├── server
└── static</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See the Infinispan Server README, available in the distribution, for descriptions of the each folder in your <code>$ISPN_HOME</code> directory as well as system properties you can use to customize the filesystem.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="server_root_directory"><a class="anchor" href="#server_root_directory"></a>1.8.1. Server root directory</h4>
<div class="paragraph">
<p>Apart from resources in the <code>bin</code> and <code>docs</code> folders, the only folder under <code>$ISPN_HOME</code> that you should interact with is the server root directory, which is named <code>server</code> by default.</p>
</div>
<div class="paragraph">
<p>You can create multiple nodes under the same <code>$ISPN_HOME</code> directory or in different directories, but each Infinispan Server instance must have its own server root directory.
For example, a cluster of 5 nodes could have the following server root directories on the filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>├── server
├── server1
├── server2
├── server3
└── server4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each server root directory should contain the following folders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>├── server
│   ├── conf
│   ├── data
│   ├── lib
│   └── log</code></pre>
</div>
</div>
<h4 id="serverconf" class="discrete"><code>server/conf</code></h4>
<div class="paragraph">
<p>Holds <code>infinispan.xml</code> configuration files for a Infinispan Server instance.</p>
</div>
<div class="paragraph">
<p>Infinispan separates configuration into two layers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dynamic</dt>
<dd>
<p>Create mutable cache configurations for data scalability.<br>
Infinispan Server permanently saves the caches you create at runtime along with the cluster state that is distributed across nodes.
Each joining node receives a complete cluster state that Infinispan Server synchronizes across all nodes whenever changes occur.</p>
</dd>
<dt class="hdlist1">Static</dt>
<dd>
<p>Add configuration to <code>infinispan.xml</code> for underlying server mechanisms such as cluster transport, security, and shared datasources.</p>
</dd>
</dl>
</div>
<h4 id="serverdata" class="discrete"><code>server/data</code></h4>
<div class="paragraph">
<p>Provides internal storage that Infinispan Server uses to maintain cluster state.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Never directly delete or modify content in <code>server/data</code>.</p>
</div>
<div class="paragraph">
<p>Modifying files such as <code>caches.xml</code> while the server is running can cause corruption.
Deleting content can result in an incorrect state, which means clusters cannot restart after shutdown.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="serverlib" class="discrete"><code>server/lib</code></h4>
<div class="paragraph">
<p>Contains extension <code>JAR</code> files for custom filters, custom event listeners, JDBC drivers, custom <code>ServerTask</code> implementations, and so on.</p>
</div>
<h4 id="serverlog" class="discrete"><code>server/log</code></h4>
<div class="paragraph">
<p>Holds Infinispan Server log files.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-remote-caches"><a class="anchor" href="#creating-remote-caches"></a>2. Creating remote caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you create remote caches at runtime, Infinispan Server synchronizes your configuration across the cluster so that all nodes have a copy.
For this reason you should always create remote caches dynamically with the following mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infinispan Console</p>
</li>
<li>
<p>Infinispan Command Line Interface (CLI)</p>
</li>
<li>
<p>Hot Rod or HTTP clients</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="default-cache-manager-creating-remote-caches"><a class="anchor" href="#default-cache-manager-creating-remote-caches"></a>2.1. Default cache manager</h3>
<div class="paragraph">
<p>Infinispan Server provides a default cache manager to control the lifecycle of remote caches.
Starting Infinispan Server automatically instantiates the cache manager so you can create and delete remote caches and other resources like Protobuf schema.</p>
</div>
<div class="listingblock">
<div class="title">Default cache manager</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="comment">&lt;!-- Creates a cache manager named &quot;default&quot; that exports metrics. --&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Adds cluster transport that uses the default JGroups TCP stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name:cluster}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.stack:tcp}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After you start Infinispan Server and add user credentials, you can view details about the cache manager and get cluster information from Infinispan Console.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open <code>127.0.0.1:11222</code> in any browser.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also get information about the cache manager through the Command Line Interface (CLI) or REST API:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CLI</dt>
<dd>
<p>Run the <code class="command">describe</code> command in the default container.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">[//containers/default]&gt; describe</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">REST</dt>
<dd>
<p>Open <code>127.0.0.1:11222/rest/v2/cache-managers/default/</code> in any browser.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-console_creating-remote-caches"><a class="anchor" href="#creating-caches-console_creating-remote-caches"></a>2.2. Creating caches with Infinispan Console</h3>
<div class="paragraph">
<p>Use Infinispan Console to create remote caches in an intuitive visual interface from any web browser.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>127.0.0.1:11222/console/</code> in any browser.</p>
</li>
<li>
<p>Select <strong>Create Cache</strong> and follow the steps as Infinispan Console guides you through the process.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-cli_creating-remote-caches"><a class="anchor" href="#creating-caches-cli_creating-remote-caches"></a>2.3. Creating remote caches with the Infinispan CLI</h3>
<div class="paragraph">
<p>Use the Infinispan Command Line Interface (CLI) to add remote caches on Infinispan Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start the CLI and enter your credentials when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code class="command">create cache</code> command to create remote caches.</p>
<div class="paragraph">
<p>For example, create a cache named "mycache" from a file named <code>mycache.xml</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; create cache --file=mycache.xml mycache</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>List all remote caches with the <code class="command">ls</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; ls caches
mycache</code></pre>
</div>
</div>
</li>
<li>
<p>View cache configuration with the <code class="command">describe</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; describe caches/mycache</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-hotrod_creating-remote-caches"><a class="anchor" href="#creating-caches-hotrod_creating-remote-caches"></a>2.4. Creating remote caches from Hot Rod clients</h3>
<div class="paragraph">
<p>Use the Infinispan Hot Rod API to create remote caches on Infinispan Server from Java, C++, .NET/C#, JS clients and more.</p>
</div>
<div class="paragraph">
<p>This procedure shows you how to use Hot Rod Java clients that create remote caches on first access.
You can find code examples for other Hot Rod clients in the <a href="https://infinispan.org/tutorials/simple/simple_tutorials.html">Infinispan Tutorials</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke the <code>remoteCache()</code> method as part of your the <code>ConfigurationBuilder</code>.</p>
</li>
<li>
<p>Set the <code>configuration</code> or <code>configuration_uri</code> properties in the <code>hotrod-client.properties</code> file on your classpath.</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">File</span> file = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/infinispan.xml</span><span class="delimiter">&quot;</span></span>)
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">another-cache</span><span class="delimiter">&quot;</span></span>)
       .configuration(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;distributed-cache name=</span><span class="char">\&quot;</span><span class="content">another-cache</span><span class="char">\&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span>);
builder.remoteCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.other.cache</span><span class="delimiter">&quot;</span></span>)
       .configurationURI(file.toURI());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code>infinispan.client.hotrod.cache.another-cache.configuration=&lt;distributed-cache name=\&quot;another-cache\&quot;/&gt;
infinispan.client.hotrod.cache.[my.other.cache].configuration_uri=file:///path/to/infinispan.xml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the name of your remote cache contains the <code>.</code> character, you must enclose it in square brackets when using <code>hotrod-client.properties</code> files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html">Hot Rod Client Configuration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/RemoteCacheConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.RemoteCacheConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-caches-rest_creating-remote-caches"><a class="anchor" href="#creating-caches-rest_creating-remote-caches"></a>2.5. Creating remote caches with the REST API</h3>
<div class="paragraph">
<p>Use the Infinispan REST API to create remote caches on Infinispan Server from any suitable HTTP client.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a Infinispan user with <code>admin</code> permissions.</p>
</li>
<li>
<p>Start at least one Infinispan Server instance.</p>
</li>
<li>
<p>Have a Infinispan cache configuration.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke <code>POST</code> requests to <code>/rest/v2/caches/&lt;cache_name&gt;</code> with cache configuration in the payload.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../rest/rest.html#rest_v2_cache_operations">Creating and Managing Caches with the REST API</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-interfaces"><a class="anchor" href="#server-interfaces"></a>3. Network interfaces and socket bindings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Expose Infinispan Server through a network interface by binding it to an IP address.
You can then configure endpoints to use the interface so Infinispan Server can handle requests from remote client applications.</p>
</div>
<div class="sect2">
<h3 id="network-interfaces_server-interfaces"><a class="anchor" href="#network-interfaces_server-interfaces"></a>3.1. Network interfaces</h3>
<div class="paragraph">
<p>Infinispan Server multiplexes endpoints to a single TCP/IP port and automatically detects protocols of inbound client requests.
You can configure how Infinispan Server binds to network interfaces to listen for client requests.</p>
</div>
<div class="listingblock primary">
<div class="title">Internet Protocol (IP) address</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects a specific IPv4 address, which can be public, private, or loopback.
     This is the default network interface for Infinispan Server. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;inet-address</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.bind.address:127.0.0.1}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Loopback address</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects an IP address in an IPv4 or IPv6 loopback address block. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;loopback</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Non-loopback address</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects an IP address in an IPv4 or IPv6 non-loopback address block. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;non-loopback</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Any address</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Uses the `INADDR_ANY` wildcard address which means Infinispan Server
     listens for inbound client requests on all interfaces. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;any-address</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Link local</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects a link-local IP address in an IPv4 or IPv6 address block. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;link-local</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Site local</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects a site-local (private) IP address in an IPv4 or IPv6 address block. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;site-local</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<h4 id="match_and_fallback_strategies" class="discrete">Match and fallback strategies</h4>
<div class="paragraph">
<p>Infinispan Server can enumerate all network interfaces on the host system and bind to an interface, host, or IP address that matches a value, which can include regular expressions for additional flexibility.</p>
</div>
<div class="listingblock primary">
<div class="title">Match host</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects an IP address that is assigned to a matching host name. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;match-host</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my_host_name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Match interface</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!--Selects an IP address assigned to a matching network interface. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;match-interface</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eth0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Match address</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Selects an IP address that matches a regular expression. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;match-address</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">132\..*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Fallback</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Includes multiple strategies that Infinispan Server tries in the
     declared order until it finds a match. --&gt;</span>
<span class="tag">&lt;interfaces&gt;</span>
  <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;match-host</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my_host_name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;match-address</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">132\..*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;any-address</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/interface&gt;</span>
<span class="tag">&lt;/interfaces&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="socket-bindings_server-interfaces"><a class="anchor" href="#socket-bindings_server-interfaces"></a>3.2. Socket bindings</h3>
<div class="paragraph">
<p>Socket bindings map endpoint connectors to server interfaces and ports.</p>
</div>
<div class="listingblock">
<div class="title">Default socket bindings</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;socket-bindings</span> <span class="attribute-name">default-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">port-offset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.socket.binding.port-offset:0}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;socket-binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.bind.port:11222}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;socket-binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcached</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11221</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/socket-bindings&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Socket binding configuration attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>socket-bindings</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the default interface and port offset.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds to Hot Rod and REST connectors to the default port <code>11222</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memcached</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds the memcached connector to port <code>11221</code> and is disabled by default.</p></td>
</tr>
</tbody>
</table>
<h4 id="custom_socket_binding_declarations" class="discrete">Custom socket binding declarations</h4>
<div class="paragraph">
<p>The following example configuration adds an <code>interface</code> declaration named "private" and a <code>socket-binding</code> declaration that binds Infinispan Server to the private IP address:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;server</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;interfaces&gt;</span>
    <span class="tag">&lt;interface</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">private</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inet-address</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10.1.2.3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/interface&gt;</span>
  <span class="tag">&lt;/interfaces&gt;</span>

  <span class="tag">&lt;socket-bindings</span> <span class="attribute-name">default-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port-offset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.socket.binding.port-offset:0}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;socket-binding</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">private_binding</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">private</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1234</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/socket-bindings&gt;</span>
<span class="tag">&lt;/server&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changing-bind-address_server-interfaces"><a class="anchor" href="#changing-bind-address_server-interfaces"></a>3.3. Changing the bind address for Infinispan Server</h3>
<div class="paragraph">
<p>Infinispan Server binds to a network IP address to listen for inbound client connections on the Hot Rod and REST endpoints.
You can specify that IP address directly in your Infinispan Server configuration or when starting server instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have at least one Infinispan Server installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Specify the IP address to which Infinispan Server binds in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open your Infinispan Server configuration and set the value for the <code>inet-address</code> element, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">&lt;server xmlns=&quot;urn:infinispan:server:13.0&quot;&gt;
  &lt;interfaces&gt;
    &lt;interface name=&quot;custom&quot;&gt;
      &lt;inet-address value=&quot;${infinispan.bind.address:192.0.2.0}&quot;/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>-b</code> option or the <code>infinispan.bind.address</code> system property.</p>
<div class="listingblock">
<div class="title">Linux</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">$ bin/server.sh -b 192.0.2.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Windows</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">bin\server.bat -b 192.0.2.0</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="listening-on-all-addresses_server-interfaces"><a class="anchor" href="#listening-on-all-addresses_server-interfaces"></a>3.3.1. Listening on all addresses</h4>
<div class="paragraph">
<p>If you specify the <code>0.0.0.0</code> meta-address, or <code>INADDR_ANY</code>, as the bind address in your Infinispan Server configuration, it listens for incoming client connections on all available network interfaces.</p>
</div>
<div class="paragraph">
<div class="title">Client intelligence</div>
<p>Configuring Infinispan to listen on all addresses affects how it provides Hot Rod clients with cluster topology.
If there are multiple interfaces to which Infinispan Server binds, then it sends a list of IP addresses for each interface.</p>
</div>
<div class="paragraph">
<p>For example, a cluster where each server node binds to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>10.0.0.0/8</code> subnet</p>
</li>
<li>
<p><code>192.168.0.0/16</code> subnet</p>
</li>
<li>
<p><code>127.0.0.1</code> loopback</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hot Rod clients receive IP addresses for server nodes that belong to the interface through which the clients connect.
If a client connects to <code>192.168.0.0</code>, for example, it does not receive any cluster topology details for nodes that listen on <code>10.0.0.0</code>.</p>
</div>
<div class="paragraph">
<div class="title">Netmask override</div>
<p>Kubernetes, and some other environments, divide the IP address space into subnets and use those different subnets as a single network.
For example, <code>10.129.2.100/23</code> and <code>10.129.4.100/23</code> are in different subnets but belong to the <code>10.0.0.0/8</code> network.</p>
</div>
<div class="paragraph">
<p>For this reason, Infinispan Server overrides netmasks that the host system provides with netmasks that follow IANA conventions for private networks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IPv4: <code>10.0.0.0/8</code>, <code>192.168.0.0/16</code>, <code>172.16.0.0/16</code>, and <code>169.254.0.0/16</code></p>
</li>
<li>
<p>IPv6: <code>fc00::/7</code> and <code>fe80::/10</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <code>RFC 1918</code> for IPv4 or <code>RFC 4193</code> and <code>RFC 3513</code> for IPv6.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can optionally configure the Hot Rod connector to use the netmask that the host system provides for interfaces with the <code>network-prefix-override</code> attribute in your Infinispan Server configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/infinispan-server-13.0.html">Infinispan Server schema reference</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc1918">RFC 1918</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc4193">RFC 4193</a></p>
</li>
<li>
<p><a href="https://www.rfc-editor.org/rfc/rfc3513.html">RFC 3513</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-ports-protocols_server-interfaces"><a class="anchor" href="#server-ports-protocols_server-interfaces"></a>3.4. Infinispan Server ports and protocols</h3>
<div class="paragraph">
<p>Infinispan Server provides network endpoints that allow client access with different protocols.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11222</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hot Rod and REST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11221</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memcached (disabled by default)</p></td>
</tr>
</tbody>
</table>
<h4 id="single_port" class="discrete">Single port</h4>
<div class="paragraph">
<p>Infinispan Server exposes multiple protocols through a single TCP port, <code>11222</code>.
Handling multiple protocols with a single port simplifies configuration and reduces management complexity when deploying Infinispan clusters.
Using a single port also enhances security by minimizing the attack surface on the network.</p>
</div>
<div class="paragraph">
<p>Infinispan Server handles HTTP/1.1, HTTP/2, and Hot Rod protocol requests from clients via the single port in different ways.</p>
</div>
<div class="paragraph">
<div class="title">HTTP/1.1 upgrade headers</div>
<p>Client requests can include the <code>HTTP/1.1 upgrade</code> header field to initiate
HTTP/1.1 connections with Infinispan Server.
Client applications can then send the <code>Upgrade: protocol</code> header field, where <code>protocol</code> is a server endpoint.</p>
</div>
<div class="paragraph">
<div class="title">Application-Layer Protocol Negotiation (ALPN)/Transport Layer Security (TLS)</div>
<p>Client requests include Server Name Indication (SNI) mappings for Infinispan Server endpoints to negotiate protocols over a TLS connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications must use a TLS library that supports the ALPN extension.
Infinispan uses WildFly OpenSSL bindings for Java.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Automatic Hot Rod detection</div>
<p>Client requests that include Hot Rod headers automatically route to Hot Rod endpoints.</p>
</div>
<div class="sect3">
<h4 id="configuring-firewalls_server-interfaces"><a class="anchor" href="#configuring-firewalls_server-interfaces"></a>3.4.1. Configuring network firewalls for Infinispan traffic</h4>
<div class="paragraph">
<p>Adjust firewall rules to allow traffic between Infinispan Server and client applications.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On Red Hat Enterprise Linux (RHEL) workstations, for example, you can allow
traffic to port <code>11222</code> with firewalld as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"># firewall-cmd --add-port=11222/tcp --permanent
success
# firewall-cmd --list-ports | grep 11222
11222/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure firewall rules that apply across a network, you can use the
nftables utility.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specifying-port-offsets_server-interfaces"><a class="anchor" href="#specifying-port-offsets_server-interfaces"></a>3.5. Specifying port offsets</h3>
<div class="paragraph">
<p>Configure port offsets for multiple Infinispan Server instances on the same host.
The default port offset is <code>0</code>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Use the <code>-o</code> switch with the Infinispan CLI or the
<code>infinispan.socket.binding.port-offset</code> system property to set port offsets.</p>
</div>
<div class="paragraph">
<p>For example, start a server instance with an offset of <code>100</code> as follows. With the default configuration, this results in the Infinispan server listening on port <code>11322</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">$ bin/server.sh -o 100</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">bin\server.bat -o 100</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-endpoints"><a class="anchor" href="#server-endpoints"></a>4. Server endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server endpoints provide client access to the cache manager over Hot Rod and REST protocols.</p>
</div>
<div class="sect2">
<h3 id="endpoints-hot-rod_server-endpoints"><a class="anchor" href="#endpoints-hot-rod_server-endpoints"></a>4.1. Hot Rod</h3>
<div class="paragraph">
<p>Hot Rod is a binary TCP client-server protocol designed to provide faster data
access and improved performance in comparison to text-based protocols.</p>
</div>
<div class="paragraph">
<p>Infinispan provides Hot Rod client libraries in Java, C++, C#, Node.js and other programming languages.</p>
</div>
<div class="paragraph">
<div class="title">Topology state transfer</div>
<p>Infinispan uses topology caches to provide clients with cluster views.
Topology caches contain entries that map internal JGroups transport addresses
to exposed Hot Rod endpoints.</p>
</div>
<div class="paragraph">
<p>When client send requests, Infinispan servers compare the topology ID in
request headers with the topology ID from the cache. Infinispan servers send
new topology views if client have older topology IDs.</p>
</div>
<div class="paragraph">
<p>Cluster topology views allow Hot Rod clients to immediately detect when nodes
join and leave, which enables dynamic load balancing and failover.</p>
</div>
<div class="paragraph">
<p>In distributed cache modes, the consistent hashing algorithm also makes it
possible to route Hot Rod client requests directly to primary owners.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html">Infinispan Hot Rod Server</a></p>
</li>
<li>
<p><a href="http://www.infinispan.org/hotrod-clients">Hot Rod client implementations</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="endpoints-rest_server-endpoints"><a class="anchor" href="#endpoints-rest_server-endpoints"></a>4.2. REST</h3>
<div class="paragraph">
<p>Infinispan exposes a RESTful interface that allows HTTP clients to access
data, monitor and maintain clusters, and perform administrative operations.</p>
</div>
<div class="paragraph">
<p>You can use standard HTTP load balancers to provide clients with load
balancing and failover capabilities. However, HTTP load balancers maintain
static cluster views and require manual updates when cluster topology changes
occur.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../rest/rest.html">Infinispan REST Server</a></p>
</li>
<li>
<p><a href="http://www.jboss.org/mod_cluster">mod_cluster HTTP load balancer</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="endpoints-memcached_server-endpoints"><a class="anchor" href="#endpoints-memcached_server-endpoints"></a>4.3. Memcached</h3>
<div class="paragraph">
<p>Infinispan provides an implementation of the Memcached text protocol for
remote client access.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Memcached endpoint is deprecated and planned for removal in a future
release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Infinispan Memcached endpoint supports clustering with replicated and
distributed cache modes.</p>
</div>
<div class="paragraph">
<p>There are some Memcached client implementations, such as the Cache::Memcached
Perl client, that can offer load balancing and failover detection capabilities
with static lists of Infinispan server addresses that require manual updates
when cluster topology changes occur.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../memcached/memcached.html">Infinispan Memcached Server</a></p>
</li>
<li>
<p><a href="http://github.com/memcached/memcached/blob/master/doc/protocol.txt">Memcached text protocol</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="endpoint-protocol-comparison_server-endpoints"><a class="anchor" href="#endpoint-protocol-comparison_server-endpoints"></a>4.4. Comparison of endpoint protocols</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">Hot Rod</th>
<th class="tableblock halign-center valign-top">HTTP / REST</th>
<th class="tableblock halign-center valign-top">Memcached</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Topology-aware</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash-aware</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditional ops</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bulk ops</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactions</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listeners</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site failover</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="green">Y</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong class="red">N</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="endpoint-connectors_server-endpoints"><a class="anchor" href="#endpoint-connectors_server-endpoints"></a>4.5. Endpoint connectors</h3>
<div class="paragraph">
<p>Connectors configure Infinispan Server endpoints with socket bindings and security realms</p>
</div>
<div class="listingblock">
<div class="title">Default endpoint connector</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default endpoint connector implicitly configures Hot Rod and REST endpoints with a socket binding and security realm.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint configuration attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endpoints</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wraps endpoint connector configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares a Infinispan Server endpoint that configures Hot Rod and REST connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hotrod-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures how clients connect to Infinispan Server over the Hot Rod protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rest-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures how clients connect to Infinispan Server over the REST/HTTP protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memcached-connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures how clients connect to Infinispan Server over Memcached, which is disabled by default.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-multiple-endpoints_server-endpoints"><a class="anchor" href="#configuring-multiple-endpoints_server-endpoints"></a>4.6. Configuring multiple endpoints</h3>
<div class="paragraph">
<p>You can configure multiple Infinispan Server endpoints to bind to different sockets and use different security realms.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure socket bindings for endpoints.</p>
</li>
<li>
<p>Configure security realms for endpoints.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Wrap multiple <code>endpoint</code> configurations with the <code>endpoints</code> element.</p>
</li>
<li>
<p>Specify the socket binding for each endpoint with the <code>socket-binding</code> attribute.</p>
</li>
<li>
<p>Specify the security realm for each endpoint with the <code>security-realm</code> attribute.</p>
</li>
<li>
<p>If necessary disable administrative capabilities, such as Infinispan Console and Command Line Interface (CLI), for an endpoint with the <code>admin="false"</code> attribute.</p>
</li>
<li>
<p>Include <code>hotrod-connector</code> and <code>rest-connector</code> configurations for each endpoint.</p>
</li>
<li>
<p>Save and close your Infinispan Server configuration.</p>
</li>
</ol>
</div>
<h4 id="multiple_endpoint_configuration" class="discrete">Multiple endpoint configuration</h4>
<div class="paragraph">
<p>The following Infinispan Server configuration enables two endpoints on separate socket bindings with dedicated security realms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-realm</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">admin</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rest-connector</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">private</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">management-realm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rest-connector</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../server/server.html#server-interfaces">Network interfaces and socket bindings</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="endpoint-ip-address-filters_server-endpoints"><a class="anchor" href="#endpoint-ip-address-filters_server-endpoints"></a>4.7. Infinispan Server endpoint IP address filters</h3>
<div class="paragraph">
<p>Infinispan endpoints and connectors can specify one or more IP filtering rules.
These rules specify the type of action to take when a client which matches a supplied CIDR block connects.
IP filtering rules are applied in order up until the first one that matches.</p>
</div>
<div class="paragraph">
<p>A CIDR block is a compact representation of an IP address and its associated network mask.
CIDR notation specifies an IP address, a slash ('/') character, and a decimal number.
The decimal number is the count of leading 1 bits in the network mask.
The number can also be thought of as the width, in bits, of the network prefix.
The IP address in CIDR notation is always represented according to the standards for IPv4 or IPv6.</p>
</div>
<div class="paragraph">
<p>The address can denote a specific interface address, including a host identifier, such as <code>10.0.0.1/8</code>, or it can be the beginning address of an entire network interface range using a host identifier of 0, as in <code>10.0.0.0/8</code> or <code>10/8</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>192.168.100.14/24</code> represents the IPv4 address <code>192.168.100.14</code> and its associated network prefix <code>192.168.100.0</code>,
or equivalently, its subnet mask <code>255.255.255.0</code>, which has 24 leading 1-bits.</p>
</li>
<li>
<p>the IPv4 block <code>192.168.100.0/22</code> represents the 1024 IPv4 addresses from <code>192.168.100.0</code> to <code>192.168.103.255</code>.</p>
</li>
<li>
<p>the IPv6 block <code>2001:db8::/48</code> represents the block of IPv6 addresses from <code>2001:db8:0:0:0:0:0:0</code> to
<code>2001:db8:0:ffff:ffff:ffff:ffff:ffff</code>.</p>
</li>
<li>
<p><code>::1/128</code> represents the IPv6 loopback address. Its prefix length is 128 which is the number of bits in the address.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ip-filter&gt;</span>
      <span class="tag">&lt;accept</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.0/16</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;accept</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10.0.0.0/8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;reject</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ip-filter&gt;</span>
    <span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of the preceding configuration, Infinispan Server accepts connections only from addresses in the <code>192.168.0.0/16</code> and <code>10.0.0.0/8</code> CIDR blocks.
Infinispan Server rejects all other connections.</p>
</div>
</div>
<div class="sect2">
<h3 id="user_tool-server-endpoints"><a class="anchor" href="#user_tool-server-endpoints"></a>4.8. Inspecting and modifying rules for filtering IP addresses</h3>
<div class="paragraph">
<p>Configure IP address filtering rules on Infinispan Server endpoints to accept or reject connections based on client address.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install Infinispan Command Line Interface (CLI).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan Server.</p>
</li>
<li>
<p>Inspect and modify the IP filter rules <code class="command">server connector ipfilter</code> command as required.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>List all IP filtering rules active on a connector across the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; server connector ipfilter ls endpoint-default</code></pre>
</div>
</div>
</li>
<li>
<p>Set IP filtering rules across the cluster.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This command replaces any existing rules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; server connector ipfilter set endpoint-default --rules=ACCEPT/192.168.0.0/16,REJECT/10.0.0.0/8`</code></pre>
</div>
</div>
</li>
<li>
<p>Remove all IP filtering rules on a connector across the cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; server connector ipfilter clear endpoint-default</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-realms"><a class="anchor" href="#security-realms"></a>5. Security realms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security realms define identity, encryption, authentication, and authorization configuration for Infinispan Server endpoints.</p>
</div>
<div class="sect2">
<h3 id="property-security-realms_security-realms"><a class="anchor" href="#property-security-realms_security-realms"></a>5.1. Property security realms</h3>
<div class="paragraph">
<p>Property realms use property files to define users and groups.</p>
</div>
<div class="paragraph">
<p><code>users.properties</code> maps usernames to passwords in plain-text format. Passwords
can also be pre-digested if you use the <code>DIGEST-MD5</code> SASL mechanism or <code>Digest</code>
HTTP mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>myuser=a_password
user2=another_password</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>groups.properties</code> maps users to roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>myuser=supervisor,reader,writer
user2=supervisor</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Endpoint authentication mechanisms</div>
<p>When you configure Infinispan Server to use a property realm, you can configure endpoints to use the following authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hot Rod (SASL): <code>PLAIN</code>, <code>DIGEST-*</code>, and <code>SCRAM-*</code></p>
</li>
<li>
<p>REST (HTTP): <code>Basic</code> and <code>Digest</code></p>
</li>
</ul>
</div>
<h4 id="property_realm_configuration" class="discrete">Property realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Defines groups as roles for server authorization. --&gt;</span>
         <span class="tag">&lt;properties-realm</span> <span class="attribute-name">groups-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- Specifies the properties file that holds usernames and passwords. --&gt;</span>
            <span class="comment">&lt;!-- The plain-text=&quot;true&quot; attribute stores passwords in plain text. --&gt;</span>
            <span class="tag">&lt;user-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">users.properties</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="comment">&lt;!-- Specifies the properties file that defines roles for users. --&gt;</span>
            <span class="tag">&lt;group-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groups.properties</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/properties-realm&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">properties-realm</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">groups-attribute</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">user-properties</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ServerConfigurationParserTest-user.properties</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">plain-text</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">group-properties</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ServerConfigurationParserTest-group.properties</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">security-realms</span>:
    - <span class="string"><span class="content">name: default</span></span>
      <span class="key">properties-realm</span>:
        <span class="key">groups-attribute</span>: <span class="string"><span class="content">Roles</span></span>
        <span class="key">user-properties</span>:
          <span class="key">digest-realm-name</span>: <span class="string"><span class="content">digest</span></span>
          <span class="key">path</span>: <span class="string"><span class="content">'ServerConfigurationParserTest-user.properties'</span></span>
          <span class="key">relative-to</span>: <span class="string"><span class="content">'infinispan.server.config.path'</span></span>
          <span class="key">plain-text</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">group-properties</span>:
          <span class="key">path</span>: <span class="string"><span class="content">'ServerConfigurationParserTest-group.properties'</span></span>
          <span class="key">relative-to</span>: <span class="string"><span class="content">'infinispan.server.config.path'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap-security-realms_security-realms"><a class="anchor" href="#ldap-security-realms_security-realms"></a>5.2. LDAP security realms</h3>
<div class="paragraph">
<p>LDAP realms connect to LDAP servers, such as OpenLDAP, Red Hat Directory
Server, Apache Directory Server, or Microsoft Active Directory, to authenticate
users and obtain membership information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LDAP servers can have different entry layouts, depending on the type of server and deployment.
It is beyond the scope of this document to provide examples for all possible configurations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Endpoint authentication mechanisms</div>
<p>When you configure Infinispan Server to use an LDAP realm, you can configure endpoints to use the following authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hot Rod (SASL): <code>PLAIN</code>, <code>DIGEST-*</code>, and <code>SCRAM-*</code></p>
</li>
<li>
<p>REST (HTTP): <code>Basic</code> and <code>Digest</code></p>
</li>
</ul>
</div>
<h4 id="ldap_realm_configuration" class="discrete">LDAP realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- Names an LDAP realm and specifies connection properties. --&gt;</span>
        <span class="tag">&lt;ldap-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://my-ldap-server:10389</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">credential</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">strongPassword</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">connection-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">read-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">connection-pooling</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">referral-mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ignore</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">page-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">direct-verification</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- Defines how principals are mapped to LDAP entries. --&gt;</span>
            <span class="tag">&lt;identity-mapping</span> <span class="attribute-name">rdn-identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">search-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">search-recursive</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
               <span class="comment">&lt;!-- Retrieves all the groups of which the user is a member. --&gt;</span>
               <span class="tag">&lt;attribute-mapping&gt;</span>
                  <span class="tag">&lt;attribute</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cn</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="entity">&amp;amp;</span><span class="content">(objectClass=groupOfNames)(member={1}))</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">filter-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Roles,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
               <span class="tag">&lt;/attribute-mapping&gt;</span>
            <span class="tag">&lt;/identity-mapping&gt;</span>
         <span class="tag">&lt;/ldap-realm&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://my-ldap-server:10389</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">credential</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">strongPassword</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">connection-timeout</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">read-timeout</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">connection-pooling</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">referral-mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ignore</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">direct-verification</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">identity-mapping</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">rdn-identifier</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">search-dn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">search-recursive</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">attribute-mapping</span><span class="delimiter">&quot;</span></span>: [
              {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cn</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">(&amp;(objectClass=groupOfNames)(member={1}))</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">filter-dn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Roles,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>
              }
            ]
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">security-realms</span>:
    - <span class="string"><span class="content">name: default</span></span>
      <span class="key">ldap-realm</span>:
        <span class="key">name</span>: <span class="string"><span class="content">ldap</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">'ldap://my-ldap-server:10389'</span></span>
        <span class="key">principal</span>: <span class="string"><span class="content">'uid=admin,ou=People,dc=infinispan,dc=org'</span></span>
        <span class="key">credential</span>: <span class="string"><span class="content">strongPassword</span></span>
        <span class="key">connection-timeout'</span>: <span class="string"><span class="content">'3000'</span></span>
        <span class="key">read-timeout'</span>: <span class="string"><span class="content">'30000'</span></span>
        <span class="key">connection-pooling'</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">referral-mode'</span>: <span class="string"><span class="content">ignore</span></span>
        <span class="key">page-size'</span>: <span class="string"><span class="content">'30'</span></span>
        <span class="key">direct-verification'</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">identity-mapping</span>:
          <span class="key">rdn-identifier</span>: <span class="string"><span class="content">uid</span></span>
          <span class="key">search-dn</span>: <span class="string"><span class="content">'ou=People,dc=infinispan,dc=org'</span></span>
          <span class="key">search-recursive</span>: <span class="string"><span class="content">false</span></span>
          <span class="key">attribute-mapping</span>:
            - <span class="string"><span class="content">filter: '(&amp;(objectClass=groupOfNames)(member={1}))'</span></span>
              <span class="key">filter-dn</span>: <span class="string"><span class="content">'ou=Roles,dc=infinispan,dc=org'</span></span>
              <span class="key">from</span>: <span class="string"><span class="content">cn</span></span>
              <span class="key">to</span>: <span class="string"><span class="content">Roles</span></span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The principal for LDAP connections must have necessary privileges to perform
LDAP queries and access specific attributes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an alternative to verifying user credentials with the <code>direct-verification</code> attribute, you can specify an LDAP password with the <code>user-password-mapper</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>rdn-identifier</code> attribute specifies an LDAP attribute that finds the user entry based on a provided identifier, which is typically a username; for example, the <code>uid</code> or <code>sAMAccountName</code> attribute.
Add <code>search-recursive="true"</code> to the configuration to search the directory recursively.
By default, the search for the user entry uses the <code>(rdn_identifier={0})</code> filter.
Specify a different filter with the <code>filter-name</code> attribute.</p>
</div>
<div class="paragraph">
<p>The <code>attribute-mapping</code> element retrieves all the groups of which the user is a member. There are typically two ways in which membership information is stored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under group entries that usually have class <code>groupOfNames</code> in the <code>member</code> attribute. In this case, you can use an attribute filter as in the preceding example configuration. This filter searches for entries that match the supplied filter, which locates groups with a <code>member</code> attribute equal to the user&#8217;s DN. The filter then extracts the group entry&#8217;s CN as specified by <code>from</code>, and adds it to the user&#8217;s <code>Roles</code>.</p>
</li>
<li>
<p>In the user entry in the <code>memberOf</code> attribute. In this case you should use an attribute reference such as the following:</p>
<div class="paragraph">
<p><code>&lt;attribute-reference reference="memberOf" from="cn" to="Roles" /&gt;</code></p>
</div>
<div class="paragraph">
<p>This reference gets all <code>memberOf</code> attributes from the user&#8217;s entry, extracts the CN as specified by <code>from</code>, and adds them to the user&#8217;s <code>Roles</code>.</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ldap-realm-principal-rewriting_security-realms"><a class="anchor" href="#ldap-realm-principal-rewriting_security-realms"></a>5.2.1. LDAP realm principal re-writing</h4>
<div class="paragraph">
<p>Some SASL authentication mechanisms, such as <code>GSSAPI</code>, <code>GS2-KRB5</code> and
<code>Negotiate</code>, supply a username that needs to be <em>cleaned up</em> before you can use
it to search LDAP servers.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;ldap-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://${org.infinispan.test.host.address}:10389</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">credential</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">strongPassword</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;name-rewriter&gt;</span>
               <span class="comment">&lt;!-- Defines a rewriter that extracts the username from the principal using a regular expression. --&gt;</span>
               <span class="tag">&lt;regex-principal-transformer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain-remover</span><span class="delimiter">&quot;</span></span>
                                            <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(.*)@INFINISPAN\.ORG</span><span class="delimiter">&quot;</span></span>
                                            <span class="attribute-name">replacement</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/name-rewriter&gt;</span>
            <span class="tag">&lt;identity-mapping</span> <span class="attribute-name">rdn-identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">search-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
               <span class="tag">&lt;attribute-mapping&gt;</span>
                  <span class="tag">&lt;attribute</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="entity">&amp;amp;</span><span class="content">(objectClass=groupOfNames)(member={1}))</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">filter-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Roles,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
               <span class="tag">&lt;/attribute-mapping&gt;</span>
               <span class="tag">&lt;user-password-mapper</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPassword</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/identity-mapping&gt;</span>
         <span class="tag">&lt;/ldap-realm&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://my-ldap-server:10389</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">credential</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">strongPassword</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">identity-mapping</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">rdn-identifier</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">search-dn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">name-rewriter</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">regex-principal-transformer</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">pattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">(.*)@INFINISPAN</span><span class="char">\\</span><span class="content">.ORG</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">replacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$1</span><span class="delimiter">&quot;</span></span>
              }
            },
            <span class="key"><span class="delimiter">&quot;</span><span class="content">attribute-mapping</span><span class="delimiter">&quot;</span></span>: [
              {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cn</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">(&amp;(objectClass=groupOfNames)(member={1}))</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">filter-dn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Roles,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>
              }
            ],
            <span class="key"><span class="delimiter">&quot;</span><span class="content">user-password-mapper</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">userPassword</span><span class="delimiter">&quot;</span></span>
            }
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">security-realms</span>:
    - <span class="string"><span class="content">name: default</span></span>
      <span class="key">ldap-realm</span>:
        <span class="key">name</span>: <span class="string"><span class="content">ldap</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">'ldap://my-ldap-server:10389'</span></span>
        <span class="key">principal</span>: <span class="string"><span class="content">'uid=admin,ou=People,dc=infinispan,dc=org'</span></span>
        <span class="key">credential</span>: <span class="string"><span class="content">strongPassword</span></span>
        <span class="key">name-rewriter</span>:
          <span class="key">regex-principal-transformer</span>:
            <span class="key">name</span>: <span class="string"><span class="content">'domain-remover'</span></span>
            <span class="key">pattern</span>: <span class="string"><span class="content">(.*)@INFINISPAN\.ORG</span></span>
            <span class="key">replacement</span>: <span class="string"><span class="content">$1</span></span>
        <span class="key">identity-mapping</span>:
          <span class="key">rdn-identifier</span>: <span class="string"><span class="content">uid</span></span>
          <span class="key">search-dn</span>: <span class="string"><span class="content">'ou=People,dc=infinispan,dc=org'</span></span>
          <span class="key">attribute-mapping</span>:
            - <span class="string"><span class="content">filter: '(&amp;(objectClass=groupOfNames)(member={1}))'</span></span>
              <span class="key">filter-dn</span>: <span class="string"><span class="content">'ou=Roles,dc=infinispan,dc=org'</span></span>
              <span class="key">from</span>: <span class="string"><span class="content">cn</span></span>
              <span class="key">to</span>: <span class="string"><span class="content">Roles</span></span>
          <span class="key">user-password-mapper</span>:
            <span class="key">from</span>: <span class="string"><span class="content">userPassword</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token-security-realms_security-realms"><a class="anchor" href="#token-security-realms_security-realms"></a>5.3. Token security realms</h3>
<div class="paragraph">
<p>Token realms use external services to validate tokens and require providers
that are compatible with RFC-7662 (OAuth2 Token Introspection), such as
KeyCloak.</p>
</div>
<div class="paragraph">
<div class="title">Endpoint authentication mechanisms</div>
<p>When you configure Infinispan Server to use a token realm, you must configure endpoints to use the following authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hot Rod (SASL): <code>OAUTHBEARER</code></p>
</li>
<li>
<p>REST (HTTP): <code>Bearer</code></p>
</li>
</ul>
</div>
<h4 id="token_realm_configuration" class="discrete">Token realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Specifies the URL of the authentication server. --&gt;</span>
         <span class="tag">&lt;token-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">token</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">auth-server-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://oauth-server/auth/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- Specifies the URL of the token introspection endpoint. --&gt;</span>
            <span class="tag">&lt;oauth2-introspection</span>
                    <span class="attribute-name">introspection-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">client-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">client-secret</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1fdca4ec-c416-47e0-867a-3d471af7050f</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/token-realm&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">token-realm</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">token</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">auth-server-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://oauth-server/auth/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">oauth2-introspection</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">client-id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">client-secret</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1fdca4ec-c416-47e0-867a-3d471af7050f</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">introspection-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">security-realms</span>:
    - <span class="string"><span class="content">name: default</span></span>
      <span class="key">token-realm</span>:
        <span class="key">name</span>: <span class="string"><span class="content">token</span></span>
        <span class="key">auth-server-url</span>: <span class="string"><span class="content">'https://oauth-server/auth/'</span></span>
        <span class="key">oauth2-introspection</span>:
          <span class="key">client-id</span>: <span class="string"><span class="content">infinispan-server</span></span>
          <span class="key">client-secret</span>: <span class="string"><span class="content">'1fdca4ec-c416-47e0-867a-3d471af7050f'</span></span>
          <span class="key">introspection-url</span>: <span class="string"><span class="content">'https://oauth-server/auth/realms/infinispan/protocol/openid-connect/token/introspect'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trust-store-security-realms_security-realms"><a class="anchor" href="#trust-store-security-realms_security-realms"></a>5.4. Trust store security realms</h3>
<div class="paragraph">
<p>Trust store realms use certificates, or certificates chains, that verify Infinispan Server and client identities when they negotiate connections.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Keystores</dt>
<dd>
<p>Contain server certificates that provide a Infinispan Server identity to clients. If you configure a keystore with server certificates, Infinispan Server encrypts traffic using industry standard SSL/TLS protocols.</p>
</dd>
<dt class="hdlist1">Trust stores</dt>
<dd>
<p>Contain client certificates, or certificate chains, that clients present to Infinispan Server. Client trust stores are optional and allow Infinispan Server to perform client certificate authentication.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Client certificate authentication</div>
<p>You must add the <code>require-ssl-client-auth="true"</code> attribute to the endpoint configuration if you want Infinispan Server to validate or authenticate client certificates.</p>
</div>
<div class="paragraph">
<div class="title">Endpoint authentication mechanisms</div>
<p>If you configure Infinispan Server with a keystore only, you can use encryption in combination with any authentication mechanism.</p>
</div>
<div class="paragraph">
<p>When you configure Infinispan Server to use a client trust store, you must configure endpoints to use the following authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hot Rod (SASL): <code>EXTERNAL</code></p>
</li>
<li>
<p>REST (HTTP): <code>CLIENT_CERT</code></p>
</li>
</ul>
</div>
<h4 id="trust_store_realm_configuration" class="discrete">Trust store realm configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;security-realms&gt;</span>
    <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
          <span class="comment">&lt;!-- Provides an SSL/TLS identity with a keystore that
               contains server certificates. --&gt;</span>
          <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.p12</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="comment">&lt;!-- Configures a trust store that contains client certificates
               or part of a certificate chain. --&gt;</span>
          <span class="tag">&lt;truststore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trust.p12</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
      <span class="tag">&lt;/server-identities&gt;</span>
      <span class="comment">&lt;!-- Authenticates client certificates against the trust store. If you configure this, the trust store must contain the public certificates for all clients. --&gt;</span>
      <span class="tag">&lt;truststore-realm</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/security-realm&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span>
<span class="comment">&lt;!-- Configures Infinispan Server to require client certificates
     with the &quot;require-ssl-client-auth&quot; attribute. --&gt;</span>
<span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector&gt;</span>
      <span class="comment">&lt;!-- Configures the Hot Rod endpoint for
           client certificate authentication. --&gt;</span>
      <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;sasl</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EXTERNAL</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authentication&gt;</span>
    <span class="tag">&lt;/hotrod-connector&gt;</span>
    <span class="tag">&lt;rest-connector&gt;</span>
      <span class="comment">&lt;!-- Configures the REST endpoint for
           client certificate authentication. --&gt;</span>
      <span class="tag">&lt;authentication</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CLIENT_CERT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest-connector&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">server-identities</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">ssl</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">keystore</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">server.p12</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">keystore-password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">alias</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span>
            },
            <span class="key"><span class="delimiter">&quot;</span><span class="content">truststore</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">trust.p12</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
            }
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">truststore-realm</span><span class="delimiter">&quot;</span></span>: {}
      }
    ]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">endpoints</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">socket-binding</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">require-ssl-client-auth</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">connectors</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">hotrod-connector</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">authentication</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">sasl</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">mechanisms</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EXTERNAL</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">server-name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">qop</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span>
              }
            }
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">rest-connector</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">authentication</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">mechanisms</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CLIENT_CERT</span><span class="delimiter">&quot;</span></span>
              }
            }
          }
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">security-realms</span>:
    - <span class="string"><span class="content">name: &quot;default&quot;</span></span>
      <span class="key">server-identities</span>:
        <span class="key">ssl</span>:
          <span class="key">keystore</span>:
            <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">server.p12</span><span class="delimiter">&quot;</span></span>
            <span class="key">relative-to</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
            <span class="key">keystore-password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
            <span class="key">alias</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span>
          <span class="key">truststore</span>:
            <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">trust.p12</span><span class="delimiter">&quot;</span></span>
            <span class="key">relative-to</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
            <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
      <span class="key">truststore-realm</span>: <span class="string"><span class="content">~</span></span>
<span class="key">endpoints</span>:
  <span class="key">socket-binding</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
  <span class="key">security-realm</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
  <span class="key">require-ssl-client-auth</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
  <span class="key">connectors</span>:
    - <span class="string"><span class="content">hotrod:</span><span class="content">
        hotrod-connector:
          authentication:
            sasl:
              mechanisms: &quot;EXTERNAL&quot;
              server-name: &quot;infinispan&quot;
              qop: &quot;auth&quot;</span></span>
    - <span class="string"><span class="content">rest:</span><span class="content">
        rest-connector:
          authentication:
            mechanisms: &quot;CLIENT_CERT&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distributed-security-realms_security-realms"><a class="anchor" href="#distributed-security-realms_security-realms"></a>5.5. Distributed security realms</h3>
<div class="paragraph">
<p>Distributed realms combine multiple security realms.
When authenticating users, Infinispan Server uses each security realm in turn until it finds one that can perform the authentication.</p>
</div>
<div class="listingblock">
<div class="title">Distributed realm configuration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;ldap-realm&gt;</span>
            <span class="comment">&lt;!-- ... --&gt;</span>
         <span class="tag">&lt;/ldap-realm&gt;</span>
         <span class="tag">&lt;properties-realm&gt;</span>
            <span class="comment">&lt;!-- ... --&gt;</span>
         <span class="tag">&lt;/properties-realm&gt;</span>
         <span class="tag">&lt;distributed-realm</span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- will use both the ldap and properties realms --&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Supported authentication mechanisms</div>
<p>Distributed realms support the authentication mechanisms of the underlying realms.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoint-authentication"><a class="anchor" href="#endpoint-authentication"></a>6. Configuring Endpoint Authentication Mechanisms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure Hot Rod and REST connectors with SASL or HTTP authentication
mechanisms to authenticate with clients.</p>
</div>
<div class="paragraph">
<p>Infinispan servers require user authentication to access the
command line interface (CLI) and console as well as the Hot Rod and REST
endpoints. Infinispan servers also automatically configure authentication
mechanisms based on the security realms that you define.</p>
</div>
<div class="sect2">
<h3 id="server_endpoint_auth-server"><a class="anchor" href="#server_endpoint_auth-server"></a>6.1. Infinispan Server Authentication</h3>
<div class="paragraph">
<p>Infinispan servers automatically configure authentication mechanisms based on
the security realm that you assign to endpoints.</p>
</div>
<div class="paragraph">
<div class="title">SASL Authentication Mechanisms</div>
<p>The following SASL authentication mechanisms apply to Hot Rod endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security Realm</th>
<th class="tableblock halign-left valign-top">SASL Authentication Mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property Realms and LDAP Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCRAM-*, DIGEST-*, CRAM-MD5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAUTHBEARER</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTERNAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos Identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GSSAPI, GS2-KRB5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS Identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PLAIN</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">HTTP Authentication Mechanisms</div>
<p>The following HTTP authentication mechanisms apply to REST endpoints:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Security Realm</th>
<th class="tableblock halign-left valign-top">HTTP Authentication Mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property Realms and LDAP Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIGEST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEARER_TOKEN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT_CERT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos Identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPNEGO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS Identities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BASIC</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Default Configuration</div>
<p>Infinispan servers provide a security realm named "default" that uses a
property realm with plain text credentials defined in <code>$ISPN_HOME/server/
conf/users.properties</code>, as shown in the following snippet:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;properties-realm</span> <span class="attribute-name">groups-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;user-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">users.properties</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;group-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groups.properties</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/properties-realm&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">properties-realm</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groups-attribute</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">user-properties</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users.properties</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">plain-text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">group-properties</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">groups.properties</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">securityRealms</span>:
  - <span class="string"><span class="content">name: &quot;default&quot;</span></span>
    <span class="key">propertiesRealm</span>:
      <span class="key">groupsAttribute</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>
      <span class="key">userProperties</span>:
        <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">users.properties</span><span class="delimiter">&quot;</span></span>
        <span class="key">relativeTo</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
        <span class="key">plainText</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">groupProperties</span>:
        <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">groups.properties</span><span class="delimiter">&quot;</span></span>
        <span class="key">relativeTo</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>endpoints</code> configuration assigns the "default" security realm to the Hot
Rod and REST connectors, as follows:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">endpoints</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">socket-binding</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">endpoints</span>:
  - <span class="string"><span class="content">socketBinding: &quot;default&quot;</span></span>
    <span class="key">securityRealm</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of the preceding configuration, Infinispan servers require
authentication with a mechanism that the property realm supports.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure_hotrod_authentication-server"><a class="anchor" href="#configure_hotrod_authentication-server"></a>6.2. Manually Configuring Hot Rod Authentication</h3>
<div class="paragraph">
<p>Explicitly configure Hot Rod connector authentication to override the default
SASL authentication mechanisms that Infinispan servers use for security realms.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add an <code>authentication</code> definition to the Hot Rod connector configuration.</p>
</li>
<li>
<p>Specify which Infinispan security realm the Hot Rod connector uses for authentication.</p>
</li>
<li>
<p>Specify the SASL authentication mechanisms for the Hot Rod endpoint to use.</p>
</li>
<li>
<p>Configure SASL authentication properties as appropriate.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="hot-rod-authentication_server"><a class="anchor" href="#hot-rod-authentication_server"></a>6.2.1. Hot Rod authentication</h4>
<div class="listingblock">
<div class="title">Hot Rod connector with SCRAM, DIGEST, and PLAIN authentication</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector&gt;</span>
      <span class="tag">&lt;authentication&gt;</span>
         <span class="comment">&lt;!-- Specifies SASL mechanisms to use for authentication. --&gt;</span>
         <span class="comment">&lt;!-- Defines the name that the server declares to clients. --&gt;</span>
         <span class="tag">&lt;sasl</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SCRAM-SHA-512 SCRAM-SHA-384 SCRAM-SHA-256</span>
                           <span class="content">SCRAM-SHA-1 DIGEST-SHA-512 DIGEST-SHA-384</span>
                           <span class="content">DIGEST-SHA-256 DIGEST-SHA DIGEST-MD5 PLAIN</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authentication&gt;</span>
    <span class="tag">&lt;/hotrod-connector&gt;</span>
    <span class="tag">&lt;rest-connector</span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Hot Rod connector with Kerberos authentication</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;hotrod-connector&gt;</span>
      <span class="tag">&lt;authentication&gt;</span>
         <span class="comment">&lt;!-- Enables the GSSAPI and GS2-KRB5 mechanisms for Kerberos authentication. --&gt;</span>
         <span class="comment">&lt;!-- Defines the server name, which is equivalent to the Kerberos service name, and specifies the Kerberos identity for the server. --&gt;</span>
         <span class="tag">&lt;sasl</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GSSAPI GS2-KRB5</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">datagrid</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">server-principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod/datagrid@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authentication&gt;</span>
   <span class="tag">&lt;/hotrod-connector&gt;</span>
   <span class="tag">&lt;rest-connector</span> <span class="tag">/&gt;</span>
 <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="hot-rod-authentication-mechanisms_server"><a class="anchor" href="#hot-rod-authentication-mechanisms_server"></a>6.2.2. Hot Rod authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan supports the following SASL authentications mechanisms with the Hot
Rod connector:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLAIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>PLAIN</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Basic</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. Hot Rod connectors support <code>DIGEST-MD5</code>, <code>DIGEST-SHA</code>, <code>DIGEST-SHA-256</code>, <code>DIGEST-SHA-384</code>, and <code>DIGEST-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SCRAM-*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>salt</em> values in addition to hashing algorithms and nonce values. Hot Rod connectors support <code>SCRAM-SHA</code>, <code>SCRAM-SHA-256</code>, <code>SCRAM-SHA-384</code>, and <code>SCRAM-SHA-512</code> hashing algorithms, in order of strength.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>Digest</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GSSAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GS2-KRB5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>SPNEGO</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTERNAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>CLIENT_CERT</code> HTTP mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAUTHBEARER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>BEARER_TOKEN</code> HTTP mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sasl-quality-of-protection_server"><a class="anchor" href="#sasl-quality-of-protection_server"></a>6.2.3. SASL quality of protection (QoP)</h4>
<div class="paragraph">
<p>If SASL mechanisms support integrity and privacy protection (QoP) settings, you can add them to your Hot Rod connector configuration with the <code>qop</code> attribute.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">QoP setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity protection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity and privacy protection.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sasl-policies-hot-rod-authentication_server"><a class="anchor" href="#sasl-policies-hot-rod-authentication_server"></a>6.2.4. SASL policies for Hot Rod authentication</h4>
<div class="paragraph">
<p>SASL policies control which authentication mechanisms Hot Rod connectors can use.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forward-secrecy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use only SASL mechanisms that support forward secrecy between sessions. This means that breaking into one session does not automatically provide information for breaking into future sessions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pass-credentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use only SASL mechanisms that require client credentials.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-plain-text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to simple plain passive attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to active, non-dictionary, attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-dictionary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that are susceptible to passive dictionary attacks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-anonymous</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use SASL mechanisms that accept anonymous logins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan cache authorization restricts access to caches based on roles and
permissions. If you configure cache authorization, you can then set
<code>&lt;no-anonymous value=false /&gt;</code> to allow anonymous login and delegate access
logic to cache authorization.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Hot Rod connector with SASL policy configuration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Specifies multiple SASL authentication mechanisms for the Hot Rod connector. --&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAIN DIGEST-MD5 GSSAPI EXTERNAL</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Defines policies for SASL mechanisms. --&gt;</span>
         <span class="tag">&lt;policy&gt;</span>
            <span class="tag">&lt;no-active</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;no-anonymous</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;no-plain-text</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
         <span class="tag">&lt;/policy&gt;</span>
      <span class="tag">&lt;/sasl&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of the preceding configuration, the Hot Rod connector uses the
<code>GSSAPI</code> mechanism because it is the only mechanism that complies with all
policies.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure_rest_endpoint_auth-server"><a class="anchor" href="#configure_rest_endpoint_auth-server"></a>6.3. Manually Configuring REST Authentication</h3>
<div class="paragraph">
<p>Explicitly configure REST connector authentication to override the default
HTTP authentication mechanisms that Infinispan servers use for security realms.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add an <code>authentication</code> definition to the REST connector configuration.</p>
</li>
<li>
<p>Specify which Infinispan security realm the REST connector uses for authentication.</p>
</li>
<li>
<p>Specify the authentication mechanisms for the REST endpoint to use.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="rest-authentication_server"><a class="anchor" href="#rest-authentication_server"></a>6.3.1. REST authentication</h4>
<div class="listingblock">
<div class="title">REST connector with BASIC and DIGEST authentication</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rest-connector&gt;</span>
      <span class="comment">&lt;!-- Specifies SASL mechanisms to use for authentication. --&gt;</span>
      <span class="tag">&lt;authentication</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST BASIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest-connector&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">REST connector with Kerberos authentication</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rest-connector&gt;</span>
      <span class="comment">&lt;!-- Enables the `SPENGO` mechanism for Kerberos authentication and specifies an identity for the server. --&gt;</span>
      <span class="tag">&lt;authentication</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SPNEGO</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">server-principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/localhost@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest-connector&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="rest-authentication-mechanisms_server"><a class="anchor" href="#rest-authentication-mechanisms_server"></a>6.3.2. REST authentication mechanisms</h4>
<div class="paragraph">
<p>Infinispan supports the following authentications mechanisms with the REST
connector:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Authentication mechanism</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Related details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BASIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses credentials in plain-text format. You should use <code>BASIC</code> authentication with encrypted connections only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Basic</code> HTTP authentication scheme and is similar to the <code>PLAIN</code> SASL mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIGEST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses hashing algorithms and nonce values. REST connectors support <code>SHA-512</code>, <code>SHA-256</code> and <code>MD5</code> hashing algorithms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Digest</code> HTTP authentication scheme and is similar to <code>DIGEST-*</code> SASL mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPNEGO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses Kerberos tickets and requires a Kerberos Domain Controller. You must add a corresponding <code>kerberos</code> server identity in the realm configuration. In most cases, you also specify an <code>ldap-realm</code> to provide user membership information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Negotiate</code> HTTP authentication scheme and is similar to the <code>GSSAPI</code> and <code>GS2-KRB5</code> SASL mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEARER_TOKEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses OAuth tokens and requires a <code>token-realm</code> configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponds to the <code>Bearer</code> HTTP authentication scheme and is similar to <code>OAUTHBEARER</code> SASL mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_CERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses client certificates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the <code>EXTERNAL</code> SASL mechanism.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="disabling-authentication_server"><a class="anchor" href="#disabling-authentication_server"></a>6.4. Disabling Authentication</h3>
<div class="paragraph">
<p>In local development environments or on isolated networks you can configure Infinispan to allow unauthenticated client requests.</p>
</div>
<div class="paragraph">
<p>When you disable user authentication you should also disable authorization in your Infinispan security configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>infinispan.xml</code> for editing.</p>
</li>
<li>
<p>Remove any <code>security-realm</code> attributes from the <code>endpoints</code> configuration.</p>
</li>
<li>
<p>Ensure that the Hot Rod and REST connectors do not include any
<code>authentication</code> configuration.</p>
<div class="paragraph">
<p>For example, the following configuration allows unauthenticated access to
Infinispan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;endpoints</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Remove any <code>authorization</code> elements from the <code>security</code> configuration for the <code>cache-container</code> and each cache configuration.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoint-encryption"><a class="anchor" href="#endpoint-encryption"></a>7. Encrypting Infinispan Server Connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can secure Infinispan Server connections using SSL/TLS encryption by configuring a keystore that contains public and private keys for Infinispan.
You can also configure client certificate authentication if you require mutual TLS.</p>
</div>
<div class="sect2">
<h3 id="configuring-server-keystores_server"><a class="anchor" href="#configuring-server-keystores_server"></a>7.1. Configuring Infinispan Server Keystores</h3>
<div class="paragraph">
<p>Add keystores to Infinispan Server and configure it to present SSL/TLS certificates that verify its identity to clients.
If a security realm contains TLS/SSL identities, it encrypts any connections to Infinispan Server endpoints that use that security realm.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a keystore that contains certificates, or certificate chains, for Infinispan Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan Server supports the following keystore formats: JKS, JCEKS, PKCS12/PFX and PEM.
BKS, BCFKS, and UBER are also supported if the <a href="https://www.bouncycastle.org/">Bouncy Castle</a> library is present.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In production environments, server certificates should be signed by a trusted Certificate Authority, either Root or Intermediate CA.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the keystore that contains SSL/TLS identities for Infinispan Server to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan Server security realm.</p>
</li>
<li>
<p>Specify the keystore file name with the <code>path</code> attribute.</p>
</li>
<li>
<p>Provide the keystore password and certificate alias with the <code>keystore-password</code> and <code>alias</code> attributes.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Infinispan Server keystore configuration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;server-identities&gt;</span>
            <span class="tag">&lt;ssl&gt;</span>
               <span class="comment">&lt;!-- Adds a keystore that contains server certificates
                    that provide SSL/TLS identities to clients. --&gt;</span>
               <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.pfx</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rhdg-server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/ssl&gt;</span>
         <span class="tag">&lt;/server-identities&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PEM files can be used as keystores provided they contain a private key in PKCS#1 or PKCS#8 format and one
or more certificates. These keystores should be configured with an empty password: <code>password=""</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Configure clients with a trust store so they can verify SSL/TLS identities for Infinispan Server.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html#configuring-hotrod-encryption_hotrod-client-configuration">Configuring Hot Rod client encryption</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="generate_keystores-server"><a class="anchor" href="#generate_keystores-server"></a>7.1.1. Automatically Generating Keystores</h4>
<div class="paragraph">
<p>Configure Infinispan servers to automatically generate keystores at startup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatically generated keystores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Should not be used in production environments.</p>
</li>
<li>
<p>Are generated whenever necessary; for example, while obtaining the first connection from a client.</p>
</li>
<li>
<p>Contain certificates that you can use directly in Hot Rod clients.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Include the <code>generate-self-signed-certificate-host</code> attribute for the <code>keystore</code> element in the server configuration.</p>
</li>
<li>
<p>Specify a hostname for the server certificate as the value.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">SSL server identity with a generated keystore</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;server-identities&gt;</span>
            <span class="tag">&lt;ssl&gt;</span>
               <span class="comment">&lt;!-- Generates a keystore that includes a self-signed certificate with the specified hostname. --&gt;</span>
               <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.p12</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">generate-self-signed-certificate-host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/ssl&gt;</span>
         <span class="tag">&lt;/server-identities&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ssl-engine_server"><a class="anchor" href="#configuring-ssl-engine_server"></a>7.1.2. Configuring TLS versions and cipher suites</h4>
<div class="paragraph">
<p>When using SSL/TLS encryption to secure your deployment, you can configure Infinispan Server to use specific versions of the TLS protocol as well as specific cipher suites within the protocol.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>engine</code> element to the SSL configuration for Infinispan Server.</p>
</li>
<li>
<p>Configure Infinispan to use one or more TLS versions with the <code>enabled-protocols</code> attribute.</p>
<div class="paragraph">
<p>Infinispan Server supports TLS version 1.2 and 1.3 by default.
If appropriate you can set <code>TLSv1.3</code> only to restrict the security protocol for client connections.
Infinispan does not recommend enabling <code>TLSv1.1</code> because it is an older protocol with limited support and provides weak security.
You should never enable any version of TLS older than 1.1.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you modify the SSL <code>engine</code> configuration for Infinispan Server you must explicitly configure TLS versions with the <code>enabled-protocols</code> attribute.
Omitting the <code>enabled-protocols</code> attribute allows any TLS version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;engine</span> <span class="attribute-name">enabled-protocols</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.3 TLSv1.2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure Infinispan to use one or more cipher suites with the <code>enabled-ciphersuites</code> attribute.</p>
<div class="paragraph">
<p>You must ensure that you set a cipher suite that supports any protocol features you plan to use; for example <code>HTTP/2 ALPN</code>.</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">SSL engine configuration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span>
          <span class="content">https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;server-identities&gt;</span>
            <span class="tag">&lt;ssl&gt;</span>
               <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.p12</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
               <span class="comment">&lt;!-- Configures Infinispan Server to use specific TLS versions and cipher suites. --&gt;</span>
               <span class="tag">&lt;engine</span> <span class="attribute-name">enabled-protocols</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.3</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">enabled-ciphersuites</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TLS_AES_256_GCM_SHA384 TLS_AES_128_GCM_SHA256 TLS_AES_128_CCM_8_SHA256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/ssl&gt;</span>
         <span class="tag">&lt;/server-identities&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authentication_server"><a class="anchor" href="#configuring-client-certificate-authentication_server"></a>7.2. Configuring Client Certificate Authentication</h3>
<div class="paragraph">
<p>Configure Infinispan Server to use mutual TLS to secure client connections.</p>
</div>
<div class="paragraph">
<p>You can configure Infinispan to verify client identities from certificates in a trust store in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Require a trust store that contains only the signing certificate, which is typically a Certificate Authority (CA). Any client that presents a certificate signed by the CA can connect to Infinispan.</p>
</li>
<li>
<p>Require a trust store that contains all client certificates in addition to the signing certificate. Only clients that present a signed certificate that is present in the trust store can connect to Infinispan.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively to providing trust stores you can use shared system certificates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a client trust store that contains either the CA certificate or all public certificates.</p>
</li>
<li>
<p>Create a keystore for Infinispan Server and configure an SSL/TLS identity.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PEM files can be used as trust stores provided they contain one or more certificates.
These trust stores should be configured with an empty password: <code>password=""</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>require-ssl-client-auth="true"</code> parameter to your <code>endpoints</code> configuration.</p>
</li>
<li>
<p>Add the client trust store to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Specify the <code>path</code> and <code>password</code> attributes for the <code>truststore</code> element in the Infinispan Server security realm configuration.</p>
</li>
<li>
<p>Add the <code>&lt;truststore-realm/&gt;</code> element to the security realm if you want Infinispan Server to authenticate each client certificate.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Infinispan Server trust store realm configuration</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;security-realms&gt;</span>
    <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
          <span class="comment">&lt;!-- Provides an SSL/TLS identity with a keystore that
               contains server certificates. --&gt;</span>
          <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.p12</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="comment">&lt;!-- Configures a trust store that contains client certificates
               or part of a certificate chain. --&gt;</span>
          <span class="tag">&lt;truststore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trust.p12</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
      <span class="tag">&lt;/server-identities&gt;</span>
      <span class="comment">&lt;!-- Authenticates client certificates against the trust store. If you configure this, the trust store must contain the public certificates for all clients. --&gt;</span>
      <span class="tag">&lt;truststore-realm</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/security-realm&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span>
<span class="comment">&lt;!-- Configures Infinispan Server to require client certificates
     with the &quot;require-ssl-client-auth&quot; attribute. --&gt;</span>
<span class="tag">&lt;endpoints&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod-connector&gt;</span>
      <span class="comment">&lt;!-- Configures the Hot Rod endpoint for
           client certificate authentication. --&gt;</span>
      <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;sasl</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EXTERNAL</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authentication&gt;</span>
    <span class="tag">&lt;/hotrod-connector&gt;</span>
    <span class="tag">&lt;rest-connector&gt;</span>
      <span class="comment">&lt;!-- Configures the REST endpoint for
           client certificate authentication. --&gt;</span>
      <span class="tag">&lt;authentication</span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CLIENT_CERT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest-connector&gt;</span>
  <span class="tag">&lt;/endpoint&gt;</span>
<span class="tag">&lt;/endpoints&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Set up authorization with client certificates in the Infinispan Server configuration if you control access with security roles and permissions.</p>
</li>
<li>
<p>Configure clients to negotiate SSL/TLS connections with Infinispan Server.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../hotrod_java/hotrod_java.html#configuring-hotrod-encryption_hotrod-client-configuration">Configuring Hot Rod client encryption</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-shared-system-certificates">Using Shared System Certificates</a> (Red Hat Enterprise Linux 7 Security Guide)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authorization_server"><a class="anchor" href="#configuring-client-certificate-authorization_server"></a>7.3. Configuring Authorization with Client Certificates</h3>
<div class="paragraph">
<p>Enabling client certificate authentication means you do not need to specify Infinispan user credentials in client configuration, which means you must associate roles with the Common Name (CN) field in the client certificate(s).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide clients with a Java keystore that contains either their public certificates or part of the certificate chain, typically a public CA certificate.</p>
</li>
<li>
<p>Configure Infinispan Server to perform client certificate authentication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the <code>common-name-role-mapper</code> in the security authorization configuration.</p>
</li>
<li>
<p>Assign the Common Name (<code>CN</code>) from the client certificate a role with the appropriate permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">certificate-authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security&gt;</span>
     <span class="tag">&lt;authorization&gt;</span>
       <span class="comment">&lt;!-- Declare a role mapper that associates the common name (CN) field
            in client certificate trust stores with authorization roles. --&gt;</span>
       <span class="tag">&lt;common-name-role-mapper</span><span class="tag">/&gt;</span>
       <span class="comment">&lt;!-- In this example, if a client certificate contains `CN=Client1` then
            clients with matching certificates get ALL permissions. --&gt;</span>
       <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Client1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;/authorization&gt;</span>
   <span class="tag">&lt;/security&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kerberos-identity"><a class="anchor" href="#kerberos-identity"></a>8. Configuring Kerberos Identities for Infinispan Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provide Infinispan Server endpoints with Kerberos identities to secure connections with clients.</p>
</div>
<div class="sect2">
<h3 id="kerberos_identity-kerberos-identity"><a class="anchor" href="#kerberos_identity-kerberos-identity"></a>8.1. Setting Up Kerberos Identities</h3>
<div class="paragraph">
<p>Kerberos identities use <em>keytab</em> files that contain service principal names and encrypted keys, derived from Kerberos passwords.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>keytab</em> files can contain both user and service account principals. However,
Infinispan servers use service account principals only. As a result,
Infinispan servers can provide identity to clients and allow clients to
authenticate with Kerberos servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In most cases, you create unique principals for the Hot Rod and REST connectors. For example, you have a "datagrid" server in the "INFINISPAN.ORG" domain. In this case you should create the following service principals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hotrod/datagrid@INFINISPAN.ORG</code> identifies the Hot Rod service.</p>
</li>
<li>
<p><code>HTTP/datagrid@INFINISPAN.ORG</code> identifies the REST service.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create keytab files for the Hot Rod and REST services.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ ktutil
ktutil:  addent -password -p datagrid@INFINISPAN.ORG -k 1 -e aes256-cts
Password for datagrid@INFINISPAN.ORG: [enter your password]
ktutil:  wkt http.keytab
ktutil:  quit</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ ktpass -princ HTTP/datagrid@INFINISPAN.ORG -pass * -mapuser INFINISPAN\USER_NAME
$ ktab -k http.keytab -a HTTP/datagrid@INFINISPAN.ORG</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Copy the keytab files to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add a <code>server-identities</code> definition to the Infinispan server security realm.</p>
</li>
<li>
<p>Specify the location of keytab files that provide service principals to Hot Rod and REST connectors.</p>
</li>
<li>
<p>Name the Kerberos service principals.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="kerberos_identity_config-kerberos-identity"><a class="anchor" href="#kerberos_identity_config-kerberos-identity"></a>8.2. Kerberos Identity Configuration</h3>
<div class="paragraph">
<p>The following example configures Kerberos identities for Infinispan Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;server-identities&gt;</span>
            <span class="comment">&lt;!-- Specifies a keytab file that provides a Kerberos identity for the Hot Rod connector. --&gt;</span>
            <span class="comment">&lt;!-- Names the Kerberos service principal for the Hot Rod connector. --&gt;</span>
            <span class="comment">&lt;!-- The required=&quot;true&quot; attribute specifies that the keytab file must be present when the server starts. --&gt;</span>
            <span class="tag">&lt;kerberos</span> <span class="attribute-name">keytab-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod.keytab</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod/datagrid@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="comment">&lt;!-- Specifies a keytab file that provides a Kerberos identity for the REST connector. --&gt;</span>
            <span class="comment">&lt;!-- Names the Kerberos service principal for the REST connector. --&gt;</span>
            <span class="tag">&lt;kerberos</span> <span class="attribute-name">keytab-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http.keytab</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/localhost@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/server-identities&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_credentials"><a class="anchor" href="#server_credentials"></a>9. Storing Infinispan Server Credentials in Keystores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External services require credentials to authenticate with Infinispan Server.
To protect sensitive text strings such as passwords, add them to a credential keystore rather than directly in Infinispan Server configuration files.</p>
</div>
<div class="paragraph">
<p>You can then configure Infinispan Server to decrypt passwords for establishing connections with services such as databases or LDAP directories.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Plain-text passwords in <code>$ISPN_HOME/server/conf</code> are unencrypted.
Any user account with read access to the host filesystem can view plain-text passwords.</p>
</div>
<div class="paragraph">
<p>While credential keystores are password-protected store encrypted passwords, any user account with write access to the host filesystem can tamper with the keystore itself.</p>
</div>
<div class="paragraph">
<p>To completely secure Infinispan Server credentials, you should grant read-write access only to user accounts that can configure and run Infinispan Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ssl_identity-credential-keystore"><a class="anchor" href="#ssl_identity-credential-keystore"></a>9.1. Setting Up Credential Keystores</h3>
<div class="paragraph">
<p>Create keystores that encrypt credential for Infinispan Server access.</p>
</div>
<div class="paragraph">
<p>A credential keystore contains at least one alias that is associated with an encrypted password.
After you create a keystore, you specify the alias in a connection configuration such as a database connection pool.
Infinispan Server then decrypts the password for that alias from the keystore when the service attempts authentication.</p>
</div>
<div class="paragraph">
<p>You can create as many credential keystores with as many aliases as required.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Create a keystore and add credentials to it with the <code class="command">credentials</code> command.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, keystores are of type PKCS12.
Run <code class="command">help credentials</code> for details on changing keystore defaults.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to create a keystore that contains an alias of "dbpassword" for the password "changeme".
When you create a keystore you also specify a password for the keystore with the <code>-p</code> argument.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh credentials add dbpassword -c changeme -p &quot;secret1234!&quot;</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin\cli.bat credentials add dbpassword -c changeme -p &quot;secret1234!&quot;</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Check that the alias is added to the keystore.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh credentials ls -p &quot;secret1234!&quot;
dbpassword</code></pre>
</div>
</div>
</li>
<li>
<p>Configure Infinispan to use the credential keystore.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify the name and location of the credential keystore in the <code>credential-stores</code> configuration.</p>
</li>
<li>
<p>Provide the credential keystore and alias in the <code>credential-reference</code> configuration.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Attributes in the <code>credential-reference</code> configuration are optional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>store</code> is required only if you have multiple keystores.</p>
</li>
<li>
<p><code>alias</code> is required only if the keystore contains multiple aliases.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../server/server.html#server_credentials-credential-keystore">Credential Keystore Configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="server_credentials-credential-keystore"><a class="anchor" href="#server_credentials-credential-keystore"></a>9.2. Credential Keystore Configuration</h3>
<div class="paragraph">
<p>Review example configurations for credential keystores in Infinispan Server configuration.</p>
</div>
<h4 id="credential_keystore" class="discrete">Credential keystore</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="comment">&lt;!-- Uses a keystore to manage server credentials. --&gt;</span>
   <span class="tag">&lt;credential-stores&gt;</span>
      <span class="comment">&lt;!-- Specifies the name and filesystem location of a keystore. --&gt;</span>
      <span class="tag">&lt;credential-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials.pfx</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Specifies the password for the credential keystore. --&gt;</span>
         <span class="tag">&lt;clear-text-credential</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret1234!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/credential-store&gt;</span>
   <span class="tag">&lt;/credential-stores&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">credential-stores</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">credentials.pfx</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">clear-text-credential</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">clear-text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret1234!</span><span class="delimiter">&quot;</span></span>
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">credentialStores</span>:
    - <span class="string"><span class="content">name: credentials</span></span>
      <span class="key">path</span>: <span class="string"><span class="content">credentials.pfx</span></span>
      <span class="key">clearTextCredential</span>:
        <span class="key">clearText</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret1234!</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<h4 id="datasource_connection" class="discrete">Datasource connection</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;data-sources</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;data-source</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/postgres</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Specifies the database username in the connection factory. --&gt;</span>
      <span class="tag">&lt;connection-factory</span> <span class="attribute-name">driver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dbuser</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${org.infinispan.server.test.postgres.jdbcUrl}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Specifies the credential keystore that contains an encrypted password and the alias for it. --&gt;</span>
         <span class="tag">&lt;credential-reference</span> <span class="attribute-name">store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dbpassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/connection-factory&gt;</span>
      <span class="tag">&lt;connection-pool</span> <span class="attribute-name">max-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">background-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">idle-removal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">leak-detection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/data-source&gt;</span>
<span class="tag">&lt;/data-sources&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">data-sources</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jndi-name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/postgres</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">connection-factory</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">driver</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbuser</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${org.infinispan.server.test.postgres.jdbcUrl}</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">credential-reference</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">alias</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbpassword</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">data-sources</span>:
  - <span class="string"><span class="content">name: postgres</span></span>
    <span class="key">jndiName</span>: <span class="string"><span class="content">jdbc/postgres</span></span>
    <span class="key">connectionFactory</span>:
      <span class="key">driver</span>: <span class="string"><span class="content">org.postgresql.Driver</span></span>
      <span class="key">username</span>: <span class="string"><span class="content">dbuser</span></span>
      <span class="key">url</span>: <span class="string"><span class="content">'${org.infinispan.server.test.postgres.jdbcUrl}'</span></span>
      <span class="key">credentialReference</span>:
        <span class="key">store</span>: <span class="string"><span class="content">credentials</span></span>
        <span class="key">alias</span>: <span class="string"><span class="content">dbpassword</span></span></code></pre>
</div>
</div>
<h4 id="ldap_connection" class="discrete">LDAP connection</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;credential-stores&gt;</span>
      <span class="tag">&lt;credential-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials.pfx</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;clear-text-credential</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret1234!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/credential-store&gt;</span>
   <span class="tag">&lt;/credential-stores&gt;</span>
   <span class="tag">&lt;security-realms&gt;</span>
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Specifies the LDAP principal in the connection factory. --&gt;</span>
         <span class="tag">&lt;ldap-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://my-ldap-server:10389</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- Specifies the credential keystore that contains an encrypted password and the alias for it. --&gt;</span>
            <span class="tag">&lt;credential-reference</span> <span class="attribute-name">store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldappassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/ldap-realm&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
   <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">credential-stores</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">credentials.pfx</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">clear-text-credential</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">clear-text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret1234!</span><span class="delimiter">&quot;</span></span>
        }
      }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security-realms</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ldap</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://my-ldap-server:10389</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=People,dc=infinispan,dc=org</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">credential-reference</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">alias</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ldappassword</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">security</span>:
  <span class="key">credentialStores</span>:
    - <span class="string"><span class="content">name: credentials</span></span>
      <span class="key">path</span>: <span class="string"><span class="content">credentials.pfx</span></span>
      <span class="key">clearTextCredential</span>:
        <span class="key">clearText</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">secret1234!</span><span class="delimiter">&quot;</span></span>
  <span class="key">security-realms</span>:
    - <span class="string"><span class="content">name: &quot;default&quot;</span></span>
      <span class="key">ldapRealm</span>:
        <span class="key">name</span>: <span class="string"><span class="content">ldap</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">'ldap://my-ldap-server:10389'</span></span>
        <span class="key">principal</span>: <span class="string"><span class="content">'uid=admin,ou=People,dc=infinispan,dc=org'</span></span>
        <span class="key">credentialReference</span>:
          <span class="key">store</span>: <span class="string"><span class="content">credentials</span></span>
          <span class="key">alias</span>: <span class="string"><span class="content">ldappassword</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authorization"><a class="anchor" href="#authorization"></a>10. Configuring User Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authorization is a security feature that requires users to have certain permissions before they can access caches or interact with Infinispan resources.
You assign roles to users that provide different levels of permissions, from read-only access to full, super user privileges.</p>
</div>
<div class="sect2">
<h3 id="enabling-authz-authz"><a class="anchor" href="#enabling-authz-authz"></a>10.1. Enabling Authorization in Cache Configuration</h3>
<div class="paragraph">
<p>Use authorization in your cache configuration to restrict user access.
Before they can read or write cache entries, or create and delete caches, users must have a role with a sufficient level of permission.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your <code>infinispan.xml</code> configuration for editing.</p>
</li>
<li>
<p>If it is not already declared, add the <code>&lt;authorization /&gt;</code> tag inside the <code>security</code> elements for the <code>cache-container</code>.</p>
<div class="paragraph">
<p>This enables authorization for the Cache Manager and provides a global set of roles and permissions that caches can inherit.</p>
</div>
</li>
<li>
<p>Add the <code>&lt;authorization /&gt;</code> tag to each cache for which Infinispan restricts access based on user roles.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following configuration example shows how to use implicit authorization configuration with default roles and permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rbac-cache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restricted</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security&gt;</span>
      <span class="comment">&lt;!-- Enable authorization with the default roles and permissions. --&gt;</span>
      <span class="tag">&lt;authorization</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rbac-cache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="comment">&lt;!-- Inherit authorization settings from the cache-container. --&gt;</span>
        <span class="tag">&lt;authorization</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-roles-permissions_authz"><a class="anchor" href="#user-roles-permissions_authz"></a>10.2. User roles and permissions</h3>
<div class="paragraph">
<p>Infinispan includes a default set of roles that grant users with permissions to access data and interact with Infinispan resources.</p>
</div>
<div class="paragraph">
<p><code>ClusterRoleMapper</code> is the default mechanism that Infinispan uses to associate security principals to authorization roles.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>ClusterRoleMapper</code> matches principal names to role names.
A user named <code>admin</code> gets <code>admin</code> permissions automatically, a user named <code>deployer</code> gets <code>deployer</code> permissions, and so on.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superuser with all permissions including control of the Cache Manager lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR, CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and delete Infinispan resources in addition to <code>application</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read and write access to Infinispan resources in addition to <code>observer</code> permissions. Can also listen to events and execute server tasks and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>observer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read access to Infinispan resources in addition to <code>monitor</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view statistics via JMX and the <code>metrics</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs">org.infinispan.security.AuthorizationPermission Enumeration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con_authz-authz"><a class="anchor" href="#con_authz-authz"></a>10.3. How Security Authorization Works</h3>
<div class="paragraph">
<p>Infinispan authorization secures your installation by restricting user access.</p>
</div>
<div class="paragraph">
<p>User applications or clients must belong to a role that is assigned with sufficient permissions before they can perform operations on Cache Managers or caches.</p>
</div>
<div class="paragraph">
<p>For example, you configure authorization on a specific cache instance so that invoking <code>Cache.get()</code> requires an identity to be assigned a role with read permission while <code>Cache.put()</code> requires a role with write permission.</p>
</div>
<div class="paragraph">
<p>In this scenario, if a user application or client with the <code>io</code> role attempts to write an entry, Infinispan denies the request and throws a security exception.
If a user application or client with the <code>writer</code> role sends a write request, Infinispan validates authorization and issues a token for subsequent operations.</p>
</div>
<div class="paragraph">
<div class="title">Identities</div>
<p>Identities are security Principals of type <code>java.security.Principal</code>.
Subjects, implemented with the <code>javax.security.auth.Subject</code> class, represent a group of security Principals.
In other words, a Subject represents a user and all groups to which it belongs.</p>
</div>
<div class="paragraph">
<div class="title">Identities to roles</div>
<p>Infinispan uses role mappers so that security principals correspond to roles,
which you assign one or more permissions.</p>
</div>
<div class="paragraph">
<p>The following image illustrates how security principals correspond to roles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/SecurityRolesPermissions.svg" alt="Roles/Permissions mapping">
</div>
</div>
<div class="sect3">
<h4 id="user-permissions_authz"><a class="anchor" href="#user-permissions_authz"></a>10.3.1. Permissions</h4>
<div class="paragraph">
<p>Authorization roles have different permissions with varying levels of access to Infinispan.
Permissions let you restrict user access to both Cache Managers and caches.</p>
</div>
<div class="sect4">
<h5 id="cache_manager_permissions"><a class="anchor" href="#cache_manager_permissions"></a>Cache Manager permissions</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Permission</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIGURATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defineConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines new cache configurations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stops the Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCache</code>, <code>removeCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and remove container resources  such as caches, counters, schemas, and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all Cache Manager permissions.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cache_permissions"><a class="anchor" href="#cache_permissions"></a>Cache permissions</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Permission</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>contains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves entries from a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put</code>, <code>putIfAbsent</code>, <code>replace</code>, <code>remove</code>, <code>evict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes, replaces, removes, evicts data in a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distexec</code>, <code>streams</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows code execution against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keySet</code>, <code>values</code>, <code>entrySet</code>, <code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk retrieve operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clear</code>, <code>putAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk write operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code>, <code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts and stops a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getVersion</code>, <code>addInterceptor*</code>, <code>removeInterceptor</code>, <code>getInterceptorChain</code>, <code>getEvictionManager</code>, <code>getComponentRegistry</code>, <code>getDistributionManager</code>, <code>getAuthorizationManager</code>, <code>evict</code>, <code>getRpcManager</code>, <code>getCacheConfiguration</code>, <code>getCacheManager</code>, <code>getInvocationContextContainer</code>, <code>setAvailability</code>, <code>getDataContainer</code>, <code>getStats</code>, <code>getXAResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to underlying components and internal structures.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all cache permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the READ and BULK_READ permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the WRITE and BULK_WRITE permissions.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="role-mappers_authz"><a class="anchor" href="#role-mappers_authz"></a>10.3.2. Role Mappers</h4>
<div class="paragraph">
<p>Infinispan includes a <code>PrincipalRoleMapper</code> API that maps security Principals in a Subject to authorization roles that you can assign to users.</p>
</div>
<div class="sect4">
<h5 id="cluster_role_mappers"><a class="anchor" href="#cluster_role_mappers"></a>Cluster role mappers</h5>
<div class="paragraph">
<p><code>ClusterRoleMapper</code> uses a persistent replicated cache to dynamically store principal-to-role mappings for the default roles and permissions.</p>
</div>
<div class="paragraph">
<p>By default uses the Principal name as the role name and implements <code>org.infinispan.security.MutableRoleMapper</code> which exposes methods to change role mappings at runtime.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java class: <code>org.infinispan.security.mappers.ClusterRoleMapper</code></p>
</li>
<li>
<p>Declarative configuration: <code>&lt;cluster-role-mapper /&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="identity_role_mappers"><a class="anchor" href="#identity_role_mappers"></a>Identity role mappers</h5>
<div class="paragraph">
<p><code>IdentityRoleMapper</code> uses the Principal name as the role name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java class: <code>org.infinispan.security.mappers.IdentityRoleMapper</code></p>
</li>
<li>
<p>Declarative configuration: <code>&lt;identity-role-mapper /&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="commonname_role_mappers"><a class="anchor" href="#commonname_role_mappers"></a>CommonName role mappers</h5>
<div class="paragraph">
<p><code>CommonNameRoleMapper</code> uses the Common Name (CN) as the role name if the
Principal name is a Distinguished Name (DN).</p>
</div>
<div class="paragraph">
<p>For example this DN, <code>cn=managers,ou=people,dc=example,dc=com</code>, maps to the <code>managers</code> role.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java class: <code>org.infinispan.security.mappers.CommonRoleMapper</code></p>
</li>
<li>
<p>Declarative configuration: <code>&lt;common-name-role-mapper /&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="custom_role_mappers"><a class="anchor" href="#custom_role_mappers"></a>Custom role mappers</h5>
<div class="paragraph">
<p>Custom role mappers are implementations of <code>org.infinispan.security.PrincipalRoleMapper</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative configuration: <code>&lt;custom-role-mapper class="my.custom.RoleMapper" /&gt;</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/PrincipalRoleMapper.html">org.infinispan.security.PrincipalRoleMapper</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acl-cache_authz"><a class="anchor" href="#acl-cache_authz"></a>10.4. Access Control List (ACL) Cache</h3>
<div class="paragraph">
<p>Infinispan caches roles that you grant to users internally for optimal performance.
Whenever you grant or deny roles to users, Infinispan flushes the ACL cache to ensure user permissions are applied correctly.</p>
</div>
<div class="paragraph">
<p>If necessary, you can disable the ACL cache or configure it with the <code>cache-size</code> and <code>cache-timeout</code> attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">cache-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;authorization</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="customizing-authorization_authz"><a class="anchor" href="#customizing-authorization_authz"></a>10.5. Customizing Roles and Permissions</h3>
<div class="paragraph">
<p>You can customize authorization settings in your Infinispan configuration to use role mappers with different combinations of roles and permissions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your <code>infinispan.xml</code> configuration for editing.</p>
</li>
<li>
<p>Configure authorization for the <code>cache-container</code> by declaring a role mapper and a set of roles and permissions.</p>
</li>
<li>
<p>Configure authorization for caches to restrict access based on user roles.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following configuration example shows how to configure security authorization with roles and permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restricted</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom-authorization</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security&gt;</span>
      <span class="tag">&lt;authorization&gt;</span>
        <span class="comment">&lt;!-- Declare a role mapper that associates a security principal
             to each role. --&gt;</span>
        <span class="tag">&lt;identity-role-mapper</span> <span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- Specify user roles and corresponding permissions. --&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">WRITE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supervisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ WRITE EXEC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authorization&gt;</span>
    <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">implicit-authorization</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="comment">&lt;!-- Inherit roles and permissions from the cache-container. --&gt;</span>
        <span class="tag">&lt;authorization</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restricted</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="comment">&lt;!-- Explicitly define which roles can access the cache. --&gt;</span>
        <span class="tag">&lt;authorization</span> <span class="attribute-name">roles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin supervisor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disabling-authorization_authz"><a class="anchor" href="#disabling-authorization_authz"></a>10.6. Disabling Security Authorization</h3>
<div class="paragraph">
<p>In local development environments you can disable authorization so that users do not need roles and permissions.
Disabling security authorization means that any user can access data and interact with Infinispan resources.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your <code>infinispan.xml</code> configuration for editing.</p>
</li>
<li>
<p>Remove any <code>authorization</code> elements from the <code>security</code> configuration for the <code>cache-container</code> and each cache configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authorization_authz"><a class="anchor" href="#configuring-client-certificate-authorization_authz"></a>10.7. Configuring Authorization with Client Certificates</h3>
<div class="paragraph">
<p>Enabling client certificate authentication means you do not need to specify Infinispan user credentials in client configuration, which means you must associate roles with the Common Name (CN) field in the client certificate(s).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide clients with a Java keystore that contains either their public certificates or part of the certificate chain, typically a public CA certificate.</p>
</li>
<li>
<p>Configure Infinispan Server to perform client certificate authentication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the <code>common-name-role-mapper</code> in the security authorization configuration.</p>
</li>
<li>
<p>Assign the Common Name (<code>CN</code>) from the client certificate a role with the appropriate permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">certificate-authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security&gt;</span>
     <span class="tag">&lt;authorization&gt;</span>
       <span class="comment">&lt;!-- Declare a role mapper that associates the common name (CN) field
            in client certificate trust stores with authorization roles. --&gt;</span>
       <span class="tag">&lt;common-name-role-mapper</span><span class="tag">/&gt;</span>
       <span class="comment">&lt;!-- In this example, if a client certificate contains `CN=Client1` then
            clients with matching certificates get ALL permissions. --&gt;</span>
       <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Client1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;/authorization&gt;</span>
   <span class="tag">&lt;/security&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster-transport"><a class="anchor" href="#cluster-transport"></a>11. Setting up Infinispan cluster transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan requires a transport layer so nodes can automatically join and leave clusters.
The transport layer also enables Infinispan nodes to replicate or distribute data across the network and perform operations such as re-balancing and state transfer.</p>
</div>
<div class="sect2">
<h3 id="default-jgroups-stacks_cluster-transport"><a class="anchor" href="#default-jgroups-stacks_cluster-transport"></a>11.1. Default JGroups stacks</h3>
<div class="paragraph">
<p>Infinispan provides default JGroups stack files, <code>default-jgroups-*.xml</code>, in the <code>default-configs</code> directory inside the <code>infinispan-core-13.0.4.Final.jar</code> file.</p>
</div>
<div class="paragraph">
<p>You can find this JAR file in the <code>$ISPN_HOME/lib</code> directory.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File name</th>
<th class="tableblock halign-left valign-top">Stack name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-udp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>udp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses UDP for transport and UDP multicast for discovery. Suitable for larger clusters (over 100 nodes) or if you are using replicated caches or invalidation mode. Minimizes the number of open sockets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-tcp.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and the <code>MPING</code> protocol for discovery, which uses
<code>UDP</code> multicast. Suitable for smaller clusters (under 100 nodes) <em>only if</em> you are using distributed caches because TCP is more efficient than UDP as a point-to-point protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-kubernetes.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>DNS_PING</code> for discovery. Suitable for Kubernetes and Red Hat OpenShift nodes where UDP multicast is not always available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ec2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>NATIVE_S3_PING</code> for discovery. Suitable for Amazon EC2 nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>GOOGLE_PING2</code> for discovery. Suitable for Google Cloud Platform nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses TCP for transport and <code>AZURE_PING</code> for discovery. Suitable for Microsoft Azure nodes where UDP multicast is not available. Requires additional dependencies.</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#protlist">JGroups Protocols</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cluster-discovery-protocols_cluster-transport"><a class="anchor" href="#cluster-discovery-protocols_cluster-transport"></a>11.2. Cluster discovery protocols</h3>
<div class="paragraph">
<p>Infinispan supports different protocols that allow nodes to automatically find each other on the network and form clusters.</p>
</div>
<div class="paragraph">
<p>There are two types of discovery mechanisms that Infinispan can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generic discovery protocols that work on most networks and do not rely on external services.</p>
</li>
<li>
<p>Discovery protocols that rely on external services to store and retrieve topology information for Infinispan clusters.<br>
For instance the DNS_PING protocol performs discovery through DNS server records.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Running Infinispan on hosted platforms requires using discovery mechanisms that are adapted to network constraints that individual cloud providers impose.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#DiscoveryProtocols">JGroups Discovery Protocols</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="discovery-ping_cluster-transport"><a class="anchor" href="#discovery-ping_cluster-transport"></a>11.2.1. PING</h4>
<div class="paragraph">
<p>PING, or UDPPING is a generic JGroups discovery mechanism that uses dynamic multicasting with the UDP protocol.</p>
</div>
<div class="paragraph">
<p>When joining, nodes send PING requests to an IP multicast address to discover other nodes already in the Infinispan cluster.
Each node responds to the PING request with a packet that contains the address of the coordinator node and its own address. C=coordinator’s address and A=own address.
If no nodes respond to the PING request, the joining node becomes the coordinator node in a new cluster.</p>
</div>
<div class="listingblock">
<div class="title">PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;PING</span> <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#PING">JGroups PING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-tcpping_cluster-transport"><a class="anchor" href="#discovery-tcpping_cluster-transport"></a>11.2.2. TCPPING</h4>
<div class="paragraph">
<p>TCPPING is a generic JGroups discovery mechanism that uses a list of static addresses for cluster members.</p>
</div>
<div class="paragraph">
<p>With TCPPING, you manually specify the IP address or hostname of each node in the Infinispan cluster as part of the JGroups stack, rather than letting nodes discover each other dynamically.</p>
</div>
<div class="listingblock">
<div class="title">TCPPING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;TCPPING</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.tcpping.initial_hosts:hostname1[port1],hostname2[port2]}</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="attribute-name">num_initial_members</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#TCPPING_Prot">JGroups TCPPING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-mping_cluster-transport"><a class="anchor" href="#discovery-mping_cluster-transport"></a>11.2.3. MPING</h4>
<div class="paragraph">
<p>MPING uses IP multicast to discover the initial membership of Infinispan clusters.</p>
</div>
<div class="paragraph">
<p>You can use MPING to replace TCPPING discovery with TCP stacks and use multicasing for discovery instead of static lists of initial hosts.
However, you can also use MPING with UDP stacks.</p>
</div>
<div class="listingblock">
<div class="title">MPING configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;MPING</span> <span class="attribute-name">mcast_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mcast_addr:228.6.7.8}</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">mcast_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mcast_port:46655}</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">ip_ttl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.ip_ttl:2}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#MPING">JGroups MPING</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-tcp-gossip_cluster-transport"><a class="anchor" href="#discovery-tcp-gossip_cluster-transport"></a>11.2.4. TCPGOSSIP</h4>
<div class="paragraph">
<p>Gossip routers provide a centralized location on the network from which your
Infinispan cluster can retrieve addresses of other nodes.</p>
</div>
<div class="paragraph">
<p>You inject the address (<code>IP:PORT</code>) of the Gossip router into Infinispan nodes as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass the address as a system property to the JVM; for example, <code>-DGossipRouterAddress="10.10.2.4[12001]"</code>.</p>
</li>
<li>
<p>Reference that system property in the JGroups configuration file.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Gossip router configuration example</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;TCPGOSSIP</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${GossipRouterAddress}</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">num_initial_members</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#TCPGOSSIP_Prot">JGroups Gossip Router</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-jdbcping_cluster-transport"><a class="anchor" href="#discovery-jdbcping_cluster-transport"></a>11.2.5. JDBC_PING</h4>
<div class="paragraph">
<p>JDBC_PING uses shared databases to store information about Infinispan clusters.
This protocol supports any database that can use a JDBC connection.</p>
</div>
<div class="paragraph">
<p>Nodes write their IP addresses to the shared database so joining nodes can find the Infinispan cluster on the network.
When nodes leave Infinispan clusters, they delete their IP addresses from the shared database.</p>
</div>
<div class="listingblock">
<div class="title">JDBC_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;JDBC_PING</span> <span class="attribute-name">connection_url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/database_name</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connection_username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connection_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connection_driver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Add the appropriate JDBC driver to the classpath so Infinispan can use JDBC_PING.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#_jdbc_ping">JDBC_PING</a></p>
</li>
<li>
<p><a href="http://community.jboss.org/wiki/JDBCPING">JDBC_PING Wiki</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="discovery-dns-ping_cluster-transport"><a class="anchor" href="#discovery-dns-ping_cluster-transport"></a>11.2.6. DNS_PING</h4>
<div class="paragraph">
<p>JGroups DNS_PING queries DNS servers to discover Infinispan cluster members
in Kubernetes environments such as OKD and Red Hat OpenShift.</p>
</div>
<div class="listingblock">
<div class="title">DNS_PING configuration example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dns.DNS_PING</span> <span class="attribute-name">dns_query</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myservice.myproject.svc.cluster.local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#_dns_ping">JGroups DNS_PING</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a> (Kubernetes documentation for adding DNS entries)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-cloud-discovery-protocols_cluster-transport"><a class="anchor" href="#jgroups-cloud-discovery-protocols_cluster-transport"></a>11.2.7. Cloud discovery protocols</h4>
<div class="paragraph">
<p>Infinispan includes default JGroups stacks that use discovery protocol implementations that are specific to cloud providers.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Discovery protocol</th>
<th class="tableblock halign-left valign-top">Default stack file</th>
<th class="tableblock halign-left valign-top">Artifact</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NATIVE_S3_PING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-ec2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.aws.s3:native-s3-ping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0.0.Final</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GOOGLE_PING2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-google.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.google:jgroups-google</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0.0.Final</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AZURE_PING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-jgroups-azure.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jgroups.azure:jgroups-azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.0.Final</code></p></td>
</tr>
</tbody>
</table>
<h5 id="providing_dependencies_for_cloud_discovery_protocols" class="discrete">Providing dependencies for cloud discovery protocols</h5>
<div class="paragraph">
<p>To use <code>NATIVE_S3_PING</code>, <code>GOOGLE_PING2</code>, or <code>AZURE_PING</code> cloud discovery protocols, you need to provide dependent libraries to Infinispan.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the artifact JAR file and all dependencies.</p>
</li>
<li>
<p>Add the artifact JAR file and all dependencies to the <code>$ISPN_HOME/server/lib</code> directory of your Infinispan Server installation.</p>
<div class="paragraph">
<p>For more details see the <a href="https://access.redhat.com/solutions/6048651">Downloading artifacts for JGroups cloud discover protocols for Data Grid Server</a> ({RedHat} knowledgebase article)</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can then configure the cloud discovery protocol as part of a JGroups stack file or with system properties.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/jgroups-extras/native-s3-ping">JGroups NATIVE_S3_PING</a></p>
</li>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-google">JGroups GOOGLE_PING2</a></p>
</li>
<li>
<p><a href="https://github.com/jgroups-extras/jgroups-azure">JGroups AZURE_PING</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jgroups-default-stacks_cluster-transport"><a class="anchor" href="#using-jgroups-default-stacks_cluster-transport"></a>11.3. Using the default JGroups stacks</h3>
<div class="paragraph">
<p>Infinispan uses JGroups protocol stacks so nodes can send each other messages on dedicated cluster channels.</p>
</div>
<div class="paragraph">
<p>Infinispan provides preconfigured JGroups stacks for <code>UDP</code> and <code>TCP</code> protocols.
You can use these default stacks as a starting point for building custom cluster transport configuration that is optimized for your network requirements.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Do one of the following to use one of the default JGroups stacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>stack</code> attribute in your <code>infinispan.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Use the default UDP stack for cluster transport. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>cluster-stack</code> argument to set the JGroups stack file when Infinispan Server starts:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="sh">$ bin/server.sh --cluster-stack=udp</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan logs the following message to indicate which stack it uses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack udp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-jgroups-stacks_cluster-transport"><a class="anchor" href="#customizing-jgroups-stacks_cluster-transport"></a>11.4. Customizing JGroups stacks</h3>
<div class="paragraph">
<p>Adjust and tune properties to create a cluster transport configuration that works for your network requirements.</p>
</div>
<div class="paragraph">
<p>Infinispan provides attributes that let you extend the default JGroups stacks for easier configuration.
You can inherit properties from the default stacks while combining, removing, and replacing other properties.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new JGroups stack declaration in your <code>infinispan.xml</code> file.</p>
</li>
<li>
<p>Add the <code>extends</code> attribute and specify a JGroups stack to inherit properties from.</p>
</li>
<li>
<p>Use the <code>stack.combine</code> attribute to modify properties for protocols configured in the inherited stack.</p>
</li>
<li>
<p>Use the <code>stack.position</code> attribute to define the location for your custom stack.</p>
</li>
<li>
<p>Specify the stack name as the value for the <code>stack</code> attribute in the <code>transport</code> configuration.</p>
<div class="paragraph">
<p>For example, you might evaluate using a Gossip router and symmetric encryption with the default TCP stack as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a custom JGroups stack named &quot;my-stack&quot;. --&gt;</span>
    <span class="comment">&lt;!-- Inherits properties from the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-stack</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Uses TCPGOSSIP as the discovery mechanism instead of MPING --&gt;</span>
      <span class="tag">&lt;TCPGOSSIP</span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.tunnel.gossip_router_hosts:localhost[12001]}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPLACE</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Removes the FD_SOCK protocol from the stack. --&gt;</span>
      <span class="tag">&lt;FD_SOCK</span> <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Modifies the timeout value for the VERIFY_SUSPECT protocol. --&gt;</span>
      <span class="tag">&lt;VERIFY_SUSPECT</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Adds SYM_ENCRYPT to the stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SYM_ENCRYPT</span> <span class="attribute-name">sym_algorithm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AES</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mykeystore.p12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">store_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">key_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
    <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Uses &quot;my-stack&quot; for cluster transport. --&gt;</span>
      <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-stack</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Check Infinispan logs to ensure it uses the stack.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack my-stack</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="jgroups-inheritance-attributes_cluster-transport"><a class="anchor" href="#jgroups-inheritance-attributes_cluster-transport"></a>11.4.1. Inheritance attributes</h4>
<div class="paragraph">
<p>When you extend a JGroups stack, inheritance attributes let you adjust protocols and properties in the stack you are extending.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>stack.position</code> specifies protocols to modify.</p>
</li>
<li>
<p><code>stack.combine</code> uses the following values to extend JGroups stacks:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMBINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides protocol properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPLACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaces protocols.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a protocol into the stack after another protocol.
Does not affect the protocol that you specify as the insertion point.</p>
<p class="tableblock">Protocols in JGroups stacks affect each other based on their location in the stack.
For example, you should put a protocol such as <code>NAKACK2</code> after the <code>SYM_ENCRYPT</code> or <code>ASYM_ENCRYPT</code> protocol so that <code>NAKACK2</code> is secured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT_BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a protocols into the stack before another protocol.
Affects the protocol that you specify as the insertion point.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REMOVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes protocols from the stack.</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jgroups-system-properties_cluster-transport"><a class="anchor" href="#using-jgroups-system-properties_cluster-transport"></a>11.5. Using JGroups system properties</h3>
<div class="paragraph">
<p>Pass system properties to Infinispan at startup to tune cluster transport.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use <code>-D&lt;property-name&gt;=&lt;property-value&gt;</code> arguments to set JGroups system properties as required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, set a custom bind port and IP address as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh -Djgroups.bind.port=1234 -Djgroups.bind.address=192.0.2.0</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-system-properties_cluster-transport"><a class="anchor" href="#jgroups-system-properties_cluster-transport"></a>11.5.1. Cluster transport properties</h4>
<div class="paragraph">
<p>Use the following properties to customize JGroups cluster transport.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.bind.address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind address for cluster transport.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SITE_LOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.bind.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind port for the socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.mcast_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for multicast, both discovery and inter-cluster communication. The IP address must be a valid "class D" address that is suitable for IP multicast.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>228.6.7.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.mcast_port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the multicast socket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.ip_ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time-to-live (TTL) for IP multicast packets. The value defines the number of network hops a packet can make before it is dropped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_pool.min_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of threads for the thread pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_pool.max_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of threads for the thread pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.join_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of milliseconds to wait for join requests to succeed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.thread_dumps_threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times a thread pool needs to be full before a thread dump is logged.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#SystemProperties">JGroups system properties</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#protlist">JGroups protocol list</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-extras-properties_cluster-transport"><a class="anchor" href="#jgroups-extras-properties_cluster-transport"></a>11.5.2. System properties for cloud discovery protocols</h4>
<div class="paragraph">
<p>Use the following properties to configure JGroups discovery protocols for hosted platforms.</p>
</div>
<div class="sect4">
<h5 id="amazon_ec2"><a class="anchor" href="#amazon_ec2"></a>Amazon EC2</h5>
<div class="paragraph">
<p>System properties for configuring <code>NATIVE_S3_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.region_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 region.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.s3.bucket_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Amazon S3 bucket. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="google_cloud_platform"><a class="anchor" href="#google_cloud_platform"></a>Google Cloud Platform</h5>
<div class="paragraph">
<p>System properties for configuring <code>GOOGLE_PING2</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.google.bucket_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Google Compute Engine bucket. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="azure"><a class="anchor" href="#azure"></a>Azure</h5>
<div class="paragraph">
<p>System properties for <code>AZURE_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.storage_account_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure storage account. The name must exist and be unique.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.storage_access_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure storage access key.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jboss.jgroups.azure_ping.container</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid DNS name of the container that stores ping information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="kubernetes"><a class="anchor" href="#kubernetes"></a>Kubernetes</h5>
<div class="paragraph">
<p>System properties for <code>DNS_PING</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required/Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jgroups.dns.query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the DNS record that returns cluster members.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No default value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-inline-jgroups-stacks_cluster-transport"><a class="anchor" href="#using-inline-jgroups-stacks_cluster-transport"></a>11.6. Using inline JGroups stacks</h3>
<div class="paragraph">
<p>You can insert complete JGroups stack definitions into <code>infinispan.xml</code> files.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Embed a custom JGroups stack declaration in your <code>infinispan.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="comment">&lt;!-- Contains one or more JGroups stack definitions. --&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Defines a custom JGroups stack named &quot;prod&quot;. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;TCP</span> <span class="attribute-name">bind_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7800</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port_range</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">recv_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20000000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">send_buf_size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">640000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;MPING</span> <span class="attribute-name">break_on_coord_rsp</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">mcast_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mping.mcast_addr:228.2.4.6}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">mcast_port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.mping.mcast_port:43366}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">num_discovery_runs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">ip_ttl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.udp.ip_ttl:2}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;MERGE3</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FD_SOCK</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FD_ALL</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout_check_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;VERIFY_SUSPECT</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.NAKACK2</span> <span class="attribute-name">use_mcast_xmit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_num_rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">xmit_table_msgs_per_row</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_max_compaction_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;UNICAST3</span> <span class="attribute-name">xmit_interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_num_rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmit_table_msgs_per_row</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmit_table_max_compaction_time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.STABLE</span> <span class="attribute-name">desired_avg_gossip</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max_bytes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1M</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;pbcast.GMS</span> <span class="attribute-name">print_local_addr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">join_timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jgroups.join_timeout:2000}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;UFC</span> <span class="attribute-name">max_credits</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4m</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min_threshold</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;MFC</span> <span class="attribute-name">max_credits</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4m</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min_threshold</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;FRAG3</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Uses &quot;prod&quot; for cluster transport. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-external-jgroups-stacks_cluster-transport"><a class="anchor" href="#using-external-jgroups-stacks_cluster-transport"></a>11.7. Using external JGroups stacks</h3>
<div class="paragraph">
<p>Reference external files that define custom JGroups stacks in <code>infinispan.xml</code> files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add custom JGroups stack files to the <code>$ISPN_HOME/server/conf</code> directory.</p>
<div class="paragraph">
<p>Alternatively you can specify an absolute path when you declare the external stack file.</p>
</div>
</li>
<li>
<p>Reference the external stack file with the <code>stack-file</code> element.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
     <span class="comment">&lt;!-- Creates a &quot;prod-tcp&quot; stack that references an external file. --&gt;</span>
     <span class="tag">&lt;stack-file</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-jgroups-tcp.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Use the &quot;prod-tcp&quot; stack for cluster transport. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prod-tcp</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
  <span class="comment">&lt;!-- Cache configuration goes here. --&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="secure-cluster-transport"><a class="anchor" href="#secure-cluster-transport"></a>11.8. Encrypting cluster transport</h3>
<div class="paragraph">
<p>Secure cluster transport so that nodes communicate with encrypted messages.
You can also configure Infinispan clusters to perform certificate authentication so that only nodes with valid identities can join.</p>
</div>
<div class="sect3">
<h4 id="securing-cluster-transport-tls-identities_secure-cluster-transport"><a class="anchor" href="#securing-cluster-transport-tls-identities_secure-cluster-transport"></a>11.8.1. Securing cluster transport with TLS identities</h4>
<div class="paragraph">
<p>Add SSL/TLS identities to a Infinispan Server security realm and use them to secure cluster transport.
Nodes in the Infinispan Server cluster then exchange SSL/TLS certificates to encrypt JGroups messages, including RELAY messages if you configure cross-site replication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install a Infinispan Server cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a TLS keystore that contains a single certificate to identify Infinispan Server.</p>
<div class="paragraph">
<p>You can also use a PEM file if it contains a private key in PKCS#1 or PKCS#8 format, a certificate, and has an empty password: <code>password=""</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the certificate in the keystore is not signed by a public certificate authority (CA) then you must also create a trust store that contains either the signing certificate or the public key.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the keystore to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add the keystore to a new security realm in your Infinispan Server configuration.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should create dedicated keystores and security realms so that Infinispan Server endpoints do not use the same security realm as cluster transport.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;security-realms&gt;</span>
    <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster-transport</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
          <span class="comment">&lt;!-- Adds a keystore that contains a certificate that provides
               SSL/TLS identity to encrypt cluster transport. --&gt;</span>
          <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.pfx</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
      <span class="tag">&lt;/server-identities&gt;</span>
    <span class="tag">&lt;/security-realm&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configure cluster transport to use the security realm by specifying the name of the security realm with the <code>server:security-realm</code> attribute.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">server:security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster-transport</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start Infinispan Server, the following log message indicates that the cluster is using the security realm for cluster transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.SERVER] ISPN080060: SSL Transport using realm &lt;security_realm_name&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jgroups-encryption-protocols_secure-cluster-transport"><a class="anchor" href="#jgroups-encryption-protocols_secure-cluster-transport"></a>11.8.2. JGroups encryption protocols</h4>
<div class="paragraph">
<p>To secure cluster traffic, you can configure Infinispan nodes to encrypt JGroups message payloads with secret keys.</p>
</div>
<div class="paragraph">
<p>Infinispan nodes can obtain secret keys from either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The coordinator node (asymmetric encryption).</p>
</li>
<li>
<p>A shared keystore (symmetric encryption).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from coordinator nodes</div>
<p>You configure asymmetric encryption by adding the <code>ASYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to generate and distribute secret keys.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.
This protects your cluster from man-in-the-middle (MitM) attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Asymmetric encryption secures cluster traffic as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first node in the Infinispan cluster, the coordinator node, generates a secret key.</p>
</li>
<li>
<p>A joining node performs certificate authentication with the coordinator to mutually verify identity.</p>
</li>
<li>
<p>The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.</p>
</li>
<li>
<p>The coordinator node encrypts the secret key with the public key and returns it to the joining node.</p>
</li>
<li>
<p>The joining node decrypts and installs the secret key.</p>
</li>
<li>
<p>The node joins the cluster, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from shared keystores</div>
<p>You configure symmetric encryption by adding the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to obtain secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Nodes install the secret key from a keystore on the Infinispan classpath at startup.</p>
</li>
<li>
<p>Node join clusters, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Comparison of asymmetric and symmetric encryption</div>
<p><code>ASYM_ENCRYPT</code> with certificate authentication provides an additional layer of encryption in comparison with <code>SYM_ENCRYPT</code>.
You provide keystores that encrypt the requests to coordinator nodes for the secret key.
Infinispan automatically generates that secret key and handles cluster traffic, while letting you specify when to generate secret keys.
For example, you can configure clusters to generate new secret keys when nodes leave.
This ensures that nodes cannot bypass certificate authentication and join with old keys.</p>
</div>
<div class="paragraph">
<p><code>SYM_ENCRYPT</code>, on the other hand, is faster than <code>ASYM_ENCRYPT</code> because nodes do not need to exchange keys with the cluster coordinator.
A potential drawback to <code>SYM_ENCRYPT</code> is that there is no configuration to automatically generate new secret keys when cluster membership changes.
Users are responsible for generating and distributing the secret keys that nodes use to encrypt cluster traffic.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jgroups-asym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-asym-encrypt_secure-cluster-transport"></a>11.8.3. Securing cluster transport with asymmetric encryption</h4>
<div class="paragraph">
<p>Configure Infinispan clusters to generate and distribute secret keys that encrypt JGroups messages.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore with certificate chains that enables Infinispan to verify node identity.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SSL_KEY_EXCHANGE</code> and <code>ASYM_ENCRYPT</code> protocols to a JGroups stack in your Infinispan configuration, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a secure JGroups stack named &quot;encrypt-tcp&quot; that extends the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Adds a keystore that nodes use to perform certificate authentication. --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert SSL_KEY_EXCHANGE into the default TCP stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SSL_KEY_EXCHANGE</span> <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mykeystore.jks</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">keystore_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Configures ASYM_ENCRYPT --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert ASYM_ENCRYPT into the default TCP stack before pbcast.NAKACK2. --&gt;</span>
      <span class="comment">&lt;!-- The use_external_key_exchange = &quot;true&quot; attribute configures nodes to use the `SSL_KEY_EXCHANGE` protocol for certificate authentication. --&gt;</span>
      <span class="tag">&lt;ASYM_ENCRYPT</span> <span class="attribute-name">asym_keylength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2048</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">asym_algorithm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RSA</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">change_key_on_coord_leave</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">change_key_on_leave</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">use_external_key_exchange</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_BEFORE</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Configures the cluster to use the JGroups stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>ASYM_ENCRYPT</code> and can obtain the secret key from the coordinator node.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.jgroups.protocols.ASYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html">JGroups 4 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-4.2.xsd">JGroups 4.2 Schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jgroups-sym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-sym-encrypt_secure-cluster-transport"></a>11.8.4. Securing cluster transport with symmetric encryption</h4>
<div class="paragraph">
<p>Configure Infinispan clusters to encrypt JGroups messages with secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore that contains a secret key.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a secure JGroups stack named &quot;encrypt-tcp&quot; that extends the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Adds a keystore from which nodes obtain secret keys. --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert SYM_ENCRYPT into the default TCP stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SYM_ENCRYPT</span> <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKeystore.p12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">store_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">key_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Configures the cluster to use the JGroups stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>SYM_ENCRYPT</code> and can obtain the secret key from the shared keystore.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[org.jgroups.protocols.SYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html">JGroups 4 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-4.2.xsd">JGroups 4.2 Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-ports_cluster-transport"><a class="anchor" href="#jgroups-ports_cluster-transport"></a>11.9. TCP and UDP ports for cluster traffic</h3>
<div class="paragraph">
<p>Infinispan uses the following ports for cluster transport messages:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP/UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster bind port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups multicast</p></td>
</tr>
</tbody>
</table>
<h4 id="cross_site_replication" class="discrete">Cross-site replication</h4>
<div class="paragraph">
<p>Infinispan uses the following ports for the JGroups RELAY2 protocol:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>7900</code></dt>
<dd>
<p>For Infinispan clusters running on Kubernetes.</p>
</dd>
<dt class="hdlist1"><code>7800</code></dt>
<dd>
<p>If using UDP for traffic between nodes and TCP for traffic between clusters.</p>
</dd>
<dt class="hdlist1"><code>7801</code></dt>
<dd>
<p>If using TCP for traffic between nodes and TCP for traffic between clusters.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="datasources"><a class="anchor" href="#datasources"></a>12. Configuring Infinispan Server with managed datasources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add managed datasources to Infinispan Server configuration and optimize connection pooling and performance for JDBC database connections.</p>
</div>
<div class="sect2">
<h3 id="configuring-server-datasources_server"><a class="anchor" href="#configuring-server-datasources_server"></a>12.1. Configuring Infinispan Server with managed datasources</h3>
<div class="paragraph">
<p>Create managed datasources as part of your Infinispan Server configuration to optimize connection pooling and performance for JDBC database connections.
You can then use these datasources as part of your JDBC cache store
configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Copy database drivers to the <code>server/lib</code> directory in your Infinispan Server installation.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code class="command">install</code> command with the Infinispan Command Line Interface (CLI) to download the required drivers to the <code>server/lib</code> directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">install org.postgresql:postgresql:42.1.3</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan Server configuration for editing.</p>
</li>
<li>
<p>Add a new <code>data-source</code> to the <code>data-sources</code> section.</p>
</li>
<li>
<p>Uniquely identify the datasource with the <code>name</code> attribute or field.</p>
</li>
<li>
<p>Specify a JNDI name for the datasource with the <code>jndi-name</code> attribute or field.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You use the JNDI name to specify the datasource in your JDBC cache store
configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set <code>true</code> as the value of the <code>statistics</code> attribute or field to enable statistics for the datasource through the <code>/metrics</code> endpoint.</p>
</li>
<li>
<p>Provide JDBC driver details that define how to connect to the datasource in the <code>connection-factory</code> section.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify the name of the database driver with the <code>driver</code> attribute or field.</p>
</li>
<li>
<p>Specify the JDBC connection url with the <code>url</code> attribute or field.</p>
</li>
<li>
<p>Specify credentials with the <code>username</code> and <code>password</code> attributes or fields.</p>
</li>
<li>
<p>Provide any other configuration as appropriate.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Define how Infinispan Server nodes pool and reuse connections with connection pool tuning properties in the <code>connection-pool</code> section.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Use the Infinispan Command Line Interface (CLI) to test the datasource connection, as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a CLI session.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh</code></pre>
</div>
</div>
</li>
<li>
<p>List all datasources and confirm the one you created is available.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; server datasource ls</code></pre>
</div>
</div>
</li>
<li>
<p>Test a datasource connection.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; server datasource test my-datasource</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Now that you have created a managed datasource in your Infinispan Server configuration, you can reference the JNDI name in cache store configuration as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache-configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistent-cache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:jdbc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:config:store:jdbc:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;persistence&gt;</span>
        <span class="tag">&lt;jdbc:string-keyed-jdbc-store&gt;</span>
            <span class="comment">&lt;!-- Specifies the JNDI name for the datasource connection
                 in Infinispan Server configuration. --&gt;</span>
            <span class="tag">&lt;jdbc:data-source</span> <span class="attribute-name">jndi-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/postgres</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;jdbc:string-keyed-table</span> <span class="attribute-name">drop-on-exit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">create-on-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TBL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;jdbc:id-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR(255)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;jdbc:data-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DATA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BYTEA</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;jdbc:timestamp-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BIGINT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;jdbc:segment-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">S</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/jdbc:string-keyed-table&gt;</span>
        <span class="tag">&lt;/jdbc:string-keyed-jdbc-store&gt;</span>
    <span class="tag">&lt;/persistence&gt;</span>
<span class="tag">&lt;/distributed-cache-configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-datasources_server"><a class="anchor" href="#server-datasources_server"></a>12.2. Managed datasources for JDBC connections</h3>
<div class="paragraph">
<p>Managed datasources centralize JDBC connection configuration for your Infinispan cluster and share connection pools for Infinispan Server nodes.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;data-sources&gt;</span>
   <span class="comment">&lt;!-- Defines a unique name for the datasource and JNDI name that you
        reference in JDBC cache store configuration.
        Enables statistics for the datasource, if required. --&gt;</span>
   <span class="tag">&lt;data-source</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ds</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/postgres</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Specifies the JDBC driver that creates connections. --&gt;</span>
      <span class="tag">&lt;connection-factory</span> <span class="attribute-name">driver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:postgresql://localhost:5432/postgres</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="comment">&lt;!-- Sets optional JDBC driver-specific connection properties. --&gt;</span>
         <span class="tag">&lt;connection-property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>value<span class="tag">&lt;/connection-property&gt;</span>
      <span class="tag">&lt;/connection-factory&gt;</span>
      <span class="comment">&lt;!-- Defines connection pool tuning properties. --&gt;</span>
      <span class="tag">&lt;connection-pool</span> <span class="attribute-name">initial-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">max-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">min-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">background-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">idle-removal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">blocking-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">leak-detection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/data-source&gt;</span>
<span class="tag">&lt;/data-sources&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">data-sources</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ds</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jndi-name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/postgres</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">connection-factory</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">driver</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:postgresql://localhost:5432/postgres</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">connection-properties</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">connection-pool</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">initial-size</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">max-size</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">min-size</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">background-validation</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">idle-removal</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">blocking-timeout</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">leak-detection</span><span class="delimiter">&quot;</span></span>: <span class="integer">10000</span>
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">data-sources</span>:
  - <span class="string"><span class="content">name: ds</span></span>
    <span class="key">jndi-name</span>: <span class="string"><span class="content">'jdbc/postgres'</span></span>
    <span class="key">statistics</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">connection-factory</span>:
      <span class="key">driver</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span>
      <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:postgresql://localhost:5432/postgres</span><span class="delimiter">&quot;</span></span>
      <span class="key">username</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">postgres</span><span class="delimiter">&quot;</span></span>
      <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>
      <span class="key">connection-properties</span>:
        <span class="key">name</span>: <span class="string"><span class="content">value</span></span>
    <span class="key">connection-pool</span>:
      <span class="key">initial-size</span>: <span class="string"><span class="content">1</span></span>
      <span class="key">max-size</span>: <span class="string"><span class="content">10</span></span>
      <span class="key">min-size</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">background-validation</span>: <span class="string"><span class="content">1000</span></span>
      <span class="key">idle-removal</span>: <span class="string"><span class="content">1</span></span>
      <span class="key">blocking-timeout</span>: <span class="string"><span class="content">1000</span></span>
      <span class="key">leak-detection</span>: <span class="string"><span class="content">10000</span></span></code></pre>
</div>
</div>
<h4 id="connection_pool_tuning_properties" class="discrete">Connection pool tuning properties</h4>
<div class="paragraph">
<p>You can tune connection pools with the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial number of connections the pool should hold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of connections in the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of connections the pool should hold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>blocking-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum time in milliseconds to block while waiting for a connection before throwing an exception.
This will never throw an exception if creating a new connection takes an inordinately long period of time.
Default is <code>0</code> meaning that a call will wait indefinitely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>background-validation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between background validation runs. A duration of <code>0</code> means that this feature is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validate-on-acquisition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connections idle for longer than this time, specified in milliseconds, are validated before being acquired (foreground validation). A duration of <code>0</code> means that this feature is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>idle-removal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in minutes a connection has to be idle before it can be removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>leak-detection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds a connection has to be held before a leak warning.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remote_server_execution"><a class="anchor" href="#remote_server_execution"></a>13. Remotely Executing Server-Side Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Define and add tasks to Infinispan servers that you can invoke from the
Infinispan command line interface, REST API, or from Hot Rod clients.</p>
</div>
<div class="paragraph">
<p>You can implement tasks as custom Java classes or define scripts in languages
such as JavaScript.</p>
</div>
<div class="sect2">
<h3 id="server_tasks"><a class="anchor" href="#server_tasks"></a>13.1. Creating Server Tasks</h3>
<div class="paragraph">
<p>Create custom task implementations and add them to Infinispan servers.</p>
</div>
<div class="sect3">
<h4 id="tasks"><a class="anchor" href="#tasks"></a>13.1.1. Server Tasks</h4>
<div class="paragraph">
<p>Infinispan server tasks are classes that extend the
<code>org.infinispan.tasks.ServerTask</code> interface and generally include the following
method calls:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>setTaskContext()</code></dt>
<dd>
<p>Allows access to execution context information including task parameters, cache references on which tasks are executed, and so on. In most cases, implementations store this information locally and use it when tasks are actually executed.</p>
</dd>
<dt class="hdlist1"><code>getName()</code></dt>
<dd>
<p>Returns unique names for tasks. Clients invoke tasks with these names.</p>
</dd>
<dt class="hdlist1"><code>getExecutionMode()</code></dt>
<dd>
<p>Returns the execution mode for tasks.</p>
<div class="ulist">
<ul>
<li>
<p><code>TaskExecutionMode.ONE_NODE</code> only the node that handles the request executes the script. Although scripts can still invoke clustered operations.</p>
</li>
<li>
<p><code>TaskExecutionMode.ALL_NODES</code> Infinispan uses clustered executors to run scripts across nodes. For example, server tasks that invoke stream processing need to be executed on a single node because stream processing is distributed to all nodes.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>call()</code></dt>
<dd>
<p>Computes a result. This method is defined in the
<code>java.util.concurrent.Callable</code> interface and is invoked with server tasks.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server task implementations must adhere to service loader pattern requirements.
For example, implementations must have a zero-argument constructors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following <code>HelloTask</code> class implementation provides an example task that
has one parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="keyword">import</span> <span class="include">org.infinispan.tasks.ServerTask</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.tasks.TaskContext</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloTask</span> <span class="directive">implements</span> ServerTask&lt;<span class="predefined-type">String</span>&gt; {

   <span class="directive">private</span> TaskContext ctx;

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> setTaskContext(TaskContext ctx) {
      <span class="local-variable">this</span>.ctx = ctx;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
      <span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) ctx.getParameters().get().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-task</span><span class="delimiter">&quot;</span></span>;
   }

}</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/tasks/ServerTask.html"><code>org.infinispan.tasks.ServerTask</code></a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html?is-external=true#call--"><code>java.util.concurrent.Callable.call()</code></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html"><code>java.util.ServiceLoader</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="server-tasks_server"><a class="anchor" href="#server-tasks_server"></a>13.1.2. Deploying Server Tasks to Infinispan Servers</h4>
<div class="paragraph">
<p>Add your custom server task classes to Infinispan servers.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Stop any running Infinispan servers. Infinispan does not support runtime
deployment of custom classes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a <code>META-INF/services/org.infinispan.tasks.ServerTask</code> file that contains
the fully qualified names of server tasks, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>example.HelloTask</code></pre>
</div>
</div>
</li>
<li>
<p>Package your server task implementation in a JAR file.</p>
</li>
<li>
<p>Copy the JAR file to the <code>$ISPN_HOME/server/lib</code> directory of your Infinispan server.</p>
</li>
<li>
<p>Add your classes to the deserialization allow list in your Infinispan
configuration. Alternatively set the allow list using system properties.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="../encoding/encoding.html#adding-deserialization-allowlist_marshaller-implementations">Adding Java Classes to Deserialization Allow Lists</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan 13.0 Configuration Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-scripts"><a class="anchor" href="#server-scripts"></a>13.2. Creating Server Scripts</h3>
<div class="paragraph">
<p>Create custom scripts and add them to Infinispan servers.</p>
</div>
<div class="sect3">
<h4 id="scripts"><a class="anchor" href="#scripts"></a>13.2.1. Server Scripts</h4>
<div class="paragraph">
<p>Infinispan server scripting is based on the <code>javax.script</code> API and is
compatible with any JVM-based ScriptEngine implementation.</p>
</div>
<div class="paragraph">
<div class="title">Hello World Script Example</div>
<p>The following is a simple example that runs on a single Infinispan server, has
one parameter, and uses JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript,parameters=[greetee]</span>
<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + greetee</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run the preceding script, you pass a value for the <code>greetee</code> parameter
and Infinispan returns <code>"Hello ${value}"</code>.</p>
</div>
<div class="sect4">
<h5 id="server_script_metdata"><a class="anchor" href="#server_script_metdata"></a>Script Metadata</h5>
<div class="paragraph">
<p>Metadata provides additional information about scripts that Infinispan servers use when running scripts.</p>
</div>
<div class="paragraph">
<p>Script metadata are <code>property=value</code> pairs that you add to comments in the
first lines of scripts, such as the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// name=test, language=javascript</span>
<span class="comment">// mode=local, parameters=[a,b,c]</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use comment styles that match the scripting language (<code>//</code>, <code>;;</code>, <code>#</code>).</p>
</li>
<li>
<p>Separate <code>property=value</code> pairs with commas.</p>
</li>
<li>
<p>Separate values with single (') or double (") quote characters.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Metadata Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the execution mode and has the following values:</p>
<p class="tableblock"><code>local</code> only the node that handles the request executes the script. Although
scripts can still invoke clustered operations.</p>
<p class="tableblock"><code>distributed</code> Infinispan uses clustered executors to run scripts across nodes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the ScriptEngine that executes the script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extension</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies filename extensions as an alternative method to set the ScriptEngine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies roles that users must have to execute scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an array of valid parameter names for this script. Invocations which specify parameters not included in this list cause exceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datatype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optionally sets the MediaType (MIME type) for storing data as well as
parameter and return values. This property is useful for remote clients that
support particular data formats only.</p>
<p class="tableblock">Currently you can set only <code>text/plain; charset=utf-8</code> to use the String UTF-8
format for data.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="server_script_bindings"><a class="anchor" href="#server_script_bindings"></a>Script Bindings</h5>
<div class="paragraph">
<p>Infinispan exposes internal objects as bindings for script execution.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Binding</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the cache against which the script is run.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>marshaller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the marshaller to use for serializing data to the cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the <code>cacheManager</code> for the cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scriptingManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the instance of the script manager that runs the script. You can use
this binding to run other scripts from a script.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="server_script_parameters"><a class="anchor" href="#server_script_parameters"></a>Script Parameters</h5>
<div class="paragraph">
<p>Infinispan lets you pass named parameters as bindings for running scripts.</p>
</div>
<div class="paragraph">
<p>Parameters are <code>name,value</code> pairs, where <code>name</code> is a string and <code>value</code> is any
value that the marshaller can interpret.</p>
</div>
<div class="paragraph">
<p>The following example script has two parameters, <code>multiplicand</code> and
<code>multiplier</code>. The script takes the value of <code>multiplicand</code> and multiplies it
with the value of <code>multiplier</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript</span>
multiplicand * multiplier</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run the preceding script, Infinispan responds with the result of the
expression evaluation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-scripts_server"><a class="anchor" href="#adding-scripts_server"></a>13.2.2. Adding Scripts to Infinispan Servers</h4>
<div class="paragraph">
<p>Use the command line interface to add scripts to Infinispan servers.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Infinispan Server stores scripts in the <code>___script_cache</code> cache. If you enable cache authorization, users must have <code>CREATE</code> permissions to add to <code>___script_cache</code>.</p>
</div>
<div class="paragraph">
<p>Assign users the <code>deployer</code> role at minimum if you use default authorization settings.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define scripts as required.</p>
<div class="paragraph">
<p>For example, create a file named <code>multiplication.js</code> that runs on a single
Infinispan server, has two parameters, and uses JavaScript to multiply a given
value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript</span>
multiplicand * multiplier</code></pre>
</div>
</div>
</li>
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">task</code> command to upload scripts, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; task upload --file=multiplication.js multiplication</pre>
</div>
</div>
</li>
<li>
<p>Verify that your scripts are available.</p>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; ls tasks
multiplication</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="add_script_hotrod"><a class="anchor" href="#add_script_hotrod"></a>13.2.3. Programmatically Creating Scripts</h4>
<div class="paragraph">
<p>Add scripts with the Hot Rod <code>RemoteCache</code> interface as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; scriptCache = cacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">___script_cache</span><span class="delimiter">&quot;</span></span>);
scriptCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>,
  <span class="string"><span class="delimiter">&quot;</span><span class="content">// mode=local,language=javascript</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
  <span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand * multiplier</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running_tasks_scripts"><a class="anchor" href="#running_tasks_scripts"></a>13.3. Running Server-Side Tasks and Scripts</h3>
<div class="paragraph">
<p>Execute tasks and custom scripts on Infinispan servers.</p>
</div>
<div class="sect3">
<h4 id="running_scripts_cli"><a class="anchor" href="#running_scripts_cli"></a>13.3.1. Running Tasks and Scripts</h4>
<div class="paragraph">
<p>Use the command line interface to run tasks and scripts on Infinispan clusters.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">task</code> command to run tasks and scripts, as in the following examples:</p>
<div class="ulist">
<ul>
<li>
<p>Execute a script named <code>multipler.js</code> and specify two parameters:</p>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; task exec multipler.js -Pmultiplicand=10 -Pmultiplier=20
200.0</pre>
</div>
</div>
</li>
<li>
<p>Execute a task named <code>@@cache@names</code> to retrieve a list of all available caches:</p>
<div class="listingblock">
<div class="content">
<pre>//containers/default]&gt; task exec @@cache@names
["___protobuf_metadata","mycache","___script_cache"]</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="running_scripts_hotrod"><a class="anchor" href="#running_scripts_hotrod"></a>13.3.2. Programmatically Running Scripts</h4>
<div class="paragraph">
<p>Call the <code>execute()</code> method to run scripts with the Hot Rod <code>RemoteCache</code>
interface, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; cache = cacheManager.getCache();
<span class="comment">// Create parameters for script execution.</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand</span><span class="delimiter">&quot;</span></span>, <span class="integer">10</span>);
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplier</span><span class="delimiter">&quot;</span></span>, <span class="integer">20</span>);
<span class="comment">// Run the script with the parameters.</span>
<span class="predefined-type">Object</span> result = cache.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>, params);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p>
</div>
</div>
<div class="sect3">
<h4 id="running_tasks_hotrod"><a class="anchor" href="#running_tasks_hotrod"></a>13.3.3. Programmatically Running Tasks</h4>
<div class="paragraph">
<p>Call the <code>execute()</code> method to run tasks with the Hot Rod <code>RemoteCache</code>
interface, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Add configuration for a locally running server.</span>
ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServer().host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>).port(<span class="integer">11222</span>);

<span class="comment">// Connect to the server.</span>
RemoteCacheManager cacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());

<span class="comment">// Retrieve the remote cache.</span>
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheManager.getCache();

<span class="comment">// Create task parameters.</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; parameters = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
parameters.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">developer</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Run the server task.</span>
<span class="predefined-type">String</span> greet = cache.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-task</span><span class="delimiter">&quot;</span></span>, parameters);
<span class="predefined-type">System</span>.out.println(greet);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">org.infinispan.client.hotrod.RemoteCache</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logs"><a class="anchor" href="#logs"></a>14. Enabling and Customizing Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan uses Apache Log4j 2 to provide configurable logging mechanisms that capture details about the environment and record cache operations for troubleshooting purposes and root cause analysis.</p>
</div>
<div class="sect2">
<h3 id="server-logs_logging"><a class="anchor" href="#server-logs_logging"></a>14.1. Server Logs</h3>
<div class="paragraph">
<p>Infinispan writes server logs to the following files in the <code>$ISPN_HOME/server/log</code> directory:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>server.log</code></dt>
<dd>
<p>Messages in human readable format, including boot logs that relate to the server startup.<br>
 Infinispan creates this file when you start the server.</p>
</dd>
<dt class="hdlist1"><code>server.log.json</code></dt>
<dd>
<p>Messages in JSON format that let you parse and analyze Infinispan logs.<br>
Infinispan creates this file when you enable the <code>JSON-FILE</code> appender.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="configuring_log_properties-logging"><a class="anchor" href="#configuring_log_properties-logging"></a>14.1.1. Configuring Server Logs</h4>
<div class="paragraph">
<p>Infinispan uses Apache Log4j technology to write server log messages.
You can configure server logs in the <code>log4j2.xml</code> file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Change server logging as appropriate.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual">Apache Log4j manual</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="log_levels-logging"><a class="anchor" href="#log_levels-logging"></a>14.1.2. Log Levels</h4>
<div class="paragraph">
<p>Log levels indicate the nature and severity of messages.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Log level</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TRACE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Fine-grained debug messages, capturing the flow of individual requests through the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DEBUG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Messages for general debugging, not related to an individual request.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Messages about the overall progress of applications, including lifecycle events.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>WARN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Events that can lead to error or degrade performance.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ERROR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Error conditions that might prevent operations or activities from being successful but do not prevent applications from running.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>FATAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Events that could cause critical service failure and application shutdown.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the levels of individual messages presented above, the configuration allows two more values: <code>ALL</code> to include all messages, and <code>OFF</code> to exclude all messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="log_categories-logging"><a class="anchor" href="#log_categories-logging"></a>14.1.3. Infinispan Log Categories</h4>
<div class="paragraph">
<p>Infinispan provides categories for <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code> level messages that organize logs by functional area.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan.CLUSTER</code></dt>
<dd>
<p>Messages specific to Infinispan clustering that include state transfer operations, rebalancing events, partitioning, and so on.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.CONFIG</code></dt>
<dd>
<p>Messages specific to Infinispan configuration.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.CONTAINER</code></dt>
<dd>
<p>Messages specific to the data container that include expiration and eviction operations, cache listener notifications, transactions, and so on.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.PERSISTENCE</code></dt>
<dd>
<p>Messages specific to cache loaders and stores.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.SECURITY</code></dt>
<dd>
<p>Messages specific to Infinispan security.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.SERVER</code></dt>
<dd>
<p>Messages specific to Infinispan servers.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.XSITE</code></dt>
<dd>
<p>Messages specific to cross-site replication operations.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="log_appenders-logging"><a class="anchor" href="#log_appenders-logging"></a>14.1.4. Log Appenders</h4>
<div class="paragraph">
<p>Log appenders define how Infinispan records log messages.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CONSOLE</dt>
<dd>
<p>Write log messages to the host standard out (<code>stdout</code>) or standard error (<code>stderr</code>) stream.<br>
Uses the <code>org.apache.logging.log4j.core.appender.ConsoleAppender</code> class by default.</p>
</dd>
<dt class="hdlist1">FILE</dt>
<dd>
<p>Write log messages to a file.<br>
Uses the <code>org.apache.logging.log4j.core.appender.RollingFileAppender</code> class by default.</p>
</dd>
<dt class="hdlist1">JSON-FILE</dt>
<dd>
<p>Write log messages to a file in JSON format.<br>
Uses the <code>org.apache.logging.log4j.core.appender.RollingFileAppender</code> class by default.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="log_pattern_formatters-logging"><a class="anchor" href="#log_pattern_formatters-logging"></a>14.1.5. Log Patterns</h4>
<div class="paragraph">
<p>The <code>CONSOLE</code> and <code>FILE</code> appenders use a
<a href="https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout"><code>PatternLayout</code></a>
to format the log messages according to a <strong>pattern</strong>.</p>
</div>
<div class="paragraph">
<p>An example is the default pattern in the FILE appender:<br>
<code>%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p (%t) [%c{1}] %m%throwable%n</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>%d{yyyy-MM-dd HH:mm:ss,SSS}</code> adds the current time and date.</p>
</li>
<li>
<p><code>%-5p</code> specifies the log level, aligned to the right.</p>
</li>
<li>
<p><code>%t</code> adds the name of the current thread.</p>
</li>
<li>
<p><code>%c{1}</code> adds the short name of the logging category.</p>
</li>
<li>
<p><code>%m</code> adds the log message.</p>
</li>
<li>
<p><code>%throwable</code> adds the exception stack trace.</p>
</li>
<li>
<p><code>%n</code> adds a new line.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Patterns are fully described in
<a href="https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout">the <code>PatternLayout</code> documentation</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling_json_logging-logging"><a class="anchor" href="#enabling_json_logging-logging"></a>14.1.6. Enabling and Configuring the JSON Log Handler</h4>
<div class="paragraph">
<p>Infinispan provides a JSON log handler to write messages in JSON format.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Stop Infinispan Server if it is running.<br>
You cannot dynamically enable log handlers.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Uncomment the <code>JSON-FILE</code> appender and comment out the <code>FILE</code> appender:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!--&lt;AppenderRef ref=&quot;FILE&quot;/&gt;--&gt;</span>
<span class="tag">&lt;AppenderRef</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JSON-FILE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Optionally configure the JSON appender and JSON layout as required.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you start Infinispan, it writes each log message as a JSON map in the following file:<br>
<code>$ISPN_HOME/server/log/server.log.json</code></p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual/appenders.html#RollingFileAppender">RollingFileAppender</a></p>
</li>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual/layouts.html#JSONLayout"> JSONLayout</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="access-logs_logging"><a class="anchor" href="#access-logs_logging"></a>14.2. Access Logs</h3>
<div class="paragraph">
<p>Access logs record all inbound client requests for Hot Rod and REST endpoints to files in the <code>$ISPN_HOME/server/log</code> directory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan.HOTROD_ACCESS_LOG</code></dt>
<dd>
<p>Logging category that writes Hot Rod access messages to a <code>hotrod-access.log</code> file.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan.REST_ACCESS_LOG</code></dt>
<dd>
<p>Logging category that writes REST access messages to a <code>rest-access.log</code> file.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="enabling-access-logs_logging"><a class="anchor" href="#enabling-access-logs_logging"></a>14.2.1. Enabling Access Logs</h4>
<div class="paragraph">
<p>To record Hot Rod and REST endpoint access messages, you need to enable the logging categories in <code>log4j2.xml</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Change the level for the <code>org.infinispan.HOTROD_ACCESS_LOG</code> and <code>org.infinispan.REST_ACCESS_LOG</code> logging categories to <code>TRACE</code>.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.HOTROD_ACCESS_LOG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">additivity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;AppenderRef</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HR-ACCESS-FILE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Logger&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="access_log_properties-logging"><a class="anchor" href="#access_log_properties-logging"></a>14.2.2. Access Log Properties</h4>
<div class="paragraph">
<p>The default format for access logs is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>%X{address} %X{user} [%d{dd/MMM/yyyy:HH:mm:ss Z}] &amp;quot;%X{method} %m
%X{protocol}&amp;quot; %X{status} %X{requestSize} %X{responseSize} %X{duration}%n</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding format creates log entries such as the following:</p>
</div>
<div class="paragraph">
<p><code>127.0.0.1 - [DD/MM/YYYY:HH:MM:SS +0000] "PUT /rest/v2/caches/default/key HTTP/1.1" 404 5 77 10</code></p>
</div>
<div class="paragraph">
<p>Logging properties use the <code>%X{name}</code> notation and let you modify the format of access logs. The following are the default logging properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the <code>X-Forwarded-For</code> header or the client IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal name, if using authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method used. <code>PUT</code>, <code>GET</code>, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol used. <code>HTTP/1.1</code>, <code>HTTP/2</code>, <code>HOTROD/2.9</code>, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP status code for the REST endpoint. <code>OK</code> or an exception for the Hot Rod endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds that the server took to handle the request.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the header name prefixed with <code>h:</code> to log headers that were included in requests; for example, <code>%X{h:User-Agent}</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="audit-logs_logging"><a class="anchor" href="#audit-logs_logging"></a>14.3. Audit Logs</h3>
<div class="paragraph">
<p>Audit logs let you track changes to your Infinispan environment so you know when changes occur and which users make them.
Enable and configure audit logging to record server configuration events and administrative operations.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan.AUDIT</code></dt>
<dd>
<p>Logging category that writes security audit messages to an <code>audit.log</code> file in the <code>$ISPN_HOME/server/log</code> directory.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="enabling-audit-logs-logging"><a class="anchor" href="#enabling-audit-logs-logging"></a>14.3.1. Enabling Audit Logging</h4>
<div class="paragraph">
<p>To record security audit messages, you need to enable the logging category in <code>log4j2.xml</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Change the level for the <code>org.infinispan.AUDIT</code> logging category to <code>INFO</code>.</p>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- Set to INFO to enable audit logging --&gt;</span>
<span class="tag">&lt;Logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.AUDIT</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">additivity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;AppenderRef</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AUDIT-FILE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Logger&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-audit-logs_logging"><a class="anchor" href="#configuring-audit-logs_logging"></a>14.3.2. Configuring Audit Logging Appenders</h4>
<div class="paragraph">
<p>Apache Log4j provides different appenders that you can use to send audit messages to a destination other than the default log file.
For instance, if you want to send audit logs to a syslog daemon, JDBC database, or Apache Kafka server, you can configure an appender in <code>log4j2.xml</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open <code>$ISPN_HOME/server/conf/log4j2.xml</code> with any text editor.</p>
</li>
<li>
<p>Comment or remove the default <code>AUDIT-FILE</code> rolling file appender.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!--RollingFile name=&quot;AUDIT-FILE&quot;
  ...
&lt;/RollingFile--&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Add the desired logging appender for audit messages.</p>
<div class="paragraph">
<p>For example, you could add a logging appender for a Kafka server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Kafka</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AUDIT-KAFKA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">topic</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">audit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;PatternLayout</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">%date %message</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bootstrap.servers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>localhost:9092<span class="tag">&lt;/Property&gt;</span>
<span class="tag">&lt;/Kafka&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save and close <code>log4j2.xml</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://logging.apache.org/log4j/2.x/manual/appenders.html">Log4j Appenders</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="customizing-audit-logs_logging"><a class="anchor" href="#customizing-audit-logs_logging"></a>14.3.3. Using Custom Audit Logging Implementations</h4>
<div class="paragraph">
<p>You can create custom implementations of the <code>org.infinispan.security.AuditLogger</code> API if configuring Log4j appenders does not meet your needs.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Implement <code>org.infinispan.security.AuditLogger</code> as required and package it in a JAR file.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add your JAR to the <code>server/lib</code> directory in your Infinispan Server installation.</p>
</li>
<li>
<p>Specify the fully qualified class name of your custom audit logger as the value for the <code>audit-logger</code> attribute on the <code>authorization</code> element in your cache container security configuration.</p>
<div class="paragraph">
<p>For example, the following configuration defines <code>my.package.CustomAuditLogger</code> as the class for logging audit messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
   <span class="tag">&lt;cache-container&gt;</span>
      <span class="tag">&lt;security&gt;</span>
         <span class="tag">&lt;authorization</span> <span class="attribute-name">audit-logger</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.package.CustomAuditLogger</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/AuditLogger.html"><code>org.infinispan.security.AuditLogger</code></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="statistics-jmx"><a class="anchor" href="#statistics-jmx"></a>15. Enabling and configuring Infinispan statistics and JMX monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan can provide Cache Manager and cache statistics as well as export JMX MBeans.</p>
</div>
<div class="sect2">
<h3 id="enabling-statistics-remote_statistics-jmx"><a class="anchor" href="#enabling-statistics-remote_statistics-jmx"></a>15.1. Enabling statistics in remote caches</h3>
<div class="paragraph">
<p>Infinispan Server automatically enables statistics for the default cache manager.
However, you must explicitly enable statistics for your caches.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>statistics</code> attribute or field and specify <code>true</code> as the value.</p>
</li>
<li>
<p>Save and close your Infinispan configuration.</p>
</li>
</ol>
</div>
<h4 id="remote_cache_statistics" class="discrete">Remote cache statistics</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributed-cache</span>:
  <span class="key">statistics</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-hotrod-client-statistics_statistics-jmx"><a class="anchor" href="#enabling-hotrod-client-statistics_statistics-jmx"></a>15.2. Enabling Hot Rod client statistics</h3>
<div class="paragraph">
<p>Hot Rod Java clients can provide statistics that include remote cache and near-cache hits and misses as well as connection pool usage.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Hot Rod Java client configuration for editing.</p>
</li>
<li>
<p>Set <code>true</code> as the value for the <code>statistics</code> property or invoke the <code>statistics().enable()</code> methods.</p>
</li>
<li>
<p>Export JMX MBeans for your Hot Rod client with the <code>jmx</code> and <code>jmx_domain</code> properties or invoke the <code>jmxEnable()</code> and <code>jmxDomain()</code> methods.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="hot_rod_java_client_statistics" class="discrete">Hot Rod Java client statistics</h4>
<div class="listingblock primary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.statistics().enable()
         .jmxEnable()
         .jmxDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.domain.org</span><span class="delimiter">&quot;</span></span>)
       .addServer()
         .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
         .port(<span class="integer">11222</span>);
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(builder.build());</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">infinispan.client.hotrod.statistics = <span class="predefined-constant">true</span>
infinispan.client.hotrod.jmx = <span class="predefined-constant">true</span>
infinispan.client.hotrod.jmx_domain = my.domain.org</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-metrics_statistics-jmx"><a class="anchor" href="#configuring-metrics_statistics-jmx"></a>15.3. Configuring Infinispan metrics</h3>
<div class="paragraph">
<p>Infinispan generates metrics that are compatible with the MicroProfile Metrics API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gauges provide values such as the average number of nanoseconds for write operations or JVM uptime.</p>
</li>
<li>
<p>Histograms provide details about operation execution times such as read,
write, and remove times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Infinispan generates gauges when you enable statistics but you can also configure it to generate histograms.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>metrics</code> element or object to the cache container.</p>
</li>
<li>
<p>Enable or disable gauges with the <code>gauges</code> attribute or field.</p>
</li>
<li>
<p>Enable or disable histograms with the <code>histograms</code> attribute or field.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="metrics_configuration" class="discrete">Metrics configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;metrics</span> <span class="attribute-name">gauges</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">histograms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">metrics</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">gauges</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">histograms</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">metrics</span>:
      <span class="key">gauges</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">histograms</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Infinispan Server exposes statistics through the <code>metrics</code> endpoint.
You can collect metrics with any monitoring tool that supports the OpenMetrics format, such as Prometheus.</p>
</div>
<div class="paragraph">
<p>Infinispan metrics are provided at the <code>vendor</code> scope.
Metrics related to the JVM are provided in the <code>base</code> scope.</p>
</div>
<div class="paragraph">
<p>You can retrieve metrics from Infinispan Server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -v http://localhost:11222/metrics</pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve metrics in MicroProfile JSON format, do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl --header "Accept: application/json" http://localhost:11222/metrics</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/eclipse/microprofile-metrics/blob/master/README.adoc">Eclipse MicroProfile Metrics</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jmx_statistics-jmx"><a class="anchor" href="#enabling-jmx_statistics-jmx"></a>15.4. Registering JMX MBeans</h3>
<div class="paragraph">
<p>Infinispan can register JMX MBeans that you can use to collect statistics and
perform administrative operations.
You must also enable statistics otherwise Infinispan provides <code>0</code> values for all statistic attributes in JMX MBeans.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>jmx</code> element or object to the cache container and specify <code>true</code> as the value for the <code>enabled</code> attribute or field.</p>
</li>
<li>
<p>Add the <code>domain</code> attribute or field and specify the domain where JMX MBeans are exposed, if required.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="jmx_configuration" class="discrete">JMX configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jmx</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">domain</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">jmx</span>:
      <span class="key">enabled</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">domain</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="enabling-jmx-port_statistics-jmx"><a class="anchor" href="#enabling-jmx-port_statistics-jmx"></a>15.4.1. Enabling JMX remote ports</h4>
<div class="paragraph">
<p>Provide unique remote JMX ports to expose Infinispan MBeans through connections in JMXServiceURL format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan Server does not expose JMX remotely via the single port endpoint.
If you want to remotely access Infinispan Server via JMX you must enable a remote port.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pass the following system properties to Infinispan at startup:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=9999
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="jmx-mbeans_statistics-jmx"><a class="anchor" href="#jmx-mbeans_statistics-jmx"></a>15.4.2. Infinispan MBeans</h4>
<div class="paragraph">
<p>Infinispan exposes JMX MBeans that represent manageable resources.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.infinispan:type=Cache</code></dt>
<dd>
<p>Attributes and operations available for cache instances.</p>
</dd>
<dt class="hdlist1"><code>org.infinispan:type=CacheManager</code></dt>
<dd>
<p>Attributes and operations available for cache managers, including Infinispan cache and cluster health statistics.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For a complete list of available JMX MBeans along with descriptions and
available operations and attributes, see the <em>Infinispan JMX Components</em>
documentation.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/jmxComponents.html">Infinispan JMX Components</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-jmx-mbean-servers-statistics-jmx"><a class="anchor" href="#registering-jmx-mbean-servers-statistics-jmx"></a>15.4.3. Registering MBeans in custom MBean servers</h4>
<div class="paragraph">
<p>Infinispan includes an <code>MBeanServerLookup</code> interface that you can use to
register MBeans in custom MBeanServer instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an implementation of <code>MBeanServerLookup</code> so that the <code>getMBeanServer()</code> method returns the custom MBeanServer instance.</p>
</li>
<li>
<p>Configure Infinispan to register JMX MBeans.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>mbean-server-lookup</code> attribute or field to the JMX configuration for the cache manager.</p>
</li>
<li>
<p>Specify fully qualified name (FQN) of your <code>MBeanServerLookup</code> implementation.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h5 id="jmx_mbean_server_lookup_configuration" class="discrete">JMX MBean server lookup configuration</h5>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">mbean-server-lookup</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jmx</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">domain</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">mbean-server-lookup</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">jmx</span>:
      <span class="key">enabled</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">domain</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
      <span class="key">mbeanServerLookup</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.MyMBeanServerLookup</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-health"><a class="anchor" href="#server-health"></a>16. Retrieving Health Statistics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Monitor the health of your Infinispan clusters in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Programmatically with <code>embeddedCacheManager.getHealth()</code> method calls.</p>
</li>
<li>
<p>JMX MBeans</p>
</li>
<li>
<p>Infinispan REST Server</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="accessing_the_health_api_via_jmx"><a class="anchor" href="#accessing_the_health_api_via_jmx"></a>16.1. Accessing the Health API via JMX</h3>
<div class="paragraph">
<p>Retrieve Infinispan cluster health statistics via JMX.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to Infinispan server using any JMX capable tool such as JConsole and navigate to the following object:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>org.infinispan:type=CacheManager,name=&quot;default&quot;,component=CacheContainerHealth</code></pre>
</div>
</div>
</li>
<li>
<p>Select available MBeans to retrieve cluster health statistics.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="accessing_the_health_api_via_rest"><a class="anchor" href="#accessing_the_health_api_via_rest"></a>16.2. Accessing the Health API via REST</h3>
<div class="paragraph">
<p>Get Infinispan cluster health via the REST API.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke a <code>GET</code> request to retrieve cluster health.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">GET /rest/v2/cache-managers/{cacheManagerName}/health</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Infinispan responds with a <code>JSON</code> document such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cluster_health</span><span class="delimiter">&quot;</span></span>:{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cluster_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ISPN</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">health_status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">number_of_nodes</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">node_names</span><span class="delimiter">&quot;</span></span>:[
            <span class="string"><span class="delimiter">&quot;</span><span class="content">NodeA-36229</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">NodeB-28703</span><span class="delimiter">&quot;</span></span>
        ]
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_health</span><span class="delimiter">&quot;</span></span>:[
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">___protobuf_metadata</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">cache2</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">mycache</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">HEALTHY</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">cache_name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">cache1</span><span class="delimiter">&quot;</span></span>
        }
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Get cache manager status as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /rest/v2/cache-managers/{cacheManagerName}/health/status</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p>See the <em>REST v2 (version 2) API</em> documentation for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rolling-upgrades"><a class="anchor" href="#rolling-upgrades"></a>17. Performing rolling upgrades for Infinispan Server clusters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Perform rolling upgrades of your Infinispan clusters to change between
versions without downtime or data loss and migrate data over the Hot Rod protocol.</p>
</div>
<div class="sect2">
<h3 id="setting-up-target-clusters_rolling-upgrades"><a class="anchor" href="#setting-up-target-clusters_rolling-upgrades"></a>17.1. Setting up target Infinispan clusters</h3>
<div class="paragraph">
<p>Create a cluster that uses the Infinispan version to which you plan to upgrade and then connect the source cluster to the target cluster using a remote cache store.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install Infinispan Server nodes with the desired version for your target cluster.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the network properties for the target cluster do not overlap with those
for the source cluster.
You should specify unique names for the target and source clusters in the JGroups transport configuration.
Depending on your environment you can also use different network interfaces and port offsets to separate the target and source clusters.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a remote cache store configuration, in JSON format, that allows the target cluster to connect to the source cluster.</p>
<div class="paragraph">
<p>Remote cache stores on the target cluster use the Hot Rod protocol to retrieve data from the source cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">remote-store</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myCache</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">shared</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">raw-values</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">authentication</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">digest</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
        }
      }
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">remote-server</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">12222</span>
      }
    ]
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Use the Infinispan Command Line Interface (CLI) or REST API to add the remote cache store configuration to the target cluster so it can connect to the source cluster.</p>
<div class="ulist">
<ul>
<li>
<p>CLI: Use the <code class="command">migrate cluster connect</code> command on the target cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[//containers/default]&gt; migrate cluster connect -c myCache --file=remote-store.json</code></pre>
</div>
</div>
</li>
<li>
<p>REST API: Invoke a POST request that includes the remote store configuration in the payload with the <code>rolling-upgrade/source-connection</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/myCache/rolling-upgrade/source-connection</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Repeat the preceding step for each cache that you want to migrate.</p>
</li>
<li>
<p>Switch clients over to the target cluster, so it starts handling all requests.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update client configuration with the location of the target cluster.</p>
</li>
<li>
<p>Restart clients.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/infinispan-cachestore-remote-config-13.0.html">Remote cache store configuration schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-data-target-clusters_rolling-upgrades"><a class="anchor" href="#synchronizing-data-target-clusters_rolling-upgrades"></a>17.2. Synchronizing data to target clusters</h3>
<div class="paragraph">
<p>When you set up a target Infinispan cluster and connect it to a source cluster, the target cluster can handle client requests using a remote cache store and load data on demand.
To completely migrate data to the target cluster, so you can decommission the source cluster, you can synchronize data.
This operation reads data from the source cluster and writes it to the target cluster.
Data migrates to all nodes in the target cluster in parallel, with each node receiving a subset of the data.
You must perform the synchronization for each cache that you want to migrate to the target cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Set up a target cluster with the appropriate Infinispan version.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start synchronizing each cache that you want to migrate to the target cluster with the Infinispan Command Line Interface (CLI) or REST API.</p>
<div class="ulist">
<ul>
<li>
<p>CLI: Use the <code class="command">migrate cluster synchronize</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[//containers/default]&gt; migrate cluster synchronize -c myCache</code></pre>
</div>
</div>
</li>
<li>
<p>REST API: Use the <code>?action=sync-data</code> parameter with a POST request.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/myCache?action=sync-data</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the operation completes, Infinispan responds with the total number of
entries copied to the target cluster.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Disconnect each node in the target cluster from the source cluster.</p>
<div class="ulist">
<ul>
<li>
<p>CLI: Use the <code class="command">migrate cluster disconnect</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[//containers/default]&gt; migrate cluster disconnect -c myCache</code></pre>
</div>
</div>
</li>
<li>
<p>REST API: Invoke a DELETE request.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>DELETE /v2/caches/myCache/rolling-upgrade/source-connection</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>After you synchronize all data from the source cluster, the rolling upgrade
process is complete.
You can now decommission the source cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="patching"><a class="anchor" href="#patching"></a>18. Patching Infinispan Server Installations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install and manage patches for Infinispan Server installations.</p>
</div>
<div class="paragraph">
<p>You can apply patches to multiple Infinispan Server installations with different versions to upgrade to a desired target version.
However, patches do not take effect if Infinispan Server is running.
If you want to upgrade Infinispan clusters without downtime, create a new cluster with the target version and perform a rolling upgrade to that version instead of patching.</p>
</div>
<div class="sect2">
<h3 id="patches-server"><a class="anchor" href="#patches-server"></a>18.1. Infinispan Server Patches</h3>
<div class="paragraph">
<p>Infinispan Server patches are <code>.zip</code> archives that contain artifacts that you can apply to your <code>$ISPN_HOME</code> directory to fix issues and add new features.</p>
</div>
<div class="paragraph">
<p>Patches also provide a set of rules for Infinispan to modify your server installation.
When you apply patches, Infinispan overwrites some files and removes others, depending on if they are required for the target version.</p>
</div>
<div class="paragraph">
<p>However, Infinispan does not make any changes to configuration files that you have created or modified when applying a patch.
Server patches do not modify or replace any custom configuration or data.</p>
</div>
</div>
<div class="sect2">
<h3 id="patching_create-server"><a class="anchor" href="#patching_create-server"></a>18.2. Creating Server Patches</h3>
<div class="paragraph">
<p>You can create patches for Infinispan Server from an existing installation.</p>
</div>
<div class="paragraph">
<p>You can create patches for Infinispan Server starting from version 10.1.7.
You can patch any 10.1 or later server installation.
However you cannot patch 9.4.x or earlier servers with 10.1.7 or later.</p>
</div>
<div class="paragraph">
<p>You can also create patches that either upgrade or downgrade the Infinispan
Server version.
For example, you can create a patch from version 10.1.7 and use
it to upgrade version 10.1.5 or downgrade version 11.0.0.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for a Infinispan Server installation that has
the target version for the patch you want to create.</p>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>patch create</code> command to generate a patch archive and include the <code>-q</code> option with a meaningful qualifier to describe the patch.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch create -q &quot;this is my test patch&quot; path/to/mypatch.zip \
path/to/target/server/home path/to/source/server/home</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding command generates a <code>.zip</code> archive in the specified directory.
Paths are relative to <code>$ISPN_HOME</code> for the target server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Create single patches for multiple different Infinispan versions, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch create -q &quot;this is my test patch&quot; path/to/mypatch.zip \
path/to/target/server/home \
path/to/source/server1/home path/to/source/server2/home</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>server1</code> and <code>server2</code> are different Infinispan versions where you can
install "mypatch.zip".</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Describe the generated patch archive.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch describe path/to/mypatch.zip

Infinispan patch target=$target_version(my test patch)  source=$source_version created=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> is the Infinispan version from which the patch was created.</p>
</li>
<li>
<p><code>$source_version</code> is one or more Infinispan versions to which you can apply the patch.</p>
<div class="paragraph">
<p>You can apply patches to Infinispan Server installations that match the <code>$source_version</code> only.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="patching_install-server"><a class="anchor" href="#patching_install-server"></a>18.3. Installing Server Patches</h3>
<div class="paragraph">
<p>Apply patches to Infinispan Server to upgrade or downgrade an existing version.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a server patch for the target version.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for the Infinispan Server installation you want to patch.</p>
</li>
<li>
<p>Stop the Infinispan Server if it is running.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you patch a server while it is running, the version changes take effect
after restart. If you do not want to stop the server, create a new cluster with
the target version and perform a rolling upgrade to that version instead of
patching.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Install the patch.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch install path/to/patch.zip

Infinispan patch target=$target_version source=$source_version \
created=$timestamp installed=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> displays the Infinispan version that the patch installed.</p>
</li>
<li>
<p><code>$source_version</code> displays the Infinispan version before you installed the patch.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Start the server to verify the patch is installed.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh
...
ISPN080001: Infinispan Server $version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the patch is installed successfully <code>$version</code> matches <code>$target_version</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--server</code> option to install patches in a different <code>$ISPN_HOME</code>
directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch install path/to/patch.zip --server=path/to/server/home</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="patching_rollback-server"><a class="anchor" href="#patching_rollback-server"></a>18.4. Rolling Back Server Patches</h3>
<div class="paragraph">
<p>Remove patches from Infinispan Server by rolling them back and restoring the previous Infinispan version.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a server has multiple patches installed, you can roll back the last installed patch only.</p>
</div>
<div class="paragraph">
<p>Rolling back patches does not revert configuration changes you make to
Infinispan Server.
Before you roll back patches, you should ensure that your configuration is compatible with the version to which you are rolling back.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <code>$ISPN_HOME</code> for the Infinispan Server installation you want to roll back.</p>
</li>
<li>
<p>Stop the server if it is running.</p>
</li>
<li>
<p>Start the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>List the installed patches.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch ls

Infinispan patch target=$target_version source=$source_version
created=$timestamp installed=$timestamp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$target_version</code> is the Infinispan server version after the patch was applied.</p>
</li>
<li>
<p><code>$source_version</code> is the version for Infinispan server before the patch was applied. Rolling back the patch restores the server to this version.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Roll back the last installed patch.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch rollback</code></pre>
</div>
</div>
</li>
<li>
<p>Quit the CLI.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; quit</code></pre>
</div>
</div>
</li>
<li>
<p>Start the server to verify the patch is rolled back to the previous version.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>$ bin/server.sh
...
ISPN080001: Infinispan Server $version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the patch is rolled back successfully <code>$version</code> matches <code>$source_version</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--server</code> option to rollback patches in a different <code>$ISPN_HOME</code>
directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[disconnected]&gt; patch rollback --server=path/to/server/home</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tshoot_server"><a class="anchor" href="#tshoot_server"></a>19. Troubleshooting Infinispan Servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gather diagnostic information about Infinispan server deployments and perform
troubleshooting steps to resolve issues.</p>
</div>
<div class="sect2">
<h3 id="server_reports-server"><a class="anchor" href="#server_reports-server"></a>19.1. Getting Diagnostic Reports for Infinispan Servers</h3>
<div class="paragraph">
<p>Infinispan servers provide aggregated reports in <code>tar.gz</code> archives that
contain diagnostic information about both the Infinispan server and the host.
The report provides details about CPU, memory, open files, network sockets and
routing, threads, in addition to configuration and log files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">server report</code> command to download a <code>tar.gz</code> archive:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[//containers/default]&gt; server report
Downloaded report 'infinispan-&lt;hostname&gt;-&lt;timestamp&gt;-report.tar.gz'</code></pre>
</div>
</div>
</li>
<li>
<p>Move the <code>tar.gz</code> file to a suitable location on your filesystem.</p>
</li>
<li>
<p>Extract the <code>tar.gz</code> file with any archiving tool.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring_server_logs_cli-server"><a class="anchor" href="#configuring_server_logs_cli-server"></a>19.2. Changing Infinispan Server Logging Configuration at Runtime</h3>
<div class="paragraph">
<p>Modify the logging configuration for Infinispan servers at runtime to
temporarily adjust logging to troubleshoot issues and perform root cause
analysis.</p>
</div>
<div class="paragraph">
<p>Modifying the logging configuration through the CLI is a runtime-only
operation, which means that changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are not saved to the <code>log4j2.xml</code> file. Restarting server nodes or the entire cluster resets the logging configuration to the default properties in the <code>log4j2.xml</code> file.</p>
</li>
<li>
<p>Apply only to the nodes in the cluster when you invoke the CLI. Nodes that join the cluster after you change the logging configuration use the default properties.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
<li>
<p>Use the <code class="command">logging</code> to make the required adjustments.</p>
<div class="ulist">
<ul>
<li>
<p>List all appenders defined on the server:</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; logging list-appenders</pre>
</div>
</div>
<div class="paragraph">
<p>The preceding command returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">STDOUT</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">STDOUT</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">JSON-FILE</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">JSON-FILE</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">HR-ACCESS-FILE</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">HR-ACCESS-FILE</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">FILE</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">FILE</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">REST-ACCESS-FILE</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">REST-ACCESS-FILE</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>List all logger configurations defined on the server:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; logging list-loggers</pre>
</div>
</div>
<div class="paragraph">
<p>The preceding command returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">[ {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">appenders</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">STDOUT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">FILE</span><span class="delimiter">&quot;</span></span> ]
}, {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.HOTROD_ACCESS_LOG</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">appenders</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">HR-ACCESS-FILE</span><span class="delimiter">&quot;</span></span> ]
}, {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">com.arjuna</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">WARN</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">appenders</span><span class="delimiter">&quot;</span></span> : [ ]
}, {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.REST_ACCESS_LOG</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">appenders</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">REST-ACCESS-FILE</span><span class="delimiter">&quot;</span></span> ]
} ]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add and modify logger configurations with the <code class="command">set</code> subcommand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following command sets the logging level for the
<code>org.infinispan</code> package to <code>DEBUG</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; logging set --level=DEBUG org.infinispan</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove existing logger configurations with the <code class="command">remove</code> subcommand.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following command removes the <code>org.infinispan</code> logger
configuration, which means the root configuration is used instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; logging remove org.infinispan</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resource_statistics"><a class="anchor" href="#resource_statistics"></a>19.3. Resource Statistics</h3>
<div class="paragraph">
<p>You can inspect server-collected statistics for some of the resources within a
Infinispan server using the <code class="command">stats</code> command.</p>
</div>
<div class="paragraph">
<p>Use the <code class="command">stats</code> command either from the context of a resource which
collects statistics (containers, caches) or with a path to such a resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; stats
{
  "statistics_enabled" : true,
  "number_of_entries" : 0,
  "hit_ratio" : 0.0,
  "read_write_ratio" : 0.0,
  "time_since_start" : 0,
  "time_since_reset" : 49,
  "current_number_of_entries" : 0,
  "current_number_of_entries_in_memory" : 0,
  "total_number_of_entries" : 0,
  "off_heap_memory_used" : 0,
  "data_memory_used" : 0,
  "stores" : 0,
  "retrievals" : 0,
  "hits" : 0,
  "misses" : 0,
  "remove_hits" : 0,
  "remove_misses" : 0,
  "evictions" : 0,
  "average_read_time" : 0,
  "average_read_time_nanos" : 0,
  "average_write_time" : 0,
  "average_write_time_nanos" : 0,
  "average_remove_time" : 0,
  "average_remove_time_nanos" : 0,
  "required_minimum_number_of_nodes" : -1
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; stats /containers/default/caches/mycache
{
  "time_since_start" : -1,
  "time_since_reset" : -1,
  "current_number_of_entries" : -1,
  "current_number_of_entries_in_memory" : -1,
  "total_number_of_entries" : -1,
  "off_heap_memory_used" : -1,
  "data_memory_used" : -1,
  "stores" : -1,
  "retrievals" : -1,
  "hits" : -1,
  "misses" : -1,
  "remove_hits" : -1,
  "remove_misses" : -1,
  "evictions" : -1,
  "average_read_time" : -1,
  "average_read_time_nanos" : -1,
  "average_write_time" : -1,
  "average_write_time_nanos" : -1,
  "average_remove_time" : -1,
  "average_remove_time_nanos" : -1,
  "required_minimum_number_of_nodes" : -1
}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-17 14:46:55 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>