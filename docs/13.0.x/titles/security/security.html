<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Security Guide for Infinispan 13.0</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Security Guide for Infinispan 13.0</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#security">1. Infinispan Security</a></li>
<li><a href="#authorization">2. Configuring User Authorization</a>
<ul class="sectlevel2">
<li><a href="#enabling-authz-authz">2.1. Enabling Authorization in Cache Configuration</a></li>
<li><a href="#user-roles-permissions_authz">2.2. User roles and permissions</a></li>
<li><a href="#con_authz-authz">2.3. How Security Authorization Works</a>
<ul class="sectlevel3">
<li><a href="#user-permissions_authz">2.3.1. Permissions</a>
<ul class="sectlevel4">
<li><a href="#cache_manager_permissions">Cache Manager permissions</a></li>
<li><a href="#cache_permissions">Cache permissions</a></li>
</ul>
</li>
<li><a href="#role-mappers_authz">2.3.2. Role Mappers</a>
<ul class="sectlevel4">
<li><a href="#cluster_role_mappers">Cluster role mappers</a></li>
<li><a href="#identity_role_mappers">Identity role mappers</a></li>
<li><a href="#commonname_role_mappers">CommonName role mappers</a></li>
<li><a href="#custom_role_mappers">Custom role mappers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#acl-cache_authz">2.4. Access Control List (ACL) Cache</a></li>
<li><a href="#customizing-authorization_authz">2.5. Customizing Roles and Permissions</a></li>
<li><a href="#disabling-authorization_authz">2.6. Disabling Security Authorization</a></li>
<li><a href="#configuring-client-certificate-authorization_authz">2.7. Configuring Authorization with Client Certificates</a></li>
<li><a href="#prog_authz_config-authz">2.8. Programmatically Configuring Authorization</a></li>
<li><a href="#executing_secure_caches-authz">2.9. Code Execution with Secure Caches</a></li>
</ul>
</li>
<li><a href="#secure-cluster-transport">3. Encrypting cluster transport</a>
<ul class="sectlevel2">
<li><a href="#securing-cluster-transport-tls-identities_secure-cluster-transport">3.1. Securing cluster transport with TLS identities</a></li>
<li><a href="#jgroups-encryption-protocols_secure-cluster-transport">3.2. JGroups encryption protocols</a></li>
<li><a href="#configuring-jgroups-asym-encrypt_secure-cluster-transport">3.3. Securing cluster transport with asymmetric encryption</a></li>
<li><a href="#configuring-jgroups-sym-encrypt_secure-cluster-transport">3.4. Securing cluster transport with symmetric encryption</a></li>
</ul>
</li>
<li><a href="#ports_protocols">4. Infinispan Ports and Protocols</a>
<ul class="sectlevel2">
<li><a href="#server-ports-protocols_network">4.1. Infinispan Server ports and protocols</a>
<ul class="sectlevel3">
<li><a href="#configuring-firewalls_network">4.1.1. Configuring network firewalls for Infinispan traffic</a></li>
</ul>
</li>
<li><a href="#jgroups-ports_network">4.2. TCP and UDP ports for cluster traffic</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="security"><a class="anchor" href="#security"></a>1. Infinispan Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan provides security for components as well as data across different layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Within the core library to provide role-based access control (RBAC) to CacheManagers, Cache instances, and stored data.</p>
</li>
<li>
<p>Over remote protocols to authenticate client requests and encrypt network traffic.</p>
</li>
<li>
<p>Across nodes in clusters to authenticate new cluster members and encrypt the cluster transport.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Infinispan core library uses standard Java security libraries such as
JAAS, JSSE, JCA, JCE, and SASL to ease integration and improve compatibility
with custom applications and container environments. For this reason, the
Infinispan core library provides only interfaces and a set of basic
implementations.</p>
</div>
<div class="paragraph">
<p>Infinispan servers support a wide range of security standards and mechanisms
to readily integrate with enterprise-level security frameworks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authorization"><a class="anchor" href="#authorization"></a>2. Configuring User Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authorization is a security feature that requires users to have certain permissions before they can access caches or interact with Infinispan resources.
You assign roles to users that provide different levels of permissions, from read-only access to full, super user privileges.</p>
</div>
<div class="sect2">
<h3 id="enabling-authz-authz"><a class="anchor" href="#enabling-authz-authz"></a>2.1. Enabling Authorization in Cache Configuration</h3>
<div class="paragraph">
<p>Use authorization in your cache configuration to restrict user access.
Before they can read or write cache entries, or create and delete caches, users must have a role with a sufficient level of permission.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your <code>infinispan.xml</code> configuration for editing.</p>
</li>
<li>
<p>If it is not already declared, add the <code>&lt;authorization /&gt;</code> tag inside the <code>security</code> elements for the <code>cache-container</code>.</p>
<div class="paragraph">
<p>This enables authorization for the Cache Manager and provides a global set of roles and permissions that caches can inherit.</p>
</div>
</li>
<li>
<p>Add the <code>&lt;authorization /&gt;</code> tag to each cache for which Infinispan restricts access based on user roles.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following configuration example shows how to use implicit authorization configuration with default roles and permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rbac-cache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restricted</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security&gt;</span>
      <span class="comment">&lt;!-- Enable authorization with the default roles and permissions. --&gt;</span>
      <span class="tag">&lt;authorization</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rbac-cache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="comment">&lt;!-- Inherit authorization settings from the cache-container. --&gt;</span>
        <span class="tag">&lt;authorization</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-roles-permissions_authz"><a class="anchor" href="#user-roles-permissions_authz"></a>2.2. User roles and permissions</h3>
<div class="paragraph">
<p>Infinispan includes a default set of roles that grant users with permissions to access data and interact with Infinispan resources.</p>
</div>
<div class="paragraph">
<p><code>ClusterRoleMapper</code> is the default mechanism that Infinispan uses to associate security principals to authorization roles.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>ClusterRoleMapper</code> matches principal names to role names.
A user named <code>admin</code> gets <code>admin</code> permissions automatically, a user named <code>deployer</code> gets <code>deployer</code> permissions, and so on.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superuser with all permissions including control of the Cache Manager lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR, CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and delete Infinispan resources in addition to <code>application</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, ALL_WRITE, LISTEN, EXEC, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read and write access to Infinispan resources in addition to <code>observer</code> permissions. Can also listen to events and execute server tasks and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>observer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ, MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has read access to Infinispan resources in addition to <code>monitor</code> permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view statistics via JMX and the <code>metrics</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs">org.infinispan.security.AuthorizationPermission Enumeration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con_authz-authz"><a class="anchor" href="#con_authz-authz"></a>2.3. How Security Authorization Works</h3>
<div class="paragraph">
<p>Infinispan authorization secures your installation by restricting user access.</p>
</div>
<div class="paragraph">
<p>User applications or clients must belong to a role that is assigned with sufficient permissions before they can perform operations on Cache Managers or caches.</p>
</div>
<div class="paragraph">
<p>For example, you configure authorization on a specific cache instance so that invoking <code>Cache.get()</code> requires an identity to be assigned a role with read permission while <code>Cache.put()</code> requires a role with write permission.</p>
</div>
<div class="paragraph">
<p>In this scenario, if a user application or client with the <code>io</code> role attempts to write an entry, Infinispan denies the request and throws a security exception.
If a user application or client with the <code>writer</code> role sends a write request, Infinispan validates authorization and issues a token for subsequent operations.</p>
</div>
<div class="paragraph">
<div class="title">Identities</div>
<p>Identities are security Principals of type <code>java.security.Principal</code>.
Subjects, implemented with the <code>javax.security.auth.Subject</code> class, represent a group of security Principals.
In other words, a Subject represents a user and all groups to which it belongs.</p>
</div>
<div class="paragraph">
<div class="title">Identities to roles</div>
<p>Infinispan uses role mappers so that security principals correspond to roles,
which you assign one or more permissions.</p>
</div>
<div class="paragraph">
<p>The following image illustrates how security principals correspond to roles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/SecurityRolesPermissions.svg" alt="Roles/Permissions mapping">
</div>
</div>
<div class="sect3">
<h4 id="user-permissions_authz"><a class="anchor" href="#user-permissions_authz"></a>2.3.1. Permissions</h4>
<div class="paragraph">
<p>Authorization roles have different permissions with varying levels of access to Infinispan.
Permissions let you restrict user access to both Cache Managers and caches.</p>
</div>
<div class="sect4">
<h5 id="cache_manager_permissions"><a class="anchor" href="#cache_manager_permissions"></a>Cache Manager permissions</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Permission</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIGURATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defineConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines new cache configurations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stops the Cache Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCache</code>, <code>removeCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and remove container resources  such as caches, counters, schemas, and scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all Cache Manager permissions.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cache_permissions"><a class="anchor" href="#cache_permissions"></a>Cache permissions</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Permission</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>contains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves entries from a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>put</code>, <code>putIfAbsent</code>, <code>replace</code>, <code>remove</code>, <code>evict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes, replaces, removes, evicts data in a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distexec</code>, <code>streams</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows code execution against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers listeners against a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keySet</code>, <code>values</code>, <code>entrySet</code>, <code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk retrieve operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BULK_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clear</code>, <code>putAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes bulk write operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIFECYCLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code>, <code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts and stops a cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getVersion</code>, <code>addInterceptor*</code>, <code>removeInterceptor</code>, <code>getInterceptorChain</code>, <code>getEvictionManager</code>, <code>getComponentRegistry</code>, <code>getDistributionManager</code>, <code>getAuthorizationManager</code>, <code>evict</code>, <code>getRpcManager</code>, <code>getCacheConfiguration</code>, <code>getCacheManager</code>, <code>getInvocationContextContainer</code>, <code>setAvailability</code>, <code>getDataContainer</code>, <code>getStats</code>, <code>getXAResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to underlying components and internal structures.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MONITOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows access to JMX statistics and the <code>metrics</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes all cache permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the READ and BULK_READ permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines the WRITE and BULK_WRITE permissions.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="role-mappers_authz"><a class="anchor" href="#role-mappers_authz"></a>2.3.2. Role Mappers</h4>
<div class="paragraph">
<p>Infinispan includes a <code>PrincipalRoleMapper</code> API that maps security Principals in a Subject to authorization roles that you can assign to users.</p>
</div>
<div class="sect4">
<h5 id="cluster_role_mappers"><a class="anchor" href="#cluster_role_mappers"></a>Cluster role mappers</h5>
<div class="paragraph">
<p><code>ClusterRoleMapper</code> uses a persistent replicated cache to dynamically store principal-to-role mappings for the default roles and permissions.</p>
</div>
<div class="paragraph">
<p>By default uses the Principal name as the role name and implements <code>org.infinispan.security.MutableRoleMapper</code> which exposes methods to change role mappings at runtime.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java class: <code>org.infinispan.security.mappers.ClusterRoleMapper</code></p>
</li>
<li>
<p>Declarative configuration: <code>&lt;cluster-role-mapper /&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="identity_role_mappers"><a class="anchor" href="#identity_role_mappers"></a>Identity role mappers</h5>
<div class="paragraph">
<p><code>IdentityRoleMapper</code> uses the Principal name as the role name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java class: <code>org.infinispan.security.mappers.IdentityRoleMapper</code></p>
</li>
<li>
<p>Declarative configuration: <code>&lt;identity-role-mapper /&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="commonname_role_mappers"><a class="anchor" href="#commonname_role_mappers"></a>CommonName role mappers</h5>
<div class="paragraph">
<p><code>CommonNameRoleMapper</code> uses the Common Name (CN) as the role name if the
Principal name is a Distinguished Name (DN).</p>
</div>
<div class="paragraph">
<p>For example this DN, <code>cn=managers,ou=people,dc=example,dc=com</code>, maps to the <code>managers</code> role.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java class: <code>org.infinispan.security.mappers.CommonRoleMapper</code></p>
</li>
<li>
<p>Declarative configuration: <code>&lt;common-name-role-mapper /&gt;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="custom_role_mappers"><a class="anchor" href="#custom_role_mappers"></a>Custom role mappers</h5>
<div class="paragraph">
<p>Custom role mappers are implementations of <code>org.infinispan.security.PrincipalRoleMapper</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative configuration: <code>&lt;custom-role-mapper class="my.custom.RoleMapper" /&gt;</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/package-summary.html">Infinispan Security API</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/security/PrincipalRoleMapper.html">org.infinispan.security.PrincipalRoleMapper</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acl-cache_authz"><a class="anchor" href="#acl-cache_authz"></a>2.4. Access Control List (ACL) Cache</h3>
<div class="paragraph">
<p>Infinispan caches roles that you grant to users internally for optimal performance.
Whenever you grant or deny roles to users, Infinispan flushes the ACL cache to ensure user permissions are applied correctly.</p>
</div>
<div class="paragraph">
<p>If necessary, you can disable the ACL cache or configure it with the <code>cache-size</code> and <code>cache-timeout</code> attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">cache-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;authorization</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="customizing-authorization_authz"><a class="anchor" href="#customizing-authorization_authz"></a>2.5. Customizing Roles and Permissions</h3>
<div class="paragraph">
<p>You can customize authorization settings in your Infinispan configuration to use role mappers with different combinations of roles and permissions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your <code>infinispan.xml</code> configuration for editing.</p>
</li>
<li>
<p>Configure authorization for the <code>cache-container</code> by declaring a role mapper and a set of roles and permissions.</p>
</li>
<li>
<p>Configure authorization for caches to restrict access based on user roles.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following configuration example shows how to configure security authorization with roles and permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restricted</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom-authorization</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security&gt;</span>
      <span class="tag">&lt;authorization&gt;</span>
        <span class="comment">&lt;!-- Declare a role mapper that associates a security principal
             to each role. --&gt;</span>
        <span class="tag">&lt;identity-role-mapper</span> <span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- Specify user roles and corresponding permissions. --&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">WRITE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supervisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ WRITE EXEC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authorization&gt;</span>
    <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">implicit-authorization</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="comment">&lt;!-- Inherit roles and permissions from the cache-container. --&gt;</span>
        <span class="tag">&lt;authorization</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restricted</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
        <span class="comment">&lt;!-- Explicitly define which roles can access the cache. --&gt;</span>
        <span class="tag">&lt;authorization</span> <span class="attribute-name">roles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin supervisor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disabling-authorization_authz"><a class="anchor" href="#disabling-authorization_authz"></a>2.6. Disabling Security Authorization</h3>
<div class="paragraph">
<p>In local development environments you can disable authorization so that users do not need roles and permissions.
Disabling security authorization means that any user can access data and interact with Infinispan resources.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your <code>infinispan.xml</code> configuration for editing.</p>
</li>
<li>
<p>Remove any <code>authorization</code> elements from the <code>security</code> configuration for the <code>cache-container</code> and each cache configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-client-certificate-authorization_authz"><a class="anchor" href="#configuring-client-certificate-authorization_authz"></a>2.7. Configuring Authorization with Client Certificates</h3>
<div class="paragraph">
<p>Enabling client certificate authentication means you do not need to specify Infinispan user credentials in client configuration, which means you must associate roles with the Common Name (CN) field in the client certificate(s).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide clients with a Java keystore that contains either their public certificates or part of the certificate chain, typically a public CA certificate.</p>
</li>
<li>
<p>Configure Infinispan Server to perform client certificate authentication.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the <code>common-name-role-mapper</code> in the security authorization configuration.</p>
</li>
<li>
<p>Assign the Common Name (<code>CN</code>) from the client certificate a role with the appropriate permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">certificate-authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;security&gt;</span>
     <span class="tag">&lt;authorization&gt;</span>
       <span class="comment">&lt;!-- Declare a role mapper that associates the common name (CN) field
            in client certificate trust stores with authorization roles. --&gt;</span>
       <span class="tag">&lt;common-name-role-mapper</span><span class="tag">/&gt;</span>
       <span class="comment">&lt;!-- In this example, if a client certificate contains `CN=Client1` then
            clients with matching certificates get ALL permissions. --&gt;</span>
       <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Client1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;/authorization&gt;</span>
   <span class="tag">&lt;/security&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="prog_authz_config-authz"><a class="anchor" href="#prog_authz_config-authz"></a>2.8. Programmatically Configuring Authorization</h3>
<div class="paragraph">
<p>When using Infinispan as an embedded library, you can configure authorization
with the <code>GlobalSecurityConfigurationBuilder</code> and <code>ConfigurationBuilder</code>
classes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Construct a <code>GlobalConfigurationBuilder</code> that enables authorization, specifies a role mapper, and defines a set of roles and permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GlobalConfigurationBuilder global = <span class="keyword">new</span> GlobalConfigurationBuilder();
global
   .security()
      .authorization().enable() <i class="conum" data-value="1"></i><b>(1)</b>
         .principalRoleMapper(<span class="keyword">new</span> IdentityRoleMapper()) <i class="conum" data-value="2"></i><b>(2)</b>
         .role(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
            .permission(AuthorizationPermission.ALL)
         .role(<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>)
            .permission(AuthorizationPermission.READ)
         .role(<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span>)
            .permission(AuthorizationPermission.WRITE)
         .role(<span class="string"><span class="delimiter">&quot;</span><span class="content">supervisor</span><span class="delimiter">&quot;</span></span>)
            .permission(AuthorizationPermission.READ)
            .permission(AuthorizationPermission.WRITE)
            .permission(AuthorizationPermission.EXEC);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables Infinispan authorization for the Cache Manager.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies an implementation of <code>PrincipalRoleMapper</code> that maps Principals
to roles.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines roles and their associated permissions.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enable authorization in the <code>ConfigurationBuilder</code> for caches to restrict access based on user roles.</p>
<div class="listingblock">
<div class="content">
<pre>ConfigurationBuilder config = new ConfigurationBuilder();
config
   .security()
      .authorization()
         .enable(); <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Implicitly adds all roles from the global configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you do not want to apply all roles to a cache, explicitly define the roles
that are authorized for caches as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ConfigurationBuilder config = new ConfigurationBuilder();
config
   .security()
      .authorization()
         .enable()
         .role("admin") <i class="conum" data-value="1"></i><b>(1)</b>
         .role("supervisor")
         .role("reader");</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines authorized roles for the cache. In this example, users who have the <code>writer</code> role only are not authorized for the "secured" cache. Infinispan denies any access requests from those users.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/global/GlobalSecurityConfigurationBuilder.html">org.infinispan.configuration.global.GlobalSecurityConfigurationBuilder</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/configuration/cache/ConfigurationBuilder.html">org.infinispan.configuration.cache.ConfigurationBuilder</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="executing_secure_caches-authz"><a class="anchor" href="#executing_secure_caches-authz"></a>2.9. Code Execution with Secure Caches</h3>
<div class="paragraph">
<p>When you configure Infinispan authorization and then construct a
<code>DefaultCacheManager</code>, it returns a <code>SecureCache</code> that checks the security
context before invoking any operations on the underlying caches. A
<code>SecureCache</code> also ensures that applications cannot retrieve lower-level
insecure objects such as <code>DataContainer</code>. For this reason, you must execute
code with an identity that has the required authorization.</p>
</div>
<div class="paragraph">
<p>In Java, executing code with a specific identity usually means wrapping the
code to be executed within a <code>PrivilegedAction</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.security.Security</span>;

<span class="predefined-type">Security</span>.doAs(subject, <span class="keyword">new</span> <span class="predefined-type">PrivilegedExceptionAction</span>&lt;<span class="predefined-type">Void</span>&gt;() {
<span class="directive">public</span> <span class="predefined-type">Void</span> run() <span class="directive">throws</span> <span class="exception">Exception</span> {
    cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>);
}
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>With Java 8, you can simplify the preceding call as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Security</span>.doAs(mySubject, <span class="predefined-type">PrivilegedAction</span>&lt;<span class="predefined-type">String</span>&gt;() -&gt; cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding call uses the <code>Security.doAs()</code> method instead of
<code>Subject.doAs()</code>. You can use either method with Infinispan, however
<code>Security.doAs()</code> provides better performance.</p>
</div>
<div class="paragraph">
<p>If you need the current Subject, use the following call to retrieve it from the
Infinispan context or from the AccessControlContext:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Security</span>.getSubject();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="secure-cluster-transport"><a class="anchor" href="#secure-cluster-transport"></a>3. Encrypting cluster transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Secure cluster transport so that nodes communicate with encrypted messages.
You can also configure Infinispan clusters to perform certificate authentication so that only nodes with valid identities can join.</p>
</div>
<div class="sect2">
<h3 id="securing-cluster-transport-tls-identities_secure-cluster-transport"><a class="anchor" href="#securing-cluster-transport-tls-identities_secure-cluster-transport"></a>3.1. Securing cluster transport with TLS identities</h3>
<div class="paragraph">
<p>Add SSL/TLS identities to a Infinispan Server security realm and use them to secure cluster transport.
Nodes in the Infinispan Server cluster then exchange SSL/TLS certificates to encrypt JGroups messages, including RELAY messages if you configure cross-site replication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install a Infinispan Server cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a TLS keystore that contains a single certificate to identify Infinispan Server.</p>
<div class="paragraph">
<p>You can also use a PEM file if it contains a private key in PKCS#1 or PKCS#8 format, a certificate, and has an empty password: <code>password=""</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the certificate in the keystore is not signed by a public certificate authority (CA) then you must also create a trust store that contains either the signing certificate or the public key.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the keystore to the <code>$ISPN_HOME/server/conf</code> directory.</p>
</li>
<li>
<p>Add the keystore to a new security realm in your Infinispan Server configuration.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should create dedicated keystores and security realms so that Infinispan Server endpoints do not use the same security realm as cluster transport.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;security</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0 https://infinispan.org/schemas/infinispan-server-13.0.xsd</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:13.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;security-realms&gt;</span>
    <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster-transport</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
          <span class="comment">&lt;!-- Adds a keystore that contains a certificate that provides
               SSL/TLS identity to encrypt cluster transport. --&gt;</span>
          <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.pfx</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.server.config.path</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
      <span class="tag">&lt;/server-identities&gt;</span>
    <span class="tag">&lt;/security-realm&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/security&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configure cluster transport to use the security realm by specifying the name of the security realm with the <code>server:security-realm</code> attribute.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;cache-container&gt;</span>
  <span class="tag">&lt;transport</span> <span class="attribute-name">server:security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster-transport</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start Infinispan Server, the following log message indicates that the cluster is using the security realm for cluster transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.SERVER] ISPN080060: SSL Transport using realm &lt;security_realm_name&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-encryption-protocols_secure-cluster-transport"><a class="anchor" href="#jgroups-encryption-protocols_secure-cluster-transport"></a>3.2. JGroups encryption protocols</h3>
<div class="paragraph">
<p>To secure cluster traffic, you can configure Infinispan nodes to encrypt JGroups message payloads with secret keys.</p>
</div>
<div class="paragraph">
<p>Infinispan nodes can obtain secret keys from either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The coordinator node (asymmetric encryption).</p>
</li>
<li>
<p>A shared keystore (symmetric encryption).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from coordinator nodes</div>
<p>You configure asymmetric encryption by adding the <code>ASYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to generate and distribute secret keys.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using asymmetric encryption, you should also provide keystores so that nodes can perform certificate authentication and securely exchange secret keys.
This protects your cluster from man-in-the-middle (MitM) attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Asymmetric encryption secures cluster traffic as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first node in the Infinispan cluster, the coordinator node, generates a secret key.</p>
</li>
<li>
<p>A joining node performs certificate authentication with the coordinator to mutually verify identity.</p>
</li>
<li>
<p>The joining node requests the secret key from the coordinator node. That request includes the public key for the joining node.</p>
</li>
<li>
<p>The coordinator node encrypts the secret key with the public key and returns it to the joining node.</p>
</li>
<li>
<p>The joining node decrypts and installs the secret key.</p>
</li>
<li>
<p>The node joins the cluster, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Retrieving secret keys from shared keystores</div>
<p>You configure symmetric encryption by adding the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.
This allows Infinispan clusters to obtain secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Nodes install the secret key from a keystore on the Infinispan classpath at startup.</p>
</li>
<li>
<p>Node join clusters, encrypting and decrypting messages with the secret key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Comparison of asymmetric and symmetric encryption</div>
<p><code>ASYM_ENCRYPT</code> with certificate authentication provides an additional layer of encryption in comparison with <code>SYM_ENCRYPT</code>.
You provide keystores that encrypt the requests to coordinator nodes for the secret key.
Infinispan automatically generates that secret key and handles cluster traffic, while letting you specify when to generate secret keys.
For example, you can configure clusters to generate new secret keys when nodes leave.
This ensures that nodes cannot bypass certificate authentication and join with old keys.</p>
</div>
<div class="paragraph">
<p><code>SYM_ENCRYPT</code>, on the other hand, is faster than <code>ASYM_ENCRYPT</code> because nodes do not need to exchange keys with the cluster coordinator.
A potential drawback to <code>SYM_ENCRYPT</code> is that there is no configuration to automatically generate new secret keys when cluster membership changes.
Users are responsible for generating and distributing the secret keys that nodes use to encrypt cluster traffic.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-jgroups-asym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-asym-encrypt_secure-cluster-transport"></a>3.3. Securing cluster transport with asymmetric encryption</h3>
<div class="paragraph">
<p>Configure Infinispan clusters to generate and distribute secret keys that encrypt JGroups messages.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore with certificate chains that enables Infinispan to verify node identity.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SSL_KEY_EXCHANGE</code> and <code>ASYM_ENCRYPT</code> protocols to a JGroups stack in your Infinispan configuration, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a secure JGroups stack named &quot;encrypt-tcp&quot; that extends the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Adds a keystore that nodes use to perform certificate authentication. --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert SSL_KEY_EXCHANGE into the default TCP stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SSL_KEY_EXCHANGE</span> <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mykeystore.jks</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">keystore_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Configures ASYM_ENCRYPT --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert ASYM_ENCRYPT into the default TCP stack before pbcast.NAKACK2. --&gt;</span>
      <span class="comment">&lt;!-- The use_external_key_exchange = &quot;true&quot; attribute configures nodes to use the `SSL_KEY_EXCHANGE` protocol for certificate authentication. --&gt;</span>
      <span class="tag">&lt;ASYM_ENCRYPT</span> <span class="attribute-name">asym_keylength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2048</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">asym_algorithm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RSA</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">change_key_on_coord_leave</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">change_key_on_leave</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">use_external_key_exchange</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_BEFORE</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Configures the cluster to use the JGroups stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>ASYM_ENCRYPT</code> and can obtain the secret key from the coordinator node.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.jgroups.protocols.ASYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html">JGroups 4 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-4.2.xsd">JGroups 4.2 Schema</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-jgroups-sym-encrypt_secure-cluster-transport"><a class="anchor" href="#configuring-jgroups-sym-encrypt_secure-cluster-transport"></a>3.4. Securing cluster transport with symmetric encryption</h3>
<div class="paragraph">
<p>Configure Infinispan clusters to encrypt JGroups messages with secret keys from keystores that you provide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a keystore that contains a secret key.</p>
</li>
<li>
<p>Place the keystore on the classpath for each node in the cluster.</p>
<div class="paragraph">
<p>For Infinispan Server, you put the keystore in the $ISPN_HOME directory.</p>
</div>
</li>
<li>
<p>Add the <code>SYM_ENCRYPT</code> protocol to a JGroups stack in your Infinispan configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="comment">&lt;!-- Creates a secure JGroups stack named &quot;encrypt-tcp&quot; that extends the default TCP stack. --&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="comment">&lt;!-- Adds a keystore from which nodes obtain secret keys. --&gt;</span>
      <span class="comment">&lt;!-- Uses the stack.combine and stack.position attributes to insert SYM_ENCRYPT into the default TCP stack after VERIFY_SUSPECT. --&gt;</span>
      <span class="tag">&lt;SYM_ENCRYPT</span> <span class="attribute-name">keystore_name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKeystore.p12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">keystore_type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">store_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">key_password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKey</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT_AFTER</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Configures the cluster to use the JGroups stack. --&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.cluster.name}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encrypt-tcp</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">node-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${infinispan.node.name:}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>When you start your Infinispan cluster, the following log message indicates that the cluster is using the secure JGroups stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">[org.infinispan.CLUSTER] ISPN000078: Starting JGroups channel cluster with stack &lt;encrypted_stack_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan nodes can join the cluster only if they use <code>SYM_ENCRYPT</code> and can obtain the secret key from the shared keystore.
Otherwise the following message is written to Infinispan logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[org.jgroups.protocols.SYM_ENCRYPT] &lt;hostname&gt;: received message without encrypt header from &lt;hostname&gt;; dropping it</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html">JGroups 4 Manual</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/schema/jgroups-4.2.xsd">JGroups 4.2 Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ports_protocols"><a class="anchor" href="#ports_protocols"></a>4. Infinispan Ports and Protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As Infinispan distributes data across your network and can establish
connections for external client requests, you should be aware of the ports and
protocols that Infinispan uses to handle network traffic.</p>
</div>
<div class="paragraph">
<p>If run Infinispan as a remote server then you might need to allow remote
clients through your firewall. Likewise, you should adjust ports that
Infinispan nodes use for cluster communication to prevent conflicts or network
issues.</p>
</div>
<div class="sect2">
<h3 id="server-ports-protocols_network"><a class="anchor" href="#server-ports-protocols_network"></a>4.1. Infinispan Server ports and protocols</h3>
<div class="paragraph">
<p>Infinispan Server provides network endpoints that allow client access with different protocols.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11222</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hot Rod and REST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11221</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memcached (disabled by default)</p></td>
</tr>
</tbody>
</table>
<h4 id="single_port" class="discrete">Single port</h4>
<div class="paragraph">
<p>Infinispan Server exposes multiple protocols through a single TCP port, <code>11222</code>.
Handling multiple protocols with a single port simplifies configuration and reduces management complexity when deploying Infinispan clusters.
Using a single port also enhances security by minimizing the attack surface on the network.</p>
</div>
<div class="paragraph">
<p>Infinispan Server handles HTTP/1.1, HTTP/2, and Hot Rod protocol requests from clients via the single port in different ways.</p>
</div>
<div class="paragraph">
<div class="title">HTTP/1.1 upgrade headers</div>
<p>Client requests can include the <code>HTTP/1.1 upgrade</code> header field to initiate
HTTP/1.1 connections with Infinispan Server.
Client applications can then send the <code>Upgrade: protocol</code> header field, where <code>protocol</code> is a server endpoint.</p>
</div>
<div class="paragraph">
<div class="title">Application-Layer Protocol Negotiation (ALPN)/Transport Layer Security (TLS)</div>
<p>Client requests include Server Name Indication (SNI) mappings for Infinispan Server endpoints to negotiate protocols over a TLS connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications must use a TLS library that supports the ALPN extension.
Infinispan uses WildFly OpenSSL bindings for Java.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Automatic Hot Rod detection</div>
<p>Client requests that include Hot Rod headers automatically route to Hot Rod endpoints.</p>
</div>
<div class="sect3">
<h4 id="configuring-firewalls_network"><a class="anchor" href="#configuring-firewalls_network"></a>4.1.1. Configuring network firewalls for Infinispan traffic</h4>
<div class="paragraph">
<p>Adjust firewall rules to allow traffic between Infinispan Server and client applications.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On Red Hat Enterprise Linux (RHEL) workstations, for example, you can allow
traffic to port <code>11222</code> with firewalld as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash"># firewall-cmd --add-port=11222/tcp --permanent
success
# firewall-cmd --list-ports | grep 11222
11222/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure firewall rules that apply across a network, you can use the
nftables utility.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jgroups-ports_network"><a class="anchor" href="#jgroups-ports_network"></a>4.2. TCP and UDP ports for cluster traffic</h3>
<div class="paragraph">
<p>Infinispan uses the following ports for cluster transport messages:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP/UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster bind port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>46655</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups multicast</p></td>
</tr>
</tbody>
</table>
<h4 id="cross_site_replication" class="discrete">Cross-site replication</h4>
<div class="paragraph">
<p>Infinispan uses the following ports for the JGroups RELAY2 protocol:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>7900</code></dt>
<dd>
<p>For Infinispan clusters running on Kubernetes.</p>
</dd>
<dt class="hdlist1"><code>7800</code></dt>
<dd>
<p>If using UDP for traffic between nodes and TCP for traffic between clusters.</p>
</dd>
<dt class="hdlist1"><code>7801</code></dt>
<dd>
<p>If using TCP for traffic between nodes and TCP for traffic between clusters.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-17 14:46:55 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>