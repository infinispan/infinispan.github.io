<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Infinispan Cross-Site Replication</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="https://infinispan.org/docs/stable/index.html">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css">
<link rel="stylesheet" href="../../css/css.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
<script src="../../js/js.js"></script>
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Infinispan Cross-Site Replication</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#cross-site-replication">1. Cross-site replication</a>
<ul class="sectlevel2">
<li><a href="#cross-site-replication_cross-site-replication">1.1. Cross-site replication</a></li>
<li><a href="#cross-site-relay-nodes_cross-site-replication">1.2. Relay nodes</a></li>
<li><a href="#cross-site-backups_cross-site-replication">1.3. Infinispan cache backups</a></li>
<li><a href="#cross-site-backup-strategies_cross-site-replication">1.4. Backup strategies</a></li>
<li><a href="#cross-site-automatic-offline_cross-site-replication">1.5. Automatic offline parameters for backup locations</a></li>
<li><a href="#cross-site-state-transfer_cross-site-replication">1.6. State transfer</a></li>
<li><a href="#cross-site-client-connections_cross-site-replication">1.7. Client connections across sites</a>
<ul class="sectlevel3">
<li><a href="#concurrent-writes-conflicting-entries_cross-site-replication">1.7.1. Concurrent writes and conflicting entries</a></li>
</ul>
</li>
<li><a href="#cross-site-expiration_cross-site-replication">1.8. Expiration with cross-site replication</a></li>
</ul>
</li>
<li><a href="#configuring-cross-site-replication">2. Configuring Infinispan cross-site replication</a>
<ul class="sectlevel2">
<li><a href="#configuring-cluster-transport-cross-site_configuring-cross-site-replication">2.1. Configuring cluster transport for cross-site replication</a>
<ul class="sectlevel3">
<li><a href="#custom-jgroups-relay-stacks_configuring-cross-site-replication">2.1.1. Custom JGroups RELAY2 stacks</a></li>
</ul>
</li>
<li><a href="#adding-backup-locations-caches_configuring-cross-site-replication">2.2. Adding backup locations to caches</a></li>
<li><a href="#backing-up-caches-different-names_configuring-cross-site-replication">2.3. Backing up to caches with different names</a></li>
<li><a href="#configuring-state-transfer_configuring-cross-site-replication">2.4. Configuring cross-site state transfer</a></li>
<li><a href="#configuring-conflict-resolution_configuring-cross-site-replication">2.5. Configuring conflict resolution algorithms</a></li>
<li><a href="#verifying-cross-site-views_configuring-cross-site-replication">2.6. Verifying cross-site views</a></li>
<li><a href="#configuring-hot-rod-clients-cross-site_configuring-cross-site-replication">2.7. Configuring Hot Rod clients for cross-site replication</a></li>
</ul>
</li>
<li><a href="#cross-site-operations-cli">3. Performing cross-site operations with the CLI</a>
<ul class="sectlevel2">
<li><a href="#bringing-backup-locations-offline-online_cross-site-operations-cli">3.1. Bringing backup locations offline and online</a></li>
<li><a href="#configuring-cross-site-state-transfer-modes_cross-site-operations-cli">3.2. Configuring cross-site state transfer modes</a></li>
<li><a href="#pushing-cross-site-state-transfer_cross-site-operations-cli">3.3. Pushing state to backup locations</a></li>
</ul>
</li>
<li><a href="#cross-site-operations-rest">4. Performing cross-site operations with the REST API</a>
<ul class="sectlevel2">
<li><a href="#rest_v2_xsite_sites_status">4.1. Getting status of all backup locations</a></li>
<li><a href="#rest_v2_xsite_site_status">4.2. Getting status of specific backup locations</a></li>
<li><a href="#rest_v2_xsite_take_site_offline">4.3. Taking backup locations offline</a></li>
<li><a href="#rest_v2_xsite_bring_backup_online">4.4. Bringing backup locations online</a></li>
<li><a href="#rest_v2_xsite_start_push">4.5. Pushing state to backup locations</a></li>
<li><a href="#rest_v2_xsite_cancel_state_push">4.6. Canceling state transfer</a></li>
<li><a href="#rest_v2_xsite_state_push">4.7. Getting state transfer status</a></li>
<li><a href="#rest_v2_xsite_clear_transfer_status">4.8. Clearing state transfer status</a></li>
<li><a href="#rest_v2_xsite_tuning_takeoffline">4.9. Modifying take offline conditions</a></li>
<li><a href="#rest_v2_xsite_cancel_receive_state">4.10. Canceling state transfer from receiving sites</a></li>
<li><a href="#rest_v2_cache_manager_site_status">4.11. Getting status of backup locations</a></li>
<li><a href="#rest_v2_cache_manager_take_offline">4.12. Taking backup locations offline</a></li>
<li><a href="#rest_v2_cache_manager_bring_online">4.13. Bringing backup locations online</a></li>
<li><a href="#rest_v2_cache_manager_get_state_transfer_mode">4.14. Retrieving the state transfer mode</a></li>
<li><a href="#rest_v2_cache_manager_set_state_transfer_mode">4.15. Setting the state transfer mode</a></li>
<li><a href="#rest_v2_cache_manager_start_push">4.16. Starting state transfer</a></li>
<li><a href="#rest_v2_cache_manager_cancel_push">4.17. Canceling state transfer</a></li>
</ul>
</li>
<li><a href="#cross-site-operations-jmx">5. Performing cross-site operations via JMX</a>
<ul class="sectlevel2">
<li><a href="#enabling-jmx_cross-site-operations-jmx">5.1. Registering JMX MBeans</a></li>
<li><a href="#performing-cross-site-operations-jmx_cross-site-operations-jmx">5.2. Performing cross-site operations with JMX clients</a></li>
<li><a href="#cross-site-jmx-mbeans_cross-site-operations-jmx">5.3. JMX MBeans for cross-site replication</a></li>
</ul>
</li>
<li><a href="#cross-site-replication-logs">6. Cross-site replication log messages</a>
<ul class="sectlevel2">
<li><a href="#cross-site-replication-log-messages_cross-site-replication-logs">6.1. Infinispan log messages for cross-site replication</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Find out how Infinispan performs cross-site replication so you can get optimal
performance and avoid issues. Learn how to configure Infinispan to back up
data to remote clusters. Follow procedures to transfer state from one cluster
to another, take sites offline, and so on.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-site-replication"><a class="anchor" href="#cross-site-replication"></a>1. Cross-site replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replicate data across Infinispan clusters in multiple geographic regions to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure service continuity in the event of data center outages.</p>
</li>
<li>
<p>Present a single, unified caching service to client applications that consists of different clusters across multiple host platforms.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="cross-site-replication_cross-site-replication"><a class="anchor" href="#cross-site-replication_cross-site-replication"></a>1.1. Cross-site replication</h3>
<div class="paragraph">
<p>Infinispan clusters running in different locations can discover and
communicate with each other.</p>
</div>
<div class="paragraph">
<p>Sites are typically data centers in various geographic locations. Cross-site
replication bridges Infinispan clusters in sites to form global clusters, as
in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite.svg" alt="xsite">
</div>
</div>
<div class="paragraph">
<p><strong>LON</strong> is a datacenter in London, England.<br>
<strong>NYC</strong> is a datacenter in New York City, USA.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Infinispan can form global clusters across two or more sites.</p>
</div>
<div class="paragraph">
<p>For example, configure a third Infinispan cluster running in San Francisco,
<strong>SFO</strong>, as backup location for <strong>LON</strong> and <strong>NYC</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-relay-nodes_cross-site-replication"><a class="anchor" href="#cross-site-relay-nodes_cross-site-replication"></a>1.2. Relay nodes</h3>
<div class="paragraph">
<p>Relay nodes are the nodes in Infinispan clusters that are responsible for sending and receiving requests from backup locations.</p>
</div>
<div class="paragraph">
<p>If a node is not a relay node, it must forward backup requests to a local relay node.
Only relay nodes can send requests to backup locations.</p>
</div>
<div class="paragraph">
<p>For optimal performance, you should configure all nodes as relay nodes.
This increases the speed of backup requests because each node in the cluster can backup to remote sites directly without having to forward backup requests to local relay nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Diagrams in this document illustrate Infinispan clusters with one relay node because this is the default for the JGroups RELAY2 protocol.
Likewise, a single relay node is easier to illustrate because each relay node in a cluster communicates with each relay node in the remote cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JGroups configuration refers to relay nodes as "site master" nodes.
Infinispan uses relay node instead because it is more descriptive and presents a more intuitive choice for our users.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-backups_cross-site-replication"><a class="anchor" href="#cross-site-backups_cross-site-replication"></a>1.3. Infinispan cache backups</h3>
<div class="paragraph">
<p>Infinispan caches include a <code>backups</code> configuration that let you name remote sites as backup locations.</p>
</div>
<div class="paragraph">
<p>For example, the following diagram shows three caches, "customers", "eu-orders", and "us-orders":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite-caches.svg" alt="xsite caches">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In <strong>LON</strong>, "customers" names <strong>NYC</strong> as a backup location.</p>
</li>
<li>
<p>In <strong>NYC</strong>, "customers" names <strong>LON</strong> as a backup location.</p>
</li>
<li>
<p>"eu-orders" and "us-orders" do not have backups and are local to the respective cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-backup-strategies_cross-site-replication"><a class="anchor" href="#cross-site-backup-strategies_cross-site-replication"></a>1.4. Backup strategies</h3>
<div class="paragraph">
<p>Infinispan replicates data between clusters at the same time that writes to caches occur.
For example, if a client writes "k1" to <strong>LON</strong>, Infinispan backs up "k1" to <strong>NYC</strong> at the same time.</p>
</div>
<div class="paragraph">
<p>To back up data to a different cluster, Infinispan can use either a synchronous or asynchronous strategy.</p>
</div>
<h4 id="synchronous_strategy" class="discrete">Synchronous strategy</h4>
<div class="paragraph">
<p>When Infinispan replicates data to backup locations, it writes to the cache on the local cluster and the cache on the remote cluster concurrently.
With the synchronous strategy, Infinispan waits for both write operations to complete before returning.</p>
</div>
<div class="paragraph">
<p>You can control how Infinispan handles writes to the cache on the local cluster if backup operations fail.
Infinispan can do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ignore the failed backup and silently continue the write to the local cluster.</p>
</li>
<li>
<p>Log a warning message or throw an exception and continue the write to the local cluster.</p>
</li>
<li>
<p>Handle failed backup operations with custom logic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Synchronous backups also support two-phase commits with caches that participate in optimistic transactions.
The first phase of the backup acquires a lock.
The second phase commits the modification.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Two-phase commit with cross-site replication has a significant performance impact because it requires two round-trips across the network.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="asynchronous_strategy" class="discrete">Asynchronous strategy</h4>
<div class="paragraph">
<p>When Infinispan replicates data to backup locations, it does not wait until the operation completes before writing to the local cache.</p>
</div>
<div class="paragraph">
<p>Asynchronous backup operations and writes to the local cache are independent of each other.
If backup operations fail, write operations to the local cache continue and no exceptions occur.
When this happens Infinispan also retries the write operation until the remote cluster disconnects from the cross-site view.</p>
</div>
<h4 id="synchronous_vs_asynchronous_backups" class="discrete">Synchronous vs asynchronous backups</h4>
<div class="paragraph">
<p>Synchronous backups offer the strongest guarantee of data consistency across sites.
If <code>strategy=sync</code>, when <code>cache.put()</code> calls return you know the value is up to date in the local cache and in the backup locations.</p>
</div>
<div class="paragraph">
<p>The trade-off for this consistency is performance.
Synchronous backups have much greater latency in comparison to asynchronous backups.</p>
</div>
<div class="paragraph">
<p>Asynchronous backups, on the other hand, do not add latency to client requests so they have no performance impact.
However, if <code>strategy=async</code>, when <code>cache.put()</code> calls return you cannot be sure of that the value in the backup location is the same as in the local cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-automatic-offline_cross-site-replication"><a class="anchor" href="#cross-site-automatic-offline_cross-site-replication"></a>1.5. Automatic offline parameters for backup locations</h3>
<div class="paragraph">
<p>Operations to replicate data across clusters are resource intensive, using excessive RAM and CPU.
To avoid wasting resources Infinispan can take backup locations offline when they stop accepting requests after a specific period of time.</p>
</div>
<div class="paragraph">
<p>Infinispan takes remote sites offline based on the number of failed sequential requests and the time interval since the first failure.
Requests are failed when the target cluster does not have any nodes in the cross-site view (JGroups bridge) or when a timeout expires before the target cluster acknowledges the request.</p>
</div>
<h4 id="backup_timeouts" class="discrete">Backup timeouts</h4>
<div class="paragraph">
<p>Backup configurations include timeout values for operations to replicate data between clusters.
If operations do not complete before the timeout expires, Infinispan records them as failures.</p>
</div>
<div class="paragraph">
<p>In the following example, operations to replicate data to NYC are recorded as failures if they do not complete after 10 seconds:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributedCache</span>:
  <span class="key">backups</span>:
    <span class="key">NYC</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        <span class="key">timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<h4 id="number_of_failures" class="discrete">Number of failures</h4>
<div class="paragraph">
<p>You can specify the number of <strong>consecutive</strong> failures that can occur before
backup locations go offline.</p>
</div>
<div class="paragraph">
<p>In the following example, if a cluster attempts to replicate data to NYC and five consecutive operations fail, NYC automatically goes offline:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;take-offline</span> <span class="attribute-name">after-failures</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/backup&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">take-offline</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">after-failures</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributedCache</span>:
  <span class="key">backups</span>:
    <span class="key">NYC</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        <span class="key">timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>
        <span class="key">takeOffline</span>:
          <span class="key">afterFailures</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<h4 id="time_to_wait" class="discrete">Time to wait</h4>
<div class="paragraph">
<p>You can also specify how long to wait before taking sites offline when backup operations fail.
If a backup request succeeds before the wait time runs out, Infinispan does not take the site offline.</p>
</div>
<div class="paragraph">
<p>One or two minutes is generally a suitable time to wait before automatically taking backup locations offline.
If the wait period is too short then backup locations go offline too soon.
You then need to bring clusters back online and perform state transfer operations to ensure data is in sync between the clusters.</p>
</div>
<div class="paragraph">
<p>A negative or zero value for the number of failures is equivalent to a value of <code>1</code>.
Infinispan uses only a minimum time to wait to take backup locations offline after a failure occurs, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;take-offline</span> <span class="attribute-name">after-failures</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">min-wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following example, if a cluster attempts to replicate data to NYC and there are more than five consecutive failures and 15 seconds elapse after the first failed operation, NYC automatically goes offline:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;take-offline</span> <span class="attribute-name">after-failures</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min-wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">15000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/backup&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">take-offline</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">after-failures</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">min-wait</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">15000</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributedCache</span>:
  <span class="key">backups</span>:
    <span class="key">NYC</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        <span class="key">timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>
        <span class="key">takeOffline</span>:
          <span class="key">afterFailures</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
          <span class="key">minWait</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">15000</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-state-transfer_cross-site-replication"><a class="anchor" href="#cross-site-state-transfer_cross-site-replication"></a>1.6. State transfer</h3>
<div class="paragraph">
<p>State transfer is an administrative operation that synchronizes data between
sites.</p>
</div>
<div class="paragraph">
<p>For example, <strong>LON</strong> goes offline and <strong>NYC</strong> starts handling client requests.
When you bring <strong>LON</strong> back online, the Infinispan cluster in <strong>LON</strong> does not
have the same data as the cluster in <strong>NYC</strong>.</p>
</div>
<div class="paragraph">
<p>To ensure the data is consistent between <strong>LON</strong> and <strong>NYC</strong>, you can push
state from <strong>NYC</strong> to <strong>LON</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>State transfer is bidirectional. For example, you can push state from <strong>NYC</strong>
to <strong>LON</strong> or from <strong>LON</strong> to <strong>NYC</strong>.</p>
</li>
<li>
<p>Pushing state to offline sites brings them back online.</p>
</li>
<li>
<p>State transfer overwrites only data that exists on both sites, the originating site and the receiving site. Infinispan does not delete data.</p>
<div class="paragraph">
<p>For example, "k2" exists on <strong>LON</strong> and <strong>NYC</strong>. "k2" is removed from <strong>NYC</strong>
while <strong>LON</strong> is offline. When you bring <strong>LON</strong> back online, "k2" still exists
at that location. If you push state from <strong>NYC</strong> to <strong>LON</strong>, the transfer does
not affect "k2" on <strong>LON</strong>.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To ensure contents of the cache are identical after state transfer, remove all
data from the cache on the receiving site before pushing state.</p>
</div>
<div class="paragraph">
<p>Use the <code>clear()</code> method or the <code class="command">clearcache</code> command from the CLI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>State transfer does not overwrite updates to data that occur after you
initiate the push.</p>
<div class="paragraph">
<p>For example, "k1,v1" exists on <strong>LON</strong> and <strong>NYC</strong>. <strong>LON</strong> goes offline so you
push state transfer to <strong>LON</strong> from <strong>NYC</strong>, which brings <strong>LON</strong> back online.
Before state transfer completes, a client puts "k1,v2" on <strong>LON</strong>.</p>
</div>
<div class="paragraph">
<p>In this case the state transfer from <strong>NYC</strong> does not overwrite "k1,v2" because
that modification happened after you initiated the push.</p>
</div>
</li>
</ul>
</div>
<h4 id="automatic_state_transfer" class="discrete">Automatic state transfer</h4>
<div class="paragraph">
<p>By default you must manually perform cross-site state transfer operations with the CLI or via JMX or REST.</p>
</div>
<div class="paragraph">
<p>However, when using the asynchronous backup strategy, Infinispan can automatically perform cross-site state transfer operations.
When it detects that a backup location has come back online, and the network connection is stable, Infinispan initiates bi-directional state transfer between backup locations.
For example, Infinispan simultaneously transfers state from <strong>LON</strong> to <strong>NYC</strong> and <strong>NYC</strong> to <strong>LON</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid temporary network disconnects triggering state transfer operations, there are two conditions that backup locations must meet to go offline.
The status of a backup location must be offline and it must not be included in the cross-site view with JGroups RELAY2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/Cache.html#clear()">org.infinispan.Cache.clear()</a></p>
</li>
<li>
<p><a href="../cli/cli.html">Using the Infinispan Command Line Interface</a></p>
</li>
<li>
<p><a href="../rest/rest.html">Infinispan REST API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-client-connections_cross-site-replication"><a class="anchor" href="#cross-site-client-connections_cross-site-replication"></a>1.7. Client connections across sites</h3>
<div class="paragraph">
<p>Clients can write to Infinispan clusters in either an Active/Passive or
Active/Active configuration.</p>
</div>
<h4 id="activepassive" class="discrete">Active/Passive</h4>
<div class="paragraph">
<p>The following diagram illustrates Active/Passive where Infinispan handles
client requests from one site only:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite-active-passive.svg" alt="xsite active passive">
</div>
</div>
<div class="paragraph">
<p>In the preceding image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client connects to the Infinispan cluster at <strong>LON</strong>.</p>
</li>
<li>
<p>Client writes "k1" to the cache.</p>
</li>
<li>
<p>The relay node at <strong>LON</strong>, "n1", sends the request to replicate "k1" to the relay node at <strong>NYC</strong>, "nA".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With Active/Passive, <strong>NYC</strong> provides data redundancy. If the Infinispan
cluster at <strong>LON</strong> goes offline for any reason, clients can start sending
requests to <strong>NYC</strong>. When you bring <strong>LON</strong> back online you can synchronize
data with <strong>NYC</strong> and then switch clients back to <strong>LON</strong>.</p>
</div>
<h4 id="activeactive" class="discrete">Active/Active</h4>
<div class="paragraph">
<p>The following diagram illustrates Active/Active where Infinispan handles
client requests at two sites:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/xsite-active-active.svg" alt="xsite active active">
</div>
</div>
<div class="paragraph">
<p>In the preceding image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client A connects to the Infinispan cluster at <strong>LON</strong>.</p>
</li>
<li>
<p>Client A writes "k1" to the cache.</p>
</li>
<li>
<p>Client B connects to the Infinispan cluster at <strong>NYC</strong>.</p>
</li>
<li>
<p>Client B writes "k2" to the cache.</p>
</li>
<li>
<p>Relay nodes at <strong>LON</strong> and <strong>NYC</strong> send requests so that "k1" is replicated to <strong>NYC</strong> and "k2" is replicated to <strong>LON</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With Active/Active both <strong>NYC</strong> and <strong>LON</strong> replicate data to remote caches
while handling client requests. If either <strong>NYC</strong> or <strong>LON</strong> go offline,
clients can start sending requests to the online site. You can then bring
offline sites back online, push state to synchronize data, and switch clients
as required.</p>
</div>
<h4 id="backup_strategies_and_client_connections" class="discrete">Backup strategies and client connections</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An asynchronous backup strategy (<code>strategy=async</code>) is recommended with Active/Active configurations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple clients attempt to write to the same entry concurrently, and the backup strategy is synchronous (<code>strategy=sync</code>), then deadlocks occur.
However you can use the synchronous backup strategy with an Active/Passive configuration if both sites access different data sets, in which case there is no risk of deadlocks from concurrent writes.</p>
</div>
<div class="sect3">
<h4 id="concurrent-writes-conflicting-entries_cross-site-replication"><a class="anchor" href="#concurrent-writes-conflicting-entries_cross-site-replication"></a>1.7.1. Concurrent writes and conflicting entries</h4>
<div class="paragraph">
<p>Conflicting entries can occur with Active/Active site configurations if clients
write to the same entries at the same time but at different sites.</p>
</div>
<div class="paragraph">
<p>For example, client A writes to "k1" in <strong>LON</strong> at the same time that client B
writes to "k1" in <strong>NYC</strong>. In this case, "k1" has a different value in <strong>LON</strong>
than in <strong>NYC</strong>. After replication occurs, there is no guarantee which value
for "k1" exists at which site.</p>
</div>
<div class="paragraph">
<p>To ensure data consistency, Infinispan uses a vector clock algorithm to detect
conflicting entries during backup operations, as in the following illustration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>            LON       NYC

k1=(n/a)    0,0       0,0

k1=2        1,0  --&gt;  1,0   k1=2

k1=3        1,1  &lt;--  1,1   k1=3

k1=5        2,1       1,2   k1=8

                 --&gt;  2,1 (conflict)
(conflict)  1,2  &lt;--</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vector clocks are timestamp metadata that increment with each write to an
entry. In the preceding example, <code>0,0</code> represents the initial value for the
vector clock on "k1".</p>
</div>
<div class="paragraph">
<p>A client puts "k1=2" in <strong>LON</strong> and the vector clock is <code>1,0</code>, which
Infinispan replicates to <strong>NYC</strong>. A client then puts "k1=3" in <strong>NYC</strong> and the
vector clock updates to <code>1,1</code>, which Infinispan replicates to <strong>LON</strong>.</p>
</div>
<div class="paragraph">
<p>However if a client puts "k1=5" in <strong>LON</strong> at the same time that a client puts
"k1=8" in <strong>NYC</strong>, Infinispan detects a conflicting entry because the vector
value for "k1" is not strictly greater or less between <strong>LON</strong> and <strong>NYC</strong>.</p>
</div>
<div class="paragraph">
<p>When it finds conflicting entries, Infinispan uses the Java <code>compareTo(String
anotherString)</code> method to compare site names. To determine which key takes
priority, Infinispan selects the site name that is lexicographically less
than the other. Keys from a site named <strong>AAA</strong> take priority over keys from a
site named <strong>AAB</strong> and so on.</p>
</div>
<div class="paragraph">
<p>Following the same example, to resolve the conflict for "k1", Infinispan uses
the value for "k1" that originates from <strong>LON</strong>. This results in "k1=5" in both
<strong>LON</strong> and <strong>NYC</strong> after Infinispan resolves the conflict and replicates the
value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prepend site names with numbers as a simple way to represent the order of
priority for resolving conflicting entries; for example, <strong>1LON</strong> and <strong>2NYC</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<h5 id="backup_strategies" class="discrete">Backup strategies</h5>
<div class="paragraph">
<p>Infinispan performs conflict resolution with the asynchronous backup strategy (<code>strategy=async</code>) only.</p>
</div>
<div class="paragraph">
<p>You should never use the synchronous backup strategy with an Active/Active configuration.
In this configuration concurrent writes result in deadlocks and you lose data.
However you can use the synchronous backup strategy with an Active/Active configuration if both sites access different data sets, in which case there is no risk of deadlocks from concurrent writes.</p>
</div>
<h5 id="cross_site_merge_policies" class="discrete">Cross-site merge policies</h5>
<div class="paragraph">
<p>Infinispan provides an <code>XSiteEntryMergePolicy</code> SPI in addition to cross-site merge policies that configure Infinispan to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always remove conflicting entries.</p>
</li>
<li>
<p>Apply write operations when write/remove conflicts occur.</p>
</li>
<li>
<p>Remove entries when write/remove conflicts occur.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/xsite/spi/XSiteMergePolicy.html"><code>XSiteMergePolicy</code> enum lists all merge polices that Infinispan provides</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/xsite/spi/XSiteEntryMergePolicy.html"><code>XSiteEntryMergePolicy</code> SPI</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#compareTo-java.lang.String-">java.lang.String#compareTo()</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-expiration_cross-site-replication"><a class="anchor" href="#cross-site-expiration_cross-site-replication"></a>1.8. Expiration with cross-site replication</h3>
<div class="paragraph">
<p>Expiration removes cache entries based on time.
Infinispan provides two ways to configure expiration for entries:</p>
</div>
<div class="paragraph">
<div class="title">Lifespan</div>
<p>The <code>lifespan</code> attribute sets the maximum amount of time that entries can exist.
When you set <code>lifespan</code> with cross-site replication, Infinispan clusters expire entries independently of remote sites.</p>
</div>
<div class="paragraph">
<div class="title">Maximum idle</div>
<p>The <code>max-idle</code> attribute specifies how long entries can exist based on read or write operations in a given time period.
When you set a <code>max-idle</code> with cross-site replication, Infinispan clusters send touch commands to coordinate idle timeout values with remote sites.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using maximum idle expiration in cross-site deployments can impact performance because the additional processing to keep <code>max-idle</code> values synchronized means some operations take longer to complete.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-cross-site-replication"><a class="anchor" href="#configuring-cross-site-replication"></a>2. Configuring Infinispan cross-site replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set up cluster transport so Infinispan clusters can discover each other and relay nodes can send messages for cross-site replication.
You can then add backup locations to Infinispan caches.</p>
</div>
<div class="sect2">
<h3 id="configuring-cluster-transport-cross-site_configuring-cross-site-replication"><a class="anchor" href="#configuring-cluster-transport-cross-site_configuring-cross-site-replication"></a>2.1. Configuring cluster transport for cross-site replication</h3>
<div class="paragraph">
<p>Add JGroups RELAY2 to your transport layer so that Infinispan can replicate caches to backup locations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the RELAY2 protocol to a JGroups stack.</p>
</li>
<li>
<p>Specify the stack name with the <code>stack</code> attribute for the transport configuration so the Infinispan cluster uses it.</p>
</li>
<li>
<p>Save and close your Infinispan configuration.</p>
</li>
</ol>
</div>
<h4 id="jgroups_relay2_stacks" class="discrete">JGroups RELAY2 stacks</h4>
<div class="paragraph">
<p>The following configuration shows a JGroups RELAY2 stack that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses the default JGroups UDP stack for inter-cluster transport, which refers to communication between nodes at the local site.</p>
</li>
<li>
<p>Uses the default JGroups TCP stack for cross-site replication traffic.</p>
</li>
<li>
<p>Names the local site as <strong>LON</strong>.</p>
</li>
<li>
<p>Specifies a maximum of 1000 nodes in the cluster that can send cross-site replication requests.</p>
</li>
<li>
<p>Specifies the names of all backup locations that participate in cross-site replication.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;relay.RELAY2</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">max_site_masters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;remote-sites</span> <span class="attribute-name">default-stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/remote-sites&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
  <span class="tag">&lt;cache-container&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${cluster.name}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#ref_relay-xsite">JGroups RELAY2 Stacks</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="custom-jgroups-relay-stacks_configuring-cross-site-replication"><a class="anchor" href="#custom-jgroups-relay-stacks_configuring-cross-site-replication"></a>2.1.1. Custom JGroups RELAY2 stacks</h4>
<div class="paragraph">
<p>You can add custom JGroups RELAY2 stacks to Infinispan clusters to use different transport properties for cross-site replication.
For example, the following configuration uses TCPPING instead of MPING for discovery and extends the default TCP stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;jgroups&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relay-global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;TCPPING</span> <span class="attribute-name">initial_hosts</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">192.0.2.0[7800]</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack.combine</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPLACE</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">stack.position</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
    <span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;relay.RELAY2</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org:jgroups</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">max_site_masters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">can_become_site_master</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;remote-sites</span> <span class="attribute-name">default-stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">relay-global</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;remote-site</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/remote-sites&gt;</span>
    <span class="tag">&lt;/stack&gt;</span>
  <span class="tag">&lt;/jgroups&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#RELAY2">JGroups RELAY2</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual4/index.html#Relay2Advanced">Relaying between multiple sites (RELAY2)</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-backup-locations-caches_configuring-cross-site-replication"><a class="anchor" href="#adding-backup-locations-caches_configuring-cross-site-replication"></a>2.2. Adding backup locations to caches</h3>
<div class="paragraph">
<p>Specify the names of remote sites so Infinispan can replicate data to caches on those clusters.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>backups</code> element to your cache configuration.</p>
</li>
<li>
<p>Specify the name of the remote site as the backup location.<br>
For example, in the <strong>LON</strong> configuration, specify <strong>NYC</strong> as the backup.</p>
</li>
<li>
<p>Repeat the preceding steps on each cluster so that each site is a backup for other sites.<br>
For example, if you add <strong>LON</strong> as a backup for <strong>NYC</strong> you should also add <strong>NYC</strong> as a backup for <strong>LON</strong>.</p>
</li>
<li>
<p>Save and close your Infinispan configuration.</p>
</li>
</ol>
</div>
<h4 id="backup_configuration" class="discrete">Backup configuration</h4>
<div class="paragraph">
<p>The following example shows the "customers" cache configuration for the <strong>LON</strong> cluster:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/replicated-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">replicated-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">replicatedCache</span>:
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>
  <span class="key">backups</span>:
    <span class="key">NYC</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the "customers" cache configuration for the <strong>NYC</strong> cluster:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributedCache</span>:
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>
  <span class="key">backups</span>:
    <span class="key">LON</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="backing-up-caches-different-names_configuring-cross-site-replication"><a class="anchor" href="#backing-up-caches-different-names_configuring-cross-site-replication"></a>2.3. Backing up to caches with different names</h3>
<div class="paragraph">
<p>Infinispan replicates data between caches that have the same name by default.
If you want Infinispan to replicate between caches with different names, you can explicitly declare the backup for each cache.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Use <code>backup-for</code> or <code>backupFor</code> to replicate data from a remote site into a cache with a different name on the local site.</p>
</li>
<li>
<p>Save and close your Infinispan configuration.</p>
</li>
</ol>
</div>
<h4 id="backup_for_configuration" class="discrete">Backup for configuration</h4>
<div class="paragraph">
<p>The following example configures the "eu-customers" cache to receive updates from the "customers" cache on the <strong>LON</strong> cluster:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
  <span class="tag">&lt;backup-for</span> <span class="attribute-name">remote-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">remote-site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        }
      }
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backup-for</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">remote-cache</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">remote-site</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributedCache</span>:
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span>
  <span class="key">backups</span>:
    <span class="key">LON</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
  <span class="key">backupFor</span>:
    <span class="key">remoteCache</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>
    <span class="key">remoteSite</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-state-transfer_configuring-cross-site-replication"><a class="anchor" href="#configuring-state-transfer_configuring-cross-site-replication"></a>2.4. Configuring cross-site state transfer</h3>
<div class="paragraph">
<p>Change cross-site state transfer settings to optimize performance and specify whether operations happen manually or automatically.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Configure state transfer operations as appropriate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specify the number of entries to include in each state transfer operation with <code>chunk-size</code> or <code>chunkSize</code>.</p>
</li>
<li>
<p>Specify the time to wait, in milliseconds, for state transfer operations to complete with <code>timeout</code>.</p>
</li>
<li>
<p>Set the maximum number of attempts for Infinispan to retry failed state transfers with <code>max-retries</code> or <code>maxRetries</code>.</p>
</li>
<li>
<p>Specify the time to wait, in milliseconds, between retry attempts with <code>wait-time</code> or <code>waitTime</code>.</p>
</li>
<li>
<p>Specify if state transfer operations happen automatically or manually with <code>mode</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
</ol>
</div>
<h4 id="state_transfer_configuration" class="discrete">State transfer configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;backups&gt;</span>
    <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;state-transfer</span> <span class="attribute-name">chunk-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">600</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2400000</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">max-retries</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">wait-time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AUTO</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/backup&gt;</span>
  <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">state-transfer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">chunk-size</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">600</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2400000</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">max-retries</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">wait-time</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AUTO</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributedCache</span>:
  <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eu-customers</span><span class="delimiter">&quot;</span></span>
  <span class="key">backups</span>:
    <span class="key">LON</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        <span class="key">stateTransfer</span>:
          <span class="key">chunkSize</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">600</span><span class="delimiter">&quot;</span></span>
          <span class="key">timeout</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2400000</span><span class="delimiter">&quot;</span></span>
          <span class="key">maxRetries</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
          <span class="key">waitTime</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span>
          <span class="key">mode</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AUTO</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-conflict-resolution_configuring-cross-site-replication"><a class="anchor" href="#configuring-conflict-resolution_configuring-cross-site-replication"></a>2.5. Configuring conflict resolution algorithms</h3>
<div class="paragraph">
<p>Configure Infinispan to use a different algorithm to resolve conflicting entries between backup locations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Specify one of the Infinispan algorithms or a custom implementation as the merge policy to resolve conflicting entries.</p>
</li>
<li>
<p>Save and close your Infinispan configuration for editing.</p>
</li>
</ol>
</div>
<h4 id="infinispan_algorithms" class="discrete">Infinispan algorithms</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Find all Infinispan algorithms and their descriptions in the <code>org.infinispan.xsite.spi.XSiteMergePolicy</code> enum.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example configuration uses the <code>ALWAYS_REMOVE</code> algorithm that deletes conflicting entries from both sites:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;backups</span> <span class="attribute-name">merge-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALWAYS_REMOVE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">merge-policy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALWAYS_REMOVE</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributed-cache</span>:
  <span class="key">backups</span>:
    <span class="key">mergePolicy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALWAYS_REMOVE</span><span class="delimiter">&quot;</span></span>
    <span class="key">LON</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<h4 id="custom_conflict_resolution_algorithms" class="discrete">Custom conflict resolution algorithms</h4>
<div class="paragraph">
<p>If you create a custom <code>XSiteEntryMergePolicy</code> implementation, you can specify the fully qualified class name as the merge policy.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;distributed-cache&gt;</span>
   <span class="tag">&lt;backups</span> <span class="attribute-name">merge-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mycompany.MyCustomXSiteEntryMergePolicy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;backup</span> <span class="attribute-name">site</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/backups&gt;</span>
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">distributed-cache</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">merge-policy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.mycompany.MyCustomXSiteEntryMergePolicy</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">backup</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">strategy</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">distributed-cache</span>:
  <span class="key">backups</span>:
    <span class="key">mergePolicy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.mycompany.MyCustomXSiteEntryMergePolicy</span><span class="delimiter">&quot;</span></span>
    <span class="key">LON</span>:
      <span class="key">backup</span>:
        <span class="key">strategy</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/xsite/spi/XSiteEntryMergePolicy.html">org.infinispan.xsite.spi.XSiteEntryMergePolicy</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/xsite/spi/XSiteMergePolicy.html">org.infinispan.xsite.spi.XSiteMergePolicy</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/xsite/spi/SiteEntry.html">org.infinispan.xsite.spi.SiteEntry</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/configdocs/">Infinispan configuration schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="verifying-cross-site-views_configuring-cross-site-replication"><a class="anchor" href="#verifying-cross-site-views_configuring-cross-site-replication"></a>2.6. Verifying cross-site views</h3>
<div class="paragraph">
<p>When you set up Infinispan to perform cross-site replication, you should check log files to ensure that Infinispan clusters have successfully formed cross-site views.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open Infinispan log files with any appropriate editor.</p>
</li>
<li>
<p>Check for <code>ISPN000439: Received new x-site view</code> messages.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if a Infinispan cluster in <strong>LON</strong> has formed a cross-site view with a Infinispan cluster in <strong>NYC</strong>, logs include the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  [org.infinispan.XSITE] (jgroups-5,&lt;server-hostname&gt;) ISPN000439: Received new x-site view: [NYC]
INFO  [org.infinispan.XSITE] (jgroups-7,&lt;server-hostname&gt;) ISPN000439: Received new x-site view: [LON, NYC]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hot-rod-clients-cross-site_configuring-cross-site-replication"><a class="anchor" href="#configuring-hot-rod-clients-cross-site_configuring-cross-site-replication"></a>2.7. Configuring Hot Rod clients for cross-site replication</h3>
<div class="paragraph">
<p>Configure Hot Rod clients to use Infinispan clusters at different sites.</p>
</div>
<div class="listingblock primary">
<div class="title">hotrod-client.properties</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code># Servers at the active site
infinispan.client.hotrod.server_list = LON_host1:11222,LON_host2:11222,LON_host3:11222

# Servers at the backup site
infinispan.client.hotrod.cluster.NYC = NYC_hostA:11222,NYC_hostB:11222,NYC_hostC:11222,NYC_hostD:11222</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">ConfigurationBuilder</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ConfigurationBuilder builder = <span class="keyword">new</span> ConfigurationBuilder();
builder.addServers(<span class="string"><span class="delimiter">&quot;</span><span class="content">LON_host1:11222;LON_host2:11222;LON_host3:11222</span><span class="delimiter">&quot;</span></span>)
       .addCluster(<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>)
       .addClusterNodes(<span class="string"><span class="delimiter">&quot;</span><span class="content">NYC_hostA:11222;NYC_hostB:11222;NYC_hostC:11222;NYC_hostD:11222</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the following methods to switch Hot Rod clients to the default cluster or to a cluster at a different site:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RemoteCacheManager.switchToDefaultCluster()</code></p>
</li>
<li>
<p><code>RemoteCacheManager.switchToCluster(${site.name})</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/package-summary.html#package.description">org.infinispan.client.hotrod.configuration package description</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html#RemoteCacheManager-java.net.URL-">org.infinispan.client.hotrod.RemoteCacheManager</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-site-operations-cli"><a class="anchor" href="#cross-site-operations-cli"></a>3. Performing cross-site operations with the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the Infinispan command line interface (CLI) to connect to Infinispan
Server clusters, manage sites, and push state transfer to backup locations.</p>
</div>
<div class="sect2">
<h3 id="bringing-backup-locations-offline-online_cross-site-operations-cli"><a class="anchor" href="#bringing-backup-locations-offline-online_cross-site-operations-cli"></a>3.1. Bringing backup locations offline and online</h3>
<div class="paragraph">
<p>Take backup locations offline manually and bring them back online.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check if backup locations are online or offline with the <code class="command">site status</code> command:</p>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; site status --cache=cacheName --site=NYC</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>--site</code> is an optional argument. If not set, the CLI returns all backup
locations.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--all-caches</code> option to get the backup location status for all caches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+
. Manage backup locations as follows:</p>
</div>
<div class="paragraph">
<p>+
* Bring backup locations online with the <code class="command">bring-online</code> command:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; site bring-online --cache=customers --site=NYC</pre>
</div>
</div>
<div class="paragraph">
<p>+
* Take backup locations offline with the <code class="command">take-offline</code> command:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; site take-offline --cache=customers --site=NYC</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--all-caches</code> option to bring a backup location online, or take a backup location offline, for all caches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information and examples, run the <code class="command">help site</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-cross-site-state-transfer-modes_cross-site-operations-cli"><a class="anchor" href="#configuring-cross-site-state-transfer-modes_cross-site-operations-cli"></a>3.2. Configuring cross-site state transfer modes</h3>
<div class="paragraph">
<p>You can configure cross-site state transfer operations to happen automatically when Infinispan detects that backup locations come online.
Alternatively you can use the default mode, which is to manually perform state transfer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the <code class="command">site</code> command to configure state transfer modes, as in the following examples:</p>
<div class="ulist">
<ul>
<li>
<p>Retrieve the current state transfer mode.</p>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; site state-transfer-mode get --cache=cacheName --site=NYC
"MANUAL"</pre>
</div>
</div>
</li>
<li>
<p>Configure automatic state transfer operations for a cache and backup location.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; site state-transfer-mode set --cache=cacheName --site=NYC --mode=AUTO</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run the <code class="command">help site</code> command for more information and examples.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pushing-cross-site-state-transfer_cross-site-operations-cli"><a class="anchor" href="#pushing-cross-site-state-transfer_cross-site-operations-cli"></a>3.3. Pushing state to backup locations</h3>
<div class="paragraph">
<p>Transfer cache state to backup locations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create a CLI connection to Infinispan.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code class="command">site push-site-state</code> command to push state transfer, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre>[//containers/default]&gt; site push-site-state --cache=cacheName --site=NYC</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <code>--all-caches</code> option to push state transfer for all caches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information and examples, run the <code class="command">help site</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-site-operations-rest"><a class="anchor" href="#cross-site-operations-rest"></a>4. Performing cross-site operations with the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan Server provides a REST endpoint that exposes methods for performing cross-site operations.</p>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_sites_status"><a class="anchor" href="#rest_v2_xsite_sites_status"></a>4.1. Getting status of all backup locations</h3>
<div class="paragraph">
<p>Retrieve the status of all backup locations with <code>GET</code> requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with the status of each backup location in JSON format, as
in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mixed</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">NodeA</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">offline</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">NodeB</span><span class="delimiter">&quot;</span></span>
    ]
  }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Returned Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>online</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mixed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some nodes in the local cluster have a cross-site view with the backup location, other nodes in the local cluster do not have a cross-site view. The response indicates status for each node.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_site_status"><a class="anchor" href="#rest_v2_xsite_site_status"></a>4.2. Getting status of specific backup locations</h3>
<div class="paragraph">
<p>Retrieve the status of a backup location with <code>GET</code> requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups/{siteName}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with the status of each node in the site in JSON
format, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">NodeA</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">offline</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">NodeB</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Returned Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>online</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node is online.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node is offline.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not possible to retrieve status. The remote cache could be shutting down or a network error occurred during the request.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_take_site_offline"><a class="anchor" href="#rest_v2_xsite_take_site_offline"></a>4.3. Taking backup locations offline</h3>
<div class="paragraph">
<p>Take backup locations offline with <code>POST</code> requests and the
<code>?action=take-offline</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=take-offline</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_bring_backup_online"><a class="anchor" href="#rest_v2_xsite_bring_backup_online"></a>4.4. Bringing backup locations online</h3>
<div class="paragraph">
<p>Bring backup locations online with the <code>?action=bring-online</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=bring-online</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_start_push"><a class="anchor" href="#rest_v2_xsite_start_push"></a>4.5. Pushing state to backup locations</h3>
<div class="paragraph">
<p>Push cache state to a backup location with the <code>?action=start-push-state</code>
parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=start-push-state</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_cancel_state_push"><a class="anchor" href="#rest_v2_xsite_cancel_state_push"></a>4.6. Canceling state transfer</h3>
<div class="paragraph">
<p>Cancel state transfer operations with the <code>?action=cancel-push-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=cancel-push-state</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_state_push"><a class="anchor" href="#rest_v2_xsite_state_push"></a>4.7. Getting state transfer status</h3>
<div class="paragraph">
<p>Retrieve status of state transfer operations with the
<code>?action=push-state-status</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups?action=push-state-status</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with the status of state transfer for each backup location
in JSON format, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CANCELED</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">LON</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Returned status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SENDING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State transfer to the backup location is in progress.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State transfer completed successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An error occurred with state transfer. Check log files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CANCELLING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State transfer cancellation is in progress.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_clear_transfer_status"><a class="anchor" href="#rest_v2_xsite_clear_transfer_status"></a>4.8. Clearing state transfer status</h3>
<div class="paragraph">
<p>Clear state transfer status for sending sites with the
<code>?action=clear-push-state-status</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/local?action=clear-push-state-status</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_tuning_takeoffline"><a class="anchor" href="#rest_v2_xsite_tuning_takeoffline"></a>4.9. Modifying take offline conditions</h3>
<div class="paragraph">
<p>Sites go offline if certain conditions are met. Modify the take offline
parameters to control when backup locations automatically go offline.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check configured take offline parameters with <code>GET</code> requests and the
<code>take-offline-config</code> parameter.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /v2/caches/{cacheName}/x-site/backups/{siteName}/take-offline-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Infinispan response includes <code>after_failures</code> and <code>min_wait</code> fields as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">after_failures</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">min_wait</span><span class="delimiter">&quot;</span></span>: <span class="integer">1000</span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Modify take offline parameters in the body of <code>PUT</code> requests.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>PUT /v2/caches/{cacheName}/x-site/backups/{siteName}/take-offline-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the operation successfully completes, the service returns <code>204 (No Content)</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_xsite_cancel_receive_state"><a class="anchor" href="#rest_v2_xsite_cancel_receive_state"></a>4.10. Canceling state transfer from receiving sites</h3>
<div class="paragraph">
<p>If the connection between two backup locations breaks, you can cancel state
transfer on the site that is receiving the push.</p>
</div>
<div class="paragraph">
<p>Cancel state transfer from a remote site and keep the current state of the
local cache with the <code>?action=cancel-receive-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /v2/caches/{cacheName}/x-site/backups/{siteName}?action=cancel-receive-state</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_site_status"><a class="anchor" href="#rest_v2_cache_manager_site_status"></a>4.11. Getting status of backup locations</h3>
<div class="paragraph">
<p>Retrieve the status of all backup locations from Cache Managers with <code>GET</code>
requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Infinispan responds with status in JSON format, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">SFO-3</span><span class="delimiter">&quot;</span></span>:{
      <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>
   },
   <span class="key"><span class="delimiter">&quot;</span><span class="content">NYC-2</span><span class="delimiter">&quot;</span></span>:{
      <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">mixed</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">online</span><span class="delimiter">&quot;</span></span>:[
         <span class="string"><span class="delimiter">&quot;</span><span class="content">CACHE_1</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">offline</span><span class="delimiter">&quot;</span></span>:[
         <span class="string"><span class="delimiter">&quot;</span><span class="content">CACHE_2</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">mixed</span><span class="delimiter">&quot;</span></span>: [
         <span class="string"><span class="delimiter">&quot;</span><span class="content">CACHE_3</span><span class="delimiter">&quot;</span></span>
      ]
   }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Returned status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>online</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No nodes in the local cluster have a cross-site view with the backup location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mixed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some nodes in the local cluster have a cross-site view with the backup location, other nodes in the local cluster do not have a cross-site view. The response indicates status for each node.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{site}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the status for a single backup location.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_take_offline"><a class="anchor" href="#rest_v2_cache_manager_take_offline"></a>4.12. Taking backup locations offline</h3>
<div class="paragraph">
<p>Take backup locations offline with the <code>?action=take-offline</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=take-offline</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_bring_online"><a class="anchor" href="#rest_v2_cache_manager_bring_online"></a>4.13. Bringing backup locations online</h3>
<div class="paragraph">
<p>Bring backup locations online with the <code>?action=bring-online</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=bring-online</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_get_state_transfer_mode"><a class="anchor" href="#rest_v2_cache_manager_get_state_transfer_mode"></a>4.14. Retrieving the state transfer mode</h3>
<div class="paragraph">
<p>Check the state transfer mode with <code>GET</code> requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>GET /rest/v2/caches/{cacheName}/x-site/backups/{site}/state-transfer-mode</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_set_state_transfer_mode"><a class="anchor" href="#rest_v2_cache_manager_set_state_transfer_mode"></a>4.15. Setting the state transfer mode</h3>
<div class="paragraph">
<p>Configure the state transfer mode with the <code>?action=set</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/caches/{cacheName}/x-site/backups/{site}/state-transfer-mode?action=set&amp;mode={mode}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_start_push"><a class="anchor" href="#rest_v2_cache_manager_start_push"></a>4.16. Starting state transfer</h3>
<div class="paragraph">
<p>Push state of all caches to remote sites with the <code>?action=start-push-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=start-push-state</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest_v2_cache_manager_cancel_push"><a class="anchor" href="#rest_v2_cache_manager_cancel_push"></a>4.17. Canceling state transfer</h3>
<div class="paragraph">
<p>Cancel ongoing state transfer operations with the <code>?action=cancel-push-state</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>POST /rest/v2/cache-managers/{cacheManagerName}/x-site/backups/{siteName}?action=cancel-push-state</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-site-operations-jmx"><a class="anchor" href="#cross-site-operations-jmx"></a>5. Performing cross-site operations via JMX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Perform cross-site operations such as pushing state transfer and bringing sites online via JMX.</p>
</div>
<div class="sect2">
<h3 id="enabling-jmx_cross-site-operations-jmx"><a class="anchor" href="#enabling-jmx_cross-site-operations-jmx"></a>5.1. Registering JMX MBeans</h3>
<div class="paragraph">
<p>Infinispan can register JMX MBeans that you can use to collect statistics and
perform administrative operations.
You must also enable statistics otherwise Infinispan provides <code>0</code> values for all statistic attributes in JMX MBeans.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open your Infinispan configuration for editing.</p>
</li>
<li>
<p>Add the <code>jmx</code> element or object to the cache container and specify <code>true</code> as the value for the <code>enabled</code> attribute or field.</p>
</li>
<li>
<p>Add the <code>domain</code> attribute or field and specify the domain where JMX MBeans are exposed, if required.</p>
</li>
<li>
<p>Save and close your client configuration.</p>
</li>
</ol>
</div>
<h4 id="jmx_configuration" class="discrete">JMX configuration</h4>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;infinispan&gt;</span>
  <span class="tag">&lt;cache-container</span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jmx</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">JSON</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">statistics</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jmx</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">domain</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span class="key">infinispan</span>:
  <span class="key">cacheContainer</span>:
    <span class="key">statistics</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="key">jmx</span>:
      <span class="key">enabled</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="key">domain</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performing-cross-site-operations-jmx_cross-site-operations-jmx"><a class="anchor" href="#performing-cross-site-operations-jmx_cross-site-operations-jmx"></a>5.2. Performing cross-site operations with JMX clients</h3>
<div class="paragraph">
<p>Perform cross-site operations with JMX clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure Infinispan to register JMX MBeans</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to Infinispan with any JMX client.</p>
</li>
<li>
<p>Invoke operations from the following MBeans:</p>
<div class="ulist">
<ul>
<li>
<p><code>XSiteAdmin</code> provides cross-site operations for caches.</p>
</li>
<li>
<p><code>GlobalXSiteAdminOperations</code> provides cross-site operations for Cache Managers.</p>
<div class="paragraph">
<p>For example, to bring sites back online, invoke <code>bringSiteOnline(siteName)</code>.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/jmxComponents.html#XSiteAdmin">XSiteAdmin MBean</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/jmxComponents.html#XSiteAdmin">GlobalXSiteAdminOperations MBean</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cross-site-jmx-mbeans_cross-site-operations-jmx"><a class="anchor" href="#cross-site-jmx-mbeans_cross-site-operations-jmx"></a>5.3. JMX MBeans for cross-site replication</h3>
<div class="paragraph">
<p>Infinispan provides JMX MBeans for cross-site replication that let you gather statistics and perform remote operations.</p>
</div>
<div class="paragraph">
<p>The <code>org.infinispan:type=Cache</code> component provides the following JMX MBeans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>XSiteAdmin</code> exposes cross-site operations that apply to specific cache instances.</p>
</li>
<li>
<p><code>RpcManager</code> provides statistics about network requests for cross-site replication.</p>
</li>
<li>
<p><code>AsyncXSiteStatistics</code> provides statistics for asynchronous cross-site replication, including queue size and number of conflicts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>org.infinispan:type=CacheManager</code> component includes the following JMX MBean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GlobalXSiteAdminOperations</code> exposes cross-site operations that apply to all caches in a cache container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details about JMX MBeans along with descriptions of available operations
and statistics, see the <em>Infinispan JMX Components</em> documentation.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.jboss.org/infinispan/13.0/apidocs/jmxComponents.html">Infinispan JMX Components</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cross-site-replication-logs"><a class="anchor" href="#cross-site-replication-logs"></a>6. Cross-site replication log messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infinispan includes an <code>org.infinispan.XSITE</code> log category to help you troubleshoot cross-site replication operations.</p>
</div>
<div class="sect2">
<h3 id="cross-site-replication-log-messages_cross-site-replication-logs"><a class="anchor" href="#cross-site-replication-log-messages_cross-site-replication-logs"></a>6.1. Infinispan log messages for cross-site replication</h3>
<div class="paragraph">
<p>Find user actions for log messages related to cross-site replication.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log level</th>
<th class="tableblock halign-left valign-top">Identifier</th>
<th class="tableblock halign-left valign-top">Message</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node &lt;site-name&gt; was suspected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when it cannot reach backup locations. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000439</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received new x-site view: &lt;site-name&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when sites join and leave the global cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN100005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site &lt;site-name&gt; is online.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when a site comes online.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN100006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site &lt;site-name&gt; is offline.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when a site goes offline.
If you did not take the site offline manually, this message could indicate a failure has occurred. Check network status and try to bring the site back online.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Problems backing up data for cache &lt;cache-name&gt; to site &lt;site-name&gt;:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan prints this message when issues occur with state transfer operations along with the exception. If necessary adjust Infinispan logging to get more fine-grained logging messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000289</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to send X-Site state chunk to &lt;site-name&gt;.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot transfer a batch of cache entries during a state transfer operation. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000291</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to apply X-Site state chunk.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot apply a batch of cache entries during a state transfer operation. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to re-start x-site state transfer to site &lt;site-name&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot resume a state transfer operation to a backup location. Ensure that sites are online and check network status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000477</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unable to perform operation &lt;operation-name&gt; for site &lt;site-name&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that Infinispan cannot successfully complete an operation on a backup location. If necessary adjust Infinispan logging to get more fine-grained logging messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000449</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XSite state transfer timeout must be higher or equals than 1 (one).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Results when the value of the <code>timeout</code> attribute is <code>0</code> or a negative number. Specify a value of at least <code>1</code> for the <code>timeout</code> attribute in the state transfer configuration for your cache definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000450</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XSite state transfer waiting time between retries must be higher or equals than 1 (one).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Results when the value of the <code>wait-time</code> attribute is <code>0</code> or a negative number. Specify a value of at least <code>1</code> for the <code>wait-time</code> attribute in the state transfer configuration for your cache definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISPN000576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site Replication not available for local cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cross-site replication does not work with the local cache mode. Either remove the backup configuration from the local cache definition or use a distributed or replicated cache mode.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-17 14:46:55 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>