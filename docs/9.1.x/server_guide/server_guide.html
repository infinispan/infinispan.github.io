<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.5"> <meta name="author" content="The Infinispan community"> <title>Infinispan 9.1 Server Guide</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"> <style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"> <style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style> <link rel="canonical" href="http://infinispan.org/docs/stable/server_guide/server_guide.html"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css"> <link rel="stylesheet" href="../css/css.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script> <script src="../js/js.js"></script> </head> <body class="book toc2 toc-left"> <div id="header"> <h1>Infinispan 9.1 Server Guide</h1> <div class="details"> <span id="author" class="author">The Infinispan community</span><br> </div> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#about_the_infinispan_server">1. About the Infinispan Server</a></li> <li><a href="#getting_started">2. Getting Started</a></li> <li><a href="#operating_modes">3. Operating modes</a> <ul class="sectlevel2"> <li><a href="#standalone_mode">3.1. Standalone mode</a></li> <li><a href="#domain_mode">3.2. Domain mode</a> <ul class="sectlevel3"> <li><a href="#host">3.2.1. Host</a> <ul class="sectlevel4"> <li><a href="#host_controller">Host Controller</a></li> </ul> </li> <li><a href="#domain_controller">3.2.2. Domain Controller</a></li> <li><a href="#server_group">3.2.3. Server Group</a></li> <li><a href="#server">3.2.4. Server</a></li> </ul> </li> </ul> </li> <li><a href="#example_configurations">4. Example configurations</a></li> <li><a href="#management">5. Management</a> <ul class="sectlevel2"> <li><a href="#cli">5.1. CLI</a></li> <li><a href="#console">5.2. Console</a></li> <li><a href="#jmx">5.3. JMX</a></li> </ul> </li> <li><a href="#configuration">6. Configuration</a> <ul class="sectlevel2"> <li><a href="#jgroups_subsystem_configuration">6.1. JGroups subsystem configuration</a> <ul class="sectlevel3"> <li><a href="#cluster_authentication_and_authorization">6.1.1. Cluster authentication and authorization</a></li> </ul> </li> <li><a href="#infinispan_subsystem_configuration">6.2. Infinispan subsystem configuration</a> <ul class="sectlevel3"> <li><a href="#containers">6.2.1. Containers</a></li> <li><a href="#caches">6.2.2. Caches</a></li> <li><a href="#expiration">6.2.3. Expiration</a></li> <li><a href="#eviction">6.2.4. Eviction</a></li> <li><a href="#locking">6.2.5. Locking</a></li> <li><a href="#transactions">6.2.6. Transactions</a></li> <li><a href="#loaders_and_stores">6.2.7. Loaders and Stores</a></li> <li><a href="#state_transfer">6.2.8. State Transfer</a></li> </ul> </li> <li><a href="#endpoint_subsystem_configuration">6.3. Endpoint subsystem configuration</a> <ul class="sectlevel3"> <li><a href="#hot_rod">6.3.1. Hot Rod</a></li> <li><a href="#memcached">6.3.2. Memcached</a></li> <li><a href="#websocket">6.3.3. WebSocket</a></li> <li><a href="#rest">6.3.4. REST</a></li> <li><a href="#common_protocol_connector_settings">6.3.5. Common Protocol Connector Settings</a></li> <li><a href="#protocol_interoperability">6.3.6. Protocol Interoperability</a></li> <li><a href="#custom_marshaller_bridges">6.3.7. Custom Marshaller Bridges</a> <ul class="sectlevel4"> <li><a href="#protostuff">Protostuff</a></li> <li><a href="#kryo">Kryo</a></li> <li><a href="#server_compatibility_mode">Server Compatibility Mode</a> <ul class="sectlevel5"> <li><a href="#registering_custom_schemas_serializers">Registering Custom Schemas/Serializers</a></li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> <li><a href="#security">7. Security</a> <ul class="sectlevel2"> <li><a href="#general_concepts">7.1. General concepts</a> <ul class="sectlevel3"> <li><a href="#authorization_configuration">7.1.1. Authorization configuration</a></li> <li><a href="#server_realms">7.1.2. Server Realms</a></li> </ul> </li> <li><a href="#security_audit">7.2. Security Audit</a></li> <li><a href="#hot_rod_authentication">7.3. Hot Rod authentication</a> <ul class="sectlevel3"> <li><a href="#sasl_quality_of_protection">7.3.1. SASL Quality of Protection</a></li> <li><a href="#sasl_policies">7.3.2. SASL Policies</a></li> <li><a href="#configuring_the_hot_rod_client_for_authentication">7.3.3. Configuring the Hot Rod client for authentication</a></li> <li><a href="#using_gssapi_kerberos">7.3.4. Using GSSAPI/Kerberos</a></li> </ul> </li> <li><a href="#hot_rod_and_rest_encryption_tls_ssl">7.4. Hot Rod and REST encryption (TLS/SSL)</a></li> </ul> </li> <li><a href="#health_monitoring">8. Health monitoring</a> <ul class="sectlevel2"> <li><a href="#accessing_health_api_using_jmx">8.1. Accessing Health API using JMX</a></li> <li><a href="#accessing_health_api_using_cli">8.2. Accessing Health API using CLI</a></li> <li><a href="#accessing_health_api_using_rest">8.3. Accessing Health API using REST</a></li> </ul> </li> <li><a href="#multi_tenancy">9. Multi-tenancy</a> <ul class="sectlevel2"> <li><a href="#using_rest_interface">9.1. Using REST interface</a></li> <li><a href="#using_hot_rod_client">9.2. Using Hot Rod client</a> <ul class="sectlevel3"> <li><a href="#multi_tenant_router">9.2.1. Multi-tenant router</a></li> </ul> </li> </ul> </li> </ul> </div> </div> <div id="content"> <div class="sect1"> <h2 id="about_the_infinispan_server"><a class="anchor" href="#about_the_infinispan_server"></a>1. About the Infinispan Server</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan Server is a standalone server which exposes any number of caches to clients over a variety of protocols, including HotRod, Memcached and REST. The server itself is built on top of the robust foundation provided by WildFly, therefore delegating services such as management, configuration, datasources, transactions, logging, security to the respective subsystems. Because Infinispan Server is closely tied to the latest releases of Infinispan and JGroups, the subsystems which control these components are different, in that they introduce new features and change some existing ones (e.g. cross-site replication, etc). For this reason, the configuration of these subsystems should use the Infinispan Server-specific schema, although for most use-cases the configuration is interchangeable. See the Configuration section for more information.</p> </div> </div> </div> <div class="sect1"> <h2 id="getting_started"><a class="anchor" href="#getting_started"></a>2. Getting Started</h2> <div class="sectionbody"> <div class="paragraph"> <p>To get started using the server, download the Infinispan Server distribution, unpack it to a local directory and launch it using the bin/standalone.sh or bin/standalone.bat scripts depending on your platform. This will start a single-node server using the standalone/configuration/standalone.xml configuration file, with four endpoints, one for each of the supported protocols. These endpoints allow access to all of the caches configured in the Infinispan subsystem (apart from the Memcached endpoint which, because of the protocol&#8217;s design, only allows access to a single cache).</p> </div> </div> </div> <div class="sect1"> <h2 id="operating_modes"><a class="anchor" href="#operating_modes"></a>3. Operating modes</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan Server, like WildFly, can be booted in two different modes: standalone and domain.</p> </div> <div class="sect2"> <h3 id="standalone_mode"><a class="anchor" href="#standalone_mode"></a>3.1. Standalone mode</h3> <div class="paragraph"> <p>For simple configurations, standalone mode is the easiest to start with. It allows both local and clustered configurations, although we only really recommend it for running single nodes, since the configuration, management and coordination of multiple nodes is up to the user&#8217;s responsibility. For example, adding a cache to a cluster of standalone server, the user would need to configure individually to all nodes. Note that the default standalone.xml configuration does not provide a JGroups subsystem and therefore cannot work in clustered mode. To start standalone mode with an alternative configuration file, use the -c command-line switch as follows:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -c clustered.xml</pre> </div> </div> <div class="paragraph"> <p>If you start the server in clustered mode on multiple hosts, they should automatically discover each other using UDP multicast and form a cluster. If you want to start multiple nodes on a single host, start each one by specifying a port offset using the jboss.socket.binding.port-offset property together with a unique jboss.node.name as follows:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -Djboss.socket.binding.port-offset=100 -Djboss.node.name=nodeA</pre> </div> </div> <div class="paragraph"> <p>If, for some reason, you cannot use UDP multicast, you can use TCP discovery. Read the <strong>JGroups Subsystem Configuration</strong> section below for details on how to configure TCP discovery.</p> </div> </div> <div class="sect2"> <h3 id="domain_mode"><a class="anchor" href="#domain_mode"></a>3.2. Domain mode</h3> <div class="paragraph"> <p>Domain mode is the recommended way to run a cluster of servers, since they can all be managed centrally from a single control point. The following diagram explains the topology of an example domain configuration, with 4 server nodes (A1, A2, B1, B2) running on two physical hosts (A, B):</p> </div> <div class="imageblock" style="text-align: center"> <div class="content"> <img src="./images/domain.svg" alt="domain"> </div> <div class="title">Figure 1. Domain-mode</div> </div> <div class="sect3"> <h4 id="host"><a class="anchor" href="#host"></a>3.2.1. Host</h4> <div class="paragraph"> <p>Each "Host" box in the above diagram represents a physical or virtual host. A physical host can contain zero, one or more server instances.</p> </div> <div class="sect4"> <h5 id="host_controller"><a class="anchor" href="#host_controller"></a>Host Controller</h5> <div class="paragraph"> <p>When the domain.sh or domain.bat script is run on a host, a process known as a Host Controller is launched. The Host Controller is solely concerned with server management; it does not itself handle Infinispan server workloads. The Host Controller is responsible for starting and stopping the individual Infinispan server processes that run on its host, and interacts with the Domain Controller to help manage them.</p> </div> <div class="paragraph"> <p>Each Host Controller by default reads its configuration from the domain/configuration/host.xml file located in the Infinispan Server installation on its host&#8217;s filesystem. The host.xml file contains configuration information that is specific to the particular host. Primarily:</p> </div> <div class="ulist"> <ul> <li> <p>the listing of the names of the actual Infinispan Server instances that are meant to run off of this installation.</p> </li> <li> <p>configuration of how the Host Controller is to contact the Domain Controller to register itself and access the domain configuration. This may either be configuration of how to find and contact a remote Domain Controller, or a configuration telling the Host Controller to itself act as the Domain Controller.</p> </li> <li> <p>configuration of items that are specific to the local physical installation. For example, named interface definitions declared in domain.xml (see below) can be mapped to an actual machine-specific IP address in host.xml. Abstract path names in domain.xml can be mapped to actual filesystem paths in host.xml.</p> </li> </ul> </div> </div> </div> <div class="sect3"> <h4 id="domain_controller"><a class="anchor" href="#domain_controller"></a>3.2.2. Domain Controller</h4> <div class="paragraph"> <p>One Host Controller instance is configured to act as the central management point for the entire domain, i.e. to be the Domain Controller. The primary responsibility of the Domain Controller is to maintain the domain&#8217;s central management policy, to ensure all Host Controllers are aware of its current contents, and to assist the Host Controllers in ensuring any running Infinispan server instances are configured in accordance with this policy. This central management policy is stored by default in the domain/configuration/domain.xml file in the Infinispan Server installation on Domain Controller&#8217;s host&#8217;s filesystem.</p> </div> <div class="paragraph"> <p>A domain.xml file must be located in the domain/configuration directory of an installation that&#8217;s meant to run the Domain Controller. It does not need to be present in installations that are not meant to run a Domain Controller; i.e. those whose Host Controller is configured to contact a remote Domain Controller. The presence of a domain.xml file on such a server does no harm.</p> </div> <div class="paragraph"> <p>The domain.xml file includes, among other things, the configuration of the various "profiles" that Infinispan Server instances in the domain can be configured to run. A profile configuration includes the detailed configuration of the various subsystems that comprise that profile (e.g. Cache Containers and Caches, Endpoints, Security Realms, DataSources, etc). The domain configuration also includes the definition of groups of sockets that those subsystems may open. The domain configuration also includes the definition of "server groups".</p> </div> </div> <div class="sect3"> <h4 id="server_group"><a class="anchor" href="#server_group"></a>3.2.3. Server Group</h4> <div class="paragraph"> <p>A server group is set of server instances that will be managed and configured as one. In a managed domain each application server instance is a member of a server group. Even if the group only has a single server, the server is still a member of a group. It is the responsibility of the Domain Controller and the Host Controllers to ensure that all servers in a server group have a consistent configuration. They should all be configured with the same profile and they should have the same deployment content deployed. To keep things simple, ensure that all the nodes that you want to belong to an Infinispan cluster are configured as servers of one server group.</p> </div> <div class="paragraph"> <p>The domain can have multiple server groups, i.e. multiple Infinispan clusters. Different server groups can be configured with different profiles and deployments; for example in a domain with different Infinispan Server clusters ﻿providing different services. Different server groups can also run the same profile and have the same deployments.</p> </div> <div class="paragraph"> <p>An example server group definition is as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;server-group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main-server-group</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;socket-binding-group</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">standard-sockets</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/server-group&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>A server-group configuration includes the following required attributes:</p> </div> <div class="ulist"> <ul> <li> <p>name&#8201;&#8212;&#8201;the name of the server group</p> </li> <li> <p>profile&#8201;&#8212;&#8201;the name of the profile the servers in the group should run</p> </li> </ul> </div> <div class="paragraph"> <p>In addition, the following optional elements are available:</p> </div> <div class="ulist"> <ul> <li> <p>socket-binding-group&#8201;&#8212;&#8201;specifies the name of the default socket binding group to use on servers in the group. Can be overridden on a per-server basis in host.xml. If not provided in the server-group element, it must be provided for each server in host.xml.</p> </li> <li> <p>deployments&#8201;&#8212;&#8201;the deployment content that should be deployed on the servers in the group.</p> </li> <li> <p>system-properties&#8201;&#8212;&#8201;system properties that should be set on all servers in the group</p> </li> <li> <p>jvm&#8201;&#8212;&#8201;default jvm settings for all servers in the group. The Host Controller will merge these settings with any provided in host.xml to derive the settings to use to launch the server&#8217;s JVM. See JVM settings for further details.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="server"><a class="anchor" href="#server"></a>3.2.4. Server</h4> <div class="paragraph"> <p>Each "Server" in the above diagram represents an actual Infinispan Server node. The server runs in a separate JVM process from the Host Controller. The Host Controller is responsible for launching that process. In a managed domain the end user cannot directly launch a server process from the command line.</p> </div> <div class="paragraph"> <p>The Host Controller synthesizes the server&#8217;s configuration by combining elements from the domain wide configuration (from domain.xml) and the host-specific configuration (from host.xml).</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="example_configurations"><a class="anchor" href="#example_configurations"></a>4. Example configurations</h2> <div class="sectionbody"> <div class="paragraph"> <p>The server distribution also provides a set of example configuration files in the docs/examples/configs (mostly using standalone mode) which illustrate a variety of possible configurations and use-cases. To use them, just copy them to the standalone/configuration directory and start the server using the following syntax:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -c configuration_file_name.xml</pre> </div> </div> <div class="paragraph"> <p>For more information regarding the parameters supported by the startup scripts, refer to the WildFly documentation on <a href="https://docs.jboss.org/author/display/WFLY10/Command+line+parameters">Command line parameters</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="management"><a class="anchor" href="#management"></a>5. Management</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="cli"><a class="anchor" href="#cli"></a>5.1. CLI</h3> <div class="paragraph"> <p>You can use the CLI to perform management operations on a standalone node or a domain controller.</p> </div> <div class="listingblock"> <div class="content"> <pre>bin/ispn-cli.sh
[disconnected /] connect
[standalone@localhost:9990 /] cd subsystem=datagrid-infinispan
[standalone@localhost:9990 subsystem=datagrid-infinispan] cd cache-container=local
[standalone@localhost:9990 cache-container=local] cd local-cache=default
[standalone@localhost:9990 local-cache=default]</pre> </div> </div> <div class="paragraph"> <p>The CLI is extremely powerful and supports a number of useful features to navigate the management resource tree as well as inspecting single resources or entire subtrees. It is also possible to batch multiple commands together so that they are applied as a single operation.</p> </div> </div> <div class="sect2"> <h3 id="console"><a class="anchor" href="#console"></a>5.2. Console</h3> <div class="paragraph"> <p>You can use the web console to perform management operations on servers running in either standalone or domain mode. The console only supports a subset of the operations provided by the CLI, however you can perform the following actions:</p> </div> <div class="ulist"> <ul> <li> <p>View/Edit Cache Container Configuration</p> </li> <li> <p>Execute Tasks across Containers</p> </li> <li> <p>View/Edit Cache Configurations</p> </li> <li> <p>Create/Destroy Cache Instances</p> </li> <li> <p>View Cluster/Server/Cache Statistics</p> </li> <li> <p>View event logs</p> </li> <li> <p>Start/Stop servers/clusters (domain mode only)</p> </li> </ul> </div> <div class="paragraph"> <p>To access the console start your server(s) in the required mode, navigate to <code><a href="http://localhost:9990" class="bare">http://localhost:9990</a></code> and enter your user credentials. If you would like to contribute to the development of the console, the source code can be found <a href="https://github.com/infinispan/infinispan-management-console">here</a>.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Before you can use the web console, you must first setup at least one user account via the <code>./bin/add-user.sh</code> script. Detailed instructions of this process are presented in your browser if you attempt to access the console before creating any user accounts. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="jmx"><a class="anchor" href="#jmx"></a>5.3. JMX</h3> <div class="paragraph"> <p>You can monitor an Infinispan Server over JMX in two ways:</p> </div> <div class="ulist"> <ul> <li> <p>Use JConsole or VisualVM running locally as the same user. This will use a local <a href="http://www.oracle.com/technetwork/java/jvmstat-142257.html">jvmstat</a> connection and requires no additional setup</p> </li> <li> <p>Use JMX remoting (aka JSR-160) to connect from any host. This requires connecting through the management port (usually 9990) using a special protocol which respects the server security configuration</p> </li> </ul> </div> <div class="paragraph"> <p>To setup a client for JMX remoting you need to add the $ISPN_HOME/bin/client/jboss-client.jar to your client&#8217;s classpath and use one of the following service URLs:</p> </div> <div class="ulist"> <ul> <li> <p><code>service:jmx:remote-http-jmx://host:port</code> for plain connections through the management interface</p> </li> <li> <p><code>service:jmx:remote-https-jmx://host:port</code> for TLS connections through the management interface (although this requires having the appropriate keys available)</p> </li> <li> <p><code>service:jmx:remoting-jmx://localhost:port</code> for connections through the remoting interface (necessary for connecting to individual servers in a domain)</p> </li> </ul> </div> <div class="paragraph"> <p>The JMX subsystem registers a service with the Remoting endpoint so that remote access to JMX can be obtained over the exposed Remoting connector. This is switched on by default in standalone mode and accessible over port 9990 but in domain mode it is switched off so it needs to be enabled. In domain mode the port will be the port of the Remoting connector for the Server instance to be monitored.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:jmx:1.3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;expose-resolved-model</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;expose-expression-model</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;remoting-connector</span> <span class="attribute-name">use-management-endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="configuration"><a class="anchor" href="#configuration"></a>6. Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>Since the server is based on the WildFly codebase, refer to the WildFly documentation, apart from the JGroups, Infinispan and Endpoint subsytems.</p> </div> <div class="sect2"> <h3 id="jgroups_subsystem_configuration"><a class="anchor" href="#jgroups_subsystem_configuration"></a>6.1. JGroups subsystem configuration</h3> <div class="paragraph"> <p>The JGroups subsystem configures the network transport and is only required when clustering multiple Infinispan Server nodes together.</p> </div> <div class="paragraph"> <p>The subsystem declaration is enclosed in the following XML element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:jgroups:9.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;channels</span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/channels&gt;</span>
    <span class="tag">&lt;stacks</span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.default.jgroups.stack:udp}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...
    <span class="tag">&lt;/stacks&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Within the subsystem, you need to declare the stacks that you wish to use and name them. The default-stack attribute in the subsystem declaration must point to one of the declared stacks. You can switch stacks from the command-line using the jboss.default.jgroups.stack property:</p> </div> <div class="literalblock"> <div class="content"> <pre>bin/standalone.sh -c clustered.xml -Djboss.default.jgroups.stack=tcp</pre> </div> </div> <div class="paragraph"> <p>A stack declaration is composed of a transport (UDP or TCP) followed by a list of protocols. For each of these elements you can tune specific properties adding child &lt;property name="prop_name"&gt;prop_value&lt;/property&gt; elements. Since the amount of protocols and their configuration options in JGroups is huge, please refer to the appropriate <a href="http://www.jgroups.org/manual/html/protlist.html">JGroups Protocol documentation</a> . The following are the default stacks:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UDP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PING</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-udp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UFC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span>
<span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MPING</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-mping</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">use_mcast_xmit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/protocol&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The default TCP stack uses the MPING protocol for discovery, which uses UDP multicast. If you need to use a different protocol, look at the <a href="http://www.jgroups.org/manual/html/protlist.html#DiscoveryProtocols">JGroups Discovery Protocols</a> . The following example stack configures the TCPPING discovery protocol with two initial hosts:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transport</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCPPING</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initial_hosts</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>HostA[7800],HostB[7800]<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/protocol&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_SOCK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups-tcp-fd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FD_ALL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERIFY_SUSPECT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.NAKACK2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">use_mcast_xmit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/protocol&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UNICAST3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.STABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pbcast.GMS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MFC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FRAG3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/stack&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The default configurations come with a variety of pre-configured stacks for different enviroments. For example, the tcpgossip stack uses Gossip discover:y</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TCPGOSSIP</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initial_hosts</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.gossip.initial_hosts:}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Use the s3 stack when running in Amazon AWS:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">S3_PING</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.bucket:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">access_key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.access_key:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret_access_key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.secret_access_key:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pre_signed_delete_url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.pre_signed_delete_url:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pre_signed_put_url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.pre_signed_put_url:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prefix</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.s3.prefix:}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Similarly, when using Google&#8217;s Cloud Platform, use the google stack:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GOOGLE_PING</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.google.bucket:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">access_key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.google.access_key:}<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret_access_key</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${jgroups.google.secret_access_key:}<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/protocol&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="cluster_authentication_and_authorization"><a class="anchor" href="#cluster_authentication_and_authorization"></a>6.1.1. Cluster authentication and authorization</h4> <div class="paragraph"> <p>The JGroups subsystem can be configured so that nodes need to authenticate each other when joining / merging. The authentication uses SASL and integrates with the security realms.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;management&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
        ...
        <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ClusterRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;authentication&gt;</span>
                <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/authentication&gt;</span>
                <span class="tag">&lt;authorization&gt;</span>
                    <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster-roles.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/authorization&gt;</span>
            <span class="tag">&lt;/security-realm&gt;</span>
        <span class="tag">&lt;/security-realms&gt;</span>
        ...
    <span class="tag">&lt;/security-realms&gt;</span>
<span class="tag">&lt;/management&gt;</span>

<span class="tag">&lt;stack</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;sasl</span> <span class="attribute-name">mech</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ClusterRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cluster-role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client_name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>node1<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client_password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>password<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/sasl&gt;</span>
    ...
<span class="tag">&lt;/stack&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>In the above example the nodes will use the DIGEST-MD5 mech to authenticate against the ClusterRealm. In order to join, nodes need to have the cluster role. If the cluster-role attribute is not specified it defaults to the name of the Infinispan cache-container, as described below. Each node identifies itself using the client_name property. If none is explicitly specified, the hostname on which the server is running will be used. This name can also be overridden by specifying the jboss.node.name system property. The client_password property contains the password of the node. It is recommended that this password be stored in the Vault. Refer to <a href="https://community.jboss.org/wiki/AS7UtilisingMaskedPasswordsViaTheVault">AS7: Utilising masked passwords via the vault</a> for instructions on how to do so. When using the GSSAPI mech, client_name will be used as the name of a Kerberos-enabled login module defined within the security domain subsystem:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">krb-node0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kerberos</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">storeKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useKeyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refreshKrb5Config</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jgroups/node0/clustered@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.server.config.dir}/keytabs/jgroups_node0_clustered.keytab</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doNotPrompt</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/login-module&gt;</span>
    <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/security-domain&gt;</span></code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="infinispan_subsystem_configuration"><a class="anchor" href="#infinispan_subsystem_configuration"></a>6.2. Infinispan subsystem configuration</h3> <div class="paragraph"> <p>The Infinispan subsystem configures the cache containers and caches.</p> </div> <div class="paragraph"> <p>The subsystem declaration is enclosed in the following XML element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:9.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="containers"><a class="anchor" href="#containers"></a>6.2.1. Containers</h4> <div class="paragraph"> <p>The Infinispan subsystem can declare multiple containers. A container is declared as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/cache-container&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Note that in server mode is the lack of an implicit default cache, but the ability to specify a named cache as the default.</p> </div> <div class="paragraph"> <p>If you need to declare clustered caches (distributed, replicated, invalidation), you also need to specify the <code>&lt;transport/&gt;</code> element which references an existing JGroups transport. This is not needed if you only intend to have local caches only.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;transport</span> <span class="attribute-name">executor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-transport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">stack</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">udp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cluster</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-cluster-name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="caches"><a class="anchor" href="#caches"></a>6.2.2. Caches</h4> <div class="paragraph"> <p>Now you can declare your caches. Please be aware that only the caches declared in the configuration will be available to the endpoints and that attempting to access an undefined cache is an illegal operation. Contrast this with the default Infinispan library behaviour where obtaining an undefined cache will implicitly create one using the default settings. The following are example declarations for all four available types of caches:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/local-cache&gt;</span>

<span class="tag">&lt;replicated-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/replicated-cache&gt;</span>

<span class="tag">&lt;invalidation-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/invalidation-cache&gt;</span>
<span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">distcache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYNC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">segments</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">owners</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">remote-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/distributed-cache&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="expiration"><a class="anchor" href="#expiration"></a>6.2.3. Expiration</h4> <div class="paragraph"> <p>To define a default expiration for entries in a cache, add the <code>&lt;expiration/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;expiration</span> <span class="attribute-name">lifespan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-idle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the expiration element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>lifespan</em> maximum lifespan of a cache entry, after which the entry is expired cluster-wide, in milliseconds. -1 means the entries never expire.</p> </li> <li> <p><em>max-idle</em> maximum idle time a cache entry will be maintained in the cache, in milliseconds. If the idle time is exceeded, the entry will be expired cluster-wide. -1 means the entries never expire.</p> </li> <li> <p><em>interval</em> interval (in milliseconds) between subsequent runs to purge expired entries from memory and any cache stores. If you wish to disable the periodic eviction process altogether, set interval to -1.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="eviction"><a class="anchor" href="#eviction"></a>6.2.4. Eviction</h4> <div class="paragraph"> <p>To define an eviction strategy for a cache, add the <code>&lt;eviction/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;eviction</span> <span class="attribute-name">strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LIRS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-entries</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the eviction element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>strategy</em> sets the cache eviction strategy. Available options are 'UNORDERED', 'FIFO', 'LRU', 'LIRS' and 'NONE' (to disable eviction).</p> </li> <li> <p><em>max-entries</em> maximum number of entries in a cache instance. If selected value is not a power of two the actual value will default to the least power of two larger than selected value. -1 means no limit.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="locking"><a class="anchor" href="#locking"></a>6.2.5. Locking</h4> <div class="paragraph"> <p>To define the locking configuration for a cache, add the <code>&lt;locking/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;locking</span> <span class="attribute-name">isolation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPEATABLE_READ</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acquire-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">concurrency-level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">striping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the locking element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>isolation</em> sets the cache locking isolation level. Can be NONE, READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE. Defaults to REPEATABLE_READ</p> </li> <li> <p><em>striping</em> if true, a pool of shared locks is maintained for all entries that need to be locked. Otherwise, a lock is created per entry in the cache. Lock striping helps control memory footprint but may reduce concurrency in the system.</p> </li> <li> <p><em>acquire-timeout</em> maximum time to attempt a particular lock acquisition.</p> </li> <li> <p><em>concurrency-level</em> concurrency level for lock containers. Adjust this value according to the number of concurrent threads interacting with Infinispan.</p> </li> <li> <p><em>concurrent-updates</em> for non-transactional caches only: if set to true(default value) the cache keeps data consistent in the case of concurrent updates. For clustered caches this comes at the cost of an additional RPC, so if you don&#8217;t expect your application to write data concurrently, disabling this flag increases performance.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="transactions"><a class="anchor" href="#transactions"></a>6.2.6. Transactions</h4> <div class="paragraph"> <p>While it is possible to configure server caches to be transactional, none of the available protocols offer transaction capabilities.</p> </div> </div> <div class="sect3"> <h4 id="loaders_and_stores"><a class="anchor" href="#loaders_and_stores"></a>6.2.7. Loaders and Stores</h4> <div class="paragraph"> <p>Loaders and stores can be defined in server mode in almost the same way as in embedded mode (<a href="../user_guide/user_guide.html#persistence">described here</a>). However, in server mode it is no longer necessary to define the <code>&lt;persistence&gt;&#8230;&#8203;&lt;/persistence&gt;</code> tag. Instead, a store&#8217;s attributes are now defined on the store type element. For example, to configure the H2 database with a distributed cache in domain mode we define the "default" cache as follows in our domain.xml configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:core:9.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statistics</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;transport</span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;global-state</span><span class="tag">/&gt;</span>
          <span class="tag">&lt;distributed-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;string-keyed-jdbc-store</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fetch-state</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">shared</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                  <span class="tag">&lt;string-keyed-table</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISPN</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                      <span class="tag">&lt;id-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                      <span class="tag">&lt;data-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">datum</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BINARY</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                      <span class="tag">&lt;timestamp-column</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BIGINT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                  <span class="tag">&lt;/string-keyed-table&gt;</span>
                  <span class="tag">&lt;write-behind</span> <span class="attribute-name">modification-queue-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
              <span class="tag">&lt;/string-keyed-jdbc-store&gt;</span>
          <span class="tag">&lt;/distributed-cache&gt;</span>
      <span class="tag">&lt;/cache-container&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Another important thing to note in this example, is that we use the "ExampleDS" datasource which is defined in the datasources subsystem in our domain.xml configuration as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight nowrap"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:datasources:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;datasources&gt;</span>
          <span class="tag">&lt;datasource</span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use-java-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;connection-url&gt;</span>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<span class="tag">&lt;/connection-url&gt;</span>
              <span class="tag">&lt;driver&gt;</span>h2<span class="tag">&lt;/driver&gt;</span>
              <span class="tag">&lt;security&gt;</span>
                  <span class="tag">&lt;user-name&gt;</span>sa<span class="tag">&lt;/user-name&gt;</span>
                  <span class="tag">&lt;password&gt;</span>sa<span class="tag">&lt;/password&gt;</span>
              <span class="tag">&lt;/security&gt;</span>
          <span class="tag">&lt;/datasource&gt;</span>
      <span class="tag">&lt;/datasources&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> For additional examples of store configurations, please view the configuration templates in the default "domain.xml" file provided with in the server distribution at <code>./domain/configuration/domain.xml</code>. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="state_transfer"><a class="anchor" href="#state_transfer"></a>6.2.8. State Transfer</h4> <div class="paragraph"> <p>To define the state transfer configuration for a distributed or replicated cache, add the <code>&lt;state-transfer/&gt;</code> element as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;state-transfer</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">240000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">chunk-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">await-initial-transfer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The possible attributes for the state-transfer element are:</p> </div> <div class="ulist"> <ul> <li> <p><em>enabled</em> if true, this will cause the cache to ask neighboring caches for state when it starts up, so the cache starts 'warm', although it will impact startup time. Defaults to true.</p> </li> <li> <p><em>timeout</em> the maximum amount of time (ms) to wait for state from neighboring caches, before throwing an exception and aborting startup. Defaults to 240000 (4 minutes).</p> </li> <li> <p><em>chunk-size</em> the number of cache entries to batch in each transfer. Defaults to 512.</p> </li> <li> <p><em>await-initial-transfer</em> if true, this will cause the cache to wait for initial state transfer to complete before responding to requests. Defaults to true.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="endpoint_subsystem_configuration"><a class="anchor" href="#endpoint_subsystem_configuration"></a>6.3. Endpoint subsystem configuration</h3> <div class="paragraph"> <p>The endpoint subsystem exposes a whole container (or in the case of Memcached, a single cache) over a specific connector protocol. You can define as many connector as you need, provided they bind on different interfaces/ports.</p> </div> <div class="paragraph"> <p>The subsystem declaration is enclosed in the following XML element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:infinispan:server:endpoint:9.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
 <span class="tag">&lt;/subsystem&gt;</span></code></pre> </div> </div> <div class="sect3"> <h4 id="hot_rod"><a class="anchor" href="#hot_rod"></a>6.3.1. Hot Rod</h4> <div class="paragraph"> <p>The following connector declaration enables a HotRod server using the <em>hotrod</em> socket binding (declared within a <code>&lt;socket-binding-group /&gt;</code> element) and exposing the caches declared in the <em>local</em> container, using defaults for all other settings.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The connector will create a supporting topology cache with default settings. If you wish to tune these settings add the <code>&lt;topology-state-transfer /&gt;</code> child element to the connector as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;topology-state-transfer</span> <span class="attribute-name">lazy-retrieval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lock-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">replication-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The Hot Rod connector can be further tuned with additional settings such as concurrency and buffering. See the protocol connector settings paragraph for additional details</p> </div> <div class="paragraph"> <p>Furthermore the HotRod connector can be secured using SSL. First you need to declare an SSL server identity within a security realm in the management section of the configuration file. The SSL server identity should specify the path to a keystore and its secret. Refer to the AS <a href="https://docs.jboss.org/author/display/WFLY10/Security%20Realms">documentation</a> on this. Next add the <code>&lt;security /&gt;</code> element to the HotRod connector as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security</span> <span class="attribute-name">ssl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="memcached"><a class="anchor" href="#memcached"></a>6.3.2. Memcached</h4> <div class="paragraph"> <p>The following connector declaration enables a Memcached server using the <em>memcached</em> socket binding (declared within a <code>&lt;socket-binding-group /&gt;</code> element) and exposing the <em>memcachedCache</em> cache declared in the <em>local</em> container, using defaults for all other settings. Because of limitations in the Memcached protocol, only one cache can be exposed by a connector. If you wish to expose more than one cache, declare additional memcached-connectors on different socket-bindings.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;memcached-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memcached</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="websocket"><a class="anchor" href="#websocket"></a>6.3.3. WebSocket</h4> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;websocket-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="rest"><a class="anchor" href="#rest"></a>6.3.4. REST</h4> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;rest-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">other</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auth-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="common_protocol_connector_settings"><a class="anchor" href="#common_protocol_connector_settings"></a>6.3.5. Common Protocol Connector Settings</h4> <div class="paragraph"> <p>The HotRod, Memcached and WebSocket protocol connectors support a number of tuning attributes in their declaration:</p> </div> <div class="ulist"> <ul> <li> <p><em>worker-threads</em> Sets the number of worker threads. Defaults to 160.</p> </li> <li> <p><em>idle-timeout</em> Specifies the maximum time in seconds that connections from client will be kept open without activity. Defaults to -1 (connections will never timeout)</p> </li> <li> <p><em>tcp-nodelay</em> Affects TCP NODELAY on the TCP stack. Defaults to enabled.</p> </li> <li> <p><em>send-buffer-size</em> Sets the size of the send buffer.</p> </li> <li> <p><em>receive-buffer-size</em> Sets the size of the receive buffer.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="protocol_interoperability"><a class="anchor" href="#protocol_interoperability"></a>6.3.6. Protocol Interoperability</h4> <div class="paragraph"> <p>By default each protocol stores data in the cache in the most efficient format for that protocol, so that no transformations are required when retrieving entries. If instead you need to access the same data from multiple protocols, you should enable compatibility mode on the caches that you want to share. This is done by adding the <code>&lt;compatibility /&gt;</code> element to a cache definition, as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cache-container</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EAGER</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;transaction</span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;compatibility</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/local-cache&gt;</span>
<span class="tag">&lt;/cache-container&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To specify a custom server-side compatibility marshaller use the "marshaller" attribute which can hold either an ordinary fully qualified class name or an 'extended' class name which is composed of a JBoss Modules module identifier, a slot name, and a fully qualified class name separated by the ':' character, (eg. "com.acme.my-module-name:my-slot:com.acme.CustomMarshaller").</p> </div> <div class="paragraph"> <p>By using a plain fully qualified class name you will be able to reference only 'stock' marshallers provided by Infinispan, like "org.infinispan.query.remote.CompatibilityProtoStreamMarshaller". This option is provided for conciseness and backwards compatibility. The second option of using 'extended' class names is more generic and is preferred as it allows you to really add new marshallers from an external module of your choice.</p> </div> <div class="paragraph"> <p>The module identifier and slot follow the rules imposed by JBoss Modules, and the designated module must be available to the server either in the 'modules' folder or be deployed through the deployer service in the 'deployments' folder. In the second case its module identifier will be of the form 'deployment.my-jar-name.jar' and the slot will be 'main'.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> The referenced module will become an automatic dependency for the Cache referencing it, so in case the jar defining the module is redeployed, the Cache will be restarted. </td> </tr> </table> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- using an alternative, 'stock', marshaller --&gt;</span>
<span class="tag">&lt;compatibility</span> <span class="attribute-name">marshaller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.query.remote.CompatibilityProtoStreamMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

or

<span class="comment">&lt;!-- using a marshaller deployed as a module --&gt;</span>
<span class="tag">&lt;compatibility</span> <span class="attribute-name">marshaller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.my-gadgets-module:main:com.acme.CustomCompatMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

or

<span class="comment">&lt;!-- using a marshaller deployed as a regular jar deployed by dropping it in the 'deployments' folder --&gt;</span>
<span class="tag">&lt;compatibility</span> <span class="attribute-name">marshaller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.my-jar-with-gadgets.jar:main:com.acme.CustomCompatMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Past versions of Infinispan (prior to 9.1.x) did not support the 'extended' class name format and were unable to refer to classes outside the Infinispan implementation and instead relied on the user to manually modify the 'dependencies' or 'resources' element of the module.xml file of the "org.infinispan" module in order to 'inject' the user supplied jar containing the custom marshaller. This practice is suboptimal from the maintainability point of view and is now discouraged (but it still works) and you are urged to migrate to the new approach. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="custom_marshaller_bridges"><a class="anchor" href="#custom_marshaller_bridges"></a>6.3.7. Custom Marshaller Bridges</h4> <div class="paragraph"> <p>Infinispan provides two marshalling bridges for marshalling client/server requests using the Kryo and Protostuff libraries. To utilise either of these marshallers, you simply place the dependency of the marshaller you require in your client pom. Custom schemas for object marshalling must then be registered with the selected library using the library&#8217;s api on the client or by implementing a RegistryService for the given marshaller bridge. Examples of how to achieve this for both libraries are presented below:</p> </div> <div class="sect4"> <h5 id="protostuff"><a class="anchor" href="#protostuff"></a>Protostuff</h5> <div class="paragraph"> <p>Add the protostuff marshaller dependency to your pom:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-marshaller-protostuff<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>{infinispanversion}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To register custom Protostuff schemas in your own code, you must register the custom schema with Protostuff before any marshalling begins. This can be achieved by simply calling:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RuntimeSchema.register(ExampleObject.class, <span class="keyword">new</span> ExampleObjectSchema());</code></pre> </div> </div> <div class="paragraph"> <p>Or, you can implement a service provider for the <code>SchemaRegistryService.java</code> interface, placing all Schema registrations in the <code>register()</code> method. Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/protostuff/SchemaRegistryService</code> file within your deployment jar.</p> </div> </div> <div class="sect4"> <h5 id="kryo"><a class="anchor" href="#kryo"></a>Kryo</h5> <div class="paragraph"> <p>Add the kryo marshaller dependency to your pom:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.infinispan<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>infinispan-marshaller-kryo<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>{infinispanversion}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>To register custom Kryo serializer in your own code, you must register the custom serializer with Kryo before any marshalling begins. This can be achieved by implementing a service provider for the <code>SerializerRegistryService.java</code> interface, placing all serializer registrations in the <code>register(Kryo)</code> method; where serializers should be registered with the supplied <code>Kryo</code> object using the Kryo api. e.g. <code>kryo.register(ExampleObject.class, new ExampleObjectSerializer())</code>. Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/kryo/SerializerRegistryService</code> file within your deployment jar.</p> </div> </div> <div class="sect4"> <h5 id="server_compatibility_mode"><a class="anchor" href="#server_compatibility_mode"></a>Server Compatibility Mode</h5> <div class="paragraph"> <p>When using the Protostuff/Kryo bridges in compatibility mode, it is necessary for the class files of all custom objects to be placed on the classpath of the server. To achieve this, you should follow the steps outlined in the <a href="#_protocol_interoperability">Protocol Interoperability</a> section, to place a jar containing all of their custom classes on the server&#8217;s classpath.</p> </div> <div class="paragraph"> <p>When utilising a custom marshaller in compatibility mode, it is also necessary for the marshaller and it&#8217;s runtime dependencies to be on the server&#8217;s classpath. To aid with this step we have created a "bundle" jar for each of the bridge implementations which includes all of the runtime class files required by the bridge and underlying library. Therefore, it is only necessary to include this single jar on the server&#8217;s classpath.</p> </div> <div class="paragraph"> <p>Bundle jar downloads:</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-kryo-bundle/9.1/infinispan-marshaller-kryo-bundle-9.1.jar">Kryo Bundle</a></p> </li> <li> <p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-protostuff-bundle/9.1/infinispan-marshaller-protostuff-bundle-9.1.jar">Protostuff Bundle</a></p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Jar files containing custom classes must be placed in the same module/directory as the custom marshaller bundle so that the marshaller can load them. i.e. if you register the marshaller bundle in <code>modules/system/layers/base/org/infinispan/main/modules.xml</code>, then you must also register your custom classes here. </td> </tr> </table> </div> <div class="sect5"> <h6 id="registering_custom_schemas_serializers"><a class="anchor" href="#registering_custom_schemas_serializers"></a>Registering Custom Schemas/Serializers</h6> <div class="paragraph"> <p>Custom serializers/schemas for the Kryo/Protostuff marshallers must be registered via their respective service interfaces in compatibility mode. To achieve this, it is necessary for a jar containing the service provider to be registered in the same directory or module as the marshaller bundle and custom classes.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> It is not necessary for the service provider implementation to be provided in the same jar as the user&#8217;s custom classes, however the jar containing the provider must be in the same directory/module as the marshaller and custom class jars. </td> </tr> </table> </div> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="security"><a class="anchor" href="#security"></a>7. Security</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="general_concepts"><a class="anchor" href="#general_concepts"></a>7.1. General concepts</h3> <div class="sect3"> <h4 id="authorization_configuration"><a class="anchor" href="#authorization_configuration"></a>7.1.1. Authorization configuration</h4> <div class="paragraph"> <p>Just like embedded mode, the server supports cache authorization using the same configuration, e.g.:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;security&gt;</span>
         <span class="tag">&lt;authorization&gt;</span>
            <span class="tag">&lt;identity-role-mapper</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">WRITE</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;role</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supervisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permissions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">READ WRITE EXEC BULK</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/authorization&gt;</span>
      <span class="tag">&lt;/security&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;security&gt;</span>
            <span class="tag">&lt;authorization</span> <span class="attribute-name">roles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin reader writer supervisor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
         <span class="tag">&lt;/security&gt;</span>
      <span class="tag">&lt;/local-cache&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="server_realms"><a class="anchor" href="#server_realms"></a>7.1.2. Server Realms</h4> <div class="paragraph"> <p>Infinispan Server security is built around the features provided by the underlying server realm and security domains. Security Realms are used by the server to provide authentication and authorization information for both the management and application interfaces.</p> </div> <div class="listingblock"> <div class="title">Security Realm configuration</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;server</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:2.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;management&gt;</span>
        ...
        <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           <span class="tag">&lt;authentication&gt;</span>
              <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;/authentication&gt;</span>
           <span class="tag">&lt;authorization&gt;</span>
              <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-roles.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
           <span class="tag">&lt;/authorization&gt;</span>
        <span class="tag">&lt;/security-realm&gt;</span>
        ...
    <span class="tag">&lt;/management&gt;</span>
    ...
<span class="tag">&lt;/server&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Infinispan Server comes with an add-user.sh script (add-user.bat for Windows) to ease the process of adding new user/role mappings to the above property files. An example invocation for adding a user to the ApplicationRealm with an initial set of roles:</p> </div> <div class="paragraph"> <p>./bin/add-user.sh -a -u myuser -p "qwer1234!" -ro supervisor,reader,writer</p> </div> <div class="paragraph"> <p>It is also possible to authenticate/authorize against alternative sources, such as LDAP, JAAS, etc. Refer to the <a href="https://docs.jboss.org/author/display/WFLY10/Security%20Realms">WildFly security realms guide</a> on how to configure the Security Realms. Bear in mind that the choice of authentication mechanism you select for the protocols limits the type of authentication sources, since the credentials must be in a format supported by the algorithm itself (e.g. pre-digested passwords for the digest algorithm)</p> </div> </div> </div> <div class="sect2"> <h3 id="security_audit"><a class="anchor" href="#security_audit"></a>7.2. Security Audit</h3> <div class="paragraph"> <p>The Infinispan subsystem security audit by default sends audit logs to the audit manager configured at the server level. Refer to the <a href="https://docs.jboss.org/author/display/WFLY10/Security%20subsystem%20configuration">WildFly security subsystem guide</a> on how to configure the server audit manager. Alternatively you can also set your custom audit logger by using the same configuration as for embedded mode. Refer to the The <a href="../user_guide/user_guide.html#Security_chapter">Security</a> chapter in the user guide for details.</p> </div> </div> <div class="sect2"> <h3 id="hot_rod_authentication"><a class="anchor" href="#hot_rod_authentication"></a>7.3. Hot Rod authentication</h3> <div class="paragraph"> <p>The Hot Rod protocol supports authentication since version 2.0 (Infinispan 7.0) by leveraging the SASL mechanisms. The supported SASL mechanisms (usually shortened as mechs) are:</p> </div> <div class="ulist"> <ul> <li> <p>PLAIN - This is the most insecure mech, since credentials are sent over the wire in plain-text format, however it is the simplest to get to work. In combination with encryption (i.e. TLS) it can be used safely</p> </li> <li> <p>DIGEST-MD5 - This mech hashes the credentials before sending them over the wire, so it is more secure than PLAIN</p> </li> <li> <p>GSSAPI - This mech uses Kerberos tickets, and therefore requires the presence of a properly configured Kerberos Domain Controller (such as Microsoft Active Directory)</p> </li> <li> <p>EXTERNAL - This mech obtains credentials from the underlying transport (i.e. from a X.509 client certificate) and therefore requires encryption using client-certificates to be enabled.</p> </li> </ul> </div> <div class="paragraph"> <p>The following configuration enables authentication against ApplicationRealm, using the DIGEST-MD5 SASL mechanism and only enables the <strong>auth</strong> QOP:</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector configuration</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Notice the server-name attribute: it is the name that the server declares to incoming clients and therefore the client configuration must match. It is particularly important when using GSSAPI as it is equivalent to the Kerberos service name. You can specify multiple mechanisms and they will be attempted in order.</p> </div> <div class="sect3"> <h4 id="sasl_quality_of_protection"><a class="anchor" href="#sasl_quality_of_protection"></a>7.3.1. SASL Quality of Protection</h4> <div class="paragraph"> <p>While the main purpose of SASL is to provide authentication, some mechanisms also support integrity and privacy protection, also known as Quality of Protection (or qop). During authentication negotiation, ciphers are exchanged between client and server, and they can be used to add checksums and encryption to all subsequent traffic. You can tune the required level of qop as follows:</p> </div> <table class="tableblock frame-all grid-all"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">QOP</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">auth</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication only</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">auth-int</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity protection</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">auth-conf</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity and privacy protection</p></td> </tr> </tbody> </table> </div> <div class="sect3"> <h4 id="sasl_policies"><a class="anchor" href="#sasl_policies"></a>7.3.2. SASL Policies</h4> <div class="paragraph"> <p>You can further refine the way a mechanism is chosen by tuning the SASL policies. This will effectively include / exclude mechanisms based on whether they match the desired policies.</p> </div> <table class="tableblock frame-all grid-all"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Policy</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">forward-secrecy</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must support forward secrecy between sessions. This means that breaking into one session will not automatically provide information for breaking into future sessions.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">pass-credentials</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must require client credentials.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-plain-text</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to simple plain passive attacks.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-active</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to active (non-dictionary) attacks. The mechanism might require mutual authentication as a way to prevent active attacks.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-dictionary</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to passive dictionary attacks.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">no-anonymous</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not accept anonymous logins.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Each policy&#8217;s value is either "true" or "false". If a policy is absent, then the chosen mechanism need not have that characteristic (equivalent to setting the policy to "false"). One notable exception is the <strong>no-anonymous</strong> policy which, if absent, defaults to true, thus preventing anonymous connections.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> It is possible to have mixed anonymous and authenticated connections to the endpoint, delegating actual access logic to cache authorization configuration. To do so, set the <strong>no-anonymous</strong> policy to false and turn on cache authorization. </td> </tr> </table> </div> <div class="paragraph"> <p>The following configuration selects all available mechanisms, but effectively only enables GSSAPI, since it is the only one that respects all chosen policies:</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector policies</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAIN DIGEST-MD5 GSSAPI EXTERNAL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;policy&gt;</span>
            <span class="tag">&lt;no-active</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;no-anonymous</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;no-plain-text</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
         <span class="tag">&lt;/policy</span><span class="error">&lt;</span><span class="error">&gt;</span>
      <span class="tag">&lt;/sasl&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="configuring_the_hot_rod_client_for_authentication"><a class="anchor" href="#configuring_the_hot_rod_client_for_authentication"></a>7.3.3. Configuring the Hot Rod client for authentication</h4> <div class="paragraph"> <p>Once you have configured a secured Hot Rod connector, you can connect to it using the Hot Rod client. If you are using PLAIN and DIGEST-MD5 mechs you can pass your credentials directly to the ConfigurationBuilder:</p> </div> <div class="listingblock"> <div class="title">Hot Rod client configuration with simple authentication</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(<span class="integer">11222</span>)
    .security()
        .authentication()
            .enable()
            .serverName(<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span>)
            .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>)
            .username(<span class="string"><span class="delimiter">&quot;</span><span class="content">myuser</span><span class="delimiter">&quot;</span></span>)
            .realm(<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>)
            .password(<span class="string"><span class="delimiter">&quot;</span><span class="content">qwer1234!</span><span class="delimiter">&quot;</span></span>);
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>If instead you want to use your own callback handler:</p> </div> <div class="listingblock"> <div class="title">Hot Rod client configuration with authentication via callback</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCallbackHandler</span> <span class="directive">implements</span> <span class="predefined-type">CallbackHandler</span> {
   <span class="directive">final</span> <span class="directive">private</span> <span class="predefined-type">String</span> username;
   <span class="directive">final</span> <span class="directive">private</span> <span class="type">char</span><span class="type">[]</span> password;
   <span class="directive">final</span> <span class="directive">private</span> <span class="predefined-type">String</span> realm;

   <span class="directive">public</span> MyCallbackHandler(<span class="predefined-type">String</span> username, <span class="predefined-type">String</span> realm, <span class="type">char</span><span class="type">[]</span> password) {
      <span class="local-variable">this</span>.username = username;
      <span class="local-variable">this</span>.password = password;
      <span class="local-variable">this</span>.realm = realm;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> handle(<span class="predefined-type">Callback</span><span class="type">[]</span> callbacks) <span class="directive">throws</span> <span class="exception">IOException</span>, <span class="exception">UnsupportedCallbackException</span> {
      <span class="keyword">for</span> (<span class="predefined-type">Callback</span> callback : callbacks) {
         <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">NameCallback</span>) {
            <span class="predefined-type">NameCallback</span> nameCallback = (<span class="predefined-type">NameCallback</span>) callback;
            nameCallback.setName(username);
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">PasswordCallback</span>) {
            <span class="predefined-type">PasswordCallback</span> passwordCallback = (<span class="predefined-type">PasswordCallback</span>) callback;
            passwordCallback.setPassword(password);
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">AuthorizeCallback</span>) {
            <span class="predefined-type">AuthorizeCallback</span> authorizeCallback = (<span class="predefined-type">AuthorizeCallback</span>) callback;
            authorizeCallback.setAuthorized(authorizeCallback.getAuthenticationID().equals(
                  authorizeCallback.getAuthorizationID()));
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">RealmCallback</span>) {
            <span class="predefined-type">RealmCallback</span> realmCallback = (<span class="predefined-type">RealmCallback</span>) callback;
            realmCallback.setText(realm);
         } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedCallbackException</span>(callback);
         }
      }
   }
}

ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(<span class="integer">11222</span>)
    .security()
        .authentication()
            .enable()
            .serverName(<span class="string"><span class="delimiter">&quot;</span><span class="content">myhotrodserver</span><span class="delimiter">&quot;</span></span>)
            .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>)
            .callbackHandler(<span class="keyword">new</span> MyCallbackHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">myuser</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">qwer1234!</span><span class="delimiter">&quot;</span></span>.toCharArray()));
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>The actual type of callbacks that your CallbackHandler will need to be able to handle are mech-specific, so the above is just a simple example.</p> </div> </div> <div class="sect3"> <h4 id="using_gssapi_kerberos"><a class="anchor" href="#using_gssapi_kerberos"></a>7.3.4. Using GSSAPI/Kerberos</h4> <div class="paragraph"> <p>If you want to use GSSAPI/Kerberos, setup and configuration differs. First we need to define a Kerberos login module using the security domain subsystem:</p> </div> <div class="listingblock"> <div class="title">Security domain configuration</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;system-properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.security.krb5.conf</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/infinispan/krb5.conf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.security.krb5.debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.security.disable.secdomain.option</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/system-properties&gt;</span>

<span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kerberos</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">storeKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refreshKrb5Config</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useKeyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doNotPrompt</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/infinispan/infinispan.keytab</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HOTROD/localhost@INFINISPAN.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/login-module&gt;</span>
    <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/security-domain&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Next we need to modify the Hot Rod connector</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector configuration</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;sasl</span> <span class="attribute-name">server-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">server-context-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mechanisms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GSSAPI</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">qop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>On the client side you will also need to define a login module in a login configuration file:</p> </div> <div class="listingblock"> <div class="title">gss.conf</div> <div class="content"> <pre class="CodeRay highlight"><code>GssExample {
    com.sun.security.auth.module.Krb5LoginModule required client=TRUE;
};</code></pre> </div> </div> <div class="paragraph"> <p>Also you will need to set the following system properties:</p> </div> <div class="paragraph"> <p>java.security.auth.login.config=gss.conf</p> </div> <div class="paragraph"> <p>java.security.krb5.conf=/etc/krb5.conf</p> </div> <div class="paragraph"> <p>The krb5.conf file is dependent on your environment and needs to point to your KDC.</p> </div> <div class="listingblock"> <div class="title">Hot Rod client configuration</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCallbackHandler</span> <span class="directive">implements</span> <span class="predefined-type">CallbackHandler</span> {
   <span class="directive">final</span> <span class="directive">private</span> <span class="predefined-type">String</span> username;
   <span class="directive">final</span> <span class="directive">private</span> <span class="type">char</span><span class="type">[]</span> password;
   <span class="directive">final</span> <span class="directive">private</span> <span class="predefined-type">String</span> realm;

   <span class="directive">public</span> MyCallbackHandler() { }

   <span class="directive">public</span> MyCallbackHandler (<span class="predefined-type">String</span> username, <span class="predefined-type">String</span> realm, <span class="type">char</span><span class="type">[]</span> password) {
      <span class="local-variable">this</span>.username = username;
      <span class="local-variable">this</span>.password = password;
      <span class="local-variable">this</span>.realm = realm;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> handle(<span class="predefined-type">Callback</span><span class="type">[]</span> callbacks) <span class="directive">throws</span> <span class="exception">IOException</span>, <span class="exception">UnsupportedCallbackException</span> {
      <span class="keyword">for</span> (<span class="predefined-type">Callback</span> callback : callbacks) {
         <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">NameCallback</span>) {
            <span class="predefined-type">NameCallback</span> nameCallback = (<span class="predefined-type">NameCallback</span>) callback;
            nameCallback.setName(username);
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">PasswordCallback</span>) {
            <span class="predefined-type">PasswordCallback</span> passwordCallback = (<span class="predefined-type">PasswordCallback</span>) callback;
            passwordCallback.setPassword(password);
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">AuthorizeCallback</span>) {
            <span class="predefined-type">AuthorizeCallback</span> authorizeCallback = (<span class="predefined-type">AuthorizeCallback</span>) callback;
            authorizeCallback.setAuthorized(authorizeCallback.getAuthenticationID().equals(
                  authorizeCallback.getAuthorizationID()));
         } <span class="keyword">else</span> <span class="keyword">if</span> (callback <span class="keyword">instanceof</span> <span class="predefined-type">RealmCallback</span>) {
            <span class="predefined-type">RealmCallback</span> realmCallback = (<span class="predefined-type">RealmCallback</span>) callback;
            realmCallback.setText(realm);
         } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedCallbackException</span>(callback);
         }
      }
   }
}

<span class="predefined-type">LoginContext</span> lc = <span class="keyword">new</span> <span class="predefined-type">LoginContext</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">GssExample</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MyCallbackHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">krb_user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">krb_password</span><span class="delimiter">&quot;</span></span>.toCharArray()));
lc.login();
<span class="predefined-type">Subject</span> clientSubject = lc.getSubject();

ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(<span class="integer">11222</span>)
    .security()
        .authentication()
            .enable()
            .serverName(<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan-server</span><span class="delimiter">&quot;</span></span>)
            .saslMechanism(<span class="string"><span class="delimiter">&quot;</span><span class="content">GSSAPI</span><span class="delimiter">&quot;</span></span>)
            .clientSubject(clientSubject)
            .callbackHandler(<span class="keyword">new</span> MyCallbackHandler());
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>For brevity we used the same callback handler both for obtaining the client subject and for handling authentication in the SASL GSSAPI mech, however different callbacks will actually be invoked: NameCallback and PasswordCallback are needed to construct the client subject, while the AuthorizeCallback will be called during the SASL authentication.</p> </div> </div> </div> <div class="sect2"> <h3 id="hot_rod_and_rest_encryption_tls_ssl"><a class="anchor" href="#hot_rod_and_rest_encryption_tls_ssl"></a>7.4. Hot Rod and REST encryption (TLS/SSL)</h3> <div class="paragraph"> <p>Both Hot Rod and REST protocols support encryption using SSL/TLS with optional TLS/SNI support (<a href="https://en.wikipedia.org/wiki/Server_Name_Indication">Server Name Indication</a>). To set this up you need to create a keystore using the keytool application which is part of the JDK to store your server certificate. Then add a &lt;server-identities&gt; element to your security realm:</p> </div> <div class="listingblock"> <div class="title">Security Realm configuration for SSL</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
            <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
    <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>When using SNI support there might be multiple Security Realms configured.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>It is also possible to generate development certificates on server startup. In order to do this, just specify <code>generate-self-signed-certificate-host</code> in the keystore element as shown below:</p> </div> <div class="listingblock"> <div class="title">Generating Keystore automatically</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;ssl&gt;</span>
            <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">generate-self-signed-certificate-host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl&gt;</span>
    <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>There are three basic principles of automatically generated keystores that need be remembered:</p> </div> <div class="ulist"> <ul> <li> <p>They shouldn&#8217;t be used on a production environment</p> </li> <li> <p>They are generated when necessary (e.g. while obtaining the first connection from the client)</p> </li> <li> <p>They contain also certificates so they might be used in a Hot Rod client directly</p> </li> </ul> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>Next modify the &lt;hotrod-connector&gt; and/or &lt;rest-connector&gt; elements in the endpoint subsystem to require encryption. Optionally add SNI configuration:</p> </div> <div class="listingblock"> <div class="title">Hot Rod connector SSL configuration</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;encryption</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain1ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain2ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/encryption&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span>
<span class="tag">&lt;rest-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;encryption</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain1ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domain2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Domain2ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/encryption&gt;</span>
<span class="tag">&lt;/rest-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>In order to connect to the server using the Hot Rod protocol, the client needs a trust store containing the public key of the server(s) you are going to connect to, unless the key was signed by a Certification Authority (CA) trusted by the JRE.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(<span class="integer">11222</span>)
     .security()
        .ssl()
           .enabled(<span class="predefined-constant">true</span>)
           .sniHostName(<span class="string"><span class="delimiter">&quot;</span><span class="content">domain1</span><span class="delimiter">&quot;</span></span>)
           .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_client.jks</span><span class="delimiter">&quot;</span></span>)
           .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray());
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre> </div> </div> <div class="paragraph"> <p>Additionally, you might also want to enable client certificate authentication (and optionally also allow the use of the EXTERNAL SASL mech to authenticate and authorize clients). To enable this you will need the security realm on the server to be able to trust incoming client certificates by adding a trust store:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;authentication&gt;</span>
      <span class="tag">&lt;truststore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/authentication&gt;</span>
   <span class="tag">&lt;server-identities&gt;</span>
       <span class="tag">&lt;ssl&gt;</span>
           <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_server.jks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
       <span class="tag">&lt;/ssl&gt;</span>
   <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>And then tell the connector to require a client certificate:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;encryption</span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">require-ssl-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/hotrod-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The client, at this point, will also need to specify a keyStore which contains its certificate on top of the trustStore which trusts the server certificate.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(<span class="integer">11222</span>)
     .security()
        .ssl()
           .enabled(<span class="predefined-constant">true</span>)
           .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_client.jks</span><span class="delimiter">&quot;</span></span>)
           .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray())
           .keyStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_client.jks</span><span class="delimiter">&quot;</span></span>)
           .keyStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray());
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="health_monitoring"><a class="anchor" href="#health_monitoring"></a>8. Health monitoring</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan server has special endpoints for monitoring cluster health. The API is exposed via:</p> </div> <div class="ulist"> <ul> <li> <p>Programmatically (using <code>embeddedCacheManager.getHealth()</code>)</p> </li> <li> <p>JMX</p> </li> <li> <p>CLI</p> </li> <li> <p>REST (using <a href="https://docs.jboss.org/author/display/WFLY10/The+HTTP+management+API">WildFly HTTP Management API</a>)</p> </li> </ul> </div> <div class="sect2"> <h3 id="accessing_health_api_using_jmx"><a class="anchor" href="#accessing_health_api_using_jmx"></a>8.1. Accessing Health API using JMX</h3> <div class="paragraph"> <p>At first you need to connect to the Infinispan Server using JMX (use JConsole or other tool for this). Next, navigate to object name <code>jboss.datagrid-infinispan:type=CacheManager,name="clustered",component=CacheContainerHealth</code>.</p> </div> </div> <div class="sect2"> <h3 id="accessing_health_api_using_cli"><a class="anchor" href="#accessing_health_api_using_cli"></a>8.2. Accessing Health API using CLI</h3> <div class="paragraph"> <p>The Health API can be also accessed using CLI interface. An example invocation and result is presented below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">$ ispn-cli.sh -c &quot;/subsystem=datagrid-infinispan/cache-container=clustered/health=HEALTH:read-resource(include-runtime=true)&quot;

{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; {
        &quot;cache-health&quot; =&gt; &quot;HEALTHY&quot;,
        &quot;cluster-health&quot; =&gt; [&quot;test&quot;],
        &quot;cluster-name&quot; =&gt; &quot;clustered&quot;,
        &quot;free-memory&quot; =&gt; 99958L,
        &quot;log-tail&quot; =&gt; [
            &quot;2016-08-10 11:54:14,706 INFO  [org.infinispan.server.endpoint] (MSC service thread 1-5) DGENDPT10001: HotRodServer listening on 127.0.0.1:11222&quot;,
            &quot;2016-08-10 11:54:14,706 INFO  [org.infinispan.server.endpoint] (MSC service thread 1-1) DGENDPT10001: MemcachedServer listening on 127.0.0.1:11211&quot;,
            &quot;2016-08-10 11:54:14,785 INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___protobuf_metadata cache from clustered container&quot;,
            &quot;2016-08-10 11:54:14,800 INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___script_cache cache from clustered container&quot;,
            &quot;2016-08-10 11:54:15,159 INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-5) DGISPN0001: Started ___hotRodTopologyCache cache from clustered container&quot;,
            &quot;2016-08-10 11:54:15,210 INFO  [org.infinispan.rest.NettyRestServer] (MSC service thread 1-6) ISPN012003: REST server starting, listening on 127.0.0.1:8080&quot;,
            &quot;2016-08-10 11:54:15,210 INFO  [org.infinispan.server.endpoint] (MSC service thread 1-6) DGENDPT10002: REST mapped to /rest&quot;,
            &quot;2016-08-10 11:54:15,306 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management&quot;,
            &quot;2016-08-10 11:54:15,307 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990&quot;,
            &quot;2016-08-10 11:54:15,307 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: Infinispan Server 9.0.0-SNAPSHOT (WildFly Core 2.2.0.CR9) started in 8681ms - Started 196 of 237 services (121 services are lazy, passive or on-demand)&quot;
        ],
        &quot;number-of-cpus&quot; =&gt; 8,
        &quot;number-of-nodes&quot; =&gt; 1,
        &quot;total-memory&quot; =&gt; 235520L
    }
}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="accessing_health_api_using_rest"><a class="anchor" href="#accessing_health_api_using_rest"></a>8.3. Accessing Health API using REST</h3> <div class="paragraph"> <p>As mentioned in the <a href="https://docs.jboss.org/author/display/WFLY10/The+HTTP+management+API">WildFly HTTP Management API</a> article, the HTTP API requires using proper credentials (use <code>add-user.sh</code> script for that).</p> </div> <div class="paragraph"> <p>When credentials are set, all resources accessible by CLI can also be accessed using REST interface. An example is shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="bash">curl --digest -L -D - &quot;http://localhost:9990/management/subsystem/datagrid-infinispan/cache-container/clustered/health/HEALTH?operation=resource&amp;include-runtime=true&amp;json.pretty=1&quot; --header &quot;Content-Type: application/json&quot; -u ispnadmin:ispnadmin
HTTP/1.1 401 Unauthorized
Connection: keep-alive
WWW-Authenticate: Digest realm=&quot;ManagementRealm&quot;,domain=&quot;/management&quot;,nonce=&quot;AuZzFxz7uC4NMTQ3MDgyNTU1NTQ3OCfIJBHXVpPHPBdzGUy7Qts=&quot;,opaque=&quot;00000000000000000000000000000000&quot;,algorithm=MD5,qop=&quot;auth&quot;
Content-Length: 77
Content-Type: text/html
Date: Wed, 10 Aug 2016 10:39:15 GMT

HTTP/1.1 200 OK
Connection: keep-alive
Authentication-Info: nextnonce=&quot;AuZzFxz7uC4NMTQ3MDgyNTU1NTQ3OCfIJBHXVpPHPBdzGUy7Qts=&quot;,qop=&quot;auth&quot;,rspauth=&quot;b518c3170e627bd732055c382ce5d970&quot;,cnonce=&quot;NGViOWM0NDY5OGJmNjY0MjcyOWE4NDkyZDU3YzNhYjY=&quot;,nc=00000001
Content-Type: application/json; charset=utf-8
Content-Length: 1927
Date: Wed, 10 Aug 2016 10:39:15 GMT

{
    &quot;cache-health&quot; : &quot;HEALTHY&quot;,
    &quot;cluster-health&quot; : [&quot;test&quot;, &quot;HEALTHY&quot;],
    &quot;cluster-name&quot; : &quot;clustered&quot;,
    &quot;free-memory&quot; : 96778,
    &quot;log-tail&quot; : [
        &quot;2016-08-10 11:54:14,706 INFO  [org.infinispan.server.endpoint] (MSC service thread 1-5) DGENDPT10001: HotRodServer listening on 127.0.0.1:11222&quot;,
        &quot;2016-08-10 11:54:14,706 INFO  [org.infinispan.server.endpoint] (MSC service thread 1-1) DGENDPT10001: MemcachedServer listening on 127.0.0.1:11211&quot;,
        &quot;2016-08-10 11:54:14,785 INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___protobuf_metadata cache from clustered container&quot;,
        &quot;2016-08-10 11:54:14,800 INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___script_cache cache from clustered container&quot;,
        &quot;2016-08-10 11:54:15,159 INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-5) DGISPN0001: Started ___hotRodTopologyCache cache from clustered container&quot;,
        &quot;2016-08-10 11:54:15,210 INFO  [org.infinispan.rest.NettyRestServer] (MSC service thread 1-6) ISPN012003: REST server starting, listening on 127.0.0.1:8080&quot;,
        &quot;2016-08-10 11:54:15,210 INFO  [org.infinispan.server.endpoint] (MSC service thread 1-6) DGENDPT10002: REST mapped to /rest&quot;,
        &quot;2016-08-10 11:54:15,306 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management&quot;,
        &quot;2016-08-10 11:54:15,307 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990&quot;,
        &quot;2016-08-10 11:54:15,307 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: Infinispan Server 9.0.0-SNAPSHOT (WildFly Core 2.2.0.CR9) started in 8681ms - Started 196 of 237 services (121 services are lazy, passive or on-demand)&quot;
    ],
    &quot;number-of-cpus&quot; : 8,
    &quot;number-of-nodes&quot; : 1,
    &quot;total-memory&quot; : 235520
}%</code></pre> </div> </div> <div class="paragraph"> <p>Note that the result is exactly the same as the one obtained by CLI interface.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="multi_tenancy"><a class="anchor" href="#multi_tenancy"></a>9. Multi-tenancy</h2> <div class="sectionbody"> <div class="paragraph"> <p>Multi-tenancy allows accessing multiple containers as shown below:</p> </div> <div class="imageblock"> <div class="content"> <img src="./images/multi-tenancy.png" alt="multi tenancy"> </div> </div> <div class="paragraph"> <p>Currently there are two supported protocols for accessing the data - using Hot Rod client and using REST interface.</p> </div> <div class="sect2"> <h3 id="using_rest_interface"><a class="anchor" href="#using_rest_interface"></a>9.1. Using REST interface</h3> <div class="paragraph"> <p>Multi-tenancy router uses URL prefixes to separate containers using the following template: <code><a href="https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/&lt;rest_connector_name&gt;/&lt;cache_name&gt;/&lt;key&gt" class="bare">https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/&lt;rest_connector_name&gt;/&lt;cache_name&gt;/&lt;key&gt</a>;</code>. All HTTP operations remain exactly the same as using standard <code>rest-connector</code>.</p> </div> <div class="paragraph"> <p>The REST connector by default support both HTTP/1.1 and HTTP/2 protocols. The switching from HTTP/1.1 to HTTP/2 procedure involves either using TLS/ALPN negotiation or HTTP/1.1 upgrade procedure. The former requires proper encryption to be enabled. The latter is always enabled.</p> </div> </div> <div class="sect2"> <h3 id="using_hot_rod_client"><a class="anchor" href="#using_hot_rod_client"></a>9.2. Using Hot Rod client</h3> <div class="paragraph"> <p>Multi-tenant routing for binary protocols requires using a standard, transport layer mechanism such as <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">SSL/TLS Server Name Indication</a>. The server needs to be configured to support encryption and additional SNI routing needs to be added to the <code>router-connector</code>.</p> </div> <div class="paragraph"> <p>In order to connect to a secured Hot Rod server, the client needs to use configuration similar to this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder
    .addServer()
        .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>)
        .port(hotrodServer.getPort())
     .security()
        .ssl()
           .enabled(sslClient)
           .sniHostName(<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span>) <span class="comment">// SNI Host Name</span>
           .trustStoreFileName(<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore.jks</span><span class="delimiter">&quot;</span></span>)
           .trustStorePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>.toCharArray());
remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());</code></pre> </div> </div> <div class="sect3"> <h4 id="multi_tenant_router"><a class="anchor" href="#multi_tenant_router"></a>9.2.1. Multi-tenant router</h4> <div class="paragraph"> <p>The Multi-tenant router endpoint works as a facade for one or more REST/Hot Rod connectors. Its main purpose is to forward client requests into proper container.</p> </div> <div class="paragraph"> <p>In order to properly configure the routing, <code>socket-binding</code> attributes of other connectors must be disabled and additional attribute <code>name</code> must be used as shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;rest-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;hotrod-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>The next step is to add a new <code>router-connector</code> endpoint and configure how other containers will be accessed. Note that Hot Rod connectors require using TLS/SNI and REST connectors require using prefix in the URL:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;router-connector</span> <span class="attribute-name">hotrod-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rest-socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keep-alive</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tcp-nodelay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">receive-buffer-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">send-buffer-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLRealm1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hotrod&gt;</span>
    <span class="tag">&lt;hotrod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-2</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;sni</span> <span class="attribute-name">host-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotrod-2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLRealm2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hotrod&gt;</span>
    <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;prefix</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-1</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest&gt;</span>
    <span class="tag">&lt;rest</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;prefix</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/rest&gt;</span>
<span class="tag">&lt;/router-connector&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>With the following configuration, Hot Rod clients will access <code>hotrod-1</code> connector when using SNI Host Name "hotrod-1". REST clients will need to use the following URL to access "rest-1" connector - <code><a href="https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/rest-1" class="bare">https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/rest-1</a></code>.</p> </div> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2018-03-16 12:39:44 UTC </div> </div> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8601422-1', 'auto');
  ga('send', 'pageview');

</script> </body> </html>